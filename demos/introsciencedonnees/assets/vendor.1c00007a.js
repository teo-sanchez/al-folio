var Sse=Object.defineProperty,Cse=Object.defineProperties;var Tse=Object.getOwnPropertyDescriptors;var e_=Object.getOwnPropertySymbols;var hB=Object.prototype.hasOwnProperty,fB=Object.prototype.propertyIsEnumerable;var dB=(t,e,n)=>e in t?Sse(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Bt=(t,e)=>{for(var n in e||(e={}))hB.call(e,n)&&dB(t,n,e[n]);if(e_)for(var n of e_(e))fB.call(e,n)&&dB(t,n,e[n]);return t},ni=(t,e)=>Cse(t,Tse(e));var ja=(t,e)=>{var n={};for(var r in t)hB.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&e_)for(var r of e_(t))e.indexOf(r)<0&&fB.call(t,r)&&(n[r]=t[r]);return n};function Ese(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in t)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kse=1e-7,Ase=1e-4;class dM{constructor(e,n){this.backend=e,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,n){this.dataIdsCount++,this.data.set(e,n)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class t_{refCount(e){return To("refCount")}incRef(e){return To("incRef")}timerAvailable(){return!0}time(e){return To("time")}read(e){return To("read")}readSync(e){return To("readSync")}readToGPU(e,n){return To("readToGPU")}numDataIds(){return To("numDataIds")}disposeData(e,n){return To("disposeData")}write(e,n,r){return To("write")}move(e,n,r,i,s){return To("move")}memory(){return To("memory")}floatPrecision(){return To("floatPrecision")}epsilon(){return this.floatPrecision()===32?kse:Ase}dispose(){return To("dispose")}}function To(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pM(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,Nc(t,e,n)}function Mse(t,e){if(t.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${e.length}`);let n=t.length,r=0;for(;n>0;)r=Math.random()*n|0,n--,Nc(t,n,r),Nc(e,n,r)}function Ou(t,e,n){return Math.max(t,Math.min(e,n))}function mM(t){return t%2==0?t:t+1}function Nc(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function pB(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function Ise(t,e){const n=Math.random();return e*n+(1-n)*t}function Nse(t,e){let n=0;for(let r=0;r<t.length;r++){const i=Number(t[r])-Number(e[r]);n+=i*i}return n}function z(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function zi(t,e,n=""){z(wn(t,e),()=>n+` Shapes ${t} and ${e} must match`)}function rf(t){z(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function $c(t,e=[],n=!1){if(e==null&&(e=[]),Array.isArray(t)||Qi(t)&&!n)for(let r=0;r<t.length;++r)$c(t[r],e,n);else e.push(t);return e}function _e(t){if(t.length===0)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function $se(t){return t.length===0}function wn(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function sf(t){return t%1==0}function Rse(t){if(Math.tanh!=null)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{const e=Math.exp(2*t);return(e-1)/(e+1)}}function n_(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function Dse(t){const e=new Uint32Array(t);for(let n=0;n<t;++n)e[n]=n;return pM(e),e}function of(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function gM(t,e=r=>0,n){return new Promise((r,i)=>{let s=0;const o=()=>{if(t()){r();return}s++;const a=e(s);if(n!=null&&s>=n){i();return}setTimeout(o,a)};o()})}function vM(t,e){let n=1,r=-1;for(let s=0;s<t.length;++s)if(t[s]>=0)n*=t[s];else if(t[s]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${s}`);r=s}else if(t[s]<0)throw Error(`Shapes can not be < 0. Found ${t[s]} at dim ${s}`);if(r===-1){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(n===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const i=t.slice();return i[r]=e/n,i}function hn(t,e){const n=e.length;return t=t==null?e.map((r,i)=>i):[].concat(t),z(t.every(r=>r>=-n&&r<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`),z(t.every(r=>sf(r)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(r=>r<0?n+r:r)}function Rc(t,e){const n=[],r=[],i=e!=null&&Array.isArray(e)&&e.length===0,s=e==null||i?null:hn(e,t).sort();let o=0;for(let a=0;a<t.length;++a){if(s!=null){if(s[o]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(s[o]==null||s[o]>a)&&t[a]===1&&(n.push(t[a]),r.push(a)),s[o]<=a&&o++}t[a]!==1&&(n.push(t[a]),r.push(a))}return{newShape:n,keptDims:r}}function fi(t,e){let n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else throw new Error(`Unknown data type ${t}`);return n}function hs(t,e){let n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else if(t==="string")n=new Array(e);else throw new Error(`Unknown data type ${t}`);return n}function mB(t,e){for(let n=0;n<t.length;n++){const r=t[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function gB(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function yM(t,e){return!(e==="complex64"||e==="float32"&&t!=="complex64"||e==="int32"&&t!=="float32"&&t!=="complex64"||e==="bool"&&t==="bool")}function Qi(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}function r_(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function vB(t){if(t==null)return 0;let e=0;return t.forEach(n=>e+=n.length),e}function Ol(t){return typeof t=="string"||t instanceof String}function yB(t){return typeof t=="boolean"}function i_(t){return typeof t=="number"}function bp(t){return Array.isArray(t)?bp(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":i_(t)?"float32":Ol(t)?"string":yB(t)?"bool":"float32"}function Fu(t){return!!(t&&t.constructor&&t.call&&t.apply)}function s_(t,e){for(let n=e;n<t;++n)if(t%n==0)return n;return t}function Rt(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function bB(t,e,n,r=!1){const i=new Array;if(e.length===1){const s=e[0]*(r?2:1);for(let o=0;o<s;o++)i[o]=n[t+o]}else{const s=e[0],o=e.slice(1),a=o.reduce((l,c)=>l*c)*(r?2:1);for(let l=0;l<s;l++)i[l]=bB(t+l*a,o,n,r)}return i}function Eo(t,e,n=!1){if(t.length===0)return e[0];const r=t.reduce((i,s)=>i*s)*(n?2:1);if(r===0)return[];if(r!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return bB(0,t,e,n)}function bM(t,e){const n=Vi(t,e);for(let r=0;r<n.length;r++)n[r]=1;return n}function Vi(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function wM(t,e){const n=t.reduce((r,i)=>r*i,1);if(e==null||e==="float32")return Eo(t,new Float32Array(n));if(e==="int32")return Eo(t,new Int32Array(n));if(e==="bool")return Eo(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function xM(t){t.forEach(e=>{z(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function qa(t,e,n){if(e===0)return 0;if(e===1)return t[0];let r=t[t.length-1];for(let i=0;i<t.length-1;++i)r+=n[i]*t[i];return r}function wp(t,e,n){if(e===0)return[];if(e===1)return[t];const r=new Array(e);for(let i=0;i<r.length-1;++i)r[i]=Math.floor(t/n[i]),t-=r[i]*n[i];return r[r.length-1]=t,r}function xp(t){return t&&t.then&&typeof t.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wB="tfjsflags";class xB{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Pse,this.populateURLFlags()}setPlatform(e,n){this.platform!=null&&(Ce().getBool("IS_TEST")||Ce().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${n}.`)),this.platformName=e,this.platform=n}registerFlag(e,n,r){if(this.flagRegistry[e]={evaluationFn:n,setHook:r},this.urlFlags[e]!=null){const i=this.urlFlags[e];Ce().getBool("IS_TEST")||Ce().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${i}.`),this.set(e,i)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const n=this.evaluateFlag(e);if(xp(n))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=n,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,n){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global=="undefined"||typeof this.global.location=="undefined"||typeof this.global.location.search=="undefined")return;const e=this.getQueryParams(this.global.location.search);wB in e&&e[wB].split(",").forEach(r=>{const[i,s]=r.split(":");this.urlFlags[i]=Fse(i,s)})}}function Pse(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...r)=>(Ose(e,r[0],r[1]),r.join("="))),e}function Ose(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function Fse(t,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if(`${+e}`===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${t}.`)}function Ce(){return _M}let _M=null;function Lse(t){_M=t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let SM;function _B(){if(SM==null){let t;if(typeof window!="undefined")t=window;else if(typeof global!="undefined")t=global;else if(typeof process!="undefined")t=process;else if(typeof self!="undefined")t=self;else throw new Error("Could not find a global object");SM=t}return SM}function Bse(){const t=_B();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function CM(t,e){const n=Bse();if(n.has(t))return n.get(t);{const r=e();return n.set(t,r),n.get(t)}}const Sy="Abs",_p="Acos",Sp="Acosh",af="Add",Cy="AddN",o_="All",a_="Any",Ty="ArgMax",Ey="ArgMin",Cp="Asin",Tp="Asinh",Ep="Atan",kp="Atanh",Ap="Atan2",ky="AvgPool",l_="AvgPoolGrad",Ay="AvgPool3D",c_="AvgPool3DGrad",My="BatchMatMul",Iy="BatchToSpaceND",u_="Bincount",SB="BroadcastTo",h_="BroadcastArgs",Mp="Cast",Ip="Ceil",Np="ClipByValue",f_="Complex",Ny="ComplexAbs",$y="Concat",Ry="Conv2D",d_="Conv2DBackpropFilter",Dy="Conv2DBackpropInput",Py="Conv3D",p_="Conv3DBackpropFilterV2",m_="Conv3DBackpropInputV2",$p="Cos",Rp="Cosh",Oy="Cumsum",g_="CropAndResize",v_="DenseBincount",y_="DepthToSpace",Fy="DepthwiseConv2dNative",b_="DepthwiseConv2dNativeBackpropFilter",w_="DepthwiseConv2dNativeBackpropInput",x_="Diag",Ly="Dilation2D",__="Dilation2DBackpropInput",S_="Dilation2DBackpropFilter",Dp="RealDiv",C_="Einsum",Pp="Elu",T_="EluGrad",Op="Erf",By="Equal",Fp="Exp",zy="ExpandDims",Lp="Expm1",E_="FFT",k_="Fill",A_="FlipLeftRight",Bp="Floor",zp="FloorDiv",Vy="FusedBatchNorm",Uy="GatherV2",M_="GatherNd",Wy="Greater",Vp="GreaterEqual",Up="Identity",I_="IFFT",N_="Imag",Wp="IsFinite",Gp="IsInf",Hp="IsNan",Gy="LeakyRelu",Hy="Less",jy="LessEqual",$_="LinSpace",jp="Log",qp="Log1p",qy="LogicalAnd",Xy="LogicalNot",Ky="LogicalOr",CB="LogSoftmax",Yy="LRN",R_="LRNGrad",Zy="Max",Xp="Maximum",Jy="MaxPool",D_="MaxPoolGrad",Qy="MaxPool3D",P_="MaxPool3DGrad",O_="MaxPoolWithArgmax",e0="Mean",t0="Min",Kp="Minimum",n0="MirrorPad",Yp="Mod",F_="Multinomial",Zp="Multiply",r0="Neg",i0="NotEqual",L_="NonMaxSuppressionV3",B_="NonMaxSuppressionV4",z_="NonMaxSuppressionV5",s0="OnesLike",o0="OneHot",a0="Pack",l0="PadV2",zse="Pool",Jp="Pow",c0="Prelu",V_="Prod",U_="Range",W_="Real",Qp="Reciprocal",em="Relu",u0="Reshape",h0="ResizeNearestNeighbor",G_="ResizeNearestNeighborGrad",f0="ResizeBilinear",H_="ResizeBilinearGrad",tm="Relu6",d0="Reverse",nm="Round",rm="Rsqrt",j_="ScatterNd",p0="Select",im="Selu",m0="Slice",sm="Sin",om="Sinh",am="Sign",lm="Sigmoid",cm="Softplus",um="Sqrt",g0="Sum",v0="SpaceToBatchND",y0="SplitV",b0="Softmax",q_="SparseFillEmptyRows",X_="SparseReshape",K_="SparseSegmentMean",Y_="SparseSegmentSum",Z_="SparseToDense",hm="SquaredDifference",J_="Square",Q_="StridedSlice",eS="StringNGrams",tS="StringSplit",nS="StringToHashBucketFast",fm="Sub",dm="Tan",pm="Tanh",mm="Tile",rS="TopK",iS="Transform",w0="Transpose",sS="Unique",x0="Unpack",_0="UnsortedSegmentSum",S0="ZerosLike",gm="Step",oS="FromPixels",aS="RotateWithOffset",C0="_FusedMatMul",T0="FusedConv2D",E0="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ko(...t){Ce().getBool("IS_TEST")||Ce().getBool("PROD")||console.warn(...t)}function Vse(...t){Ce().getBool("IS_TEST")||Ce().getBool("PROD")||console.log(...t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vm=CM("kernelRegistry",()=>new Map),k0=CM("gradRegistry",()=>new Map);function lS(t,e){const n=EM(t,e);return vm.get(n)}function TM(t){return k0.get(t)}function cS(t){const e=vm.entries(),n=[];for(;;){const{done:r,value:i}=e.next();if(r)break;const[s,o]=i,[a]=s.split("_");a===t&&n.push(o)}return n}function uS(t){const{kernelName:e,backendName:n}=t,r=EM(e,n);vm.has(r)&&ko(`The kernel '${e}' for backend '${n}' is already registered`),vm.set(r,t)}function TB(t){const{kernelName:e}=t;k0.has(e)&&Ce().getBool("DEBUG")&&ko(`Overriding the gradient for '${e}'`),k0.set(e,t)}function Use(t,e){const n=EM(t,e);if(!vm.has(n))throw new Error(`The kernel '${t}' for backend '${e}' is not registered`);vm.delete(n)}function Wse(t){if(!k0.has(t))throw new Error(`The gradient '${t}' for backend is not registered`);k0.delete(t)}function Gse(t,e){cS(t).forEach(r=>{const i=Object.assign({},r,{backendName:e});uS(i)})}function EM(t,e){return`${e}_${t}`}var $t=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Hse(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function A0(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach(function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}),e}var kM=gr,oa=null;try{oa=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function gr(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}gr.prototype.__isLong__;Object.defineProperty(gr.prototype,"__isLong__",{value:!0});function Js(t){return(t&&t.__isLong__)===!0}gr.isLong=Js;var EB={},kB={};function lf(t,e){var n,r,i;return e?(t>>>=0,(i=0<=t&&t<256)&&(r=kB[t],r)?r:(n=vr(t,(t|0)<0?-1:0,!0),i&&(kB[t]=n),n)):(t|=0,(i=-128<=t&&t<128)&&(r=EB[t],r)?r:(n=vr(t,t<0?-1:0,!1),i&&(EB[t]=n),n))}gr.fromInt=lf;function aa(t,e){if(isNaN(t))return e?cf:la;if(e){if(t<0)return cf;if(t>=MB)return DB}else{if(t<=-IB)return Qs;if(t+1>=IB)return RB}return t<0?aa(-t,e).neg():vr(t%ym|0,t/ym|0,e)}gr.fromNumber=aa;function vr(t,e,n){return new gr(t,e,n)}gr.fromBits=vr;var hS=Math.pow;function AM(t,e,n){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return la;if(typeof e=="number"?(n=e,e=!1):e=!!e,n=n||10,n<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return AM(t.substring(1),e,n).neg();for(var i=aa(hS(n,8)),s=la,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),l=parseInt(t.substring(o,o+a),n);if(a<8){var c=aa(hS(n,a));s=s.mul(c).add(aa(l))}else s=s.mul(i),s=s.add(aa(l))}return s.unsigned=e,s}gr.fromString=AM;function Xa(t,e){return typeof t=="number"?aa(t,e):typeof t=="string"?AM(t,e):vr(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}gr.fromValue=Xa;var AB=1<<16,jse=1<<24,ym=AB*AB,MB=ym*ym,IB=MB/2,NB=lf(jse),la=lf(0);gr.ZERO=la;var cf=lf(0,!0);gr.UZERO=cf;var bm=lf(1);gr.ONE=bm;var $B=lf(1,!0);gr.UONE=$B;var MM=lf(-1);gr.NEG_ONE=MM;var RB=vr(4294967295|0,2147483647|0,!1);gr.MAX_VALUE=RB;var DB=vr(4294967295|0,4294967295|0,!0);gr.MAX_UNSIGNED_VALUE=DB;var Qs=vr(0,2147483648|0,!1);gr.MIN_VALUE=Qs;var tt=gr.prototype;tt.toInt=function(){return this.unsigned?this.low>>>0:this.low};tt.toNumber=function(){return this.unsigned?(this.high>>>0)*ym+(this.low>>>0):this.high*ym+(this.low>>>0)};tt.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Qs)){var n=aa(e),r=this.div(n),i=r.mul(n).sub(this);return r.toString(e)+i.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var s=aa(hS(e,6),this.unsigned),o=this,a="";;){var l=o.div(s),c=o.sub(l.mul(s)).toInt()>>>0,u=c.toString(e);if(o=l,o.isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}};tt.getHighBits=function(){return this.high};tt.getHighBitsUnsigned=function(){return this.high>>>0};tt.getLowBits=function(){return this.low};tt.getLowBitsUnsigned=function(){return this.low>>>0};tt.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Qs)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&(e&1<<n)==0;n--);return this.high!=0?n+33:n+1};tt.isZero=function(){return this.high===0&&this.low===0};tt.eqz=tt.isZero;tt.isNegative=function(){return!this.unsigned&&this.high<0};tt.isPositive=function(){return this.unsigned||this.high>=0};tt.isOdd=function(){return(this.low&1)==1};tt.isEven=function(){return(this.low&1)==0};tt.equals=function(e){return Js(e)||(e=Xa(e)),this.unsigned!==e.unsigned&&this.high>>>31==1&&e.high>>>31==1?!1:this.high===e.high&&this.low===e.low};tt.eq=tt.equals;tt.notEquals=function(e){return!this.eq(e)};tt.neq=tt.notEquals;tt.ne=tt.notEquals;tt.lessThan=function(e){return this.comp(e)<0};tt.lt=tt.lessThan;tt.lessThanOrEqual=function(e){return this.comp(e)<=0};tt.lte=tt.lessThanOrEqual;tt.le=tt.lessThanOrEqual;tt.greaterThan=function(e){return this.comp(e)>0};tt.gt=tt.greaterThan;tt.greaterThanOrEqual=function(e){return this.comp(e)>=0};tt.gte=tt.greaterThanOrEqual;tt.ge=tt.greaterThanOrEqual;tt.compare=function(e){if(Js(e)||(e=Xa(e)),this.eq(e))return 0;var n=this.isNegative(),r=e.isNegative();return n&&!r?-1:!n&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};tt.comp=tt.compare;tt.negate=function(){return!this.unsigned&&this.eq(Qs)?Qs:this.not().add(bm)};tt.neg=tt.negate;tt.add=function(e){Js(e)||(e=Xa(e));var n=this.high>>>16,r=this.high&65535,i=this.low>>>16,s=this.low&65535,o=e.high>>>16,a=e.high&65535,l=e.low>>>16,c=e.low&65535,u=0,h=0,f=0,d=0;return d+=s+c,f+=d>>>16,d&=65535,f+=i+l,h+=f>>>16,f&=65535,h+=r+a,u+=h>>>16,h&=65535,u+=n+o,u&=65535,vr(f<<16|d,u<<16|h,this.unsigned)};tt.subtract=function(e){return Js(e)||(e=Xa(e)),this.add(e.neg())};tt.sub=tt.subtract;tt.multiply=function(e){if(this.isZero())return la;if(Js(e)||(e=Xa(e)),oa){var n=oa.mul(this.low,this.high,e.low,e.high);return vr(n,oa.get_high(),this.unsigned)}if(e.isZero())return la;if(this.eq(Qs))return e.isOdd()?Qs:la;if(e.eq(Qs))return this.isOdd()?Qs:la;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(NB)&&e.lt(NB))return aa(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,i=this.high&65535,s=this.low>>>16,o=this.low&65535,a=e.high>>>16,l=e.high&65535,c=e.low>>>16,u=e.low&65535,h=0,f=0,d=0,p=0;return p+=o*u,d+=p>>>16,p&=65535,d+=s*u,f+=d>>>16,d&=65535,d+=o*c,f+=d>>>16,d&=65535,f+=i*u,h+=f>>>16,f&=65535,f+=s*c,h+=f>>>16,f&=65535,f+=o*l,h+=f>>>16,f&=65535,h+=r*u+i*c+s*l+o*a,h&=65535,vr(d<<16|p,h<<16|f,this.unsigned)};tt.mul=tt.multiply;tt.divide=function(e){if(Js(e)||(e=Xa(e)),e.isZero())throw Error("division by zero");if(oa){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?oa.div_u:oa.div_s)(this.low,this.high,e.low,e.high);return vr(n,oa.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?cf:la;var r,i,s;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return cf;if(e.gt(this.shru(1)))return $B;s=cf}else{if(this.eq(Qs)){if(e.eq(bm)||e.eq(MM))return Qs;if(e.eq(Qs))return bm;var o=this.shr(1);return r=o.div(e).shl(1),r.eq(la)?e.isNegative()?bm:MM:(i=this.sub(e.mul(r)),s=r.add(i.div(e)),s)}else if(e.eq(Qs))return this.unsigned?cf:la;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=la}for(i=this;i.gte(e);){r=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(r)/Math.LN2),l=a<=48?1:hS(2,a-48),c=aa(r),u=c.mul(e);u.isNegative()||u.gt(i);)r-=l,c=aa(r,this.unsigned),u=c.mul(e);c.isZero()&&(c=bm),s=s.add(c),i=i.sub(u)}return s};tt.div=tt.divide;tt.modulo=function(e){if(Js(e)||(e=Xa(e)),oa){var n=(this.unsigned?oa.rem_u:oa.rem_s)(this.low,this.high,e.low,e.high);return vr(n,oa.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};tt.mod=tt.modulo;tt.rem=tt.modulo;tt.not=function(){return vr(~this.low,~this.high,this.unsigned)};tt.and=function(e){return Js(e)||(e=Xa(e)),vr(this.low&e.low,this.high&e.high,this.unsigned)};tt.or=function(e){return Js(e)||(e=Xa(e)),vr(this.low|e.low,this.high|e.high,this.unsigned)};tt.xor=function(e){return Js(e)||(e=Xa(e)),vr(this.low^e.low,this.high^e.high,this.unsigned)};tt.shiftLeft=function(e){return Js(e)&&(e=e.toInt()),(e&=63)==0?this:e<32?vr(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):vr(0,this.low<<e-32,this.unsigned)};tt.shl=tt.shiftLeft;tt.shiftRight=function(e){return Js(e)&&(e=e.toInt()),(e&=63)==0?this:e<32?vr(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):vr(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};tt.shr=tt.shiftRight;tt.shiftRightUnsigned=function(e){if(Js(e)&&(e=e.toInt()),e&=63,e===0)return this;var n=this.high;if(e<32){var r=this.low;return vr(r>>>e|n<<32-e,n>>>e,this.unsigned)}else return e===32?vr(n,0,this.unsigned):vr(n>>>e-32,0,this.unsigned)};tt.shru=tt.shiftRightUnsigned;tt.shr_u=tt.shiftRightUnsigned;tt.toSigned=function(){return this.unsigned?vr(this.low,this.high,!1):this};tt.toUnsigned=function(){return this.unsigned?this:vr(this.low,this.high,!0)};tt.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};tt.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};tt.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};gr.fromBytes=function(e,n,r){return r?gr.fromBytesLE(e,n):gr.fromBytesBE(e,n)};gr.fromBytesLE=function(e,n){return new gr(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};gr.fromBytesBE=function(e,n){return new gr(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};var qse=Object.freeze(Ese({__proto__:null,[Symbol.toStringTag]:"Module",default:kM},[kM]));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uf=kM||qse;function M0(t){return uf.fromString(t,!0,16)}const PB=M0("c3a5c85c97cb3127"),hf=M0("b492b66fbe98f273"),fs=M0("9ae16a3b2f90404f");function IM(t){return t.xor(t.shru(47))}function OB(t,e,n){const r=t.slice(e,e+n);return uf.fromBytes(Array.from(r),!0,!0)}function fr(t,e){return OB(t,e,8)}function FB(t,e){return OB(t,e,4)}function ki(t,e){return e===0?t:t.shru(e).or(t.shl(64-e))}function Lu(t,e,n=M0("9ddfea08eb382d69")){let r=t.xor(e).mul(n);r=r.xor(r.shru(47));let i=e.xor(r).mul(n);return i=i.xor(i.shru(47)),i=i.mul(n),i}function Xse(t,e,n,r,i,s){i=i.add(t),s=ki(s.add(i).add(r),21);const o=i;return i=i.add(e),i=i.add(n),s=s.add(ki(i,44)),[i.add(r),s.add(o)]}function fS(t,e,n,r){return Xse(fr(t,e),fr(t,e+8),fr(t,e+16),fr(t,e+24),n,r)}function Kse(t,e=t.length){if(e>=8){const n=fs.add(e*2),r=fr(t,0).add(fs),i=fr(t,e-8),s=ki(i,37).mul(n).add(r),o=ki(r,25).add(i).mul(n);return Lu(s,o,n)}if(e>=4){const n=fs.add(e*2),r=FB(t,0);return Lu(r.shl(3).add(e),FB(t,e-4),n)}if(e>0){const n=t[0],r=t[e>>1],i=t[e-1],s=n+(r<<8),o=e+(i<<2);return IM(fs.mul(s).xor(PB.mul(o))).mul(fs)}return fs}function Yse(t,e=t.length){const n=fs.add(e*2),r=fr(t,0).mul(hf),i=fr(t,8),s=fr(t,e-8).mul(n),o=fr(t,e-16).mul(fs);return Lu(ki(r.add(i),43).add(ki(s,30)).add(o),r.add(ki(i.add(fs),18)).add(s),n)}function Zse(t,e=t.length){const n=fs.add(e*2),r=fr(t,0).mul(fs),i=fr(t,8),s=fr(t,e-8).mul(n),o=fr(t,e-16).mul(fs),a=ki(r.add(i),43).add(ki(s,30)).add(o),l=Lu(a,r.add(ki(i.add(fs),18)).add(s),n),c=fr(t,16).mul(n),u=fr(t,24),h=a.add(fr(t,e-32)).mul(n),f=l.add(fr(t,e-24)).mul(n);return Lu(ki(c.add(u),43).add(ki(h,30)).add(f),c.add(ki(u.add(r),18)).add(h),n)}function LB(t,e=t.length){const n=uf.fromNumber(81,!0);if(e<=32)return e<=16?Kse(t,e):Yse(t,e);if(e<=64)return Zse(t,e);let r=n,i=n.mul(hf).add(113),s=IM(i.mul(fs).add(113)).mul(fs),o=[uf.UZERO,uf.UZERO],a=[uf.UZERO,uf.UZERO];r=r.mul(fs).add(fr(t,0));let l=0;const c=(e-1>>6)*64,u=c+(e-1&63)-63;do r=ki(r.add(i).add(o[0]).add(fr(t,l+8)),37).mul(hf),i=ki(i.add(o[1]).add(fr(t,l+48)),42).mul(hf),r=r.xor(a[1]),i=i.add(o[0]).add(fr(t,l+40)),s=ki(s.add(a[0]),33).mul(hf),o=fS(t,l,o[1].mul(hf),r.add(a[0])),a=fS(t,l+32,s.add(a[1]),i.add(fr(t,l+16))),[s,r]=[r,s],l+=64;while(l!==c);const h=hf.add(s.and(255).shl(1));return l=u,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),r=ki(r.add(i).add(o[0]).add(fr(t,l+8)),37).mul(h),i=ki(i.add(o[1]).add(fr(t,l+48)),42).mul(h),r=r.xor(a[1].mul(9)),i=i.add(o[0].mul(9).add(fr(t,l+40))),s=ki(s.add(a[0]),33).mul(h),o=fS(t,l,o[1].mul(h),r.add(a[0])),a=fS(t,l+32,s.add(a[1]),i.add(fr(t,l+16))),[s,r]=[r,s],Lu(Lu(o[0],a[0],h).add(IM(i).mul(PB)).add(s),Lu(o[1],a[1],h).add(r),h)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dc(t,e){return e==="string"?Fl(t):Bu([t],e)}function Jse(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function Bu(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=$c(t)),Ce().getBool("DEBUG")&&mB(t,e),Jse(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){const n=new Uint8Array(t.length);for(let r=0;r<n.length;++r)Math.round(t[r])!==0&&(n[r]=1);return n}else throw new Error(`Unknown data type ${e}`)}function ds(){return Ce().platform.now()}function Qse(t,e){return Ce().platform.fetch(t,e)}function Fl(t,e="utf-8"){return e=e||"utf-8",Ce().platform.encode(t,e)}function ff(t,e="utf-8"){return e=e||"utf-8",Ce().platform.decode(t,e)}var eoe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",createScalarValue:Dc,toTypedArray:Bu,now:ds,fetch:Qse,encodeString:Fl,decodeString:ff,shuffle:pM,shuffleCombo:Mse,clamp:Ou,nearestLargerEven:mM,swap:Nc,sum:pB,randUniform:Ise,distSquared:Nse,assert:z,assertShapesMatch:zi,assertNonNull:rf,flatten:$c,sizeFromShape:_e,isScalarShape:$se,arraysEqual:wn,isInt:sf,tanh:Rse,sizeToSquarishShape:n_,createShuffledIndices:Dse,rightPad:of,repeatedTry:gM,inferFromImplicitShape:vM,parseAxisParam:hn,squeezeShape:Rc,getTypedArrayFromDType:fi,getArrayFromDType:hs,checkConversionForErrors:mB,isValidDtype:gB,hasEncodingLoss:yM,isTypedArray:Qi,bytesPerElement:r_,bytesFromStringArray:vB,isString:Ol,isBoolean:yB,isNumber:i_,inferDtype:bp,isFunction:Fu,nearestDivisor:s_,computeStrides:Rt,toNestedArray:Eo,makeOnesTypedArray:bM,makeZerosTypedArray:Vi,makeZerosNestedTypedArray:wM,assertNonNegativeIntegerDimensions:xM,locToIndex:qa,indexToLoc:wp,isPromise:xp,hexToLong:M0,fingerPrint64:LB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class toe{constructor(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new roe)}profileKernel(e,n,r){let i;const s=()=>{i=r()};let o;const a=ds();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(s);else{s();for(const c of i)c.dataSync();o=Promise.resolve({kernelMs:ds()-a})}if(Ce().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<i.length;c++){const u=i[c];u.data().then(h=>{noe(h,u.dtype,e)})}return{kernelName:e,outputs:i,inputs:n,timeMs:o.then(c=>c.kernelMs),extraInfo:o.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:n,outputs:r,timeMs:i,inputs:s,extraInfo:o}=e;r.forEach(a=>{Promise.all([a.data(),i,o]).then(l=>{this.logger.logKernelProfile(n,a,l[0],l[1],s,l[2])})})}}function noe(t,e,n){if(e!=="float32")return!1;for(let r=0;r<t.length;r++){const i=t[r];if(isNaN(i)||!isFinite(i))return console.warn(`Found ${i} in the result of '${n}'`),!0}return!1}class roe{logKernelProfile(e,n,r,i,s,o){const a=typeof i=="number"?of(`${i}ms`,9):i.error,l=of(e,25),c=n.rank,u=n.size,h=of(n.shape.toString(),14);let f="";for(const d in s){const p=s[d];if(p!=null){const m=p.shape||n.shape,v=m.length;f+=`${d}: ${v}D ${v>0?m:""} `}}console.log(`%c${l}	%c${a}	%c${c}D ${h}	%c${u}	%c${f}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ioe(t,e,n){const r={},i={};for(let l=0;l<e.length;l++)r[e[l].id]=!0;for(let l=0;l<t.length;l++){const c=t[l],u=c.inputs;for(const h in u){const f=u[h];let d=!1;for(let p=0;p<e.length;p++)if(r[f.id]){c.outputs.forEach(m=>r[m.id]=!0),d=!0,i[c.id]=!0;break}if(d)break}}const s={};s[n.id]=!0;const o={};for(let l=t.length-1;l>=0;l--){const c=t[l],u=c.inputs;for(let h=0;h<c.outputs.length;h++)if(s[c.outputs[h].id]){for(const f in u)s[u[f].id]=!0,o[c.id]=!0;break}}const a=[];for(let l=0;l<t.length;l++){const c=t[l];if(i[c.id]&&o[c.id]){const u={};for(const f in c.inputs){const d=c.inputs[f];r[d.id]&&(u[f]=d)}const h=Object.assign({},c);h.inputs=u,h.outputs=c.outputs,a.push(h)}}return a}function soe(t,e,n,r){for(let i=e.length-1;i>=0;i--){const s=e[i],o=[];if(s.outputs.forEach(l=>{const c=t[l.id];c!=null?o.push(c):o.push(null)}),s.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);const a=s.gradient(o);for(const l in s.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const c=n(()=>a[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);const u=s.inputs[l];if(!wn(c.shape,u.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${u.shape}'`);if(t[u.id]==null)t[u.id]=c;else{const h=t[u.id];t[u.id]=r(h,c),h.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BB=20,I0=3,NM=7;function ooe(t,e,n,r){const i=Rt(e),s=aoe(t,e,n,i),o=e.length,a=dS(t,e,n,i,s),l=["Tensor"];return r&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(c=>"    "+c).join(`
`)),l.join(`
`)}function aoe(t,e,n,r){const i=_e(e),s=r[r.length-1],o=new Array(s).fill(0),a=e.length,l=n==="complex64"?$0(t):t;if(a>1)for(let c=0;c<i/s;c++){const u=c*s;for(let h=0;h<s;h++)o[h]=Math.max(o[h],N0(l[u+h],0,n).length)}return o}function N0(t,e,n){let r;return Array.isArray(t)?r=`${parseFloat(t[0].toFixed(NM))} + ${parseFloat(t[1].toFixed(NM))}j`:Ol(t)?r=`'${t}'`:n==="bool"?r=zB(t):r=parseFloat(t.toFixed(NM)).toString(),of(r,e)}function zB(t){return t===0?"false":"true"}function dS(t,e,n,r,i,s=!0){const o=n==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(n==="complex64"){const m=$0(t);return[N0(m[0],0,n)]}return n==="bool"?[zB(t[0])]:[t[0].toString()]}if(l===1){if(a>BB){const v=I0*o;let y=Array.from(t.slice(0,v)),w=Array.from(t.slice((a-I0)*o,a*o));return n==="complex64"&&(y=$0(y),w=$0(w)),["["+y.map((x,_)=>N0(x,i[_],n)).join(", ")+", ..., "+w.map((x,_)=>N0(x,i[a-I0+_],n)).join(", ")+"]"]}const m=n==="complex64"?$0(t):Array.from(t);return["["+m.map((v,y)=>N0(v,i[y],n)).join(", ")+"]"]}const c=e.slice(1),u=r.slice(1),h=r[0]*o,f=[];if(a>BB){for(let m=0;m<I0;m++){const v=m*h,y=v+h;f.push(...dS(t.slice(v,y),c,n,u,i,!1))}f.push("...");for(let m=a-I0;m<a;m++){const v=m*h,y=v+h;f.push(...dS(t.slice(v,y),c,n,u,i,m===a-1))}}else for(let m=0;m<a;m++){const v=m*h,y=v+h;f.push(...dS(t.slice(v,y),c,n,u,i,m===a-1))}const d=l===2?",":"";f[0]="["+f[0]+d;for(let m=1;m<f.length-1;m++)f[m]=" "+f[m]+d;let p=`,
`;for(let m=2;m<l;m++)p+=`
`;return f[f.length-1]=" "+f[f.length-1]+"]"+(s?"":p),f}function $0(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class di{constructor(e,n,r){if(this.dtype=n,this.shape=e.slice(),this.size=_e(e),r!=null){const i=r.length;z(i===this.size,()=>`Length of values '${i}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||hs(n,this.size),this.strides=Rt(e)}set(e,...n){n.length===0&&(n=[0]),z(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const r=this.locToIndex(n);this.values[r]=e}get(...e){e.length===0&&(e=[0]);let n=0;for(const i of e){if(i<0||i>=this.shape[n]){const s=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(s)}n++}let r=e[e.length-1];for(let i=0;i<e.length-1;++i)r+=this.strides[i]*e[i];return this.values[r]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let n=e[e.length-1];for(let r=0;r<e.length-1;++r)n+=this.strides[r]*e[r];return n}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const n=new Array(this.shape.length);for(let r=0;r<n.length-1;++r)n[r]=Math.floor(e/this.strides[r]),e-=n[r]*this.strides[r];return n[n.length-1]=e,n}get rank(){return this.shape.length}toTensor(){return Ka().makeTensor(this.values,this.shape,this.dtype)}}let Ka=null,wm=null;function loe(t){Ka=t}function coe(t){wm=t}class Qn{constructor(e,n,r,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=_e(e),this.strides=Rt(e),this.dataId=r,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return wm.buffer(this.shape,this.dtype,e)}bufferSync(){return wm.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Eo(this.shape,e,this.dtype==="complex64")}arraySync(){return Eo(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=Ka().read(this.dataId);if(this.dtype==="string"){const n=await e;try{return n.map(r=>ff(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Ka().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Ka().readSync(this.dataId);if(this.dtype==="string")try{return e.map(n=>ff(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Ka().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(Ka().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return wm.print(this,e)}clone(){return this.throwIfDisposed(),wm.clone(this)}toString(e=!1){const n=this.dataSync();return ooe(n,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),wm.cast(this,e)}variable(e=!0,n,r){return this.throwIfDisposed(),Ka().makeVariable(this,e,n,r)}}Object.defineProperty(Qn,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function uoe(){return CM("Tensor",()=>Qn)}uoe();class R0 extends Qn{constructor(e,n,r,i){super(e.shape,e.dtype,e.dataId,i);this.trainable=n,this.name=r}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!wn(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Ka().disposeTensor(this),this.dataId=e.dataId,Ka().incRef(this,null)}dispose(){Ka().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(R0,Symbol.hasInstance,{value:t=>t instanceof Qn&&t.assign!=null&&t.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var $M;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})($M||($M={}));var RM;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(RM||(RM={}));var DM;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})(DM||(DM={}));var PM;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(PM||(PM={}));var OM;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(OM||(OM={}));const hoe={float32:PM,int32:RM,bool:DM,complex64:OM};function eo(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return hoe[t][e]}function pS(t){return eo(t,"int32")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ir(t,e){if(t.dtype===e.dtype)return[t,e];const n=eo(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function VB(t,e){z(t.dtype===e.dtype,()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`)}function foe(t,e){return e.some(n=>n.id===t.id)}function FM(t){const e=[],n=new Set;return UB(t,e,n),e}function UB(t,e,n){if(t==null)return;if(t instanceof Qn){e.push(t);return}if(!doe(t))return;const r=t;for(const i in r){const s=r[i];n.has(s)||(n.add(s),UB(s,e,n))}}function doe(t){return Array.isArray(t)||typeof t=="object"}var poe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",makeTypesMatch:Ir,assertTypesMatch:VB,isTensorInList:foe,getTensorsInContainer:FM});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LM(t){return t.kernelName!=null}class WB{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class xm{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new WB}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const r=e[n];if(await this.initializeBackend(r).success){await this.setBackend(r);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:n}=this.initializeBackend(e);if(n)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,n,r=1){return e in this.registryFactory?(ko(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:n,priority:r},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:n,asyncInit:r}=this.initializeBackend(e);if(!(r?await n:n))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new toe(this.backendInstance),!0}setupRegisteredKernels(){cS(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){cS(e).forEach(r=>{r.disposeFunc!=null&&r.disposeFunc(this.registry[e])})}initializeBackend(e){const n=this.registryFactory[e];if(n==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const r=n.factory();if(r&&!(r instanceof t_)&&typeof r.then=="function"){const i=++this.pendingBackendInitId,s=r.then(o=>i<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(i<this.pendingBackendInitId||(this.pendingBackendInit=null,ko(`Initialization of backend ${e} failed`),ko(o.stack||o.message)),!1));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}else return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(r){return ko(`Initialization of backend ${e} failed`),ko(r.stack||r.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,n)=>this.registryFactory[n].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const r=e[n],{success:i,asyncInit:s}=this.initializeBackend(r);if(s||i)return{name:r,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,n){const r=this.state.tensorInfo.get(n),i=r.backend,s=this.readSync(n),o=i.refCount(n);i.disposeData(n,!0),r.backend=e,e.move(n,s,r.shape,r.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,n){let r=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}let i;return this.scopedRun(()=>this.startScope(r),()=>this.endScope(i),()=>(i=n(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i))}scopedRun(e,n,r){e();try{const i=r();return n(),i}catch(i){throw n(),i}}nextTensorId(){return xm.nextTensorId++}nextVariableId(){return xm.nextVariableId++}clone(e){const n=Q.runKernel(Up,{x:e}),r={x:e},i=o=>({x:()=>{const a="float32",l={x:o},c={dtype:a};return Q.runKernel(Mp,l,c)}}),s=[];return this.addTapeNode(this.state.activeScope.name,r,[n],i,s,{}),n}runKernel(e,n,r){if(this.backendName==null&&this.backend,!(lS(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:n,attrs:r})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,n,r){const i=this.backend.numDataIds();let s=0;r.forEach(l=>{s+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=i-n-s-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let n,r=[];const i=this.isTapeOn(),s=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const c=LM(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(LM(e)){const{kernelName:p,inputs:m,attrs:v}=e;this.backendName==null&&this.backend;const y=lS(p,this.backendName);z(y!=null,()=>`Cannot find registered kernel '${p}' for backend '${this.backendName}'`),a=()=>{const w=this.backend.numDataIds();l=y.kernelFunc({inputs:m,attrs:v,backend:this.backend});const x=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(p,w,x);const _=x.map(S=>{if(S.rank!=null)return S;const{dataId:T,shape:E,dtype:k}=S;return this.makeTensorFromDataId(T,E,k)});if(i){const S=this.getTensorsForGradient(p,m,_);r=this.saveTensorsForBackwardMode(S)}return _}}else{const{forwardFunc:p}=e,m=v=>{!i||(r=v.map(y=>this.keep(this.clone(y))))};a=()=>{const v=this.backend.numDataIds();l=this.tidy(()=>p(this.backend,m));const y=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,v,y),y}}const{inputs:u,attrs:h}=e,f=LM(e)?null:e.backwardsFunc;let d;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(d=this.profiler.profileKernel(c,u,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(d),n=d.outputs)}),i&&this.addTapeNode(c,u,n,f,r,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(u).map(p=>u[p]!=null?u[p].shape:null),outputShapes:n.map(p=>p.shape),kernelTimeMs:d.timeMs,extraInfo:d.extraInfo}),Array.isArray(l)?n:n[0]}saveTensorsForBackwardMode(e){return e.map(r=>this.keep(this.clone(r)))}getTensorsForGradient(e,n,r){const i=TM(e);if(i!=null){const s=i.inputsToSave||[],o=i.outputsToSave||[];let a;i.saveAllInputs?(z(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(c=>n[c])):a=s.map(c=>n[c]);const l=r.filter((c,u)=>o[u]);return a.concat(l)}return[]}makeTensor(e,n,r,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",i=i||this.backend;let s=e;r==="string"&&Ol(e[0])&&(s=e.map(l=>Fl(l)));const o=i.write(s,n,r),a=new Qn(n,r,o,this.nextTensorId());if(this.trackTensor(a,i),r==="string"){const l=this.state.tensorInfo.get(o),c=vB(s);this.state.numBytes+=c-l.bytes,l.bytes=c}return a}makeTensorFromDataId(e,n,r,i){r=r||"float32";const s=new Qn(n,r,e,this.nextTensorId());return this.trackTensor(s,i),s}makeVariable(e,n=!0,r,i){r=r||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.cast(i));const s=new R0(e,n,r,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(e,n){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*r_(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof R0||this.track(e)}incRef(e,n){this.trackTensor(e,n),this.backend.incRef(e.dataId)}removeDataId(e,n){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===n&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const n=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const r=e.size*r_(e.dtype);this.state.numBytes-=r}n.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,n.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const n=this.state.registeredVariables[e];this.disposeVariable(n)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const n=this.state.numBytes,r=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(i=>i.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r;for(const i of this.state.activeProfile.kernels)i.kernelTimeMs=await i.kernelTimeMs,i.extraInfo=await i.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,n,r,i,s,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:r,saved:s},l=TM(e);l!=null&&(i=l.gradFunc),i!=null&&(a.gradient=c=>(c=c.map((u,h)=>{if(u==null){const f=r[h],d=Vi(f.size,f.dtype);return this.makeTensor(d,f.shape,f.dtype)}return u}),i(c.length>1?c:c[0],s,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(e){const n=FM(e),r=new Set(n.map(s=>s.id));for(let s=0;s<this.state.activeScope.track.length;s++){const o=this.state.activeScope.track[s];!o.kept&&!r.has(o.id)&&o.dispose()}const i=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(s=>{!s.kept&&s.scopeId===i.id&&this.track(s)})}gradients(e,n,r,i=!1){if(z(n.length>0,()=>"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${r.dtype}'`);const s=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));z(s instanceof Qn,()=>"The result y returned by f() must be a tensor.");const o=ioe(this.state.activeTape,n,s);if(!i&&o.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[s.id]=r==null?moe(s.shape):r,soe(a,o,c=>this.tidy(c),goe);const l=n.map(c=>a[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(const u of c.saved)u.dispose()}),this.state.activeTape=null),{value:s,grads:l}})}customGrad(e){return z(Fu(e),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{z(n.every(a=>a instanceof Qn),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let r;const i={};n.forEach((a,l)=>{i[l]=a});const s=(a,l)=>(r=e(...n,l),z(r.value instanceof Qn,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),z(Fu(r.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r.value),o=(a,l)=>{const c=r.gradFunc(a,l),u=Array.isArray(c)?c:[c];z(u.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),z(u.every(f=>f instanceof Qn),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const h={};return u.forEach((f,d)=>{h[d]=()=>f}),h};return this.runKernelFunc({forwardFunc:s,backwardsFunc:o,inputs:i})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,n){return this.state.tensorInfo.get(e).backend.readToGPU(e,n)}async time(e){const n=ds(),r=await this.backend.time(e);return r.wallMs=ds()-n,r}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new WB;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}xm.nextTensorId=0;xm.nextVariableId=0;function moe(t){const e=bM(_e(t),"float32");return Q.makeTensor(e,t,"float32")}function GB(){const t=_B();if(t._tfengine==null){const e=new xB(t);t._tfengine=new xm(e)}return Lse(t._tfengine.ENV),loe(()=>t._tfengine),t._tfengine}const Q=GB();function goe(t,e){const n={a:t,b:e};return Q.runKernel(af,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function voe(){return typeof navigator!="undefined"&&navigator!=null}let BM;function yoe(t){BM=t}function zM(t){if(BM!==void 0)return BM;if(t||voe()){if(t||(t=navigator),t.product==="ReactNative")return!0;const e=t.userAgent||t.vendor||(typeof window!="undefined"?window.opera:"");if(!e){const n=t;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function VM(){return typeof window!="undefined"&&window.document!=null||typeof WorkerGlobalScope!="undefined"}var boe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",mockIsMobile:yoe,isMobile:zM,isBrowser:VM});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ya=Ce();Ya.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Ya.registerFlag("IS_BROWSER",()=>VM());Ya.registerFlag("IS_NODE",()=>typeof process!="undefined"&&typeof process.versions!="undefined"&&typeof process.versions.node!="undefined");Ya.registerFlag("IS_CHROME",()=>typeof navigator!="undefined"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Ya.registerFlag("PROD",()=>!1);Ya.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Ya.getBool("DEBUG"));Ya.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Ya.registerFlag("IS_TEST",()=>!1);Ya.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0);Ya.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ll(t,e){let n=t;if(Qi(t))return e==="string"?[]:[t.length];if(!Array.isArray(t))return[];const r=[];for(;Array.isArray(n)||Qi(n)&&e!=="string";)r.push(n.length),n=n[0];return Array.isArray(t)&&Ce().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&HB(t,r,[]),r}function HB(t,e,n){if(n=n||[],!Array.isArray(t)&&!Qi(t)){z(e.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}z(e.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`),z(t.length===e[0],()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);const r=e.slice(1);for(let i=0;i<t.length;++i)HB(t[i],r,n.concat(i))}function jB(t,e,n,r){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${n}' passed to '${r}' must be ${t} tensor, but got ${e} tensor`)}}function U(t,e,n,r="numeric"){if(t instanceof Qn)return jB(r,t.dtype,e,n),t;let i=bp(t);if(i!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),jB(r,i,e,n),t==null||!Qi(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){const l=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${l}'`)}const s=Ll(t,i);!Qi(t)&&!Array.isArray(t)&&(t=[t]);const a=i!=="string"?Bu(t,i):$c(t,[],!0);return Q.makeTensor(a,s,i)}function D0(t,e,n,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((s,o)=>U(s,`${e}[${o}]`,n,r))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qB="__op";function te(t){const e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+qB;const i=(...s)=>{Q.startScope(n);try{const o=r(...s);return xp(o)&&console.error("Cannot return a Promise inside of tidy."),Q.endScope(o),o}catch(o){throw Q.endScope(null),o}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function woe(t,e){const n=U(t,"real","complex"),r=U(e,"imag","complex");zi(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);const i={real:n,imag:r};return Q.runKernel(f_,i)}const zu=te({complex_:woe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vu(t,e,n,r){if(r==null&&(r=bp(t)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Qi(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){xM(e);const i=_e(e),s=_e(n);z(i===s,()=>`Based on the provided shape, [${e}], the tensor should have ${i} values but has ${s}`);for(let o=0;o<n.length;++o){const a=n[o],l=o===n.length-1?a!==_e(e.slice(o)):!0;z(n[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `)}}return!Qi(t)&&!Array.isArray(t)&&(t=[t]),e=e||n,t=r!=="string"?Bu(t,r):$c(t,[],!0),Q.makeTensor(t,e,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function to(t,e,n){const r=Ll(t,n);return Vu(t,e,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UM={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mS=4;async function WM(t,e){const n=[],r=[],i=Array.isArray(t)?t.map(o=>o.name):Object.keys(t);for(let o=0;o<i.length;++o){const a=i[o],l=Array.isArray(t)?t[o].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const c={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const u=new Promise(async h=>{const f=await l.bytes(),d=f.reduce((v,y)=>v+y.length,0)+mS*f.length,p=new Uint8Array(d);let m=0;for(let v=0;v<f.length;v++){const y=f[v],w=new Uint8Array(new Uint32Array([y.length]).buffer);p.set(w,m),m+=mS,p.set(y,m),m+=y.length}h(p)});r.push(u)}else r.push(l.data());e!=null&&(c.group=e),n.push(c)}const s=await Promise.all(r);return{data:xoe(s),specs:n}}function gS(t,e){const n={};let r,i=0;for(const s of e){const o=s.name,a=s.dtype,l=s.shape,c=_e(l);let u;if("quantization"in s){const h=s.quantization;if(h.dtype==="uint8"||h.dtype==="uint16"){if(!("min"in h&&"scale"in h))throw new Error(`Weight ${s.name} with quantization ${h.dtype} doesn't have corresponding metadata min and scale.`)}else if(h.dtype==="float16"){if(a!=="float32")throw new Error(`Weight ${s.name} is quantized with ${h.dtype} which only supports weights of type float32 not ${a}.`)}else throw new Error(`Weight ${s.name} has unknown quantization dtype ${h.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const f=UM[h.dtype],d=t.slice(i,i+c*f),p=h.dtype==="uint8"?new Uint8Array(d):new Uint16Array(d);if(a==="float32")if(h.dtype==="uint8"||h.dtype==="uint16"){u=new Float32Array(p.length);for(let m=0;m<p.length;m++){const v=p[m];u[m]=v*h.scale+h.min}}else if(h.dtype==="float16")r===void 0&&(r=koe()),u=r(p);else throw new Error(`Unsupported quantization type ${h.dtype} for weight type float32.`);else if(a==="int32"){if(h.dtype!=="uint8"&&h.dtype!=="uint16")throw new Error(`Unsupported quantization type ${h.dtype} for weight type int32.`);u=new Int32Array(p.length);for(let m=0;m<p.length;m++){const v=p[m];u[m]=Math.round(v*h.scale+h.min)}}else throw new Error(`Unsupported dtype in weight '${o}': ${a}`);i+=c*f}else if(a==="string"){const h=_e(s.shape);u=[];for(let f=0;f<h;f++){const d=new Uint32Array(t.slice(i,i+mS))[0];i+=mS;const p=new Uint8Array(t.slice(i,i+d));u.push(p),i+=d}}else{const h=UM[a],f=t.slice(i,i+c*h);if(a==="float32")u=new Float32Array(f);else if(a==="int32")u=new Int32Array(f);else if(a==="bool")u=new Uint8Array(f);else if(a==="complex64"){u=new Float32Array(f);const d=new Float32Array(u.length/2),p=new Float32Array(u.length/2);for(let y=0;y<d.length;y++)d[y]=u[y*2],p[y]=u[y*2+1];const m=to(d,l,"float32"),v=to(p,l,"float32");n[o]=zu(m,v),m.dispose(),v.dispose()}else throw new Error(`Unsupported dtype in weight '${o}': ${a}`);i+=c*h}a!=="complex64"&&(n[o]=to(u,l,a))}return n}function xoe(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach(s=>{if(e+=s.byteLength,n.push(s.byteLength===s.buffer.byteLength?s:new s.constructor(s)),!(s instanceof Float32Array||s instanceof Int32Array||s instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${s.constructor.name}`)});const r=new Uint8Array(e);let i=0;return n.forEach(s=>{r.set(new Uint8Array(s.buffer),i),i+=s.byteLength}),r.buffer}const GM=typeof Buffer!="undefined"&&(typeof Blob=="undefined"||typeof atob=="undefined"||typeof btoa=="undefined");function XB(t){return GM?Buffer.byteLength(t):new Blob([t]).size}function _oe(t){if(GM)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let r=0,i=e.length;r<i;r++)n+=String.fromCharCode(e[r]);return btoa(n)}function Soe(t){if(GM){const r=Buffer.from(t,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let r=0;r<e.length;++r)n.set([e.charCodeAt(r)],r);return n.buffer}function vS(t){if(t.length===1)return t[0];let e=0;t.forEach(i=>{e+=i.byteLength});const n=new Uint8Array(e);let r=0;return t.forEach(i=>{n.set(new Uint8Array(i),r),r+=i.byteLength}),n.buffer}function KB(t){const e="/";for(t=t.trim();t.endsWith(e);)t=t.slice(0,t.length-1);const n=t.split(e);return n[n.length-1]}function YB(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return t.signature!=null&&(n.signature=t.signature),t.userDefinedMetadata!=null&&(n.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(n.modelInitializer=t.modelInitializer),t.trainingConfig!=null&&(n.trainingConfig=t.trainingConfig),n}async function HM(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(t.trainingConfig!=null&&(n.trainingConfig=t.trainingConfig),t.weightsManifest!=null){const[r,i]=await e(t.weightsManifest);n.weightSpecs=r,n.weightData=i}return t.signature!=null&&(n.signature=t.signature),t.userDefinedMetadata!=null&&(n.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(n.modelInitializer=t.modelInitializer),n}function P0(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:XB(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:XB(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:t.weightData.byteLength}}function Coe(){const t=n=>{let r=n<<13,i=0;for(;(r&8388608)==0;)i-=8388608,r<<=1;return r&=~8388608,i+=947912704,r|i},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let n=1024;n<2048;n++)e[n]=939524096+(n-1024<<13);return e}function Toe(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}function Eoe(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}function koe(){const t=Coe(),e=Toe(),n=Eoe();return r=>{const i=new ArrayBuffer(4*r.length),s=new Uint32Array(i);for(let o=0;o<r.length;o++){const a=r[o],l=t[n[a>>10]+(a&1023)]+e[a>>10];s[o]=l}return new Float32Array(i)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nr{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Nr.instance==null&&(Nr.instance=new Nr),Nr.instance}static registerSaveRouter(e){Nr.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Nr.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Nr.getHandlers(e,"save")}static getLoadHandlers(e,n){return Nr.getHandlers(e,"load",n)}static getHandlers(e,n,r){const i=[];return(n==="load"?Nr.getInstance().loadRouters:Nr.getInstance().saveRouters).forEach(o=>{const a=o(e,r);a!==null&&i.push(a)}),i}}const Aoe=t=>Nr.registerSaveRouter(t),Moe=t=>Nr.registerLoadRouter(t),jM=t=>Nr.getSaveHandlers(t),qM=(t,e)=>Nr.getLoadHandlers(t,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XM="tensorflowjs",KM=1,df="models_store",Uu="model_info_store";function ZB(){if(!Ce().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t=typeof window=="undefined"?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function YM(t){const e=t.result;e.createObjectStore(df,{keyPath:"modelPath"}),e.createObjectStore(Uu,{keyPath:"modelPath"})}class pf{constructor(e){if(this.indexedDB=ZB(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,n){return new Promise((r,i)=>{const s=this.indexedDB.open(XM,KM);s.onupgradeneeded=()=>YM(s),s.onsuccess=()=>{const o=s.result;if(n==null){const a=o.transaction(df,"readonly"),c=a.objectStore(df).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return o.close(),i(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));r(c.result.modelArtifacts)},c.onerror=u=>(o.close(),i(c.error)),a.oncomplete=()=>o.close()}else{const a=P0(n),l=o.transaction(Uu,"readwrite");let c=l.objectStore(Uu);const u=c.put({modelPath:this.modelPath,modelArtifactsInfo:a});let h;u.onsuccess=()=>{h=o.transaction(df,"readwrite");const d=h.objectStore(df).put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:a});d.onsuccess=()=>r({modelArtifactsInfo:a}),d.onerror=p=>{c=l.objectStore(Uu);const m=c.delete(this.modelPath);m.onsuccess=()=>(o.close(),i(d.error)),m.onerror=v=>(o.close(),i(d.error))}},u.onerror=f=>(o.close(),i(u.error)),l.oncomplete=()=>{h==null?o.close():h.oncomplete=()=>o.close()}}},s.onerror=o=>i(s.error)})}}pf.URL_SCHEME="indexeddb://";const JB=t=>Ce().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(pf.URL_SCHEME)?Ioe(t.slice(pf.URL_SCHEME.length)):null;Nr.registerSaveRouter(JB);Nr.registerLoadRouter(JB);function Ioe(t){return new pf(t)}function Noe(t){return t.startsWith(pf.URL_SCHEME)?t.slice(pf.URL_SCHEME.length):t}class $oe{constructor(){this.indexedDB=ZB()}async listModels(){return new Promise((e,n)=>{const r=this.indexedDB.open(XM,KM);r.onupgradeneeded=()=>YM(r),r.onsuccess=()=>{const i=r.result,s=i.transaction(Uu,"readonly"),a=s.objectStore(Uu).getAll();a.onsuccess=()=>{const l={};for(const c of a.result)l[c.modelPath]=c.modelArtifactsInfo;e(l)},a.onerror=l=>(i.close(),n(a.error)),s.oncomplete=()=>i.close()},r.onerror=i=>n(r.error)})}async removeModel(e){return e=Noe(e),new Promise((n,r)=>{const i=this.indexedDB.open(XM,KM);i.onupgradeneeded=()=>YM(i),i.onsuccess=()=>{const s=i.result,o=s.transaction(Uu,"readwrite"),a=o.objectStore(Uu),l=a.get(e);let c;l.onsuccess=()=>{if(l.result==null)return s.close(),r(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const u=a.delete(e),h=()=>{c=s.transaction(df,"readwrite");const d=c.objectStore(df).delete(e);d.onsuccess=()=>n(l.result.modelArtifactsInfo),d.onerror=p=>r(l.error)};u.onsuccess=h,u.onerror=f=>(h(),s.close(),r(l.error))}},l.onerror=u=>(s.close(),r(l.error)),o.oncomplete=()=>{c==null?s.close():c.oncomplete=()=>s.close()}},i.onerror=s=>r(i.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pc="/",_m="tensorflowjs_models",QB="info",Roe="model_topology",Doe="weight_specs",Poe="weight_data",Ooe="model_metadata";function ez(t){return{info:[_m,t,QB].join(Pc),topology:[_m,t,Roe].join(Pc),weightSpecs:[_m,t,Doe].join(Pc),weightData:[_m,t,Poe].join(Pc),modelMetadata:[_m,t,Ooe].join(Pc)}}function tz(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function Foe(t){const e=t.split(Pc);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(Pc)}function Loe(t){return t.startsWith(mf.URL_SCHEME)?t.slice(mf.URL_SCHEME.length):t}class mf{constructor(e){if(!Ce().getBool("IS_BROWSER")||typeof window=="undefined"||typeof window.localStorage=="undefined")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=ez(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),i=P0(e);try{this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,_oe(e.weightData));const s={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:i}}catch{throw tz(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${i.modelTopologyBytes}, weightSpecsBytes=${i.weightSpecsBytes}, weightDataBytes=${i.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},r=JSON.parse(this.LS.getItem(this.keys.topology));if(r==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=r;const i=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(i==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=i;const s=this.LS.getItem(this.keys.modelMetadata);if(s!=null){const a=JSON.parse(s);n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,a.signature!=null&&(n.signature=a.signature),a.userDefinedMetadata!=null&&(n.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(n.modelInitializer=a.modelInitializer),a.trainingConfig!=null&&(n.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=Soe(o),n}}mf.URL_SCHEME="localstorage://";const nz=t=>Ce().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(mf.URL_SCHEME)?Boe(t.slice(mf.URL_SCHEME.length)):null;Nr.registerSaveRouter(nz);Nr.registerLoadRouter(nz);function Boe(t){return new mf(t)}class zoe{constructor(){z(Ce().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),z(typeof window=="undefined"||typeof window.localStorage!="undefined",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},n=_m+Pc,r=Pc+QB;for(let i=0;i<this.LS.length;++i){const s=this.LS.key(i);if(s.startsWith(n)&&s.endsWith(r)){const o=Foe(s);e[o]=JSON.parse(this.LS.getItem(s))}}return e}async removeModel(e){e=Loe(e);const n=ez(e);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${e}'`);const r=JSON.parse(this.LS.getItem(n.info));return tz(n),r}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sm="://";class no{constructor(){this.managers={}}static getInstance(){return no.instance==null&&(no.instance=new no),no.instance}static registerManager(e,n){z(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(Sm)&&(e=e.slice(0,e.indexOf(Sm))),z(e.length>0,()=>"scheme must not be an empty string.");const r=no.getInstance();z(r.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),r.managers[e]=n}static getManager(e){const n=this.getInstance().managers[e];if(n==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return n}static getSchemes(){return Object.keys(this.getInstance().managers)}}function yS(t){if(t.indexOf(Sm)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${no.getSchemes().join(",")}`);return{scheme:t.split(Sm)[0],path:t.split(Sm)[1]}}async function rz(t,e,n=!1){z(t!==e,()=>`Old path and new path are the same: '${t}'`);const r=Nr.getLoadHandlers(t);z(r.length>0,()=>`Copying failed because no load handler is found for source URL ${t}.`),z(r.length<2,()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${t}.`);const i=r[0],s=Nr.getSaveHandlers(e);z(s.length>0,()=>`Copying failed because no save handler is found for destination URL ${e}.`),z(s.length<2,()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${e}.`);const o=s[0],a=yS(t).scheme,l=yS(t).path,c=a===yS(t).scheme,u=await i.load();n&&c&&await no.getManager(a).removeModel(l);const h=await o.save(u);return n&&!c&&await no.getManager(a).removeModel(l),h.modelArtifactsInfo}async function ZM(){const t=no.getSchemes(),e={};for(const n of t){const r=await no.getManager(n).listModels();for(const i in r){const s=n+Sm+i;e[s]=r[i]}}return e}async function JM(t){const e=yS(t);return no.getManager(e.scheme).removeModel(e.path)}async function Voe(t,e){return rz(t,e,!1)}async function Uoe(t,e){return rz(t,e,!0)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Woe{fetch(e,n){return fetch(e,n)}now(){return performance.now()}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,n){return new TextDecoder(n).decode(e)}}if(Ce().get("IS_BROWSER")){Ce().setPlatform("browser",new Woe);try{no.registerManager(mf.URL_SCHEME,new zoe)}catch{}try{no.registerManager(pf.URL_SCHEME,new $oe)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Goe={importFetch:()=>require("node-fetch")};let QM;class Hoe{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,n){return Ce().global.fetch!=null?Ce().global.fetch(e,n):(QM==null&&(QM=Goe.importFetch()),QM(e,n))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(e)}decode(e,n){return e.length===0?"":new this.util.TextDecoder(n).decode(e)}}Ce().get("IS_NODE")&&Ce().setPlatform("node",new Hoe);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mn(t,e="float32",n){return e=e||"float32",xM(t),new di(t,e,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function joe(t,e){const n=U(t,"x","cast");if(!gB(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const r={x:n},i={dtype:e};return Q.runKernel(Mp,r,i)}const Qe=te({cast_:joe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qoe(t){const n={x:U(t,"x","clone","string_or_numeric")};return Q.runKernel(Up,n)}const Oc=te({clone_:qoe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iz(t,e=!1){console.log(t.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */GB();const Xoe={buffer:mn,cast:Qe,clone:Oc,print:iz};coe(Xoe);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Koe="model",Yoe=".json",Zoe=".weights.bin";function sz(t){return new Promise(e=>setTimeout(e)).then(t)}class gf{constructor(e){if(!Ce().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(gf.URL_SCHEME)&&(e=e.slice(gf.URL_SCHEME.length)),(e==null||e.length===0)&&(e=Koe),this.modelJsonFileName=e+Yoe,this.weightDataFileName=e+Zoe}async save(e){if(typeof document=="undefined")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const n=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i=YB(e,r),s=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),o=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(o.download=this.modelJsonFileName,o.href=s,await sz(()=>o.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){const a=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;a.download=this.weightDataFileName,a.href=n,await sz(()=>a.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:P0(e)}}}}gf.URL_SCHEME="downloads://";class Joe{constructor(e){if(e==null||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise((e,n)=>{const r=new FileReader;r.onload=i=>{const s=JSON.parse(i.target.result),o=s.modelTopology;if(o==null){n(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(s.weightsManifest==null){n(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){e({modelTopology:o});return}const l=HM(s,c=>this.loadWeights(c));e(l)},r.onerror=i=>n(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),r.readAsText(this.jsonFile)})}loadWeights(e){const n=[],r=[];for(const o of e)n.push(...o.weights),r.push(...o.paths);const i=this.checkManifestAndWeightFiles(e),s=r.map(o=>this.loadWeightsFile(o,i[o]));return Promise.all(s).then(o=>[n,vS(o)])}loadWeightsFile(e,n){return new Promise((r,i)=>{const s=new FileReader;s.onload=o=>{const a=o.target.result;r(a)},s.onerror=o=>i(`Failed to weights data from file of path '${e}'.`),s.readAsArrayBuffer(n)})}checkManifestAndWeightFiles(e){const n=[],r=this.weightsFiles.map(s=>KB(s.name)),i={};for(const s of e)s.paths.forEach(o=>{const a=KB(o);if(n.indexOf(a)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(n.push(a),r.indexOf(a)===-1)throw new Error(`Weight file with basename '${a}' is not provided.`);i[o]=this.weightsFiles[r.indexOf(a)]});if(n.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${n.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return i}}const Qoe=t=>Ce().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(gf.URL_SCHEME)?eae(t.slice(gf.URL_SCHEME.length)):null;Nr.registerSaveRouter(Qoe);function eae(t="model"){return new gf(t)}function oz(t){return new Joe(t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function az(t,e,n,r){o(t),n=n==null?0:n,r=r==null?1:r,a(n,r);let i=0;const s=l=>(l.then(c=>{const u=n+ ++i/t.length*(r-n);return e(u),c}),l);function o(l){z(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,c){z(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),z(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),z(c>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${c}`)}return Promise.all(t.map(s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function lz(t,e){e==null&&(e={});const n=e.fetchFunc==null?Ce().platform.fetch:e.fetchFunc,r=t.map(h=>n(h,e.requestInit,{isBinary:!0})),i=0,s=.5,a=(e.onProgress==null?await Promise.all(r):await az(r,e.onProgress,i,s)).map(h=>h.arrayBuffer()),l=.5,c=1;return e.onProgress==null?await Promise.all(a):await az(a,e.onProgress,l,c)}async function tae(t,e="",n,r){return cz(o=>lz(o,{requestInit:r}))(t,e,n)}function cz(t){return async(e,n="",r)=>{const i=e.map(()=>!1),s={},o=r!=null?r.map(()=>!1):[],a=[];if(e.forEach((d,p)=>{let m=0;d.weights.forEach(v=>{const y="quantization"in v?v.quantization.dtype:v.dtype,w=UM[y]*_e(v.shape),x=()=>{i[p]=!0,s[p]==null&&(s[p]=[]),s[p].push({manifestEntry:v,groupOffset:m,sizeBytes:w})};r!=null?r.forEach((_,S)=>{_===v.name&&(x(),o[S]=!0)}):x(),a.push(v.name),m+=w})}),!o.every(d=>d)){const d=r.filter((p,m)=>!o[m]);throw new Error(`Could not find weights in manifest with names: ${d.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}const l=i.reduce((d,p,m)=>(p&&d.push(m),d),[]),c=[];l.forEach(d=>{e[d].paths.forEach(p=>{const m=n+(n.endsWith("/")?"":"/")+p;c.push(m)})});const u=await t(c),h={};let f=0;return l.forEach(d=>{const p=e[d].paths.length;let m=0;for(let _=0;_<p;_++)m+=u[f+_].byteLength;const v=new ArrayBuffer(m),y=new Uint8Array(v);let w=0;for(let _=0;_<p;_++){const S=new Uint8Array(u[f+_]);y.set(S,w),w+=S.byteLength}s[d].forEach(_=>{const S=v.slice(_.groupOffset,_.groupOffset+_.sizeBytes),T=gS(S,[_.manifestEntry]);for(const E in T)h[E]=T[E]}),f+=p}),h}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nae="application/octet-stream",rae="application/json";class eI{constructor(e,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(z(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=Ce().platform.fetch,z(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&z(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i=YB(e,r);n.body.append("model.json",new Blob([JSON.stringify(i)],{type:rae}),"model.json"),e.weightData!=null&&n.body.append("model.weights.bin",new Blob([e.weightData],{type:nae}),"model.weights.bin");const s=await this.fetch(this.path,n);if(s.ok)return{modelArtifactsInfo:P0(e),responses:[s]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${s.status}.`)}async load(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const r=n.modelTopology,i=n.weightsManifest;if(r==null&&i==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return HM(n,s=>this.loadWeights(s))}async loadWeights(e){const n=Array.isArray(this.path)?this.path[1]:this.path,[r,i]=iae(n),s=this.weightPathPrefix||r,o=[];for(const u of e)o.push(...u.weights);const a=[],l=[];for(const u of e)for(const h of u.paths)this.weightUrlConverter!=null?l.push(this.weightUrlConverter(h)):a.push(s+h+i);this.weightUrlConverter&&a.push(...await Promise.all(l));const c=await lz(a,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[o,vS(c)]}}eI.URL_SCHEME_REGEX=/^https?:\/\//;function iae(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),r=t.substring(0,e),i=n>e?t.substring(n):"";return[r+"/",i]}function tI(t){return t.match(eI.URL_SCHEME_REGEX)!=null}const uz=(t,e)=>{if(typeof fetch=="undefined"&&(e==null||e.fetchFunc==null))return null;{let n=!0;if(Array.isArray(t)?n=t.every(r=>tI(r)):n=tI(t),n)return bS(t,e)}return null};Nr.registerSaveRouter(uz);Nr.registerLoadRouter(uz);function bS(t,e){return new eI(t,e)}function wS(t,e){return bS(t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nI{constructor(e){this.modelArtifacts=e}async load(){return this.modelArtifacts}}class sae{constructor(e){this.saveHandler=e}async save(e){return this.saveHandler(e)}}function oae(t,e,n,r){return arguments.length===1?t.modelTopology!=null||t.weightSpecs!=null?new nI(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new nI({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new nI({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:r}))}function hz(t){return new sae(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var aae=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",browserFiles:oz,browserHTTPRequest:wS,concatenateArrayBuffers:vS,decodeWeights:gS,encodeWeights:WM,fromMemory:oae,getLoadHandlers:qM,getModelArtifactsForJSON:HM,getModelArtifactsInfoForJSON:P0,getSaveHandlers:jM,http:bS,isHTTPScheme:tI,loadWeights:tae,registerLoadRouter:Moe,registerSaveRouter:Aoe,weightsLoaderFactory:cz,withSaveHandler:hz,copyModel:Voe,listModels:ZM,moveModel:Uoe,removeModel:JM});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lae(t,e,n=!1,r=!1){let i=U(t,"a","matMul"),s=U(e,"b","matMul");[i,s]=Ir(i,s);const o={a:i,b:s},a={transposeA:n,transposeB:r};return Q.runKernel(My,o,a)}const gn=te({matMul_:lae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cae(t,e,n=1,r=0){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const s={indices:U(t,"indices","oneHot","int32")},o={depth:e,onValue:n,offValue:r};return Q.runKernel(o0,s,o)}const O0=te({oneHot_:cae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uae(t,e){const n=U(t,"x","transpose");if(e==null&&(e=n.shape.map((s,o)=>o).reverse()),z(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of perm ${e}.`),e.forEach(s=>{z(s>=0&&s<n.rank,()=>`All entries in 'perm' must be between 0 and ${n.rank-1} but got ${e}`)}),n.rank<=1)return n.clone();const r={x:n},i={perm:e};return Q.runKernel(w0,r,i)}const Mn=te({transpose_:uae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hae(t,e,n){const r=U(t,"labels","confusionMatrix"),i=U(e,"predictions","confusionMatrix");z(n==null||n>0&&Number.isInteger(n),()=>`If provided, numClasses must be a positive integer, but got ${n}`),z(r.rank===1,()=>`Expected the rank of labels to be 1, but got ${r.rank}`),z(i.rank===1,()=>`Expected the rank of predictions to be 1, but got ${i.rank}`),z(r.shape[0]===i.shape[0],()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${i.shape[0]}. Labels and predictions should have the same number of elements.`),z(n>0&&Number.isInteger(n),()=>`numClasses is required to be a positive integer, but got ${n}`);const s=O0(Qe(r,"int32"),n),o=O0(Qe(i,"int32"),n),a=Mn(s),l=gn(a,o);return Qe(l,"int32")}const fae=te({confusionMatrix_:hae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var dae=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",confusionMatrix:fae});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vf(t,e){const n=t.length,r=[];for(let i=0;i<n;i++){const s=n-1-i,o=t[s]||1;(e[e.length-1-i]||1)>1&&o===1&&r.unshift(s)}return r}function ri(t,e){const n=[];for(let r=0;r<e.length;r++){const i=t[t.length-r-1],s=e.length-r-1,o=e[s];(i==null||i===1&&o>1)&&n.unshift(s)}return n}function Qt(t,e){const n=[],r=Math.max(t.length,e.length);for(let i=0;i<r;i++){let s=t[t.length-i-1];s==null&&(s=1);let o=e[e.length-i-1];if(o==null&&(o=1),s===1)n.unshift(o);else if(o===1)n.unshift(s);else if(s!==o){const a=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(a)}else n.unshift(s)}return n}var pae=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getBroadcastDims:vf,getReductionAxes:ri,assertAndGetBroadcastShape:Qt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fz(t,e,n){if(rf(t),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const r=Ll(t,n);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Vu(t,e,r,n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let yf;function dz(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,i=!1,s=!1,o=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if(typeof ImageData!="undefined"&&t instanceof ImageData)r=!0;else if(typeof HTMLVideoElement!="undefined"&&t instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement!="undefined"&&t instanceof HTMLImageElement)s=!0;else if(t.getContext!=null)o=!0;else if(typeof ImageBitmap!="undefined"&&t instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);if(i){const p=2;if(i&&t.readyState<p)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(lS(oS,Q.backendName)!=null){const p={pixels:t},m={numChannels:e};return Q.runKernel(oS,p,m)}const[c,u]=i?[t.videoWidth,t.videoHeight]:[t.width,t.height];let h;if(o)h=t.getContext("2d").getImageData(0,0,c,u).data;else if(r||n)h=t.data;else if(s||i||a){if(yf==null)if(typeof document=="undefined")if(typeof OffscreenCanvas!="undefined"&&typeof OffscreenCanvasRenderingContext2D!="undefined")yf=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else yf=document.createElement("canvas").getContext("2d");yf.canvas.width=c,yf.canvas.height=u,yf.drawImage(t,0,0,c,u),h=yf.getImageData(0,0,c,u).data}let f;if(e===4)f=new Int32Array(h);else{const p=c*u;f=new Int32Array(p*e);for(let m=0;m<p;m++)for(let v=0;v<e;++v)f[m*e+v]=h[m*4+v]}return fz(f,[u,c,e],"int32")}function mae(t){return t!=null&&t.data instanceof Uint8Array}function gae(){return typeof window!="undefined"&&typeof ImageBitmap!="undefined"&&window.hasOwnProperty("createImageBitmap")}function vae(t){return t!=null&&t.width!==0&&t.height!==0}function yae(t){return gae()&&!(t instanceof ImageBitmap)&&vae(t)&&!mae(t)}async function bae(t,e=3){let n=null;if(Ce().getBool("WRAP_TO_IMAGEBITMAP")&&yae(t)){let r;try{r=await createImageBitmap(t,{premultiplyAlpha:"none"})}catch{r=null}r!=null&&r.width===t.width&&r.height===t.height?n=r:n=t}else n=t;return dz(n,e)}async function pz(t,e){let n=U(t,"img","toPixels");if(!(t instanceof Qn)){const c=n;n=Qe(c,"int32"),c.dispose()}if(n.rank!==2&&n.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const[r,i]=n.shape.slice(0,2),s=n.rank===2?1:n.shape[2];if(s>4||s===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${s}`);if(n.dtype!=="float32"&&n.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`);const o=await n.data(),a=n.dtype==="float32"?255:1,l=new Uint8ClampedArray(i*r*4);for(let c=0;c<r*i;++c){const u=[0,0,0,255];for(let f=0;f<s;f++){const d=o[c*s+f];if(n.dtype==="float32"){if(d<0||d>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${d}.`)}else if(n.dtype==="int32"&&(d<0||d>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${d}.`);s===1?(u[0]=d*a,u[1]=d*a,u[2]=d*a):u[f]=d*a}const h=c*4;l[h+0]=Math.round(u[0]),l[h+1]=Math.round(u[1]),l[h+2]=Math.round(u[2]),l[h+3]=Math.round(u[3])}if(e!=null){e.width=i,e.height=r;const c=e.getContext("2d"),u=new ImageData(l,i,r);c.putImageData(u,0,0)}return n!==t&&n.dispose(),l}const rI=te({fromPixels_:dz});var wae=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",fromPixelsAsync:bae,toPixels:pz,fromPixels:rI});function xS(t,e){const n=t.shape.length,r=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${n}`);if(_e(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const i=e.shape,s=i[i.length-1];let o=1;for(let h=0;h<i.length-1;++h)o*=i[h];const a=t.shape,l=i.slice();l.pop();let c=1;for(let h=s;h<n;++h)c*=a[h],l.push(a[h]);const u=[...Rt(t.shape).map(h=>h/c),1].slice(0,s);return[l,o,c,u]}var xae=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",prepareAndValidate:xS});function iI(t,e,n){const r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,s=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${i}.`;if(n.rank<i)throw new Error(s+` update.rank < ${i}. `);if(t.length<r+(n.rank-i))throw new Error(s+` Output shape length < ${r+(n.rank-i)}`);if(n.rank!==i+t.length-r)throw new Error(s+` update.rank != ${i+t.length-r}`);for(let o=0;o<i;++o)if(n.shape[o]!==e.shape[o])throw new Error(s+` updates.shape[${o}] (${n.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<n.rank-i;++o)if(n.shape[o+i]!==t[o+r])throw new Error(s+` updates.shape[${o+i}] (${n.shape[o+i]}) != shape[${o+i}] (${t[o+i]})`)}function sI(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}iI(n,e,t)}function Cm(t,e,n){const r=e.shape.length,i=r>1?e.shape[r-1]:1,s=n.length;let o=1;for(let h=i;h<s;++h)o*=n[h];const a=i<1?1:i,l=_e(e.shape)/a,c=[...Rt(n.slice(0,i)),1],u=_e(n);return{sliceRank:i,numUpdates:l,sliceSize:o,strides:c,outputSize:u}}var _ae=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",validateUpdateShape:iI,validateInput:sI,calculateShapes:Cm});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oI=-2,Sae=-1;function aI(t,e,n){const r=t.shape.length;z(r===e.length,()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`),z(r===n.length,()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`);for(let i=0;i<r;++i)z(e[i]+n[i]<=t.shape[i],()=>`Error in slice${r}D: begin[${i}] + size[${i}] (${e[i]+n[i]}) would overflow input.shape[${i}] (${t.shape[i]})`)}function Cae(t){const e=[];let n=0;for(;t>0;)t&1&&e.push(n),t/=2,n++;return e}function lI(t,e,n){const r=[];for(let i=0;i<t.length;i++)r[i]=Math.ceil((e[i]-t[i])/n[i]);return r}function mz(t,e,n,r){const i=[...t];for(let s=i.length;s<r.length;s++)i.push(1);for(let s=0;s<n;s++)s===0?i[e]=1:(i.splice(e,0,1),i.pop());return i}function gz(t,e,n){return n<=t?n:n-(e-1)}function vz(t,e){const n=[];for(let r=0;r<t;r++)n.push(e+r);return n}function Tae(t,e,n,r,i,s,o,a,l){const c=t.length;let u=new Array(c),h=new Array(c),f=new Array(c);if(e.length&&n>0){const d=e[0],p=n+1;u=yz(o,d,p,r,t),h=bz(a,d,p,i,t),f=mz(s,d,p,t)}else for(let d=0;d<c;d++)u[d]=xz(o,r,s,t,d,l),h[d]=_z(a,i,s,t,d,l),f[d]=wz(s,d,l);return{begin:u,end:h,strides:f}}function yz(t,e,n,r,i){const s=[...i],o=vz(n,e);for(let a=0;a<s.length;a++)if(o.indexOf(a)>-1)s[a]=0;else{const l=gz(e,n,a);let c=r[l];t&1<<l&&(c=0),s[a]=c}return s}function bz(t,e,n,r,i){const s=[...i],o=vz(n,e);for(let a=0;a<s.length;a++)if(o.indexOf(a)>-1)s[a]=Number.MAX_SAFE_INTEGER;else{const l=gz(e,n,a);let c=r[l];t&1<<l&&(c=Number.MAX_SAFE_INTEGER),s[a]=c}for(let a=0;a<s.length;a++){const l=i[a];s[a]<0&&(s[a]+=l),s[a]=Ou(0,s[a],i[a])}return s}function wz(t,e,n){let r=t[e];return(n&1<<e||r==null)&&(r=1),r}function xz(t,e,n,r,i,s){let o=e[i];const a=n[i]||1;(t&1<<i||s&1<<i||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const l=r[i];return o<0&&(o+=l),o=Ou(0,o,l-1),o}function _z(t,e,n,r,i,s){let o=e[i];const a=n[i]||1;(t&1<<i||s&1<<i||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const l=r[i];return o<0&&(o+=l),a>0?o=Ou(0,o,l):o=Ou(-1,o,l-1),o}function cI(t,e,n){let r=n.length;for(let i=0;i<n.length;i++)if(n[i]>1){r=i;break}for(let i=r+1;i<n.length;i++)if(e[i]>0||n[i]!==t[i])return!1;return!0}function uI(t,e){let n=t.length>0?t[t.length-1]:1;for(let r=0;r<t.length-1;r++)n+=t[r]*e[r];return n}function _S(t,e,n){let r;const i=t.shape.length;typeof e=="number"?r=[e,...new Array(i-1).fill(0)]:e.length<i?r=e.concat(new Array(i-e.length).fill(0)):r=e.slice(),r.forEach(o=>{z(o!==-1,()=>"slice() does not support negative begin indexing.")});let s;return n==null?s=new Array(i).fill(-1):typeof n=="number"?s=[n,...new Array(i-1).fill(-1)]:n.length<i?s=n.concat(new Array(i-n.length).fill(-1)):s=n,s=s.map((o,a)=>o>=0?o:(z(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),t.shape[a]-r[a])),[r,s]}function hI(t,e,n,r,i,s,o,a,l){let c;if(r==null?(c=new Array(e.length),c.fill(1)):c=r,o!=null&&(o&o-1)!=0)throw new Error("Multiple ellipses in slice is not allowed.");let u=!1;const h={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:c.slice(),beginMask:i,endMask:s,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let x=0;x<h.dims;x++)u&&(1<<x&a)!=0&&h.numAddAxisAfterEllipsis++,1<<x&o&&(u=!0);u||(h.ellipsisMask|=1<<h.dims,h.dims++);const f={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};Eae(h,f);let d=!0,p=!0,m=!0;const v=[],y=[];for(let x=0;x<t.length;++x){if(f.strides[x]===0)throw Error(`strides[${x}] must be non-zero`);const _=!!(f.shrinkAxisMask&1<<x),S=t[x];if(S===-1){v.push(_?1:-1);continue}const T=[f.beginMask&1<<x,f.endMask&1<<x],E=[f.strides[x]>0?0:-1,f.strides[x]>0?S:S-1];if(_&&f.strides[x]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&f.strides[x]===1;const k=!!(f.beginMask&1<<x&&f.endMask&1<<x);if(f.beginValid&&f.endValid){if(_){const P=f.begin[x]<0?S+f.begin[x]:f.begin[x];if(f.begin[x]=P,f.end[x]=f.begin[x]+1,P<0||P>=S)throw Error(`slice index ${f.begin[x]} of dimension ${x} out of bounds.`)}else f.begin[x]=Sz(f.begin[x],0,f.strides[x],S,T,E),f.end[x]=Sz(f.end[x],1,f.strides[x],S,T,E);const D=f.strides[x]===1&&f.begin[x]===0&&f.end[x]===S;d=d&&D,p=p&&(x===0&&f.strides[x]===1||D)}else d=d&&f.strides[x]===1&&k,p=p&&(x===0&&f.strides[x]===1||k);let A,M=!1;if(f.beginValid&&f.endValid?(A=f.end[x]-f.begin[x],M=!0):_?(A=1,M=!0):k&&S>=0&&(f.strides[x]<0?A=-S:A=S,M=!0),M){let D;A===0||A<0!=f.strides[x]<0?D=0:D=Math.trunc(A/f.strides[x])+(A%f.strides[x]!=0?1:0),v.push(D)}else v.push(-1)}for(let x=0;x<f.finalShapeGatherIndices.length;++x){const _=f.finalShapeGatherIndices[x];_>=0?y.push(v[_]):_===oI&&y.push(1)}return{finalShapeSparse:y.filter((x,_)=>f.finalShapeGatherIndices[_]!==oI),finalShape:y,isIdentity:d,sliceDim0:p,isSimpleSlice:m,begin:f.begin,end:f.end,strides:f.strides}}function Eae(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=t.begin!=null,e.endValid=t.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let r=0;r<t.dims;r++)if(1<<r&t.ellipsisMask){const i=Math.min(e.dims-(t.dims-r)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<i;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&t.newAxisMask)e.finalShapeGatherIndices.push(oI),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);t.begin!=null&&(e.begin[n]=t.begin[r]),t.end!=null&&(e.end[n]=t.end[r]),e.strides[n]=t.strides[r],t.beginMask&1<<r&&(e.beginMask|=1<<n),t.endMask&1<<r&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(Sae),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[n]=r,n++}}function Sz(t,e,n,r,i,s){if(i[e])return n>0?s[e]:s[e+1&1];{const o=t<0?r+t:t;return o<s[0]?s[0]:o>s[1]?s[1]:o}}var Cz=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",assertParamsValid:aI,maskToAxes:Cae,computeOutShape:lI,stridesWithElidedDims:mz,getNormalizedAxes:Tae,startIndicesWithElidedDims:yz,stopIndicesWithElidedDims:bz,stridesForAxis:wz,startForAxis:xz,stopForAxis:_z,isSliceContinous:cI,computeFlatOffset:uI,parseSliceParams:_S,sliceInfo:hI});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bf{getClassName(){return this.constructor.className}static fromConfig(e,n){return new e(n)}}class Ao{constructor(){this.classNameMap={}}static getMap(){return Ao.instance==null&&(Ao.instance=new Ao),Ao.instance}static register(e){Ao.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Le(t){z(t.className!=null,()=>"Class being registered does not have the static className property defined."),z(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),z(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),Ao.register(t)}var kae=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",Serializable:bf,SerializationMap:Ao,registerClass:Le});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aae=.001,Tz=.1;function Mae(t,e,n){return n==null&&(n=fI()),dI(t,e,(r,i)=>pI(r,i,n))}function fI(){return Q.backend.floatPrecision()===32?Aae:Tz}function dI(t,e,n){let r=!0;if((Qi(t)||Qi(e))&&(r=!1),Qi(t)&&Qi(e)&&(r=!0),r){const o=t.constructor.name,a=e.constructor.name;if(o!==a)throw new Error(`Arrays are of different type. Actual: ${o}. Expected: ${a}`)}if(Array.isArray(t)&&Array.isArray(e)){const o=Ll(t),a=Ll(e);if(!wn(o,a))throw new Error(`Arrays have different shapes. Actual: [${o}]. Expected: [${a}]`)}const i=Qi(t)?t:$c(t),s=Qi(e)?e:$c(e);if(i.length!==s.length)throw new Error(`Arrays have different lengths actual: ${i.length} vs expected: ${s.length}.
Actual:   ${i}.
Expected: ${s}.`);for(let o=0;o<s.length;++o){const a=i[o],l=s[o];if(!n(a,l))throw new Error(`Arrays differ: actual[${o}] = ${a}, expected[${o}] = ${l}.
Actual:   ${i}.
Expected: ${s}.`)}}function Iae(t,e){t().then(()=>e.fail(),()=>e())}function Nae(t,e){const n=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return Ol(t)||Ol(t[0])||Ol(e)||Ol(e[0])?dI(t,n,(r,i)=>r==i):dI(t,e,(r,i)=>pI(r,i,0))}function $ae(t,e,n){if(n==null&&(n=fI()),!pI(t,e,n))throw new Error(`Numbers differ: actual === ${t}, expected === ${e}`)}function pI(t,e,n){return!isFinite(t)&&!isFinite(e)?!0:!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}function Rae(t,e,n){for(let r=0;r<t.length;r++)if(t[r]<e||t[r]>n)throw new Error(`Value out of range:${t[r]} low: ${e}, high: ${n}`)}function Dae(t,e){const n=new Float32Array(t),r=new Float32Array(e);if(n.length!==r.length)throw new Error(`Expected ArrayBuffer to be of length ${r.length}, but it was ${n.length}`);for(let i=0;i<r.length;i++)if(n[i]!==r[i])throw new Error(`Expected ArrayBuffer value at ${i} to be ${r[i]} but got ${n[i]} instead`)}function Ez(t){for(let e=0;e<t.length;e++){const n=t[e];Array.isArray(n)?Ez(n):t[e]=Fl(n)}return t}var Pae=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",TEST_EPSILON_FLOAT16:Tz,expectArraysClose:Mae,testEpsilon:fI,expectPromiseToFail:Iae,expectArraysEqual:Nae,expectNumbersClose:$ae,expectValuesInRange:Rae,expectArrayBuffersEqual:Dae,encodeStrings:Ez});/** @license See the LICENSE file. */const Oae="3.13.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fae(){Ce().set("PROD",!0)}function Lae(){Ce().set("DEBUG",!0)}function Bae(){Ce().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function zae(t){Ce().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Vae(){Q.disposeVariables()}function Wu(){return Q}function SS(){return Q.memory()}function Uae(t){return Q.profile(t)}function de(t,e){return Q.tidy(t,e)}function on(t){FM(t).forEach(n=>n.dispose())}function Tr(t){return Q.keep(t)}function Wae(t){return Q.time(t)}function Gae(t){return Q.setBackend(t)}function Hae(){return Q.ready()}function jae(){return Q.backendName}function qae(t){Q.removeBackend(t)}function Xae(t){return Q.findBackend(t)}function Kae(t){return Q.findBackendFactory(t)}function mI(t,e,n=1){return Q.registerBackend(t,e,n)}function kz(){return Q.backend}function Yae(t,e){Ce().setPlatform(t,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zae(t,e){let n=U(t,"a","add"),r=U(e,"b","add");[n,r]=Ir(n,r);const i={a:n,b:r};return Q.runKernel(af,i)}const Be=te({add_:Zae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jae(t,e){let n=U(t,"a","floorDiv"),r=U(e,"b","floorDiv");[n,r]=Ir(n,r);const i={a:n,b:r};return Q.runKernel(zp,i)}const gI=te({floorDiv_:Jae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qae(t,e){let n=U(t,"a","div"),r=U(e,"b","div");if([n,r]=Ir(n,r),n.dtype==="int32"&&r.dtype==="int32")return gI(n,r);const i={a:n,b:r},s={};return Q.runKernel(Dp,i,s)}const Tt=te({div_:Qae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ele(t,e){let n=U(t,"a","mul"),r=U(e,"b","mul");[n,r]=Ir(n,r);const i={a:n,b:r};return Q.runKernel(Zp,i)}const se=te({mul_:ele});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tle(t){const e=U(t,"x","abs");if(e.dtype==="complex64"){const n={x:e};return Q.runKernel(Ny,n)}else{const n={x:e};return Q.runKernel(Sy,n)}}const pi=te({abs_:tle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nle(t){const n={x:U(t,"x","acos")};return Q.runKernel(_p,n)}const Az=te({acos_:nle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rle(t){const n={x:U(t,"x","acosh")};return Q.runKernel(Sp,n)}const Mz=te({acosh_:rle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ile(t){z(Array.isArray(t),()=>"The argument passed to tf.addN() must be a list of tensors"),z(t.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`);const e=t.map((i,s)=>U(i,`tensors${s}`,"addN")),n=e[0];e.forEach(i=>{if(i.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(i=>{if(!wn(i.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});const r=e;return Q.runKernel(Cy,r)}const Iz=te({addN_:ile});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sle(t,e=null,n=!1){const i={x:U(t,"x","all","bool")},s={axis:e,keepDims:n};return Q.runKernel(o_,i,s)}const vI=te({all_:sle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ole(t,e=null,n=!1){const i={x:U(t,"x","any","bool")},s={axis:e,keepDims:n};return Q.runKernel(a_,i,s)}const CS=te({any_:ole});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ale(t,e=0){const r={x:U(t,"x","argMax")},i={axis:e};return Q.runKernel(Ty,r,i)}const Tm=te({argMax_:ale});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lle(t,e=0){const r={x:U(t,"x","argMin")},i={axis:e};return Q.runKernel(Ey,r,i)}const Nz=te({argMin_:lle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cle(t){const n={x:U(t,"x","asin")};return Q.runKernel(Cp,n)}const $z=te({asin_:cle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ule(t){const n={x:U(t,"x","asinh")};return Q.runKernel(Tp,n)}const Rz=te({asinh_:ule});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hle(t){const n={x:U(t,"x","atan")};return Q.runKernel(Ep,n)}const Dz=te({atan_:hle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fle(t,e){let n=U(t,"a","atan2"),r=U(e,"b","atan2");[n,r]=Ir(n,r);const i={a:n,b:r};return Q.runKernel(Ap,i)}const Pz=te({atan2_:fle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dle(t){const n={x:U(t,"x","atanh")};return Q.runKernel(kp,n)}const Oz=te({atanh_:dle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F0(t,e,n,r,i="NHWC",s){const o=t[3],a=[...e,o],l=Lc(i);return Ai(t,a,n,s,r,null,null,l)}function ca(t,e,n,r,i,s,o="channelsLast"){const[a,l]=TS(e);let c;if(o==="channelsLast")c=[a,l,t[3],t[3]];else if(o==="channelsFirst")c=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return Ai(t,c,n,r,i,s,!1,o)}function Fc(t,e,n,r,i,s,o="NDHWC"){const[a,l,c]=bI(e);let u,h;if(o==="NDHWC")h="channelsLast",u=[a,l,c,t[4],t[4]];else if(o==="NCDHW")h="channelsFirst",u=[a,l,c,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return Gu(t,u,n,r,i,!1,h,s)}function Ai(t,e,n,r,i,s,o=!1,a="channelsLast"){let[l,c,u,h]=[-1,-1,-1,-1];if(a==="channelsLast")[l,c,u,h]=t;else if(a==="channelsFirst")[l,h,c,u]=t;else throw new Error(`Unknown dataFormat ${a}`);const[f,d,,p]=e,[m,v]=TS(n),[y,w]=TS(r),x=Em(f,y),_=Em(d,w),{padInfo:S,outHeight:T,outWidth:E}=gle(i,c,u,m,v,x,_,s,a),k=o?p*h:p;let A;return a==="channelsFirst"?A=[l,k,T,E]:a==="channelsLast"&&(A=[l,T,E,k]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:u,inChannels:h,outHeight:T,outWidth:E,outChannels:k,padInfo:S,strideHeight:m,strideWidth:v,filterHeight:f,filterWidth:d,effectiveFilterHeight:x,effectiveFilterWidth:_,dilationHeight:y,dilationWidth:w,inShape:t,outShape:A,filterShape:e}}function Gu(t,e,n,r,i,s=!1,o="channelsLast",a){let[l,c,u,h,f]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[l,c,u,h,f]=t;else if(o==="channelsFirst")[l,f,c,u,h]=t;else throw new Error(`Unknown dataFormat ${o}`);const[d,p,m,,v]=e,[y,w,x]=bI(n),[_,S,T]=bI(r),E=Em(d,_),k=Em(p,S),A=Em(m,T),{padInfo:M,outDepth:D,outHeight:P,outWidth:N}=vle(i,c,u,h,y,w,x,E,k,A,a),R=s?v*f:v;let F;return o==="channelsFirst"?F=[l,R,D,P,N]:o==="channelsLast"&&(F=[l,D,P,N,R]),{batchSize:l,dataFormat:o,inDepth:c,inHeight:u,inWidth:h,inChannels:f,outDepth:D,outHeight:P,outWidth:N,outChannels:R,padInfo:M,strideDepth:y,strideHeight:w,strideWidth:x,filterDepth:d,filterHeight:p,filterWidth:m,effectiveFilterDepth:E,effectiveFilterHeight:k,effectiveFilterWidth:A,dilationDepth:_,dilationHeight:S,dilationWidth:T,inShape:t,outShape:F,filterShape:e}}function ple(t,e,n,r,i){r==null&&(r=yI(t,e,n));const s=t[0],o=t[1],a=wf((s-e+2*r)/n+1,i),l=wf((o-e+2*r)/n+1,i);return[a,l]}function mle(t,e,n,r,i,s){i==null&&(i=yI(t,e,r));const o=t[0],a=t[1],l=t[2],c=wf((o-e+2*i)/r+1,s),u=wf((a-e+2*i)/r+1,s),h=wf((l-e+2*i)/r+1,s);return[c,u,h,n]}function yI(t,e,n,r=1){const i=Em(e,r);return Math.floor((t[0]*(n-1)-n+i)/2)}function TS(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function bI(t){return typeof t=="number"?[t,t,t]:t}function Em(t,e){return e<=1?t:t+(t-1)*(e-1)}function gle(t,e,n,r,i,s,o,a,l){let c,u,h;if(typeof t=="number"){c={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};const d=ple([e,n],s,r,t,a);u=d[0],h=d[1]}else if(t==="same"){u=Math.ceil(e/r),h=Math.ceil(n/i);const f=Math.max(0,(u-1)*r+s-e),d=Math.max(0,(h-1)*i+o-n),p=Math.floor(f/2),m=f-p,v=Math.floor(d/2),y=d-v;c={top:p,bottom:m,left:v,right:y,type:"SAME"}}else if(t==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((e-s+1)/r),h=Math.ceil((n-o+1)/i);else if(typeof t=="object"){const f=l==="channelsLast"?t[1][0]:t[2][0],d=l==="channelsLast"?t[1][1]:t[2][1],p=l==="channelsLast"?t[2][0]:t[3][0],m=l==="channelsLast"?t[2][1]:t[3][1];c={top:f,bottom:d,left:p,right:m,type:f===0&&d===0&&p===0&&m===0?"VALID":"EXPLICIT"},u=wf((e-s+f+d)/r+1,a),h=wf((n-o+p+m)/i+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:c,outHeight:u,outWidth:h}}function vle(t,e,n,r,i,s,o,a,l,c,u){let h,f,d,p;if(typeof t=="number"){h={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};const v=mle([e,n,r,1],a,1,i,t,u);f=v[0],d=v[1],p=v[2]}else if(t==="same"){f=Math.ceil(e/i),d=Math.ceil(n/s),p=Math.ceil(r/o);const m=(f-1)*i+a-e,v=(d-1)*s+l-n,y=(p-1)*o+c-r,w=Math.floor(m/2),x=m-w,_=Math.floor(v/2),S=v-_,T=Math.floor(y/2),E=y-T;h={top:_,bottom:S,left:T,right:E,front:w,back:x,type:"SAME"}}else if(t==="valid")h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},f=Math.ceil((e-a+1)/i),d=Math.ceil((n-l+1)/s),p=Math.ceil((r-c+1)/o);else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:h,outDepth:f,outHeight:d,outWidth:p}}function wf(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function Hu(t){const[e,n,r]=TS(t);return e===1&&n===1&&r===1}function Ui(t,e){return Hu(t)||Hu(e)}function Lc(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function ps(t,e,n){if(n!=null){if(typeof e=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if(typeof e=="number")z(sf(e),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);else if(typeof e=="object")e.forEach(r=>{r.forEach(i=>{z(sf(i),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${i}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yle(t,e){const r={x:U(t,"x","reshape","string_or_numeric")},i={shape:e};return Q.runKernel(u0,r,i)}const fe=te({reshape_:yle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ble(t,e,n,r,i){const s=U(t,"x","avgPool","float32"),o=1;z(Ui(n,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`);let a=s,l=!1;s.rank===3&&(l=!0,a=fe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),z(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),ps("avgPool",r,i);const c={x:a},u={filterSize:e,strides:n,pad:r,dimRoundingMode:i};let h=Q.runKernel(ky,c,u);return h=Qe(h,s.dtype),l?fe(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const ES=te({avgPool_:ble});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wle(t,e,n,r,i,s="NDHWC"){const o=U(t,"x","avgPool3d","float32");let a=o,l=!1;o.rank===4&&(l=!0,a=fe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),z(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),z(s==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),ps("avgPool3d",r,i);const c={x:a},u={filterSize:e,strides:n,pad:r,dimRoundingMode:i,dataFormat:s};let h=Q.runKernel(Ay,c,u);return h=Qe(h,a.dtype),l?fe(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const wI=te({avgPool3d_:wle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xle(t,e=0){z(t.length>=1,()=>"Pass at least one tensor to concat");const n=D0(t,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(s=>{if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${s.dtype}. `)}),n.length===1)return Oc(n[0]);const r=n,i={axis:e};return Q.runKernel($y,r,i)}const ii=te({concat_:xle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _le(t){const n={x:U(t,"x","sigmoid","float32")};return Q.runKernel(lm,n)}const Bl=te({sigmoid_:_le});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sle(t,e,n){const r=U(t,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");const i={x:r},s={begin:e,size:n};return Q.runKernel(m0,i,s)}const Cn=te({slice_:Sle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cle(t){const n={x:U(t,"x","tanh","float32")};return Q.runKernel(pm,n)}const km=te({tanh_:Cle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tle(t,e,n,r,i,s){const o=U(t,"forgetBias","basicLSTMCell"),a=U(e,"lstmKernel","basicLSTMCell"),l=U(n,"lstmBias","basicLSTMCell"),c=U(r,"data","basicLSTMCell"),u=U(i,"c","basicLSTMCell"),h=U(s,"h","basicLSTMCell"),f=ii([c,h],1),d=gn(f,a),p=Be(d,l),m=p.shape[0],v=p.shape[1]/4,y=[m,v],w=Cn(p,[0,0],y),x=Cn(p,[0,v],y),_=Cn(p,[0,v*2],y),S=Cn(p,[0,v*3],y),T=Be(se(Bl(w),km(x)),se(u,Bl(Be(o,_)))),E=se(km(T),Bl(S));return[T,E]}const Ele=te({basicLSTMCell_:Tle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kle(t,e,n){const r=U(t,"x","batchToSpaceND"),i=e.reduce((a,l)=>a*l);z(r.rank>=1+e.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`),z(n.length===e.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`),z(r.shape[0]%i==0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${i}`);const s={x:r},o={blockShape:e,crops:n};return Q.runKernel(Iy,s,o)}const kS=te({batchToSpaceND_:kle});function Ale(t){let e;return t.rank===0||t.rank===1?e=fe(t,[1,1,1,t.size]):t.rank===2?e=fe(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?e=fe(t,[1,t.shape[0],t.shape[1],t.shape[2]]):e=t,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mle(t,e,n,r,i,s){s==null&&(s=.001);const o=U(t,"x","batchNorm"),a=U(e,"mean","batchNorm"),l=U(n,"variance","batchNorm");let c;i!=null&&(c=U(i,"scale","batchNorm"));let u;r!=null&&(u=U(r,"offset","batchNorm")),z(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),z(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),z(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const f={x:Ale(o),scale:c,offset:u,mean:a,variance:l},d={varianceEpsilon:s},p=Q.runKernel(Vy,f,d);return fe(p,o.shape)}const Am=te({batchNorm_:Mle});function Ile(t,e,n,r,i,s){const o=U(t,"x","batchNorm"),a=U(e,"mean","batchNorm"),l=U(n,"variance","batchNorm");let c;i!=null&&(c=U(i,"scale","batchNorm"));let u;return r!=null&&(u=U(r,"offset","batchNorm")),z(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),z(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),z(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&z(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),u!=null&&z(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${u.rank}.`),Am(o,a,l,u,c,s)}const Fz=te({batchNorm2d_:Ile});function Nle(t,e,n,r,i,s){const o=U(t,"x","batchNorm"),a=U(e,"mean","batchNorm"),l=U(n,"variance","batchNorm");let c;i!=null&&(c=U(i,"scale","batchNorm"));let u;return r!=null&&(u=U(r,"offset","batchNorm")),z(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),z(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),z(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&z(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),u!=null&&z(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${u.rank}.`),Am(o,a,l,u,c,s)}const Lz=te({batchNorm3d_:Nle});function $le(t,e,n,r,i,s){const o=U(t,"x","batchNorm"),a=U(e,"mean","batchNorm"),l=U(n,"variance","batchNorm");let c;i!=null&&(c=U(i,"scale","batchNorm"));let u;return r!=null&&(u=U(r,"offset","batchNorm")),z(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),z(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),z(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&z(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),u!=null&&z(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${u.rank}.`),Am(o,a,l,u,c,s)}const Bz=te({batchNorm4d_:$le});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rle(t,e,n){const r=U(t,"x","bincount"),i=U(e,"weights","bincount");z(r.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`),z(n>=0,()=>`size must be non-negative, but got ${n}.`),z(i.size===r.size||i.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${i.shape}.`);const s={x:r,weights:i},o={size:n};return Q.runKernel(u_,s,o)}const xI=te({bincount_:Rle});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dle(t,e){const n=U(t,"s0","broadcastArgs","int32"),r=U(e,"s1","broadcastArgs","int32");if(n.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(r.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const i={s0:n,s1:r};return Q.runKernel(h_,i)}const zz=te({broadcastArgs_:Dle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ple(t,e){let n=U(t,"broadcastTo","x");const r=n.shape;if(e.some(c=>!(c>0)||c%1!=0))throw new Error(`broadcastTo(): Invalid broadcast shape [${e}].`);if(e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const c=n.shape.slice();for(;c.length<e.length;)c.unshift(1);n=fe(n,c)}const i=n.shape,s=Array.from(e);for(let c=e.length-1;c>=0;c--)if(i[c]===e[c])s[c]=1;else if(n.shape[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);if(s.map((c,u)=>c>1?u:-1).filter(c=>c>=0).length===0)return Oc(n);const a={x:n},l={reps:s};return Q.runKernel(mm,a,l)}const L0=te({broadcastTo_:Ple});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ole(t){const n={x:U(t,"x","ceil","float32")};return Q.runKernel(Ip,n)}const Vz=te({ceil_:Ole});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fle(t,e,n){const r=U(t,"x","clipByValue");z(e<=n,()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`);const i={x:r},s={clipValueMin:e,clipValueMax:n};return Q.runKernel(Np,i,s)}const ro=te({clipByValue_:Fle});function Lle(t){return ii(t,0)}const Uz=te({concat1d_:Lle});function Ble(t,e){return ii(t,e)}const Wz=te({concat2d_:Ble});function zle(t,e){return ii(t,e)}const Gz=te({concat3d_:zle});function Vle(t,e){return ii(t,e)}const Hz=te({concat4d_:Vle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ule(t,e,n,r,i="NHWC",s=[1,1],o){const a=U(t,"x","conv2d","float32"),l=U(e,"filter","conv2d","float32");let c=a,u=!1;a.rank===3&&(u=!0,c=fe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),z(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),z(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),ps("conv2d",r,o);const h=i==="NHWC"?c.shape[3]:c.shape[1];z(h===l.shape[2],()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${l.shape[2]}.`),z(Ui(n,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`);const f={x:c,filter:l},d={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o},p=Q.runKernel(Ry,f,d);return u?fe(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const ju=te({conv2d_:Ule});function Wle(t,e,n,r,i="NWC",s=1,o){const a=U(t,"x","conv1d"),l=U(e,"filter","conv1d");let c=a,u=!1;a.rank===2&&(u=!0,c=fe(a,[1,a.shape[0],a.shape[1]])),z(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),z(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),ps("conv1d",r,o),z(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),z(Ui(n,s),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${s}'`),z(i==="NWC",()=>`Error in conv1d: got dataFormat of ${i} but only NWC is currently supported.`);const h=fe(l,[1,l.shape[0],l.shape[1],l.shape[2]]),f=fe(c,[c.shape[0],1,c.shape[1],c.shape[2]]),v=ju(f,h,[1,n],r,"NHWC",[1,s],o);return u?fe(v,[v.shape[2],v.shape[3]]):fe(v,[v.shape[0],v.shape[2],v.shape[3]])}const _I=te({conv1d_:Wle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gle(t,e,n,r,i,s="NHWC",o){z(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let a=t,l=e,c=!1;e.rank===3&&(c=!0,l=fe(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),z(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),z(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),z(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const u=s==="NHWC"?a[3]:a[1],h=s==="NHWC"?l.shape[3]:l.shape[1];z(u===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[2]}.`),z(h===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${n.shape[3]}.`),ps("conv2dDerInput",i,o);const f={dy:l,filter:n},d={strides:r,pad:i,dataFormat:s,dimRoundingMode:o,inputShape:a},p=Q.runKernel(Dy,f,d);return c?fe(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const SI=te({conv2DBackpropInput_:Gle});function Hle(t,e,n,r,i,s){const o=U(t,"x","conv2dTranspose"),a=U(e,"filter","conv2dTranspose");return SI(n,o,a,r,i,"NHWC",s)}const CI=te({conv2dTranspose_:Hle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jle(t,e,n,r,i="NDHWC",s=[1,1,1]){const o=U(t,"x","conv3d"),a=U(e,"filter","conv3d");let l=o,c=!1;o.rank===4&&(c=!0,l=fe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),z(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),z(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),z(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),z(Ui(n,s),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),z(i==="NDHWC",()=>`Error in conv3d: got dataFormat of ${i} but only NDHWC is currently supported.`);const u={x:l,filter:a},h={strides:n,pad:r,dataFormat:i,dilations:s},f=Q.runKernel(Py,u,h);return c?fe(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const TI=te({conv3d_:jle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qle(t,e,n,r,i){z(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let s=t,o=e,a=!1;e.rank===4&&(a=!0,o=fe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),s=[1,t[0],t[1],t[2],t[3]]);const l=s[4],c=o.shape[4];z(s.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${s.length}.`),z(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),z(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),z(l===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`),z(c===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[4]}.`);const u={dy:o,filter:n},h={pad:i,strides:r,inputShape:s},f=Q.runKernel(m_,u,h);return a?fe(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const jz=te({conv3DBackpropInput_:qle});function Xle(t,e,n,r,i){const s=U(t,"x","conv3dTranspose"),o=U(e,"filter","conv3dTranspose");return jz(n,s,o,r,i)}const qz=te({conv3dTranspose_:Xle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kle(t){const n={x:U(t,"x","cos","float32")};return Q.runKernel($p,n)}const AS=te({cos_:Kle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yle(t){const n={x:U(t,"x","cosh","float32")};return Q.runKernel(Rp,n)}const EI=te({cosh_:Yle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zle(t,e=0,n=!1,r=!1){const s={x:U(t,"x","cumsum")},o={axis:e,exclusive:n,reverse:r};return Q.runKernel(Oy,s,o)}const kI=te({cumsum_:Zle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jle(t,e,n,r=!1){const i=U(t,"x","denseBincount"),s=U(e,"weights","denseBincount");z(i.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${i.dtype}`),z(i.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${i.rank}.`),z(n>=0,()=>`size must be non-negative, but got ${n}.`),z(s.size===i.size||s.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${i.shape}, weights shape: ${s.shape}.`);const o={x:i,weights:s},a={size:n,binaryOutput:r};return Q.runKernel(v_,o,a)}const Xz=te({denseBincount_:Jle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qle(t,e,n="NHWC"){const r=U(t,"x","depthToSpace","float32"),i=n==="NHWC"?r.shape[1]:r.shape[2],s=n==="NHWC"?r.shape[2]:r.shape[3],o=n==="NHWC"?r.shape[3]:r.shape[1];z(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),z(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e}  for depthToSpace with input shape
    ${r.shape}`),z(s*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${s} and ${e} for depthToSpace with input shape
        ${r.shape}`),z(o%(e*e)==0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${r.shape}`);const a={x:r},l={blockSize:e,dataFormat:n};return Q.runKernel(y_,a,l)}const Kz=te({depthToSpace_:Qle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ece(t,e,n,r,i="NHWC",s=[1,1],o){const a=U(t,"x","depthwiseConv2d","float32"),l=U(e,"filter","depthwiseConv2d","float32");let c=a,u=!1;a.rank===3&&(u=!0,c=fe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),z(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),z(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`),z(c.shape[3]===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),ps("depthwiseConv2d",r,o);const h={x:c,filter:l},f={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o},d=Q.runKernel(Fy,h,f);return u?fe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const B0=te({depthwiseConv2d_:ece});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tce(t){const n={x:U(t,"x","diag")};return Q.runKernel(x_,n)}const nce=te({diag_:tce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rce(t,e,n,r,i=[1,1],s="NHWC"){const o=U(t,"x","dilation2d"),a=U(e,"filter","dilation2d");z(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),z(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),z(s==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${s}`);let l=o,c=!1;o.rank===3&&(l=fe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0);const u={x:l,filter:a},h={strides:n,pad:r,dilations:i},f=Q.runKernel(Ly,u,h);return c?fe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const Yz=te({dilation2d_:rce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ice(t,e){let n=U(t,"a","equal","string_or_numeric"),r=U(e,"b","equal","string_or_numeric");[n,r]=Ir(n,r),Qt(n.shape,r.shape);const i={a:n,b:r};return Q.runKernel(By,i)}const Za=te({equal_:ice});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sce(t,e,n){const r=U(e,"a","where"),i=U(n,"b","where"),s=U(t,"condition","where","bool"),o=Qt(Qt(s.shape,r.shape),i.shape),a=L0(s,o),l=L0(r,o),c=L0(i,o),u={condition:a,t:l,e:c};return Q.runKernel(p0,u)}const Bs=te({where_:sce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oce(t){const n={x:U(t,"x","zerosLike")};return Q.runKernel(S0,n)}const In=te({zerosLike_:oce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ace(t,e){let n=U(t,"a","div"),r=U(e,"b","div");[n,r]=Ir(n,r);const i=Tt(n,r),s=In(i),o=Za(r,s);return Bs(o,s,i)}const Zz=te({divNoNan_:ace});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lce(t,e){const n=U(t,"t1","dot"),r=U(e,"t2","dot");z((n.rank===1||n.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`);const i=n.rank===1?n.size:n.shape[1],s=r.rank===1?r.size:r.shape[0];if(z(i===s,()=>`Error in dot: inner dimensions of inputs must match, but got ${i} and ${s}.`),n.rank===1&&r.rank===1){const o=fe(n,[1,-1]),a=fe(r,[-1,1]),l=gn(o,a);return fe(l,[])}else if(n.rank===1&&r.rank===2){const o=fe(n,[1,-1]),a=fe(r,[r.shape[0],r.shape[1]]),l=gn(o,a);return fe(l,[l.size])}else if(n.rank===2&&r.rank===1){const o=fe(r,[-1,1]),a=gn(n,o);return fe(a,[a.size])}else{const o=fe(r,[r.shape[0],r.shape[1]]);return gn(n,o)}}const cce=te({dot_:lce});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uce(t,...e){const n=e.map((i,s)=>U(i,`tensors${s}`,"einsum")),r={equation:t};return Q.runKernel(C_,n,r)}const Jz=te({einsum_:uce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hce(t){const n={x:U(t,"x","elu","float32")};return Q.runKernel(Pp,n)}const z0=te({elu_:hce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fce(t){let e=U(t,"x","erf");z(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Qe(e,"float32"));const n={x:e};return Q.runKernel(Op,n)}const Qz=te({erf_:fce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dce(t){const n={x:U(t,"x","exp")};return Q.runKernel(Fp,n)}const Mo=te({exp_:dce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pce(t,e=0){const n=U(t,"x","expandDims","string_or_numeric");z(e<=n.rank,()=>"Axis must be <= rank of the tensor");const r={input:n},i={dim:e};return Q.runKernel(zy,r,i)}const Io=te({expandDims_:pce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mce(t){const n={x:U(t,"x","expm1")};return Q.runKernel(Lp,n)}const e4=te({expm1_:mce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gce(t,e){const n=U(t,"x","tile","string_or_numeric");z(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`);const r={x:n},i={reps:e};return Q.runKernel(mm,r,i)}const ua=te({tile_:gce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vce(t,e,n,r="float32"){e==null&&(e=t);const i=mn([t,e],r),s=t<=e?t:e;for(let a=0;a<s;++a)i.set(1,a,a);const o=fe(i.toTensor(),[t,e]);if(n==null)return o;if(n.length===1)return ua(Io(o,0),[n[0],1,1]);if(n.length===2)return ua(Io(Io(o,0),0),[n[0],n[1],1,1]);if(n.length===3)return ua(Io(Io(Io(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const AI=te({eye_:vce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mm(t,e,n){const r={shape:t,value:e,dtype:n};return Q.runKernel(k_,{},r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yce(t){const n={x:U(t,"x","floor","float32")};return Q.runKernel(Bp,n)}const V0=te({floor_:yce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bce(t,e,n=0,r=0){const i=U(t,"x","gather"),s=U(e,"indices","gather","int32"),o={x:i,indices:s},a={axis:n,batchDims:r};return Q.runKernel(Uy,o,a)}const Im=te({gather_:bce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wce(t,e){let n=U(t,"a","greater","string_or_numeric"),r=U(e,"b","greater","string_or_numeric");[n,r]=Ir(n,r),Qt(n.shape,r.shape);const i={a:n,b:r};return Q.runKernel(Wy,i)}const No=te({greater_:wce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xce(t,e){let n=U(t,"a","greaterEqual","string_or_numeric"),r=U(e,"b","greaterEqual","string_or_numeric");[n,r]=Ir(n,r),Qt(n.shape,r.shape);const i={a:n,b:r};return Q.runKernel(Vp,i)}const xf=te({greaterEqual_:xce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ce(t){const n={input:U(t,"input","imag")};return Q.runKernel(N_,n)}const MS=te({imag_:_ce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sce(t){const n={x:U(t,"x","isFinite")};return Q.runKernel(Wp,n)}const Cce=te({isFinite_:Sce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tce(t){const n={x:U(t,"x","isInf")};return Q.runKernel(Gp,n)}const Ece=te({isInf_:Tce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kce(t){const n={x:U(t,"x","isNaN")};return Q.runKernel(Hp,n)}const t4=te({isNaN_:kce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ace(t,e=.2){const r={x:U(t,"x","leakyRelu")},i={alpha:e};return Q.runKernel(Gy,r,i)}const IS=te({leakyRelu_:Ace});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mce(t,e){let n=U(t,"a","less","string_or_numeric"),r=U(e,"b","less","string_or_numeric");[n,r]=Ir(n,r),Qt(n.shape,r.shape);const i={a:n,b:r};return Q.runKernel(Hy,i)}const MI=te({less_:Mce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ice(t,e){let n=U(t,"a","lessEqual","string_or_numeric"),r=U(e,"b","lessEqual","string_or_numeric");[n,r]=Ir(n,r),Qt(n.shape,r.shape);const i={a:n,b:r};return Q.runKernel(jy,i)}const _f=te({lessEqual_:Ice});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n4(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:t,stop:e,num:n};return Q.runKernel($_,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nce(t,e=5,n=1,r=1,i=.5){const s=U(t,"x","localResponseNormalization");z(s.rank===4||s.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${s.rank}.`),z(sf(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=s,a=!1;s.rank===3&&(a=!0,o=fe(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const l={x:o},c={depthRadius:e,bias:n,alpha:r,beta:i},u=Q.runKernel(Yy,l,c);return a?fe(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const r4=te({localResponseNormalization_:Nce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ce(t){const n={x:U(t,"x","log","float32")};return Q.runKernel(jp,n)}const $o=te({log_:$ce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rce(t){const n={x:U(t,"x","log1p")};return Q.runKernel(qp,n)}const NS=te({log1p_:Rce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dce(t){return z(Fu(t),()=>"The f passed in grad(f) must be a function"),(e,n)=>{const r=U(e,"x","tf.grad","string_or_numeric"),i=n!=null?U(n,"dy","tf.grad"):null;return Q.tidy(()=>{const{value:s,grads:o}=Q.gradients(()=>t(r),[r],i);return i!=null&&zi(s.shape,i.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),$S(o),o[0]})}}function Pce(t){return z(Fu(t),()=>"The f passed in grads(f) must be a function"),(e,n)=>{z(Array.isArray(e),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");const r=D0(e,"args","tf.grads","string_or_numeric"),i=n!=null?U(n,"dy","tf.grads"):null;return Q.tidy(()=>{const{value:s,grads:o}=Q.gradients(()=>t(...r),r,i);return i!=null&&zi(s.shape,i.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),$S(o),o})}}function Oce(t){return z(Fu(t),()=>"The f passed in valueAndGrad(f) must be a function"),(e,n)=>{z(e instanceof Qn,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),z(n==null||n instanceof Qn,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");const{grads:r,value:i}=Q.gradients(()=>t(e),[e],n);return $S(r),{grad:r[0],value:i}}}function Fce(t){return z(Fu(t),()=>"The f passed in valueAndGrads(f) must be a function"),(e,n)=>{z(Array.isArray(e)&&e.every(i=>i instanceof Qn),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),z(n==null||n instanceof Qn,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");const r=Q.gradients(()=>t(...e),e,n);return n!=null&&zi(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),$S(r.grads),r}}function i4(t,e){z(Fu(t),()=>"The f passed in variableGrads(f) must be a function"),z(e==null||Array.isArray(e)&&e.every(c=>c instanceof R0),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=e!=null;if(!n){e=[];for(const c in Q.registeredVariables)e.push(Q.registeredVariables[c])}const r=n?e.filter(c=>!c.trainable):null,i=e.length;e=e.filter(c=>c.trainable),z(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${i} variables is trainable.`);const s=!0,{value:o,grads:a}=Q.gradients(t,e,null,s);z(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),z(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const l={};return e.forEach((c,u)=>{a[u]!=null&&(l[c.name]=a[u])}),r!=null&&r.forEach(c=>l[c.name]=null),{value:o,grads:l}}function zl(t){return Q.customGrad(t)}function $S(t){if(t.filter(n=>n==null).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lce(t){const n={x:U(t,"x","neg")};return Q.runKernel(r0,n)}const $r=te({neg_:Lce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bce(t){const n={x:U(t,"x","softplus")};return Q.runKernel(cm,n)}const Nm=te({softplus_:Bce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zce(t){const e=U(t,"x","logSigmoid");return zl(r=>({value:$r(Nm($r(r))),gradFunc:o=>se(o,Bl($r(r)))}))(e)}const Vce=te({logSigmoid_:zce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uce(t,e=null,n=!1){const i={x:U(t,"x","max")},s={reductionIndices:e,keepDims:n};return Q.runKernel(Zy,i,s)}const Ja=te({max_:Uce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wce(t,e){let n=U(t,"a","sub"),r=U(e,"b","sub");[n,r]=Ir(n,r);const i={a:n,b:r};return Q.runKernel(fm,i)}const mt=te({sub_:Wce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gce(t,e=null,n=!1){let r=U(t,"x","sum");r.dtype==="bool"&&(r=Qe(r,"int32"));const i={x:r},s={axis:e,keepDims:n};return Q.runKernel(g0,i,s)}const xt=te({sum_:Gce});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hce(t,e=-1){const n=U(t,"logits","logSoftmax");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);return zl((i,s)=>{const o=!0,a=Ja(i,e,!0),l=mt(i,a),c=mt(Qe(l,"float32"),$o(xt(Mo(l),e,o)));return s([c]),{value:c,gradFunc:(h,f)=>{const[d]=f,p=!0,m=Mo(d);return mt(h,se(xt(h,e,p),m))}}})(n)}const II=te({logSoftmax_:Hce});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NI(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function s4(t,e,n){const r=t.length+e.length,i=[];let s=0,o=0;for(let a=0;a<r;a++)n.indexOf(a)===-1?i.push(t[s++]):i.push(e[o++]);return i}function Mi(t,e){const n=[],r=t.length;for(let s=0;s<r;s++)e.indexOf(s)===-1&&n.push(t[s]);const i=e.map(s=>t[s]);return[n,i]}function Gr(t,e){const n=e.map(r=>1);return s4(t,n,e)}function Wi(t,e,n){z(NI(e,n),()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`)}function Hr(t,e){if(NI(t,e))return null;const n=[];for(let r=0;r<e;++r)t.indexOf(r)===-1&&n.push(r);return t.forEach(r=>n.push(r)),n}function $m(t){return t.map((e,n)=>[n,e]).sort((e,n)=>e[1]-n[1]).map(e=>e[0])}function si(t,e){const n=[];for(let r=e-t;r<e;++r)n.push(r);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jce(t,e=null,n=!1){const r=U(t,"x","logSumExp"),i=hn(e,r.shape),s=Ja(r,i,!0),o=mt(r,s),a=Mo(o),l=xt(a,i),c=$o(l),u=Be(fe(s,c.shape),c);if(n){const h=Gr(u.shape,i);return fe(u,h)}return u}const o4=te({logSumExp_:jce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qce(t,e){const n=U(t,"a","logicalAnd","bool"),r=U(e,"b","logicalAnd","bool");Qt(n.shape,r.shape);const i={a:n,b:r};return Q.runKernel(qy,i)}const Vl=te({logicalAnd_:qce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xce(t){const n={x:U(t,"x","logicalNot","bool")};return Q.runKernel(Xy,n)}const RS=te({logicalNot_:Xce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kce(t,e){const n=U(t,"a","logicalOr","bool"),r=U(e,"b","logicalOr","bool");Qt(n.shape,r.shape);const i={a:n,b:r};return Q.runKernel(Ky,i)}const $I=te({logicalOr_:Kce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yce(t,e){const n=U(t,"a","logicalXor","bool"),r=U(e,"b","logicalXor","bool");return Qt(n.shape,r.shape),Vl($I(t,e),RS(Vl(t,e)))}const Zce=te({logicalXor_:Yce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jce(t,e,n,r,i){const s=U(t,"x","maxPool"),o=1;let a=s,l=!1;s.rank===3&&(l=!0,a=fe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),z(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),z(Ui(n,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),ps("maxPool",r,i);const c={x:a},u={filterSize:e,strides:n,pad:r,dimRoundingMode:i},h=Q.runKernel(Jy,c,u);return l?fe(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const DS=te({maxPool_:Jce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qce(t,e=[1,1,1],n,r,i,s="NDHWC"){const o=U(t,"x","maxPool3d");let a=o,l=!1;o.rank===4&&(l=!0,a=fe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),z(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),z(s==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),ps("maxPool3d",r,i);const c={x:a},u={filterSize:e,strides:n,pad:r,dimRoundingMode:i,dataFormat:s},h=Q.runKernel(Qy,c,u);return l?fe(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const RI=te({maxPool3d_:Qce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eue(t,e,n,r,i=!1){const o={x:U(t,"x","maxPoolWithArgmax")},a={filterSize:e,strides:n,pad:r,includeBatchInIndex:i},l=Q.runKernel(O_,o,a);return{result:l[0],indexes:l[1]}}const a4=te({maxPoolWithArgmax_:eue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tue(t,e){let n=U(t,"a","maximum"),r=U(e,"b","maximum");[n,r]=Ir(n,r),n.dtype==="bool"&&(n=Qe(n,"int32"),r=Qe(r,"int32")),Qt(n.shape,r.shape);const i={a:n,b:r};return Q.runKernel(Xp,i)}const Bc=te({maximum_:tue});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nue(t,e=null,n=!1){const i={x:U(t,"x","mean")},s={axis:e,keepDims:n};return Q.runKernel(e0,i,s)}const Br=te({mean_:nue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zr(t,e="float32"){if(e==="complex64"){const r=zr(t,"float32"),i=zr(t,"float32");return zu(r,i)}const n=Vi(_e(t),e);return Q.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function io(t,e="float32"){if(e==="complex64"){const r=io(t,"float32"),i=zr(t,"float32");return zu(r,i)}const n=bM(_e(t),e);return Q.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rue(t,e,{indexing:n="xy"}={}){if(n!=="xy"&&n!=="ij")throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(t===void 0)return[];let r=U(t,"x","meshgrid",t instanceof Qn?t.dtype:"float32");if(e===void 0)return[r];let i=U(e,"y","meshgrid",e instanceof Qn?e.dtype:"float32");const s=_e(r.shape),o=_e(i.shape);return n==="xy"?(r=fe(r,[1,-1]),i=fe(i,[-1,1]),[gn(io([o,1],r.dtype),r),gn(i,io([1,s],i.dtype))]):(r=fe(r,[-1,1]),i=fe(i,[1,-1]),[gn(r,io([1,o],r.dtype)),gn(io([s,1],i.dtype),i)])}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iue(t,e=null,n=!1){const i={x:U(t,"x","min")},s={axis:e,keepDims:n};return Q.runKernel(t0,i,s)}const PS=te({min_:iue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sue(t,e){let n=U(t,"a","minimum"),r=U(e,"b","minimum");[n,r]=Ir(n,r),n.dtype==="bool"&&(n=Qe(n,"int32"),r=Qe(r,"int32")),Qt(n.shape,r.shape);const i={a:n,b:r};return Q.runKernel(Kp,i)}const U0=te({minimum_:sue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oue(t,e,n){z(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const r=U(t,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");z(e.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`);const i=n==="reflect"?1:0;for(let a=0;a<r.rank;a++)z(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),z(e[a][0]>=0&&e[a][0]<=r.shape[a]-i&&e[a][1]>=0&&e[a][1]<=r.shape[a]-i,()=>`Padding in dimension ${a} cannot be greater than or equal to ${r.shape[a]-i} or less than 0 for input of shape ${r.shape}`);const s={paddings:e,mode:n},o={x:r};return Q.runKernel(n0,o,s)}const l4=te({mirrorPad_:oue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aue(t,e){let n=U(t,"a","mod"),r=U(e,"b","mod");[n,r]=Ir(n,r);const i={a:n,b:r};return Q.runKernel(Yp,i)}const c4=te({mod_:aue});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lue(t){const e=U(t,"x","square"),n={};return Q.runKernel("Square",{x:e},n)}const nr=te({square_:lue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cue(t,e=null,n=!1){t=U(t,"x","moments");const r=hn(e,t.shape),i=Br(t,r,n);let s=i.shape;n||(s=Gr(i.shape,r));const o=nr(mt(Qe(t,"float32"),fe(i,s))),a=Br(o,r,n);return{mean:i,variance:a}}const OS=te({moments_:cue});function uue(t,e,n,r){const i=U(e,"data","multiRNNCell"),s=D0(n,"c","multiRNNCell"),o=D0(r,"h","multiRNNCell");let a=i;const l=[];for(let h=0;h<t.length;h++){const f=t[h](a,s[h],o[h]);l.push(f[0]),l.push(f[1]),a=f[1]}const c=[],u=[];for(let h=0;h<l.length;h+=2)c.push(l[h]),u.push(l[h+1]);return[c,u]}const hue=te({multiRNNCell_:uue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fue(t,e,n,r=!1){const i=U(t,"logits","multinomial"),s=i.size,o=i.rank;if(s<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${s}.`);if(o>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${o}`);n=n||Math.random();const l={logits:o===1?fe(i,[1,-1]):i},c={numSamples:e,seed:n,normalized:r},u=Q.runKernel(F_,l,c);return o===1?fe(u,[u.size]):u}const u4=te({multinomial_:fue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function due(t,e){let n=U(t,"a","notEqual","string_or_numeric"),r=U(e,"b","notEqual","string_or_numeric");[n,r]=Ir(n,r),Qt(n.shape,r.shape);const i={a:n,b:r};return Q.runKernel(i0,i)}const Rm=te({notEqual_:due});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pue(t){const n={x:U(t,"x","onesLike")};return Q.runKernel(s0,n)}const Ro=te({onesLike_:pue});function mue(t,e){const n=U(t,"v1","outerProduct"),r=U(e,"v2","outerProduct");z(n.rank===1&&r.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`);const i=fe(n,[-1,1]),s=fe(r,[1,-1]);return gn(i,s)}const gue=te({outerProduct_:mue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vue(t,e,n=0){const r=U(t,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const i={paddings:e,constantValue:n},s={x:r};return Q.runKernel(l0,s,i)}const qu=te({pad_:vue});function yue(t,e,n=0){return z(e.length===2,()=>"Invalid number of paddings. Must be length of 2."),qu(t,[e],n)}const bue=te({pad1d_:yue});function wue(t,e,n=0){return z(e.length===2&&e[0].length===2&&e[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),qu(t,e,n)}const xue=te({pad2d_:wue});function _ue(t,e,n=0){return z(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),qu(t,e,n)}const Sue=te({pad3d_:_ue});function Cue(t,e,n=0){return z(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),qu(t,e,n)}const Tue=te({pad4d_:Cue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eue(t,e,n){const r=U(t,"x","spaceToBatchND");z(r.rank>=1+e.length,()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`),z(n.length===e.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`),z(r.shape.reduce((o,a,l)=>l>0&&l<=e.length?o&&(a+n[l-1][0]+n[l-1][1])%e[l-1]==0:o,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`);const i={x:r},s={blockShape:e,paddings:n};return Q.runKernel(v0,i,s)}const FS=te({spaceToBatchND_:Eue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kue(t,e,n,r,i,s,o){i==null&&(i=[1,1]),s==null&&(s=1),r===0&&(r="valid");const a=U(t,"x","maxPool");let l=a,c=!1;a.rank===3&&(c=!0,l=fe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),z(Ui(s,i),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${s} and dilations '${i}'`);const u=ca(l.shape,e,s,i,r),h=[u.dilationHeight,u.dilationWidth];let f;r==="same"?f=Mue([u.filterHeight,u.filterWidth],h):f=[[0,0],[0,0]];const d=h[0]===1&&h[1]===1,[p,m]=Aue([u.inHeight,u.inWidth],h,f),v=d?r:"valid",y=d?l:FS(l,h,p),x=(n==="avg"?()=>ES(y,e,s,v,o):()=>DS(y,e,s,v,o))(),_=d?x:kS(x,h,m);return c?fe(_,[_.shape[1],_.shape[2],_.shape[3]]):_}function Aue(t,e,n){const r=n.map(u=>u[0]),i=n.map(u=>u[1]),s=t.concat(r,i),o=e.map((u,h)=>(u-s[h]%u)%u),a=i.map((u,h)=>u+o[h]),l=e.map((u,h)=>[r[h],a[h]]),c=e.map((u,h)=>[0,o[h]]);return[l,c]}function Mue(t,e){const r=t.map((o,a)=>o+(o-1)*(e[a]-1)).map(o=>o-1),i=r.map(o=>Math.floor(o/2)),s=r.map((o,a)=>o-i[a]);return r.map((o,a)=>[i[a],s[a]])}const Iue=te({pool_:kue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nue(t,e){let n=U(t,"base","pow"),r=U(e,"exp","pow");[n,r]=Ir(n,r);const i={a:n,b:r};return Q.runKernel(Jp,i)}const Xu=te({pow_:Nue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ue(t,e){const n=U(t,"x","prelu"),r=U(e,"alpha","prelu"),i={x:n,alpha:r};return Q.runKernel(c0,i)}const LS=te({prelu_:$ue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rue(t,e=null,n=!1){let r=U(t,"x","prod");r.dtype==="bool"&&(r=Qe(r,"int32"));const i={x:r},s={axis:e,keepDims:n};return Q.runKernel(V_,i,s)}const DI=te({prod_:Rue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Due(t,e,n){const r=_e(t);let i=null;if(n==null||n==="float32")i=new Float32Array(r);else if(n==="int32")i=new Int32Array(r);else if(n==="bool")i=new Uint8Array(r);else throw new Error(`Unknown data type ${n}`);for(let s=0;s<r;s++)i[s]=e();return Q.makeTensor(i,t,n)}const Pue=te({rand_:Due});var h4={exports:{}};(function(t){(function(e,n,r){function i(l){var c=this,u=a();c.next=function(){var h=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=h-(c.c=h|0)},c.c=1,c.s0=u(" "),c.s1=u(" "),c.s2=u(" "),c.s0-=u(l),c.s0<0&&(c.s0+=1),c.s1-=u(l),c.s1<0&&(c.s1+=1),c.s2-=u(l),c.s2<0&&(c.s2+=1),u=null}function s(l,c){return c.c=l.c,c.s0=l.s0,c.s1=l.s1,c.s2=l.s2,c}function o(l,c){var u=new i(l),h=c&&c.state,f=u.next;return f.int32=function(){return u.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,h&&(typeof h=="object"&&s(h,u),f.state=function(){return s(u,{})}),f}function a(){var l=4022871197,c=function(u){u=u.toString();for(var h=0;h<u.length;h++){l+=u.charCodeAt(h);var f=.02519603282416938*l;l=f>>>0,f-=l,f*=l,l=f>>>0,f-=l,l+=f*4294967296}return(l>>>0)*23283064365386963e-26};return c}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.alea=o})($t,t,!1)})(h4);var f4={exports:{}};(function(t){(function(e,n,r){function i(a){var l=this,c="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var h=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^h^h>>>8},a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,l.next()}function s(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var c=new i(a),u=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var f=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},h.int32=c.next,h.quick=h,u&&(typeof u=="object"&&s(u,c),h.state=function(){return s(c,{})}),h}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xor128=o})($t,t,!1)})(f4);var d4={exports:{}};(function(t){(function(e,n,r){function i(a){var l=this,c="";l.next=function(){var h=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(h^h<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,u==c.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function s(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var c=new i(a),u=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var f=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},h.int32=c.next,h.quick=h,u&&(typeof u=="object"&&s(u,c),h.state=function(){return s(c,{})}),h}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xorwow=o})($t,t,!1)})(d4);var p4={exports:{}};(function(t){(function(e,n,r){function i(a){var l=this;l.next=function(){var u=l.x,h=l.i,f,d;return f=u[h],f^=f>>>7,d=f^f<<24,f=u[h+1&7],d^=f^f>>>10,f=u[h+3&7],d^=f^f>>>3,f=u[h+4&7],d^=f^f<<7,f=u[h+7&7],f=f^f<<13,d^=f^f<<9,u[h]=d,l.i=h+1&7,d};function c(u,h){var f,d=[];if(h===(h|0))d[0]=h;else for(h=""+h,f=0;f<h.length;++f)d[f&7]=d[f&7]<<15^h.charCodeAt(f)+d[f+1&7]<<13;for(;d.length<8;)d.push(0);for(f=0;f<8&&d[f]===0;++f);for(f==8&&(d[7]=-1),u.x=d,u.i=0,f=256;f>0;--f)u.next()}c(l,a)}function s(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var c=new i(a),u=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var f=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},h.int32=c.next,h.quick=h,u&&(u.x&&s(u,c),h.state=function(){return s(c,{})}),h}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xorshift7=o})($t,t,!1)})(p4);var m4={exports:{}};(function(t){(function(e,n,r){function i(a){var l=this;l.next=function(){var u=l.w,h=l.X,f=l.i,d,p;return l.w=u=u+1640531527|0,p=h[f+34&127],d=h[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,p=h[f]=p^d,l.i=f,p+(u^u>>>16)|0};function c(u,h){var f,d,p,m,v,y=[],w=128;for(h===(h|0)?(d=h,h=null):(h=h+"\0",d=0,w=Math.max(w,h.length)),p=0,m=-32;m<w;++m)h&&(d^=h.charCodeAt((m+32)%h.length)),m===0&&(v=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,m>=0&&(v=v+1640531527|0,f=y[m&127]^=d+v,p=f==0?p+1:0);for(p>=128&&(y[(h&&h.length||0)&127]=-1),p=127,m=4*128;m>0;--m)d=y[p+34&127],f=y[p=p+1&127],d^=d<<13,f^=f<<17,d^=d>>>15,f^=f>>>12,y[p]=d^f;u.w=v,u.X=y,u.i=p}c(l,a)}function s(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var c=new i(a),u=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var f=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},h.int32=c.next,h.quick=h,u&&(u.X&&s(u,c),h.state=function(){return s(c,{})}),h}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xor4096=o})($t,t,!1)})(m4);var g4={exports:{}};(function(t){(function(e,n,r){function i(a){var l=this,c="";l.next=function(){var h=l.b,f=l.c,d=l.d,p=l.a;return h=h<<25^h>>>7^f,f=f-d|0,d=d<<24^d>>>8^p,p=p-h|0,l.b=h=h<<20^h>>>12^f,l.c=f=f-d|0,l.d=d<<16^f>>>16^p,l.a=p-h|0},l.a=0,l.b=0,l.c=2654435769|0,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):c+=a;for(var u=0;u<c.length+20;u++)l.b^=c.charCodeAt(u)|0,l.next()}function s(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var c=new i(a),u=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var f=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},h.int32=c.next,h.quick=h,u&&(typeof u=="object"&&s(u,c),h.state=function(){return s(c,{})}),h}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.tychei=o})($t,t,!1)})(g4);var v4={exports:{}};(function(t){(function(e,n){var r=this,i=256,s=6,o=52,a="random",l=n.pow(i,s),c=n.pow(2,o),u=c*2,h=i-1,f;function d(_,S,T){var E=[];S=S==!0?{entropy:!0}:S||{};var k=y(v(S.entropy?[_,x(e)]:_==null?w():_,3),E),A=new p(E),M=function(){for(var D=A.g(s),P=l,N=0;D<c;)D=(D+N)*i,P*=i,N=A.g(1);for(;D>=u;)D/=2,P/=2,N>>>=1;return(D+N)/P};return M.int32=function(){return A.g(4)|0},M.quick=function(){return A.g(4)/4294967296},M.double=M,y(x(A.S),e),(S.pass||T||function(D,P,N,R){return R&&(R.S&&m(R,A),D.state=function(){return m(A,{})}),N?(n[a]=D,P):D})(M,k,"global"in S?S.global:this==n,S.state)}n["seed"+a]=d;function p(_){var S,T=_.length,E=this,k=0,A=E.i=E.j=0,M=E.S=[];for(T||(_=[T++]);k<i;)M[k]=k++;for(k=0;k<i;k++)M[k]=M[A=h&A+_[k%T]+(S=M[k])],M[A]=S;(E.g=function(D){for(var P,N=0,R=E.i,F=E.j,O=E.S;D--;)P=O[R=h&R+1],N=N*i+O[h&(O[R]=O[F=h&F+P])+(O[F]=P)];return E.i=R,E.j=F,N})(i)}function m(_,S){return S.i=_.i,S.j=_.j,S.S=_.S.slice(),S}function v(_,S){var T=[],E=typeof _,k;if(S&&E=="object")for(k in _)try{T.push(v(_[k],S-1))}catch{}return T.length?T:E=="string"?_:_+"\0"}function y(_,S){for(var T=_+"",E,k=0;k<T.length;)S[h&k]=h&(E^=S[h&k]*19)+T.charCodeAt(k++);return x(S)}function w(){try{var _;return f&&(_=f.randomBytes)?_=_(i):(_=new Uint8Array(i),(r.crypto||r.msCrypto).getRandomValues(_)),x(_)}catch{var S=r.navigator,T=S&&S.plugins;return[+new Date,r,T,r.screen,x(e)]}}function x(_){return String.fromCharCode.apply(0,_)}if(y(n.random(),e),t.exports){t.exports=d;try{f=require("crypto")}catch{}}})([],Math)})(v4);var Oue=h4.exports,Fue=f4.exports,Lue=d4.exports,Bue=p4.exports,zue=m4.exports,Vue=g4.exports,Sf=v4.exports;Sf.alea=Oue;Sf.xor128=Fue;Sf.xorwow=Lue;Sf.xorshift7=Bue;Sf.xor4096=zue;Sf.tychei=Vue;var BS=Sf;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PI{constructor(e,n,r,i,s){this.mean=e,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=s||Math.random();this.random=BS.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const i=this.nextVal;return this.nextVal=NaN,i}let e,n,r=!1;for(;!r;){let i,s,o;do i=2*this.random()-1,s=2*this.random()-1,o=i*i+s*s;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*i*a,n=this.mean+this.stdDev*s*a,(!this.truncated||this.isValidTruncated(e))&&(r=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class Uue{constructor(e,n,r,i){this.alpha=e,this.beta=1/n,this.dtype=r;const s=i||Math.random();this.randu=BS.alea(s.toString()),this.randn=new PI(0,1,r,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,n,r,i,s,o;for(;;){do i=this.randn.nextValue(),o=1+this.c*i;while(o<=0);if(o*=o*o,e=i*i,n=1-.331*e*e,r=.5*e+this.d*(1-o+Math.log(o)),s=this.randu(),s<n||Math.log(s)<r)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(e){return this.dtype==="float32"?e:Math.round(e)}}class Wue{constructor(e=0,n=1,r,i){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=n-e,this.dtype=r,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${n} <= 1 and dtype is not float`);this.random=BS.alea(i)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gue(t,e,n=1,r="float32",i){if(n==null&&(n=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error(`Unsupported data type ${r}`);const s=new Uue(e,n,r,i),o=mn(t,r);for(let a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}const Hue=te({randomGamma_:Gue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jue(t,e=0,n=1,r,i){if(r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);const s=new PI(e,n,r,!1,i),o=mn(t,r);for(let a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}const y4=te({randomNormal_:jue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function que(t,e=0,n=1,r="float32",i){const s=mn(t,r),o=new Wue(e,n,null,i);for(let a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}const Dm=te({randomUniform_:que});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pm(t,e,n=1,r="float32"){if(n===0)throw new Error("Cannot have a step of zero");const i={start:t,stop:e,step:n,dtype:r};return Q.runKernel(U_,{},i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xue(t){const n={input:U(t,"input","real")};return Q.runKernel(W_,n)}const W0=te({real_:Xue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kue(t){const n={x:U(t,"x","reciprocal")};return Q.runKernel(Qp,n)}const b4=te({reciprocal_:Kue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yue(t){const n={x:U(t,"x","relu")};return Q.runKernel(em,n)}const Ul=te({relu_:Yue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zue(t){const n={x:U(t,"x","relu6")};return Q.runKernel(tm,n)}const OI=te({relu6_:Zue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jue(t,e){const r={x:U(t,"x","reverse")},i={dims:e};return Q.runKernel(d0,r,i)}const Do=te({reverse_:Jue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Que(t){const e=U(t,"x","reverse");return z(e.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`),Do(e,0)}const ehe=te({reverse1d_:Que});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function the(t,e){const n=U(t,"x","reverse");return z(n.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`),Do(n,e)}const nhe=te({reverse2d_:the});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rhe(t,e){const n=U(t,"x","reverse");return z(n.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`),Do(n,e)}const ihe=te({reverse3d_:rhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function she(t,e){const n=U(t,"x","reverse");return z(n.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`),Do(n,e)}const ohe=te({reverse4d_:she});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ahe(t){const n={x:U(t,"x","round")};return Q.runKernel(nm,n)}const FI=te({round_:ahe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lhe(t){const n={x:U(t,"x","rsqrt","float32")};return Q.runKernel(rm,n)}const LI=te({rsqrt_:lhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nt(t,e){if((Qi(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Qi(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Vu(t,[],[],e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function che(t){const n={x:U(t,"x","selu")};return Q.runKernel(im,n)}const BI=te({selu_:che});function uhe(t,e,n,r,i,s=[1,1],o="NHWC"){const a=U(t,"x","separableConv2d"),l=U(e,"depthwiseFilter","separableConv2d"),c=U(n,"pointwiseFilter","separableConv2d");let u=a,h=!1;if(a.rank===3&&(h=!0,u=fe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");z(u.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${u.rank}.`),z(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),z(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),z(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),z(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);const f=l.shape[2],d=l.shape[3];z(c.shape[2]===f*d,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${f*d}, but got ${c.shape[2]}.`);const p=B0(u,l,r,i,o,s),v=ju(p,c,1,"valid",o);return h?fe(v,[v.shape[1],v.shape[2],v.shape[3]]):v}const w4=te({separableConv2d_:uhe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function hhe(t,e){const n=U(t,"x","setdiff1d"),r=U(e,"y","setdiff1d");z(n.dtype===r.dtype,()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`),z(n.rank===1,()=>`x should be 1D tensor, but got x (${n.shape}).`),z(r.rank===1,()=>`y should be 1D tensor, but got y (${r.shape}).`);const i=await n.data(),s=await r.data(),o=new Set(s);let a=0;for(let u=0;u<i.length;u++)o.has(i[u])||a++;const l=new di([a],n.dtype),c=new di([a],"int32");for(let u=0,h=0;u<i.length;u++)o.has(i[u])||(l.values[h]=i[u],c.values[h]=u,h++);return[l.toTensor(),c.toTensor()]}const x4=hhe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fhe(t){const n={x:U(t,"x","sign")};return Q.runKernel(am,n)}const _4=te({sign_:fhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dhe(t){const n={x:U(t,"x","sin","float32")};return Q.runKernel(sm,n)}const zI=te({sin_:dhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function phe(t){const n={x:U(t,"x","sinh")};return Q.runKernel(om,n)}const VI=te({sinh_:phe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mhe(t,e,n){const r=U(t,"x","slice1d");return z(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),Cn(r,[e],[n])}const zS=te({slice1d_:mhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ghe(t,e,n){const r=U(t,"x","slice2d");return z(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),Cn(r,e,n)}const UI=te({slice2d_:ghe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vhe(t,e,n){const r=U(t,"x","slice3d");return z(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),Cn(r,e,n)}const VS=te({slice3d_:vhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yhe(t,e,n){const r=U(t,"x","slice4d");return z(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),Cn(r,e,n)}const G0=te({slice4d_:yhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bhe(t,e=-1){const n=U(t,"logits","softmax","float32");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const r={logits:n},i={dim:e};return Q.runKernel(b0,r,i)}const H0=te({softmax_:bhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function whe(t){z(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);const e={input:t};return Q.runKernel(E_,e)}const US=te({fft_:whe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xhe(t){z(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);const e={input:t};return Q.runKernel(I_,e)}const j0=te({ifft_:xhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _he(t){const e=t.shape[t.shape.length-1],n=t.size/e;let r;if(e<=2){const i=fe(t,[n,e]);r=j0(i)}else{const i=[n,2*(e-1)],s=fe(W0(t),[n,e]),o=fe(MS(t),[n,e]),a=Do(Cn(s,[0,1],[n,e-2]),1),l=se(Do(Cn(o,[0,1],[n,e-2]),1),Nt(-1)),c=ii([s,a],1),u=ii([o,l],1),h=fe(zu(c,u),[i[0],i[1]]);r=j0(h)}if(r=W0(r),t.rank===3&&t.shape[0]!==0){const i=r,s=t.shape[0];r=fe(r,[s,r.shape[0]/s,r.shape[1]]),i.dispose()}return r}const WI=te({irfft_:_he});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function She(t,e,n=0){const i={x:U(t,"x","split")},s={numOrSizeSplits:e,axis:n};return Q.runKernel(y0,i,s)}const so=te({split_:She});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Che(t,e){z(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let n=t.shape[t.shape.length-1];const r=t.size/n;let i;if(e!=null&&e<n){const p=t.shape.map(v=>0),m=t.shape.map(v=>v);m[t.shape.length-1]=e,i=Cn(t,p,m),n=e}else if(e!=null&&e>n){const p=t.shape.map(m=>m);p[t.shape.length-1]=e-n,i=ii([t,zr(p)],t.shape.length-1),n=e}else i=t;const s=In(i),o=fe(zu(i,s),[r,n]),a=US(o),l=Math.floor(n/2)+1,c=W0(a),u=MS(a),h=so(c,[l,n-l],c.shape.length-1),f=so(u,[l,n-l],u.shape.length-1),d=i.shape.slice();return d[i.shape.length-1]=l,fe(zu(h[0],f[0]),d)}const WS=te({rfft_:Che});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function The(t){const n={x:U(t,"x","sqrt","float32")};return Q.runKernel(um,n)}const es=te({sqrt_:The});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ehe(t,e){let n=U(t,"a","squaredDifference"),r=U(e,"b","squaredDifference");[n,r]=Ir(n,r),Qt(n.shape,r.shape);const i={a:n,b:r},s={};return Q.runKernel(hm,i,s)}const GI=te({squaredDifference_:Ehe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function khe(t,e){const n=U(t,"x","squeeze");return fe(n,Rc(n.shape,e).newShape)}const Wl=te({squeeze_:khe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ahe(t,e=0){const n=D0(t,"tensors","stack","string_or_numeric");z(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&z(e<=n[0].rank,()=>"Axis must be <= rank of the tensor");const r=n,i={axis:e};return Q.runKernel(a0,r,i)}const ha=te({stack_:Ahe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mhe(t,e=0){const r={x:U(t,"x","step")},i={alpha:e};return Q.runKernel(gm,r,i)}const q0=te({step_:Mhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ihe(t,e,n,r,i=0,s=0,o=0,a=0,l=0){const u={x:U(t,"x","stridedSlice","string_or_numeric")},h={begin:e,end:n,strides:r,beginMask:i,endMask:s,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return Q.runKernel(Q_,u,h)}const S4=te({stridedSlice_:Ihe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nhe(t){const n={x:U(t,"x","tan","float32")};return Q.runKernel(dm,n)}const C4=te({tan_:Nhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ts(t,e){rf(t);const n=Ll(t,e);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Vu(t,null,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oo(t,e,n){if(rf(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const r=Ll(t,n);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Vu(t,e,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $he(t,e,n){if(rf(t),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");const r=Ll(t,n);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Vu(t,e,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rhe(t,e,n){if(rf(t),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");const r=Ll(t,n);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Vu(t,e,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dhe(t,e,n){if(rf(t),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");const r=Ll(t,n);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||r,Vu(t,e,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Phe(t,e=1,n=!0){const r=U(t,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const i=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>i)throw new Error(`'k' passed to topk() must be <= the last dimension (${i}) but got ${e}`);const s={x:r},o={k:e,sorted:n},[a,l]=Q.runKernel(rS,s,o);return{values:a,indices:l}}const T4=te({topk_:Phe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ohe(t,e=0,n=1,r,i){if(r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");const s=new PI(e,n,r,!0,i),o=mn(t,r);for(let a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}const GS=te({truncatedNormal_:Ohe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fhe(t,e=0){const n=U(t,"x","unique","string_or_numeric");z(n.rank>0,()=>"The input tensor must be at least 1D");const r={x:n},i={axis:e},[s,o]=Q.runKernel(sS,r,i);return{values:s,indices:o}}const HI=te({unique_:Fhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lhe(t,e,n){const r=U(t,"x","unsortedSegmentSum"),i=U(e,"segmentIds","unsortedSegmentSum","int32");z(sf(n),()=>"numSegments must be of dtype int");const s={x:r,segmentIds:i},o={numSegments:n};return Q.runKernel(_0,s,o)}const E4=te({unsortedSegmentSum_:Lhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bhe(t,e=0){const n=U(t,"x","unstack","string_or_numeric");z(e>=-n.shape.length&&e<n.shape.length,()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`);const r={value:n},i={axis:e};return Q.runKernel(x0,r,i)}const Qa=te({unstack_:Bhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k4(t,e=!0,n,r){return Q.makeVariable(t,e,n,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HS(t,e){const n=[];for(let s=0;s<e.length;s++)e[s]&&n.push(s);const r=mn(t,"int32"),i=mn([n.length,t.length],"int32");for(let s=0;s<n.length;s++){const o=r.indexToLoc(n[s]),a=s*t.length;i.values.set(o,a)}return i.toTensor()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function zhe(t){const e=U(t,"condition","whereAsync","bool"),n=await e.data(),r=HS(e.shape,n);return t!==e&&e.dispose(),r}const jI=zhe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Vhe(t,e,n){const r=U(t,"tensor","boolMask"),i=U(e,"mask","boolMask","bool"),s=n==null?0:n,o=i.rank,a=r.shape;z(o>0,()=>"mask cannot be scalar"),zi(a.slice(s,s+o),i.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let m=s;m<s+o;m++)l*=a[m];const c=a.slice(0,s).concat([l],a.slice(s+o)),u=fe(r,c),h=fe(i,[-1]),f=await jI(h),d=Wl(f,[1]),p=Im(u,d,s);return t!==r&&r.dispose(),e!==i&&i.dispose(),d.dispose(),u.dispose(),h.dispose(),f.dispose(),p}const Uhe=Vhe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Whe(t,e="euclidean",n=null,r=!1){t=U(t,"x","norm");const i=A4(t,e,n);let s=i.shape;if(r){const o=hn(n,t.shape);s=Gr(i.shape,o)}return fe(i,s)}function A4(t,e,n=null){if(t.rank===0)return pi(t);if(t.rank!==1&&n===null)return A4(fe(t,[-1]),e,n);if(t.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(e===1)return xt(pi(t),n);if(e===1/0)return Ja(pi(t),n);if(e===-1/0)return PS(pi(t),n);if(e==="euclidean"||e===2)return es(xt(Xu(pi(t),Nt(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&n.length===2){if(e===1)return Ja(xt(pi(t),n[0]),n[1]-1);if(e===1/0)return Ja(xt(pi(t),n[1]),n[0]);if(e===-1/0)return PS(xt(pi(t),n[1]),n[0]);if(e==="fro"||e==="euclidean")return es(xt(nr(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const qI=te({norm_:Whe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ghe(t,e,n,r,i=!0){const s=U(t,"v","movingAverage"),o=U(e,"x","movingAverage"),a=U(n,"decay","movingAverage");VB(s,o),z(wn(s.shape,o.shape),()=>"Shape mismatch in v and x");const l=Nt(1),c=mt(l,a);let u=se(mt(o,s),c);if(i){z(r!=null,()=>"When using zeroDebias: true, step is required.");const h=U(r,"step","movingAverage");u=Tt(u,mt(l,Xu(a,h)))}return Be(s,u)}const Hhe=te({movingAverage_:Ghe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jhe(t,e,n){const r=U(t,"indices","scatterND","int32"),i=U(e,"updates","scatterND");sI(i,r,n);const s={indices:r,updates:i},o={shape:n};return Q.runKernel(j_,s,o)}const M4=te({scatterND_:jhe});function qhe(t,e,n,r){if(t.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const i=t.rank>0?t.shape[0]:1,s=t.rank>1?t.shape[1]:1;if(n.length!==s)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${s}.`);const o=e.size;if(!(e.rank===0||e.rank===1&&o===i))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${i}]`);if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xhe(t,e,n,r=0){const i=U(t,"sparseIndices","sparseToDense","int32"),s=U(e,"sparseValues","sparseToDense"),o=U(r,"defaultValue","sparseToDense",s.dtype);qhe(i,s,n,o);const a={sparseIndices:i,sparseValues:s,defaultValue:o},l={outputShape:n};return Q.runKernel(Z_,a,l)}const XI=te({sparseToDense_:Xhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Khe(t,e){const n=U(e,"indices","gatherND","int32"),i={params:U(t,"x","gatherND","string_or_numeric"),indices:n};return Q.runKernel(M_,i)}const I4=te({gatherND_:Khe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yhe(t,e){if(e==null)return t.shape.slice();if(wn(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let r=0;r<t.shape.length;r++)e[r]==null&&t.shape[r]!=null?n.push(t.shape[r]):n.push(e[r]);return n}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zhe(t,e,n,r){const i=U(t,"x","dropout");if(z(i.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${i.dtype} tensor instead.`),z(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return t instanceof Qn?i.clone():i;const s=Yhe(i,n),o=1-e,a=Tt(V0(Be(Dm(s,0,1,"float32",r),o)),o);return se(i,a)}const N4=te({dropout_:Zhe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $4(t){return Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2))))}function KI(t,e,n){const r=1-t%2,i=new Float32Array(t);for(let s=0;s<t;++s){const o=2*Math.PI*s/(t+r-1);i[s]=e-n*Math.cos(o)}return ts(i,"float32")}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Jhe(t,e,n=1){const r=U(t,"predictions","inTopK"),i=U(e,"targets","inTopK");z(r.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`),z(r.rank-1===i.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${i.rank}`),zi(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const s=r.shape[r.shape.length-1];z(n>0&&n<=s,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${s}), but got ${n}`);const o=await r.data(),a=await i.data(),[l,c]=[o.length/s,s],u=fi("bool",l);for(let h=0;h<l;h++){const f=h*c,d=o.subarray(f,f+c),p=[];for(let m=0;m<d.length;m++)p.push({value:d[m],index:m});p.sort((m,v)=>v.value-m.value),u[h]=0;for(let m=0;m<n;m++)if(p[m].index===a[h]){u[h]=1;break}}return t!==r&&r.dispose(),e!==i&&i.dispose(),to(u,i.shape,"bool")}const Qhe=Jhe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function efe(t,e,n,r,i,s="NHWC",o){let a=t;t.rank===3&&(a=fe(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=fe(e,[1,e.shape[0],e.shape[1],e.shape[2]])),z(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),z(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),z(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const c=s==="NHWC"?a.shape[3]:a.shape[1],u=s==="NHWC"?l.shape[3]:l.shape[1];z(c===n[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`),z(u===n[3],()=>`Error in conv2dDerFilter: depth of dy (${u}) must match output depth for filter (${n[3]}).`),ps("conv2dDerFilter",i,o);const h={x:a,dy:l},f={strides:r,pad:i,dataFormat:s,dimRoundingMode:o,filterShape:n};return Q.runKernel(d_,h,f)}const YI=te({conv2DBackpropFilter_:efe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jS(t,e,n){if(n==null||n==="linear")return t;if(n==="relu")return se(t,q0(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function qS(t,e){let n=e;const r=ri(t.shape,e.shape);return r.length>0&&(n=xt(n,r)),fe(n,t.shape)}function XS(t,e,n,r){if(e==="linear")return t;if(e==="relu")return Ul(t);if(e==="elu")return z0(t);if(e==="relu6")return OI(t);if(e==="prelu")return LS(t,n);if(e==="leakyrelu")return IS(t,r);if(e==="sigmoid")return Bl(t);throw new Error(`Unknown fused activation ${e}.`)}const KS=(t,e)=>!(t>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tfe({x:t,filter:e,strides:n,pad:r,dataFormat:i="NHWC",dilations:s=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(l=l||"linear",KS(Q.state.gradientDepth,l)===!1){let S=ju(t,e,n,r,i,s,o);return a!=null&&(S=Be(S,a)),XS(S,l,c,u)}const h=U(t,"x","conv2d","float32"),f=U(e,"filter","conv2d","float32");let d=h,p=!1;h.rank===3&&(p=!0,d=fe(h,[1,h.shape[0],h.shape[1],h.shape[2]])),z(d.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${d.rank}.`),z(f.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${f.rank}.`),ps("fused conv2d",r,o),z(d.shape[3]===f.shape[2],()=>`Error in conv2d: depth of input (${d.shape[3]}) must match input depth for filter ${f.shape[2]}.`),z(Ui(n,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),z(i==="NHWC",()=>`Error in conv2d: got dataFormat of ${i} but only NHWC is currently supported.`);const m=Ai(d.shape,f.shape,n,s,r,o);let v;a!=null&&(v=U(a,"bias","fused conv2d"),[v]=Ir(v,h),Qt(m.outShape,v.shape));let y;c!=null&&(y=U(c,"prelu weights","fused conv2d"));const w=(S,T)=>{const[E,k,A,M]=T,D=jS(S,A,l);z(Hu(s),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const P=SI(k.shape,D,E,n,r),N=YI(k,D,E.shape,n,r),R=[P,N];if(M!=null){const F=qS(M,D);R.push(F)}return R},x={x:d,filter:f,bias:v,preluActivationWeights:y},_={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o,activation:l,leakyreluAlpha:u};return a==null?zl((T,E,k)=>{let A=Q.runKernel(T0,x,_);return k([E,T,A]),p&&(A=fe(A,[A.shape[1],A.shape[2],A.shape[3]])),{value:A,gradFunc:w}})(d,f):zl((T,E,k,A)=>{let M=Q.runKernel(T0,x,_);return A([E,T,M,k]),p&&(M=fe(M,[M.shape[1],M.shape[2],M.shape[3]])),{value:M,gradFunc:w}})(d,f,v)}const ZI=te({fusedConv2d_:tfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nfe(t,e,n,r,i,s=[1,1],o){let a=t;t.rank===3&&(a=fe(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=fe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:l},u={strides:r,pad:i,dimRoundingMode:o,dilations:s,filterShape:n};return Q.runKernel(b_,c,u)}const R4=te({depthwiseConv2dNativeBackpropFilter_:nfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rfe(t,e,n,r,i,s=[1,1],o){let a=e,l=!1;e.rank===3&&(l=!0,a=fe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:n},u={strides:r,pad:i,dimRoundingMode:o,dilations:s,inputShape:t},h=Q.runKernel(w_,c,u);return l?fe(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const D4=te({depthwiseConv2dNativeBackpropInput_:rfe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ife({x:t,filter:e,strides:n,pad:r,dataFormat:i="NHWC",dilations:s=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(KS(Q.state.gradientDepth,l)===!1){let S=B0(t,e,n,r,i,s,o);return a!=null&&(S=Be(S,a)),XS(S,l,c,u)}const h=U(t,"x","depthwiseConv2d","float32"),f=U(e,"filter","depthwiseConv2d","float32");let d=h,p=!1;h.rank===3&&(p=!0,d=fe(h,[1,h.shape[0],h.shape[1],h.shape[2]])),z(d.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${d.rank}.`),z(f.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${f.rank}.`),z(d.shape[3]===f.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${d.shape[3]}) must match the inChannels dimension in filter ${f.shape[2]}.`),s==null&&(s=[1,1]),z(Ui(n,s),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),ps("fused depthwiseConv2d",r,o);const m=Ai(d.shape,f.shape,n,s,r,o,!0);let v;a!=null&&(v=U(a,"bias","fused conv2d"),[v]=Ir(v,h),Qt(m.outShape,v.shape));let y;c!=null&&(y=U(c,"prelu weights","fused depthwiseConv2d"));const w=(S,T)=>{z(Hu(s),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);const[E,k,A,M]=T,D=jS(S,A,l),P=D4(k.shape,D,E,n,r,s,o),N=R4(k,D,E.shape,n,r,s,o);if(M!=null){const R=qS(v,D);return[P,N,R]}return[P,N]},x={x:d,filter:f,bias:v,preluActivationWeights:y},_={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o,activation:l,leakyreluAlpha:u};return a==null?zl((T,E,k)=>{let A=Q.runKernel(E0,x,_);return k([E,T,A]),p&&(A=fe(A,[A.shape[1],A.shape[2],A.shape[3]])),{value:A,gradFunc:w}})(d,f):zl((T,E,k,A)=>{let M=Q.runKernel(E0,x,_);return A([E,T,M,k]),p&&(M=fe(M,[M.shape[1],M.shape[2],M.shape[3]])),{value:M,gradFunc:w}})(d,f,v)}const P4=te({fusedDepthwiseConv2d_:ife});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sfe({a:t,b:e,transposeA:n=!1,transposeB:r=!1,bias:i,activation:s="linear",preluActivationWeights:o,leakyreluAlpha:a}){if(KS(Q.state.gradientDepth,s)===!1){let D=gn(t,e,n,r);return i!=null&&(D=Be(D,i)),XS(D,s,o,a)}let l=U(t,"a","fused matMul"),c=U(e,"b","fused matMul");[l,c]=Ir(l,c);const u=n?l.shape[l.rank-2]:l.shape[l.rank-1],h=r?c.shape[c.rank-1]:c.shape[c.rank-2],f=n?l.shape[l.rank-1]:l.shape[l.rank-2],d=r?c.shape[c.rank-2]:c.shape[c.rank-1],p=l.shape.slice(0,-2),m=c.shape.slice(0,-2),v=_e(p),y=_e(m);z(u===h,()=>`Error in fused matMul: inner shapes (${u}) and (${h}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${n} and transposeB=${r} must match.`);const x=Qt(l.shape.slice(0,-2),c.shape.slice(0,-2)).concat([f,d]),_=n?fe(l,[v,u,f]):fe(l,[v,f,u]),S=r?fe(c,[y,d,h]):fe(c,[y,h,d]);let T;i!=null&&(T=U(i,"bias","fused matMul"),[T]=Ir(T,l),Qt(x,T.shape));let E;o!=null&&(E=U(o,"prelu weights","fused matMul"));const k=(D,P)=>{const[N,R,F,O]=P,K=jS(fe(D,F.shape),F,s);let J,re;if(!n&&!r?(J=gn(K,R,!1,!0),re=gn(N,K,!0,!1)):!n&&r?(J=gn(K,R,!1,!1),re=gn(K,N,!0,!1)):n&&!r?(J=gn(R,K,!1,!0),re=gn(N,K,!1,!1)):(J=gn(R,K,!0,!0),re=gn(K,N,!0,!0)),i!=null){const ae=qS(O,K);return[J,re,ae]}else return[J,re]},A={a:_,b:S,bias:T,preluActivationWeights:E},M={transposeA:n,transposeB:r,activation:s,leakyreluAlpha:a};return i==null?zl((P,N,R)=>{const F=Q.runKernel(C0,A,M);return R([P,N,F]),{value:fe(F,x),gradFunc:k}})(_,S):zl((P,N,R,F)=>{const O=Q.runKernel(C0,A,M);return F([P,N,O,R]),{value:fe(O,x),gradFunc:k}})(_,S,T)}const YS=te({fusedMatMul_:sfe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ofe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",conv2d:ZI,depthwiseConv2d:P4,matMul:YS});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function afe(t){return KI(t,.54,.46)}const lfe=te({hammingWindow_:afe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cfe(t){return KI(t,.5,.5)}const O4=te({hannWindow_:cfe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ufe(t,e,n,r=!1,i=0){let s=0;const o=[];for(;s+e<=t.size;)o.push(Cn(t,s,e)),s+=n;if(r)for(;s<t.size;){const a=s+e-t.size,l=ii([Cn(t,s,e-a),Mm([a],i)]);o.push(l),s+=n}return o.length===0?oo([],[0,e]):fe(ii(o),[o.length,e])}const F4=te({frame_:ufe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hfe(t,e,n,r,i=O4){r==null&&(r=$4(e));const s=F4(t,e,n),o=se(s,i(e));return WS(o,r)}const ffe=te({stft_:hfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dfe(t,e,n,r,i="bilinear",s=0){const o=U(t,"image","cropAndResize"),a=U(e,"boxes","cropAndResize","float32"),l=U(n,"boxInd","cropAndResize","int32"),c=a.shape[0];z(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),z(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`),z(l.rank===1&&l.shape[0]===c,()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`),z(r.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),z(r[0]>=1&&r[1]>=1,()=>`cropSize must be atleast [1,1], but was ${r}`),z(i==="bilinear"||i==="nearest",()=>`method must be bilinear or nearest, but was ${i}`);const u={image:o,boxes:a,boxInd:l},h={method:i,extrapolationValue:s,cropSize:r};return Q.runKernel(g_,u,h)}const pfe=te({cropAndResize_:dfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mfe(t){const e=U(t,"image","flipLeftRight","float32");z(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const n={image:e};return Q.runKernel(A_,n,{})}const gfe=te({flipLeftRight_:mfe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vfe(t){const e=U(t,"image","grayscaleToRGB"),n=e.rank-1,r=e.shape[n];z(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),z(r===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`);const i=new Array(e.rank);return i.fill(1,0,n),i[n]=3,ua(e,i)}const yfe=te({grayscaleToRGB_:vfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bfe(t,e,n=0,r=.5){const i=U(t,"image","rotateWithOffset","float32");z(i.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${i.rank}.`);const s={image:i},o={radians:e,fillValue:n,center:r};return Q.runKernel(aS,s,o)}const wfe=te({rotateWithOffset_:bfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Om(t,e,n,r,i,s){r==null&&(r=.5),i==null&&(i=Number.NEGATIVE_INFINITY),s==null&&(s=0);const o=t.shape[0];return n=Math.min(n,o),z(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),z(t.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`),z(t.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`),z(e.rank===1,()=>"scores must be a 1D tensor"),z(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),z(0<=s&&s<=1,()=>`softNmsSigma must be in [0, 1], but was '${s}'`),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xfe(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY){const s=U(t,"boxes","nonMaxSuppression","float32"),o=U(e,"scores","nonMaxSuppression","float32"),a=Om(s,o,n,r,i);n=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold;const l={maxOutputSize:n,iouThreshold:r,scoreThreshold:i};return Q.runKernel(L_,{boxes:s,scores:o},l)}const _fe=te({nonMaxSuppression_:xfe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sfe(t,e,n){const r=Cfe(t,e,n),i=r<0?-(r+1):r;t.splice(i,0,e)}function Cfe(t,e,n){return Efe(t,e,n||Tfe)}function Tfe(t,e){return t>e?1:t<e?-1:0}function Efe(t,e,n){let r=0,i=t.length,s=0,o=!1;for(;r<i;){s=r+(i-r>>>1);const a=n(e,t[s]);a>0?r=s+1:(i=s,o=!a)}return o?r:-r-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZS(t,e,n,r,i){return JI(t,e,n,r,i,0)}function JS(t,e,n,r,i,s){return JI(t,e,n,r,i,0,!1,s,!0)}function QS(t,e,n,r,i,s){return JI(t,e,n,r,i,s,!0)}function JI(t,e,n,r,i,s,o=!1,a=!1,l=!1){const c=[];for(let v=0;v<e.length;v++)e[v]>i&&c.push({score:e[v],boxIndex:v,suppressBeginIndex:0});c.sort(L4);const u=s>0?-.5/s:0,h=[],f=[];for(;h.length<n&&c.length>0;){const v=c.pop(),{score:y,boxIndex:w,suppressBeginIndex:x}=v;if(y<i)break;let _=!1;for(let S=h.length-1;S>=x;--S){const T=kfe(t,w,h[S]);if(T>=r){_=!0;break}if(v.score=v.score*Afe(r,u,T),v.score<=i)break}v.suppressBeginIndex=h.length,_||(v.score===y?(h.push(w),f.push(v.score)):v.score>i&&Sfe(c,v,L4))}const d=h.length,p=n-d;a&&p>0&&(h.push(...new Array(p).fill(0)),f.push(...new Array(p).fill(0)));const m={selectedIndices:h};return o&&(m.selectedScores=f),l&&(m.validOutputs=d),m}function kfe(t,e,n){const r=t.subarray(e*4,e*4+4),i=t.subarray(n*4,n*4+4),s=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),c=Math.min(i[0],i[2]),u=Math.min(i[1],i[3]),h=Math.max(i[0],i[2]),f=Math.max(i[1],i[3]),d=(a-s)*(l-o),p=(h-c)*(f-u);if(d<=0||p<=0)return 0;const m=Math.max(s,c),v=Math.max(o,u),y=Math.min(a,h),w=Math.min(l,f),x=Math.max(y-m,0)*Math.max(w-v,0);return x/(d+p-x)}function Afe(t,e,n){const r=Math.exp(e*n*n);return n<=t?r:0}function L4(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Mfe(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY){const s=U(t,"boxes","nonMaxSuppressionAsync"),o=U(e,"scores","nonMaxSuppressionAsync"),a=Om(s,o,n,r,i);n=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold;const l=await Promise.all([s.data(),o.data()]),c=l[0],u=l[1],{selectedIndices:h}=ZS(c,u,n,r,i);return s!==t&&s.dispose(),o!==e&&o.dispose(),ts(h,"int32")}const Ife=Mfe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nfe(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=0){const o=U(t,"boxes","nonMaxSuppression"),a=U(e,"scores","nonMaxSuppression"),l=Om(o,a,n,r,i,s);n=l.maxOutputSize,r=l.iouThreshold,i=l.scoreThreshold,s=l.softNmsSigma;const c={boxes:o,scores:a},u={maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:s},h=Q.runKernel(z_,c,u);return{selectedIndices:h[0],selectedScores:h[1]}}const $fe=te({nonMaxSuppressionWithScore_:Nfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Rfe(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=0){const o=U(t,"boxes","nonMaxSuppressionAsync"),a=U(e,"scores","nonMaxSuppressionAsync"),l=Om(o,a,n,r,i,s);n=l.maxOutputSize,r=l.iouThreshold,i=l.scoreThreshold,s=l.softNmsSigma;const c=await Promise.all([o.data(),a.data()]),u=c[0],h=c[1],{selectedIndices:f,selectedScores:d}=QS(u,h,n,r,i,s);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:ts(f,"int32"),selectedScores:ts(d)}}const Dfe=Rfe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pfe(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=!1){const o=U(t,"boxes","nonMaxSuppression"),a=U(e,"scores","nonMaxSuppression"),l=Om(o,a,n,r,i,null),c=l.maxOutputSize,u=l.iouThreshold,h=l.scoreThreshold,f={boxes:o,scores:a},d={maxOutputSize:c,iouThreshold:u,scoreThreshold:h,padToMaxOutputSize:s},p=Q.runKernel(B_,f,d);return{selectedIndices:p[0],validOutputs:p[1]}}const Ofe=te({nonMaxSuppressionPadded_:Pfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Ffe(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=!1){const o=U(t,"boxes","nonMaxSuppressionAsync"),a=U(e,"scores","nonMaxSuppressionAsync"),l=Om(o,a,n,r,i,null),c=l.maxOutputSize,u=l.iouThreshold,h=l.scoreThreshold,[f,d]=await Promise.all([o.data(),a.data()]),{selectedIndices:p,validOutputs:m}=JS(f,d,c,u,h,s);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:ts(p,"int32"),validOutputs:Nt(m,"int32")}}const Lfe=Ffe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bfe(t,e,n=!1,r=!1){const i=U(t,"images","resizeBilinear");z(i.rank===3||i.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${i.rank}.`),z(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),z(r===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let s=i,o=!1;i.rank===3&&(o=!0,s=fe(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const a={images:s},l={alignCorners:n,halfPixelCenters:r,size:e},c=Q.runKernel(f0,a,l);return o?fe(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const zfe=te({resizeBilinear_:Bfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vfe(t,e,n=!1,r=!1){const i=U(t,"images","resizeNearestNeighbor");z(i.rank===3||i.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${i.rank}.`),z(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),z(i.dtype==="float32"||i.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),z(r===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let s=i,o=!1;i.rank===3&&(o=!0,s=fe(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const a={images:s},l={alignCorners:n,halfPixelCenters:r,size:e},c=Q.runKernel(h0,a,l);return o?fe(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const Ufe=te({resizeNearestNeighbor_:Vfe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wfe(t,e="binary",n=!1,r=.5){const i=U(t,"image","threshold"),s=.2989,o=.587,a=.114,l=i.shape[0]*i.shape[1];let c=se(ts([r]),255),u,h,f,d;if(z(i.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${i.rank}.`),z(i.shape[2]===3||i.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${i.shape[2]}.`),z(i.dtype==="int32"||i.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${i.dtype}.`),z(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),i.shape[2]===3){[u,h,f]=so(i,[1,1,1],-1);const v=se(u,s),y=se(h,o),w=se(f,a);d=Be(Be(v,y),w)}else d=t;if(e==="otsu"){const v=xI(Qe(FI(d),"int32"),to([]),256);c=Gfe(v,l)}const p=n?_f(d,c):No(d,c);return Qe(se(p,255),"int32")}function Gfe(t,e){let n=ts([-1]),r=ts([0]),i=ts([0]),s,o,a,l,c,u;for(let h=0;h<t.size-1;h++){s=Cn(t,0,h+1),o=Cn(t,h+1),c=Tt(xt(s),e),u=Tt(xt(o),e);const f=xt(se(s,Pm(0,s.size)));a=Tt(f,xt(s));const d=Mm(o.shape,s.size),p=Be(Pm(0,o.size),d),m=se(o,p);l=Tt(xt(m),xt(o));const v=mt(a,l),y=mt(a,l),w=se(c,u);i=se(se(w,v),y);const x=No(i,r);r=Bs(x,i,r),n=Bs(x,ts([h]),n)}return n}const Hfe=te({threshold_:Wfe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jfe(t,e,n="nearest",r="constant",i=0,s){const o=U(t,"image","transform","float32"),a=U(e,"transforms","transform","float32");z(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),z(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),z(s==null||s.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${s}.`);const l={image:o,transforms:a},c={interpolation:n,fillMode:r,fillValue:i,outputShape:s};return Q.runKernel(iS,l,c)}const qfe=te({transform_:jfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xfe(t,e,n){z(e%1==0,()=>`bandPart(): numLower must be an integer, got ${e}.`),z(n%1==0,()=>`bandPart(): numUpper must be an integer, got ${n}.`);const r=U(t,"a","bandPart");z(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);const i=r.shape,[s,o]=r.shape.slice(-2);if(!(e<=s))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${s}).`);if(!(n<=o))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${o}).`);e<0&&(e=s),n<0&&(n=o);const a=fe(Pm(0,s,1,"int32"),[-1,1]),l=Pm(0,o,1,"int32"),c=mt(a,l),u=Vl(_f(c,Nt(+e,"int32")),xf(c,Nt(-n,"int32"))),h=zr([s,o],r.dtype);return fe(ha(Qa(fe(r,[-1,s,o])).map(f=>Bs(u,f,h))),i)}const Kfe=te({bandPart_:Xfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yfe(t){let e;if(Array.isArray(t)){e=!1,z(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const i=t[0].shape[0];for(let s=1;s<t.length;++s)z(t[s].shape[0]===i,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[s].shape[0]} vs. ${i})`)}else e=!0,t=so(t,t.shape[0],0).map(i=>Wl(i,[0]));z(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);const n=[],r=t;for(let i=0;i<t.length;++i)n.push(Q.tidy(()=>{let s=r[i];if(i>0)for(let o=0;o<i;++o){const a=se(xt(se(n[o],s)),n[o]);s=mt(s,a)}return Tt(s,qI(s,"euclidean"))}));return e?ha(n,0):n}const Zfe=te({gramSchmidt_:Yfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jfe(t,e=!1){if(z(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return B4(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce((l,c)=>l*c),r=Qa(fe(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),i=[],s=[];r.forEach(l=>{const[c,u]=B4(l,e);i.push(c),s.push(u)});const o=fe(ha(i,0),t.shape),a=fe(ha(s,0),t.shape);return[o,a]}}function B4(t,e=!1){return Q.tidy(()=>{z(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);const n=t.shape[0],r=t.shape[1];let i=AI(n),s=Oc(t);const o=oo([[1]],[1,1]);let a=Oc(o);const l=n>=r?r:n;for(let c=0;c<l;++c){const u=s,h=a,f=i;[a,s,i]=Q.tidy(()=>{const d=Cn(s,[c,c],[n-c,1]),p=qI(d),m=Cn(s,[c,c],[1,1]),v=Bs(No(m,0),oo([[-1]]),oo([[1]])),y=mt(m,se(v,p)),w=Tt(d,y);w.shape[0]===1?a=Oc(o):a=ii([o,Cn(w,[1,0],[w.shape[0]-1,w.shape[1]])],0);const x=$r(Tt(gn(v,y),p)),_=Cn(s,[c,0],[n-c,r]),S=se(x,a),T=Mn(a);if(c===0)s=mt(_,gn(S,gn(T,_)));else{const A=mt(_,gn(S,gn(T,_)));s=ii([Cn(s,[0,0],[c,r]),A],0)}const E=Mn(S),k=Cn(i,[0,c],[n,i.shape[1]-c]);if(c===0)i=mt(k,gn(gn(k,a),E));else{const A=mt(k,gn(gn(k,a),E));i=ii([Cn(i,[0,0],[n,c]),A],1)}return[a,s,i]}),on([u,h,f])}return!e&&n>r&&(i=Cn(i,[0,0],[n,r]),s=Cn(s,[0,0],[r,r])),[i,s]})}const Qfe=te({qr_:Jfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ms;(function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(ms||(ms={}));function ede(t,e,n=ms.SUM_BY_NONZERO_WEIGHTS){const r=U(t,"losses","computeWeightedLoss");let i=null;e!=null&&(i=U(e,"weights","computeWeightedLoss"));const s=i==null?r:se(r,i);if(n===ms.NONE)return s;if(n===ms.SUM)return xt(s);if(n===ms.MEAN){if(i==null)return Br(s);{const o=r.size/i.size,a=Tt(xt(s),xt(i));return o>1?Tt(a,Nt(o)):a}}if(n===ms.SUM_BY_NONZERO_WEIGHTS){if(i==null)return Tt(xt(s),Nt(r.size));{const o=se(i,io(r.shape)),a=Qe(xt(Rm(o,Nt(0))),"float32");return Tt(xt(s),a)}}throw Error(`Unknown reduction: ${n}`)}const zc=te({computeWeightedLoss_:ede});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tde(t,e,n,r=ms.SUM_BY_NONZERO_WEIGHTS){const i=U(t,"labels","absoluteDifference"),s=U(e,"predictions","absoluteDifference");let o=null;n!=null&&(o=U(n,"weights","absoluteDifference")),zi(i.shape,s.shape,"Error in absoluteDifference: ");const a=pi(mt(i,s));return zc(a,o,r)}const nde=te({absoluteDifference_:tde});function rde(t,e,n,r,i=ms.SUM_BY_NONZERO_WEIGHTS){const s=U(t,"labels","cosineDistance"),o=U(e,"predictions","cosineDistance");let a=null;r!=null&&(a=U(r,"weights","cosineDistance")),zi(s.shape,o.shape,"Error in cosineDistance: ");const l=Nt(1),c=mt(l,xt(se(s,o),n,!0));return zc(c,a,i)}const ide=te({cosineDistance_:rde});function sde(t,e,n,r=ms.SUM_BY_NONZERO_WEIGHTS){let i=U(t,"labels","hingeLoss");const s=U(e,"predictions","hingeLoss");let o=null;n!=null&&(o=U(n,"weights","hingeLoss")),zi(i.shape,s.shape,"Error in hingeLoss: ");const a=Nt(1);i=mt(se(Nt(2),i),a);const l=Ul(mt(a,se(i,s)));return zc(l,o,r)}const ode=te({hingeLoss_:sde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ade(t,e,n,r=1,i=ms.SUM_BY_NONZERO_WEIGHTS){const s=U(t,"labels","huberLoss"),o=U(e,"predictions","huberLoss");let a=null;n!=null&&(a=U(n,"weights","huberLoss")),zi(s.shape,o.shape,"Error in huberLoss: ");const l=Nt(r),c=pi(mt(o,s)),u=U0(c,l),h=mt(c,u),f=Be(se(Nt(.5),nr(u)),se(l,h));return zc(f,a,i)}const lde=te({huberLoss_:ade});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cde(t,e,n,r=1e-7,i=ms.SUM_BY_NONZERO_WEIGHTS){const s=U(t,"labels","logLoss"),o=U(e,"predictions","logLoss");let a=null;n!=null&&(a=U(n,"weights","logLoss")),zi(s.shape,o.shape,"Error in logLoss: ");const l=Nt(1),c=Nt(r),u=$r(se(s,$o(Be(o,c)))),h=se(mt(l,s),$o(Be(mt(l,o),c))),f=mt(u,h);return zc(f,a,i)}const ude=te({logLoss_:cde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hde(t,e,n,r=ms.SUM_BY_NONZERO_WEIGHTS){const i=U(t,"labels","meanSquaredError"),s=U(e,"predictions","meanSquaredError");let o=null;n!=null&&(o=U(n,"weights","meanSquaredError")),zi(i.shape,s.shape,"Error in meanSquaredError: ");const a=GI(i,s);return zc(a,o,r)}const fde=te({meanSquaredError_:hde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dde(t,e){const n=U(t,"labels","sigmoidCrossEntropyWithLogits"),r=U(e,"logits","sigmoidCrossEntropyWithLogits");zi(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const i=Ul(r),s=se(r,n),o=NS(Mo($r(pi(r))));return Be(mt(i,s),o)}function pde(t,e,n,r=0,i=ms.SUM_BY_NONZERO_WEIGHTS){let s=U(t,"multiClassLabels","sigmoidCrossEntropy");const o=U(e,"logits","sigmoidCrossEntropy");let a=null;if(n!=null&&(a=U(n,"weights","sigmoidCrossEntropy")),zi(s.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){const c=Nt(r),u=Nt(1),h=Nt(.5);s=Be(se(s,mt(u,c)),se(h,c))}const l=dde(s,o);return zc(l,a,i)}const mde=te({sigmoidCrossEntropy_:pde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gde(t,e,n=-1){if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);return zl((i,s,o)=>{const l=o4(s,[n],!0),c=mt(Qe(s,"float32"),l);o([i,c]);const u=$r(se(c,i));return{value:xt(u,[n]),gradFunc:(d,p)=>{const[m,v]=p,y=Gr(d.shape,[n]);return[se(fe(d,y),mt(Qe(m,"float32"),Mo(v))),se(fe(d,y),mt(Mo(v),Qe(m,"float32")))]}}})(t,e)}function vde(t,e,n,r=0,i=ms.SUM_BY_NONZERO_WEIGHTS){let s=U(t,"onehotLabels","softmaxCrossEntropy");const o=U(e,"logits","softmaxCrossEntropy");let a=null;if(n!=null&&(a=U(n,"weights","softmaxCrossEntropy")),zi(s.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){const c=Nt(r),u=Nt(1),h=Nt(s.shape[1]);s=Be(se(s,mt(u,c)),Tt(c,h))}const l=gde(s,o);return zc(l,a,i)}const yde=te({softmaxCrossEntropy_:vde});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bde(t,e,n,r){const i=U(t,"indices","sparseFillEmptyRows","int32"),s=U(e,"values","sparseFillEmptyRows"),o=U(n,"denseShape","sparseFillEmptyRows","int32"),a=U(r,"defaultValue","sparseFillEmptyRows",s.dtype);if(i.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${i.shape}`);if(s.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${s.shape}`);if(o.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${o.shape}`);if(a.rank!==0)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const l={indices:i,values:s,denseShape:o,defaultValue:a},c=Q.runKernel(q_,l);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}const wde=te({sparseFillEmptyRows_:bde});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xde(t,e,n){const r=U(t,"inputIndices","sparseReshape","int32"),i=U(e,"inputShape","sparseReshape","int32"),s=U(n,"newShape","sparseReshape","int32");if(r.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${r.shape}`);if(i.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${i.shape}`);if(s.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${s.shape}`);const o={inputIndices:r,inputShape:i,newShape:s},a=Q.runKernel(X_,o);return{outputIndices:a[0],outputShape:a[1]}}const _de=te({sparseReshape_:xde});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sde(t,e,n){const r=U(t,"data","sparseSegmentMean"),i=U(e,"indices","sparseSegmentMean","int32"),s=U(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${i.shape}`);if(s.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${s.shape}`);const o={data:r,indices:i,segmentIds:s};return Q.runKernel(K_,o)}const Cde=te({sparseSegmentMean_:Sde});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tde(t,e,n){const r=U(t,"data","sparseSegmentSum"),i=U(e,"indices","sparseSegmentSum","int32"),s=U(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${i.shape}`);if(s.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${s.shape}`);const o={data:r,indices:i,segmentIds:s};return Q.runKernel(Y_,o)}const Ede=te({sparseSegmentSum_:Tde});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kde(t,e,n,r,i,s,o,a){const l=U(t,"data","stringNGrams","string");if(l.dtype!=="string")throw new Error("Data must be of datatype string");if(l.shape.length!==1)throw new Error(`Data must be a vector, saw: ${l.shape}`);const c=U(e,"dataSplits","stringNGrams");if(c.dtype!=="int32")throw new Error("Data splits must be of datatype int32");const u={separator:n,nGramWidths:r,leftPad:i,rightPad:s,padWidth:o,preserveShortSequences:a},h={data:l,dataSplits:c},f=Q.runKernel(eS,h,u);return{nGrams:f[0],nGramsSplits:f[1]}}const Ade=te({stringNGrams_:kde});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mde(t,e,n=!0){const r=U(t,"input","stringSplit","string"),i=U(e,"delimiter","stringSplit","string");if(r.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(i.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${i.shape}`);const s={skipEmpty:n},o={input:r,delimiter:i},a=Q.runKernel(tS,o,s);return{indices:a[0],values:a[1],shape:a[2]}}const Ide=te({stringSplit_:Mde});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nde(t,e){const n=U(t,"input","stringToHashBucketFast","string"),r={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const i={input:n};return Q.runKernel(nS,i,r)}const $de=te({stringToHashBucketFast_:Nde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rde={fft:US,ifft:j0,rfft:WS,irfft:WI},Dde={hammingWindow:lfe,hannWindow:O4,frame:F4,stft:ffe},Po={flipLeftRight:gfe,grayscaleToRGB:yfe,resizeNearestNeighbor:Ufe,resizeBilinear:zfe,rotateWithOffset:wfe,cropAndResize:pfe,nonMaxSuppression:_fe,nonMaxSuppressionAsync:Ife,nonMaxSuppressionWithScore:$fe,nonMaxSuppressionWithScoreAsync:Dfe,nonMaxSuppressionPadded:Ofe,nonMaxSuppressionPaddedAsync:Lfe,threshold:Hfe,transform:qfe},z4={bandPart:Kfe,gramSchmidt:Zfe,qr:Qfe},Pde={absoluteDifference:nde,computeWeightedLoss:zc,cosineDistance:ide,hingeLoss:ode,huberLoss:lde,logLoss:ude,meanSquaredError:fde,sigmoidCrossEntropy:mde,softmaxCrossEntropy:yde},X0={sparseFillEmptyRows:wde,sparseReshape:_de,sparseSegmentMean:Cde,sparseSegmentSum:Ede},eC={stringNGrams:Ade,stringSplit:Ide,stringToHashBucketFast:$de};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vc extends bf{minimize(e,n=!1,r){const{value:i,grads:s}=this.computeGradients(e,r);if(r!=null){const o=r.map(a=>({name:a.name,tensor:s[a.name]}));this.applyGradients(o)}else this.applyGradients(s);return on(s),n?i:(i.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,n){return i4(e,n)}dispose(){this.iterations_!=null&&on(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Nt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Vc,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tC extends Vc{constructor(e,n,r=null){super();this.learningRate=e,this.rho=n,this.epsilon=r,this.accumulatedGrads=[],this.accumulatedUpdates=[],r==null&&(this.epsilon=Q.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,i)=>{const s=Q.registeredVariables[r],o=!1;this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${r}/accum_grad`,variable:de(()=>In(s).variable(o))}),this.accumulatedUpdates[i]==null&&(this.accumulatedUpdates[i]={originalName:`${r}/accum_var`,variable:de(()=>In(s).variable(o))});const a=Array.isArray(e)?e[i].tensor:e[r];if(a==null)return;const l=this.accumulatedGrads[i].variable,c=this.accumulatedUpdates[i].variable;de(()=>{const u=Be(se(l,this.rho),se(nr(a),1-this.rho)),h=se(Tt(es(Be(c,this.epsilon)),es(Be(l,this.epsilon))),a),f=Be(se(c,this.rho),se(nr(h),1-this.rho));l.assign(u),c.assign(f);const d=Be(se(h,-this.learningRate),s);s.assign(d)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(on(this.accumulatedGrads.map(e=>e.variable)),on(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=e.length/2,r=!1;this.accumulatedGrads=e.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})),this.accumulatedUpdates=e.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.rho,n.epsilon)}}tC.className="Adadelta";Le(tC);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nC extends Vc{constructor(e,n=.1){super();this.learningRate=e,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,i)=>{const s=Q.registeredVariables[r];if(this.accumulatedGrads[i]==null){const l=!1;this.accumulatedGrads[i]={originalName:`${r}/accumulator`,variable:de(()=>Mm(s.shape,this.initialAccumulatorValue).variable(l))}}const o=Array.isArray(e)?e[i].tensor:e[r];if(o==null)return;const a=this.accumulatedGrads[i].variable;de(()=>{const l=Be(a,nr(o));a.assign(l);const c=Be(se(Tt(o,es(Be(l,Q.backend.epsilon()))),-this.learningRate),s);s.assign(c)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&on(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulatedGrads=e.map(r=>({originalName:r.name,variable:r.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,n){return new e(n.learningRate,n.initialAccumulatorValue)}}nC.className="Adagrad";Le(nC);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rC extends Vc{constructor(e,n,r,i=null){super();this.learningRate=e,this.beta1=n,this.beta2=r,this.epsilon=i,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],de(()=>{this.accBeta1=Nt(n).variable(),this.accBeta2=Nt(r).variable()}),i==null&&(this.epsilon=Q.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(r=>r.name):Object.keys(e);de(()=>{const r=mt(1,this.accBeta1),i=mt(1,this.accBeta2);n.forEach((s,o)=>{const a=Q.registeredVariables[s],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${s}/m`,variable:de(()=>In(a).variable(l))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${s}/v`,variable:de(()=>In(a).variable(l))});const c=Array.isArray(e)?e[o].tensor:e[s];if(c==null)return;const u=this.accumulatedFirstMoment[o].variable,h=this.accumulatedSecondMoment[o].variable,f=Be(se(u,this.beta1),se(c,1-this.beta1)),d=Be(se(h,this.beta2),se(nr(c),1-this.beta2)),p=Tt(f,r),m=Tt(d,i);u.assign(f),h.assign(d);const v=Be(se(Tt(p,Be(es(m),this.epsilon)),-this.learningRate),a);a.assign(v)}),this.accBeta1.assign(se(this.accBeta1,this.beta1)),this.accBeta2.assign(se(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&on(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&on(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e),de(()=>{this.accBeta1.assign(Xu(this.beta1,this.iterations_+1)),this.accBeta2.assign(Xu(this.beta2,this.iterations_+1))});const n=e.length/2,r=!1;this.accumulatedFirstMoment=e.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})),this.accumulatedSecondMoment=e.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon)}}rC.className="Adam";Le(rC);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class iC extends Vc{constructor(e,n,r,i=null,s=0){super();this.learningRate=e,this.beta1=n,this.beta2=r,this.epsilon=i,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],de(()=>{this.iteration=Nt(0).variable(),this.accBeta1=Nt(n).variable()}),i==null&&(this.epsilon=Q.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(r=>r.name):Object.keys(e);de(()=>{const r=mt(1,this.accBeta1),i=Tt(-this.learningRate,Be(se(this.iteration,this.decay),1));n.forEach((s,o)=>{const a=Q.registeredVariables[s],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${s}/m`,variable:In(a).variable(l)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${s}/v`,variable:In(a).variable(l)});const c=Array.isArray(e)?e[o].tensor:e[s];if(c==null)return;const u=this.accumulatedFirstMoment[o].variable,h=this.accumulatedWeightedInfNorm[o].variable,f=Be(se(u,this.beta1),se(c,1-this.beta1)),d=se(h,this.beta2),p=pi(c),m=Bc(d,p);u.assign(f),h.assign(m);const v=Be(se(Tt(i,r),Tt(f,Be(m,this.epsilon))),a);a.assign(v)}),this.iteration.assign(Be(this.iteration,1)),this.accBeta1.assign(se(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&on(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&on(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}iC.className="Adamax";Le(iC);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class K0 extends Vc{constructor(e){super();this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,i)=>{const s=Array.isArray(e)?e[i].tensor:e[r];if(s==null)return;const o=Q.registeredVariables[r];de(()=>{const a=Be(se(this.c,s),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Tr(Nt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,n){return new e(n.learningRate)}}K0.className="SGD";Le(K0);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sC extends K0{constructor(e,n,r=!1){super(e);this.learningRate=e,this.momentum=n,this.useNesterov=r,this.accumulations=[],this.m=Nt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,i)=>{const s=Q.registeredVariables[r];if(this.accumulations[i]==null){const l=!1;this.accumulations[i]={originalName:`${r}/momentum`,variable:de(()=>In(s).variable(l))}}const o=this.accumulations[i].variable,a=Array.isArray(e)?e[i].tensor:e[r];a!=null&&de(()=>{let l;const c=Be(se(this.m,o),a);this.useNesterov?l=Be(se(this.c,Be(a,se(c,this.m))),s):l=Be(se(this.c,c),s),o.assign(c),s.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&on(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulations=e.map(r=>({originalName:r.name,variable:r.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,n){return new e(n.learningRate,n.momentum,n.useNesterov)}}sC.className="Momentum";Le(sC);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oC extends Vc{constructor(e,n=.9,r=0,i=null,s=!1){super();if(this.learningRate=e,this.decay=n,this.momentum=r,this.epsilon=i,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,i==null&&(this.epsilon=Q.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,i)=>{const s=Q.registeredVariables[r],o=!1;this.accumulatedMeanSquares[i]==null&&(this.accumulatedMeanSquares[i]={originalName:`${r}/rms`,variable:de(()=>In(s).variable(o))}),this.accumulatedMoments[i]==null&&(this.accumulatedMoments[i]={originalName:`${r}/momentum`,variable:de(()=>In(s).variable(o))}),this.accumulatedMeanGrads[i]==null&&this.centered&&(this.accumulatedMeanGrads[i]={originalName:`${r}/mg`,variable:de(()=>In(s).variable(o))});const a=Array.isArray(e)?e[i].tensor:e[r];if(a==null)return;const l=this.accumulatedMeanSquares[i].variable,c=this.accumulatedMoments[i].variable;de(()=>{const u=Be(se(l,this.decay),se(nr(a),1-this.decay));if(this.centered){const h=this.accumulatedMeanGrads[i].variable,f=Be(se(h,this.decay),se(a,1-this.decay)),d=Tt(se(a,this.learningRate),es(mt(u,Be(nr(f),this.epsilon)))),p=Be(se(c,this.momentum),d);l.assign(u),h.assign(f),c.assign(p);const m=mt(s,p);s.assign(m)}else{const h=Be(se(l,this.decay),se(nr(a),1-this.decay)),f=Be(se(c,this.momentum),Tt(se(a,this.learningRate),es(Be(h,this.epsilon))));l.assign(h),c.assign(f);const d=mt(s,f);s.assign(d)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&on(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&on(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&on(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=this.centered?e.length/3:e.length/2,r=!1;this.accumulatedMeanSquares=e.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})),this.accumulatedMoments=e.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})),this.centered&&(this.accumulatedMeanGrads=e.slice(n*2,n*3).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,n){return new e(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}oC.className="RMSProp";Le(oC);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ku{static sgd(e){return new K0(e)}static momentum(e,n,r=!1){return new sC(e,n,r)}static rmsprop(e,n=.9,r=0,i=null,s=!1){return new oC(e,n,r,i,s)}static adam(e=.001,n=.9,r=.999,i=null){return new rC(e,n,r,i)}static adadelta(e=.001,n=.95,r=null){return new tC(e,n,r)}static adamax(e=.002,n=.9,r=.999,i=null,s=0){return new iC(e,n,r,i,s)}static adagrad(e,n=.1){return new nC(e,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yu={sgd:Ku.sgd,momentum:Ku.momentum,adadelta:Ku.adadelta,adagrad:Ku.adagrad,rmsprop:Ku.rmsprop,adamax:Ku.adamax,adam:Ku.adam};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ode=(()=>typeof requestAnimationFrame!="undefined"?requestAnimationFrame:typeof setImmediate!="undefined"?setImmediate:t=>t())();function V4(){return new Promise(t=>Ode(()=>t()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QI(t,e){const n=t[0].length;t.forEach((i,s)=>{z(i.length===n,()=>`Error in concat${n}D: rank of tensors[${s}] must be the same as the rank of the rest (${n})`)}),z(e>=0&&e<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const r=t[0];t.forEach((i,s)=>{for(let o=0;o<n;o++)z(o===e||i[o]===r[o],()=>`Error in concat${n}D: Shape of tensors[${s}] (${i}) does not match the shape of the rest (${r}) along the non-concatenated axis ${s}.`)})}function Gl(t,e){const n=t[0].slice();for(let r=1;r<t.length;r++)n[e]+=t[r][e];return n}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eN=30;function aC(t){return t<=eN?t:s_(t,Math.floor(Math.sqrt(t)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tN(t,e,n){const r=n*(typeof t=="number"?t:t[0]),i=e*(typeof t=="number"?t:t[1]);return[r,i]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y0(t,e,n,r=!0){let i=[];if(r)i=i.concat(e.slice(0)),i.push(t[0]/n),i=i.concat(t.slice(1));else{i=i.concat(t[0]);const s=e.length;for(let o=0;o<s;++o)i=i.concat([t[o+1]/e[o],e[o]]);i=i.concat(t.slice(s+1))}return i}function Z0(t,e,n=!0){const r=[];if(n){r.push(e);for(let i=e+1;i<t;++i)i<=2*e?(r.push(i),r.push(i-(e+1))):r.push(i)}else{const i=[],s=[];for(let o=1;o<t;++o)o>=e*2+1||o%2==1?s.push(o):i.push(o);r.push(...i),r.push(0),r.push(...s)}return r}function J0(t,e,n,r=!0){const i=[];r?i.push(t[0]/n):i.push(t[0]*n);for(let s=1;s<t.length;++s)s<=e.length?r?i.push(e[s-1]*t[s]):i.push(t[s]/e[s-1]):i.push(t[s]);return i}function nN(t,e){const n=[0];for(let r=0;r<e;++r)n.push(t[r][0]);return n}function rN(t,e,n){const r=t.slice(0,1);for(let i=0;i<n;++i)r.push(t[i+1]-e[i][0]-e[i][1]);return r}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lC=1.7580993408473768,cC=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iN=.3275911,sN=.254829592,oN=-.284496736,aN=1.421413741,lN=-1.453152027,cN=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uc(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(t.length*2);for(let r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}function U4(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}}function W4(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let i=0;i<t.length;i+=4)n[Math.floor(i/4)]=t[i],r[Math.floor(i/4)]=t[i+1];return{real:n,imag:r}}function G4(t){const e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let i=2;i<t.length;i+=4)n[Math.floor(i/4)]=t[i],r[Math.floor(i/4)]=t[i+1];return{real:n,imag:r}}function uN(t,e){const n=t[e*2],r=t[e*2+1];return{real:n,imag:r}}function H4(t,e,n,r){t[r*2]=e,t[r*2+1]=n}function j4(t,e){const n=new Float32Array(t/2),r=new Float32Array(t/2);for(let i=0;i<Math.ceil(t/2);i++){const s=(e?2:-2)*Math.PI*(i/t);n[i]=Math.cos(s),r[i]=Math.sin(s)}return{real:n,imag:r}}function q4(t,e,n){const r=(n?2:-2)*Math.PI*(t/e),i=Math.cos(r),s=Math.sin(r);return{real:i,imag:s}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hN="->",Fde=/->/g,X4=",",K4="...";function fN(t,e){t=t.replace(/\s/g,"");const n=(t.length-t.replace(Fde,"").length)/hN.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${hN}").`);const[r,i]=t.split(hN);z(r.indexOf(K4)===-1,()=>`The ellipsis notation ("${K4}") is not supported yet.`);const s=r.split(X4),o=s.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let f=0;f<i.length;++f){const d=i[f];if(!s.some(p=>p.indexOf(d)!==-1))throw new Error(`Output subscripts contain the label ${d} not present in the input subscripts.`);a.indexOf(d)===-1&&a.push(d)}for(let f=0;f<r.length;++f){const d=r[f];a.indexOf(d)===-1&&d!==X4&&a.push(d)}const l=new Array(s.length);for(let f=0;f<o;++f){if(new Set(s[f].split("")).size!==s[f].length)throw new Error(`Found duplicate axes in input component ${s[f]}. Support for duplicate axes in input is not implemented yet.`);l[f]=[];for(let d=0;d<s[f].length;++d)l[f].push(a.indexOf(s[f][d]))}const c=a.length,u=i.length,h=[];for(let f=u;f<c;++f)h.push(f);return{allDims:a,summedDims:h,idDims:l}}function dN(t,e){let n=new Array(t);n.fill(-1);for(let i=0;i<e.length;++i)n[e[i]]=i;const r=[];for(let i=0;i<t;++i)n[i]===-1&&r.push(i);return n=n.filter(i=>i!==-1),{permutationIndices:n,expandDims:r}}function pN(t,e,n){const r=new Array(t);for(let i=0;i<n.length;++i){const s=n[i].shape;for(let o=0;o<e[i].length;++o)r[e[i][o]]===void 0?r[e[i][o]]=s[o]:z(r[e[i][o]]===s[o],()=>`Expected dimension ${r[e[i][o]]} at axis ${o} of input shaped ${JSON.stringify(s)}, but got dimension ${s[o]}`)}}function mN(t,e){const n=t,r=[];let i=0;t.length===0&&n.push(-1),i=t.length+1;for(let o=0;o<i;++o)r.push([]);const s=[];for(let o=0;o<n.length;++o){const a=n[o],l=Lde(e,a);for(const c of l)s.indexOf(c)===-1&&(r[o].push(c),s.push(c))}return{path:n,steps:r}}function gN(t){return t.every((e,n)=>e===n)}function Lde(t,e){const n=[];for(let r=0;r<t.length;++r)(t[r].length===0||t[r].indexOf(e)!==-1||e===-1)&&n.push(r);return n}function vN(t,e,n=0){let r=[];if(typeof e=="number")z(t.shape[n]%e==0,()=>"Number of splits must evenly divide the axis."),r=new Array(e).fill(t.shape[n]/e);else{const i=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);z(i<=1,()=>"There should be only one negative value in split array.");const s=e.indexOf(-1);if(s!==-1){const o=e.reduce((a,l)=>l>0?a+l:a);e[s]=t.shape[n]-o}z(t.shape[n]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),r=e}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y4(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function Z4(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function J4(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q4(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function eV(t,e){return`size ${t} must be non-negative, not ${e}`}function tV(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function nV(t,e){const n=_e(t),r=_e(e);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${r}. inputShape=${t} outputShape= ${e}`}function rV(t,e){const n=_e(t),r=_e(e);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${r}. inputShape=${t} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yN(){return"segment ids must be >= 0"}function iV(){return"segment ids are not increasing"}function sV(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function oV(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aV(t,e){let n=!1,r;for(t<=eN?(r=t,n=!0):r=s_(t,Math.floor(Math.sqrt(t)));!n;)r>e||r===t?n=!0:r=s_(t,r+1);return r}function lV(t,e,n){const r=[],i=t.length;for(let s=0;s<i;s++)s!==e?r.push(t[s]):r.push(n);return r}function bN(t,e,n,r){const i=e.shape.length,s=t.shape.length;if(r!==0&&(r<-i||r>i))throw new Error(`Expect batchDims in the range of [-${i}, ${i}], but got ${r}`);if(r<0&&(r+=i),r>s)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${s}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let h=0;h<r;++h)if(t.shape[h]!==e.shape[h])throw new Error(`x.shape[${h}]: ${t.shape[h]} should be equal to indices.shape[${h}]: ${e.shape[h]}.`);const o=t.shape[n],a=[];let l=1,c=1,u=1;for(let h=0;h<r;++h)a.push(t.shape[h]),l*=t.shape[h];for(let h=r;h<n;h++)a.push(t.shape[h]),c*=t.shape[h];for(let h=r;h<i;h++)a.push(e.shape[h]);for(let h=n+1;h<s;h++)a.push(t.shape[h]),u*=t.shape[h];return{batchSize:l,sliceSize:u,outerSize:c,dimSize:o,outputShape:a}}var Bde=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",segOpComputeOptimalWindowSize:aV,computeOutShape:lV,collectGatherOpShapeInfo:bN});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cf(t){try{return t.map(e=>ff(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function cV(t){return t.map(e=>Fl(e))}var uV=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",slice_util:Cz,segment_util:Bde,fromUint8ToStringArray:Cf,fromStringArrayToUint8:cV,upcastType:eo,axesAreInnerMostDims:NI,combineLocations:s4,computeOutAndReduceShapes:Mi,expandShapeToKeepDim:Gr,assertAxesAreInnerMostDims:Wi,getAxesPermutation:Hr,getUndoAxesPermutation:$m,getInnerMostAxes:si,getBroadcastDims:vf,getReductionAxes:ri,assertAndGetBroadcastShape:Qt,assertParamsConsistent:QI,computeOutShape:Gl,computeDilation2DInfo:F0,computePool2DInfo:ca,computePool3DInfo:Fc,computeConv2DInfo:Ai,computeConv3DInfo:Gu,computeDefaultPad:yI,tupleValuesAreOne:Hu,eitherStridesOrDilationsAreOne:Ui,convertConv2DDataFormat:Lc,checkPadOnDimRoundingMode:ps,getFusedDyActivation:jS,getFusedBiasGradient:qS,applyActivation:XS,shouldFuse:KS,PARALLELIZE_THRESHOLD:eN,computeOptimalWindowSize:aC,getImageCenter:tN,getReshaped:Y0,getPermuted:Z0,getReshapedPermuted:J0,getSliceBeginCoords:nN,getSliceSize:rN,prepareAndValidate:xS,validateUpdateShape:iI,validateInput:sI,calculateShapes:Cm,SELU_SCALEALPHA:lC,SELU_SCALE:cC,ERF_P:iN,ERF_A1:sN,ERF_A2:oN,ERF_A3:aN,ERF_A4:lN,ERF_A5:cN,warn:ko,log:Vse,mergeRealAndImagArrays:Uc,splitRealAndImagArrays:U4,complexWithEvenIndex:W4,complexWithOddIndex:G4,getComplexWithIndex:uN,assignToTypedArray:H4,exponents:j4,exponent:q4,decodeEinsumEquation:fN,getEinsumPermutation:dN,checkEinsumDimSizes:pN,getEinsumComputePath:mN,isIdentityPermutation:gN,prepareSplitSize:vN,getSparseFillEmptyRowsIndicesDenseShapeMismatch:Y4,getSparseFillEmptyRowsNegativeIndexErrorMessage:Z4,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:J4,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:Q4,getSparseReshapeNegativeOutputDimErrorMessage:eV,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:tV,getSparseReshapeInputOutputMultipleErrorMessage:nV,getSparseReshapeInputOutputMismatchErrorMessage:rV,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:yN,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:iV,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:sV,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:oV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var zde=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",nonMaxSuppressionV3Impl:ZS,nonMaxSuppressionV4Impl:JS,nonMaxSuppressionV5Impl:QS,whereImpl:HS});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var hV=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",AdadeltaOptimizer:tC,AdagradOptimizer:nC,AdamOptimizer:rC,AdamaxOptimizer:iC,MomentumOptimizer:sC,Optimizer:Vc,OptimizerConstructors:Ku,RMSPropOptimizer:oC,SGDOptimizer:K0,Tensor:Qn,TensorBuffer:di,Variable:R0,get Rank(){return $M},sumOutType:pS,upcastType:eo,get Reduction(){return ms},customGrad:zl,grad:Dce,grads:Pce,valueAndGrad:Oce,valueAndGrads:Fce,variableGrads:i4,Environment:xB,env:Ce,get ENV(){return _M},nextFrame:V4,KernelBackend:t_,DataStorage:dM,abs:pi,acos:Az,acosh:Mz,add:Be,addN:Iz,all:vI,any:CS,argMax:Tm,argMin:Nz,asin:$z,asinh:Rz,atan:Dz,atan2:Pz,atanh:Oz,avgPool:ES,avgPool3d:wI,basicLSTMCell:Ele,batchToSpaceND:kS,batchNorm:Am,batchNorm2d:Fz,batchNorm3d:Lz,batchNorm4d:Bz,bincount:xI,broadcastArgs:zz,broadcastTo:L0,buffer:mn,cast:Qe,ceil:Vz,clipByValue:ro,clone:Oc,complex:zu,concat:ii,concat1d:Uz,concat2d:Wz,concat3d:Gz,concat4d:Hz,conv1d:_I,conv2d:ju,conv2dTranspose:CI,conv3d:TI,conv3dTranspose:qz,cos:AS,cosh:EI,cumsum:kI,denseBincount:Xz,depthToSpace:Kz,depthwiseConv2d:B0,diag:nce,dilation2d:Yz,div:Tt,divNoNan:Zz,dot:cce,einsum:Jz,elu:z0,equal:Za,erf:Qz,exp:Mo,expandDims:Io,expm1:e4,eye:AI,fill:Mm,floor:V0,floorDiv:gI,gather:Im,greater:No,greaterEqual:xf,imag:MS,isFinite:Cce,isInf:Ece,isNaN:t4,leakyRelu:IS,less:MI,lessEqual:_f,linspace:n4,localResponseNormalization:r4,log:$o,log1p:NS,logSigmoid:Vce,logSoftmax:II,logSumExp:o4,logicalAnd:Vl,logicalNot:RS,logicalOr:$I,logicalXor:Zce,matMul:gn,max:Ja,maxPool:DS,maxPool3d:RI,maxPoolWithArgmax:a4,maximum:Bc,mean:Br,meshgrid:rue,min:PS,minimum:U0,mirrorPad:l4,mod:c4,moments:OS,mul:se,multiRNNCell:hue,multinomial:u4,neg:$r,notEqual:Rm,oneHot:O0,ones:io,onesLike:Ro,outerProduct:gue,pad:qu,pad1d:bue,pad2d:xue,pad3d:Sue,pad4d:Tue,pool:Iue,pow:Xu,prelu:LS,print:iz,prod:DI,rand:Pue,randomGamma:Hue,randomNormal:y4,randomUniform:Dm,range:Pm,real:W0,reciprocal:b4,relu:Ul,relu6:OI,reshape:fe,reverse:Do,reverse1d:ehe,reverse2d:nhe,reverse3d:ihe,reverse4d:ohe,round:FI,rsqrt:LI,scalar:Nt,selu:BI,separableConv2d:w4,setdiff1dAsync:x4,sigmoid:Bl,sign:_4,sin:zI,sinh:VI,slice:Cn,slice1d:zS,slice2d:UI,slice3d:VS,slice4d:G0,softmax:H0,softplus:Nm,spaceToBatchND:FS,fft:US,ifft:j0,irfft:WI,rfft:WS,split:so,sqrt:es,square:nr,squaredDifference:GI,squeeze:Wl,stack:ha,step:q0,stridedSlice:S4,sub:mt,sum:xt,tan:C4,tanh:km,tensor:to,tensor1d:ts,tensor2d:oo,tensor3d:fz,tensor4d:$he,tensor5d:Rhe,tensor6d:Dhe,tile:ua,topk:T4,truncatedNormal:GS,unique:HI,unsortedSegmentSum:E4,unstack:Qa,variable:k4,where:Bs,whereAsync:jI,zeros:zr,zerosLike:In,op:te,OP_SCOPE_SUFFIX:qB,booleanMaskAsync:Uhe,transpose:Mn,norm:qI,movingAverage:Hhe,scatterND:M4,sparseToDense:XI,gatherND:I4,dropout:N4,enclosingPowerOfTwo:$4,cosineWindow:KI,inTopKAsync:Qhe,image:Po,linalg:z4,losses:Pde,spectral:Rde,fused:ofe,signal:Dde,sparse:X0,string:eC,train:Yu,enableProdMode:Fae,enableDebugMode:Lae,disableDeprecationWarnings:Bae,deprecationWarn:zae,disposeVariables:Vae,engine:Wu,memory:SS,profile:Uae,tidy:de,dispose:on,keep:Tr,time:Wae,setBackend:Gae,ready:Hae,getBackend:jae,removeBackend:qae,findBackend:Xae,findBackendFactory:Kae,registerBackend:mI,backend:kz,setPlatform:Yae,getKernel:lS,getGradient:TM,getKernelsForBackend:cS,registerKernel:uS,registerGradient:TB,unregisterKernel:Use,unregisterGradient:Wse,copyRegisteredKernels:Gse,Abs:Sy,Acos:_p,Acosh:Sp,Add:af,AddN:Cy,All:o_,Any:a_,ArgMax:Ty,ArgMin:Ey,Asin:Cp,Asinh:Tp,Atan:Ep,Atanh:kp,Atan2:Ap,AvgPool:ky,AvgPoolGrad:l_,AvgPool3D:Ay,AvgPool3DGrad:c_,BatchMatMul:My,BatchToSpaceND:Iy,Bincount:u_,BroadcastTo:SB,BroadcastArgs:h_,Cast:Mp,Ceil:Ip,ClipByValue:Np,Complex:f_,ComplexAbs:Ny,Concat:$y,Conv2D:Ry,Conv2DBackpropFilter:d_,Conv2DBackpropInput:Dy,Conv3D:Py,Conv3DBackpropFilterV2:p_,Conv3DBackpropInputV2:m_,Cos:$p,Cosh:Rp,Cumsum:Oy,CropAndResize:g_,DenseBincount:v_,DepthToSpace:y_,DepthwiseConv2dNative:Fy,DepthwiseConv2dNativeBackpropFilter:b_,DepthwiseConv2dNativeBackpropInput:w_,Diag:x_,Dilation2D:Ly,Dilation2DBackpropInput:__,Dilation2DBackpropFilter:S_,RealDiv:Dp,Einsum:C_,Elu:Pp,EluGrad:T_,Erf:Op,Equal:By,Exp:Fp,ExpandDims:zy,Expm1:Lp,FFT:E_,Fill:k_,FlipLeftRight:A_,Floor:Bp,FloorDiv:zp,FusedBatchNorm:Vy,GatherV2:Uy,GatherNd:M_,Greater:Wy,GreaterEqual:Vp,Identity:Up,IFFT:I_,Imag:N_,IsFinite:Wp,IsInf:Gp,IsNan:Hp,LeakyRelu:Gy,Less:Hy,LessEqual:jy,LinSpace:$_,Log:jp,Log1p:qp,LogicalAnd:qy,LogicalNot:Xy,LogicalOr:Ky,LogSoftmax:CB,LRN:Yy,LRNGrad:R_,Max:Zy,Maximum:Xp,MaxPool:Jy,MaxPoolGrad:D_,MaxPool3D:Qy,MaxPool3DGrad:P_,MaxPoolWithArgmax:O_,Mean:e0,Min:t0,Minimum:Kp,MirrorPad:n0,Mod:Yp,Multinomial:F_,Multiply:Zp,Neg:r0,NotEqual:i0,NonMaxSuppressionV3:L_,NonMaxSuppressionV4:B_,NonMaxSuppressionV5:z_,OnesLike:s0,OneHot:o0,Pack:a0,PadV2:l0,Pool:zse,Pow:Jp,Prelu:c0,Prod:V_,Range:U_,Real:W_,Reciprocal:Qp,Relu:em,Reshape:u0,ResizeNearestNeighbor:h0,ResizeNearestNeighborGrad:G_,ResizeBilinear:f0,ResizeBilinearGrad:H_,Relu6:tm,Reverse:d0,Round:nm,Rsqrt:rm,ScatterNd:j_,Select:p0,Selu:im,Slice:m0,Sin:sm,Sinh:om,Sign:am,Sigmoid:lm,Softplus:cm,Sqrt:um,Sum:g0,SpaceToBatchND:v0,SplitV:y0,Softmax:b0,SparseFillEmptyRows:q_,SparseReshape:X_,SparseSegmentMean:K_,SparseSegmentSum:Y_,SparseToDense:Z_,SquaredDifference:hm,Square:J_,StridedSlice:Q_,StringNGrams:eS,StringSplit:tS,StringToHashBucketFast:nS,Sub:fm,Tan:dm,Tanh:pm,Tile:mm,TopK:rS,Transform:iS,Transpose:w0,Unique:sS,Unpack:x0,UnsortedSegmentSum:_0,ZerosLike:S0,Step:gm,FromPixels:oS,RotateWithOffset:aS,_FusedMatMul:C0,FusedConv2D:T0,FusedDepthwiseConv2D:E0,version_core:Oae,browser:wae,io:aae,math:dae,serialization:kae,test_util:Pae,util:eoe,backend_util:uV,broadcast_util:pae,tensor_util:poe,slice_util:Cz,gather_util:xae,scatter_util:_ae,device_util:boe,kernel_impls:zde});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _t(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&z(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vde=HS;class uC extends t_{constructor(){super();this.blockSize=48,this.firstUse=!0,this.data=new dM(this,Wu())}nextDataId(){return uC.nextDataId++}write(e,n,r){this.firstUse&&(this.firstUse=!1,Ce().get("IS_NODE")&&ko(`
============================
Hi there \u{1F44B}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));const i={id:this.nextDataId()};return this.data.set(i,{values:e,dtype:r,refCount:1}),i}makeTensorInfo(e,n,r){let i;if(n==="string"&&r!=null&&r.length>0&&Ol(r[0])){const s=r.map(o=>Fl(o));i=this.write(s,e,n)}else i=this.write(r,e,n);return{dataId:i,shape:e,dtype:n}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const n=this.data.get(e);n.refCount++}decRef(e){if(this.data.has(e)){const n=this.data.get(e);n.refCount--}}move(e,n,r,i,s){this.data.set(e,{values:n,dtype:i,refCount:s})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:n,complexTensorInfos:r}=this.data.get(e);if(n==="complex64"){const i=this.readSync(r.real.dataId),s=this.readSync(r.imag.dataId);return Uc(i,s)}return this.data.get(e).values}bufferSync(e){const n=this.readSync(e.dataId);let r=n;if(e.dtype==="string")try{r=n.map(i=>ff(i))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return mn(e.shape,e.dtype,r)}makeOutput(e,n,r){const i=this.write(e,n,r);return Wu().makeTensorFromDataId(i,n,r,this)}disposeData(e,n=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!n&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:r}=this.data.get(e);r!=null&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const n=ds();return e(),{kernelMs:ds()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){_t([e],"where");const n=this.readSync(e.dataId);return Vde(e.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}uC.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fV(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}const Ude=t=>{const{x:e}=t.inputs,n=t.backend;_t(e,"abs");let r=new Float32Array(_e(e.shape));const i=n.data.get(e.dataId).values;return r=fV(i),n.makeOutput(r,e.shape,e.dtype)},Wde={kernelName:Sy,backendName:"cpu",kernelFunc:Ude};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oi(t){return(e,n,r,i,s)=>{const o=Qt(e,n),a=o.length,l=Rt(o),c=_e(o),u=fi(s,c),h=e.length,f=n.length,d=Rt(e),p=Rt(n),m=vf(e,o),v=vf(n,o);if(m.length+v.length===0)for(let y=0;y<u.length;++y)u[y]=t(r[y%r.length],i[y%i.length]);else for(let y=0;y<u.length;++y){const w=wp(y,a,l),x=w.slice(-h);m.forEach(E=>x[E]=0);const _=qa(x,h,d),S=w.slice(-f);v.forEach(E=>S[E]=0);const T=qa(S,f,p);u[y]=t(r[_],i[T])}return[u,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ao(t){const{inputs:e,backend:n}=t,{real:r,imag:i}=e,s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,a=n.makeTensorInfo(r.shape,"complex64"),l=n.data.get(a.dataId);return l.complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",s),imag:n.makeTensorInfo(i.shape,"float32",o)},a}const Gde={kernelName:f_,backendName:"cpu",kernelFunc:ao};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hC(t,e,n="float32"){if(n==="complex64"){const i=hC(t,e,"float32"),s=hC(t,e,"float32");return ao({inputs:{real:i,imag:s},backend:t})}const r=Vi(_e(e),n);return t.makeTensorInfo(e,n,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hl(t){const{inputs:e,backend:n}=t,{x:r}=e;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const Hde={kernelName:Up,backendName:"cpu",kernelFunc:Hl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tf(t){const{inputs:e,backend:n}=t,{input:r}=e,i=n.data.get(r.dataId).complexTensorInfos.real,s=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,s)}const jde={kernelName:W_,backendName:"cpu",kernelFunc:Tf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zu(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{dtype:s}=r;if(s==="complex64"){if(i.dtype==="complex64")return Hl({inputs:{x:i},backend:n});const o=hC(n,i.shape,i.dtype),a=Zu({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),l=ao({inputs:{real:a,imag:o},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}if(i.dtype==="complex64"){const o=Tf({inputs:{input:i},backend:n}),a=Zu({inputs:{x:o},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(o),a}if(!yM(i.dtype,s)){const o=Hl({inputs:{x:i},backend:n});return{dataId:o.dataId,shape:o.shape,dtype:s}}if(s==="int32"){const o=n.data.get(i.dataId).values,a=Int32Array.from(o);return n.makeTensorInfo(i.shape,"int32",a)}if(s==="bool"){const o=n.data.get(i.dataId).values,a=Bu([0],i.dtype),[l,c]=oi((u,h)=>u!==h?1:0)(i.shape,[],o,a,"bool");return n.makeTensorInfo(c,"bool",l)}throw new Error(`Error in Cast: failed to cast ${i.dtype} to ${s}`)}const qde={kernelName:Mp,backendName:"cpu",kernelFunc:Zu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ii(t,e,n,r){return n==null?({inputs:i,backend:s})=>{const{a:o,b:a}=i,l=s;_t([o,a],t);const c=l.data.get(o.dataId).values,u=l.data.get(a.dataId).values,h=o.dtype==="string"?Cf(c):c,f=o.dtype==="string"?Cf(u):u,d=r||o.dtype,[p,m]=e(o.shape,a.shape,h,f,d);return l.makeTensorInfo(m,d,p)}:({inputs:i,backend:s})=>{const{a:o,b:a}=i,l=s;if(o.dtype==="complex64"||a.dtype==="complex64"){const c=Zu({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),u=l.data.get(c.dataId),h=u.complexTensorInfos.real,f=u.complexTensorInfos.imag,d=l.data.get(h.dataId).values,p=l.data.get(f.dataId).values,m=Zu({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),v=l.data.get(m.dataId),y=v.complexTensorInfos.real,w=v.complexTensorInfos.imag,x=l.data.get(y.dataId).values,_=l.data.get(w.dataId).values,[S,T,E]=n(o.shape,a.shape,d,p,x,_),k=l.makeTensorInfo(E,"float32",S),A=l.makeTensorInfo(E,"float32",T),M=ao({inputs:{real:k,imag:A},backend:l});return l.disposeIntermediateTensorInfo(c),l.disposeIntermediateTensorInfo(m),l.disposeIntermediateTensorInfo(k),l.disposeIntermediateTensorInfo(A),M}else{const c=l.data.get(o.dataId).values,u=l.data.get(a.dataId).values,h=r||o.dtype,[f,d]=e(o.shape,a.shape,c,u,h);return l.makeTensorInfo(d,h,f)}}}function wN(t){return(e,n,r,i,s,o)=>{const a=Qt(e,n),l=_e(a),c=a.length,u=Rt(a),h=fi("float32",l),f=fi("float32",l),d=vf(e,a),p=vf(n,a),m=Uc(r,i),v=Uc(s,o),y=e.length,w=Rt(e),x=n.length,_=Rt(n);if(d.length+p.length===0)for(let S=0;S<h.length;S++){const T=S%m.length,E=S%v.length,k=t(m[T*2],m[T*2+1],v[E*2],v[E*2+1]);h[S]=k.real,f[S]=k.imag}else for(let S=0;S<h.length;S++){const T=wp(S,c,u),E=T.slice(-y);d.forEach(P=>E[P]=0);const k=qa(E,y,w),A=T.slice(-x);p.forEach(P=>A[P]=0);const M=qa(A,x,_),D=t(m[k*2],m[k*2+1],v[M*2],v[M*2+1]);h[S]=D.real,f[S]=D.imag}return[h,f,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dV=oi((t,e)=>t+e),Xde=wN((t,e,n,r)=>({real:t+n,imag:e+r})),Q0=Ii(af,dV,Xde),Kde={kernelName:af,backendName:"cpu",kernelFunc:Q0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xN(t,e,n,r,i){const s=_e(r),o=Vi(i,n);for(let a=0;a<t.length;a++){const l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=i||(s>0?o[l]+=e[a]:o[l]+=1)}return o}function pV(t,e,n,r=!1){const i=t.shape[0],s=t.shape[1],o=mn([i,n],e.dtype);for(let a=0;a<i;a++)for(let l=0;l<s;l++){const c=t.get(a,l);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(r?o.set(1,a,c):e.size>0?o.set(o.get(a,c)+e.get(a,l),a,c):o.set(o.get(a,c)+1,a,c))}return o}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ju(t){return(e,n,r)=>{const i=fi(n,e.length);for(let s=0;s<e.length;++s)i[s]=t(e[s],r);return i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jn(t,e,n){return({inputs:r,attrs:i,backend:s})=>{const{x:o}=r;if(_t(o,t),o.dtype==="string"||n==="string")throw new Error("unaryKernelFunc does not support string input/output");const a=s,l=a.data.get(o.dataId).values,c=_e(o.shape),u=n||o.dtype,h=hs(u,c);for(let f=0;f<c;++f)h[f]=e(l[f],i);return a.makeTensorInfo(o.shape,u,h)}}function Fm(t,e,n){return({inputs:r,attrs:i,backend:s})=>{const{x:o}=r;if(_t(o,t),o.dtype==="string"||n==="string")throw new Error("unaryKernelFunc does not support string input/output");const a=s,l=a.data.get(o.dataId).values,c=n||o.dtype,u=e(l,c,i);return a.makeTensorInfo(o.shape,c,u)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mV=Ju(t=>Math.ceil(t)),Yde=Fm(Ip,mV),Zde={kernelName:Ip,backendName:"cpu",kernelFunc:Yde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gV(t,e,n,r){const i=hs(n,_e(e));if(r&&n!=="string"){let s=0;t.forEach(o=>{const a=_e(o.shape);i.set(o.vals,s),s+=a})}else{let s=0;t.forEach(o=>{const a=n==="string"?Cf(o.vals):o.vals;let l=0;for(let c=0;c<o.shape[0];++c){const u=c*e[1]+s;for(let h=0;h<o.shape[1];++h)i[u+h]=a[l++]}s+=o.shape[1]})}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vV=oi((t,e)=>t===e?1:0),yV=Ii(By,vV,null,"bool"),Jde={kernelName:By,backendName:"cpu",kernelFunc:yV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bV=Ju(t=>Math.exp(t)),wV=Fm(Fp,bV,"float32"),Qde={kernelName:Fp,backendName:"cpu",kernelFunc:wV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xV=Ju(t=>Math.expm1(t)),epe=Fm(Lp,xV),tpe={kernelName:Lp,backendName:"cpu",kernelFunc:epe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _V=Ju(t=>Math.floor(t)),npe=Fm(Bp,_V),rpe={kernelName:Bp,backendName:"cpu",kernelFunc:npe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SV(t,e,n,r,i,s,o,a,l){const c=mn([r,s],n);for(let u=0;u<r;u++){const h=[];let f=0;for(let d=0;d<i;d++){const p=t[u*i+d];f+=p*o[d],h.push(p)}if(f<0||f>=l/s)throw new Error(`Invalid indices: ${h} does not index into ${a}`);for(let d=0;d<s;d++)c.values[u*s+d]=e.get(...e.indexToLoc(f*s+d))}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CV(t,e,n){const r=mn(n,t.dtype);for(let i=0;i<r.size;++i){const o=r.indexToLoc(i).slice(),a=o[0],l=o[2],c=e.locToIndex([a,l]);o[2]=e.values[c];const u=t.locToIndex(o);r.values[i]=t.values[u]}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TV=oi((t,e)=>t>e?1:0),ipe=Ii(Wy,TV,null,"bool"),spe={kernelName:Wy,backendName:"cpu",kernelFunc:ipe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EV=oi((t,e)=>t>=e?1:0),ope=Ii(Vp,EV,null,"bool"),ape={kernelName:Vp,backendName:"cpu",kernelFunc:ope};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kV=oi((t,e)=>t<e?1:0),lpe=Ii(Hy,kV,null,"bool"),cpe={kernelName:Hy,backendName:"cpu",kernelFunc:lpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AV=oi((t,e)=>t<=e?1:0),upe=Ii(jy,AV,null,"bool"),hpe={kernelName:jy,backendName:"cpu",kernelFunc:upe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MV(t,e,n){const r=(e-t)/(n-1),i=Vi(n,"float32");i[0]=t;for(let s=1;s<i.length;s++)i[s]=i[s-1]+r;return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IV=Ju(t=>Math.log(t)),fpe=Fm(jp,IV),dpe={kernelName:jp,backendName:"cpu",kernelFunc:fpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NV(t,e,n,r){const i=fi(r,_e(n));for(let s=0;s<i.length;++s){const o=s*e;let a=t[o];for(let l=0;l<e;++l){const c=t[o+l];(Number.isNaN(c)||c>a)&&(a=c)}i[s]=a}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $V=oi((t,e)=>Math.max(t,e)),ppe=Ii(Xp,$V),mpe={kernelName:Xp,backendName:"cpu",kernelFunc:ppe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RV=oi((t,e)=>Math.min(t,e)),gpe=Ii(Kp,RV),vpe={kernelName:Kp,backendName:"cpu",kernelFunc:gpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _N=oi((t,e)=>t*e),ype=wN((t,e,n,r)=>({real:t*n-e*r,imag:t*r+e*n})),fC=Ii(Zp,_N,ype),bpe={kernelName:Zp,backendName:"cpu",kernelFunc:fC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DV(t,e,n){const r=Dc(-1,n);return _N([],e,r,t,n)}function wpe(t){const{inputs:e,backend:n}=t,{x:r}=e;_t(r,"neg");const i=n.data.get(r.dataId).values,[s,o]=DV(i,r.shape,r.dtype);return n.makeTensorInfo(o,r.dtype,s)}const xpe={kernelName:r0,backendName:"cpu",kernelFunc:wpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PV=oi((t,e)=>t!==e?1:0),_pe=Ii(i0,PV,null,"bool"),Spe={kernelName:i0,backendName:"cpu",kernelFunc:_pe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SN(t,e,n,r,i){const s=e.length,o=_e(e),a=Rt(e),l=Rt(i),c=fi(n,_e(i));for(let u=0;u<o;++u){const h=wp(u,s,a),f=new Array(h.length);for(let p=0;p<f.length;p++)f[p]=h[r[p]];const d=qa(f,s,l);c[d]=t[u]}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oo(t){const{inputs:e,attrs:n,backend:r}=t,{x:i}=e,{perm:s}=n;_t(i,"transpose");const o=i.shape.length,a=new Array(o);for(let h=0;h<a.length;h++)a[h]=i.shape[s[h]];const l=r.data.get(i.dataId).values,c=SN(l,i.shape,i.dtype,s,a);return{dataId:r.write(c,a,i.dtype),shape:a,dtype:i.dtype}}const Cpe={kernelName:w0,backendName:"cpu",kernelFunc:Oo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OV(t,e,n,r){const[i,s]=Mi(t,r),o=eo(e,"int32"),a=Vi(_e(i),o),l=_e(s);for(let c=0;c<a.length;++c){const u=c*l;let h=1;for(let f=0;f<l;++f)h*=n[u+f];a[c]=h}return{outVals:a,outShape:i,outDtype:o}}function Tpe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;_t(i,"prod");const a=i.shape.length,l=hn(s,i.shape),c=Hr(l,a);let u=l,h=i;const f=[];c!=null&&(h=Oo({inputs:{x:i},backend:n,attrs:{perm:c}}),f.push(h),u=si(u.length,a));const d=n.data.get(h.dataId).values,{outVals:p,outShape:m,outDtype:v}=OV(h.shape,h.dtype,d,u);let y=m;return o&&(y=Gr(m,l)),f.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.makeTensorInfo(y,v,p)}const Epe={kernelName:V_,backendName:"cpu",kernelFunc:Tpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FV(t,e,n,r){const i=t===e,s=t<e&&n<0,o=e<t&&n>1;if(i||s||o)return Vi(0,r);const a=Math.abs(Math.ceil((e-t)/n)),l=Vi(a,r);e<t&&n===1&&(n=-1),l[0]=t;for(let c=1;c<l.length;c++)l[c]=l[c-1]+n;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LV=Ju(t=>1/Math.sqrt(t)),kpe=Fm(rm,LV),Ape={kernelName:rm,backendName:"cpu",kernelFunc:kpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mpe=Ju(t=>1/(1+Math.exp(-t))),BV=jn(lm,t=>1/(1+Math.exp(-t))),Ipe={kernelName:lm,backendName:"cpu",kernelFunc:BV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zV(t,e,n,r,i){const s=cI(r,e,n),o=_e(n),a=Rt(r);if(s){const h=uI(e,a);return i==="string"?t.slice(h,h+o):t.subarray(h,h+o)}const l=i==="string"?Cf(t):t,c=mn(r,i,l),u=mn(n,i);for(let h=0;h<u.size;++h){const f=u.indexToLoc(h),d=f.map((p,m)=>p+e[m]);u.set(c.get(...d),...f)}return i==="string"?cV(u.values):u.values}function Ef(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{begin:s,size:o}=r;_t(i,"slice");const[a,l]=_S(i,s,o);aI(i,a,l);const c=n.data.get(i.dataId).values,u=zV(c,a,l,i.shape,i.dtype);return n.makeTensorInfo(l,i.dtype,u)}const Npe={kernelName:m0,backendName:"cpu",kernelFunc:Ef};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VV(t,e,n,r,i,s,o){const a=e[0],l=s[0],c=new Array(l),u=new Array(a),h=e[1];if(l===0){if(a!==0)throw new Error(Y4(a));const v=hs(n,0),y=hs(i,0);return[v,[0,h],y,c,u]}let f=!0,d=0;const p=new Array(l).fill(0);for(let v=0;v<a;++v){const y=t[v*h];if(y<0)throw new Error(Z4(v,y));if(y>=l)throw new Error(J4(v,y,l));++p[y],f=f&&y>=d,d=y}let m=!0;for(let v=0;v<l;++v){const y=p[v]===0;c[v]=y,m=m&&!y,p[v]=Math.max(p[v],1),v>0&&(p[v]+=p[v-1])}if(m&&f){const v=t,y=r;for(let w=0;w<a;++w)u[w]=w;return[v,[a,h],y,c,u]}else{const v=p[l-1],y=hs(n,v*h),w=hs(i,v),x=new Array(l).fill(0);for(let _=0;_<a;++_){const S=t[_*h],T=x[S],E=(S===0?0:p[S-1])+T;x[S]++;for(let k=0;k<h;++k)y[E*h+k]=t[_*h+k];w[E]=r[_],u[_]=E}for(let _=0;_<l;++_)if(x[_]===0){const T=_===0?0:p[_-1];y[T*h+0]=_;for(let E=1;E<h;++E)y[T*h+E]=0;w[T]=o}return[y,[v,h],w,c,u]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UV(t,e,n,r,i){const s=_e(r),o=e[0],a=i.length,l=[];let c=1,u=-1;for(let v=0;v<a;++v){const y=i[v];if(y===-1){if(u!==-1)throw new Error(Q4(u,v));u=v,l.push(1)}else{if(y<0)throw new Error(eV(v,y));c*=y,l.push(y)}}if(u!==-1){if(c<=0)throw new Error(tV());const v=Math.trunc(s/c);if(c*v!==s)throw new Error(nV(r,l));l[u]=v}if(_e(l)!==s)throw new Error(rV(r,l));const f=r.length,d=[];if(f>0){d[f-1]=1;for(let v=f-2;v>=0;--v)d[v]=d[v+1]*r[v+1]}const p=[];if(a>0){p[a-1]=1;for(let v=a-2;v>=0;--v)p[v]=p[v+1]*l[v+1]}const m=hs(n,o*a);for(let v=0;v<o;++v){let y=0;for(let w=0;w<f;++w)y+=t[v*f+w]*d[w];for(let w=0;w<a;++w)m[v*a+w]=Math.trunc(y/p[w]),y%=p[w]}return[m,[o,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CN(t,e,n,r,i,s=!1,o=0){const a=r.length,l=[e[0],t.length/e[0]],c=l[1],h=a>0?i[a-1]+1:0;if(h<0)throw new Error(yN());const f=e.slice();f[0]=h;const d=f.reduce((x,_)=>x*_,1),p=hs(n,d);if(a===0)return h>0&&p.fill(o),[p,f];if(h<=0)throw new Error(yN());let m=0,v=1,y=0,w=i[m];for(;;){let x=0;if(v<a){if(x=i[v],w===x){++v;continue}if(w>=x)throw new Error(iV())}if(w<0||w>=h)throw new Error(sV(w,h));w>y&&p.fill(o,y*c,w*c);for(let _=m;_<v;++_){const S=r[_];if(S<0||S>=l[0])throw new Error(oV(_,r[_],l[0]));for(let T=0;T<c;T++)p[w*c+T]+=t[S*c+T]}if(s)for(let _=0;_<c;_++)p[w*c+_]/=v-m;if(m=v,++v,y=w+1,w=x,v>a)break}return y<h&&p.fill(o,y*c,h*c),[p,f]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $pe=Ju(t=>Math.sqrt(t)),Rpe=jn(um,t=>Math.sqrt(t)),Dpe={kernelName:um,backendName:"cpu",kernelFunc:Rpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WV=oi((t,e)=>{const n=t-e;return n*n}),Ppe=Ii(hm,WV),Ope={kernelName:hm,backendName:"cpu",kernelFunc:Ppe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GV(t,e,n,r){const i=mn(t,e.dtype);for(let s=0;s<i.size;s++){const o=i.indexToLoc(s),a=new Array(o.length);for(let l=0;l<a.length;l++)a[l]=o[l]*n[l]+r[l];i.set(e.get(...a),...o)}return i}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fpe{constructor(e,n,r,i,s,o){this.separator=Fl(e),this.nGramWidths=n,this.leftPad=Fl(r),this.rightPad=Fl(i),this.padWidth=s,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,n){const r=this.getPadWidth(n);return Math.max(0,e+2*r-n+1)}createNGrams(e,n,r,i,s,o){for(let a=0;a<s;++a){const l=this.getPadWidth(o),c=Math.max(0,l-a),u=Math.max(0,l-(s-(a+1))),h=o-(c+u),f=n+(c>0?0:a-l);let d=0;d+=c*this.leftPad.length;for(let w=0;w<h;++w)d+=e[f+w].length;d+=u*this.rightPad.length,d+=(c+u+h-1)*this.separator.length,r[i+a]=new Uint8Array(d);const m=r[i+a];let v=0;const y=w=>w.forEach(x=>m[v++]=x);for(let w=0;w<c;++w)y(this.leftPad),y(this.separator);for(let w=0;w<h-1;++w)y(e[f+w]),y(this.separator);if(h>0){y(e[f+h-1]);for(let w=0;w<u;++w)y(this.separator),y(this.rightPad)}else{for(let w=0;w<u-1;++w)y(this.rightPad),y(this.separator);y(this.rightPad)}}}compute(e,n){const r=e.length,i=n.length;if(i>0){let l=n[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let c=1;c<i;++c){let u=n[c]>=l;if(u=u&&n[c]<=r,!u)throw new Error(`Invalid split value ${n[c]}, must be in [${l}, ${r}]`);l=n[c]}if(l!==r)throw new Error(`Last split value must be data size. Expected ${r}, got ${l}`)}const s=i-1,o=hs("int32",i);if(r===0||i===0){const l=new Array(r);for(let c=0;c<=s;++c)o[c]=0;return[l,o]}o[0]=0;for(let l=1;l<=s;++l){const c=n[l]-n[l-1];let u=0;this.nGramWidths.forEach(h=>{u+=this.getNumNGrams(c,h)}),this.preserveShort&&c>0&&u===0&&(u=1),o[l]=o[l-1]+u}const a=new Array(o[s]);for(let l=0;l<s;++l){const c=n[l];let u=o[l];if(this.nGramWidths.forEach(h=>{const f=n[l+1]-n[l],d=this.getNumNGrams(f,h);this.createNGrams(e,c,a,u,d,h),u+=d}),this.preserveShort&&u===o[l]){const h=n[l+1]-n[l];if(h===0)continue;const f=h+2*this.padWidth,d=1;this.createNGrams(e,c,a,u,d,f)}}return[a,o]}}function HV(t,e,n,r,i,s,o,a){return new Fpe(n,r,i,s,o,a).compute(t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lpe(t,e,n,r){if(!t.length)return;if(e.length===0){for(let s=0;s<t.length;++s)r.push(t.subarray(s,s+1));return}if(e.length===1){const s=e[0];let o=t.indexOf(s);for(;o!==-1;){const a=t.subarray(0,o);(!n||a.length!==0)&&r.push(a),t=t.subarray(o+1),o=t.indexOf(s)}(!n||t.length!==0)&&r.push(t);return}let i=0;for(let s=0;s<t.length+1;s++)if(s===t.length||e.indexOf(t[s])!==-1){const o=t.subarray(i,s);(!n||o.length!==0)&&r.push(o),i=s+1}}function jV(t,e,n){const r=t.length,i=[];let s=0,o=0;const a=new Array(r);for(let f=0;f<r;++f){const d=i.length;Lpe(t[f],e,n,i);const p=i.length-d;a[f]=p,s+=p,o=Math.max(o,p)}const l=hs("int32",s*2),c=new Array(s),u=[r,o];let h=0;for(let f=0;f<r;++f)for(let d=0;d<a[f];++d)l[h*2]=f,l[h*2+1]=d,c[h]=i[h],++h;return[l,c,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qV(t,e){const n=hs("int32",t.length);for(let r=0;r<t.length;++r)n[r]=LB(t[r]).modulo(e).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XV=oi((t,e)=>t-e),Bpe=wN((t,e,n,r)=>({real:t-n,imag:e-r})),TN=Ii(fm,XV,Bpe),zpe={kernelName:fm,backendName:"cpu",kernelFunc:TN};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KV(t,e){const n=new Array(t.rank);for(let i=0;i<n.length;i++)n[i]=t.shape[i]*e[i];const r=mn(n,t.dtype);for(let i=0;i<r.values.length;++i){const s=r.indexToLoc(i),o=new Array(t.rank);for(let l=0;l<o.length;l++)o[l]=s[l]%t.shape[l];const a=t.locToIndex(o);r.values[i]=t.values[a]}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eb=(t,e)=>{const n=e.value-t.value;return n===0?t.index-e.index:n};function YV(t,e,n=0,r=t.length-1){for(;r>n;){if(r-n>600){const a=r-n+1,l=e-n+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*Math.sign(l-a/2),f=Math.max(n,Math.floor(e-l*u/a+h)),d=Math.min(r,Math.floor(e+(a-l)*u/a+h));YV(t,e,f,d)}const i=t[e];let s=n,o=r;for(Nc(t,n,e),eb(t[r],i)>0&&Nc(t,n,r);s<o;){for(Nc(t,s,o),s++,o--;eb(t[s],i)<0;)s=s+1;for(;eb(t[o],i)>0;)o=o-1}eb(t[n],i)===0?Nc(t,n,o):(o=o+1,Nc(t,o,r)),o<=e&&(n=o+1),e<=o&&(r=o-1)}}function ZV(t,e,n,r,i){const s=e[e.length-1],[o,a]=[t.length/s,s],l=fi(n,o*r),c=fi("int32",o*r);for(let h=0;h<o;h++){const f=h*a,d=t.subarray(f,f+a);let p=new Array(d.length);d.forEach((w,x)=>p[x]={value:w,index:x}),r<p.length&&(YV(p,r),p=p.slice(0,r)),i&&p.sort(eb);const m=h*r,v=l.subarray(m,m+r),y=c.subarray(m,m+r);for(let w=0;w<r;w++)v[w]=p[w].value,y[w]=p[w].index}const u=e.slice();return u[u.length-1]=r,[mn(u,n,l),mn(u,"int32",c)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JV(t,e,n,r){const i=hn(e,n)[0],s=[1,n[0],1];for(let p=0;p<i;p++)s[0]*=n[p];s[1]=n[i];for(let p=i+1;p<n.length;p++)s[2]*=n[p];const o={},a=new Int32Array(n[i]),l=new di(s,r,t),c=[],u=s[0]===1&&s[2]===1;for(let p=0;p<n[i];p++){let m;if(u)m=t[p].toString();else{const v=[];for(let y=0;y<s[0];y++)for(let w=0;w<s[2];w++)v.push(l.get(y,p,w));m=v.join(",")}if(o[m]!==void 0)a[p]=o[m];else{const v=Object.keys(o).length;o[m]=v,a[p]=v,c.push(p)}}const h=s.slice();h[1]=Object.keys(o).length;const f=new di(h,r);c.forEach((p,m)=>{for(let v=0;v<s[0];v++)for(let y=0;y<s[2];y++)f.set(l.get(v,p,y),v,m,y)});const d=n.slice();return d[i]=h[1],{outputValues:f.values,outputShape:d,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Vpe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",simpleAbsImpl:fV,addImpl:dV,bincountImpl:xN,bincountReduceImpl:pV,ceilImpl:mV,concatImpl:gV,equalImpl:vV,expImpl:bV,expm1Impl:xV,floorImpl:_V,gatherNdImpl:SV,gatherV2Impl:CV,greaterImpl:TV,greaterEqualImpl:EV,lessImpl:kV,lessEqualImpl:AV,linSpaceImpl:MV,logImpl:IV,maxImpl:NV,maximumImpl:$V,minimumImpl:RV,multiplyImpl:_N,negImpl:DV,notEqualImpl:PV,prodImpl:OV,rangeImpl:FV,rsqrtImpl:LV,sigmoidImpl:Mpe,sliceImpl:zV,sparseFillEmptyRowsImpl:VV,sparseReshapeImpl:UV,sparseSegmentReductionImpl:CN,sqrtImpl:$pe,squaredDifferenceImpl:WV,stridedSliceImpl:GV,stringNGramsImpl:HV,stringSplitImpl:jV,stringToHashBucketFastImpl:qV,subImpl:XV,tileImpl:KV,topKImpl:ZV,transposeImpl:SN,uniqueImpl:JV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mI("cpu",()=>new uC,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QV=jn(Pp,t=>t>=0?t:Math.exp(t)-1),Upe={kernelName:Pp,backendName:"cpu",kernelFunc:QV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eU(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{alpha:s}=r;_t([i],"leakyRelu");const o=_e(i.shape),a=n.data.get(i.dataId).values,l=fi("float32",o);for(let c=0;c<a.length;c++)l[c]=a[c]<0?s*a[c]:a[c];return n.makeTensorInfo(i.shape,"float32",l)}const Wpe={kernelName:Gy,backendName:"cpu",kernelFunc:eU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gpe=oi((t,e)=>t<0?e*t:t);function tU(t){const{inputs:e,backend:n}=t,{x:r,alpha:i}=e;_t([r,i],"prelu");const s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,[a,l]=Gpe(r.shape,i.shape,s,o,"float32");return n.makeTensorInfo(l,"float32",a)}const Hpe={kernelName:c0,backendName:"cpu",kernelFunc:tU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nU=jn(em,t=>Math.max(0,t)),jpe={kernelName:em,backendName:"cpu",kernelFunc:nU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rU=jn(tm,t=>Math.min(Math.max(0,t),6)),qpe={kernelName:tm,backendName:"cpu",kernelFunc:rU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EN(t,e,n,r,i){if(n==="linear")return Hl({inputs:{x:e},backend:t});if(n==="relu")return nU({inputs:{x:e},backend:t});if(n==="elu")return QV({inputs:{x:e},backend:t});if(n==="relu6")return rU({inputs:{x:e},backend:t});if(n==="prelu")return tU({inputs:{x:e,alpha:r},backend:t});if(n==="leakyrelu")return eU({inputs:{x:e},backend:t,attrs:{alpha:i}});if(n==="sigmoid")return BV({inputs:{x:e},backend:t});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Er(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{shape:s}=r,o=_e(i.shape),a=vM(s,o),l=_e(a);z(o===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${i.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),n.incRef(i.dataId);const c=n.data.get(i.dataId);if(c.complexTensorInfos!=null){const u=c.complexTensorInfos.real,h=c.complexTensorInfos.imag;u.shape=a,h.shape=a}return{dataId:i.dataId,shape:a,dtype:i.dtype}}const Xpe={kernelName:u0,backendName:"cpu",kernelFunc:Er};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iU(t){const{inputs:e,backend:n,attrs:r}=t,{a:i,b:s}=e,{transposeA:o,transposeB:a}=r;_t([i,s],"matMul");const l=i.shape.length,c=s.shape.length,u=o?i.shape[l-2]:i.shape[l-1],h=a?s.shape[c-1]:s.shape[c-2],f=o?i.shape[l-1]:i.shape[l-2],d=a?s.shape[c-2]:s.shape[c-1],p=i.shape.slice(0,-2),m=s.shape.slice(0,-2),v=_e(p),y=_e(m),x=Qt(i.shape.slice(0,-2),s.shape.slice(0,-2)).concat([f,d]);z(u===h,()=>`Error in matMul: inner shapes (${u}) and (${h}) of Tensors with shapes ${i.shape} and ${s.shape} and transposeA=${o} and transposeB=${a} must match.`);const _=o?[v,u,f]:[v,f,u],S=a?[y,d,h]:[y,h,d],T=Er({inputs:{x:i},backend:n,attrs:{shape:_}}),E=Er({inputs:{x:s},backend:n,attrs:{shape:S}}),k=o?T.shape[1]:T.shape[2],A=o?T.shape[2]:T.shape[1],M=a?E.shape[1]:E.shape[2],D=Math.max(v,y),P=n.data.get(T.dataId).values,N=n.data.get(E.dataId).values,R=Rt(T.shape),F=Rt(E.shape),[O,K,J]=o?[R[0],1,R[1]]:[R[0],R[1],1],[re,ae,pe]=a?[1,F[1],F[0]]:[F[1],1,F[0]],ke=A*M,Te=mn([D,A,M],T.dtype),Ne=Te.values,we=n.blockSize;for(let me=0;me<D;me++)for(let He=0;He<A;He+=we)for(let Fe=0;Fe<M;Fe+=we)for(let je=0;je<k;je+=we){const Ve=Math.min(He+we,A),Se=Math.min(Fe+we,M),nt=Math.min(je+we,k);for(let Ct=He;Ct<Ve;Ct++)for(let pt=Fe;pt<Se;pt++){let Ht=0;for(let Mt=je;Mt<nt;Mt++){const q=Math.min(me,v-1)*O,Y=Math.min(me,y-1)*pe,Xe=P[q+Ct*K+Mt*J],Re=N[Mt*re+pt*ae+Y];Ht+=Xe*Re}Ne[me*ke+(Ct*M+pt)]+=Ht}}return n.disposeIntermediateTensorInfo(T),n.disposeIntermediateTensorInfo(E),n.makeTensorInfo(x,Te.dtype,Te.values)}const Kpe={kernelName:My,backendName:"cpu",kernelFunc:iU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ype(t){const{inputs:e,backend:n,attrs:r}=t,{a:i,b:s,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:h}=r;let f,d,p;const m=[];f=iU({inputs:{a:i,b:s},attrs:{transposeA:l,transposeB:c},backend:n}),o&&(d=Q0({inputs:{a:f,b:o},backend:n}),m.push(f),f=d),u&&(p=EN(n,f,u,a,h),m.push(f),f=p);for(const y of m)n.disposeIntermediateTensorInfo(y);return f}const Zpe={kernelName:C0,backendName:"cpu",kernelFunc:Ype};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jpe=jn(_p,t=>Math.acos(t)),Qpe={kernelName:_p,backendName:"cpu",kernelFunc:Jpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eme=jn(Sp,t=>Math.acosh(t)),tme={kernelName:Sp,backendName:"cpu",kernelFunc:eme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nme(t){const{inputs:e,backend:n}=t,r=e;_t(e,"addN");const i=r.map(a=>n.data.get(a.dataId).values),s=mn(r[0].shape,r[0].dtype),o=s.values;for(let a=0;a<r.length;a++){const l=i[a];for(let c=0;c<o.length;c++)o[c]+=l[c]}return n.makeTensorInfo(s.shape,s.dtype,s.values)}const rme={kernelName:Cy,backendName:"cpu",kernelFunc:nme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ime(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;_t(i,"all");const a=hn(s,i.shape);let l=a;const c=Hr(l,i.shape.length);let u=i;c!=null&&(u=Oo({inputs:{x:i},backend:n,attrs:{perm:c}}),l=si(l.length,i.shape.length)),Wi("all",l,u.shape.length);const[h,f]=Mi(u.shape,l),d=_e(f),p=Vi(_e(h),u.dtype),m=n.data.get(u.dataId).values;for(let y=0;y<p.length;++y){const w=y*d;let x=m[w];for(let _=0;_<d;++_){const S=m[w+_];x=x&&S}p[y]=x}c!=null&&n.disposeIntermediateTensorInfo(u);const v=n.makeTensorInfo(h,u.dtype,p);if(o){const y=Gr(h,a),w=Er({inputs:{x:v},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(v),w}return v}const sme={kernelName:o_,backendName:"cpu",kernelFunc:ime};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ome(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;_t(i,"any");const a=hn(s,i.shape);let l=a;const c=Hr(l,i.shape.length);let u=i;c!=null&&(u=Oo({inputs:{x:i},backend:n,attrs:{perm:c}}),l=si(l.length,i.shape.length)),Wi("any",l,u.shape.length);const[h,f]=Mi(u.shape,l),d=_e(f),p=Vi(_e(h),u.dtype),m=n.data.get(u.dataId).values;for(let y=0;y<p.length;++y){const w=y*d;let x=m[w];for(let _=0;_<d;++_){const S=m[w+_];x=x||S}p[y]=x}c!=null&&n.disposeIntermediateTensorInfo(u);const v=n.makeTensorInfo(h,u.dtype,p);if(o){const y=Gr(h,a),w=Er({inputs:{x:v},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(v),w}return v}const ame={kernelName:a_,backendName:"cpu",kernelFunc:ome};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lme(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s}=r;_t(i,"argMax");let o=hn(s,i.shape);const a=Hr(o,i.shape.length);let l=i;const c=[];a!=null&&(l=Oo({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(l),o=si(o.length,l.shape.length)),o=[o[0]],Wi("argMax",o,l.shape.length);const[u,h]=Mi(l.shape,o),f=_e(u),d=Vi(f,"int32"),p=_e(h),m=n.data.get(l.dataId).values;for(let v=0;v<d.length;++v){const y=v*p;let w=m[y],x=0;for(let _=0;_<p;++_){const S=m[y+_];S>w&&(w=S,x=_)}d[v]=x}return c.forEach(v=>n.disposeIntermediateTensorInfo(v)),n.makeTensorInfo(u,"int32",d)}const cme={kernelName:Ty,backendName:"cpu",kernelFunc:lme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ume(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s}=r;_t(i,"argMin");let o=hn(s,i.shape);const a=Hr(o,i.shape.length);let l=i;const c=[];a!=null&&(l=Oo({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(l),o=si(o.length,l.shape.length)),o=[o[0]],Wi("argMin",o,l.shape.length);const[u,h]=Mi(l.shape,o),f=_e(u),d=Vi(f,"int32"),p=_e(h),m=n.data.get(l.dataId).values;for(let v=0;v<d.length;++v){const y=v*p;let w=m[y],x=0;for(let _=0;_<p;++_){const S=m[y+_];S<w&&(w=S,x=_)}d[v]=x}return c.forEach(v=>n.disposeIntermediateTensorInfo(v)),n.makeTensorInfo(u,"int32",d)}const hme={kernelName:Ey,backendName:"cpu",kernelFunc:ume};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fme=jn(Cp,t=>Math.asin(t)),dme={kernelName:Cp,backendName:"cpu",kernelFunc:fme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pme=jn(Tp,t=>Math.asinh(t)),mme={kernelName:Tp,backendName:"cpu",kernelFunc:pme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gme=jn(Ep,t=>Math.atan(t)),vme={kernelName:Ep,backendName:"cpu",kernelFunc:gme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yme=oi((t,e)=>Math.atan2(t,e)),bme=Ii(Ap,yme),wme={kernelName:Ap,backendName:"cpu",kernelFunc:bme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xme=jn(kp,t=>Math.atanh(t)),_me={kernelName:kp,backendName:"cpu",kernelFunc:xme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kN(t,e,n,r,i,s){const o=i.strideHeight,a=i.strideWidth,l=i.dilationHeight,c=i.dilationWidth,u=i.effectiveFilterHeight,h=i.effectiveFilterWidth,f=i.padInfo.top,d=i.padInfo.left,p=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=mn(i.outShape,n),v=m.values,y=i.outShape[1]*i.outShape[2]*i.outShape[3],w=i.outShape[2]*i.outShape[3],x=i.outShape[3];for(let _=0;_<i.batchSize;++_){const S=_*y,T=_*r[0];for(let E=0;E<i.inChannels;++E)for(let k=0;k<i.outHeight;++k){const A=k*o-f,M=Math.max(0,A),D=Math.min(i.inHeight,u+A),P=S+k*w;for(let N=0;N<i.outWidth;++N){const R=N*a-d,F=Math.max(0,R),O=Math.min(i.inWidth,h+R);let K=p,J=0,re=0;for(let pe=M;pe<D;pe+=l){const ke=T+pe*r[1];for(let Te=F;Te<O;Te+=c){const Ne=ke+Te*r[2],we=t[Ne+E];s==="max"&&we>K?K=we:s==="avg"&&(J+=we,re++)}if(isNaN(K))break}const ae=P+N*x+E;v[ae]=s==="avg"?J/re:K}}}return m}function sU(t,e,n,r,i=!1,s=!1){const o=mn(r.outShape,"int32"),a=r.strideHeight,l=r.strideWidth,c=r.dilationHeight,u=r.dilationWidth,h=r.effectiveFilterHeight,f=r.effectiveFilterWidth,d=r.padInfo.top,p=r.padInfo.left,m=mn(e,n,t);for(let v=0;v<r.batchSize;++v)for(let y=0;y<r.inChannels;++y)for(let w=0;w<r.outHeight;++w){const x=w*a-d;let _=x;for(;_<0;)_+=c;const S=Math.min(r.inHeight,h+x);for(let T=0;T<r.outWidth;++T){const E=T*l-p;let k=E;for(;k<0;)k+=u;const A=Math.min(r.inWidth,f+E);let M=Number.NEGATIVE_INFINITY,D=-1;for(let P=_;P<S;P+=c){const N=P-x;for(let R=k;R<A;R+=u){const F=R-E,O=m.get(v,P,R,y);O>M&&(M=O,i?D=s?((v*r.inHeight+P)*r.inWidth+R)*r.inChannels+y:(P*r.inWidth+R)*r.inChannels+y:D=N*f+F)}}o.set(D,v,w,T,y)}}return o}function oU(t,e,n,r,i,s){const o=i.strideDepth,a=i.strideHeight,l=i.strideWidth,c=i.dilationDepth,u=i.dilationHeight,h=i.dilationWidth,f=i.effectiveFilterDepth,d=i.effectiveFilterHeight,p=i.effectiveFilterWidth,m=i.padInfo.front,v=i.padInfo.top,y=i.padInfo.left,w=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=mn(i.outShape,n),_=x.values,S=i.outShape[1]*i.outShape[2]*i.outShape[3]*i.outShape[4],T=i.outShape[2]*i.outShape[3]*i.outShape[4],E=i.outShape[3]*i.outShape[4],k=i.outShape[4];for(let A=0;A<i.batchSize;++A){const M=A*S,D=A*r[0];for(let P=0;P<i.inChannels;++P)for(let N=0;N<i.outDepth;++N){const R=N*o-m;let F=R;for(;F<0;)F+=c;const O=Math.min(i.inDepth,f+R),K=M+N*T;for(let J=0;J<i.outHeight;++J){const re=J*a-v;let ae=re;for(;ae<0;)ae+=u;const pe=Math.min(i.inHeight,d+re),ke=K+J*E;for(let Te=0;Te<i.outWidth;++Te){const Ne=Te*l-y;let we=Ne;for(;we<0;)we+=h;const me=Math.min(i.inWidth,p+Ne),He=ke+Te*k;let Fe=w,je=0,Ve=0;for(let nt=F;nt<O;nt+=c){const Ct=D+nt*r[1];for(let pt=ae;pt<pe;pt+=u){const Ht=Ct+pt*r[2];for(let Mt=we;Mt<me;Mt+=h){const q=Ht+Mt*r[3],Y=t[q+P];if(s==="max"&&Y>Fe?Fe=Y:s==="avg"&&(je+=Y,Ve++),isNaN(Fe))break}if(isNaN(Fe))break}if(isNaN(Fe))break}const Se=He+P;_[Se]=s==="avg"?je/Ve:Fe}}}}return x}function Sme(t,e){const n=mn(e.outShape,"int32"),r=e.strideDepth,i=e.strideHeight,s=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,u=e.effectiveFilterHeight,h=e.effectiveFilterWidth,f=e.padInfo.front,d=e.padInfo.top,p=e.padInfo.left;for(let m=0;m<e.batchSize;++m)for(let v=0;v<e.inChannels;++v)for(let y=0;y<e.outDepth;++y){const w=y*r-f;let x=w;for(;x<0;)x+=o;const _=Math.min(e.inDepth,c+w);for(let S=0;S<e.outHeight;++S){const T=S*i-d;let E=T;for(;E<0;)E+=a;const k=Math.min(e.inHeight,u+T);for(let A=0;A<e.outWidth;++A){const M=A*s-p;let D=M;for(;D<0;)D+=l;const P=Math.min(e.inWidth,h+M);let N=Number.NEGATIVE_INFINITY,R=-1;for(let F=x;F<_;F+=o){const O=F-w;for(let K=E;K<k;K+=a){const J=K-T;for(let re=D;re<P;re+=l){const ae=re-M,pe=t.get(m,F,K,re,v);pe>=N&&(N=pe,R=O*u*h+J*u+ae)}}}n.set(R,m,y,S,A,v)}}}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cme(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;_t(i,"avgPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:l}=r,c=1;z(Ui(o,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const u=ca(i.shape,s,o,c,a,l);let h;if(u.filterWidth===1&&u.filterHeight===1&&wn(u.inShape,u.outShape))h=Hl({inputs:{x:i},backend:n});else{const f=n.data.get(i.dataId).values,d=Rt(i.shape),p=kN(f,i.shape,i.dtype,d,u,"avg");h=n.makeTensorInfo(u.outShape,i.dtype,p.values)}return h}const Tme={kernelName:ky,backendName:"cpu",kernelFunc:Cme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eme(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{filterSize:s,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=r;_t(i,"avgPool3d");const u=Fc(i.shape,s,o,1,a,l,c),h=n.data.get(i.dataId).values,f=oU(h,i.shape,i.dtype,Rt(i.shape),u,"avg");return n.makeTensorInfo(f.shape,"float32",f.values)}const kme={kernelName:Ay,backendName:"cpu",kernelFunc:Eme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ame(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:c}=r;_t([i,s],"avgPool3DGrad");const u=Fc(s.shape,o,a,1,l,c),h=u.strideDepth,f=u.strideHeight,d=u.strideWidth,p=u.filterDepth,m=u.filterHeight,v=u.filterWidth,y=u.dilationDepth,w=u.dilationHeight,x=u.dilationWidth,_=u.effectiveFilterDepth,S=u.effectiveFilterHeight,T=u.effectiveFilterWidth,E=_-1-u.padInfo.front,k=T-1-u.padInfo.left,A=S-1-u.padInfo.top,M=mn(s.shape,"float32"),D=1/(p*m*v),P=n.bufferSync(i);for(let N=0;N<u.batchSize;++N)for(let R=0;R<u.inChannels;++R)for(let F=0;F<u.inDepth;++F)for(let O=0;O<u.inHeight;++O)for(let K=0;K<u.inWidth;++K){const J=F-E,re=O-A,ae=K-k;let pe=0;for(let ke=0;ke<_;ke+=y){const Te=(J+ke)/h;if(!(Te<0||Te>=u.outDepth||Math.floor(Te)!==Te))for(let Ne=0;Ne<S;Ne+=w){const we=(re+Ne)/f;if(!(we<0||we>=u.outHeight||Math.floor(we)!==we))for(let me=0;me<T;me+=x){const He=(ae+me)/d;if(He<0||He>=u.outWidth||Math.floor(He)!==He)continue;pe+=P.get(N,Te,we,He,R)}}}M.set(pe*D,N,F,O,K,R)}return n.makeTensorInfo(M.shape,M.dtype,M.values)}const Mme={kernelName:c_,backendName:"cpu",kernelFunc:Ame};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ime(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,o=s;_t([i,s],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=r,u=ca(o.shape,a,l,1,c),h=u.strideHeight,f=u.strideWidth,d=u.filterHeight,p=u.filterWidth,m=u.dilationHeight,v=u.dilationWidth,y=u.effectiveFilterHeight,w=u.effectiveFilterWidth,x=w-1-u.padInfo.left,_=y-1-u.padInfo.top,S=mn(o.shape,"float32"),T=1/(d*p),E=n.data.get(i.dataId).values,k=mn(i.shape,"float32",E);for(let A=0;A<u.batchSize;++A)for(let M=0;M<u.inChannels;++M)for(let D=0;D<u.inHeight;++D)for(let P=0;P<u.inWidth;++P){const N=D-_,R=P-x;let F=0;for(let O=0;O<y;O+=m){const K=(N+O)/h;if(!(K<0||K>=u.outHeight||Math.floor(K)!==K))for(let J=0;J<w;J+=v){const re=(R+J)/f;if(re<0||re>=u.outWidth||Math.floor(re)!==re)continue;F+=k.get(A,K,re,M)}}S.set(F*T,A,D,P,M)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}const Nme={kernelName:l_,backendName:"cpu",kernelFunc:Ime};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $me(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,scale:s,offset:o,mean:a,variance:l}=e;z(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),z(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),z(s==null||a.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),_t([i,a,l,s,o],"batchNorm");let{varianceEpsilon:c}=r;c==null&&(c=.001);const u=n.data.get(i.dataId).values,h=n.data.get(a.dataId).values,f=n.data.get(l.dataId).values,d=s?n.data.get(s.dataId).values:new Float32Array([1]),p=o?n.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(u.length),v=p.length,y=d.length,w=f.length,x=h.length;let _=0,S=0,T=0,E=0;for(let k=0;k<u.length;++k)m[k]=p[_++]+(u[k]-h[S++])*d[T++]/Math.sqrt(f[E++]+c),_>=v&&(_=0),S>=x&&(S=0),T>=y&&(T=0),E>=w&&(E=0);return n.makeTensorInfo(i.shape,i.dtype,m)}const Rme={kernelName:Vy,backendName:"cpu",kernelFunc:$me};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dme(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockShape:s,crops:o}=r;_t([i],"batchToSpaceND");const a=s.reduce((y,w)=>y*w),l=Y0(i.shape,s,a),c=Z0(l.length,s.length),u=J0(i.shape,s,a),h=nN(o,s.length),f=rN(u,o,s.length),d=Er({inputs:{x:i},backend:n,attrs:{shape:l}}),p=Oo({inputs:{x:d},backend:n,attrs:{perm:c}}),m=Er({inputs:{x:p},backend:n,attrs:{shape:u}}),v=Ef({inputs:{x:m},backend:n,attrs:{begin:h,size:f}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),v}const Pme={kernelName:Iy,backendName:"cpu",kernelFunc:Dme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ome(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,weights:s}=e,{size:o}=r,a=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,c=xN(a,l,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,c)}const Fme={kernelName:u_,backendName:"cpu",kernelFunc:Ome};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lme(t){const{inputs:e,backend:n}=t,{s0:r,s1:i}=e,s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,a=Qt(Array.from(s),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const Bme={kernelName:h_,backendName:"cpu",kernelFunc:Lme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zme=jn(Np,(t,e)=>{const n=e;return t>n.clipValueMax?n.clipValueMax:t<n.clipValueMin?n.clipValueMin:t}),Vme={kernelName:Np,backendName:"cpu",kernelFunc:zme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ume=t=>{const{x:e}=t.inputs,n=t.backend,r=new Float32Array(_e(e.shape)),i=n.data.get(e.dataId),s=i.complexTensorInfos.real,o=i.complexTensorInfos.imag,a=n.data.get(s.dataId).values,l=n.data.get(o.dataId).values;for(let c=0;c<a.length;c++){const u=a[c],h=l[c];r[c]=Math.hypot(u,h)}return n.makeOutput(r,e.shape,"float32")},Wme={kernelName:Ny,backendName:"cpu",kernelFunc:Ume};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lm(t){const{inputs:e,backend:n}=t,{input:r}=e,i=n.data.get(r.dataId).complexTensorInfos.imag,s=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,s)}const Gme={kernelName:N_,backendName:"cpu",kernelFunc:Lm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bm(t){const{inputs:e,backend:n,attrs:r}=t,{axis:i}=r,s=hn(i,e[0].shape)[0];let o=Gl(e.map(m=>m.shape),s);if(_e(o)===0)return n.makeTensorInfo(o,e[0].dtype,[]);const a=e.filter(m=>_e(m.shape)>0);if(a.length===1)return Hl({inputs:{x:a[0]},backend:n});const l=a.map(m=>m.shape);if(QI(l,s),a[0].dtype==="complex64"){const m=a.map(_=>Tf({inputs:{input:_},backend:n})),v=a.map(_=>Lm({inputs:{input:_},backend:n})),y=Bm({inputs:m,backend:n,attrs:{axis:s}}),w=Bm({inputs:v,backend:n,attrs:{axis:s}}),x=ao({inputs:{real:y,imag:w},backend:n});return m.forEach(_=>n.disposeIntermediateTensorInfo(_)),v.forEach(_=>n.disposeIntermediateTensorInfo(_)),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(w),x}const c=a.map(m=>{const v=_e(m.shape.slice(s));return Er({inputs:{x:m},backend:n,attrs:{shape:[-1,v]}})}),u=c.map(m=>({vals:n.data.get(m.dataId).values,shape:m.shape}));o=Gl(c.map(m=>m.shape),1);const h=c[0].shape[0]===1,f=gV(u,o,e[0].dtype,h),d=Gl(a.map(m=>m.shape),s),p=n.makeTensorInfo(d,e[0].dtype,f);return c.forEach(m=>n.disposeIntermediateTensorInfo(m)),p}const Hme={kernelName:$y,backendName:"cpu",kernelFunc:Bm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aU(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=r;_t([i,s],"conv2d");const h=Lc(l),f=Ai(i.shape,s.shape,o,c,a,u,!1,h),d=f.filterHeight,p=f.filterWidth,m=f.dilationHeight,v=f.dilationWidth,y=f.padInfo.left,w=f.padInfo.top,x=f.dataFormat==="channelsLast",_=new di(f.outShape,i.dtype),S=Rt(i.shape),T=Rt(s.shape),E=S[0],k=x?S[1]:S[2],A=x?S[2]:1,M=x?1:S[1],D=_.strides[0],P=x?_.strides[1]:_.strides[2],N=x?_.strides[2]:1,R=x?1:_.strides[1],F=n.data.get(i.dataId).values,O=n.data.get(s.dataId).values,K=_.values;for(let J=0;J<f.batchSize;++J){const re=J*E,ae=J*D;for(let pe=0;pe<f.outHeight;++pe){const ke=ae+pe*P,Te=pe*f.strideHeight-w;for(let Ne=0;Ne<d;++Ne){const we=Te+Ne*m;if(we<0||we>=f.inHeight)continue;const me=Ne*T[0],He=re+we*k;for(let Fe=0;Fe<f.outWidth;++Fe){const je=ke+Fe*N,Ve=Fe*f.strideWidth-y;for(let Se=0;Se<p;++Se){const nt=Ve+Se*v;if(nt<0||nt>=f.inWidth)continue;const Ct=me+Se*T[1],pt=He+nt*A;let Ht=Ct;for(let Mt=0;Mt<f.inChannels;++Mt){const q=F[pt+Mt*M];for(let Y=0;Y<f.outChannels;++Y)K[je+Y*R]+=q*O[Ht+Y];Ht+=f.outChannels}}}}}}return n.makeTensorInfo(_.shape,_.dtype,K)}const jme={kernelName:Ry,backendName:"cpu",kernelFunc:aU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qme(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=r;_t([i,s],"conv2dBackpropFilter");const h=Lc(l),f=Ai(i.shape,u,o,1,a,c,!1,h),{strideHeight:d,strideWidth:p,filterHeight:m,filterWidth:v}=f,y=f.dataFormat==="channelsLast",w=new di(f.filterShape,"float32"),x=f.padInfo.left,_=f.padInfo.top,S=n.data.get(i.dataId).values,T=n.data.get(s.dataId).values,E=new di(i.shape,i.dtype,S),k=new di(s.shape,s.dtype,T);for(let A=0;A<m;++A){const M=Math.max(0,Math.ceil((_-A)/d)),D=Math.min(f.outHeight,(f.inHeight+_-A)/d);for(let P=0;P<v;++P){const N=Math.max(0,Math.ceil((x-P)/p)),R=Math.min(f.outWidth,(f.inWidth+x-P)/p);for(let F=0;F<f.inChannels;++F)for(let O=0;O<f.outChannels;++O){let K=0;for(let J=0;J<f.batchSize;++J)for(let re=M;re<D;++re){const ae=A+re*d-_;for(let pe=N;pe<R;++pe){const ke=P+pe*p-x;y?K+=E.get(J,ae,ke,F)*k.get(J,re,pe,O):K+=E.get(J,F,ae,ke)*k.get(J,O,re,pe)}}w.set(K,A,P,F,O)}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const Xme={kernelName:d_,backendName:"cpu",kernelFunc:qme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kme(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{inputShape:o,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=r;_t([i,s],"conv2dBackpropInput");const h=Rt(s.shape),f=Rt(i.shape);let d=Lc(c);const p=Ai(o,s.shape,a,1,l,u,!1,d),m=new di(p.inShape,"float32"),v=m.values,y=n.data.get(i.dataId).values,w=n.data.get(s.dataId).values,[x,_,S]=h,{batchSize:T,filterHeight:E,filterWidth:k,inChannels:A,inHeight:M,inWidth:D,outChannels:P,outHeight:N,outWidth:R,strideHeight:F,strideWidth:O}=p;d=p.dataFormat;const K=E-1-p.padInfo.top,J=k-1-p.padInfo.left,re=d==="channelsLast",ae=m.strides[0],pe=re?m.strides[1]:m.strides[2],ke=re?m.strides[2]:1,Te=re?1:m.strides[1],Ne=f[0],we=re?f[1]:f[2],me=re?f[2]:1,He=re?1:f[1];for(let Fe=0;Fe<T;++Fe)for(let je=0;je<A;++je)for(let Ve=0;Ve<M;++Ve){const Se=Ve-K,nt=Math.max(0,Math.ceil(Se/F)),Ct=Math.min(N,(E+Se)/F);for(let pt=0;pt<D;++pt){const Ht=pt-J,Mt=Math.max(0,Math.ceil(Ht/O)),q=Math.min(R,(k+Ht)/O);let Y=0;for(let Re=nt;Re<Ct;++Re){const Et=Re*F-Se;for(let st=Mt;st<q;++st){const ee=st*O-Ht,We=Ne*Fe+we*Re+me*st,ot=x*(E-1-Et)+_*(k-1-ee)+S*je;for(let rt=0;rt<P;++rt){const Ke=y[We+He*rt],lt=w[ot+rt];Y+=Ke*lt}}}const Xe=ae*Fe+pe*Ve+ke*pt+Te*je;v[Xe]=Y}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}const Yme={kernelName:Dy,backendName:"cpu",kernelFunc:Kme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zme(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dilations:l}=r;_t([i,s],"conv3d");const c=Gu(i.shape,s.shape,o,l,a),{filterDepth:u,filterHeight:h,filterWidth:f,dilationDepth:d,dilationHeight:p,dilationWidth:m,padInfo:v}=c,y=v.front,w=v.left,x=v.top,_=new di(c.outShape,i.dtype),S=n.data.get(i.dataId).values,T=n.data.get(s.dataId).values,E=_.values,k=Rt(i.shape),A=Rt(s.shape);for(let M=0;M<c.batchSize;++M){const D=M*k[0],P=M*_.strides[0];for(let N=0;N<c.outDepth;++N){const R=P+N*_.strides[1],F=N*c.strideDepth-y;for(let O=0;O<u;++O){const K=F+O*d;if(K<0||K>=c.inDepth)continue;const J=O*A[0],re=D+K*k[1];for(let ae=0;ae<c.outHeight;++ae){const pe=R+ae*_.strides[2],ke=ae*c.strideHeight-x;for(let Te=0;Te<h;++Te){const Ne=ke+Te*p;if(Ne<0||Ne>=c.inHeight)continue;const we=J+Te*A[1],me=re+Ne*k[2];for(let He=0;He<c.outWidth;++He){const Fe=pe+He*c.outChannels,je=He*c.strideWidth-w;for(let Ve=0;Ve<f;++Ve){const Se=je+Ve*m;if(Se<0||Se>=c.inWidth)continue;const nt=we+Ve*A[2],Ct=me+Se*c.inChannels;let pt=nt;for(let Ht=0;Ht<c.inChannels;++Ht){const Mt=S[Ct+Ht];for(let q=0;q<c.outChannels;++q)E[Fe+q]+=Mt*T[pt+q];pt+=c.outChannels}}}}}}}}return n.makeTensorInfo(_.shape,_.dtype,_.values)}const Jme={kernelName:Py,backendName:"cpu",kernelFunc:Zme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qme(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,pad:a,filterShape:l}=r;_t([i,s],"conv3dBackpropFilterV2");const c=Rt(i.shape),u=Rt(s.shape),h=Gu(i.shape,l,o,1,a),f=h.strideDepth,d=h.strideHeight,p=h.strideWidth,m=h.filterDepth,v=h.filterHeight,y=h.filterWidth,w=new di(h.filterShape,"float32"),x=w.values,[_,S,T,E]=w.strides,k=n.data.get(s.dataId).values,[A,M,D,P]=u,N=n.data.get(i.dataId).values,[R,F,O,K]=c,J=h.padInfo.front,re=h.padInfo.left,ae=h.padInfo.top;for(let pe=0;pe<m;++pe){const ke=Math.max(0,Math.ceil((J-pe)/f)),Te=Math.min(h.outDepth,(h.inDepth+J-pe)/f),Ne=pe*_;for(let we=0;we<v;++we){const me=Math.max(0,Math.ceil((ae-we)/d)),He=Math.min(h.outHeight,(h.inHeight+ae-we)/d),Fe=we*S+Ne;for(let je=0;je<y;++je){const Ve=Math.max(0,Math.ceil((re-je)/p)),Se=Math.min(h.outWidth,(h.inWidth+re-je)/p),nt=je*T+Fe;for(let Ct=0;Ct<h.inChannels;++Ct){const pt=Ct*E+nt;for(let Ht=0;Ht<h.outChannels;++Ht){let Mt=0;for(let q=0;q<h.batchSize;++q){const Y=q*R,Xe=q*A;for(let Re=ke;Re<Te;++Re){const st=(pe+Re*f-J)*F+Y,ee=Re*M+Xe;for(let We=me;We<He;++We){const rt=(we+We*d-ae)*O+st,Ke=We*D+ee;for(let lt=Ve;lt<Se;++lt){const ce=(je+lt*p-re)*K+rt,qe=lt*P+Ke;Mt+=N[ce+Ct]*k[qe+Ht]}}}}x[pt+Ht]=Mt}}}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const ege={kernelName:p_,backendName:"cpu",kernelFunc:Qme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tge(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{pad:o,strides:a,inputShape:l}=r;_t([i],"conv3dBackpropInputV2");const c=Rt(i.shape),u=Rt(s.shape),h=Gu(l,s.shape,a,1,o),f=new di(h.inShape,"float32"),d=f.values,[p,m,v,y]=f.strides,w=n.data.get(i.dataId).values,[x,_,S,T]=c,E=n.data.get(s.dataId).values,[k,A,M,D]=u,{batchSize:P,filterDepth:N,filterHeight:R,filterWidth:F,inChannels:O,inDepth:K,inHeight:J,inWidth:re,outChannels:ae,outDepth:pe,outHeight:ke,outWidth:Te,strideDepth:Ne,strideHeight:we,strideWidth:me}=h,He=N-1-h.padInfo.front,Fe=R-1-h.padInfo.top,je=F-1-h.padInfo.left;for(let Ve=0;Ve<P;++Ve)for(let Se=0;Se<O;++Se)for(let nt=0;nt<K;++nt){const Ct=nt-He,pt=Math.max(0,Math.ceil(Ct/Ne)),Ht=Math.min(pe,(N+Ct)/Ne);for(let Mt=0;Mt<J;++Mt){const q=Mt-Fe,Y=Math.max(0,Math.ceil(q/we)),Xe=Math.min(ke,(R+q)/we);for(let Re=0;Re<re;++Re){const Et=Re-je,st=Math.max(0,Math.ceil(Et/me)),ee=Math.min(Te,(F+Et)/me);let We=0;for(let ot=pt;ot<Ht;++ot){const rt=ot*Ne-Ct;for(let Ke=Y;Ke<Xe;++Ke){const lt=Ke*we-q;for(let it=st;it<ee;++it){const ce=it*me-Et,qe=x*Ve+_*ot+S*Ke+T*it,bt=k*(N-1-rt)+A*(R-1-lt)+M*(F-1-ce)+D*Se;for(let Ot=0;Ot<ae;++Ot){const gt=w[qe+Ot],dn=E[bt+Ot];We+=gt*dn}}}}d[p*Ve+m*nt+v*Mt+y*Re+Se]=We}}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}const nge={kernelName:m_,backendName:"cpu",kernelFunc:tge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rge=jn($p,t=>Math.cos(t)),ige={kernelName:$p,backendName:"cpu",kernelFunc:rge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sge=jn(Rp,t=>Math.cosh(t)),oge={kernelName:Rp,backendName:"cpu",kernelFunc:sge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function age(t){const{inputs:e,backend:n,attrs:r}=t,{image:i,boxes:s,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:c}=r,[u,h,f,d]=i.shape,p=s.shape[0],[m,v]=a,y=mn([p,m,v,d],"float32"),w=n.data.get(s.dataId).values,x=n.data.get(o.dataId).values,_=n.data.get(i.dataId).values,S=Rt(i.shape),T=Rt(y.shape);for(let E=0;E<p;E++){const k=E*4,A=w[k],M=w[k+1],D=w[k+2],P=w[k+3],N=x[E];if(N>=u)continue;const R=m>1?(D-A)*(h-1)/(m-1):0,F=v>1?(P-M)*(f-1)/(v-1):0;for(let O=0;O<m;O++){const K=m>1?A*(h-1)+O*R:.5*(A+D)*(h-1);if(K<0||K>h-1){for(let J=0;J<v;J++)for(let re=0;re<d;re++){const ae=re+J*T[2]+O*T[1]+E*T[0];y.values[ae]=c}continue}if(l==="bilinear"){const J=Math.floor(K),re=Math.ceil(K),ae=K-J;for(let pe=0;pe<v;pe++){const ke=v>1?M*(f-1)+pe*F:.5*(M+P)*(f-1);if(ke<0||ke>f-1){for(let me=0;me<d;me++){const He=me+pe*T[2]+O*T[1]+E*T[0];y.values[He]=c}continue}const Te=Math.floor(ke),Ne=Math.ceil(ke),we=ke-Te;for(let me=0;me<d;me++){let He=me+Te*S[2]+J*S[1]+N*S[0];const Fe=_[He];He=me+Ne*S[2]+J*S[1]+N*S[0];const je=_[He];He=me+Te*S[2]+re*S[1]+N*S[0];const Ve=_[He];He=me+Ne*S[2]+re*S[1]+N*S[0];const Se=_[He],nt=Fe+(je-Fe)*we,Ct=Ve+(Se-Ve)*we;He=me+pe*T[2]+O*T[1]+E*T[0],y.values[He]=nt+(Ct-nt)*ae}}}else for(let J=0;J<v;++J){const re=v>1?M*(f-1)+J*F:.5*(M+P)*(f-1);if(re<0||re>f-1){for(let ke=0;ke<d;ke++){const Te=ke+J*T[2]+O*T[1]+E*T[0];y.values[Te]=c}continue}const ae=Math.round(re),pe=Math.round(K);for(let ke=0;ke<d;ke++){const Te=ke+ae*S[2]+pe*S[1]+N*S[0],Ne=ke+J*T[2]+O*T[1]+E*T[0];y.values[Ne]=_[Te]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}const lge={kernelName:g_,backendName:"cpu",kernelFunc:age};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cge(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,exclusive:o,reverse:a}=r;_t(i,"cumsum");const l=Hr([s],i.shape.length);let c=i;l!=null&&(c=Oo({inputs:{x:i},backend:n,attrs:{perm:l}}));const u=si(1,i.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const h=eo(c.dtype,"int32"),f=Vi(_e(c.shape),h),d=n.data.get(c.dataId).values,p=c.shape[c.shape.length-1],m=a?(y,w)=>y+p-w-1:(y,w)=>y+w;for(let y=0;y<d.length;y+=p)for(let w=0;w<p;w++){const x=m(y,w);if(w===0)f[x]=o?0:d[x];else{const _=m(y,w-1);f[x]=o?d[_]+f[_]:d[x]+f[_]}}const v=n.makeTensorInfo(c.shape,h,f);if(l!=null){const y=$m(l),w=Oo({inputs:{x:v},backend:n,attrs:{perm:y}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(c),w}return v}const uge={kernelName:Oy,backendName:"cpu",kernelFunc:cge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hge(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,weights:s}=e,{size:o,binaryOutput:a}=r;if(i.shape.length===1){const l=n.data.get(i.dataId).values,c=n.data.get(s.dataId).values,u=xN(l,c,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,u)}else if(i.shape.length===2){const l=n.bufferSync(i),c=n.bufferSync(s),u=pV(l,c,o,a);return n.makeTensorInfo(u.shape,s.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const fge={kernelName:v_,backendName:"cpu",kernelFunc:hge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dge(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockSize:s,dataFormat:o}=r;z(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=i.shape[0],l=i.shape[1],c=i.shape[2],u=i.shape[3],h=l*s,f=c*s,d=u/(s*s),p=n.data.get(i.dataId).values,m=new Float32Array(a*h*f*d);let v=0;for(let y=0;y<a;++y)for(let w=0;w<h;++w){const x=Math.floor(w/s),_=w%s;for(let S=0;S<f;++S){const T=Math.floor(S/s),E=S%s,k=(_*s+E)*d;for(let A=0;A<d;++A){const D=A+k+u*(T+c*(x+l*y));m[v++]=p[D]}}}return n.makeTensorInfo([a,h,f,d],i.dtype,m)}const pge={kernelName:y_,backendName:"cpu",kernelFunc:dge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lU(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:c}=r;_t([i,s],"depthwiseConv2DNative");const u=Rt(i.shape),h=Rt(s.shape);let f=l;f==null&&(f=[1,1]),z(Ui(o,f),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${f}'`);const d=Ai(i.shape,s.shape,o,f,a,c,!0),{filterHeight:p,filterWidth:m,dilationHeight:v,dilationWidth:y,padInfo:w}=d,x=w.left,_=w.top,S=d.outChannels/d.inChannels,T=new di(d.outShape,i.dtype),E=n.data.get(i.dataId).values,k=n.data.get(s.dataId).values,A=T.values;for(let M=0;M<d.batchSize;++M){const D=M*u[0],P=M*T.strides[0];for(let N=0;N<d.outHeight;++N){const R=P+N*T.strides[1],F=N*d.strideHeight-_;for(let O=0;O<p;++O){const K=F+O*v;if(K<0||K>=d.inHeight)continue;const J=O*h[0],re=D+K*u[1];for(let ae=0;ae<d.outWidth;++ae){const pe=R+ae*T.strides[2],ke=ae*d.strideWidth-x;for(let Te=0;Te<m;++Te){const Ne=ke+Te*y;if(Ne<0||Ne>=d.inWidth)continue;const we=J+Te*h[1],me=re+Ne*d.inChannels;let He=pe,Fe=we;for(let je=0;je<d.inChannels;++je){const Ve=E[me+je];for(let Se=0;Se<S;++Se)A[He+Se]+=Ve*k[Fe+Se];He+=S,Fe+=S}}}}}}return n.makeTensorInfo(T.shape,T.dtype,T.values)}const mge={kernelName:Fy,backendName:"cpu",kernelFunc:lU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gge(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=r;_t([i,s],"depthwiseConv2dNativeBackpropFilter");const h=Ai(i.shape,u,o,a,l,c,!0),{strideHeight:f,strideWidth:d,filterHeight:p,filterWidth:m}=h,v=new di(h.filterShape,"float32"),y=h.padInfo.left,w=h.padInfo.top,x=h.outChannels/h.inChannels,_=n.data.get(i.dataId).values,S=new di(i.shape,i.dtype,_),T=n.data.get(s.dataId).values,E=new di(s.shape,s.dtype,T);for(let k=0;k<p;++k){const A=Math.max(0,Math.ceil((w-k)/f)),M=Math.min(h.outHeight,(h.inHeight+w-k)/f);for(let D=0;D<m;++D){const P=Math.max(0,Math.ceil((y-D)/d)),N=Math.min(h.outWidth,(h.inWidth+y-D)/d);for(let R=0;R<h.outChannels;++R){const F=Math.trunc(R/x),O=R%x;let K=0;for(let J=0;J<h.batchSize;++J)for(let re=A;re<M;++re){const ae=k+re*f-w;for(let pe=P;pe<N;++pe){const ke=D+pe*d-y;K+=S.get(J,ae,ke,F)*E.get(J,re,pe,R)}}v.set(K,k,D,F,O)}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}const vge={kernelName:b_,backendName:"cpu",kernelFunc:gge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yge(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=r;_t([i,s],"depthwiseConv2DNativeBackpropInput");const h=Rt(i.shape),f=Rt(s.shape),d=Ai(u,s.shape,o,a,l,c,!0),p=new di(d.inShape,"float32"),m=p.values,[v,y,w]=p.strides,x=n.data.get(i.dataId).values,[_,S,T]=h,E=n.data.get(s.dataId).values,[k,A,M]=f,{batchSize:D,filterHeight:P,filterWidth:N,inChannels:R,inHeight:F,inWidth:O,outChannels:K,outHeight:J,outWidth:re,strideHeight:ae,strideWidth:pe}=d,ke=P-1-d.padInfo.top,Te=N-1-d.padInfo.left,Ne=K/R;for(let we=0;we<D;++we)for(let me=0;me<R;++me)for(let He=0;He<F;++He){const Fe=He-ke,je=Math.max(0,Math.ceil(Fe/ae)),Ve=Math.min(J,(P+Fe)/ae);for(let Se=0;Se<O;++Se){const nt=Se-Te,Ct=Math.max(0,Math.ceil(nt/pe)),pt=Math.min(re,(N+nt)/pe);let Ht=0;for(let Mt=je;Mt<Ve;++Mt){const q=Mt*ae-Fe;for(let Y=Ct;Y<pt;++Y){const Xe=Y*pe-nt,Re=_*we+S*Mt+T*Y,Et=k*(P-1-q)+A*(N-1-Xe)+M*me;for(let st=0;st<Ne;++st){const ee=me*Ne+st,We=x[Re+ee],ot=E[Et+st];Ht+=We*ot}}}m[v*we+y*He+w*Se+me]=Ht}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}const bge={kernelName:w_,backendName:"cpu",kernelFunc:yge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wge(t){const{inputs:e,backend:n}=t,{x:r}=e,i=_e(r.shape),s=n.data.get(r.dataId).values,o=mn([i,i],r.dtype),a=o.values;for(let c=0;c<s.length;c++)a[c*i+c]=s[c];const l=[...r.shape,...r.shape];return n.makeTensorInfo(l,o.dtype,o.values)}const xge={kernelName:x_,backendName:"cpu",kernelFunc:wge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ge={kernelName:Ly,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,filter:i}=t,{strides:s,pad:o,dilations:a}=n,l=e,c=l.data.get(r.dataId).values,u=r.shape.length,h=l.data.get(i.dataId).values,f=i.shape.length,{batchSize:d,inHeight:p,inWidth:m,inChannels:v,outHeight:y,outWidth:w,padInfo:x,strideHeight:_,strideWidth:S,filterHeight:T,filterWidth:E,dilationHeight:k,dilationWidth:A,outShape:M}=F0(r.shape,i.shape,s,o,"NHWC",a),D=_e(M),P=M.length,N=hs(r.dtype,D);for(let F=0;F<d;++F)for(let O=0;O<y;++O){const K=O*_-x.top;for(let J=0;J<w;++J){const re=J*S-x.left;for(let ae=0;ae<v;++ae){let pe=Number.MIN_SAFE_INTEGER;for(let Te=0;Te<T;++Te){const Ne=K+Te*k;if(Ne>=0&&Ne<p)for(let we=0;we<E;++we){const me=re+we*A;if(me>=0&&me<m){const He=qa([F,Ne,me,ae],u,Rt(r.shape)),Fe=qa([Te,we,ae],f,Rt(i.shape)),je=c[He]+h[Fe];je>pe&&(pe=je)}}}const ke=qa([F,O,J,ae],P,Rt(M));N[ke]=pe}}}return{dataId:l.write(Bu(N,r.dtype),M,r.dtype),shape:M,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sge={kernelName:S_,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,filter:i,dy:s}=t,{strides:o,pad:a,dilations:l}=n,c=e,u=Eo(r.shape,c.data.get(r.dataId).values),h=Eo(i.shape,c.data.get(i.dataId).values),{batchSize:f,inHeight:d,inWidth:p,inChannels:m,outHeight:v,outWidth:y,padInfo:w,strideHeight:x,strideWidth:_,filterHeight:S,filterWidth:T,dilationHeight:E,dilationWidth:k,outShape:A}=F0(r.shape,i.shape,o,a,"NHWC",l);z(s.rank===A.length,()=>`Error in ${S_}, dy must have the same rank as output ${A.length}, but got ${s.rank}`);const M=Eo(A,c.data.get(s.dataId).values),D=wM(i.shape,i.dtype);for(let N=0;N<f;++N)for(let R=0;R<v;++R){const F=R*x-w.top;for(let O=0;O<y;++O){const K=O*_-w.left;for(let J=0;J<m;++J){let re=Number.MIN_SAFE_INTEGER,ae=0,pe=0;for(let ke=0;ke<S;++ke){const Te=F+ke*E;if(Te>=0&&Te<d)for(let Ne=0;Ne<T;++Ne){const we=K+Ne*k;if(we>=0&&we<p){const me=u[N][Te][we][J]+h[ke][Ne][J];me>re&&(re=me,ae=ke,pe=Ne)}}}D[ae][pe][J]+=M[N][R][O][J]}}}return{dataId:c.write(Bu(D,r.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cge={kernelName:__,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,filter:i,dy:s}=t,{strides:o,pad:a,dilations:l}=n,c=e,u=Eo(r.shape,c.data.get(r.dataId).values),h=Eo(i.shape,c.data.get(i.dataId).values),{batchSize:f,inHeight:d,inWidth:p,inChannels:m,outHeight:v,outWidth:y,padInfo:w,strideHeight:x,strideWidth:_,filterHeight:S,filterWidth:T,dilationHeight:E,dilationWidth:k,outShape:A}=F0(r.shape,i.shape,o,a,"NHWC",l);z(s.rank===A.length,()=>`Error in ${__}, dy must have the same rank as output ${A.length}, but got ${s.rank}`);const M=Eo(A,c.data.get(s.dataId).values),D=wM(r.shape,r.dtype);for(let N=0;N<f;++N)for(let R=0;R<v;++R){const F=R*x-w.top;for(let O=0;O<y;++O){const K=O*_-w.left;for(let J=0;J<m;++J){let re=Number.MIN_SAFE_INTEGER,ae=F<0?0:F,pe=K<0?0:K;for(let ke=0;ke<S;++ke){const Te=F+ke*E;if(Te>=0&&Te<d)for(let Ne=0;Ne<T;++Ne){const we=K+Ne*k;if(we>=0&&we<p){const me=u[N][Te][we][J]+h[ke][Ne][J];me>re&&(re=me,ae=Te,pe=we)}}}D[N][ae][pe][J]+=M[N][R][O][J]}}}return{dataId:c.write(Bu(D,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tb(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;_t(i,"sum");let a;i.dtype==="bool"?a=Zu({inputs:{x:i},backend:n,attrs:{dtype:"int32"}}):a=Hl({inputs:{x:i},backend:n});const l=a.shape.length,c=hn(s,a.shape),u=Hr(c,l);let h=c,f=a;u!=null&&(f=Oo({inputs:{x:a},backend:n,attrs:{perm:u}}),h=si(h.length,l)),Wi("sum",h,f.shape.length);const[d,p]=Mi(f.shape,h),m=eo(f.dtype,"int32");let v=hC(n,d,m);const y=_e(p),w=n.data.get(v.dataId).values,x=n.data.get(f.dataId).values;for(let _=0;_<w.length;++_){const S=_*y;let T=0;for(let E=0;E<y;++E)T+=x[S+E];w[_]=T}if(o){const _=Gr(v.shape,c),S=v;v=Er({inputs:{x:v},backend:n,attrs:{shape:_}}),n.disposeIntermediateTensorInfo(S)}return n.disposeIntermediateTensorInfo(a),u!=null&&n.disposeIntermediateTensorInfo(f),v}const Tge={kernelName:g0,backendName:"cpu",kernelFunc:tb};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ege(t){const{inputs:e,backend:n,attrs:r}=t,{equation:i}=r,s=e,{allDims:o,summedDims:a,idDims:l}=fN(i,s.length);pN(o.length,l,s);const{path:c,steps:u}=mN(a,l),h=u.length;let f=null,d=o.length;const p=[];for(let m=0;m<h;++m){for(const v of u[m]){const{permutationIndices:y,expandDims:w}=dN(d,l[v]);let x;gN(y)?x=s[v]:(x=Oo({inputs:{x:s[v]},backend:n,attrs:{perm:y}}),p.push(x));const _=x.shape.slice();for(let S=0;S<w.length;++S)_.splice(w[S],0,1);wn(x.shape,_)||(x=Er({inputs:{x},backend:n,attrs:{shape:_}}),p.push(x)),f===null?f=x:(f=fC({inputs:{a:x,b:f},backend:n}),p.push(f))}m<h-1&&(c[m]>=0&&(f=tb({inputs:{x:f},backend:n,attrs:{axis:c[m]-(o.length-d),keepDims:!1}}),p.push(f)),d--)}for(const m of p)m!==f&&n.disposeIntermediateTensorInfo(m);return f}const kge={kernelName:C_,backendName:"cpu",kernelFunc:Ege};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Age(t){const{inputs:e,backend:n}=t,{dy:r,y:i}=e;_t([r,i],"eluGrad");const s=new Float32Array(_e(i.shape)),o=n.data.get(i.dataId).values,a=n.data.get(r.dataId).values;for(let l=0;l<o.length;++l){const c=o[l];c>=1?s[l]=a[l]:s[l]=a[l]*(c+1)}return n.makeTensorInfo(i.shape,"float32",s)}const Mge={kernelName:T_,backendName:"cpu",kernelFunc:Age};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ige=iN,Nge=sN,$ge=oN,Rge=aN,Dge=lN,Pge=cN,Oge=jn(Op,t=>{const e=Math.sign(t),n=Math.abs(t),r=1/(1+Ige*n);return e*(1-((((Pge*r+Dge)*r+Rge)*r+$ge)*r+Nge)*r*Math.exp(-n*n))}),Fge={kernelName:Op,backendName:"cpu",kernelFunc:Oge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dC(t){const{inputs:e,backend:n,attrs:r}=t,{input:i}=e,{dim:s}=r,o=i.shape.length,a=i.shape.slice();let l=s;return s<0&&(z(-(o+1)<=s,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+s+1),a.splice(l,0,1),Er({inputs:{x:i},backend:n,attrs:{shape:a}})}const Lge={kernelName:zy,backendName:"cpu",kernelFunc:dC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bge=oi((t,e)=>t/e),AN=Ii(Dp,Bge),MN={kernelName:Dp,backendName:"cpu",kernelFunc:AN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cU(t,e,n){const r=t.shape,i=r[0],s=r[1],o=n.data.get(t.dataId),a=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,c=[i,s],u=_e(c),h=fi("float32",u),f=fi("float32",u);for(let v=0;v<i;v++){const y=Ef({inputs:{x:a},backend:n,attrs:{begin:[v,0],size:[1,s]}}),w=Ef({inputs:{x:l},backend:n,attrs:{begin:[v,0],size:[1,s]}}),x=ao({inputs:{real:y,imag:w},backend:n}),{real:_,imag:S}=zge(x,e,n),T=Uc(_,S);for(let E=0;E<s;E++){const k=uN(T,E);h[v*s+E]=k.real,f[v*s+E]=k.imag}n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(w),n.disposeIntermediateTensorInfo(x)}const d=n.makeTensorInfo(c,"float32",h),p=n.makeTensorInfo(c,"float32",f),m=ao({inputs:{real:d,imag:p},backend:n});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),m}function zge(t,e,n){const r=_e(t.shape),i=n.data.get(t.dataId),s=n.data.get(i.complexTensorInfos.real.dataId).values,o=n.data.get(i.complexTensorInfos.imag.dataId).values;if(Vge(r)){const a=IN(s,o,r,e,n),l=[t.shape[0],t.shape[1]];if(e){const c=n.makeTensorInfo(l,"float32",a.real),u=n.makeTensorInfo(l,"float32",a.imag),h=n.makeTensorInfo([],"float32",Dc(r,"float32")),f=Hl({inputs:{x:h},backend:n}),d=MN.kernelFunc({inputs:{a:c,b:h},backend:n}),p=MN.kernelFunc({inputs:{a:u,b:f},backend:n}),m=n.data.get(d.dataId).values,v=n.data.get(p.dataId).values;return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),{real:m,imag:v}}return a}else{const a=Uc(s,o),l=Uge(a,r,e);return U4(l)}}function Vge(t){return(t&t-1)==0}function IN(t,e,n,r,i){if(n===1)return{real:t,imag:e};const s=Uc(t,e),o=n/2,a=W4(s),l=a.real,c=a.imag,u=[l.length],h=i.makeTensorInfo(u,"float32",l),f=i.makeTensorInfo(u,"float32",c),d=ao({inputs:{real:h,imag:f},backend:i}),p=G4(s),m=p.real,v=p.imag,y=[m.length],w=i.makeTensorInfo(y,"float32",m),x=i.makeTensorInfo(y,"float32",v),_=ao({inputs:{real:w,imag:x},backend:i}),S=IN(l,c,o,r,i),T=S.real,E=S.imag,k=[T.length],A=i.makeTensorInfo(k,"float32",T),M=i.makeTensorInfo(k,"float32",E),D=ao({inputs:{real:A,imag:M},backend:i}),P=IN(m,v,o,r,i),N=P.real,R=P.imag,F=[N.length],O=i.makeTensorInfo(F,"float32",N),K=i.makeTensorInfo(F,"float32",R),J=ao({inputs:{real:O,imag:K},backend:i}),re=j4(n,r),ae=[re.real.length],pe=i.makeTensorInfo(ae,"float32",re.real),ke=i.makeTensorInfo(ae,"float32",re.imag),Te=ao({inputs:{real:pe,imag:ke},backend:i}),Ne=fC({inputs:{a:Te,b:J},backend:i}),we=Q0({inputs:{a:D,b:Ne},backend:i}),me=TN({inputs:{a:D,b:Ne},backend:i}),He=Tf({inputs:{input:we},backend:i}),Fe=Tf({inputs:{input:me},backend:i}),je=Lm({inputs:{input:we},backend:i}),Ve=Lm({inputs:{input:me},backend:i}),Se=Bm({inputs:[He,Fe],backend:i,attrs:{axis:0}}),nt=Bm({inputs:[je,Ve],backend:i,attrs:{axis:0}}),Ct=i.data.get(Se.dataId).values,pt=i.data.get(nt.dataId).values;return i.disposeIntermediateTensorInfo(h),i.disposeIntermediateTensorInfo(f),i.disposeIntermediateTensorInfo(d),i.disposeIntermediateTensorInfo(w),i.disposeIntermediateTensorInfo(x),i.disposeIntermediateTensorInfo(_),i.disposeIntermediateTensorInfo(A),i.disposeIntermediateTensorInfo(M),i.disposeIntermediateTensorInfo(D),i.disposeIntermediateTensorInfo(O),i.disposeIntermediateTensorInfo(K),i.disposeIntermediateTensorInfo(J),i.disposeIntermediateTensorInfo(pe),i.disposeIntermediateTensorInfo(ke),i.disposeIntermediateTensorInfo(Te),i.disposeIntermediateTensorInfo(Ne),i.disposeIntermediateTensorInfo(we),i.disposeIntermediateTensorInfo(me),i.disposeIntermediateTensorInfo(He),i.disposeIntermediateTensorInfo(je),i.disposeIntermediateTensorInfo(Fe),i.disposeIntermediateTensorInfo(Ve),i.disposeIntermediateTensorInfo(Se),i.disposeIntermediateTensorInfo(nt),{real:Ct,imag:pt}}function Uge(t,e,n){const r=new Float32Array(e*2);for(let i=0;i<e;i++){let s=0,o=0;for(let a=0;a<e;a++){const l=q4(i*a,e,n),c=uN(t,a);s+=c.real*l.real-c.imag*l.imag,o+=c.real*l.imag+c.imag*l.real}n&&(s/=e,o/=e),H4(r,s,o,i)}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wge(t){const{inputs:e,backend:n}=t,{input:r}=e,i=_e(r.shape),s=r.shape[r.shape.length-1],o=i/s,a=Er({inputs:{x:r},backend:n,attrs:{shape:[o,s]}}),l=cU(a,!1,n),c=Er({inputs:{x:l},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),c}const Gge={kernelName:E_,backendName:"cpu",kernelFunc:Wge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NN(t){const{backend:e,attrs:n}=t,{shape:r,value:i,dtype:s}=n,o=s||bp(i),a=hs(o,_e(r));return jge(a,i,o),e.makeTensorInfo(r,o,a)}const Hge={kernelName:k_,backendName:"cpu",kernelFunc:NN};function jge(t,e,n){t.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qge={kernelName:A_,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:r}=t,i=n,s=fi(r.dtype,_e(r.shape)),[o,a,l,c]=r.shape,u=i.data.get(r.dataId).values;for(let f=0;f<o;f++){const d=f*l*a*c;for(let p=0;p<a;p++){const m=p*(l*c);for(let v=0;v<l;v++){const y=v*c;for(let w=0;w<c;w++){const x=Math.round(l-v-1),_=d+m+y+w;let S=u[_];if(x>=0&&x<l){const T=x*c,E=d+m+T+w;S=u[E]}s[_]=S}}}}return{dataId:i.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xge=oi((t,e)=>Math.floor(t/e)),Kge=Ii(zp,Xge,null,"int32"),Yge={kernelName:zp,backendName:"cpu",kernelFunc:Kge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zge(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:f,activation:d,leakyreluAlpha:p}=r;let m=aU({inputs:{x:i,filter:s},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:f}});if(o){const v=m;m=Q0({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(v)}if(d){const v=m;m=EN(n,m,d,a,p),n.disposeIntermediateTensorInfo(v)}return m}const Jge={kernelName:T0,backendName:"cpu",kernelFunc:Zge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qge(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:f,activation:d,leakyreluAlpha:p}=r;let m=lU({inputs:{x:i,filter:s},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:f}});if(o){const v=m;m=Q0({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(v)}if(d){const v=m;m=EN(n,m,d,a,p),n.disposeIntermediateTensorInfo(v)}return m}const eve={kernelName:E0,backendName:"cpu",kernelFunc:Qge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tve(t){const{inputs:e,backend:n}=t,{params:r,indices:i}=e,s=_e(r.shape),o=i.shape,a=o[o.length-1],[l,c,u,h]=xS(r,i);if(c===0)return n.makeTensorInfo(l,r.dtype,[]);const f=n.data.get(i.dataId).values,d=n.bufferSync(r),p=SV(f,d,r.dtype,c,a,u,h,r.shape,s);return n.makeTensorInfo(l,r.dtype,p.values)}const nve={kernelName:M_,backendName:"cpu",kernelFunc:tve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rve(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,indices:s}=e,{axis:o,batchDims:a}=r;_t([i,s],"gatherV2");const l=hn(o,i.shape)[0],c=n.data.get(s.dataId).values,u=i.shape[l];for(let _=0;_<c.length;++_){const S=c[_];z(S<=u-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${u-1}]`)}let h=a;a==null&&(h=0);const f=_e(s.shape),d=bN(i,s,l,h),p=Er({inputs:{x:i},backend:n,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),m=Er({inputs:{x:s},backend:n,attrs:{shape:[d.batchSize,f/d.batchSize]}}),v=[d.batchSize,d.outerSize,f/d.batchSize,d.sliceSize],y=n.bufferSync(m),w=n.bufferSync(p),x=CV(w,y,v);return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.makeTensorInfo(d.outputShape,x.dtype,x.values)}const ive={kernelName:Uy,backendName:"cpu",kernelFunc:rve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sve(t){const{inputs:e,backend:n}=t,{input:r}=e,i=_e(r.shape),s=r.shape[r.shape.length-1],o=i/s,a=Er({inputs:{x:r},backend:n,attrs:{shape:[o,s]}}),l=cU(a,!0,n),c=Er({inputs:{x:l},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),c}const ove={kernelName:I_,backendName:"cpu",kernelFunc:sve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ave=jn(Wp,t=>Number.isFinite(t)?1:0,"bool"),lve={kernelName:Wp,backendName:"cpu",kernelFunc:ave};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cve=jn(Gp,t=>Math.abs(t)===1/0?1:0,"bool"),uve={kernelName:Gp,backendName:"cpu",kernelFunc:cve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hve=jn(Hp,t=>Number.isNaN(t)?1:0,"bool"),fve={kernelName:Hp,backendName:"cpu",kernelFunc:hve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dve(t){const{backend:e,attrs:n}=t,{start:r,stop:i,num:s}=n,o=MV(r,i,s);return e.makeTensorInfo([o.length],"float32",o)}const pve={kernelName:$_,backendName:"cpu",kernelFunc:dve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mve=jn(qp,t=>Math.log1p(t)),gve={kernelName:qp,backendName:"cpu",kernelFunc:mve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vve=oi((t,e)=>t&&e),yve=Ii(qy,vve,null,"bool"),bve={kernelName:qy,backendName:"cpu",kernelFunc:yve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wve=jn(Xy,t=>t?0:1,"bool"),xve={kernelName:Xy,backendName:"cpu",kernelFunc:wve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ve=oi((t,e)=>t||e),Sve=Ii(Ky,_ve,null,"bool"),Cve={kernelName:Ky,backendName:"cpu",kernelFunc:Sve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tve(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{depthRadius:s,bias:o,alpha:a,beta:l}=r;_t(i,"LRN");const c=i.shape[3],u=c-1,h=n.data.get(i.dataId).values,f=_e(i.shape),d=new Float32Array(f);function p(m){const v=m%c;let y=m-v+Math.max(0,v-s);const w=m-v+Math.min(v+s,u);let x=0;for(;y<=w;y++){const _=h[y];x+=_*_}return x}for(let m=0;m<f;m++){const v=p(m),y=h[m]*Math.pow(o+a*v,-l);d[m]=y}return n.makeTensorInfo(i.shape,i.dtype,d)}const Eve={kernelName:Yy,backendName:"cpu",kernelFunc:Tve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kve(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,y:s,dy:o}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=r;_t(o,"LRNGrad");const h=_e(o.shape),f=o.shape[3],d=n.data.get(o.dataId).values,p=n.data.get(i.dataId).values,m=n.data.get(s.dataId).values,v=new Float32Array(h),y=h;for(let w=0;w<y;w++){const x=w%f,_=w-x+Math.max(0,x-a),S=w-x+Math.min(f,x+a+1);let T=0;for(let E=_;E<S;E++)T+=Math.pow(p[E],2);T=c*T+l;for(let E=_;E<S;E++){let k=-2*c*u*p[E]*m[w]/T;w===E&&(k+=Math.pow(T,-u)),k*=d[w],v[E]+=k}}return n.makeTensorInfo(o.shape,i.dtype,v)}const Ave={kernelName:R_,backendName:"cpu",kernelFunc:kve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uU(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{reductionIndices:s,keepDims:o}=r,a=n;let l=i.shape;const c=l.length,u=hn(s,l);let h=u;const f=Hr(h,c);let d=a.data.get(i.dataId).values;if(f!=null){const _=new Array(c);for(let S=0;S<_.length;S++)_[S]=l[f[S]];d=SN(d,l,i.dtype,f,_),h=si(h.length,c),l=_}_t(i,"max"),Wi("max",h,c);const[p,m]=Mi(l,h),v=_e(m),y=NV(d,v,p,i.dtype),w=a.write(y,p,i.dtype);let x=p;return o&&(x=Gr(p,u)),{dataId:w,shape:x,dtype:i.dtype}}const Mve={kernelName:Zy,backendName:"cpu",kernelFunc:uU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ive(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;_t(i,"maxPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:l}=r,c=1;z(Ui(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const u=ca(i.shape,s,o,c,a,l);let h;if(u.filterWidth===1&&u.filterHeight===1&&wn(u.inShape,u.outShape))h=Hl({inputs:{x:i},backend:n});else{const f=n.data.get(i.dataId).values,d=Rt(i.shape),p=kN(f,i.shape,i.dtype,d,u,"max");h=n.makeTensorInfo(u.outShape,i.dtype,p.values)}return h}const Nve={kernelName:Jy,backendName:"cpu",kernelFunc:Ive};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ve(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{filterSize:s,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=r;_t(i,"maxPool3d");const u=Fc(i.shape,s,o,1,a,l,c),h=n.data.get(i.dataId).values,f=oU(h,i.shape,i.dtype,Rt(i.shape),u,"max");return n.makeTensorInfo(f.shape,"float32",f.values)}const Rve={kernelName:Qy,backendName:"cpu",kernelFunc:$ve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dve(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:c}=r;_t([i,s],"maxPool3DGrad");const u=Fc(s.shape,o,a,1,l,c),h=n.bufferSync(s),f=Sme(h,u),d=u.strideDepth,p=u.strideHeight,m=u.strideWidth,v=u.dilationDepth,y=u.dilationHeight,w=u.dilationWidth,x=u.effectiveFilterDepth,_=u.effectiveFilterHeight,S=u.effectiveFilterWidth,T=x-1-u.padInfo.front,E=S-1-u.padInfo.left,k=_-1-u.padInfo.top,A=mn(s.shape,"float32"),M=n.bufferSync(i);for(let D=0;D<u.batchSize;++D)for(let P=0;P<u.inChannels;++P)for(let N=0;N<u.inDepth;++N)for(let R=0;R<u.inHeight;++R)for(let F=0;F<u.inWidth;++F){const O=N-T,K=R-k,J=F-E;let re=0;for(let ae=0;ae<x;ae+=v){const pe=(O+ae)/d;if(!(pe<0||pe>=u.outDepth||Math.floor(pe)!==pe))for(let ke=0;ke<_;ke+=y){const Te=(K+ke)/p;if(!(Te<0||Te>=u.outHeight||Math.floor(Te)!==Te))for(let Ne=0;Ne<S;Ne+=w){const we=(J+Ne)/m;if(we<0||we>=u.outWidth||Math.floor(we)!==we)continue;const me=x*_*S-1-f.get(D,pe,Te,we,P),He=ae*_*S+ke*S+Ne,Fe=me===He?1:0;if(Fe===0)continue;re+=M.get(D,pe,Te,we,P)*Fe}}}A.set(re,D,N,R,F,P)}return n.makeTensorInfo(A.shape,A.dtype,A.values)}const Pve={kernelName:P_,backendName:"cpu",kernelFunc:Dve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ove(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s,output:o}=e,a=s;_t([s,o],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:h}=r,f=ca(a.shape,l,c,1,u,h),d=n.data.get(a.dataId).values,p=mn(f.outShape,a.dtype,sU(d,a.shape,a.dtype,f).values),m=f.strideHeight,v=f.strideWidth,y=f.dilationHeight,w=f.dilationWidth,x=f.effectiveFilterHeight,_=f.effectiveFilterWidth,S=_-1-f.padInfo.left,T=x-1-f.padInfo.top,E=mn(a.shape,"float32"),k=n.data.get(i.dataId).values,A=mn(i.shape,"float32",k);for(let M=0;M<f.batchSize;++M)for(let D=0;D<f.inChannels;++D)for(let P=0;P<f.inHeight;++P)for(let N=0;N<f.inWidth;++N){const R=P-T,F=N-S;let O=0;for(let K=0;K<x;K+=y){const J=(R+K)/m;if(!(J<0||J>=f.outHeight||Math.floor(J)!==J))for(let re=0;re<_;re+=w){const ae=(F+re)/v;if(ae<0||ae>=f.outWidth||Math.floor(ae)!==ae)continue;const pe=x*_-1-p.get(M,J,ae,D),ke=K*_+re,Te=pe===ke?1:0;if(Te===0)continue;O+=A.get(M,J,ae,D)*Te}}E.set(O,M,P,N,D)}return n.makeTensorInfo(E.shape,E.dtype,E.values)}const Fve={kernelName:D_,backendName:"cpu",kernelFunc:Ove};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lve(t,e,n,r,i){const s=Rt(e),o=kN(t,e,n,s,i,"max"),a=sU(t,e,n,i,!0,r);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bve={kernelName:O_,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{filterSize:i,strides:s,pad:o,includeBatchInIndex:a}=e,l=n;_t(r,"MaxPoolWithArgmax");const c=l.data.get(r.dataId).values,u=ca(r.shape,i,s,[1,1],o),[h,f]=Lve(c,r.shape,r.dtype,a,u),d=l.write(h,u.outShape,r.dtype),p=l.write(f,u.outShape,r.dtype);return[{dataId:d,shape:u.outShape,dtype:r.dtype},{dataId:p,shape:u.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zve(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r,a=hn(s,i.shape),c=Mi(i.shape,a)[1],u=_e(c),h=[],f=n.makeTensorInfo([],"float32",new Float32Array([u]));h.push(f);const d=Zu({inputs:{x:i},backend:n,attrs:{dtype:"float32"}});h.push(d);const p=AN({inputs:{a:d,b:f},backend:n});h.push(p);const m=tb({inputs:{x:p},backend:n,attrs:{axis:s,keepDims:o}});return h.forEach(v=>n.disposeIntermediateTensorInfo(v)),m}const Vve={kernelName:e0,backendName:"cpu",kernelFunc:zve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uve(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;_t(i,"min");const a=hn(s,i.shape);let l=a;const c=Hr(l,i.shape.length);let u=i;c!=null&&(u=Oo({inputs:{x:i},backend:n,attrs:{perm:c}}),l=si(l.length,i.shape.length)),Wi("min",l,u.shape.length);const[h,f]=Mi(u.shape,l),d=_e(f),p=Vi(_e(h),u.dtype),m=n.data.get(u.dataId).values;for(let y=0;y<p.length;++y){const w=y*d;let x=m[w];for(let _=0;_<d;++_){const S=m[w+_];(Number.isNaN(S)||S<x)&&(x=S)}p[y]=x}c!=null&&n.disposeIntermediateTensorInfo(u);const v=n.makeTensorInfo(h,u.dtype,p);if(o){const y=Gr(h,a),w=Er({inputs:{x:v},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(v),w}return v}const Wve={kernelName:t0,backendName:"cpu",kernelFunc:Uve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gve(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{paddings:s,mode:o}=r;_t(i,"mirrorPad");const a=s.map((x,_)=>x[0]+i.shape[_]+x[1]),l=s.map(x=>x[0]),c=s.map((x,_)=>x[0]+i.shape[_]),u=o==="reflect"?0:1,h=n.data.get(i.dataId).values,f=i.shape.length,d=Rt(i.shape),p=_e(a),m=a.length,v=Rt(a),y=fi(i.dtype,p);for(let x=0;x<p;x++){let _=wp(x,m,v);for(let T=0;T<m;T++)_[T]<l[T]?_[T]=l[T]*2-_[T]-u:_[T]>=c[T]&&(_[T]=(c[T]-1)*2-_[T]+u);_=_.map((T,E)=>T-l[E]);const S=qa(_,f,d);y[x]=h[S]}return{dataId:n.write(y,a,i.dtype),shape:a,dtype:i.dtype}}const Hve={kernelName:n0,backendName:"cpu",kernelFunc:Gve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jve=oi((t,e)=>{const n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e}),qve=Ii(Yp,jve),Xve={kernelName:Yp,backendName:"cpu",kernelFunc:qve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hU(t){const{inputs:e,backend:n,attrs:r}=t,{logits:i}=e,{dim:s}=r,o=i.shape.length;let a=s;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const l=hn([a],i.shape),c=uU({inputs:{x:i},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),u=Gr(c.shape,l),h=Er({inputs:{x:c},backend:n,attrs:{shape:u}}),f=TN({inputs:{a:i,b:h},backend:n}),d=wV({inputs:{x:f},backend:n}),p=tb({inputs:{x:d},backend:n,attrs:{axis:l,keepDims:!1}}),m=Er({inputs:{x:p},backend:n,attrs:{shape:u}}),v=AN({inputs:{a:d,b:m},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),v}const Kve={kernelName:b0,backendName:"cpu",kernelFunc:hU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yve(t){const{inputs:e,backend:n,attrs:r}=t,{logits:i}=e,{numSamples:s,seed:o,normalized:a}=r;_t(i,"multinomial");const l=a?i:hU({inputs:{logits:i},backend:n,attrs:{dim:-1}}),c=l.shape[0],u=l.shape[1],h=n.data.get(l.dataId).values,f=[c,s],d=Vi(_e(f),"int32");for(let p=0;p<c;++p){const m=p*u,v=new Float32Array(u-1);v[0]=h[m];for(let x=1;x<v.length;++x)v[x]=v[x-1]+h[m+x];const y=BS.alea(o.toString()),w=p*s;for(let x=0;x<s;++x){const _=y();d[w+x]=v.length;for(let S=0;S<v.length;S++)if(_<v[S]){d[w+x]=S;break}}}return a||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(f,"int32",d)}const Zve={kernelName:F_,backendName:"cpu",kernelFunc:Yve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jve=ZS;function Qve(t){const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=r;_t(i,"NonMaxSuppression");const c=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,{selectedIndices:h}=Jve(c,u,o,a,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}const eye={kernelName:L_,backendName:"cpu",kernelFunc:Qve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tye=JS;function nye(t){const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r;_t(i,"NonMaxSuppressionPadded");const u=n.data.get(i.dataId).values,h=n.data.get(s.dataId).values,{selectedIndices:f,validOutputs:d}=tye(u,h,o,a,l,c);return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([d]))]}const rye={kernelName:B_,backendName:"cpu",kernelFunc:nye};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iye=QS;function sye(t){const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r;_t(i,"NonMaxSuppressionWithScore");const u=n.data.get(i.dataId).values,h=n.data.get(s.dataId).values,f=o,d=a,p=l,m=c,{selectedIndices:v,selectedScores:y}=iye(u,h,f,d,p,m);return[n.makeTensorInfo([v.length],"int32",new Int32Array(v)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const oye={kernelName:z_,backendName:"cpu",kernelFunc:sye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aye(t){const{inputs:e,backend:n,attrs:r}=t,{indices:i}=e,{depth:s,onValue:o,offValue:a}=r;_t(i,"oneHot");const l=_e(i.shape),c=new Float32Array(l*s);c.fill(a);const u=n.data.get(i.dataId).values;for(let h=0;h<l;++h)u[h]>=0&&u[h]<s&&(c[h*s+u[h]]=o);return n.makeTensorInfo([...i.shape,s],"int32",c)}const lye={kernelName:o0,backendName:"cpu",kernelFunc:aye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pC(t){const{inputs:e,backend:n}=t,{x:r}=e;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){const i=Tf({inputs:{input:r},backend:n}),s=pC({inputs:{x:i},backend:n}),o=Lm({inputs:{input:r},backend:n}),a=pC({inputs:{x:o},backend:n}),l=ao({inputs:{real:s,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return NN({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const cye={kernelName:S0,backendName:"cpu",kernelFunc:pC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fU(t){const{inputs:e,backend:n}=t,{x:r}=e;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){const i=Tf({inputs:{input:r},backend:n}),s=fU({inputs:{x:i},backend:n}),o=Lm({inputs:{input:r},backend:n}),a=pC({inputs:{x:o},backend:n}),l=ao({inputs:{real:s,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return NN({backend:n,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}const uye={kernelName:s0,backendName:"cpu",kernelFunc:fU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dU(t){const{inputs:e,backend:n,attrs:r}=t,{axis:i}=r;if(e.length===1)return dC({inputs:{input:e[0]},backend:n,attrs:{dim:i}});const s=e[0].shape,o=e[0].dtype;e.forEach(u=>{zi(s,u.shape,"All tensors passed to stack must have matching shapes"),z(o===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(u=>{const h=dC({inputs:{input:u},backend:n,attrs:{dim:i}});return a.push(h),h}),c=Bm({inputs:l,backend:n,attrs:{axis:i}});return a.forEach(u=>n.disposeIntermediateTensorInfo(u)),c}const hye={kernelName:a0,backendName:"cpu",kernelFunc:dU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fye(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{paddings:s,constantValue:o}=r;_t(i,"pad");const a=s.map((w,x)=>w[0]+i.shape[x]+w[1]),l=s.map(w=>w[0]),c=n.data.get(i.dataId).values,u=_e(i.shape),h=i.shape.length,f=Rt(i.shape),d=_e(a),p=a.length,m=Rt(a),v=fi(i.dtype,d);o!==0&&v.fill(o);for(let w=0;w<u;w++){const _=wp(w,h,f).map((T,E)=>T+l[E]),S=qa(_,p,m);v[S]=c[w]}return{dataId:n.write(v,a,i.dtype),shape:a,dtype:i.dtype}}const pU={kernelName:l0,backendName:"cpu",kernelFunc:fye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dye=oi((t,e)=>Math.pow(t,e)),pye=Ii(Jp,dye),mye={kernelName:Jp,backendName:"cpu",kernelFunc:pye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gye(t){const{backend:e,attrs:n}=t,{start:r,stop:i,dtype:s,step:o}=n,a=FV(r,i,o,s);return e.makeTensorInfo([a.length],s,a)}const vye={kernelName:U_,backendName:"cpu",kernelFunc:gye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yye=jn(Qp,t=>1/t),bye={kernelName:Qp,backendName:"cpu",kernelFunc:yye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wye(t){const{inputs:e,backend:n,attrs:r}=t,{images:i}=e,{alignCorners:s,halfPixelCenters:o,size:a}=r;_t(i,"resizeBilinear");const l=Rt(i.shape),[c,u]=a,[h,f,d,p]=i.shape,m=n.data.get(i.dataId).values,v=new Float32Array(_e([h,c,u,p])),y=[s&&c>1?f-1:f,s&&u>1?d-1:d],w=[s&&c>1?c-1:c,s&&u>1?u-1:u];let x=0;const _=y[0]/w[0],S=y[1]/w[1];for(let T=0;T<h;T++)for(let E=0;E<c;E++){let k;o?k=_*(E+.5)-.5:k=_*E;const A=Math.max(0,Math.floor(k)),M=k-A,D=Math.min(f-1,Math.ceil(k)),P=T*l[0]+A*l[1],N=T*l[0]+D*l[1];for(let R=0;R<u;R++){let F;o?F=S*(R+.5)-.5:F=S*R;const O=Math.max(0,Math.floor(F)),K=F-O,J=Math.min(d-1,Math.ceil(F)),re=P+O*l[2],ae=N+O*l[2],pe=P+J*l[2],ke=N+J*l[2];for(let Te=0;Te<p;Te++){const Ne=m[re+Te],we=m[ae+Te],me=m[pe+Te],He=m[ke+Te],Fe=Ne+(me-Ne)*K,je=we+(He-we)*K,Ve=Fe+(je-Fe)*M;v[x++]=Ve}}}return n.makeTensorInfo([h,c,u,p],"float32",v)}const xye={kernelName:f0,backendName:"cpu",kernelFunc:wye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ye(t){const{inputs:e,backend:n,attrs:r}=t,{images:i,dy:s}=e,{alignCorners:o}=r;_t([s,i],"resizeBilinearGrad");const a=Rt(i.shape),[l,c,u,h]=i.shape,[,f,d]=s.shape,p=new Float32Array(l*c*u*h),m=[o&&f>1?c-1:c,o&&d>1?u-1:u],v=[o&&f>1?f-1:f,o&&d>1?d-1:d],y=m[0]/v[0],w=m[1]/v[1],x=n.data.get(s.dataId).values;let _=0;for(let S=0;S<l;S++){const T=S*a[0];for(let E=0;E<f;E++){const k=E*y,A=Math.floor(k),M=Math.min(Math.ceil(k),c-1),D=T+A*a[1],P=T+M*a[1],N=k-A,R=1-N;for(let F=0;F<d;F++){const O=F*w,K=Math.floor(O),J=Math.min(Math.ceil(O),u-1),re=O-K,ae=1-re,pe=D+K*a[2],ke=D+J*a[2],Te=P+K*a[2],Ne=P+J*a[2],we=R*ae,me=R*re,He=N*ae,Fe=N*re;for(let je=0;je<h;je++){const Ve=x[_++];p[pe+je]+=Ve*we,p[ke+je]+=Ve*me,p[Te+je]+=Ve*He,p[Ne+je]+=Ve*Fe}}}}return n.makeTensorInfo([l,u,c,h],"float32",p)}const Sye={kernelName:H_,backendName:"cpu",kernelFunc:_ye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cye(t){const{inputs:e,backend:n,attrs:r}=t,{images:i}=e,{alignCorners:s,halfPixelCenters:o,size:a}=r;_t(i,"resizeNearestNeighbor");const l=Rt(i.shape),[c,u]=a,[h,f,d,p]=i.shape,m=n.data.get(i.dataId).values,v=new Float32Array(h*c*u*p),y=[s&&c>1?f-1:f,s&&u>1?d-1:d],w=[s&&c>1?c-1:c,s&&u>1?u-1:u],x=y[0]/w[0],_=y[1]/w[1];let S=0;for(let T=0;T<h;T++){const E=T*l[0];for(let k=0;k<c;k++){const A=o?x*(k+.5):x*k;let M=Math.min(f-1,s?Math.round(A):Math.floor(A));o&&(M=Math.max(0,M));const D=E+M*l[1];for(let P=0;P<u;P++){const N=o?_*(P+.5):_*P;let R=Math.min(d-1,s?Math.round(N):Math.floor(N));o&&(R=Math.max(0,R));const F=D+R*l[2];for(let O=0;O<p;O++){const K=m[F+O];v[S++]=K}}}}return n.makeTensorInfo([h,c,u,p],i.dtype,v)}const Tye={kernelName:h0,backendName:"cpu",kernelFunc:Cye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eye(t){const{inputs:e,backend:n,attrs:r}=t,{images:i,dy:s}=e,{alignCorners:o}=r;_t([s,i],"resizeNearestNeighborGrad");const a=Rt(i.shape),l=Rt(s.shape),[c,u,h,f]=i.shape,[,d,p]=s.shape,m=new Float32Array(c*u*h*f),v=n.data.get(s.dataId).values,y=[o&&d>1?u-1:u,o&&p>1?h-1:h],w=[o&&d>1?d-1:d,o&&p>1?p-1:p],x=y[0]/w[0],_=y[1]/w[1],S=1/x,T=1/_,E=Math.ceil(S)*2+2,k=Math.ceil(T)*2+2;for(let A=0;A<c;A++){const M=A*a[0];for(let D=0;D<u;D++){const P=M+D*a[1],N=Math.floor(D*S),R=Math.floor(N-E/2);for(let F=0;F<h;F++){const O=P+F*a[2],K=Math.floor(F*T),J=Math.floor(K-k/2);for(let re=0;re<f;re++){let ae=0;for(let pe=0;pe<E;pe++){const ke=pe+R;if(ke<0||ke>=d)continue;const Te=M+ke*l[1],Ne=ke*x,we=Math.min(u-1,o?Math.round(Ne):Math.floor(Ne));if(D===we)for(let me=0;me<k;me++){const He=me+J;if(He<0||He>=p)continue;const Fe=Te+He*l[2],je=He*_,Ve=Math.min(h-1,o?Math.round(je):Math.floor(je));F===Ve&&(ae+=v[Fe+re])}}m[O+re]=ae}}}}return n.makeTensorInfo(i.shape,i.dtype,m)}const kye={kernelName:G_,backendName:"cpu",kernelFunc:Eye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aye(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{dims:s}=r;_t(i,"reverse");const o=i.shape.length,a=hn(s,i.shape);if(o===0)return Hl({inputs:{x:i},backend:n});const l=new di(i.shape,i.dtype),c=n.bufferSync(i);for(let u=0;u<l.size;u++){const h=l.indexToLoc(u),f=h.slice();a.forEach(d=>f[d]=i.shape[d]-1-f[d]),l.set(c.get(...f),...h)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}const Mye={kernelName:d0,backendName:"cpu",kernelFunc:Aye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iye={kernelName:aS,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:r}=t,{radians:i,fillValue:s,center:o}=e,a=n,l=fi(r.dtype,_e(r.shape)),[c,u,h,f]=r.shape,[d,p]=tN(o,u,h),m=255,v=Math.sin(i),y=Math.cos(i),w=a.data.get(r.dataId).values;for(let _=0;_<c;_++){const S=_*h*u*f;for(let T=0;T<u;T++){const E=T*(h*f);for(let k=0;k<h;k++){const A=k*f;for(let M=0;M<f;M++){const D=[c,T,k,M],P=D[2],N=D[1];let R=(P-d)*y-(N-p)*v,F=(P-d)*v+(N-p)*y;R=Math.round(R+d),F=Math.round(F+p);let O=s;if(typeof s!="number"&&(M===3?O=m:O=s[M]),R>=0&&R<h&&F>=0&&F<u){const J=F*(h*f),re=R*f,ae=S+J+re+M;O=w[ae]}const K=S+E+A+M;l[K]=O}}}}return{dataId:a.write(l,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nye=jn(nm,t=>{const e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2==0?e:e+1}),$ye={kernelName:nm,backendName:"cpu",kernelFunc:Nye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mU(t,e,n,r,i,s,o,a,l,c){const u=[r/i,i],h=t.values,f=e.values;if(r===0)return mn(n,e.dtype);const d=mn(u,e.dtype);d.values.fill(l);for(let p=0;p<s;p++){const m=[];let v=0;for(let y=0;y<o;y++){const w=h[p*o+y];m.push(w),v+=w*a[y]}if(v<0||v>=r/i)throw new Error(`Invalid indices: ${m} does not index into ${n}`);for(let y=0;y<i;y++)c?d.values[v*i+y]+=f[p*i+y]:d.values[v*i+y]=e.rank===0?f[0]:f[p*i+y]}return d}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rye(t){const{inputs:e,backend:n,attrs:r}=t,{indices:i,updates:s}=e,{shape:o}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:h}=Cm(s,i,o),f=!0,d=n.bufferSync(i),p=n.bufferSync(s),m=mU(d,p,o,h,c,l,a,u,0,f);return n.makeTensorInfo(o,m.dtype,m.values)}const Dye={kernelName:j_,backendName:"cpu",kernelFunc:Rye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pye(t){const{inputs:e,backend:n}=t,{condition:r,t:i,e:s}=e;_t([r,i,s],"select");const o=r.shape.length,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,c=n.data.get(s.dataId).values,u=eo(i.dtype,s.dtype),h=Vi(_e(i.shape),u);let f=0;const d=o===0||o>1||i.shape.length===1?1:_e(i.shape.slice(1));for(let p=0;p<a.length;p++)for(let m=0;m<d;m++)a[p]===1?h[f++]=l[p]:h[f++]=c[p];return n.makeTensorInfo(i.shape,u,h)}const Oye={kernelName:p0,backendName:"cpu",kernelFunc:Pye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fye=lC,Lye=cC,Bye=jn(im,t=>t>=0?Lye*t:Fye*(Math.exp(t)-1)),zye={kernelName:im,backendName:"cpu",kernelFunc:Bye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vye=jn(am,t=>t<0?-1:t>0?1:0),Uye={kernelName:am,backendName:"cpu",kernelFunc:Vye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wye=jn(sm,t=>Math.sin(t)),Gye={kernelName:sm,backendName:"cpu",kernelFunc:Wye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hye=jn(om,t=>Math.sinh(t)),jye={kernelName:om,backendName:"cpu",kernelFunc:Hye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qye=11920928955078125e-23,gU=Math.log(qye)+2,Xye=jn(cm,t=>{const e=t>-gU,n=t<gU,r=Math.exp(t);let i;return n?i=r:e?i=t:i=Math.log(1+r),i}),Kye={kernelName:cm,backendName:"cpu",kernelFunc:Xye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yye(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockShape:s,paddings:o}=r;_t([i],"spaceToBatchND");const a=_e(s),l=[[0,0]];l.push(...o);for(let T=1+s.length;T<i.shape.length;++T)l.push([0,0]);const c=pU.kernelFunc({inputs:{x:i},backend:n,attrs:{paddings:l,constantValue:0}}),u=Y0(c.shape,s,a,!1),h=Z0(u.length,s.length,!1),f=J0(c.shape,s,a,!1),m=Er({inputs:{x:c},backend:n,attrs:{shape:u}}),w=Oo({inputs:{x:m},backend:n,attrs:{perm:h}}),S=Er({inputs:{x:w},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(w),S}const Zye={kernelName:v0,backendName:"cpu",kernelFunc:Yye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jye(t){const{inputs:e,backend:n}=t,{indices:r,values:i,denseShape:s,defaultValue:o}=e;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${s.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${i.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,c=n.data.get(s.dataId).values,u=n.data.get(o.dataId).values[0],[h,f,d,p,m]=VV(a,r.shape,r.dtype,l,i.dtype,c,u);return[n.makeTensorInfo(f,r.dtype,h),n.makeTensorInfo([f[0]],i.dtype,d),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(v=>Number(v)))),n.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}const Qye={kernelName:q_,backendName:"cpu",kernelFunc:Jye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e0e(t){const{inputs:e,backend:n}=t,{inputIndices:r,inputShape:i,newShape:s}=e;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${i.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);const o=Array.from(n.data.get(i.dataId).values),a=n.data.get(r.dataId).values,l=Array.from(n.data.get(s.dataId).values),[c,u,h]=UV(a,r.shape,r.dtype,o,l);return[n.makeTensorInfo(u,r.dtype,c),n.makeTensorInfo([h.length],s.dtype,new Int32Array(h))]}const t0e={kernelName:X_,backendName:"cpu",kernelFunc:e0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n0e(t){const{inputs:e,backend:n}=t,{data:r,indices:i,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${i.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${s.shape}`);if(i.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,[c,u]=CN(o,r.shape,r.dtype,a,l,!0);return n.makeTensorInfo(u,r.dtype,c)}const r0e={kernelName:K_,backendName:"cpu",kernelFunc:n0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i0e(t){const{inputs:e,backend:n}=t,{data:r,indices:i,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${i.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${s.shape}`);if(i.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,[c,u]=CN(o,r.shape,r.dtype,a,l);return n.makeTensorInfo(u,r.dtype,c)}const s0e={kernelName:Y_,backendName:"cpu",kernelFunc:i0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o0e(t){const{inputs:e,backend:n,attrs:r}=t,{sparseIndices:i,sparseValues:s,defaultValue:o}=e,{outputShape:a}=r,{sliceRank:l,numUpdates:c,sliceSize:u,strides:h,outputSize:f}=Cm(s,i,a),d=!1,p=n.bufferSync(i),m=n.bufferSync(s),v=n.data.get(o.dataId).values[0],y=mU(p,m,a,f,u,c,l,h,v,d);return n.makeTensorInfo(a,y.dtype,y.values)}const a0e={kernelName:Z_,backendName:"cpu",kernelFunc:o0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l0e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{numOrSizeSplits:s,axis:o}=r,a=hn(o,i.shape)[0],l=vN(i,s,a),c=new Array(i.shape.length).fill(0),u=i.shape.slice();return l.map(h=>{const f=[...u];f[a]=h;const d=Ef({inputs:{x:i},backend:n,attrs:{begin:c,size:f}});return c[a]+=h,d})}const c0e={kernelName:y0,backendName:"cpu",kernelFunc:l0e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u0e={kernelName:J_,backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,r=e;_t(n,"square");const i=r.data.get(n.dataId).values,s=new Float32Array(i.length);for(let a=0;a<i.length;++a){const l=i[a];s[a]=l*l}return{dataId:r.write(s,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h0e=jn(gm,(t,e)=>{const n=e;return isNaN(t)?NaN:t>0?1:n.alpha}),f0e={kernelName:gm,backendName:"cpu",kernelFunc:h0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d0e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{begin:s,end:o,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:f}=r;_t(i,"stridedSlice");const{finalShapeSparse:d,finalShape:p,isIdentity:m,sliceDim0:v,isSimpleSlice:y,begin:w,end:x,strides:_}=hI(i.shape,s,o,a,l,c,u,h,f);let S;if(m)S=Er({inputs:{x:i},backend:n,attrs:{shape:p}});else if(v||y){z(i.shape.length>=1,()=>`Input must have rank at least 1, got: ${i.shape.length}`);const T=lI(w,x,_),E=Ef({inputs:{x:i},backend:n,attrs:{begin:w,size:T}});S=Er({inputs:{x:E},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(E)}else{const T=n.bufferSync(i),E=GV(d,T,_,w);S=n.makeTensorInfo(p,E.dtype,E.values)}return S}const p0e={kernelName:Q_,backendName:"cpu",kernelFunc:d0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m0e(t){const{inputs:e,backend:n,attrs:r}=t,{separator:i,nGramWidths:s,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:c}=r,{data:u,dataSplits:h}=e,f=n.data.get(u.dataId).values,d=n.data.get(h.dataId).values,[p,m]=HV(f,d,i,s,o,a,l,c);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(h.shape,"int32",m)]}const g0e={kernelName:eS,backendName:"cpu",kernelFunc:m0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v0e(t){const{inputs:e,backend:n,attrs:r}=t,{skipEmpty:i}=r,{input:s,delimiter:o}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.data.get(s.dataId).values,l=n.data.get(o.dataId).values[0],[c,u,h]=jV(a,l,i),f=u.length;return[n.makeTensorInfo([f,2],"int32",c),n.makeTensorInfo([f],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(h))]}const y0e={kernelName:tS,backendName:"cpu",kernelFunc:v0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b0e(t){const{inputs:e,backend:n,attrs:r}=t,{numBuckets:i}=r,{input:s}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const o=n.data.get(s.dataId).values,a=qV(o,i);return n.makeTensorInfo(s.shape,"int32",a)}const w0e={kernelName:nS,backendName:"cpu",kernelFunc:b0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x0e=jn(dm,t=>Math.tan(t)),_0e={kernelName:dm,backendName:"cpu",kernelFunc:x0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S0e=jn(pm,t=>Math.tanh(t)),C0e={kernelName:pm,backendName:"cpu",kernelFunc:S0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T0e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{reps:s}=r;_t(i,"tile");const o=KV(n.bufferSync(i),s);return n.makeTensorInfo(o.shape,o.dtype,o.values)}const E0e={kernelName:mm,backendName:"cpu",kernelFunc:T0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k0e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{k:s,sorted:o}=r;_t(i,"topk");const a=n.data.get(i.dataId).values,[l,c]=ZV(a,i.shape,i.dtype,s,o);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(c.shape,c.dtype,c.values)]}const A0e={kernelName:rS,backendName:"cpu",kernelFunc:k0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M0e(t){const{inputs:e,attrs:n,backend:r}=t,{image:i,transforms:s}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:c}=n,[u,h,f,d]=i.shape,[p,m]=c!=null?c:[h,f],v=[u,p,m,d],y=Rt(i.shape),w=y[0],x=y[1],_=y[2],S=fi(i.dtype,_e(v));S.fill(l);const T=r.data.get(i.dataId).values,E=r.data.get(s.dataId).values;for(let A=0;A<u;++A){const M=s.shape[0]===1?E:E.subarray(A*8,A*8+8);for(let D=0;D<p;++D)for(let P=0;P<m;++P)for(let N=0;N<d;++N){let R;const F=M[6]*P+M[7]*D+1;if(F===0)continue;const O=(M[0]*P+M[1]*D+M[2])/F,K=(M[3]*P+M[4]*D+M[5])/F,J=vU(O,f,a),re=vU(K,h,a);switch(o){case"nearest":R=P0e(T,h,f,w,x,_,A,re,J,N,l);break;case"bilinear":R=O0e(T,h,f,w,x,_,A,re,J,N,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const ae=A*w+D*x+P*_+N;S[ae]=R}return r.makeTensorInfo(v,i.dtype,S)}return{dataId:r.write(S,v,i.dtype),shape:i.shape,dtype:i.dtype}}const I0e={kernelName:iS,backendName:"cpu",kernelFunc:M0e};function vU(t,e,n){switch(n){case"reflect":return N0e(t,e);case"wrap":return $0e(t,e);case"nearest":return D0e(t,e);case"constant":default:return R0e(t)}}function N0e(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const r=2*e;n<r&&(n=r*Math.trunc(-n/r)+n),n=n<-e?n+r:-n-1}else if(n>e-1)if(e<=1)n=0;else{const r=2*e;n-=r*Math.trunc(n/r),n>=e&&(n=r-n-1)}return Ou(0,n,e-1)}function $0e(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const r=e-1;n+=e*(Math.trunc(-n/r)+1)}else if(n>e-1)if(e<=1)n=0;else{const r=e-1;n-=e*Math.trunc(n/r)}return Ou(0,n,e-1)}function R0e(t,e){return t}function D0e(t,e){return Ou(0,t,e-1)}function nb(t,e,n,r,i,s,o,a,l,c,u){const h=o*r+a*i+l*s+c;return 0<=a&&a<e&&0<=l&&l<n?t[h]:u}function P0e(t,e,n,r,i,s,o,a,l,c,u){const h=Math.round(a),f=Math.round(l);return nb(t,e,n,r,i,s,o,h,f,c,u)}function O0e(t,e,n,r,i,s,o,a,l,c,u){const h=Math.floor(a),f=Math.floor(l),d=h+1,p=f+1,m=(p-l)*nb(t,e,n,r,i,s,o,h,f,c,u)+(l-f)*nb(t,e,n,r,i,s,o,h,p,c,u),v=(p-l)*nb(t,e,n,r,i,s,o,d,f,c,u)+(l-f)*nb(t,e,n,r,i,s,o,d,p,c,u);return(d-a)*m+(a-h)*v}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F0e(t){const{inputs:e,attrs:n,backend:r}=t,{axis:i}=n,{x:s}=e;_t(s,"unique");const o=r.data.get(s.dataId).values,{outputValues:a,outputShape:l,indices:c}=JV(o,i,s.shape,s.dtype);return[r.makeTensorInfo(l,s.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}const L0e={kernelName:sS,backendName:"cpu",kernelFunc:F0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B0e(t){const{inputs:e,backend:n,attrs:r}=t,{value:i}=e;let{axis:s}=r;s<0&&(s+=i.shape.length);const o=i.shape.length,a=i.shape[s],l=new Array(o-1);let c=0;for(let d=0;d<o;d++)d!==s&&(l[c++]=i.shape[d]);const u=new Array(o).fill(0),h=i.shape.slice();h[s]=1;const f=new Array(a);for(let d=0;d<f.length;d++){u[s]=d;const p=Ef({inputs:{x:i},backend:n,attrs:{begin:u,size:h}});f[d]=Er({inputs:{x:p},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(p)}return f}const z0e={kernelName:x0,backendName:"cpu",kernelFunc:B0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V0e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,segmentIds:s}=e,{numSegments:o}=r;_t(i,"unsortedSegmentSum");const a=i.shape.length,l=s.shape.length,c=[],u=[],h=a-l;let f=s;for(let p=0;p<h;++p){const m=dC({inputs:{input:f},backend:n,attrs:{dim:p+1}});f=m,u.push(m)}for(let p=0;p<o;++p){const m=Dc(p,"int32"),v=n.makeTensorInfo([],"int32",m),y=yV({inputs:{a:v,b:f},backend:n}),w=Zu({inputs:{x:y},backend:n,attrs:{dtype:"float32"}}),x=fC({inputs:{a:w,b:i},backend:n}),_=tb({inputs:{x},backend:n,attrs:{axis:0,keepDims:!1}});c.push(_),u.push(v),u.push(y),u.push(w),u.push(x),u.push(_)}const d=dU({inputs:c,backend:n,attrs:{axis:0}});return u.forEach(p=>n.disposeIntermediateTensorInfo(p)),d}const U0e={kernelName:_0,backendName:"cpu",kernelFunc:V0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W0e=[Zpe,Wde,Qpe,tme,Kde,rme,sme,ame,cme,hme,dme,mme,vme,wme,_me,Tme,kme,Mme,Nme,Kpe,Rme,Pme,Fme,Bme,qde,Zde,Vme,Gde,Wme,Hme,Xme,Yme,jme,ege,nge,Jme,ige,oge,lge,uge,fge,pge,mge,vge,bge,xge,_ge,Cge,Sge,MN,kge,Upe,Mge,Jde,Fge,Qde,Lge,tpe,Gge,Hge,qge,rpe,Yge,Jge,eve,nve,ive,spe,ape,Hde,ove,Gme,lve,uve,fve,Wpe,cpe,hpe,pve,dpe,gve,bve,xve,Cve,Eve,Ave,mpe,Nve,Rve,Pve,Fve,Bve,Mve,Vve,Wve,vpe,Hve,Xve,Zve,bpe,xpe,eye,rye,oye,Spe,lye,uye,hye,pU,mye,Hpe,Epe,vye,jde,bye,jpe,qpe,Xpe,xye,Sye,Tye,kye,Mye,Iye,$ye,Ape,Dye,Oye,zye,Ipe,Uye,Gye,jye,Npe,Kve,Kye,Zye,Qye,t0e,r0e,s0e,a0e,c0e,Dpe,u0e,Ope,f0e,p0e,g0e,y0e,w0e,zpe,Tge,_0e,C0e,E0e,A0e,Cpe,I0e,L0e,z0e,U0e,cye];for(const t of W0e)uS(t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kf={},$N={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function G0e(t,e){kf[t]=e}function jl(t){if(!(t in kf)){const n=j0e(t);if(n!==null)kf[t]=n;else return console.log("Could not get context for WebGL version",t),null}const e=kf[t];return e==null||e.isContextLost()?(delete kf[t],jl(t)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),kf[t])}function H0e(t){if(typeof OffscreenCanvas!="undefined"&&t===2)return new OffscreenCanvas(300,150);if(typeof document!="undefined")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function j0e(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const e=H0e(t);return e.addEventListener("webglcontextlost",n=>{n.preventDefault(),delete kf[t]},!1),t===1?e.getContext("webgl",$N)||e.getContext("experimental-webgl",$N):e.getContext("webgl2",$N)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var rb;(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(rb||(rb={}));var Fo;(function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"})(Fo||(Fo={}));var Gi;(function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Gi||(Gi={}));function ib(t,e){return[e,t]}function q0e(t,e){return t*e}function mC(t){const e=_e(t),n=Math.ceil(e/4);return n_(n)}function zm(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function X0e(t,e){const[n,r]=zm(t,e);return n*r*4}function RN(t,e){const n=t;let r,i,s,o,a,l,c,u,h,f;return Ce().getNumber("WEBGL_VERSION")===2?(r=n.R32F,i=n.R16F,s=n.RGBA16F,o=n.RGBA32F,a=n.RED,c=4,u=1,h=n.HALF_FLOAT,f=n.FLOAT,l=n.RGBA8):(r=t.RGBA,i=t.RGBA,s=t.RGBA,o=n.RGBA,a=t.RGBA,c=4,u=4,h=e!=null?e.HALF_FLOAT_OES:null,f=t.FLOAT,l=t.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:i,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:u,textureTypeHalfFloat:h,textureTypeFloat:f}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function St(t,e){const n=e();return Ce().getBool("DEBUG")&&K0e(t),n}function K0e(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+Q0e(t,e))}const Y0e=596e-10,Z0e=65504;function J0e(t){return!!(Ce().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||Y0e<Math.abs(t)&&Math.abs(t)<Z0e)}function Q0e(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function gC(t,e){return Wc(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function ebe(t,e){const n=Wc(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(St(t,()=>t.shaderSource(n,e)),St(t,()=>t.compileShader(n)),t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function tbe(t,e){const n=Wc(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(St(t,()=>t.shaderSource(n,e)),St(t,()=>t.compileShader(n)),t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw rbe(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const nbe=/ERROR: [0-9]+:([0-9]+):/g;function rbe(t,e){const n=nbe.exec(e);if(n==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(t);return}const r=+n[1],i=t.split(`
`),s=i.length.toString().length+2,o=i.map((h,f)=>of((f+1).toString(),s)+h);let a=0;for(let h=0;h<o.length;h++)a=Math.max(o[h].length,a);const l=o.slice(0,r-1),c=o.slice(r-1,r),u=o.slice(r);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${of(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join(`
`))}function ibe(t){return Wc(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function sbe(t,e){if(St(t,()=>t.linkProgram(e)),t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function DN(t,e){if(St(t,()=>t.validateProgram(e)),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function obe(t,e){const n=Wc(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return St(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),St(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function abe(t,e){const n=Wc(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return St(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)),St(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function lbe(t){return Wc(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function cbe(t,e){const n=Ce().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){const r=`[${t}x${e}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(t>n||e>n){const r=`[${t}x${e}]`,i=`[${n}x${n}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+i+".")}}function ube(t){return Wc(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function yU(t,e,n,r,i,s,o){const a=t.getAttribLocation(e,n);return a===-1?!1:(St(t,()=>t.bindBuffer(t.ARRAY_BUFFER,r)),St(t,()=>t.vertexAttribPointer(a,i,t.FLOAT,!1,s,o)),St(t,()=>t.enableVertexAttribArray(a)),!0)}function hbe(t,e,n){gbe(t,n),St(t,()=>t.activeTexture(t.TEXTURE0+n)),St(t,()=>t.bindTexture(t.TEXTURE_2D,e))}function fbe(t,e,n){return Wc(t,()=>t.getUniformLocation(e,n),'uniform "'+n+'" not present in program.')}function dbe(t,e,n){return t.getUniformLocation(e,n)}function pbe(t,e,n,r){St(t,()=>hbe(t,e,r)),St(t,()=>t.uniform1i(n,r))}function PN(t,e,n){St(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),St(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function bU(t,e){St(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),St(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function vC(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+mbe(t,e))}function mbe(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function Wc(t,e,n){const r=St(t,()=>e());if(r==null)throw new Error(n);return r}function gbe(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n){const i=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${i}.`)}}function Vm(t,e=2){return _e(t.slice(0,t.length-e))}function Um(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function ON(t){let e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[Vm(t),...Um(t)]),e}function vbe(t,e=!1){let n=Ce().getNumber("WEBGL_MAX_TEXTURE_SIZE");e&&(n=n*2,t=t.map((i,s)=>s>=t.length-2?mM(t[s]):t[s]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=Rc(t).newShape);let r=_e(t);if(t.length<=1&&r<=n)return[1,r];if(t.length===2&&t[0]<=n&&t[1]<=n)return t;if(t.length===3&&t[0]*t[1]<=n&&t[2]<=n)return[t[0]*t[1],t[2]];if(t.length===3&&t[0]<=n&&t[1]*t[2]<=n)return[t[0],t[1]*t[2]];if(t.length===4&&t[0]*t[1]*t[2]<=n&&t[3]<=n)return[t[0]*t[1]*t[2],t[3]];if(t.length===4&&t[0]<=n&&t[1]*t[2]*t[3]<=n)return[t[0],t[1]*t[2]*t[3]];if(e){const i=Vm(t);let s=2,o=2;return t.length&&([s,o]=Um(t)),r=i*(s/2)*(o/2),n_(r).map(a=>a*2)}return n_(r)}function yC(t){return t%2==0}function bC(t,e){if(t=t.slice(-2),e=e.slice(-2),wn(t,e)||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){const n=t.slice(-1)[0],r=e.slice(-1)[0];if(n===r||yC(n)&&yC(r)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&yC(t[0])&&yC(e[0])}let FN,LN;function ybe(t){if(FN==null){const e=jl(t);FN=e.getParameter(e.MAX_TEXTURE_SIZE)}return FN}function bbe(t){if(LN==null){const e=jl(t);LN=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,LN)}function wbe(t){if(t===0)return 0;let e;const n=jl(t);return fa(n,"EXT_disjoint_timer_query_webgl2")&&t===2?e=2:fa(n,"EXT_disjoint_timer_query")?e=1:e=0,e}function fa(t,e){return t.getExtension(e)!=null}function wU(t){try{if(jl(t)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function xbe(t){if(t===0)return!1;const e=jl(t);if(t===1){if(!fa(e,"OES_texture_float"))return!1}else if(!fa(e,"EXT_color_buffer_float"))return!1;return BN(e)}function _be(t){if(t===0)return!1;const e=jl(t);if(t===1){if(!fa(e,"OES_texture_float")||!fa(e,"WEBGL_color_buffer_float"))return!1}else{if(fa(e,"EXT_color_buffer_float"))return BN(e);const r="EXT_color_buffer_half_float";if(fa(e,r)){const i=e.getExtension(r);return Sbe(e,i)}return!1}return BN(e)}function BN(t){const e=RN(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n);const r=1,i=1;t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,r,i,0,e.textureFormatFloat,e.textureTypeFloat,null);const s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(s),o}function Sbe(t,e){const n=RN(t,e),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);const i=1,s=1;t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,i,s,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(o),a}function Cbe(t){return t!==2?!1:jl(t).fenceSync!=null}function sb(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&z(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dt=Ce();Dt.registerFlag("HAS_WEBGL",()=>Dt.getNumber("WEBGL_VERSION")>0);Dt.registerFlag("WEBGL_VERSION",()=>wU(2)?2:wU(1)?1:0);Dt.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Dt.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Dt.get("WEBGL_VERSION")===2);Dt.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Dt.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Dt.registerFlag("WEBGL_PACK",()=>Dt.getBool("HAS_WEBGL"));Dt.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Dt.getBool("WEBGL_PACK"));Dt.registerFlag("WEBGL_PACK_CLIP",()=>Dt.getBool("WEBGL_PACK"));Dt.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Dt.getBool("WEBGL_PACK"));Dt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Dt.getBool("WEBGL_PACK"));Dt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Dt.getBool("WEBGL_PACK"));Dt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Dt.getBool("WEBGL_PACK"));Dt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Dt.getBool("WEBGL_PACK"));Dt.registerFlag("WEBGL_PACK_REDUCE",()=>Dt.getBool("WEBGL_PACK"));Dt.registerFlag("WEBGL_LAZILY_UNPACK",()=>Dt.getBool("WEBGL_PACK"));Dt.registerFlag("WEBGL_CONV_IM2COL",()=>Dt.getBool("WEBGL_PACK"));Dt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>ybe(Dt.getNumber("WEBGL_VERSION")));Dt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>bbe(Dt.getNumber("WEBGL_VERSION")));Dt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const t=Dt.getNumber("WEBGL_VERSION");return t===0?0:wbe(t)});Dt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Dt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!zM());Dt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>xbe(Dt.getNumber("WEBGL_VERSION")));Dt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Dt.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Dt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Dt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>_be(Dt.getNumber("WEBGL_VERSION")));Dt.registerFlag("WEBGL_FENCE_API_ENABLED",()=>Cbe(Dt.getNumber("WEBGL_VERSION")));Dt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Dt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Dt.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});Dt.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>zM()?1:-1,t=>{if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});Dt.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Dt.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Dt.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Dt.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gs(){let t,e,n,r,i,s,o,a,l,c;return Ce().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",n="out",r="in",i="texture",s="outputColor",o="out vec4 outputColor;",a=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",n="varying",r="varying",i="texture2D",s="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:n,varyingFs:r,texture2D:i,output:s,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Af(t,e,n="index"){const r=Rt(e);return r.map((i,s)=>{const o=`int ${t[s]} = ${n} / ${i}`,a=s===r.length-1?`int ${t[s+1]} = ${n} - ${t[s]} * ${i}`:`index -= ${t[s]} * ${i}`;return`${o}; ${a};`}).join("")}function wC(t,e,n="index"){const r=Rt(e);return r.map((i,s)=>{const o=`int ${t[s]} = ${n} / outShapeStrides[${s}]`,a=s===r.length-1?`int ${t[s+1]} = ${n} - ${t[s]} * outShapeStrides[${s}]`:`index -= ${t[s]} * outShapeStrides[${s}]`;return`${o}; ${a};`}).join("")}function Tbe(t,e){const n=t.length,r=t.map(s=>`${e}[${s}]`),i=new Array(n-1);i[n-2]=r[n-1];for(let s=n-3;s>=0;--s)i[s]=`(${i[s+1]} * ${r[s+1]})`;return i}function Ebe(t,e,n="index"){const r=t.map((s,o)=>o),i=Tbe(r,e);return i.map((s,o)=>{const a=`int ${t[o]} = ${n} / ${i[o]}`,l=o===i.length-1?`int ${t[o+1]} = ${n} - ${t[o]} * ${i[o]}`:`index -= ${t[o]} * ${i[o]}`;return`${a}; ${l};`}).join("")}function zN(t){const e=Rt(t).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function VN(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const xU=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:_U}=uV;function kbe(t,e,n){const r=[];if(t.forEach(d=>{const p=_e(d.shapeInfo.logicalShape);if(d.shapeInfo.isUniform?r.push(`uniform float ${d.name}${p>1?`[${p}]`:""};`):(r.push(`uniform sampler2D ${d.name};`),r.push(`uniform int offset${d.name};`)),n.enableShapeUniforms){const{uniformShape:m}=UN(n.packedInputs,d.shapeInfo.logicalShape,d.shapeInfo.texShape);switch(m.length){case 1:r.push(`uniform int ${d.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${d.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${d.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${d.name}Shape;`);break}r.push(`uniform ivec2 ${d.name}TexShape;`)}}),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;");break}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(d=>{r.push(`uniform ${d.type} ${d.name}${d.arrayIndex?`[${d.arrayIndex}]`:""};`)});const i=r.join(`
`),s=t.map(d=>Abe(d,e,n.packedInputs,n.enableShapeUniforms)).join(`
`),o=e.texShape,a=gs(),l=Nbe(a);let c,u,h=Dbe(a);return e.isPacked?(c=Mbe(e.logicalShape,o,n.enableShapeUniforms),u=Rbe(a)):(c=Ibe(e.logicalShape,o,n.enableShapeUniforms),u=$be(a)),n.packedInputs&&(h+=Lbe),[h,l,u,i,c,s,n.userCode].join(`
`)}function Wm(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return Ybe(t,e);case 1:return Jbe(t,e);case 2:return ewe(t,e);case 3:return nwe(t,e);case 4:return iwe(t,e);case 5:return swe(t);case 6:return owe(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function SU(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return Kbe(t);case 1:return Zbe(t,e);case 2:return Qbe(t,e);case 3:return twe(t,e);default:return rwe(t,e)}}function Abe(t,e,n=!1,r){let i="";n?i+=SU(t,r):i+=Wm(t,r);const s=t.shapeInfo.logicalShape,o=e.logicalShape;return s.length<=o.length&&(n?i+=awe(t,e):i+=lwe(t,e)),i}function Mbe(t,e,n){switch(t.length){case 0:return CU();case 1:return Bbe(t,e,n);case 2:return qbe(t,e,n);case 3:return Vbe(t,e,n);default:return Wbe(t,e,n)}}function Ibe(t,e,n){switch(t.length){case 0:return CU();case 1:return zbe(t,e,n);case 2:return Xbe(t,e,n);case 3:return Ube(t,e,n);case 4:return Gbe(t,e,n);case 5:return Hbe(t,e);case 6:return jbe(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function Nbe(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function $be(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function Rbe(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function Dbe(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${Pbe}
    ${Obe}
    ${Fbe}
  `}const Pbe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Obe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Fbe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Lbe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function CU(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function Bbe(t,e,n){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return r[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${r[1]}.0);
      }
    `:r[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${r[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);
    }
  `}function zbe(t,e,n){return e[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function Vbe(t,e,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],i=Math.ceil(t[2]/2),s=i*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec3(b, r, c);
    }
  `}function Ube(t,e,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${wC(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;const r=Af(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${r}
      return ivec3(r, c, d);
    }
  `}function Wbe(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],i=Math.ceil(t[t.length-1]/2),s=i*Math.ceil(t[t.length-2]/2);let o=s,a="",l="b, r, c";for(let c=2;c<t.length-1;c++)o*=t[t.length-c-1],a=`
      int b${c} = index / ${o};
      index -= b${c} * ${o};
    `+a,l=`b${c}, `+l;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      ${a}

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec${t.length}(${l});
    }
  `}function Gbe(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${wC(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;const r=Af(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${r}
      return ivec4(r, c, d, d2);
    }
  `}function Hbe(t,e){const n=Af(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function jbe(t,e){const n=Af(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function qbe(t,e,n){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(wn(t,e))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));
      }
    `;const i=Math.ceil(t[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));

      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec2(r, c);
    }
  `}function Xbe(t,e,n){return wn(t,e)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:t[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function Mf(t){return`offset${t}`}function Kbe(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),r=gs();return`
    vec4 ${n}() {
      return ${r.texture2D}(${e}, halfCR);
    }
  `}function Ybe(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${r}() {return ${n};}`;const[i,s]=t.shapeInfo.texShape;if(i===1&&s===1)return`
      float ${r}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const o=Mf(n);if(e)return`
    float ${r}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${o});
      return sampleTexture(${n}, uv);
    }
  `;const[a,l]=t.shapeInfo.texShape;return`
    float ${r}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${o});
      return sampleTexture(${n}, uv);
    }
  `}function Zbe(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t.shapeInfo.texShape,s=gs();if(e)return`
    vec4 ${r}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${s.texture2D}(${n}, uv);
    }
  `;const o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return`
    vec4 ${r}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${s.texture2D}(${n}, uv);
    }
  `}function Jbe(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${r}(int index) {
        ${Gm(t)}
      }
    `;const i=t.shapeInfo.texShape,s=i[0],o=i[1];if(o===1&&s===1)return`
      float ${r}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const a=Mf(n);return o===1?e?`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${s}.0);
        return sampleTexture(${n}, uv);
      }
    `:s===1?e?`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:e?`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${s}, ${o}, index + ${a});
      return sampleTexture(${n}, uv);
    }
  `}function Qbe(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=t.shapeInfo.texShape,o=s[0],a=s[1],l=gs();if(s!=null&&wn(n,s))return e?`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);

        return ${l.texture2D}(${r}, uv);
      }
    `:`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${l.texture2D}(${r}, uv);
      }
    `;if(e)return`
    vec4 ${i}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `;const c=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],u=Math.ceil(n[1]/2);return`
    vec4 ${i}(int row, int col) {
      vec2 uv = packedUVfrom2D(${u}, ${c[0]}, ${c[1]}, row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `}function ewe(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=t.shapeInfo.texShape;if(s!=null&&wn(n,s)){if(e)return`
      float ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `;const f=s[0],d=s[1];return`
    float ${i}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${d}.0, ${f}.0);
      return sampleTexture(${r}, uv);
    }
  `}const{newShape:o,keptDims:a}=Rc(n),l=o;if(l.length<n.length){const f=Hm(t,l),d=["row","col"];return`
      ${Wm(f,e)}
      float ${i}(int row, int col) {
        return ${i}(${jm(d,a)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${i}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${Gm(t)}
      }
    `;const c=s[0],u=s[1],h=Mf(r);return u===1?e?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);
      return sampleTexture(${r}, uv);
    }
  `:c===1?e?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);
      return sampleTexture(${r}, uv);
    }
  `:e?`
      float ${i}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r}Shape[1] + col + ${h};
        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
        return sampleTexture(${r}, uv);
      }
    `:`
  float ${i}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${h};
    vec2 uv = uvFromFlat(${c}, ${u}, index);
    return sampleTexture(${r}, uv);
  }
`}function twe(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=t.shapeInfo.texShape,o=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(n[0]===1){const f=n.slice(1),d=[1,2],p=Hm(t,f),m=["b","row","col"];return`
        ${SU(p,e)}
        vec4 ${i}(int b, int row, int col) {
          return ${i}(${jm(m,d)});
        }
      `}const a=gs();if(e)return`
    vec4 ${i}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `;const l=o[0],c=o[1],u=Math.ceil(n[2]/2),h=u*Math.ceil(n[1]/2);return`
    vec4 ${i}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${c}, ${h}, ${u}, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `}function nwe(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[1]*n[2],o=n[2],{newShape:a,keptDims:l}=Rc(n),c=a;if(c.length<n.length){const m=Hm(t,c),v=["row","col","depth"];return`
        ${Wm(m,e)}
        float ${i}(int row, int col, int depth) {
          return ${i}(${jm(v,l)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${s}, ${o}, 1)));
        ${Gm(t)}
      }
    `;const u=t.shapeInfo.texShape,h=u[0],f=u[1],d=t.shapeInfo.flatOffset;if(f===s&&d==null)return e?`
      float ${i}(int row, int col, int depth) {
        int stride1 = ${r}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
        float ${i}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${f}.0, ${h}.0);
          return sampleTexture(${r}, uv);
        }
      `;if(f===o&&d==null)return e?`
      float ${i}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${i}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${f}.0, ${h}.0);
      return sampleTexture(${r}, uv);
    }
  `;const p=Mf(r);return e?`
    float ${i}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${r}Shape[1] * ${r}Shape[2];
      int stride1 = ${r}Shape[2];
      int index = row * ${s} + col * ${o} + depth + ${p};
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
      return sampleTexture(${r}, uv);
    }
    `:`
      float ${i}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s} + col * ${o} + depth + ${p};
        vec2 uv = uvFromFlat(${h}, ${f}, index);
        return sampleTexture(${r}, uv);
      }
  `}function rwe(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=gs();if(e)return`
    vec4 ${r}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${i.texture2D}(${n}, uv);
    }
  `;const s=t.shapeInfo.logicalShape,o=s.length,a=t.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=l[0],u=l[1],h=Math.ceil(s[o-1]/2);let f=h*Math.ceil(s[o-2]/2),d="int b, int row, int col",p=`b * ${f} + (row / 2) * ${h} + (col / 2)`;for(let m=2;m<o-1;m++)d=`int b${m}, `+d,f*=s[o-m-1],p=`b${m} * ${f} + `+p;return`
    vec4 ${r}(${d}) {
      int index = ${p};
      int texR = index / ${u};
      int texC = index - texR * ${u};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${c});
      return ${i.texture2D}(${n}, uv);
    }
  `}function iwe(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[3],o=n[2]*s,a=n[1]*o,{newShape:l,keptDims:c}=Rc(n);if(l.length<n.length){const w=Hm(t,l),x=["row","col","depth","depth2"];return`
      ${Wm(w,e)}
      float ${i}(int row, int col, int depth, int depth2) {
        return ${i}(${jm(x,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${s}, 1)));
        ${Gm(t)}
      }
    `;const u=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,f=h[0],d=h[1],p=`int stride2 = ${r}Shape[3];`,m=`int stride1 = ${r}Shape[2] * stride2;`,v=`int stride0 = ${r}Shape[1] * stride1;`;if(d===a&&u==null)return e?`
      float ${i}(int row, int col, int depth, int depth2) {
        ${p}
        ${m}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${d}.0, ${f}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(d===s&&u==null)return e?`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${d}.0, ${f}.0);
        return sampleTexture(${r}, uv);
      }
    `;const y=Mf(r);return e?`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${p}
      ${m}
      ${v}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${y});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${s} + depth2;
      vec2 uv = uvFromFlat(${f}, ${d}, index + ${y});
      return sampleTexture(${r}, uv);
    }
  `}function swe(t){const e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e[4],s=e[3]*i,o=e[2]*s,a=e[1]*o,{newShape:l,keptDims:c}=Rc(e);if(l.length<e.length){const m=Hm(t,l),v=["row","col","depth","depth2","depth3"];return`
      ${Wm(m)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${jm(v,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${s}, ${i})) +
          depth3;
        ${Gm(t)}
      }
    `;const u=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,f=h[0],d=h[1];if(d===a&&u==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${s}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${d}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(d===i&&u==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${d}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;const p=Mf(n);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${s} +
          depth2 * ${i} + depth3 + ${p};
      vec2 uv = uvFromFlat(${f}, ${d}, index);
      return sampleTexture(${n}, uv);
    }
  `}function owe(t){const e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:i,keptDims:s}=Rc(e);if(i.length<e.length){const v=Hm(t,i),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${Wm(v)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${jm(y,s)});
      }
    `}const o=e[5],a=e[4]*o,l=e[3]*a,c=e[2]*l,u=e[1]*c;if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${c}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${Gm(t)}
      }
    `;const h=t.shapeInfo.flatOffset,f=t.shapeInfo.texShape,d=f[0],p=f[1];if(p===u&&h==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${l}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(p===o&&h==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;const m=Mf(n);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${c} + depth * ${l} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${m};
      vec2 uv = uvFromFlat(${d}, ${p}, index);
      return sampleTexture(${n}, uv);
    }
  `}function Gm(t){const e=t.name,n=_e(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function awe(t,e){const n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",s=t.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=_U(t.shapeInfo.logicalShape,e.logicalShape),l=rr(o),c=o-s;let u;const h=["x","y","z","w","u","v"];s===0?u="":o<2&&a.length>=1?u="coords = 0;":u=a.map(w=>`coords.${h[w+c]} = 0;`).join(`
`);let f="";o<2&&s>0?f="coords":f=t.shapeInfo.logicalShape.map((w,x)=>`coords.${h[x+c]}`).join(", ");let d="return outputValue;";const m=_e(t.shapeInfo.logicalShape)===1,y=_e(e.logicalShape)===1;if(s===1&&!m&&!y)d=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!y)o===1?d=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:d=`
        return vec4(outputValue.x);
      `;else if(a.length){const w=s-2,x=s-1;a.indexOf(w)>-1&&a.indexOf(x)>-1?d="return vec4(outputValue.x);":a.indexOf(w)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(x)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${i}() {
      ${l} coords = getOutputCoords();
      ${u}
      vec4 outputValue = get${r}(${f});
      ${d}
    }
  `}function lwe(t,e){const n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",s=e.texShape,o=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&wn(o,s))return`
      float ${i}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const c=rr(l),u=_U(t.shapeInfo.logicalShape,e.logicalShape),h=l-a;let f;const d=["x","y","z","w","u","v"];a===0?f="":l<2&&u.length>=1?f="coords = 0;":f=u.map(m=>`coords.${d[m+h]} = 0;`).join(`
`);let p="";return l<2&&a>0?p="coords":p=t.shapeInfo.logicalShape.map((m,v)=>`coords.${d[v+h]}`).join(", "),`
    float ${i}() {
      ${c} coords = getOutputCoords();
      ${f}
      return get${r}(${p});
    }
  `}function rr(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function UN(t,e,n){const{newShape:r,keptDims:i}=Rc(e),s=e.length,o=t&&s===3&&e[0]===1,a=o?e.slice(1):r,l=!t&&s>1&&!wn(e,n)&&r.length<s||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:i}}function Hm(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function jm(t,e){return e.map(n=>t[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cwe(t,e,n,r){const i=n.map((_,S)=>{const T={logicalShape:_.shape,texShape:_.isUniform?null:_.texData.texShape,isUniform:_.isUniform,isPacked:_.isUniform?!1:_.texData.isPacked,flatOffset:null};return _.texData!=null&&_.texData.slice!=null&&_.texData.slice.flatOffset>0&&(T.flatOffset=_.texData.slice.flatOffset),{name:e.variableNames[S],shapeInfo:T}}),s=i.map(_=>_.shapeInfo),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},a=kbe(i,o,e),l=tbe(t.gl,a),c=t.createProgram(l);let u=null;const h=t.getUniformLocation(c,"NAN",!1);Ce().getNumber("WEBGL_VERSION")===1&&(u=t.getUniformLocation(c,"INFINITY",!1));const f=!1,d={},p={},m={};for(let _=0;_<e.variableNames.length;_++){const S=e.variableNames[_];d[S]=t.getUniformLocation(c,S,f),d[`offset${S}`]=t.getUniformLocation(c,`offset${S}`,f),e.enableShapeUniforms&&(p[`${S}Shape`]=t.getUniformLocation(c,`${S}Shape`,f),m[`${S}TexShape`]=t.getUniformLocation(c,`${S}TexShape`,f))}let v,y,w;e.enableShapeUniforms&&(v=t.getUniformLocation(c,"outShape",f),w=t.getUniformLocation(c,"outShapeStrides",f),y=t.getUniformLocation(c,"outTexShape",f));const x=[];return e.customUniforms&&e.customUniforms.forEach((_,S)=>{x[S]=t.getUniformLocation(c,_.name,f)}),{program:e,fragmentShader:l,source:a,webGLProgram:c,uniformLocations:d,customUniformLocations:x,inShapeInfos:s,outShapeInfo:o,infLoc:u,nanLoc:h,inShapesLocations:p,inTexShapesLocations:m,outShapeLocation:v,outShapeStridesLocation:w,outTexShapeLocation:y}}function TU(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((n,r)=>{const i=n.logicalShape,s=e[r],o=s.shape;if(!wn(i,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${i} and ${o} must match`);if(n.isUniform&&s.isUniform)return;const a=n.texShape,l=s.isUniform?null:s.texData.texShape;if(!wn(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function uwe(t,e,n,r,i){e.program.enableShapeUniforms||(TU(e.inShapeInfos,n),TU([e.outShapeInfo],[r]));const s=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?t.setOutputPackedMatrixTexture(s,o[0],o[1]):t.setOutputMatrixTexture(s,o[0],o[1]),t.setProgram(e.webGLProgram),Ce().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&t.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&t.gl.uniform1f(e.nanLoc,NaN),n.forEach((l,c)=>{const u=e.program.variableNames[c],h=e.uniformLocations[u],f=e.uniformLocations[`offset${u}`],d=e.inShapesLocations[`${u}Shape`],p=e.inTexShapesLocations[`${u}TexShape`];if(d){const{uniformShape:m}=UN(e.program.packedInputs,l.shape,l.texData.texShape);switch(m.length){case 1:t.gl.uniform1iv(d,new Int32Array(m));break;case 2:t.gl.uniform2iv(d,new Int32Array(m));break;case 3:t.gl.uniform3iv(d,new Int32Array(m));break;case 4:t.gl.uniform4iv(d,new Int32Array(m));break}}if(p&&t.gl.uniform2i(p,l.texData.texShape[0],l.texData.texShape[1]),h!=null){if(l.isUniform){if(_e(l.shape)<2)t.gl.uniform1f(h,l.uniformValues[0]);else{let m=l.uniformValues;m instanceof Float32Array||(m=new Float32Array(m)),t.gl.uniform1fv(h,m)}return}l.texData.slice!=null&&f!=null&&t.gl.uniform1i(f,l.texData.slice.flatOffset),t.setInputMatrixTexture(l.texData.texture,h,c)}});const a=e.outShapeLocation;if(a)switch(r.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(r.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(r.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(r.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(r.shape));break}if(e.outShapeStridesLocation){const l=Rt(r.shape);switch(r.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),e.program.customUniforms&&i&&e.program.customUniforms.forEach((l,c)=>{const u=e.customUniformLocations[c],h=i[c];if(l.type==="float")t.gl.uniform1fv(u,h);else if(l.type==="vec2")t.gl.uniform2fv(u,h);else if(l.type==="vec3")t.gl.uniform3fv(u,h);else if(l.type==="vec4")t.gl.uniform4fv(u,h);else if(l.type==="int")t.gl.uniform1iv(u,h);else if(l.type==="ivec2")t.gl.uniform2iv(u,h);else if(l.type==="ivec3")t.gl.uniform3iv(u,h);else if(l.type==="ivec4")t.gl.uniform4iv(u,h);else throw Error(`uniform type ${l.type} is not supported yet.`)}),t.executeProgram()}function hwe(t,e,n){let r="";e.concat(n).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!o.isUniform){const l=o.texData.texShape,{useSqueezeShape:c,uniformShape:u,keptDims:h}=UN(t.packedInputs,o.shape,l);let f="",d="",p="";if(u.length===1&&t.packedInputs){const S=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];f=`${S[0]>1}_${S[1]>1}`}else if(u.length===2&&!t.packedInputs)d=`${u[0]>1}_${u[1]>1}`;else if(u.length>2&&!t.packedInputs){const S=Rt(u);p=`${S[0]===l[1]}_${S[S.length-1]===l[1]}`}const m=o.shape.length,v=u.length===2&&wn(o.shape,l),y=_e(o.shape)===1,w=vf(o.shape,n.shape),x=!t.packedInputs&&m===n.shape.length&&wn(l,n.texData.texShape),_=t.packedInputs||u.length>2?"":`${l[0]>1}_${l[1]>1}`;r+=`${m}_${x}_${c?h:""}_${u.length}_${y}_${w}_${v}_${f}_${d}_${p}_${_}_${a}`}else{const l=o.isUniform?"uniform":o.texData.texShape;r+=`${o.shape}_${l}_${a}`}});const i=t.userCode;let s=t.constructor.name;return s+="_"+r+"_"+i+`${Ce().getNumber("WEBGL_VERSION")}`,s}function zs(t){return Ce().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fwe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=rb.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=gs();this.outputShape=e,this.enableShapeUniforms=zs(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?wC(["r","c","d"],e):Af(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dwe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=rb.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=gs();this.outputShape=e,this.enableShapeUniforms=zs(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?wC(["r","c","d"],e):Af(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pwe{constructor(e){this.variableNames=["A"],this.outTexUsage=Fo.DOWNLOAD;const n=gs();this.outputShape=e,this.userCode=`
      ${xU}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mwe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Fo.DOWNLOAD;const n=gs();this.outputShape=e,this.userCode=`
      ${xU}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gwe{constructor(e,n=!1){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=gs();this.outputShape=e,this.enableShapeUniforms=zs(this.outputShape.length);let i="result";n&&(i="floor(result * 255. + 0.5)"),this.userCode=`
      ${this.enableShapeUniforms?VN():zN(e)}

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);

        int r = flatIndex / texShape[1];
        int c = imod(flatIndex, texShape[1]);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
        vec4 values = ${r.texture2D}(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        ${r.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vwe{constructor(e,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=gs();this.outputShape=e,this.enableShapeUniforms=zs(this.outputShape.length);let i="",s="result";n&&(s="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const l=o*2+a;i+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${r.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?VN():zN(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${i}

          ${r.output} = ${s};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ywe(t){const e=gs(),n=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return ebe(t,n)}function bwe(t){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return obe(t,e)}function wwe(t){const e=new Uint16Array([0,1,2,2,1,3]);return abe(t,e)}function ob(t,e,n,r,i,s){cbe(e,n);const o=lbe(t),a=t.TEXTURE_2D;return St(t,()=>t.bindTexture(a,o)),St(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),St(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),St(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),St(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),Ce().getNumber("WEBGL_VERSION")===1?St(t,()=>t.texImage2D(a,0,r,e,n,0,i,s,null)):St(t,()=>t.texStorage2D(a,1,r,e,n)),St(t,()=>t.bindTexture(t.TEXTURE_2D,null)),o}function EU(t){return t.internalFormatFloat}function xwe(t,e,n,r){const[i,s]=ib(e,n);return ob(t,i,s,EU(r),r.textureFormatFloat,t.FLOAT)}function kU(t){return t.internalFormatHalfFloat}function _we(t,e,n,r){const[i,s]=ib(e,n);return ob(t,i,s,kU(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function AU(t){return t.downloadTextureFormat}function Swe(t,e,n,r){const[i,s]=ib(e,n);return ob(t,i,s,AU(r),t.RGBA,t.UNSIGNED_BYTE)}function MU(t){return t.internalFormatPackedFloat}function Cwe(t,e,n,r){const[i,s]=zm(e,n);return ob(t,i,s,MU(r),t.RGBA,t.FLOAT)}function IU(t){return t.internalFormatPackedHalfFloat}function Twe(t,e,n,r){const[i,s]=zm(e,n);return ob(t,i,s,IU(r),t.RGBA,r.textureTypeHalfFloat)}function Ewe(t,e,n){const r=0,i=3*4,s=3*4+2*4;return St(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),yU(t,e,"clipSpacePos",n,3,s,r)&&yU(t,e,"uv",n,2,s,i)}function kwe(t,e,n,r,i,s){St(t,()=>t.bindTexture(t.TEXTURE_2D,e));let o,a,l;i instanceof Uint8Array?(o=new Uint8Array(n*r*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(o=new Float32Array(n*r*4),a=t.FLOAT,l=s.internalFormatPackedFloat),o.set(i),Ce().getNumber("WEBGL_VERSION")===2?St(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,r,t.RGBA,a,o)):St(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,n,r,0,t.RGBA,a,o)),St(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function Awe(t,e,n){St(t,()=>t.bindTexture(t.TEXTURE_2D,e)),n.data instanceof Uint8Array?Ce().getNumber("WEBGL_VERSION")===2?(St(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data)),t.flush()):St(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data)):Ce().getNumber("WEBGL_VERSION")===2?(St(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n)),t.flush()):St(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),St(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function Mwe(t,e,n,r){const i=t.createBuffer();St(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,i));const a=4*4*e*n;return St(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),St(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0)),St(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),i}function Iwe(t,e,n){const r=t,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function Nwe(t,e,n,r){const[i,s]=ib(e,n),o=4,a=new Uint8Array(q0e(e*n,o));return St(t,()=>t.readPixels(0,0,i,s,r.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function $we(t,e,n,r,i,s,o,a){const l=t,c=new Float32Array(X0e(s,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function Rwe(t,e,n){const r=new Float32Array(e*n*4);return St(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,r)),r}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dwe{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];const n=Ce().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,G0e(n,e)):this.gl=jl(n);let r="WEBGL_color_buffer_float";const i="EXT_color_buffer_half_float";if(Ce().getNumber("WEBGL_VERSION")===1){const s="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=gC(this.gl,s),fa(this.gl,o))this.textureHalfFloatExtension=gC(this.gl,o);else if(Ce().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),fa(this.gl,i))this.colorBufferHalfFloatExtension=gC(this.gl,i);else if(Ce().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",fa(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else if(fa(this.gl,i))this.colorBufferHalfFloatExtension=this.gl.getExtension(i);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=bwe(this.gl),this.indexBuffer=wwe(this.gl),this.framebuffer=ube(this.gl),this.textureConfig=RN(this.gl,this.textureHalfFloatExtension)}get debug(){return Ce().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;St(e,()=>e.finish()),St(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),St(e,()=>e.deleteFramebuffer(this.framebuffer)),St(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),St(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),St(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,n){return this.throwIfDisposed(),xwe(this.gl,e,n,this.textureConfig)}createFloat16MatrixTexture(e,n){return this.throwIfDisposed(),_we(this.gl,e,n,this.textureConfig)}createUnsignedBytesMatrixTexture(e,n){return this.throwIfDisposed(),Swe(this.gl,e,n,this.textureConfig)}uploadPixelDataToTexture(e,n){this.throwIfDisposed(),Awe(this.gl,e,n)}uploadDenseMatrixToTexture(e,n,r,i){this.throwIfDisposed(),kwe(this.gl,e,n,r,i,this.textureConfig)}createFloat16PackedMatrixTexture(e,n){return this.throwIfDisposed(),Twe(this.gl,e,n,this.textureConfig)}createPackedMatrixTexture(e,n){return this.throwIfDisposed(),Cwe(this.gl,e,n,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(bU(this.gl,this.framebuffer),this.outputTexture=null),St(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,n,r){return this.downloadMatrixDriver(e,()=>Nwe(this.gl,n,r,this.textureConfig))}downloadPackedMatrixFromBuffer(e,n,r,i,s,o){return $we(this.gl,e,n,r,i,s,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,n){return Iwe(this.gl,e,n)}createBufferFromTexture(e,n,r){this.bindTextureToFrameBuffer(e);const i=Mwe(this.gl,n,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),i}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let n,r;if(Ce().getBool("WEBGL_FENCE_API_ENABLED")){const i=e,s=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=()=>{const o=i.clientWaitSync(s,0,0);return o===i.ALREADY_SIGNALED||o===i.CONDITION_SATISFIED},n=s}else Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(n,Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:n,isFencePassed:r}}downloadMatrixFromPackedTexture(e,n,r){return this.downloadMatrixDriver(e,()=>Rwe(this.gl,n,r))}createProgram(e){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=ywe(n));const r=ibe(n);return St(n,()=>n.attachShader(r,this.vertexShader)),St(n,()=>n.attachShader(r,e)),sbe(n,r),this.debug&&DN(n,r),this.vertexAttrsAreBound||(this.setProgram(r),this.vertexAttrsAreBound=Ewe(n,this.program,this.vertexBuffer)),r}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&St(this.gl,()=>this.gl.deleteProgram(e))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&DN(this.gl,this.program),St(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,n,r=!0){return this.throwIfDisposed(),r?fbe(this.gl,e,n):dbe(this.gl,e,n)}getAttributeLocation(e,n){return this.throwIfDisposed(),St(this.gl,()=>this.gl.getAttribLocation(e,n))}getUniformLocationNoThrow(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)}setInputMatrixTexture(e,n,r){this.throwIfDisposed(),this.throwIfNoProgram(),pbe(this.gl,e,n,r)}setOutputMatrixTexture(e,n,r){this.setOutputMatrixTextureDriver(e,r,n)}setOutputPackedMatrixTexture(e,n,r){this.throwIfDisposed();const[i,s]=zm(n,r);this.setOutputMatrixTextureDriver(e,i,s)}setOutputMatrixWriteRegion(e,n,r,i){this.setOutputMatrixWriteRegionDriver(r,e,i,n)}setOutputPackedMatrixWriteRegion(e,n,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&DN(this.gl,this.program),vC(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;this.debug&&this.debugValidate(),St(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),St(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=gC(this.gl,Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const r=this.gl,i=this.getQueryTimerExtensionWebGL2(),s=r.createQuery();return r.beginQuery(i.TIME_ELAPSED_EXT,s),s}const e=this.getQueryTimerExtensionWebGL1(),n=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,n),n}endQuery(){if(Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,r=this.getQueryTimerExtensionWebGL2();n.endQuery(r.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await gM(()=>this.disposed||this.isQueryAvailable(e,Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,n){if(n===0)return null;if(n===2){const r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}else{const r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,n){if(n===0)return!0;if(n===2){const r=this.gl,i=this.getQueryTimerExtensionWebGL2(),s=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),s&&!this.disjoint}else{const r=this.getQueryTimerExtensionWebGL1(),i=r.getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}}pollFence(e){return new Promise(n=>{this.addItemToPoll(()=>e.isFencePassed(),()=>n())})}pollItems(){const e=Pwe(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=e;++n){const{resolveFn:r}=this.itemsToPoll[n];r()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,n){this.itemsToPoll.push({isDoneFn:e,resolveFn:n}),!(this.itemsToPoll.length>1)&&gM(()=>(this.pollItems(),this.itemsToPoll.length===0))}bindTextureToFrameBuffer(e){this.throwIfDisposed(),PN(this.gl,e,this.framebuffer),this.debug&&vC(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(PN(this.gl,this.outputTexture,this.framebuffer),this.debug&&vC(this.gl)):bU(this.gl,this.framebuffer)}downloadMatrixDriver(e,n){this.bindTextureToFrameBuffer(e);const r=n();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(e,n,r){this.throwIfDisposed();const i=this.gl;PN(i,e,this.framebuffer),this.debug&&vC(i),this.outputTexture=e,St(i,()=>i.viewport(0,0,n,r)),St(i,()=>i.scissor(0,0,n,r))}setOutputMatrixWriteRegionDriver(e,n,r,i){this.throwIfDisposed(),St(this.gl,()=>this.gl.scissor(e,n,r,i))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function Pwe(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:Owe,bincountImpl:NU,bincountReduceImpl:Fwe,ceilImpl:Lwe,concatImpl:Bwe,equalImpl:zwe,expImpl:Vwe,expm1Impl:Uwe,floorImpl:Wwe,gatherNdImpl:Gwe,gatherV2Impl:Hwe,greaterImpl:jwe,greaterEqualImpl:qwe,lessImpl:Xwe,lessEqualImpl:Kwe,linSpaceImpl:Ywe,logImpl:Zwe,maxImpl:Jwe,maximumImpl:Qwe,minimumImpl:exe,multiplyImpl:txe,negImpl:nxe,notEqualImpl:rxe,prodImpl:ixe,rangeImpl:sxe,rsqrtImpl:oxe,sigmoidImpl:axe,simpleAbsImpl:$U,sliceImpl:lxe,sparseFillEmptyRowsImpl:cxe,sparseReshapeImpl:uxe,sparseSegmentReductionImpl:RU,sqrtImpl:hxe,stridedSliceImpl:fxe,stringNGramsImpl:dxe,stringSplitImpl:pxe,stringToHashBucketFastImpl:mxe,subImpl:gxe,tileImpl:vxe,topKImpl:yxe,transposeImpl:WN,uniqueImpl:bxe}=Vpe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DU(t,e){return["x","y","z","w","u","v"].slice(0,e).map(n=>`${t}.${n}`)}function vs(t,e){return e===1?[t]:DU(t,e)}function wxe(t,e){if(t===1)return"rc";let n="";for(let r=0;r<t;r++)n+=e[r],r<t-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xxe{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=zs(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=vs("rc",this.rank),r=rr(this.rank),i=this.getOutOfBoundsCondition(n),s=this.getSetup(n),o=this.getOutput(n);this.userCode=`
        void main() {
          ${r} rc = getOutputCoords();

          if(${i}) {
            setOutput(vec4(0));
          } else {
            ${s}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const n=[];for(let r=0;r<=1;r++)for(let i=0;i<=1;i++){let s=`${r===0?"r":"rp1"}, ${i===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)s=`${e[e.length-1-o]},`+s;n.push(s)}return n}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let r=this.rank-2;r<this.rank;r++)n+=`${e[r]} >= ${this.enableShapeUniforms?`outShape[${r}]`:this.outputShape[r]}`,r<this.rank-1&&(n+="||");return n}getSetup(e){if(this.rank===1)return"";const n=e.slice(-2),r=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],i=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${r};
      bool rEdge = rp1 >= ${i};
    `}getOutput(e){const n=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc),
              rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1),
              0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PU{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=zs(this.outputShape.length);let r="";for(let i=0;i<4;i++){let s="thisRC = rc;";i%2==1&&(s+="thisRC.z += 1;"),i>1&&(s+="thisRC.y += 1;"),r+=`
        ${s}
        ${i>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${i}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${i>0?"}":""}
      `}this.userCode=`
      ${_xe(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?VN():zN(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${r}

        setOutput(result);
      }
    `}}function _xe(t,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?Ebe(["r","c","d"],"inputShape"):Af(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sxe{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(e,n,r){const i=FU(n,r),s=LU(e,i,r);s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]);const o=OU(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const l=this.freeTextures[s].shift();return this.usedTextures[s].push(l),l}let a;return i===Gi.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):i===Gi.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):i===Gi.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):i===Gi.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):i===Gi.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[s].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(e,n,r,i){if(this.freeTextures==null)return;const s=FU(r,i),o=LU(n,s,i);o in this.freeTextures||(this.freeTextures[o]=[]);const a=OU(n,s,this.gpgpu.gl,this.gpgpu.textureConfig,i),l=Ce().get("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e),this._numBytesAllocated-=a):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const c=this.usedTextures[o],u=c.indexOf(e);if(u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c.splice(u,1),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n)});for(const e in this.usedTextures)this.usedTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function Cxe(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function OU(t,e,n,r,i){const s=Txe(e,r);let o;if(i){const[l,c]=zm(t[0],t[1]);o=l*c}else{const[l,c]=ib(t[0],t[1]);o=l*c}const a=Cxe(n,s);return o*a}function Txe(t,e){switch(t){case Gi.PACKED_2X2_FLOAT32:return MU(e);case Gi.PACKED_2X2_FLOAT16:return IU(e);case Gi.UNPACKED_FLOAT32:return EU(e);case Gi.UNPACKED_FLOAT16:return kU(e);case Gi.PACKED_4X1_UNSIGNED_BYTE:return AU(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function Exe(t){return Ce().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Gi.PACKED_2X2_FLOAT32:Gi.UNPACKED_FLOAT32:t?Gi.PACKED_2X2_FLOAT16:Gi.UNPACKED_FLOAT16}function FU(t,e){if(t===Fo.UPLOAD)return Gi.PACKED_2X2_FLOAT32;if(t===Fo.RENDER||t==null)return Exe(e);if(t===Fo.DOWNLOAD||t===Fo.PIXELS)return Gi.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function LU(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qu{constructor(e,n){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=zs(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const el="if (isnan(x)) return x;",kxe="return x;",BU="return abs(x);",Axe="return (x >= 0.0) ? x : (exp(x) - 1.0);",Mxe=el+`
  return (x < 0.0) ? 0.0 : x;
`,Ixe=el+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,xC="return x;",Nxe="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $xe="return x;",Rxe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Dxe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Pxe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Oxe="return 1.0 / (1.0 + exp(-1.0 * x));";class qm{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=zs(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fxe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=zs(this.outputShape.length);const n=e.length,r=vs("rc",n),i=rr(n),s=wxe(n,r),o=r.slice(-2),a=n<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${i} rc = getOutputCoords();
        vec4 packedInput = getA(${s});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lxe=HS,Bxe=1e-7,zxe=1e-4,_C={};function Vxe(t){return t in _C||(_C[t]={}),_C[t]}const Uxe=Ce().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Wxe=600;function Gxe(){return Ce().global.screen==null?1024:Ce().global.screen.height*Ce().global.screen.width*window.devicePixelRatio*Wxe/1024/1024}class SC extends t_{constructor(e){super();if(this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!Ce().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(e==null){const n=jl(Ce().getNumber("WEBGL_VERSION"));this.binaryCache=Vxe(Ce().getNumber("WEBGL_VERSION")),this.gpgpu=new Dwe(n),this.canvas=n.canvas,this.gpgpuCreatedLocally=!0}else this.gpgpu=e,this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=e.gl.canvas;this.textureManager=new Sxe(this.gpgpu),this.numMBBeforeWarning=Gxe(),this.texData=new dM(this,Wu())}nextDataId(){return SC.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}write(e,n,r){if((Ce().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Ce().getBool("DEBUG"))&&this.checkNumericalProblems(e),r==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const i={id:this.nextDataId()};return this.texData.set(i,{shape:n,dtype:r,values:e,usage:Fo.UPLOAD,refCount:1}),i}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const n=this.texData.get(e);n.refCount++}decRef(e){if(this.texData.has(e)){const n=this.texData.get(e);n.refCount--}}move(e,n,r,i,s){if(Ce().getBool("DEBUG")&&this.checkNumericalProblems(n),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:r,dtype:i,values:n,usage:Fo.UPLOAD,refCount:s})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const n=this.texData.get(e),{values:r,dtype:i,complexTensorInfos:s,slice:o,shape:a,isPacked:l}=n;if(o!=null){let f;l?f=new qm(a,xC):f=new Qu(a,xC);const d=this.runWebGLProgram(f,[{dataId:e,shape:a,dtype:i}],i),p=this.readSync(d.dataId);return this.disposeIntermediateTensorInfo(d),p}if(r!=null)return this.convertAndCacheOnCPU(e);if(i==="string")return r;const c=this.activeTimers!=null;let u;c&&(u=ds());let h;if(i==="complex64"){const f=this.readSync(s.real.dataId),d=this.readSync(s.imag.dataId);h=Uc(f,d)}else h=this.getValuesFromTexture(e);return c&&(this.downloadWaitMs+=ds()-u),this.convertAndCacheOnCPU(e,h)}async read(e){if(this.pendingRead.has(e)){const p=this.pendingRead.get(e);return new Promise(m=>p.push(m))}const n=this.texData.get(e),{values:r,shape:i,slice:s,dtype:o,complexTensorInfos:a,isPacked:l}=n;if(s!=null){let p;l?p=new qm(i,xC):p=new Qu(i,xC);const m=this.runWebGLProgram(p,[{dataId:e,shape:i,dtype:o}],o),v=this.read(m.dataId);return this.disposeIntermediateTensorInfo(m),v}if(r!=null)return this.convertAndCacheOnCPU(e);if(Ce().getBool("DEBUG")&&!Ce().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Ce().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c=null,u;if(o!=="complex64"&&Ce().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(e);const p=this.texData.get(u.dataId);c=this.gpgpu.createBufferFromTexture(p.texture,...mC(i))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let h;if(o==="complex64"){const p=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),m=p[0],v=p[1];h=Uc(m,v)}else if(c==null)h=this.getValuesFromTexture(e);else{const p=_e(i);h=this.gpgpu.downloadFloat32MatrixFromBuffer(c,p)}if(u!=null&&this.disposeIntermediateTensorInfo(u),c!=null){const p=this.gpgpu.gl;St(p,()=>p.deleteBuffer(c))}const f=this.convertAndCacheOnCPU(e,h),d=this.pendingRead.get(e);return this.pendingRead.delete(e),d.forEach(p=>p(f)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Wu().removeDataId(e,this),this.pendingDeletes--),f}bufferSync(e){const n=this.readSync(e.dataId);let r=n;if(e.dtype==="string")try{r=n.map(i=>ff(i))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return mn(e.shape,e.dtype,r)}checkNumericalProblems(e){if(e!=null)for(let n=0;n<e.length;n++){const r=e[n];if(!J0e(r))throw Ce().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${r} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${r} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:n,dtype:r,isPacked:i}=this.texData.get(e),s=_e(n);if(Ce().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const f=this.decode(e),d=this.texData.get(f.dataId),p=this.gpgpu.downloadMatrixFromPackedTexture(d.texture,...mC(n)).subarray(0,s);return this.disposeIntermediateTensorInfo(f),p}const o=Ce().getBool("WEBGL_PACK")&&i===!0,a=o?ON(n):n,l=o?new mwe(a):new pwe(a),c=this.runWebGLProgram(l,[{shape:a,dtype:r,dataId:e}],"float32"),u=this.texData.get(c.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(u.texture,u.texShape[0],u.texShape[1]).subarray(0,s);return this.disposeIntermediateTensorInfo(c),h}timerAvailable(){return Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}async time(e){const n=this.activeTimers,r=[];let i=!1;this.programTimersStack==null?(this.programTimersStack=r,i=!0):this.activeTimers.push(r),this.activeTimers=r,e();const s=$c(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),o=$c(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=n,i&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};if(Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(s);a.kernelMs=pB(l),a.getExtraProfileInfo=()=>l.map((c,u)=>({name:o[u],ms:c})).map(c=>`${c.name}: ${c.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:ds(),endMs:null}}endTimer(e){return Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=ds(),e)}async getQueryTime(e){if(Ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const n=e;return n.endMs-n.startMs}disposeData(e,n=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(n?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!n&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:r}=this.texData.get(e);return r!=null&&(this.disposeData(r.real.dataId,n),this.disposeData(r.imag.dataId,n)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:n,dtype:r,texShape:i,usage:s,isPacked:o,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,c=this.dataRefCount.get(l);c>1?this.dataRefCount.set(l,c-1):(this.dataRefCount.delete(l),n!=null&&(this.numBytesInGPU-=this.computeBytes(i,r),this.textureManager.releaseTexture(n,i,s,o)));const u=this.texData.get(e);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,n=Uxe){return Ce().getBool("WEBGL_CPU_FORWARD")&&e.every(r=>this.texData.get(r.dataId).texture==null&&_e(r.shape)<n)}getGPGPUContext(){return this.gpgpu}where(e){ko("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=e.dataSync();return Lxe(e.shape,n)}packedUnaryOp(e,n,r){const i=new qm(e.shape,n),s=this.compileAndRun(i,[e],r);return Wu().makeTensorFromDataId(s.dataId,s.shape,s.dtype)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const i=$U(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,i)}if(Ce().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,BU,e.dtype);const n=new Qu(e.shape,BU),r=this.compileAndRun(n,[e]);return Wu().makeTensorFromDataId(r.dataId,r.shape,r.dtype)}makeTensorInfo(e,n,r){let i;if(n==="string"&&r!=null&&r.length>0&&Ol(r[0])){const s=r.map(o=>Fl(o));i=this.write(s,e,n)}else i=this.write(r,e,n);return this.texData.get(i).usage=null,{dataId:i,shape:e,dtype:n}}makeOutput(e,n,r){const{dataId:i}=this.makeTensorInfo(e,n,r);return Wu().makeTensorFromDataId(i,e,n,this)}unpackTensor(e){const n=new Fxe(e.shape);return this.runWebGLProgram(n,[e],e.dtype)}packTensor(e){const n=new xxe(e.shape),r=!0;return this.runWebGLProgram(n,[e],e.dtype,null,r)}packedReshape(e,n){const r=[Vm(e.shape),...Um(e.shape)],i={dtype:e.dtype,shape:r,dataId:e.dataId},s=[Vm(n),...Um(n)],o=new PU(s,r),a=!0,l=[r],c=this.runWebGLProgram(o,[i],e.dtype,l,a);return{dataId:c.dataId,shape:n,dtype:c.dtype}}decode(e){const n=this.texData.get(e),{isPacked:r,shape:i,dtype:s}=n,o=ON(i);let a;const l=mC(o);r?a=new dwe(o):a=new fwe(o);const c=!0,u=[l],h=this.runWebGLProgram(a,[{shape:o,dtype:s,dataId:e}],s,u,c);return{dtype:s,shape:i,dataId:h.dataId}}runWebGLProgram(e,n,r,i,s=!1){const o=this.makeTensorInfo(e.outputShape,r),a=this.texData.get(o.dataId);if(e.packedOutput&&(a.isPacked=!0),e.outPackingScheme===rb.DENSE){const v=mC(e.outputShape);a.texShape=v.map(y=>y*2)}if(e.outTexUsage!=null&&(a.usage=e.outTexUsage),_e(o.shape)===0)return a.values=fi(o.dtype,0),o;const l=[],c=n.map(v=>{if(v.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let y=this.texData.get(v.dataId);if(y.texture==null){if(!e.packedInputs&&_e(v.shape)<=Ce().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:v.shape,texData:null,isUniform:!0,uniformValues:y.values};e.packedInputs&&(y.isPacked=!0,y.shape=v.shape)}if(this.uploadToGPU(v.dataId),!!y.isPacked!=!!e.packedInputs)v=y.isPacked?this.unpackTensor(v):this.packTensor(v),l.push(v),y=this.texData.get(v.dataId);else if(y.isPacked&&!bC(y.shape,v.shape)){const w=v,x=v.shape;v.shape=y.shape,v=this.packedReshape(v,x),l.push(v),y=this.texData.get(v.dataId),w.shape=x}return{shape:v.shape,texData:y,isUniform:!1}});this.uploadToGPU(o.dataId);const u={shape:o.shape,texData:a,isUniform:!1},h=hwe(e,c,u),f=this.getAndSaveBinary(h,()=>cwe(this.gpgpu,e,c,u)),d=this.activeTimers!=null;let p;d&&(p=this.startTimer()),uwe(this.gpgpu,f,c,u,i),l.forEach(v=>this.disposeIntermediateTensorInfo(v)),d&&(p=this.endTimer(p),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(p)}));const m=Ce().get("WEBGL_FLUSH_THRESHOLD");if(m>0){const v=ds();v-this.lastGlFlushTime>m&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=v)}if(!Ce().getBool("WEBGL_LAZILY_UNPACK")&&a.isPacked&&s===!1){const v=this.unpackTensor(o);return this.disposeIntermediateTensorInfo(o),v}return o}compileAndRun(e,n,r,i,s=!1){return r=r||n[0].dtype,this.runWebGLProgram(e,n,r,i,s)}getAndSaveBinary(e,n){return e in this.binaryCache||(this.binaryCache[e]=n()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(Ce().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement!="undefined"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=de(()=>{if(!Ce().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=Ce().getBool("DEBUG");Ce().set("DEBUG",!1);const n=this.abs(Nt(1e-8)).dataSync()[0];if(Ce().set("DEBUG",e),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?Bxe:zxe}uploadToGPU(e){const n=this.texData.get(e),{shape:r,dtype:i,values:s,texture:o,usage:a,isPacked:l}=n;if(o!=null)return;const c=this.activeTimers!=null;let u;c&&(u=ds());let h=n.texShape;if(h==null&&(h=vbe(r,l),n.texShape=h),s!=null){const f=ON(r);let d,p=h[1],m=h[0];const v=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(l||!v)&&([p,m]=zm(h[0],h[1])),l?d=new vwe(f,v):d=new gwe(f,v);const y=v?[m,p]:h,w=this.makeTensorInfo(y,i),x=this.texData.get(w.dataId);v?x.usage=Fo.PIXELS:x.usage=Fo.UPLOAD,x.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),p,m,s);const _=[[m,p]],S=!0,T=this.runWebGLProgram(d,[w],i,_,S),E=this.texData.get(T.dataId);n.texture=E.texture,n.texShape=E.texShape,n.isPacked=E.isPacked,n.usage=E.usage,this.disposeIntermediateTensorInfo(w),this.texData.delete(T.dataId),n.values=null,c&&(this.uploadWaitMs+=ds()-u)}else{const f=this.acquireTexture(h,a,i,l);n.texture=f}}convertAndCacheOnCPU(e,n){const r=this.texData.get(e),{dtype:i}=r;return this.releaseGPUData(e),n!=null&&(r.values=Hxe(n,i)),r.values}acquireTexture(e,n,r,i){if(this.numBytesInGPU+=this.computeBytes(e,r),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${s} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,n,i)}computeBytes(e,n){return e[0]*e[1]*r_(n)}}SC.nextDataId=0;function Hxe(t,e){if(e==="float32"||e==="complex64")return t;if(e==="int32"||e==="bool"){const n=e==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let r=0;r<n.length;++r)n[r]=Math.round(t[r]);return n}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */VM()&&mI("webgl",()=>new SC,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zU=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Xm{constructor(e,n,r){this.variableNames=["A","B"],this.outputShape=Qt(n,r),this.enableShapeUniforms=zs(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CC=`
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;
`;class ab{constructor(e,n,r,i=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Qt(n,r);const s=this.outputShape.length;this.enableShapeUniforms=zs(s);let o="";if(i)if(s===0||_e(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${rr(s)} coords = getOutputCoords();
        `,s===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=vs("coords",s);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${l[s-2]} + 1) >= outShape[${s} - 2];
            bool nextColOutOfBounds =
              (${l[s-1]} + 1) >= outShape[${s} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${l[s-2]} + 1) >= ${this.outputShape[s-2]};
            bool nextColOutOfBounds =
              (${l[s-1]} + 1) >= ${this.outputShape[s-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lo(t){const{inputs:e,backend:n}=t,{x:r}=e;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const jxe={kernelName:Up,backendName:"webgl",kernelFunc:lo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eh(t){const{inputs:e,backend:n}=t,{real:r,imag:i}=e,s=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(s.dataId),a=lo({inputs:{x:r},backend:n}),l=lo({inputs:{x:i},backend:n});return o.complexTensorInfos={real:a,imag:l},s}const qxe={kernelName:f_,backendName:"webgl",kernelFunc:eh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VU="return (a < 0.) ? b * a : a;",UU=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Xxe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{alpha:s}=r,o=n.makeTensorInfo([],"float32",Dc(s,"float32")),a=Ce().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ab(UU,i.shape,o.shape):new Xm(VU,i.shape,o.shape),l=n.runWebGLProgram(a,[i,o],"float32");return n.disposeIntermediateTensorInfo(o),l}const Kxe={kernelName:Gy,backendName:"webgl",kernelFunc:Xxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WU="return (a < 0.) ? b * a : a;",GU=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Yxe(t){const{inputs:e,backend:n}=t,{x:r,alpha:i}=e,s=Ce().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ab(GU,r.shape,i.shape):new Xm(WU,r.shape,i.shape);return n.runWebGLProgram(s,[r,i],"float32")}const Zxe={kernelName:c0,backendName:"webgl",kernelFunc:Yxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HU="if (isnan(x)) return x;",Jxe=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,Qxe=`
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;
`;function Rn({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:r}){return({inputs:i,backend:s})=>{const{x:o}=i,a=s,l=r||o.dtype;if(a.shouldExecuteOnCPU([o])&&n!=null){const h=a.texData.get(o.dataId),f=n(h.values,l);return a.makeTensorInfo(o.shape,l,f)}const c=Ce().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let u;return c?u=new qm(o.shape,e):u=new Qu(o.shape,t),a.runWebGLProgram(u,[o],l)}}function Hi({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:r=!1,cpuKernelImpl:i,dtype:s}){return({inputs:o,backend:a})=>{const{a:l,b:c}=o,u=a;if(r&&l.dtype==="complex64"){const p=u.texData.get(l.dataId),m=u.texData.get(c.dataId),[v,y]=[[p.complexTensorInfos.real,m.complexTensorInfos.real],[p.complexTensorInfos.imag,m.complexTensorInfos.imag]].map(x=>{const[_,S]=x,T={dataId:_.dataId,dtype:_.dtype,shape:l.shape},E={dataId:S.dataId,dtype:S.dtype,shape:c.shape},k=new Xm(t,l.shape,c.shape);return u.runWebGLProgram(k,[T,E],eo(_.dtype,S.dtype))}),w=eh({inputs:{real:v,imag:y},backend:u});return u.disposeIntermediateTensorInfo(v),u.disposeIntermediateTensorInfo(y),w}const h=s||eo(l.dtype,c.dtype);if((l.dtype==="string"||c.dtype==="string"||u.shouldExecuteOnCPU([l,c]))&&i!=null){const p=u.texData.get(l.dataId).values,m=u.texData.get(c.dataId).values,v=l.dtype==="string"?Cf(p):p,y=l.dtype==="string"?Cf(m):m,[w,x]=i(l.shape,c.shape,v,y,h),_=u.makeTensorInfo(x,h),S=u.texData.get(_.dataId);return S.values=w,_}const f=Ce().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let d;return f?d=new ab(e,l.shape,c.shape,n):d=new Xm(t,l.shape,c.shape),u.runWebGLProgram(d,[l,c],h)}}function TC(t,e=!1){if(t==="linear")return e?$xe:kxe;if(t==="relu")return e?Dxe:Mxe;if(t==="elu")return e?Rxe:Axe;if(t==="relu6")return e?Pxe:Ixe;if(t==="prelu")return e?GU:WU;if(t==="leakyrelu")return e?UU:VU;if(t==="sigmoid")return e?Oxe:Nxe;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jU{constructor(e,n,r,i=!1,s=!1,o=!1,a=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=zs(this.outputShape.length);const u=i?e[1]:e[2],h=Math.ceil(u/2),f=i?"i * 2, rc.y":"rc.y, i * 2",d=s?"rc.z, i * 2":"i * 2, rc.z",p=i?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=s?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let v="",y="";a&&(l?v=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?v=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:v=`vec4 activation(vec4 x) {
          ${a}
        }`,y="result = activation(result);");const w=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let x="rc.x",_="rc.x";e[0]<n[0]?x=`int(min(float(rc.x), ${e[0]-1}.))`:n[0]<e[0]&&(_=`int(min(float(rc.x), ${n[0]-1}.))`),this.userCode=`
      ${v}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${h}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < ${h}; i++) {
          int batchA = ${x};
          int batchB = ${_};
          vec4 a = getMatrixA(batchA, ${f});
          vec4 b = getMatrixB(batchB, ${d});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${p[0]} * ${m[0]});
          result += (${p[1]} * ${m[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${w}

        ${y}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qU={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class XU{constructor(e,n,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Qt(n,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KU="return a * b;";function GN(t){const{inputs:e,backend:n}=t,{a:r,b:i}=e,s=eo(r.dtype,i.dtype);if(r.dtype==="complex64"){const a=n.texData.get(r.dataId),l=n.texData.get(i.dataId),c=new XU(qU.REAL,r.shape,i.shape),u=new XU(qU.IMAG,r.shape,i.shape),h=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:r.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:i.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:i.shape}],f=n.runWebGLProgram(c,h,"float32"),d=n.runWebGLProgram(u,h,"float32"),p=eh({inputs:{real:f,imag:d},backend:n});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),p}if(n.shouldExecuteOnCPU([r,i])){const a=n.texData.get(r.dataId),l=n.texData.get(i.dataId),[c,u]=txe(r.shape,i.shape,a.values,l.values,s),h=n.makeTensorInfo(u,s),f=n.texData.get(h.dataId);return f.values=c,h}let o;return Ce().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new ab(KU,r.shape,i.shape):o=new Xm(KU,r.shape,i.shape),n.runWebGLProgram(o,[r,i],s)}const e1e={kernelName:Zp,backendName:"webgl",kernelFunc:GN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t1e(t,e,n){const r=[Vm(t.shape),...Um(t.shape)],i={dtype:t.dtype,shape:r,dataId:t.dataId},s=[Vm(e),...Um(e)],o=new PU(s,r),a=!0,l=[r],c=n.runWebGLProgram(o,[i],t.dtype,l,a);return{dataId:c.dataId,shape:e,dtype:c.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ct(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{shape:s}=r,o=n,a=_e(i.shape),l=vM(s,a),c=_e(l);z(a===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${i.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const u=o.texData.get(i.dataId);return u.isPacked&&!bC(i.shape,l)&&!(u.texture!==null&&bC(u.shape,l))?t1e(i,l,o):(o.incRef(i.dataId),{dataId:i.dataId,shape:l,dtype:i.dtype})}const n1e={kernelName:u0,backendName:"webgl",kernelFunc:ct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YU{constructor(e,n){this.variableNames=["x"];const{windowSize:r,batchSize:i,inSize:s,outSize:o}=e;this.outputShape=[i,o];const a=Math.floor(r/4)*4,l=r%4;let c="sumValue += dot(values, ones);";if(n!=null){const h=1/n;c=`sumValue += dot(values * ${sf(h)?h.toPrecision(2):h}, ones);`}let u="";s%r>0&&(u=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${u}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class r1e{constructor(e,n){this.variableNames=["x"];const{windowSize:r,batchSize:i,inSize:s,outSize:o}=e;this.outputShape=[i,o];let a="0.0",l="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",l="min"):n==="max"&&(a="-1.0 / 1e-20",l="max");let c=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?c="sumValue":n==="prod"?c="prodValue":n==="all"?c="allValue":n==="any"&&(c="anyValue");const u=Math.floor(r/4)*4,h=r%4;let f=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,d="vec4";n==="all"?(a="1.0",f=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):n==="any"&&(a="0.0",f=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");let p="";s%r>0&&(p=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${f}
        }

        int inIdx = inOffset + ${u};
        if (${h===1}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${h===2}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${h===3}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${f}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i1e(t){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const n=e.length?e[e.length-1].outSize:t[1],r=aC(n);e.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return e}function If(t,e,n,r){const i=i1e(t.shape);let s=t;for(let o=0;o<i.length;o++){const{inSize:a,windowSize:l,outSize:c}=i[o];let u,h;n==="mean"?u=o===0?new YU({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},a):new YU({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c}):u=new r1e({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},n),h=s,s=r.runWebGLProgram(u,[s],e),h.dataId!==t.dataId&&r.disposeIntermediateTensorInfo(h)}return s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class s1e{constructor(e,n){this.variableNames=["A"];const r=new Array(e.length);for(let o=0;o<r.length;o++)r[o]=e[n[o]];this.outputShape=r,this.rank=r.length;const i=rr(this.rank),s=o1e(n);this.userCode=`
    void main() {
      ${i} resRC = getOutputCoords();
      setOutput(getA(${s}));
    }
    `}}function o1e(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e);for(let i=0;i<t.length;i++)r[t[i]]=n[i];return r.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a1e{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const r=new Array(e.length);for(let u=0;u<r.length;u++)r[u]=e[n[u]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const i=rr(this.rank),s=DU("rc",this.rank),o=new Array(this.rank);for(let u=0;u<n.length;u++)o[n[u]]=s[u];const a=`vec2(${o.slice(-2).join()})`,l=`++${s[this.rank-1]} < ${r[this.rank-1]}`,c=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${i} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${s[this.rank-1]};
      if(++${s[this.rank-2]} < ${r[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EC(t,e,n){const r=Ce().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new a1e(t.shape,e):new s1e(t.shape,e);return n.runWebGLProgram(r,[t],t.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l1e(t,e,n,r){const i=e,s=t.shape.length,o=hn(i,t.shape);let a=o;const l=Hr(a,s),c=l!=null;let u=t;c&&(u=EC(t,l,r),a=si(a.length,s)),Wi("sum",a,s);const[h,f]=Mi(u.shape,a);let d=h;n&&(d=Gr(h,o));const p=_e(f),v=_e(t.shape)/p,y=ct({inputs:{x:u},attrs:{shape:[v,p]},backend:r}),w=pS(t.dtype),x=If(y,w,"sum",r),_=ct({inputs:{x},attrs:{shape:d},backend:r});return r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(x),c&&r.disposeIntermediateTensorInfo(u),_}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kC(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;return l1e(i,s,o,n)}const c1e={kernelName:g0,backendName:"webgl",kernelFunc:kC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ys(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{perm:s}=r,o=n,a=i.shape.length,l=new Array(a);for(let u=0;u<l.length;u++)l[u]=i.shape[s[u]];let c;if(o.shouldExecuteOnCPU([i])){const h=o.texData.get(i.dataId).values,f=WN(h,i.shape,i.dtype,s,l);c=o.makeTensorInfo(l,i.dtype);const d=o.texData.get(c.dataId);d.values=f}else c=EC(i,s,o);return c}const u1e={kernelName:w0,backendName:"webgl",kernelFunc:ys};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZU=1e3;function AC({a:t,b:e,transposeA:n,transposeB:r,backend:i,bias:s=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const c=t.shape.length,u=e.shape.length,h=n?t.shape[c-2]:t.shape[c-1],f=r?e.shape[u-1]:e.shape[u-2],d=n?t.shape[c-1]:t.shape[c-2],p=r?e.shape[u-2]:e.shape[u-1],m=t.shape.slice(0,-2),v=e.shape.slice(0,-2),y=_e(m),w=_e(v),_=Qt(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([d,p]);z(h===f,()=>`Error in matMul: inner shapes (${h}) and (${f}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${r} must match.`);const S=n?[y,h,d]:[y,d,h],T=r?[w,p,f]:[w,f,p],E=ct({inputs:{x:t},backend:i,attrs:{shape:S}}),k=ct({inputs:{x:e},backend:i,attrs:{shape:T}}),A=[E,k],M=Math.max(y,w),D=n?E.shape[1]:E.shape[2],P=s!=null,N=o!=null,R=l==="leakyrelu",F=l!=null?TC(l,!0):null,O=P||N||R||F!=null;let K;if((d===1||p===1)&&D>ZU&&O===!1){let re=E,ae=k;n&&(re=ys({inputs:{x:E},backend:i,attrs:{perm:[0,2,1]}}),A.push(re)),r&&(ae=ys({inputs:{x:k},backend:i,attrs:{perm:[0,2,1]}}),A.push(ae));const pe=p!==1,ke=p===1;let Te=re;pe&&(Te=ct({inputs:{x:re},backend:i,attrs:{shape:[M,D,1]}}),A.push(Te));const Ne=p===1?2:1;let we=ae;ke&&(we=ct({inputs:{x:ae},backend:i,attrs:{shape:[M,1,D]}}),A.push(we));const me=GN({inputs:{a:Te,b:we},backend:i});K=kC({inputs:{x:me},backend:i,attrs:{axis:Ne,keepDims:!0}}),A.push(me)}else{const re=eo(t.dtype,e.dtype),ae=new jU(S,T,[M,d,p],n,r,P,F,N,R),pe=[E,k];if(s!=null&&pe.push(s),N&&pe.push(o),R){const ke=i.makeTensorInfo([],"float32",Dc(a,"float32"));pe.push(ke),A.push(ke)}K=i.runWebGLProgram(ae,pe,re)}const J=ct({inputs:{x:K},backend:i,attrs:{shape:_}});A.push(K);for(const re of A)i.disposeIntermediateTensorInfo(re);return J}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h1e(t){const{inputs:e,backend:n,attrs:r}=t,{a:i,b:s,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:h}=r;return AC({a:i,b:s,transposeA:l,transposeB:c,backend:n,bias:o,preluActivationWeights:a,leakyreluAlpha:h,activation:u})}const f1e={kernelName:C0,backendName:"webgl",kernelFunc:h1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JU="return abs(x);";function d1e(t){const{inputs:e,backend:n}=t,{x:r}=e;if(n.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){const s=n.texData.get(r.dataId),o=$U(s.values);return n.makeTensorInfo(r.shape,r.dtype,o)}let i;return Ce().getBool("WEBGL_PACK_UNARY_OPERATIONS")?i=new qm(r.shape,JU):i=new Qu(r.shape,JU),n.runWebGLProgram(i,[r],r.dtype)}const p1e={kernelName:Sy,backendName:"webgl",kernelFunc:d1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m1e=el+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,g1e=Rn({opSnippet:m1e}),v1e={kernelName:_p,backendName:"webgl",kernelFunc:g1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y1e=el+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,b1e=Rn({opSnippet:y1e}),w1e={kernelName:Sp,backendName:"webgl",kernelFunc:b1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QU="return a + b;",x1e=Hi({opSnippet:QU,packedOpSnippet:QU,supportsComplex:!0,cpuKernelImpl:Owe}),_1e={kernelName:af,backendName:"webgl",kernelFunc:x1e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class S1e{constructor(e,n){this.outputShape=[],this.outputShape=e,this.variableNames=n.map((s,o)=>`T${o}`);const r=[];this.variableNames.forEach(s=>{r.push(`float v${s} = get${s}AtOutCoords();`)});const i=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        float result = ${i};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class C1e{constructor(e,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=n.map((s,o)=>`T${o}`);const r=[];this.variableNames.forEach(s=>{r.push(`vec4 v${s} = get${s}AtOutCoords();`)});const i=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        vec4 result = ${i};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MC(t){const{inputs:e,backend:n}=t,r=e;if(r.length===1)return lo({inputs:{x:r[0]},backend:n});if(r.length>Ce().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(r.length/2),c=MC({inputs:r.slice(0,l),backend:n}),u=MC({inputs:r.slice(l),backend:n});return MC({inputs:[c,u],backend:n})}const i=r.map(l=>l.dtype).reduce((l,c)=>eo(l,c)),s=r.map(l=>l.shape),a=Ce().getBool("WEBGL_PACK")?new C1e(r[0].shape,s):new S1e(r[0].shape,s);return n.runWebGLProgram(a,r,i)}const T1e={kernelName:Cy,backendName:"webgl",kernelFunc:MC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E1e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r,a=i.shape.length,l=hn(s,i.shape);let c=l;const u=Hr(c,a);let h=i;u!=null&&(h=ys({inputs:{x:i},backend:n,attrs:{perm:u}}),c=si(c.length,a)),Wi("all",c,a);const[f,d]=Mi(h.shape,c),p=_e(d),m=ct({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}}),v=If(m,m.dtype,"all",n);let y;if(o){const w=Gr(f,l);y=ct({inputs:{x:v},backend:n,attrs:{shape:w}})}else y=ct({inputs:{x:v},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),u!=null&&n.disposeIntermediateTensorInfo(h),y}const k1e={kernelName:o_,backendName:"webgl",kernelFunc:E1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A1e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r,a=i.shape.length,l=hn(s,i.shape);let c=l;const u=Hr(c,a);let h=i;u!=null&&(h=ys({inputs:{x:i},backend:n,attrs:{perm:u}}),c=si(c.length,a)),Wi("any",c,a);const[f,d]=Mi(h.shape,c),p=_e(d),m=ct({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}}),v=If(m,m.dtype,"any",n);let y;if(o){const w=Gr(f,l);y=ct({inputs:{x:v},backend:n,attrs:{shape:w}})}else y=ct({inputs:{x:v},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),u!=null&&n.disposeIntermediateTensorInfo(h),y}const M1e={kernelName:a_,backendName:"webgl",kernelFunc:A1e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class I1e{constructor(e,n,r){this.variableNames=["A"];const{windowSize:i,batchSize:s,outSize:o}=e;r||this.variableNames.push("bestIndicesA"),this.outputShape=[s,o];const a=n==="max"?">":"<",l=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${i};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${i}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class N1e{constructor(e,n,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,z(e.length>2,()=>`Packed arg${r.charAt(0).toUpperCase()+r.slice(1)} supports only inputs with rank above 2.`);const s=e[e.length-1],o=Math.ceil(s/n);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),i||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,c=rr(l),u=vs("coords",l);let h,f;if(o===1){f=l+1;const k=rr(f);h=`
        ${k} sourceLocR = ${k}(${u.join()}, 0);
        ++${u[l-1]};
        ${k} sourceLocG = ${k}(${u.join()}, 0);
        ++${u[l-2]};
        ${k} sourceLocA = ${k}(${u.join()}, 0);
        --${u[l-1]};
        ${k} sourceLocB = ${k}(${u.join()}, 0);
        --${u[l-2]};`}else f=l,h=`
        ${c} sourceLocR = coords;
        ++${u[l-1]};
        ${c} sourceLocG = coords;
        ++${u[l-2]};
        ${c} sourceLocA = coords;
        --${u[l-1]};
        ${c} sourceLocB = coords;
        --${u[l-2]};`;const d=["x","y","z","w","u","v"].slice(0,f),p="."+d[f-1],m=d.map(k=>"int "+k),v=vs("sourceLocR",f-1).concat("inIdx.r"),y=vs("sourceLocG",f-1).concat("inIdx.g"),w=vs("sourceLocB",f-1).concat("inIdx.b"),x=vs("sourceLocA",f-1).concat("inIdx.a"),_=r==="max"?"greaterThan":"lessThan",S=i?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${v.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${w.join()}),
                             getBestIndicesAChannel(${x.join()})));`,T=`vec4(
            getAChannel(${v.join()}),
            hasNextCol ? getAChannel(${y.join()}) : 0.,
            hasNextRow ? getAChannel(${w.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${x.join()}) : 0.)`,E=i?"":`
      float getBestIndicesAChannel(${m.join()}) {
        return getChannel(getBestIndicesA(${d.join()}),
                                          vec2(${d.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${m.join()}) {
        return getChannel(getA(${d.join()}),
                               vec2(${d.slice(-2).join()}));
      }
      ${E}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${u[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${u[l-2]} < ${a[l-2]-1};
        ${h}
        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},
          sourceLocB${p}, sourceLocA${p}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${T};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${S}
          vec4 candidate = ${T};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${_}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eW(t,e,n,r=null){let i=e.shape[0],s=e.shape[1];r!=null&&(i=r.shape[0],s=r.shape[1]);const o=aC(s),a={windowSize:o,inSize:s,batchSize:i,outSize:Math.ceil(s/o)},l=new I1e(a,n,r==null),c=[e];r!=null&&c.push(r);const u=t.runWebGLProgram(l,c,"int32");if(u.shape[1]===1)return u;const h=eW(t,e,n,u);return t.disposeIntermediateTensorInfo(u),h}function tW(t,e,n,r=null){const i=r!=null?r.shape:e.shape,s=i[i.length-1],o=aC(s),a=new N1e(i,o,n,r==null),l=r==null?[e]:[e,r],c=t.runWebGLProgram(a,l,"int32");if(c.shape.length===e.shape.length){const u=tW(t,e,n,c);return t.disposeIntermediateTensorInfo(c),u}return c}function nW(t,e,n,r){const i=[n];if(Wi("arg"+r.charAt(0).toUpperCase()+r.slice(1),i,e.shape.length),!Ce().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const s=[],o=t.texData.get(e.dataId),a=o!==null&&o.isPacked;let l=e;a&&(l=t.unpackTensor(e),s.push(l));const[c,u]=Mi(l.shape,i),h=_e(u),f=ct({inputs:{x:l},backend:t,attrs:{shape:[-1,h]}});s.push(f);const d=eW(t,f,r);s.push(d);const p=ct({inputs:{x:d},backend:t,attrs:{shape:c}});return s.forEach(m=>t.disposeIntermediateTensorInfo(m)),p}return tW(t,e,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $1e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s}=r;let o=hn(s,i.shape);const a=Hr(o,i.shape.length);let l=i;const c=[];a!=null&&(l=ys({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(l),o=si(o.length,l.shape.length)),Wi("argMax",[o[0]],l.shape.length);const u=nW(n,l,o[0],"max");return c.forEach(h=>n.disposeIntermediateTensorInfo(h)),u}const R1e={kernelName:Ty,backendName:"webgl",kernelFunc:$1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D1e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s}=r;let o=hn(s,i.shape);const a=Hr(o,i.shape.length);let l=i;const c=[];a!=null&&(l=ys({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(l),o=si(o.length,l.shape.length)),Wi("argMin",[o[0]],l.shape.length);const u=nW(n,l,o[0],"min");return c.forEach(h=>n.disposeIntermediateTensorInfo(h)),u}const P1e={kernelName:Ey,backendName:"webgl",kernelFunc:D1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O1e=el+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,F1e=Rn({opSnippet:O1e}),L1e={kernelName:Cp,backendName:"webgl",kernelFunc:F1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B1e=el+"return log(x + sqrt(x * x + 1.0));",z1e=Rn({opSnippet:B1e}),V1e={kernelName:Tp,backendName:"webgl",kernelFunc:z1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U1e=el+`
  return atan(x);
`,W1e=Rn({opSnippet:U1e}),G1e={kernelName:Ep,backendName:"webgl",kernelFunc:W1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H1e=Jxe+`
  return atan(a, b);
`,j1e=`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+Qxe+`
  return result;
`,q1e=Hi({opSnippet:H1e,packedOpSnippet:j1e}),X1e={kernelName:Ap,backendName:"webgl",kernelFunc:q1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K1e=el+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Y1e=Rn({opSnippet:K1e}),Z1e={kernelName:kp,backendName:"webgl",kernelFunc:Y1e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lb{constructor(e,n,r,i=!1,s=!1){if(this.variableNames=["x"],n==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,u=e.dilationWidth,h=e.effectiveFilterHeight,f=e.effectiveFilterWidth,d=e.padInfo.top,p=e.padInfo.left;this.outputShape=e.outShape;const m=n==="avg",v=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,y=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let w="0.0";if(m||(w="-1.0 / 1e-20"),r){const k=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${d}, ${p});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${h};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f};
                wC += ${u}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${k} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${i?s?v:y:`wR * ${f} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const x="max";let _=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(_="avgValue / count");const S=Math.floor(o/4)*4,T=o%4,E=`
      if (${m}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${x}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${d}, ${p});
      const float initializationValue = ${w};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${w});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${h};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${S}; wC += 4) {
            int xC = xCCorner + wC * ${u};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              getValue(batch, xR, xC + 3 * ${u}, d)
            );

            ${E}
          }

          int xC = xCCorner + ${S};
          if (${T===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${E}
          } else if (${T===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              initializationValue,
              initializationValue
            );

            ${E}
          } else if (${T===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              initializationValue
            );

            ${E}
          }
        }
        setOutput(${_});
      }
    `}}class HN{constructor(e,n,r,i=!1,s=!1){if(this.variableNames=["x"],n==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideDepth,l=e.strideHeight,c=e.strideWidth,u=e.dilationDepth,h=e.dilationHeight,f=e.dilationWidth,d=e.effectiveFilterDepth,p=e.effectiveFilterHeight,m=e.effectiveFilterWidth,v=e.padInfo.front,y=e.padInfo.top,w=e.padInfo.left;this.outputShape=e.outShape;const x=n==="avg";let _="0.0";if(x||(_="-1.0 / 1e-20"),r){const M=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${c});
        const ivec3 pads = ivec3(${v}, ${y}, ${w});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${d};
              wD += ${u}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${p};
                wR += ${h}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${m};
                  wC += ${f}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${M} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${i?s?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${p} * ${m} +
                      wR * ${m} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const S="max";let T=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(T="avgValue / count");const E=Math.floor(o/4)*4,k=o%4,A=`
      if (${x}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${c});
      const ivec3 pads = ivec3(${v}, ${y}, ${w});
      const float initializationValue = ${_};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${_});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${u}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p};
            wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${E}; wC += 4) {
              int xC = xCCorner + wC * ${f};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                getValue(batch, xD, xR, xC + 3 * ${f}, ch)
              );

              ${A}
            }

            int xC = xCCorner + ${E};
            if (${k===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${A}
            } else if (${k===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                initializationValue,
                initializationValue
              );

              ${A}
            } else if (${k===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                initializationValue
              );

              ${A}
            }
          }
          setOutput(${T});
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J1e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;sb(i,"avgPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:l}=r,c=1;z(Ui(o,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const u=ca(i.shape,s,o,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&wn(u.inShape,u.outShape))return lo({inputs:{x:i},backend:n});const h=new lb(u,"avg",!1);return n.runWebGLProgram(h,[i],"float32")}const Q1e={kernelName:ky,backendName:"webgl",kernelFunc:J1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e_e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{filterSize:s,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=r,u=[1,1,1],h=Fc(i.shape,s,o,u,a,l,c),f=new HN(h,"avg",!1);return n.runWebGLProgram(f,[i],"float32")}const t_e={kernelName:Ay,backendName:"webgl",kernelFunc:e_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n_e{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterHeight,r=e.filterWidth,i=e.strideHeight,s=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,u=l-1-e.padInfo.top,h=c-1-e.padInfo.left,f=1/(n*r);this.userCode=`
      const ivec2 pads = ivec2(${u}, ${h});
      const float avgMultiplier = float(${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class r_e{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterDepth,r=e.filterHeight,i=e.filterWidth,s=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,h=e.effectiveFilterDepth,f=e.effectiveFilterHeight,d=e.effectiveFilterWidth,p=h-1-e.padInfo.front,m=f-1-e.padInfo.top,v=d-1-e.padInfo.left,y=1/(n*r*i);this.userCode=`
      const ivec3 pads = ivec3(${p}, ${m}, ${v});
      const float avgMultiplier = float(${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${s}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${f};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i_e(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,o=s,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,h=[1,1,1],f=Fc(o.shape,a,l,h,c,u),d=new r_e(f);return n.runWebGLProgram(d,[i],o.dtype)}const s_e={kernelName:c_,backendName:"webgl",kernelFunc:i_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o_e(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,o=s;sb([i,s],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=r,u=ca(o.shape,a,l,1,c),h=new n_e(u);return n.runWebGLProgram(h,[i],o.dtype)}const a_e={kernelName:l_,backendName:"webgl",kernelFunc:o_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l_e(t){const{inputs:e,backend:n,attrs:r}=t,{a:i,b:s}=e,{transposeA:o,transposeB:a}=r;return AC({a:i,b:s,transposeA:o,transposeB:a,backend:n})}const c_e={kernelName:My,backendName:"webgl",kernelFunc:l_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class u_e{constructor(e,n,r,i,s,o){this.outputShape=[],this.variableNames=["x","mean","variance"],Qt(e,n),Qt(e,r);let a="0.0";i!=null&&(Qt(e,i),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";s!=null&&(Qt(e,s),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h_e{constructor(e,n,r,i,s,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Qt(e,n),Qt(e,r);let a="vec4(0.0)";i!=null&&(Qt(e,i),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";s!=null&&(Qt(e,s),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f_e=({inputs:t,backend:e,attrs:n})=>{const{x:r,mean:i,variance:s,offset:o,scale:a}=t;z(i.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),z(o==null||i.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),z(a==null||i.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=n;l==null&&(l=.001);const c=[r,i,s];let u=null;o!=null&&(u=o.shape,c.push(o));let h=null;a!=null&&(h=a.shape,c.push(a));const f=Ce().getBool("WEBGL_PACK_NORMALIZATION")?new h_e(r.shape,i.shape,s.shape,u,h,l):new u_e(r.shape,i.shape,s.shape,u,h,l);return e.runWebGLProgram(f,c,c[0].dtype)},d_e={kernelName:Vy,backendName:"webgl",kernelFunc:f_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p_e{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const n=rr(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const r=m_e(this.rank);let i;const s=e.map((o,a)=>`sourceLoc.${jN[a]} = start[${a}] + coords.${jN[a]};`);i=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${s.join(`
`)}
      `,this.userCode=`
      void main() {
        ${i}
        setOutput(getSource(${r}));
      }
    `}}const jN=["x","y","z","w","u","v"];function m_e(t){if(t===1)return"sourceLoc";if(t<=6)return jN.slice(0,t).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g_e{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=rr(this.rank),r=vs("coords",this.rank),i=vs("sourceLoc",this.rank),s=this.rank===1?"sourceLoc":`vec2(${i.slice(-2).join()})`,o=`getChannel(getSource(${i.join()}), ${s})`,a=`
      result.x = ${o};
      if (++${r[this.rank-1]} < ${e[this.rank-1]}) {
        ++${i[this.rank-1]};
        result.y = ${o};
        --${i[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${r[this.rank-1]};
      if (++${r[this.rank-2]} < ${e[this.rank-2]}) {
        ++${i[this.rank-2]};
        result.z = ${o};
        if (++${r[this.rank-1]} < ${e[this.rank-1]}) {
          ++${i[this.rank-1]};
          result.w = ${o};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${n}(${e.map((u,h)=>`start[${h}]`).join()});`:e.map((u,h)=>`${i[h]} = ${r[h]} + start[${h}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v_e(t,e,n,r){const i=r.texData.get(t.dataId),s=r.makeTensorInfo(n,t.dtype),o=r.texData.get(s.dataId);Object.assign(o,i),o.refCount=1,o.shape=n,o.dtype=t.dtype;let a=uI(e,Rt(t.shape));i.slice&&(a+=i.slice.flatOffset),o.slice={flatOffset:a,origDataId:i.slice&&i.slice.origDataId||t.dataId};const l=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,l+1),s}function Km(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{begin:s,size:o}=r,[a,l]=_S(i,s,o);if(aI(i,a,l),_e(l)===0)return n.makeTensorInfo(l,i.dtype,[]);if(n.shouldExecuteOnCPU([i])||i.dtype==="string"){const h=n.texData.get(i.dataId),f=lxe(h.values,a,l,i.shape,i.dtype);return n.makeTensorInfo(l,i.dtype,f)}const{isPacked:c}=n.texData.get(i.dataId),u=cI(i.shape,a,l);if(c||!u){const h=Ce().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new g_e(l):new p_e(l),f=[a];return n.runWebGLProgram(h,[i],i.dtype,f)}return n.uploadToGPU(i.dataId),v_e(i,a,l,n)}const y_e={kernelName:m0,backendName:"webgl",kernelFunc:Km};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b_e=t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockShape:s,crops:o}=r;z(i.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=s.reduce((w,x)=>w*x),l=Y0(i.shape,s,a),c=Z0(l.length,s.length),u=J0(i.shape,s,a),h=nN(o,s.length),f=rN(u,o,s.length),d=[],p=ct({inputs:{x:i},backend:n,attrs:{shape:l}}),m=ys({inputs:{x:p},backend:n,attrs:{perm:c}}),v=ct({inputs:{x:m},backend:n,attrs:{shape:u}}),y=Km({inputs:{x:v},backend:n,attrs:{begin:h,size:f}});return d.push(p),d.push(m),d.push(v),d.forEach(w=>n.disposeIntermediateTensorInfo(w)),y},w_e={kernelName:Iy,backendName:"webgl",kernelFunc:b_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x_e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,weights:s}=e,{size:o}=r,a=n.readSync(i.dataId),l=n.readSync(s.dataId),c=NU(a,l,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,c)}const __e={kernelName:u_,backendName:"webgl",kernelFunc:x_e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S_e(t){const{inputs:e,backend:n}=t,{s0:r,s1:i}=e,s=n.readSync(r.dataId),o=n.readSync(i.dataId),a=Qt(Array.from(s),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const C_e={kernelName:h_,backendName:"webgl",kernelFunc:S_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T_e="return float(a != b);",rW=Hi({opSnippet:T_e,cpuKernelImpl:rxe,dtype:"bool"}),E_e={kernelName:i0,backendName:"webgl",kernelFunc:rW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cb(t){const{inputs:e,backend:n}=t,{input:r}=e,i=n.texData.get(r.dataId);return lo({inputs:{x:i.complexTensorInfos.real},backend:n})}const k_e={kernelName:W_,backendName:"webgl",kernelFunc:cb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A_e="return float(int(x));";function M_e(t,e){const n=new Qu(t.shape,A_e),r=e.runWebGLProgram(n,[t],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qN(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{dtype:s}=r;if(s==="complex64"){if(i.dtype==="complex64")return lo({inputs:{x:i},backend:n});const o=zr(i.shape),a=qN({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),l=eh({inputs:{real:a,imag:o},backend:n});return o.dispose(),n.disposeIntermediateTensorInfo(a),l}if(i.dtype==="complex64"){const o=cb({inputs:{input:i},backend:n}),a=qN({inputs:{x:o},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(o),a}if(!yM(i.dtype,s)){const o=lo({inputs:{x:i},backend:n});return{dataId:o.dataId,shape:o.shape,dtype:s}}if(s==="int32")return M_e(i,n);if(s==="bool"){const o=n.makeTensorInfo([],"bool",fi("bool",1)),l=rW({inputs:{a:i,b:o},backend:n});return n.disposeIntermediateTensorInfo(o),l}throw new Error(`Error in Cast: failed to cast ${i.dtype} to ${s}`)}const I_e={kernelName:Mp,backendName:"webgl",kernelFunc:qN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iW="return ceil(x);",N_e=Rn({opSnippet:iW,packedOpSnippet:iW,cpuKernelImpl:Lwe}),$_e={kernelName:Ip,backendName:"webgl",kernelFunc:N_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class R_e{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D_e{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P_e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{clipValueMin:s,clipValueMax:o}=r;let a;Ce().getBool("WEBGL_PACK_CLIP")?a=new D_e(i.shape):a=new R_e(i.shape);const l=[[s],[o]];return n.runWebGLProgram(a,[i],i.dtype,l)}const O_e={kernelName:Np,backendName:"webgl",kernelFunc:P_e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class F_e{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sW(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function L_e(t){const{inputs:e,backend:n}=t,{x:r}=e,i=n.texData.get(r.dataId),s=new F_e(r.shape),o=[sW(r,i.complexTensorInfos.real),sW(r,i.complexTensorInfos.imag)];return n.runWebGLProgram(s,o,o[0].dtype)}const B_e={kernelName:Ny,backendName:"webgl",kernelFunc:L_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class z_e{constructor(e){this.outputShape=[],this.outputShape=Gl(e,1),this.variableNames=e.map((o,a)=>`T${a}`);const n=new Array(e.length-1);n[0]=e[0][1];for(let o=1;o<n.length;o++)n[o]=n[o-1]+e[o][1];const r=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<n.length;o++){const a=n[o-1];r.push(`else if (yC < ${n[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const i=n.length,s=n[n.length-1];r.push(`else setOutput(getT${i}(yR, yC-${s}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${r.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class V_e{constructor(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Gl(e,n);const r=this.outputShape,i=r.length,s=rr(i),o=vs("coords",i),a=["x","y","z","w","u","v"].slice(0,i);this.variableNames=e.map((m,v)=>`T${v}`);const l=new Array(e.length-1);l[0]=e[0][n];for(let m=1;m<l.length;m++)l[m]=l[m-1]+e[m][n];const c=a[n],u=a.slice(-2),h=a.join();let f=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${h}), vec2(${u.join()}));
        }`;for(let m=1;m<l.length;m++){const v=l[m-1];f+=`
        if (${c} < ${l[m]}  && ${c} >= ${l[m-1]}) {
          return getChannel(
            getT${m}(${IC(a,c,v)}),
            vec2(${IC(u,c,v)}));
        }`}const d=l.length,p=l[l.length-1];f+=`
        return getChannel(
          getT${d}(${IC(a,c,p)}),
          vec2(${IC(u,c,p)}));`,this.userCode=`
      float getValue(${a.map(m=>"int "+m)}) {
        ${f}
      }

      void main() {
        ${s} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[i-1]} = ${o[i-1]} + 1;
        if (${o[i-1]} < ${r[i-1]}) {
          result.g = getValue(${o});
        }

        ${o[i-2]} = ${o[i-2]} + 1;
        if (${o[i-2]} < ${r[i-2]}) {
          result.a = getValue(${o});
        }

        ${o[i-1]} = ${o[i-1]} - 1;
        if (${o[i-2]} < ${r[i-2]} &&
            ${o[i-1]} < ${r[i-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function IC(t,e,n){const r=t.indexOf(e);return t.map((s,o)=>o===r?`${s} - ${n}`:s).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NC(t){const{inputs:e,backend:n}=t,{input:r}=e,i=n.texData.get(r.dataId);return lo({inputs:{x:i.complexTensorInfos.imag},backend:n})}const U_e={kernelName:N_,backendName:"webgl",kernelFunc:NC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ym(t,e,n){const r=t[0].dtype;if(r==="complex64"){const u=t.map(m=>cb({inputs:{input:m},backend:n})),h=t.map(m=>NC({inputs:{input:m},backend:n})),f=Ym(u,e,n),d=Ym(h,e,n),p=eh({inputs:{real:f,imag:d},backend:n});return u.forEach(m=>n.disposeIntermediateTensorInfo(m)),h.forEach(m=>n.disposeIntermediateTensorInfo(m)),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),p}let i=n.shouldExecuteOnCPU(t);if(r==="string"&&(i=!0),i){const u=t.map(y=>{const w=_e(y.shape.slice(e));return ct({inputs:{x:y},backend:n,attrs:{shape:[-1,w]}})}),h=u.map(y=>({vals:n.readSync(y.dataId),shape:y.shape})),f=Gl(u.map(y=>y.shape),1),d=u[0].shape[0]===1,p=Bwe(h,f,r,d),m=Gl(t.map(y=>y.shape),e),v=n.makeTensorInfo(m,r,p);return u.forEach(y=>n.disposeIntermediateTensorInfo(y)),v}if(t.length>Ce().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const u=Math.floor(t.length/2),h=Ym(t.slice(0,u),e,n),f=Ym(t.slice(u),e,n),d=Ym([h,f],e,n);return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),d}if(Ce().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].shape.length>1){const u=new V_e(t.map(h=>h.shape),e);return n.runWebGLProgram(u,t,r)}const{tensors2D:s,outShape:o}=W_e(t,e,n),a=new z_e(s.map(u=>u.shape)),l=n.runWebGLProgram(a,s,r);s.forEach(u=>n.disposeIntermediateTensorInfo(u));const c=ct({inputs:{x:l},attrs:{shape:o},backend:n});return n.disposeIntermediateTensorInfo(l),c}function W_e(t,e,n){const r=Gl(t.map(s=>s.shape),e);return{tensors2D:t.map(s=>ct({inputs:{x:s},attrs:{shape:[-1,_e(s.shape.slice(e))]},backend:n})),outShape:r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oW(t){const{inputs:e,backend:n,attrs:r}=t,{axis:i}=r,s=hn(i,e[0].shape)[0],o=Gl(e.map(c=>c.shape),s);if(_e(o)===0)return n.makeTensorInfo(o,e[0].dtype,[]);const a=e.filter(c=>_e(c.shape)>0);if(a.length===1)return lo({inputs:{x:a[0]},backend:n});const l=a.map(c=>c.shape);return QI(l,s),Ym(a,s,n)}const G_e={kernelName:$y,backendName:"webgl",kernelFunc:oW};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aW{constructor(e,n=!1,r=null,i=!1,s=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,c=e.strideWidth,u=e.dilationHeight,h=e.dilationWidth,f=e.filterHeight,d=e.filterWidth,p=Math.floor(e.inChannels/4)*4,m=e.inChannels%4,v=e.dataFormat==="channelsLast",y=v?1:2,w=v?2:3,x=v?3:1;let _="",S="";r&&(i?_=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:s?_=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:_=`
          float activation(float x) {
            ${r}
          }
        `,S="result = activation(result);");const T=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${_}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${x}];

        ivec2 xRCCorner =
            ivec2(coords[${y}], coords[${w}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${f}; wR++) {
          int xR = xRCorner + wR * ${u};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${d}; wC++) {
            int xC = xCCorner + wC * ${h};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${p}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${v}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${m===1}) {

              if (${v}) {
                dotProd +=
                    getX(batch, xR, xC, ${p}) *
                    getW(wR, wC, ${p}, d2);
              } else {
                dotProd +=
                    getX(batch, ${p}, xR, xC) *
                    getW(wR, wC, ${p}, d2);
              }

            } else if (${m===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2)
              );

              if (${v}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${m===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2),
                getW(wR, wC, ${p} + 2, d2)
              );

              if (${v}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1),
                  getX(batch, xR, xC, ${p} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC),
                  getX(batch, ${p} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${T}
        ${S}
        setOutput(result);
      }
    `}}class H_e{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const n=e.padInfo.front,r=e.padInfo.top,i=e.padInfo.left,s=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,h=e.filterDepth,f=e.filterHeight,d=e.filterWidth,p=Math.floor(e.inChannels/4)*4,m=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${s}, ${o}, ${a});
      const ivec3 pads = ivec3(${n}, ${r}, ${i});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${h}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${d}; wC++) {
              int xC = xCCorner + wC * ${u};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${p}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${m===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${p}) *
                  getW(wF, wR, wC, ${p}, d2);
              } else if (${m===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${m===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1),
                  getX(batch, xF, xR, xC, ${p} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2),
                  getW(wF, wR, wC, ${p} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class j_e{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=zs(this.outputShape.length);const{dataFormat:r}=n,i=gs(),s=r==="channelsLast",o=s?0:1,a=s?1:2,l=this.enableShapeUniforms?"if(blockIndex < outShape[1] && pos < outShape[0]) {":`if(blockIndex < ${e[1]} && pos < ${e[0]}) {`;let c="";for(let u=0;u<=1;u++)for(let h=0;h<=1;h++)c+=`
          blockIndex = rc.y + ${h};
          pos = rc.x + ${u};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${s}) {
                  innerDims = vec2(d1, ch);
                  result[${u*2+h}] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${u*2+h}] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${c}

        ${i.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lW({x:t,filter:e,convInfo:n,backend:r,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:a=null}){const l=t.shape,c=r.texData.get(t.dataId),u=n.inChannels,h=l[0]*l[1]*l[2],f=n.outChannels,d=n.dataFormat==="channelsLast",p=!1,m=!1;let v;const y=[];if(!((h===1||f===1)&&u>ZU)&&c.isPacked&&d&&c.texture!=null&&l[2]%2!=0&&wn(c.shape.slice(-3),l.slice(-3))){const _=l[0]*l[1]*(l[2]+1),S={dataId:t.dataId,shape:[1,_,n.inChannels],dtype:t.dtype},T=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,z(bC(c.shape,S.shape),()=>`packed reshape ${c.shape} to ${S.shape} isn't free`);const E=ct({inputs:{x:e},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});y.push(E);const k=AC({a:S,b:E,backend:r,transposeA:p,transposeB:m,bias:i,activation:a,preluActivationWeights:s,leakyreluAlpha:o}),A=r.texData.get(k.dataId);z(A.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=T,A.shape=n.outShape,v=lo({inputs:{x:k},backend:r}),v.shape=n.outShape,y.push(k)}else{const _=d?l[0]*l[1]*l[2]:l[0]*l[2]*l[3],S=ct({inputs:{x:t},backend:r,attrs:{shape:[1,_,n.inChannels]}}),T=ct({inputs:{x:e},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),E=AC({a:S,b:T,transposeA:p,transposeB:m,backend:r,bias:i,activation:a,preluActivationWeights:s,leakyreluAlpha:o});v=ct({inputs:{x:E},backend:r,attrs:{shape:n.outShape}}),y.push(S),y.push(T),y.push(E)}for(const _ of y)r.disposeIntermediateTensorInfo(_);return v}function cW({x:t,filter:e,convInfo:n,backend:r,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:c,inChannels:u,outWidth:h,outHeight:f,dataFormat:d}=n,p=d==="channelsLast",m=l*c*u,v=f*h,y=[m,v],w=!0,x=!1,_=[],S=ct({inputs:{x:t},backend:r,attrs:{shape:t.shape.slice(1)}}),T=ct({inputs:{x:e},backend:r,attrs:{shape:[1,m,_e(e.shape)/m]}});_.push(S),_.push(T);const E=new j_e(y,n),k=[S.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],A=r.runWebGLProgram(E,[S],"float32",k),M=ct({inputs:{x:A},backend:r,attrs:{shape:[1,y[0],y[1]]}});_.push(A),_.push(M);const D=i!=null,P=s!=null,N=a==="leakyrelu",R=a?TC(a,!0):null,F=new jU(M.shape,T.shape,[1,v,n.outChannels],w,x,D,R,P,N),O=[M,T];if(i&&O.push(i),P&&O.push(s),N){const ae=r.makeTensorInfo([],"float32",Dc(o,"float32"));O.push(ae),_.push(ae)}const K=r.runWebGLProgram(F,O,"float32"),J=p?[1,f,h,n.outChannels]:[1,n.outChannels,f,h],re=ct({inputs:{x:K},backend:r,attrs:{shape:J}});_.push(K);for(const ae of _)r.disposeIntermediateTensorInfo(ae);return re}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q_e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=r,h=Lc(l),f=Ai(i.shape,s.shape,o,c,a,u,!1,h);let d;if(f.filterHeight===1&&f.filterWidth===1&&f.dilationHeight===1&&f.dilationWidth===1&&f.strideHeight===1&&f.strideWidth===1&&(f.padInfo.type==="SAME"||f.padInfo.type==="VALID"))d=lW({x:i,filter:s,convInfo:f,backend:n});else if(Ce().getBool("WEBGL_CONV_IM2COL")&&i.shape[0]===1)d=cW({x:i,filter:s,convInfo:f,backend:n});else{const m=new aW(f);d=n.runWebGLProgram(m,[i,s],"float32")}const p=ct({inputs:{x:d},backend:n,attrs:{shape:f.outShape}});return n.disposeIntermediateTensorInfo(d),p}const X_e={kernelName:Ry,backendName:"webgl",kernelFunc:q_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class K_e{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,r=e.strideWidth,i=e.padInfo.top,s=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${i};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${s};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              if (${o}) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Y_e{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,r=e.filterWidth,i=e.strideHeight,s=e.strideWidth,o=e.dataFormat==="channelsLast",a=n-1-e.padInfo.top,l=r-1-e.padInfo.left,c=o?1:2,u=o?2:3,h=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${h}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${u}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Z_e{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideDepth,r=e.strideHeight,i=e.strideWidth,s=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${s};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${r} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${i} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class J_e{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterDepth,r=e.filterHeight,i=e.filterWidth,s=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=n-1-e.padInfo.front,c=r-1-e.padInfo.top,u=i-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${u});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${s}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${r}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${r} - 1 - wR;

            for (int wC = 0; wC < ${i}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${i} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q_e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=r,h=Lc(l),f=Ai(i.shape,u,o,1,a,c,!1,h),d=new K_e(f);return n.runWebGLProgram(d,[i,s],"float32")}const eSe={kernelName:d_,backendName:"webgl",kernelFunc:Q_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tSe(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{inputShape:o,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=r,h=Lc(c),f=Ai(o,s.shape,a,1,l,u,!1,h),d=new Y_e(f);return n.runWebGLProgram(d,[i,s],"float32")}const nSe={kernelName:Dy,backendName:"webgl",kernelFunc:tSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rSe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dilations:l}=r,c=Gu(i.shape,s.shape,o,l,a),u=new H_e(c);return n.runWebGLProgram(u,[i,s],"float32")}const iSe={kernelName:Py,backendName:"webgl",kernelFunc:rSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sSe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,pad:a,filterShape:l}=r,c=Gu(i.shape,l,o,1,a),u=new Z_e(c);return n.runWebGLProgram(u,[i,s],"float32")}const oSe={kernelName:p_,backendName:"webgl",kernelFunc:sSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aSe(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{pad:o,strides:a,inputShape:l}=r,c=Gu(l,s.shape,a,1,o),u=new J_e(c);return n.runWebGLProgram(u,[i,s],"float32")}const lSe={kernelName:m_,backendName:"webgl",kernelFunc:aSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cSe=HU+`
  return cos(x);
`,uSe=Rn({opSnippet:cSe}),hSe={kernelName:$p,backendName:"webgl",kernelFunc:uSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fSe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,dSe=Rn({opSnippet:fSe}),pSe={kernelName:Rp,backendName:"webgl",kernelFunc:dSe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mSe{constructor(e,n,r,i,s){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,l,c]=e,[u]=n,[h,f]=r;this.outputShape=[u,h,f,c];const d=i==="bilinear"?1:0,[p,m]=[`${a-1}.0`,`${l-1}.0`],[v,y,w]=h>1?[`${(a-1)/(h-1)}`,"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[x,_,S]=f>1?[`${(l-1)/(f-1)}`,"(x2-x1) * width_ratio",`x1*${m} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${m}`];this.userCode=`
      const float height_ratio = float(${v});
      const float width_ratio = float(${x});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${y};
        float width_scale = ${_};

        float in_y = ${w};
        if( in_y < 0.0 || in_y > ${p} ) {
          setOutput(float(${s}));
          return;
        }
        float in_x = ${S};
        if( in_x < 0.0 || in_x > ${m} ) {
          setOutput(float(${s}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${d} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gSe=t=>{const{inputs:e,backend:n,attrs:r}=t,{image:i,boxes:s,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:c}=r,u=new mSe(i.shape,s.shape,a,l,c);return n.runWebGLProgram(u,[i,s,o],"float32")},vSe={kernelName:g_,backendName:"webgl",kernelFunc:gSe};class uW{constructor(e,n,r){this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}],this.outputShape=e;const i=e.length,s=n?"0.0":`getX(${hW(i,"coords")})`,o=e[e.length-1];let a="",l="";n?(a=r?`end != ${o-1}`:"end != 0",l=r?"end + 1":"end - 1"):(a=r?`end + pow2 < ${o}`:"end >= pow2",l=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${rr(i)} coords = getOutputCoords();
        int end = ${fW(i,"coords")};
        float val = ${s};
        int pow2 = int(pow(2.0, index));
        if (${a}) {
          int idx = ${l};
          ${fW(i,"coords")} = idx;
          val += getX(${hW(i,"coords")});
        }
        setOutput(val);
      }
    `}}function hW(t,e){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw Error(`Cumulative sum for rank ${t} is not yet supported`)}function fW(t,e){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw Error(`Cumulative sum for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ySe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,exclusive:o,reverse:a}=r,l=i.shape.length,c=Hr([s],l);let u=i;c!=null&&(u=ys({inputs:{x:i},backend:n,attrs:{perm:c}}));const h=si(1,l)[0];if(h!==l-1)throw new Error(`WebGL cumsum shader expects an inner-most axis=${i.shape.length-1} but got axis=${s}`);const f=u.shape[h];let d=lo({inputs:{x:u},backend:n});for(let p=0;p<=Math.ceil(Math.log2(f))-1;p++){const m=new uW(u.shape,!1,a),v=[[p]],y=d;d=n.runWebGLProgram(m,[d],d.dtype,v),n.disposeIntermediateTensorInfo(y)}if(o){const p=new uW(u.shape,o,a),m=d;d=n.runWebGLProgram(p,[d],d.dtype),n.disposeIntermediateTensorInfo(m)}if(c!=null){const p=$m(c),m=ys({inputs:{x:d},backend:n,attrs:{perm:p}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(u),m}return d}const bSe={kernelName:Oy,backendName:"webgl",kernelFunc:ySe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wSe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,weights:s}=e,{size:o,binaryOutput:a}=r;if(i.shape.length===1){const l=n.readSync(i.dataId),c=n.readSync(s.dataId),u=NU(l,c,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,u)}else if(i.shape.length===2){const l=n.bufferSync(i),c=n.bufferSync(s),u=Fwe(l,c,o,a);return n.makeTensorInfo(u.shape,s.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const xSe={kernelName:v_,backendName:"webgl",kernelFunc:wSe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _Se{constructor(e,n,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=n,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SSe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockSize:s,dataFormat:o}=r,a=i.shape[0],l=o==="NHWC"?i.shape[1]:i.shape[2],c=o==="NHWC"?i.shape[2]:i.shape[3],u=o==="NHWC"?i.shape[3]:i.shape[1],h=l*s,f=c*s,d=u/(s*s),p=o==="NHWC"?[a,h,f,d]:[a,d,h,f],m=new _Se(p,s,o);return n.runWebGLProgram(m,[i],i.dtype)}const CSe={kernelName:y_,backendName:"webgl",kernelFunc:SSe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dW{constructor(e,n=!1,r=null,i=!1,s=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=zs(this.outputShape.length);const o=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let c="",u="";r&&(i?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:s?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:c=`
          float activation(float x) {
            ${r}
          }
        `,u="result = activation(result);");const h=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${c}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${h}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pW{constructor(e,n=!1,r=null,i=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=zs(this.outputShape.length);const o=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,c=e.dilationWidth,u=e.filterHeight,h=e.filterWidth,f=h;let d=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<h;y++)d+=`
          vec4 xTexelC${y*2};
          int xTexelC${y*2}Ready;
          vec4 xTexelC${y*2+1};
          int xTexelC${y*2+1}Ready;
          vec4 xC${y};`;d+=`
    for (int r = 0; r < ${u}; r++) {
      `;for(let y=0;y<h;y++)d+=`
          xTexelC${y*2} = vec4(0.0);
          xTexelC${y*2}Ready = 0;
          xTexelC${y*2+1} = vec4(0.0);
          xTexelC${y*2+1}Ready = 0;
          xC${y} = vec4(0.0);`;d+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let y=0;y<(f+1)/2;y++){const w=y*2;if(d+=`
          xC = xCCorner + ${w*c};
          `,l===1){if(w<h&&(a%2==1?(d+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }
              `,c===1&&w>0?d+=`
                xC${w} = vec4(xTexelC${w-2}.zw, xTexelC${w}.xy);
                `:d+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${w} = vec4(previous.zw, xTexelC${w}.xy);
                  } else {
                    xC${w} = vec4(0.0, 0.0, xTexelC${w}.xy);
                  }
                  `):d+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                xC${w} = xTexelC${w};
                `,w+1<h)){const x=a%2==0?mM(c):c;c%2==0&&a%2==1||c%2!=0&&a%2!=1?(d+=`
                  xCOffset = xC + imod(pads[1], 2) + ${x};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                    xTexelC${w+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${w+1}.zw = vec2(0.0);
                    }
                    xTexelC${w+1}Ready = 1;
                  }
                  `,c>1&&(d+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                      xTexelC${w} = getX(batch, xR, xCOffset, d1);
                      xTexelC${w}Ready = 1;
                    }
                    `),d+=`
                  xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.xy);
                  `):x===1?d+=`
                    xC${w+1} = xTexelC${w};
                    `:d+=`
                    xCOffset = xC + ${x};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                      xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${w+1}.zw = vec2(0.0);
                      }
                      xTexelC${w+1}Ready = 1;
                    }

                    xC${w+1} = xTexelC${w+1};
                    `}}else w<h&&(a%2==1?(d+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${w+1}Ready == 0) {
                  xTexelC${w+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${w+1}.zw = vec2(0.0);
                  }
                  xTexelC${w+1}Ready = 1;
                }

                xC${w} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
              `,w+1<h&&(d+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${w+1} = vec4(xTexelC${w+1}.xy, final.xy);
                `)):(d+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                  xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w+1}.zw = vec2(0.);
                  }
                  xTexelC${w+1}Ready = 1;
                }

                xC${w} = vec4(
                  xTexelC${w}.xy, xTexelC${w+1}.xy);
              `,w+1<h&&(d+=`
                  xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
                `)));w<h&&(d+=`
            wTexel = getW(r, ${w}, d1, q);
            dotProd += xC${w} * vec4(wTexel.xz, wTexel.xz);
          `,w+1<h&&(d+=`
              wTexel = getW(r, ${w+1}, d1, q);
              dotProd += xC${w+1} * vec4(wTexel.xz, wTexel.xz);
            `))}d+=`
    }
  `,d+=`
      }
    `;let p="",m="";r&&(i?p=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:s?p=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:p=`vec4 activation(vec4 x) {
          ${r}
        }`,m="result = activation(result);");const v=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${p}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${d}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${v}
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TSe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:c}=r;let u=l;u==null&&(u=[1,1]),z(Ui(o,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const h=Ai(i.shape,s.shape,o,u,a,c,!0);let f;Ce().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels==1?f=new pW(h):f=new dW(h);const d=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(f,[i,s],"float32",d)}const ESe={kernelName:Fy,backendName:"webgl",kernelFunc:TSe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kSe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,r=e.strideWidth,i=e.padInfo.top,s=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${i};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${s};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class ASe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,r=e.filterWidth,i=e.strideHeight,s=e.strideWidth,o=n-1-e.padInfo.top,a=r-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MSe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=r,h=Ai(i.shape,u,o,a,l,c,!0),f=new kSe(h);return n.runWebGLProgram(f,[i,s],"float32")}const ISe={kernelName:b_,backendName:"webgl",kernelFunc:MSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NSe(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=r,h=Ai(u,s.shape,o,a,l,c,!0),f=new ASe(h);return n.runWebGLProgram(f,[i,s],"float32")}const $Se={kernelName:w_,backendName:"webgl",kernelFunc:NSe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RSe{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DSe(t){const{inputs:e,backend:n}=t,{x:r}=e,i=[...r.shape,...r.shape],s=_e(r.shape),o=ct({inputs:{x:r},backend:n,attrs:{shape:[s]}}),a=new RSe(s),l=n.runWebGLProgram(a,[o],o.dtype),c=ct({inputs:{x:l},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),c}const PSe={kernelName:x_,backendName:"webgl",kernelFunc:DSe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OSe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:n,inWidth:r,padInfo:i,strideHeight:s,strideWidth:o,filterHeight:a,filterWidth:l,dilationHeight:c,dilationWidth:u}=e,{top:h,left:f}=i;this.userCode=`
      const ivec2 strides = ivec2(${s}, ${o});
      const ivec2 pads = ivec2(${h}, ${f});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${u};

              if (wIn >= 0 && wIn < ${r}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FSe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dilations:l}=r,c=F0(i.shape,s.shape,o,a,"NHWC",l);let u;const h=new OSe(c);u=n.runWebGLProgram(h,[i,s],"float32");const f=ct({inputs:{x:u},backend:n,attrs:{shape:c.outShape}});return n.disposeIntermediateTensorInfo(u),f}const LSe={kernelName:Ly,backendName:"webgl",kernelFunc:FSe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BSe(t){const{inputs:e,backend:n,attrs:r}=t,{equation:i}=r,s=e,{allDims:o,summedDims:a,idDims:l}=fN(i,s.length);pN(o.length,l,s);const{path:c,steps:u}=mN(a,l),h=u.length;let f=null,d=o.length;const p=[];for(let m=0;m<h;++m){for(const v of u[m]){const{permutationIndices:y,expandDims:w}=dN(d,l[v]);let x;gN(y)?x=s[v]:(x=ys({inputs:{x:s[v]},backend:n,attrs:{perm:y}}),p.push(x));const _=x.shape.slice();for(let S=0;S<w.length;++S)_.splice(w[S],0,1);wn(x.shape,_)||(x=ct({inputs:{x},backend:n,attrs:{shape:_}}),p.push(x)),f===null?f=x:(f=GN({inputs:{a:x,b:f},backend:n}),p.push(f))}m<h-1&&(c[m]>=0&&(f=kC({inputs:{x:f},backend:n,attrs:{axis:c[m]-(o.length-d),keepDims:!1}}),p.push(f)),d--)}for(const m of p)m!==f&&n.disposeIntermediateTensorInfo(m);return f}const zSe={kernelName:C_,backendName:"webgl",kernelFunc:BSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VSe="return (x >= 0.0) ? x : (exp(x) - 1.0);",USe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,WSe=Rn({opSnippet:VSe,packedOpSnippet:USe}),GSe={kernelName:Pp,backendName:"webgl",kernelFunc:WSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HSe="return (b >= 1.0) ? a : a * (b + 1.0);",jSe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,qSe=t=>{const{inputs:e,backend:n}=t,{dy:r,y:i}=e,s=Ce().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ab(jSe,r.shape,i.shape):new Xm(HSe,r.shape,i.shape);return n.runWebGLProgram(s,[r,i],r.dtype)},XSe={kernelName:T_,backendName:"webgl",kernelFunc:qSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KSe=`
  return vec4(equal(a, b));
`,YSe="return float(a == b);",ZSe=Hi({opSnippet:YSe,packedOpSnippet:KSe,dtype:"bool",cpuKernelImpl:zwe}),JSe={kernelName:By,backendName:"webgl",kernelFunc:ZSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QSe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${iN};
  float a1 = ${sN};
  float a2 = ${oN};
  float a3 = ${aN};
  float a4 = ${lN};
  float a5 = ${cN};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,eCe=Rn({opSnippet:QSe}),tCe={kernelName:Op,backendName:"webgl",kernelFunc:eCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mW="return exp(x);",gW=Rn({opSnippet:mW,packedOpSnippet:mW,cpuKernelImpl:Vwe,dtype:"float32"}),nCe={kernelName:Fp,backendName:"webgl",kernelFunc:gW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XN(t){const{inputs:e,attrs:n,backend:r}=t,{dim:i}=n,{input:s}=e,o=s.shape.length,a=s.shape.slice();let l=i;return i<0&&(z(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+i+1),a.splice(l,0,1),ct({inputs:{x:s},backend:r,attrs:{shape:a}})}const rCe={kernelName:zy,backendName:"webgl",kernelFunc:XN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vW="return exp(x) - 1.0;",iCe=Rn({opSnippet:vW,packedOpSnippet:vW,cpuKernelImpl:Uwe}),sCe={kernelName:Lp,backendName:"webgl",kernelFunc:iCe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yW{constructor(e,n,r){this.variableNames=["real","imag"];const i=n[1];this.outputShape=n;const s=r?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=r?`${i}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${s};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${i});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${i}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bW(t,e,n){const r=n.texData.get(t.dataId),i=_e(t.shape),s=t.shape[t.shape.length-1],o=i/s,a=ct({inputs:{x:t},backend:n,attrs:{shape:[o,s]}}),l=a.shape,c=new yW("real",l,e),u=new yW("imag",l,e),h=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:l},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:l}],f=n.runWebGLProgram(c,h,"float32"),d=n.runWebGLProgram(u,h,"float32"),p=eh({inputs:{real:f,imag:d},backend:n});n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d);const m=ct({inputs:{x:p},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(p),m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oCe(t){const{inputs:e,backend:n}=t,{input:r}=e;return bW(r,!1,n)}const aCe={kernelName:E_,backendName:"webgl",kernelFunc:oCe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lCe{constructor(e,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ub(t){const{backend:e,attrs:n}=t,{shape:r,value:i}=n;let{dtype:s}=n;if(s=s||bp(i),s==="string"){const o=hs(s,_e(r));return o.fill(i),e.makeTensorInfo(r,s,o)}else{const o=new lCe(r,i),a=[[i]];return e.runWebGLProgram(o,[],s,a)}}const cCe={kernelName:k_,backendName:"webgl",kernelFunc:ub};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uCe{constructor(e){this.variableNames=["Image"],this.outputShape=[];const n=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hCe={kernelName:A_,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,r=e,i=new uCe(n.shape);return r.runWebGLProgram(i,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wW="return floor(x);",fCe=Rn({opSnippet:wW,packedOpSnippet:wW,cpuKernelImpl:Wwe}),dCe={kernelName:Bp,backendName:"webgl",kernelFunc:fCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pCe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,mCe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,gCe=Hi({opSnippet:pCe,packedOpSnippet:mCe,dtype:"int32"}),vCe={kernelName:zp,backendName:"webgl",kernelFunc:gCe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yCe{constructor(e){this.variableNames=["A"];const n=gs(),[r,i]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${i}.0, ${r}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bCe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=gs(),[r,i]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${i}.0, ${r}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wCe={kernelName:oS,backendName:"webgl",kernelFunc:xCe};let Zm;function xCe(t){const{inputs:e,backend:n,attrs:r}=t;let{pixels:i}=e;const{numChannels:s}=r,o=typeof HTMLVideoElement!="undefined"&&i instanceof HTMLVideoElement,a=typeof HTMLImageElement!="undefined"&&i instanceof HTMLImageElement,[l,c]=o?[i.videoWidth,i.videoHeight]:[i.width,i.height],u=[c,l],h=[c,l,s];(a||o)&&(Zm==null&&(Zm=document.createElement("canvas").getContext("2d")),Zm.canvas.width=l,Zm.canvas.height=c,Zm.drawImage(i,0,0,l,c),i=Zm.canvas);const f=n.makeTensorInfo(u,"int32");n.texData.get(f.dataId).usage=Fo.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(f.dataId),i);const d=Ce().getBool("WEBGL_PACK")?new bCe(h):new yCe(h),p=n.runWebGLProgram(d,[f],"int32");return n.disposeData(f.dataId),p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ce(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:f,activation:d,leakyreluAlpha:p}=r,m=Lc(u),v=Ai(i.shape,s.shape,l,h,c,f,!1,m);let y;const w=[];if(v.filterHeight===1&&v.filterWidth===1&&v.dilationHeight===1&&v.dilationWidth===1&&v.strideHeight===1&&v.strideWidth===1&&(v.padInfo.type==="SAME"||v.padInfo.type==="VALID"))y=lW({x:i,filter:s,convInfo:v,backend:n,bias:o,activation:d,preluActivationWeights:a,leakyreluAlpha:p});else if(Ce().getBool("WEBGL_CONV_IM2COL")&&i.shape[0]===1)y=cW({x:i,filter:s,convInfo:v,backend:n,bias:o,activation:d,preluActivationWeights:a,leakyreluAlpha:p});else{const _=o!=null,S=a!=null,T=d==="leakyrelu",E=d?TC(d,!1):null,k=new aW(v,_,E,S,T),A=[i,s];if(o&&A.push(o),a&&A.push(a),T){const M=n.makeTensorInfo([],"float32",Dc(p,"float32"));A.push(M),w.push(M)}y=n.runWebGLProgram(k,A,"float32")}const x=ct({inputs:{x:y},backend:n,attrs:{shape:v.outShape}});return w.push(y),w.forEach(_=>n.disposeIntermediateTensorInfo(_)),x}const SCe={kernelName:T0,backendName:"webgl",kernelFunc:_Ce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CCe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dilations:u,dimRoundingMode:h,activation:f,leakyreluAlpha:d}=r,p=[];let m=u;m==null&&(m=[1,1]),z(Ui(l,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${m}'`);const v=Ai(i.shape,s.shape,l,m,c,h,!0),y=Ce().getBool("WEBGL_PACK_DEPTHWISECONV")&&v.strideWidth<=2&&v.outChannels/v.inChannels==1,w=f?TC(f,y):null,x=[i,s],_=o!=null,S=a!=null,T=f==="leakyrelu";if(_&&x.push(o),S&&x.push(a),T){const M=n.makeTensorInfo([],"float32",Dc(d,"float32"));x.push(M),p.push(M)}let E;y?E=new pW(v,_,w,S,T):E=new dW(v,_,w,S,T);const k=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],A=n.runWebGLProgram(E,x,"float32",k);return p.forEach(M=>n.disposeIntermediateTensorInfo(M)),A}const TCe={kernelName:E0,backendName:"webgl",kernelFunc:CCe};class ECe{constructor(e,n,r){this.sliceDim=e,this.strides=n,this.variableNames=["x","indices"],this.outputShape=r;const i=rr(n.length),s=rr(r.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        ${i} strides = ${i}(${this.strides});
         void main() {
          ${s} coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < ${this.sliceDim}; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * ${o};
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kCe(t){const{inputs:e,backend:n}=t,{params:r,indices:i}=e,s=i.shape,o=s[s.length-1],a=_e(r.shape),[l,c,u,h]=xS(r,i),f=ct({inputs:{x:i},backend:n,attrs:{shape:[c,o]}}),d=ct({inputs:{x:r},backend:n,attrs:{shape:[_e(r.shape)/u,u]}});if(n.shouldExecuteOnCPU([r,i])||r.dtype==="string"){const y=n.readSync(i.dataId),w=n.bufferSync(r),x=Gwe(y,w,r.dtype,c,o,u,h,r.shape,a);return n.makeTensorInfo(l,r.dtype,x.values)}const p=new ECe(o,h,[c,u]),m=n.runWebGLProgram(p,[d,f],d.dtype),v=ct({inputs:{x:m},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(m),v}const ACe={kernelName:M_,backendName:"webgl",kernelFunc:kCe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MCe{constructor(e,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const r=rr(this.rank),i=ICe(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function ICe(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let i=0;i<t.length;i++)i===2?r.push("int(getIndices(resRC.x, resRC.z))"):r.push(`${n[i]}`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xW(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,indices:s}=e,{axis:o,batchDims:a}=r,l=hn(o,i.shape)[0],c=n.readSync(s.dataId),u=i.shape[l];for(let _=0;_<c.length;++_){const S=c[_];z(S<=u-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${u-1}]`)}const h=bN(i,s,l,a),f=_e(s.shape),d=[],p=ct({inputs:{x:i},backend:n,attrs:{shape:[h.batchSize,h.outerSize,h.dimSize,h.sliceSize]}}),m=ct({inputs:{x:s},backend:n,attrs:{shape:[h.batchSize,f/h.batchSize]}});d.push(p),d.push(m);const v=[h.batchSize,h.outerSize,f/h.batchSize,h.sliceSize];if(n.shouldExecuteOnCPU([i,s])||i.dtype==="string"){const _=n.bufferSync(m),S=n.bufferSync(p),T=Hwe(S,_,v);return d.forEach(E=>n.disposeIntermediateTensorInfo(E)),n.makeTensorInfo(h.outputShape,T.dtype,T.values)}const y=new MCe(p.shape,v),w=n.runWebGLProgram(y,[p,m],p.dtype);d.push(w);const x=ct({inputs:{x:w},backend:n,attrs:{shape:h.outputShape}});return d.forEach(_=>n.disposeIntermediateTensorInfo(_)),x}const NCe={kernelName:Uy,backendName:"webgl",kernelFunc:xW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Ce="return float(a > b);",RCe=`
  return vec4(greaterThan(a, b));
`,DCe=Hi({opSnippet:$Ce,packedOpSnippet:RCe,cpuKernelImpl:jwe,dtype:"bool"}),PCe={kernelName:Wy,backendName:"webgl",kernelFunc:DCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OCe="return float(a >= b);",FCe=`
  return vec4(greaterThanEqual(a, b));
`,LCe=Hi({opSnippet:OCe,packedOpSnippet:FCe,dtype:"bool",cpuKernelImpl:qwe}),BCe={kernelName:Vp,backendName:"webgl",kernelFunc:LCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zCe(t){const{inputs:e,backend:n}=t,{input:r}=e;return bW(r,!0,n)}const VCe={kernelName:I_,backendName:"webgl",kernelFunc:zCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UCe="return float(!isnan(x) && !isinf(x));",WCe=Rn({opSnippet:UCe,dtype:"bool"}),GCe={kernelName:Wp,backendName:"webgl",kernelFunc:WCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HCe="return float(isinf(x));",jCe=Rn({opSnippet:HCe,dtype:"bool"}),qCe={kernelName:Gp,backendName:"webgl",kernelFunc:jCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XCe="return float(isnan(x));",KCe=Rn({opSnippet:XCe,dtype:"bool"}),YCe={kernelName:Hp,backendName:"webgl",kernelFunc:KCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZCe="return float(a < b);",JCe=`
  return vec4(lessThan(a, b));
`,QCe=Hi({opSnippet:ZCe,packedOpSnippet:JCe,cpuKernelImpl:Xwe,dtype:"bool"}),e2e={kernelName:Hy,backendName:"webgl",kernelFunc:QCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t2e="return float(a <= b);",n2e=`
  return vec4(lessThanEqual(a, b));
`,r2e=Hi({opSnippet:t2e,packedOpSnippet:n2e,cpuKernelImpl:Kwe,dtype:"bool"}),i2e={kernelName:jy,backendName:"webgl",kernelFunc:r2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s2e(t){const{backend:e,attrs:n}=t,{start:r,stop:i,num:s}=n,o=Ywe(r,i,s);return e.makeTensorInfo([o.length],"float32",o)}const o2e={kernelName:$_,backendName:"webgl",kernelFunc:s2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a2e=`if (x < 0.0) return NAN;
  return log(x);`,l2e=`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,c2e=Rn({opSnippet:a2e,packedOpSnippet:l2e,cpuKernelImpl:Zwe}),u2e={kernelName:jp,backendName:"webgl",kernelFunc:c2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h2e="return log(1.0 + x);",f2e=Rn({opSnippet:h2e}),d2e={kernelName:qp,backendName:"webgl",kernelFunc:f2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p2e="return float(a >= 1.0 && b >= 1.0);",m2e=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,g2e=Hi({opSnippet:p2e,packedOpSnippet:m2e,dtype:"bool"}),v2e={kernelName:qy,backendName:"webgl",kernelFunc:g2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y2e="return float(!(x >= 1.0));",b2e=Rn({opSnippet:y2e}),w2e={kernelName:Xy,backendName:"webgl",kernelFunc:b2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x2e="return float(a >= 1.0 || b >= 1.0);",_2e=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,S2e=Hi({opSnippet:x2e,packedOpSnippet:_2e,dtype:"bool"}),C2e={kernelName:Ky,backendName:"webgl",kernelFunc:S2e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class T2e{constructor(e,n,r,i,s){this.variableNames=["x"],this.outputShape=[];const o=n,a=e[3]-1;this.outputShape=e;let l;const c=`float(${r}) + float(${i}) * sum`;s===.5?l=`inversesqrt(${c})`:s===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class E2e{constructor(e,n,r,i,s){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=n,a=e[3]-1;this.outputShape=e;let l;const c=`float(${r}) + float(${i}) * sum`;s===.5?l=`inversesqrt(${c})`:s===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k2e=t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{depthRadius:s,bias:o,alpha:a,beta:l}=r,c=Ce().getBool("WEBGL_PACK_NORMALIZATION")?new E2e(i.shape,s,o,a,l):new T2e(i.shape,s,o,a,l);return n.runWebGLProgram(c,[i],i.dtype)},A2e={kernelName:Yy,backendName:"webgl",kernelFunc:k2e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class M2e{constructor(e,n,r,i,s){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=n,this.bias=r,this.alpha=i,this.beta=s,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${i}) * norm + float(${r});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${i})
                * float(${s})
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${s});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I2e=t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i,y:s,dy:o}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=r,h=new M2e(i.shape,a,l,c,u);return n.runWebGLProgram(h,[i,s,o],i.dtype)},N2e={kernelName:R_,backendName:"webgl",kernelFunc:I2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $2e(t,e,n,r){const i=_e(e),o=_e(t.shape)/i,a=ct({inputs:{x:t},attrs:{shape:[o,i]},backend:r}),l=If(a,t.dtype,"max",r),c=ct({inputs:{x:l},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _W(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{reductionIndices:s,keepDims:o}=r,a=i.shape.length,l=hn(s,i.shape);let c=l;const u=Hr(c,a),h=u!=null,f=n.shouldExecuteOnCPU([i]);let d=i;if(h){if(f){const x=n.texData.get(d.dataId).values,_=new Array(a);for(let E=0;E<_.length;E++)_[E]=i.shape[u[E]];const S=WN(x,i.shape,i.dtype,u,_);d=n.makeTensorInfo(_,i.dtype);const T=n.texData.get(d.dataId);T.values=S}else d=EC(i,u,n);c=si(c.length,a)}Wi("max",c,a);const[p,m]=Mi(d.shape,c);let v=p;o&&(v=Gr(p,l));let y;if(f){const x=n.texData.get(d.dataId).values,_=Jwe(x,_e(m),v,i.dtype);y=n.makeTensorInfo(v,i.dtype);const S=n.texData.get(y.dataId);S.values=_}else y=$2e(d,m,v,n);return h&&n.disposeIntermediateTensorInfo(d),y}const R2e={kernelName:Zy,backendName:"webgl",kernelFunc:_W};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D2e=zU+`
  return max(a, b);
`,P2e=`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+CC+`
  return result;
`,O2e=Hi({opSnippet:D2e,packedOpSnippet:P2e,cpuKernelImpl:Qwe}),F2e={kernelName:Xp,backendName:"webgl",kernelFunc:O2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L2e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;sb(i,"maxPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:l}=r,c=1;z(Ui(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const u=ca(i.shape,s,o,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&wn(u.inShape,u.outShape))return lo({inputs:{x:i},backend:n});const h=new lb(u,"max",!1);return n.runWebGLProgram(h,[i],i.dtype)}const B2e={kernelName:Jy,backendName:"webgl",kernelFunc:L2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z2e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{filterSize:s,strides:o,pad:a,dataFormat:l,dimRoundingMode:c}=r,u=[1,1,1],h=Fc(i.shape,s,o,u,a,c,l),f=new HN(h,"max",!1);return n.runWebGLProgram(f,[i],i.dtype)}const V2e={kernelName:Qy,backendName:"webgl",kernelFunc:z2e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class U2e{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideHeight,r=e.strideWidth,i=e.dilationHeight,s=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=s-1-e.padInfo.top,l=o-1-e.padInfo.left,c=s*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${s};
          wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class W2e{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideDepth,r=e.strideHeight,i=e.strideWidth,s=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,u=e.effectiveFilterWidth,h=l-1-e.padInfo.front,f=c-1-e.padInfo.top,d=u-1-e.padInfo.left,p=l*c*u-1;this.userCode=`
      const ivec3 pads = ivec3(${h}, ${f}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${s}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${u};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${i}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${p} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${u} +
                  wR * ${u} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G2e(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,o=s,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,h=[1,1,1],f=Fc(o.shape,a,l,h,c,u),d=new HN(f,"max",!0),p=n.runWebGLProgram(d,[o],o.dtype),m=new W2e(f),v=n.runWebGLProgram(m,[i,p],o.dtype);return n.disposeIntermediateTensorInfo(p),v}const H2e={kernelName:P_,backendName:"webgl",kernelFunc:G2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j2e(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s,output:o}=e,a=s;sb([s,o],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:h}=r,f=ca(a.shape,l,c,1,u,h),d=!0,p=new lb(f,"max",d),m=n.runWebGLProgram(p,[a],a.dtype),v=new U2e(f),y=n.runWebGLProgram(v,[i,m],a.dtype);return n.disposeIntermediateTensorInfo(m),y}const q2e={kernelName:D_,backendName:"webgl",kernelFunc:j2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X2e(t,e,n,r){let i=new lb(n,"max",!1);const s=r.runWebGLProgram(i,[t],"float32");i=new lb(n,"max",!0,!0,e);const o=r.runWebGLProgram(i,[t],"float32");return[s,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K2e={kernelName:O_,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{filterSize:i,strides:s,pad:o,includeBatchInIndex:a}=e,l=n;z(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);const c=[1,1];z(Ui(s,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);const u=ca(r.shape,i,s,c,o),[h,f]=X2e(r,a,u,l);return[h,f]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y2e(t,e,n,r){const i=_e(e),o=_e(t.shape)/i,a=ct({inputs:{x:t},attrs:{shape:[o,i]},backend:r}),l=If(a,"float32","mean",r),c=ct({inputs:{x:l},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z2e={kernelName:e0,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{keepDims:i,axis:s}=e,o=n,a=r.shape.length,l=hn(s,r.shape);let c=l;const u=Hr(c,a),h=u!=null,f=o.shouldExecuteOnCPU([r]),d=[];let p=r;if(h){if(f){const _=o.texData.get(p.dataId).values,S=new Array(a);for(let k=0;k<S.length;k++)S[k]=r.shape[u[k]];const T=WN(_,r.shape,r.dtype,u,S);p=o.makeTensorInfo(S,r.dtype);const E=o.texData.get(p.dataId);E.values=T}else p=EC(r,u,o);d.push(p),c=si(c.length,a)}Wi("sum",c,a);const[m,v]=Mi(p.shape,c);let y=m;i&&(y=Gr(m,l));const w=Y2e(p,v,y,o);for(const x of d)o.disposeIntermediateTensorInfo(x);return w}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J2e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r,a=i.shape.length,l=hn(s,i.shape);let c=l;const u=Hr(c,a);let h=i;u!=null&&(h=ys({inputs:{x:i},backend:n,attrs:{perm:u}}),c=si(c.length,i.shape.length)),Wi("min",c,a);const[f,d]=Mi(h.shape,c),p=_e(d),m=ct({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}}),v=If(m,m.dtype,"min",n);let y;if(o){const w=Gr(f,l);y=ct({inputs:{x:v},backend:n,attrs:{shape:w}})}else y=ct({inputs:{x:v},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),u!=null&&n.disposeIntermediateTensorInfo(h),y}const Q2e={kernelName:t0,backendName:"webgl",kernelFunc:J2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eTe=zU+`
  return min(a, b);
`,tTe=`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+CC+`
  return result;
`,nTe=Hi({opSnippet:eTe,packedOpSnippet:tTe,cpuKernelImpl:exe}),rTe={kernelName:Kp,backendName:"webgl",kernelFunc:nTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iTe{constructor(e,n,r){this.variableNames=["x"],this.outputShape=n.map((u,h)=>u[0]+e[h]+u[1]);const i=e.length,s=rr(i),o=n.map(u=>u[0]).join(","),a=n.map((u,h)=>u[0]+e[h]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i),c=r==="reflect"?0:1;if(i===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${o});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        for (int i = 0; i < ${i}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${s} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sTe{constructor(e,n,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((p,m)=>p[0]+e[m]+p[1]);const i=e.length,s=rr(i),o=n.map(p=>p[0]).join(","),a=n.map((p,m)=>p[0]+e[m]).join(","),l=vs("rc",i),c=vs("source",i),u=`${l[i-1]} < ${this.outputShape[i-1]}`,h=i===1?"source":`vec2(${c.slice(-2).join()})`,f=r==="reflect"?0:1;let d="";if(i===1){const p=`
        ${s} source = rc;
        if (source < start) {
          source = start * 2 - source - ${f};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${f};
        }
        source -= start;
      `;d=`
        ${s} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${c.join()}), ${h});
        ${l[i-1]} += 1;
        if(${u}) {
          ${p}
          result[1] = getChannel(getX(${c.join()}), ${h});
        }
      `}else{const p=`
        ${s} source = rc;
        ${s} lt = ${s}(lessThan(source, start));
        ${s} gte = ${s}(greaterThanEqual(source, end));
        ${s} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${f}) +
                gte * ((end - 1) * 2 - source + ${f});
        source -= start;
      `;d=`
        ${s} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${c.join()}), ${h});
        ${l[i-1]} += 1;
        if(${u}) {
          ${p}
          result[1] = getChannel(getX(${c.join()}), ${h});
        }
        rc = outputLoc;
        ${l[i-2]} += 1;
        if(${l[i-2]} < ${this.outputShape[i-2]}) {
          ${p}
          result[2] = getChannel(getX(${c.join()}), ${h});
          ${l[i-1]} += 1;
          if(${u}) {
            ${p}
            result[3] = getChannel(getX(${c.join()}), ${h});
          }
        }
      `}this.userCode=`
      const ${s} start = ${s}(${o});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oTe=({inputs:t,backend:e,attrs:n})=>{const{x:r}=t,{paddings:i,mode:s}=n,o=Ce().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new sTe(r.shape,i,s):new iTe(r.shape,i,s);return e.runWebGLProgram(o,[r],r.dtype)},aTe={kernelName:n0,backendName:"webgl",kernelFunc:oTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lTe=`if (b == 0.0) return NAN;
  return mod(a, b);`,cTe=`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  `+CC+`
  return result;
`,uTe=Hi({opSnippet:lTe,packedOpSnippet:cTe}),hTe={kernelName:Yp,backendName:"webgl",kernelFunc:uTe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fTe{constructor(e,n,r){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,r],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dTe=`
if (a == b) {
  return 1.0;
};
return a / b;`,pTe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,SW=Hi({opSnippet:dTe,packedOpSnippet:pTe,checkOutOfBounds:!0}),mTe={kernelName:Dp,backendName:"webgl",kernelFunc:SW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CW="return a - b;",TW=Hi({opSnippet:CW,packedOpSnippet:CW,supportsComplex:!0,cpuKernelImpl:gxe}),gTe={kernelName:fm,backendName:"webgl",kernelFunc:TW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EW(t){const{inputs:e,backend:n,attrs:r}=t,{logits:i}=e,{dim:s}=r,o=hn([s],i.shape),a=_W({inputs:{x:i},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),l=Gr(a.shape,o),c=ct({inputs:{x:a},backend:n,attrs:{shape:l}}),u=TW({inputs:{a:i,b:c},backend:n}),h=gW({inputs:{x:u},backend:n}),f=kC({inputs:{x:h},backend:n,attrs:{axis:o,keepDims:!1}}),d=ct({inputs:{x:f},backend:n,attrs:{shape:l}}),p=SW({inputs:{a:h,b:d},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),p}const vTe={kernelName:b0,backendName:"webgl",kernelFunc:EW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yTe(t){const{inputs:e,backend:n,attrs:r}=t,{logits:i}=e,{numSamples:s,seed:o,normalized:a}=r,l=a?i:EW({inputs:{logits:i},backend:n,attrs:{dim:i.shape.length-1}}),c=l.shape[0],u=l.shape[1],h=new fTe(c,u,s),f=[[o]],d=n.runWebGLProgram(h,[l],"int32",f);return a||n.disposeIntermediateTensorInfo(l),d}const bTe={kernelName:F_,backendName:"webgl",kernelFunc:yTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kW="return -x;";function wTe(t){const{inputs:e,backend:n}=t,{x:r}=e;if(n.shouldExecuteOnCPU([r])){const s=n.texData.get(r.dataId),[o,a]=nxe(s.values,r.shape,r.dtype);return n.makeTensorInfo(a,r.dtype,o)}let i;return Ce().getBool("WEBGL_PACK_UNARY_OPERATIONS")?i=new qm(r.shape,kW):i=new Qu(r.shape,kW),n.runWebGLProgram(i,[r],r.dtype)}const xTe={kernelName:r0,backendName:"webgl",kernelFunc:wTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Te=ZS;function STe(t){ko("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=r,c=n.readSync(i.dataId),u=n.readSync(s.dataId),{selectedIndices:h}=_Te(c,u,o,a,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}const CTe={kernelName:L_,backendName:"webgl",kernelFunc:STe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TTe=JS;function ETe(t){ko("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r,u=n.readSync(i.dataId),h=n.readSync(s.dataId),{selectedIndices:f,validOutputs:d}=TTe(u,h,o,a,l,c);return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([d]))]}const kTe={kernelName:B_,backendName:"webgl",kernelFunc:ETe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ATe=QS;function MTe(t){ko("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r,u=n.readSync(i.dataId),h=n.readSync(s.dataId),f=o,d=a,p=l,m=c,{selectedIndices:v,selectedScores:y}=ATe(u,h,f,d,p,m);return[n.makeTensorInfo([v.length],"int32",new Int32Array(v)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const ITe={kernelName:z_,backendName:"webgl",kernelFunc:MTe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NTe{constructor(e,n,r,i){this.variableNames=["indices"],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${i}), float(${r}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Te=t=>{const{inputs:e,backend:n,attrs:r}=t,{indices:i}=e,{depth:s,onValue:o,offValue:a}=r,l=_e(i.shape),c=new NTe(l,s,o,a),u=ct({inputs:{x:i},backend:n,attrs:{shape:[l]}}),h=n.runWebGLProgram(c,[u],i.dtype);n.disposeIntermediateTensorInfo(u);const f=[...i.shape,s],d=ct({inputs:{x:h},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(h),d},RTe={kernelName:o0,backendName:"webgl",kernelFunc:$Te};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $C(t){const{inputs:e,backend:n}=t,{x:r}=e;if(r.dtype==="complex64"){const i=cb({inputs:{input:r},backend:n}),s=$C({inputs:{x:i},backend:n}),o=NC({inputs:{input:r},backend:n}),a=$C({inputs:{x:o},backend:n}),l=eh({inputs:{real:s,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return ub({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:n})}const DTe={kernelName:S0,backendName:"webgl",kernelFunc:$C};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AW(t){const{inputs:e,backend:n}=t,{x:r}=e;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){const i=cb({inputs:{input:r},backend:n}),s=AW({inputs:{x:i},backend:n}),o=NC({inputs:{input:r},backend:n}),a=$C({inputs:{x:o},backend:n}),l=eh({inputs:{real:s,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return ub({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:n})}const PTe={kernelName:s0,backendName:"webgl",kernelFunc:AW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OTe(t){const{inputs:e,backend:n,attrs:r}=t,{axis:i}=r;if(e.length===1)return XN({inputs:{input:e[0]},backend:n,attrs:{dim:i}});const s=e[0].shape,o=e[0].dtype;e.forEach(u=>{zi(s,u.shape,"All tensors passed to stack must have matching shapes"),z(o===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(u=>{const h=XN({inputs:{input:u},backend:n,attrs:{dim:i}});return a.push(h),h}),c=oW({inputs:l,backend:n,attrs:{axis:i}});return a.forEach(u=>n.disposeIntermediateTensorInfo(u)),c}const FTe={kernelName:a0,backendName:"webgl",kernelFunc:OTe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LTe{constructor(e,n,r){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((c,u)=>c[0]+e[u]+c[1]);const i=e.length,s=rr(i),o=n.map(c=>c[0]).join(","),a=n.map((c,u)=>c[0]+e[u]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i);if(i===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${o});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${s} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BTe{constructor(e,n,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((m,v)=>m[0]+e[v]+m[1]);const i=e.length,s=rr(i),o=n.map(m=>m[0]).join(","),a=n.map((m,v)=>m[0]+e[v]).join(","),l=vs("rc",i),c=vs("source",i),u=`${l[i-1]} < ${this.outputShape[i-1]}`,h=i===1?"source":`vec2(${c.slice(-2).join()})`,f=[`${s} rc = outputLoc;`,`${l[i-1]} += 1;
       if(${u}) {
      `,i===1?"":`}
       rc = outputLoc;
       ${l[i-2]} += 1;
       if(${l[i-2]} < ${this.outputShape[i-2]}) {`,i===1?"":`  ${l[i-1]} += 1;
         if(${u}) {`],d=i===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let m=0,v=i===1?2:4;m<v;m++)p+=`
        ${f[m]}
        if (${d}) {
          result[${m}] = float(value);
        } else {
          ${s} source = rc - start;
          result[${m}] = getChannel(getX(${c.join()}), ${h});
        }
      `;p+=i===1?"} ":"}}",this.userCode=`
      const ${s} start = ${s}(${o});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MW=t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{paddings:s,constantValue:o}=r;if(_e(i.shape)===0){const c=s.map((u,h)=>u[0]+i.shape[h]+u[1]);return ub({backend:n,attrs:{shape:c,value:o,dtype:i.dtype}})}const a=Ce().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new BTe(i.shape,s,o):new LTe(i.shape,s,o),l=[[o]];return n.runWebGLProgram(a,[i],i.dtype,l)},zTe={kernelName:l0,backendName:"webgl",kernelFunc:MW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VTe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,UTe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  `+CC+`
  return result;
`,WTe=Hi({opSnippet:VTe,packedOpSnippet:UTe}),GTe={kernelName:Jp,backendName:"webgl",kernelFunc:WTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HTe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r,a=i.shape.length,l=[],c=hn(s,i.shape);let u=c;const h=Hr(u,a);let f=i;h!=null&&(f=ys({inputs:{x:i},backend:n,attrs:{perm:h}}),u=si(u.length,a),l.push(f)),Wi("prod",u,a);let d;if(n.shouldExecuteOnCPU([f])){const p=n.texData.get(f.dataId).values,{outVals:m,outShape:v,outDtype:y}=ixe(f.shape,f.dtype,p,u);d=n.makeTensorInfo(v,y,m)}else{const[p,m]=Mi(f.shape,u),v=_e(m),y=ct({inputs:{x:f},backend:n,attrs:{shape:[-1,v]}}),w=pS(i.dtype),x=If(y,w,"prod",n);d=ct({inputs:{x},backend:n,attrs:{shape:p}}),l.push(y),l.push(x)}if(o){l.push(d);const p=Gr(d.shape,c);d=ct({inputs:{x:d},backend:n,attrs:{shape:p}})}return l.forEach(p=>n.disposeIntermediateTensorInfo(p)),d}const jTe={kernelName:V_,backendName:"webgl",kernelFunc:HTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IW=t=>{const{backend:e,attrs:n}=t,{start:r,stop:i,step:s,dtype:o}=n,a=sxe(r,i,s,o);return e.makeTensorInfo([a.length],o,a)},qTe={kernelName:U_,backendName:"webgl",kernelFunc:IW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XTe="return 1.0 / x;",KTe=Rn({opSnippet:XTe}),YTe={kernelName:Qp,backendName:"webgl",kernelFunc:KTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZTe=el+`
  return (x < 0.0) ? 0.0 : x;
`,JTe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,QTe=Rn({opSnippet:ZTe,packedOpSnippet:JTe}),eEe={kernelName:em,backendName:"webgl",kernelFunc:QTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tEe=el+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,nEe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,rEe=Rn({opSnippet:tEe,packedOpSnippet:nEe}),iEe={kernelName:tm,backendName:"webgl",kernelFunc:rEe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sEe{constructor(e,n,r,i,s){this.variableNames=["A"],this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,r,c];const u=[i&&n>1?a-1:a,i&&r>1?l-1:l],h=[i&&n>1?n-1:n,i&&r>1?r-1:r];let f;s?f="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/h[0]},
          ${u[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oEe{constructor(e,n,r,i,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,r,c];const u=[i&&n>1?a-1:a,i&&r>1?l-1:l],h=[i&&n>1?n-1:n,i&&r>1?r-1:r];let f;s?f="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/h[0]},
          ${u[1]/h[1]},
          ${u[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${r-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aEe(t){const{inputs:e,backend:n,attrs:r}=t,{images:i}=e,{alignCorners:s,halfPixelCenters:o,size:a}=r,[l,c]=a,u=Ce().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new oEe(i.shape,l,c,s,o):new sEe(i.shape,l,c,s,o);return n.runWebGLProgram(u,[i],"float32")}const lEe={kernelName:f0,backendName:"webgl",kernelFunc:aEe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cEe{constructor(e,n,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,i,s]=n,[,o,a]=e,l=[r&&o>1?i-1:i,r&&a>1?s-1:s],c=[r&&o>1?o-1:o,r&&a>1?a-1:a],u=l[0]/c[0],h=l[1]/c[1],f=1/u,d=1/h,p=Math.ceil(f)*2+2,m=Math.ceil(d)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${h});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${d});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${i-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${s-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uEe(t){const{inputs:e,backend:n,attrs:r}=t,{images:i,dy:s}=e,{alignCorners:o}=r,a=new cEe(s.shape,i.shape,o);return n.runWebGLProgram(a,[s],s.dtype)}const hEe={kernelName:H_,backendName:"webgl",kernelFunc:uEe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fEe{constructor(e,n,r,i,s){this.variableNames=["A"],this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,r,c];const u=[i&&n>1?a-1:a,i&&r>1?l-1:l],h=[i&&n>1?n-1:n,i&&r>1?r-1:r],f=i?"0.5":"0.0";let d;s?d="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/h[0]},
          ${u[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${d};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dEe{constructor(e,n,r,i,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,r,c];const u=[i&&n>1?a-1:a,i&&r>1?l-1:l],h=[i&&n>1?n-1:n,i&&r>1?r-1:r],f=i?"0.5":"0.0";let d;s?d="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/h[0]},
          ${u[1]/h[1]},
          ${u[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${d};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${r-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pEe(t){const{inputs:e,backend:n,attrs:r}=t,{images:i}=e,{alignCorners:s,halfPixelCenters:o,size:a}=r,[l,c]=a,u=Ce().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new dEe(i.shape,l,c,s,o):new fEe(i.shape,l,c,s,o);return n.runWebGLProgram(u,[i],i.dtype)}const mEe={kernelName:h0,backendName:"webgl",kernelFunc:pEe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gEe{constructor(e,n,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,i,s]=n,[,o,a]=e,l=[r&&o>1?i-1:i,r&&a>1?s-1:s],c=[r&&o>1?o-1:o,r&&a>1?a-1:a],u=l[0]/c[0],h=l[1]/c[1],f=1/u,d=1/h,p=Math.ceil(f)*2+2,m=Math.ceil(d)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${h});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${d});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${i}) - 1),
                ${r} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${s}) - 1),
                ${r} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vEe(t){const{inputs:e,backend:n,attrs:r}=t,{images:i,dy:s}=e,{alignCorners:o}=r,a=new gEe(s.shape,i.shape,o);return n.runWebGLProgram(a,[s],s.dtype)}const yEe={kernelName:G_,backendName:"webgl",kernelFunc:vEe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bEe{constructor(e,n){this.variableNames=["x"];const r=e.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);if(this.outputShape=e,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const i=a=>n.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,s=e.map((a,l)=>i(l)).join(","),o=rr(r);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${s}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wEe{constructor(e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const r=e.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);this.outputShape=e;const i=vs("rc",r),s=`${i[r-1]} + 1 < ${this.outputShape[r-1]}`,o=`${i[r-2]} + 1 < ${this.outputShape[r-2]}`,a=rr(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${s}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(i.slice())};
          if(${s}){
            result.g = ${c(i.slice())};
          }
          if(${o}) {
            result.b = ${u(i.slice())};
            if(${s}) {
              result.a = ${h(i.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(p){return f(p)}function c(p){return p[r-1]="("+p[r-1]+" + 1)",f(p)}function u(p){return p[r-2]="("+p[r-2]+" + 1)",f(p)}function h(p){return p[r-1]="("+p[r-1]+" + 1)",p[r-2]="("+p[r-2]+" + 1)",f(p)}function f(p){const m=e.map((w,x)=>d(x,p)),v=m.join(","),y=m.slice(-2).join(",");return`getChannel(getX(${v}), vec2(${y}))`}function d(p,m){return n.indexOf(p)!==-1&&e[p]!==1?`${e[p]} - ${m[p]} - 1`:`${m[p]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xEe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{dims:s}=r,o=i.shape.length,a=hn(s,i.shape);if(o===0)return lo({inputs:{x:i},backend:n});const l=Ce().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new wEe(i.shape,a):new bEe(i.shape,a);return n.runWebGLProgram(l,[i],i.dtype)}const _Ee={kernelName:d0,backendName:"webgl",kernelFunc:xEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SEe{constructor(e,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const r=e[1],i=e[2];this.outputShape=e;let s="";typeof n=="number"?s=`float outputValue = ${n.toFixed(2)};`:s=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${s}
          if(coordX >= 0 && coordX < ${i} && coordY >= 0 && coordY < ${r}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CEe={kernelName:aS,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:r}=t,{radians:i,fillValue:s,center:o}=e,a=n,l=new SEe(r.shape,s),[c,u]=tN(o,r.shape[1],r.shape[2]),h=[[c,u,Math.sin(i),Math.cos(i)]];return a.runWebGLProgram(l,[r],r.dtype,h)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TEe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,EEe=Rn({opSnippet:TEe}),kEe={kernelName:nm,backendName:"webgl",kernelFunc:EEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AEe="return inversesqrt(x);",MEe=Rn({opSnippet:AEe,cpuKernelImpl:oxe}),IEe={kernelName:rm,backendName:"webgl",kernelFunc:MEe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NW{constructor(e,n,r,i,s,o,a=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const l=rr(s.length),c=rr(o.length);let u="";r===1?u="i":r===2&&(u="i, j");const h=`getIndices(${u})`;let f="";i===1?f="i":i===2&&(f="i, coords[1]");const d=`getUpdates(${f})`,p=n>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${s});

        void main() {
          ${c} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${h});
              flattenedIndex += index * ${p};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${d};
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NEe(t){const{inputs:e,backend:n,attrs:r}=t,{indices:i,updates:s}=e,{shape:o}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:h}=Cm(s,i,o),f=[h/c,c];if(h===0)return n.makeTensorInfo(o,i.dtype);const d=ct({inputs:{x:i},backend:n,attrs:{shape:[l,a]}}),p=ct({inputs:{x:s},backend:n,attrs:{shape:[l,c]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0])),v=new NW(l,a,d.shape.length,p.shape.length,u,f),y=n.runWebGLProgram(v,[p,d,m],p.dtype),w=ct({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(m),w}const $Ee={kernelName:j_,backendName:"webgl",kernelFunc:NEe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class REe{constructor(e,n,r){this.variableNames=["c","a","b"],this.outputShape=n;let i,s;if(r>4)throw Error(`Where for rank ${r} is not yet supported`);if(r===1)s="resRC",i="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let u=0;u<n.length;u++)c.push(`${a[u]}`),u<e&&l.push(`${a[u]}`);i=l.join(),s=c.join()}const o=rr(r);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${i});
        if (cVal >= 1.0) {
          setOutput(getA(${s}));
        } else {
          setOutput(getB(${s}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DEe(t){const{inputs:e,backend:n}=t,{condition:r,t:i,e:s}=e,o=new REe(r.shape.length,i.shape,i.shape.length);return n.runWebGLProgram(o,[r,i,s],eo(i.dtype,s.dtype))}const PEe={kernelName:p0,backendName:"webgl",kernelFunc:DEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OEe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${lC};
  float scale = ${cC};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,FEe=Rn({opSnippet:OEe}),LEe={kernelName:im,backendName:"webgl",kernelFunc:FEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $W="return 1.0 / (1.0 + exp(-1.0 * x));",BEe=Rn({opSnippet:$W,packedOpSnippet:$W,cpuKernelImpl:axe}),zEe={kernelName:lm,backendName:"webgl",kernelFunc:BEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VEe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,UEe=Rn({opSnippet:VEe}),WEe={kernelName:am,backendName:"webgl",kernelFunc:UEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GEe=HU+`
  return sin(x);
`,HEe=Rn({opSnippet:GEe}),jEe={kernelName:sm,backendName:"webgl",kernelFunc:HEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qEe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,XEe=Rn({opSnippet:qEe}),KEe={kernelName:om,backendName:"webgl",kernelFunc:XEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YEe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,ZEe=Rn({opSnippet:YEe}),JEe={kernelName:cm,backendName:"webgl",kernelFunc:ZEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QEe=t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockShape:s,paddings:o}=r;z(i.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=s.reduce((y,w)=>y*w),l=[[0,0]];l.push(...o);for(let y=1+s.length;y<i.shape.length;++y)l.push([0,0]);const c=[],u=MW({inputs:{x:i},backend:n,attrs:{paddings:l,constantValue:0}}),h=Y0(u.shape,s,a,!1),f=Z0(h.length,s.length,!1),d=J0(u.shape,s,a,!1),p=ct({inputs:{x:u},backend:n,attrs:{shape:h}}),m=ys({inputs:{x:p},backend:n,attrs:{perm:f}}),v=ct({inputs:{x:m},backend:n,attrs:{shape:d}});return c.push(u),c.push(p),c.push(m),c.forEach(y=>n.disposeIntermediateTensorInfo(y)),v},eke={kernelName:v0,backendName:"webgl",kernelFunc:QEe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tke(t){const{inputs:e,backend:n}=t,{indices:r,values:i,denseShape:s,defaultValue:o}=e;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${s.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(i.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${i.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.readSync(r.dataId),l=n.readSync(i.dataId),c=n.readSync(s.dataId),u=n.readSync(o.dataId)[0],[h,f,d,p,m]=cxe(a,r.shape,r.dtype,l,i.dtype,c,u);return[n.makeTensorInfo(f,r.dtype,h),n.makeTensorInfo([f[0]],i.dtype,d),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(v=>Number(v)))),n.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}const nke={kernelName:q_,backendName:"webgl",kernelFunc:tke};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rke(t){const{inputs:e,backend:n}=t,{inputIndices:r,inputShape:i,newShape:s}=e;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(i.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${i.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);const o=Array.from(n.readSync(i.dataId)),a=n.readSync(r.dataId),l=Array.from(n.readSync(s.dataId)),[c,u,h]=uxe(a,r.shape,r.dtype,o,l);return[n.makeTensorInfo(u,r.dtype,c),n.makeTensorInfo([h.length],s.dtype,new Int32Array(h))]}const ike={kernelName:X_,backendName:"webgl",kernelFunc:rke};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ske(t){const{inputs:e,backend:n}=t,{data:r,indices:i,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${i.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${s.shape}`);const o=n.readSync(r.dataId),a=n.readSync(i.dataId),l=n.readSync(s.dataId),[c,u]=RU(o,r.shape,r.dtype,a,l,!0);return n.makeTensorInfo(u,r.dtype,c)}const oke={kernelName:K_,backendName:"webgl",kernelFunc:ske};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ake(t){const{inputs:e,backend:n}=t,{data:r,indices:i,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${i.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${s.shape}`);const o=n.readSync(r.dataId),a=n.readSync(i.dataId),l=n.readSync(s.dataId),[c,u]=RU(o,r.shape,r.dtype,a,l);return n.makeTensorInfo(u,r.dtype,c)}const lke={kernelName:Y_,backendName:"webgl",kernelFunc:ake};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cke(t){const{inputs:e,backend:n,attrs:r}=t,{sparseIndices:i,sparseValues:s,defaultValue:o}=e,{outputShape:a}=r,{sliceRank:l,numUpdates:c,strides:u,outputSize:h}=Cm(s,i,a),f=!1,d=new NW(c,l,i.shape.length,s.shape.length,u,[h,1],f),p=n.runWebGLProgram(d,[s,i,o],s.dtype),m=ct({inputs:{x:p},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(p),m}const uke={kernelName:Z_,backendName:"webgl",kernelFunc:cke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hke(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{numOrSizeSplits:s,axis:o}=r,a=hn(o,i.shape)[0],l=vN(i,s,a),c=i.shape.length,u=new Array(c).fill(0),h=i.shape.slice();return l.map(f=>{const d=[...h];d[a]=f;const p=Km({inputs:{x:i},backend:n,attrs:{begin:u,size:d}});return u[a]+=f,p})}const fke={kernelName:y0,backendName:"webgl",kernelFunc:hke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RW="return sqrt(x);",dke=Rn({opSnippet:RW,packedOpSnippet:RW,cpuKernelImpl:hxe}),pke={kernelName:um,backendName:"webgl",kernelFunc:dke};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mke="return x * x;",gke=Rn({opSnippet:mke}),vke={kernelName:J_,backendName:"webgl",kernelFunc:gke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DW="return (a - b) * (a - b);",yke=Hi({opSnippet:DW,packedOpSnippet:DW}),bke={kernelName:hm,backendName:"webgl",kernelFunc:yke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wke({inputs:t,attrs:e,backend:n}){const{x:r}=t,i=el+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,s=new Qu(r.shape,i);return n.runWebGLProgram(s,[r],r.dtype)}const xke={kernelName:gm,backendName:"webgl",kernelFunc:wke};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _ke{constructor(e,n,r){this.variableNames=["x"],this.outputShape=r;const i=r.length,s=rr(r.length),o=rr(r.length);let a="";if(i===1)a="coords * strides + begin";else{let l=0;a=r.map((c,u)=>(l++,r.length===1?`coords * strides[${u}] + begin[${u}]`:`coords[${l-1}] * strides[${u}] + begin[${u}]`)).join(",")}this.userCode=`
      ${s} begin = ${s}(${e});
      ${s} strides = ${s}(${n});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ske(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{begin:s,end:o,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:f}=r,{finalShapeSparse:d,finalShape:p,isIdentity:m,sliceDim0:v,isSimpleSlice:y,begin:w,end:x,strides:_}=hI(i.shape,s,o,a,l,c,u,h,f);let S;if(m)S=ct({inputs:{x:i},backend:n,attrs:{shape:p}});else if(v||y){z(i.shape.length>=1,()=>`Input must have rank at least 1, got: ${i.shape.length}`);const E=lI(w,x,_),k=Km({inputs:{x:i},backend:n,attrs:{begin:w,size:E}});S=ct({inputs:{x:k},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(k)}else if(n.shouldExecuteOnCPU([i])){const k=n.readSync(i.dataId),A=mn(i.shape,i.dtype,k),M=fxe(d,A,_,w);S=n.makeTensorInfo(p,i.dtype,M.values)}else{const k=new _ke(w,_,d);S=n.runWebGLProgram(k,[i],i.dtype)}const T=ct({inputs:{x:S},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(S),T}const Cke={kernelName:Q_,backendName:"webgl",kernelFunc:Ske};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tke(t){const{inputs:e,backend:n,attrs:r}=t,{separator:i,nGramWidths:s,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:c}=r,{data:u,dataSplits:h}=e,f=n.readSync(u.dataId),d=n.readSync(h.dataId),[p,m]=dxe(f,d,i,s,o,a,l,c);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(h.shape,"int32",m)]}const Eke={kernelName:eS,backendName:"webgl",kernelFunc:Tke};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kke(t){const{inputs:e,backend:n,attrs:r}=t,{skipEmpty:i}=r,{input:s,delimiter:o}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.readSync(s.dataId),l=n.readSync(o.dataId)[0],[c,u,h]=pxe(a,l,i),f=u.length;return[n.makeTensorInfo([f,2],"int32",c),n.makeTensorInfo([f],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(h))]}const Ake={kernelName:tS,backendName:"webgl",kernelFunc:kke};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mke(t){const{inputs:e,backend:n,attrs:r}=t,{numBuckets:i}=r,{input:s}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const o=n.readSync(s.dataId),a=mxe(o,i);return n.makeTensorInfo(s.shape,"int32",a)}const Ike={kernelName:nS,backendName:"webgl",kernelFunc:Mke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nke="return tan(x);",$ke=Rn({opSnippet:Nke}),Rke={kernelName:dm,backendName:"webgl",kernelFunc:$ke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dke=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,Pke=Rn({opSnippet:Dke}),Oke={kernelName:pm,backendName:"webgl",kernelFunc:Pke};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fke{constructor(e,n){this.variableNames=["A"];const r=new Array(e.length);for(let o=0;o<r.length;o++)r[o]=e[o]*n[o];this.outputShape=r,this.rank=r.length;const i=rr(this.rank),s=Lke(e);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        setOutput(getA(${s}));
      }
    `}}function Lke(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let i=0;i<t.length;i++)r.push(`imod(${n[i]}, ${t[i]})`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PW(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{reps:s}=r;if(i.dtype==="string"||i.shape.length>5){const l=n.readSync(i.dataId),c=i.dtype==="string"?l.map(f=>ff(f)):l,u=mn(i.shape,i.dtype,c),h=vxe(u,s);return n.makeTensorInfo(h.shape,h.dtype,h.values)}const o=new Fke(i.shape,s);return n.runWebGLProgram(o,[i],i.dtype)}const Bke={kernelName:mm,backendName:"webgl",kernelFunc:PW};class zke{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class Vke{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nf(t,e){e!==null&&t.disposeIntermediateTensorInfo(e)}function OW(t){let e=1;for(;e<t;)e*=2;return e}function Uke(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{k:s,sorted:o}=r,a=Ce().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=Ce().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=i.shape,u=c[c.length-1];if(n.shouldExecuteOnCPU([i])||u<a||s>l){const M=n.readSync(i.dataId),[D,P]=yxe(M,c,i.dtype,s,o);return[n.makeTensorInfo(D.shape,D.dtype,D.values),n.makeTensorInfo(P.shape,P.dtype,P.values)]}if(s===0)return c[c.length-1]=0,[n.makeTensorInfo(c,i.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(u===1)return[i,ub({attrs:{shape:c,dtype:"int32",value:0},backend:n})];const h=n.texData.get(i.dataId),f=h!==null&&h.isPacked,d=f?n.unpackTensor(i):i,m=_e(c)/u,v=ct({inputs:{x:d},attrs:{shape:[m,u]},backend:n});f&&Nf(n,d);const y=OW(s),w=OW(u);let x=null;const _=()=>x===null?[v,v]:[v,x],S=(M,D,P)=>{const N=_(),R=new zke(P),O=[[u],[x===null?1:0],[Number.NEGATIVE_INFINITY],[M],[D]],K=x;x=n.runWebGLProgram(R,N,"int32",O),Nf(n,K)};for(let M=1;M<y;M*=2){const D=M*2;for(let P=M;P>=1;P/=2)S(D,P,[m,w])}for(let M=w;M>y;M/=2){const D=_(),P=new Vke([m,M/2]),R=[[u],[x===null?1:0],[y]],F=x;x=n.runWebGLProgram(P,D,"int32",R),Nf(n,F);const O=y/2,K=O*2;for(let J=O;J>=1;J/=2)S(K,J,x.shape)}let T=x;x=Km({inputs:{x},backend:n,attrs:{begin:0,size:[m,s]}}),Nf(n,T);let E=xW({inputs:{x:v,indices:x},backend:n,attrs:{axis:1,batchDims:1}});Nf(n,v);const k=c.slice(0,-1);k.push(s),T=x,x=ct({inputs:{x},attrs:{shape:k},backend:n}),Nf(n,T);const A=E;return E=ct({inputs:{x:E},attrs:{shape:k},backend:n}),Nf(n,A),[E,x]}const Wke={kernelName:rS,backendName:"webgl",kernelFunc:Uke};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gke{constructor(e,n,r,i,s,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=r==="nearest"?1:2;let l;switch(i){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${s});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${s});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hke(t){const{inputs:e,backend:n,attrs:r}=t,{image:i,transforms:s}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:c}=r,[u,h,f,d]=i.shape,[p,m]=c!=null?c:[h,f],v=[u,p,m,d],y=new Gke(h,f,o,a,l,v);return n.runWebGLProgram(y,[i,s],"float32")}const jke={kernelName:iS,backendName:"webgl",kernelFunc:Hke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qke(t){const{inputs:e,attrs:n,backend:r}=t,{axis:i}=n,{x:s}=e;sb(s,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=r.readSync(s.dataId),{outputValues:a,outputShape:l,indices:c}=bxe(o,i,s.shape,s.dtype);return[r.makeTensorInfo(l,s.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}const Xke={kernelName:sS,backendName:"webgl",kernelFunc:qke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kke(t){const{inputs:e,backend:n,attrs:r}=t,{value:i}=e;let{axis:s}=r;s<0&&(s+=i.shape.length);const o=i,a=o.shape.length,l=i.shape[s],c=new Array(a-1);let u=0;for(let m=0;m<a;m++)m!==s&&(c[u++]=o.shape[m]);const h=[],f=new Array(a).fill(0),d=o.shape.slice();d[s]=1;const p=new Array(l);for(let m=0;m<p.length;m++){f[s]=m;const v=Km({inputs:{x:o},backend:n,attrs:{begin:f,size:d}}),y=ct({inputs:{x:v},backend:n,attrs:{shape:c}});p[m]=y,h.push(v)}return h.forEach(m=>n.disposeIntermediateTensorInfo(m)),p}const Yke={kernelName:x0,backendName:"webgl",kernelFunc:Kke};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zke{constructor(e,n){this.variableNames=["x","segmentIds"];const r=e.windowSize,i=e.batchSize,s=e.inSize,o=e.numSegments,a=o*Math.ceil(s/r);this.outputShape=[i,a];const l="0.0",c="sumValue",u=Math.floor(r/4)*4,h=r%4,f=`
        sumValue += dot(values, segFilter);
    `;let d="";s%r>0&&(d=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `);let p="";s%r>0&&(p=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${p}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${r}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${f}
        }

        int inIdx = inOffset + ${u};
        if (${h===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${f}
        } else if (${h===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${f}
        } else if (${h===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${f}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jke(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,segmentIds:s}=e,{numSegments:o}=r,a=i.shape.length,l=[];let c=0;const u=Hr([c],a);let h=i;u!=null&&(h=ys({inputs:{x:i},backend:n,attrs:{perm:u}}),l.push(h),c=si(1,a)[0]);const f=lV(h.shape,c,o),d=_e([h.shape[c]]),p=ct({inputs:{x:h},backend:n,attrs:{shape:[-1,d]}});l.push(p);const m=pS(i.dtype),v=(_,S,T,E,k)=>{const A=_.shape[0],M=_.shape[1],D=aV(M,k),P={windowSize:D,inSize:M,batchSize:A,numSegments:k},N=new Zke(P,S),R=n.compileAndRun(N,[_,T],E);if(l.push(R),R.shape[1]===k)return R;const F=IW({backend:n,attrs:{start:0,stop:k,step:1,dtype:"float32"}}),O=PW({inputs:{x:F},backend:n,attrs:{reps:[M/D]}});return l.push(F),l.push(O),v(R,S,O,E,k)},y=v(p,"unsortedSegmentSum",s,m,o),w=ct({inputs:{x:y},backend:n,attrs:{shape:f}});let x=w;if(u!=null){l.push(w);const _=$m(u);x=ys({inputs:{x},backend:n,attrs:{perm:_}})}return l.forEach(_=>n.disposeIntermediateTensorInfo(_)),x}const Qke={kernelName:_0,backendName:"webgl",kernelFunc:Jke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eAe=[A2e,N2e,f1e,p1e,v1e,w1e,_1e,T1e,k1e,M1e,R1e,P1e,L1e,V1e,X1e,G1e,Z1e,t_e,Q1e,s_e,a_e,c_e,d_e,w_e,__e,C_e,I_e,$_e,O_e,B_e,qxe,G_e,eSe,nSe,X_e,oSe,lSe,iSe,hSe,pSe,vSe,bSe,xSe,CSe,ISe,$Se,ESe,PSe,LSe,zSe,GSe,XSe,JSe,tCe,nCe,rCe,sCe,aCe,cCe,hCe,dCe,vCe,wCe,SCe,TCe,ACe,NCe,PCe,BCe,jxe,VCe,U_e,GCe,qCe,YCe,Kxe,e2e,i2e,o2e,d2e,u2e,v2e,w2e,C2e,R2e,V2e,B2e,H2e,q2e,K2e,F2e,Z2e,Q2e,rTe,aTe,hTe,bTe,e1e,xTe,CTe,kTe,ITe,E_e,RTe,PTe,FTe,zTe,GTe,Zxe,jTe,qTe,k_e,mTe,YTe,iEe,eEe,n1e,lEe,hEe,mEe,yEe,_Ee,CEe,kEe,IEe,$Ee,PEe,LEe,zEe,WEe,jEe,KEe,y_e,vTe,JEe,eke,nke,ike,oke,lke,uke,fke,pke,vke,bke,xke,Cke,Eke,Ake,Ike,gTe,c1e,Rke,Oke,Bke,Wke,jke,u1e,Xke,Yke,Qke,DTe];for(const t of eAe)uS(t);/** @license MIT License (c) copyright 2010-2016 original author or authors */function FW(t,e){for(var n=e.length,r=new Array(n+1),i=0;i<n;++i)r[i]=e[i];return r[n]=t,r}function tAe(t,e){var n=t.length,r=e.length,i=new Array(n+r),s=0;for(s=0;s<n;s++)i[s]=t[s];for(var o=0;o<r;o++)i[s++]=e[o];return i}function nAe(t,e){for(var n=e.length,r=new Array(n),i=0;i<n;++i)r[i]=t(e[i]);return r}function RC(t,e,n){for(var r=e,i=0,s=n.length;i<s;++i)r=t(r,n[i],i);return r}function rAe(t,e){if(t<0)throw new TypeError("i must be >= 0");var n=e.length;return n===0||t>=n?e:n===1?[]:iAe(t,e,n-1)}function iAe(t,e,n){var r=new Array(n),i;for(i=0;i<t;++i)r[i]=e[i];for(i=t;i<n;++i)r[i]=e[i+1];return r}function sAe(t,e){for(var n=e.length,r=new Array(n),i=0,s=void 0,o=0;o<n;++o)s=e[o],t(s)||(r[i]=s,++i);return r.length=i,r}function LW(t,e){for(var n=0,r=e.length;n<r;++n)if(t===e[n])return n;return-1}/** @license MIT License (c) copyright 2010-2016 original author or authors */var oAe=function(t){return t},aAe=function(t,e){return function(n){return t(e(n))}},lAe=function(t,e){return t(e)};function Vn(t){function e(n,r){switch(arguments.length){case 0:return e;case 1:return function(i){return t(n,i)};default:return t(n,r)}}return e}function tl(t){function e(n,r,i){switch(arguments.length){case 0:return e;case 1:return Vn(function(s,o){return t(n,s,o)});case 2:return function(s){return t(n,r,s)};default:return t(n,r,i)}}return e}var cAe=function(){function t(e,n,r,i,s){this.time=e,this.localOffset=n,this.period=r,this.task=i,this.scheduler=s,this.active=!0}return t.prototype.run=function(){return this.task.run(this.time-this.localOffset)},t.prototype.error=function(e){return this.task.error(this.time-this.localOffset,e)},t.prototype.dispose=function(){return this.active=!1,this.scheduler.cancel(this),this.task.dispose()},t}(),BW=function(){function t(e,n){this.origin=e,this.scheduler=n}return t.prototype.currentTime=function(){return this.scheduler.currentTime()-this.origin},t.prototype.scheduleTask=function(e,n,r,i){return this.scheduler.scheduleTask(e+this.origin,n,r,i)},t.prototype.relative=function(e){return new t(e+this.origin,this.scheduler)},t.prototype.cancel=function(e){return this.scheduler.cancel(e)},t.prototype.cancelAll=function(e){return this.scheduler.cancelAll(e)},t}();/** @license MIT License (c) copyright 2010-2017 original author or authors */var uAe=function(t){return Promise.resolve(t).then(zW)};function zW(t){try{return t.run()}catch(e){return t.error(e)}}/** @license MIT License (c) copyright 2010-2017 original author or authors */var hAe=function(){function t(e,n){var r=this;this._runReadyTasksBound=function(){return r._runReadyTasks()},this.timer=e,this.timeline=n,this._timer=null,this._nextArrival=1/0}return t.prototype.currentTime=function(){return this.timer.now()},t.prototype.scheduleTask=function(e,n,r,i){var s=this.currentTime()+Math.max(0,n),o=new cAe(s,e,r,i,this);return this.timeline.add(o),this._scheduleNextRun(),o},t.prototype.relative=function(e){return new BW(e,this)},t.prototype.cancel=function(e){e.active=!1,this.timeline.remove(e)&&this._reschedule()},t.prototype.cancelAll=function(e){this.timeline.removeAll(e),this._reschedule()},t.prototype._reschedule=function(){this.timeline.isEmpty()?this._unschedule():this._scheduleNextRun()},t.prototype._unschedule=function(){this.timer.clearTimer(this._timer),this._timer=null},t.prototype._scheduleNextRun=function(){if(!this.timeline.isEmpty()){var e=this.timeline.nextArrival();this._timer===null?this._scheduleNextArrival(e):e<this._nextArrival&&(this._unschedule(),this._scheduleNextArrival(e))}},t.prototype._scheduleNextArrival=function(e){this._nextArrival=e;var n=Math.max(0,e-this.currentTime());this._timer=this.timer.setTimer(this._runReadyTasksBound,n)},t.prototype._runReadyTasks=function(){this._timer=null,this.timeline.runTasks(this.currentTime(),zW),this._scheduleNextRun()},t}();/** @license MIT License (c) copyright 2010-2017 original author or authors */var fAe=function(){function t(){this.tasks=[]}return t.prototype.nextArrival=function(){return this.isEmpty()?1/0:this.tasks[0].time},t.prototype.isEmpty=function(){return this.tasks.length===0},t.prototype.add=function(e){VW(e,this.tasks)},t.prototype.remove=function(e){var n=WW(UW(e),this.tasks);if(n>=0&&n<this.tasks.length){var r=this.tasks[n].events,i=LW(e,r);if(i>=0)return r.splice(i,1),r.length===0&&this.tasks.splice(n,1),!0}return!1},t.prototype.removeAll=function(e){for(var n=0;n<this.tasks.length;++n)vAe(e,this.tasks[n])},t.prototype.runTasks=function(e,n){for(var r=this.tasks,i=r.length,s=0;s<i&&r[s].time<=e;)++s;this.tasks=r.slice(s);for(var o=0;o<s;++o)this.tasks=dAe(n,r[o].events,this.tasks)},t}();function dAe(t,e,n){for(var r=0;r<e.length;++r){var i=e[r];i.active&&(t(i),i.period>=0&&i.active&&(i.time=i.time+i.period,VW(i,n)))}return n}function VW(t,e){var n=e.length,r=UW(t);if(n===0){e.push(KN(r,[t]));return}var i=WW(r,e);i>=n?e.push(KN(r,[t])):pAe(t,e,r,i)}function pAe(t,e,n,r){var i=e[r];n===i.time?mAe(t,i.events):e.splice(r,0,KN(n,[t]))}function mAe(t,e){e.length===0||t.time>=e[e.length-1].time?e.push(t):gAe(t,e)}function gAe(t,e){for(var n=0;n<e.length;n++)if(t.time<e[n].time){e.splice(n,0,t);break}}function UW(t){return Math.floor(t.time)}function vAe(t,e){e.events=sAe(t,e.events)}function WW(t,e){for(var n=0,r=e.length,i,s;n<r;){if(i=Math.floor((n+r)/2),s=e[i],t===s.time)return i;t<s.time?r=i:n=i+1}return r}var KN=function(t,e){return{time:t,events:e}};/** @license MIT License (c) copyright 2010-2017 original author or authors */var yAe=function(){function t(e){this._clock=e}return t.prototype.now=function(){return this._clock.now()},t.prototype.setTimer=function(e,n){return n<=0?bAe(e):setTimeout(e,n)},t.prototype.clearTimer=function(e){return e instanceof GW?e.cancel():clearTimeout(e)},t}(),GW=function(){function t(e){this.f=e,this.active=!0}return t.prototype.run=function(){if(this.active)return this.f()},t.prototype.error=function(e){throw e},t.prototype.cancel=function(){this.active=!1},t}();function bAe(t){var e=new GW(t);return uAe(e),e}var wAe=function(){function t(e,n){this.origin=n,this.clock=e}return t.prototype.now=function(){return this.clock.now()-this.origin},t}(),xAe=function(){function t(e,n){this.origin=n,this.hrtime=e}return t.prototype.now=function(){var e=this.hrtime(this.origin);return(e[0]*1e9+e[1])/1e6},t}(),HW=function(t){return new wAe(t,t.now())},_Ae=function(){return HW(performance)},SAe=function(){return HW(Date)},CAe=function(){return new xAe(process.hrtime,process.hrtime())},TAe=function(){return typeof performance!="undefined"&&typeof performance.now=="function"?_Ae():typeof process!="undefined"&&typeof process.hrtime=="function"?CAe():SAe()},DC=function(t){return t.currentTime()},PC=Vn(function(t,e){return e.scheduleTask(0,0,-1,t)}),OC=tl(function(t,e,n){return n.scheduleTask(0,t,-1,e)}),EAe=tl(function(t,e,n){return n.scheduleTask(0,0,t,e)}),kAe=function(t){return t.dispose()},YN=Vn(function(t,e){return new BW(t,e)}),AAe=function(){return new hAe(MAe(),new fAe)},MAe=function(){return new yAe(TAe())},hb=function(){return jW},jW=new(function(){function t(){}return t.prototype.dispose=function(){},t}()),IAe=function(t){return t===jW},ZN=function(t){return new NAe(t)},NAe=function(){function t(e){this.disposed=!1,this.disposable=e}return t.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposable&&(this.disposable.dispose(),this.disposable=void 0))},t}();/** @license MIT License (c) copyright 2010 original author or authors */var fb=function(t){var e=RC($Ae,[],t);return e.length===0?hb():new qW(e)},Jm=Vn(function(t,e){return fb([t,e])}),$Ae=function(t,e){return IAe(e)?t:e instanceof qW?tAe(t,e.disposables):FW(e,t)},qW=function(){function t(e){this.disposables=e}return t.prototype.dispose=function(){PAe(RAe(this.disposables))},t}(),RAe=function(t){return RC(DAe,[],t)},DAe=function(t,e){try{e.dispose()}catch(n){t.push(n)}return t},PAe=function(t){if(t.length>0)throw new XW(t.length+" errors",t)},XW=function(){function t(e,n){this.name="DisposeAllError",this.message=e,this.errors=n,Error.call(this,e),Error.captureStackTrace&&Error.captureStackTrace(this,t),this.stack=""+this.stack+OAe(this.errors)}return t}();XW.prototype=Object.create(Error.prototype);var OAe=function(t){return RC(FAe,"",t)},FAe=function(t,e,n){return t+(`
[`+(n+1)+"] "+e.stack)};/** @license MIT License (c) copyright 2010-2017 original author or authors */var $f=tl(function(t,e,n){try{e.dispose()}catch(r){n.error(t,r)}});/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var JN=function(t,e){return JN=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])},JN(t,e)};function ir(t,e){JN(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}/** @license MIT License (c) copyright 2010-2016 original author or authors */function KW(t){setTimeout(LAe,0,t)}function LAe(t){throw t}/** @license MIT License (c) copyright 2010-2016 original author or authors */var BAe=function(t,e,n){return new VAe(t,e,n)},QN=function(t,e){return new UAe(t,e)},YW=function(t){return new WAe(t)},zAe=function(t,e){return new GAe(t,e)},FC=function(){function t(e){this.sink=e,this.active=!0}return t.prototype.dispose=function(){this.active=!1},t.prototype.run=function(e){!this.active||this.runIfActive(e)},t.prototype.error=function(e,n){if(!this.active)return KW(n);this.sink.error(e,n)},t}(),VAe=function(t){ir(e,t);function e(n,r,i){var s=t.call(this,i)||this;return s.runEvent=n,s.value=r,s}return e.prototype.runIfActive=function(n){this.runEvent(n,this.value,this.sink)},e}(FC),UAe=function(t){ir(e,t);function e(n,r){var i=t.call(this,r)||this;return i.value=n,i}return e.prototype.runIfActive=function(n){this.sink.event(n,this.value)},e}(FC),WAe=function(t){ir(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.runIfActive=function(n){this.sink.end(n)},e}(FC),GAe=function(t){ir(e,t);function e(n,r){var i=t.call(this,r)||this;return i.value=n,i}return e.prototype.runIfActive=function(n){this.sink.error(n,this.value)},e}(FC);/** @license MIT License (c) copyright 2010-2017 original author or authors */var Ni=function(){return JW},mi=function(t){return t===JW},ZW=function(t){return t.some(mi)},HAe=function(){function t(){}return t.prototype.run=function(e,n){return PC(YW(e),n)},t}(),JW=new HAe;/** @license MIT License (c) copyright 2010-2017 original author or authors */var db=function(){return qAe},jAe=function(){function t(){}return t.prototype.run=function(){return hb()},t}(),qAe=new jAe;/** @license MIT License (c) copyright 2010-2017 original author or authors */var QW=function(t,e){return new XAe(t,e)},XAe=function(){function t(e,n){this.time=e,this.value=n}return t.prototype.run=function(e,n){return OC(this.time,BAe(KAe,this.value,e),n)},t}();function KAe(t,e,n){n.event(t,e),n.end(t)}/** @license MIT License (c) copyright 2010-2017 original author or authors */var e$=function(t){return QW(0,t)};/** @license MIT License (c) copyright 2010-2016 original author or authors */var YAe=function(t){return new ZAe(t)},ZAe=function(){function t(e){this.period=e}return t.prototype.run=function(e,n){return EAe(this.period,QN(void 0,e),n)},t}(),LC=function(){function t(){this.disposable=void 0,this.disposed=!1}return t.prototype.setDisposable=function(e){if(this.disposable!==void 0)throw new Error("setDisposable called more than once");this.disposable=e,this.disposed&&e.dispose()},t.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposable!==void 0&&this.disposable.dispose())},t}();/** @license MIT License (c) copyright 2010-2017 original author or authors */var JAe=Vn(function(t,e){return new Promise(function(n,r){return QAe(t,e,n,r)})});function QAe(t,e,n,r){var i=new LC,s=new eMe(n,r,i);i.setDisposable(t.run(s,e))}var eMe=function(){function t(e,n,r){this._end=e,this._error=n,this._disposable=r,this.active=!0}return t.prototype.event=function(){},t.prototype.end=function(){!this.active||this.dispose(this._error,this._end,void 0)},t.prototype.error=function(e,n){this.dispose(this._error,this._error,n)},t.prototype.dispose=function(e,n,r){this.active=!1,tMe(e,n,r,this._disposable)},t}();function tMe(t,e,n,r){try{r.dispose()}catch(i){t(i);return}e(n)}var eG=function(t,e,n){return n.run(t,e)},t$=function(){function t(e,n){this.sink=n,this.offset=e}return t.prototype.event=function(e,n){this.sink.event(e+this.offset,n)},t.prototype.error=function(e,n){this.sink.error(e+this.offset,n)},t.prototype.end=function(e){this.sink.end(e+this.offset)},t}(),n$=function(t,e){return new nMe(t,e)},nMe=function(){function t(e,n){this.origin=e,this.source=n}return t.prototype.run=function(e,n){return this.source.run(rMe(this.origin,e),YN(this.origin,n))},t}(),rMe=function(t,e){return e instanceof t$?new t$(t+e.offset,e.sink):new t$(t,e)},Rr=function(){function t(e){this.sink=e}return t.prototype.end=function(e){return this.sink.end(e)},t.prototype.error=function(e,n){return this.sink.error(e,n)},t}();/** @license MIT License (c) copyright 2010 original author or authors */var iMe=function(t,e,n){return mi(n)?Ni():new sMe(t,e,n)},sMe=function(){function t(e,n,r){this.step=e,this.seed=n,this.source=r}return t.prototype.run=function(e,n){return this.source.run(new oMe(this.step,this.seed,e),n)},t}(),oMe=function(t){ir(e,t);function e(n,r,i){var s=t.call(this,i)||this;return s.step=n,s.seed=r,s}return e.prototype.event=function(n,r){var i=this.step(this.seed,r);this.seed=i.seed,this.sink.event(n,i.value)},e}(Rr);/** @license MIT License (c) copyright 2010-2016 original author or authors */var aMe=function(t,e,n){return new lMe(t,e,n)},lMe=function(){function t(e,n,r){this.source=r,this.f=e,this.value=n}return t.prototype.run=function(e,n){var r=PC(QN(this.value,e),n),i=this.source.run(new cMe(this.f,this.value,e),n);return Jm(r,i)},t}(),cMe=function(t){ir(e,t);function e(n,r,i){var s=t.call(this,i)||this;return s.f=n,s.value=r,s}return e.prototype.event=function(n,r){var i=this.f;this.value=i(this.value,r),this.sink.event(n,this.value)},e}(Rr);/** @license MIT License (c) copyright 2010-2016 original author or authors */var tG=function(t,e){return new uMe(t,e)},uMe=function(){function t(e,n){this.f=e,this.source=n}return t.prototype.run=function(e,n){return new hMe(this.f,this.source,e,n)},t}(),hMe=function(t){ir(e,t);function e(n,r,i,s){var o=t.call(this,i)||this;return o.f=n,o.scheduler=s,o.active=!0,o.disposable=ZN(r.run(o,s)),o}return e.prototype.event=function(n,r){!this.active||this.sink.event(n,r)},e.prototype.end=function(n){!this.active||($f(n,this.disposable,this.sink),this.startNext(n,this.sink))},e.prototype.startNext=function(n,r){try{this.disposable=this.continue(this.f,n,r)}catch(i){r.error(n,i)}},e.prototype.continue=function(n,r,i){return eG(i,this.scheduler,n$(r,n()))},e.prototype.dispose=function(){return this.active=!1,this.disposable.dispose()},e}(Rr);/** @license MIT License (c) copyright 2010-2017 original author or authors */var fMe=function(t,e){return tG(function(){return e},e$(t))};/** @license MIT License (c) copyright 2010-2016 original author or authors */var nG=function(){function t(e,n){this.p=e,this.source=n}return t.prototype.run=function(e,n){return this.source.run(new dMe(this.p,e),n)},t.create=function(e,n){return mi(n)?n:n instanceof t?new t(pMe(n.p,e),n.source):new t(e,n)},t}(),dMe=function(t){ir(e,t);function e(n,r){var i=t.call(this,r)||this;return i.p=n,i}return e.prototype.event=function(n,r){var i=this.p;i(r)&&this.sink.event(n,r)},e}(Rr),pMe=function(t,e){return function(n){return t(n)&&e(n)}};/** @license MIT License (c) copyright 2010-2016 original author or authors */var mMe=function(){function t(e,n,r){this.p=e,this.f=n,this.source=r}return t.prototype.run=function(e,n){return this.source.run(new gMe(this.p,this.f,e),n)},t}(),gMe=function(t){ir(e,t);function e(n,r,i){var s=t.call(this,i)||this;return s.p=n,s.f=r,s}return e.prototype.event=function(n,r){var i=this.f,s=this.p;s(r)&&this.sink.event(n,i(r))},e}(Rr);/** @license MIT License (c) copyright 2010-2016 original author or authors */var pb=function(){function t(e,n){this.f=e,this.source=n}return t.prototype.run=function(e,n){return this.source.run(new vMe(this.f,e),n)},t.create=function(e,n){return mi(n)?Ni():n instanceof t?new t(aAe(e,n.f),n.source):n instanceof nG?new mMe(n.p,e,n.source):new t(e,n)},t}(),vMe=function(t){ir(e,t);function e(n,r){var i=t.call(this,r)||this;return i.f=n,i}return e.prototype.event=function(n,r){var i=this.f;this.sink.event(n,i(r))},e}(Rr);/** @license MIT License (c) copyright 2010-2016 original author or authors */var BC=function(t,e){return pb.create(t,e)},yMe=function(t,e){return BC(function(){return t},e)},bMe=function(t,e){return new wMe(t,e)},wMe=function(){function t(e,n){this.source=n,this.f=e}return t.prototype.run=function(e,n){return this.source.run(new xMe(this.f,e),n)},t}(),xMe=function(t){ir(e,t);function e(n,r){var i=t.call(this,r)||this;return i.f=n,i}return e.prototype.event=function(n,r){var i=this.f;i(r),this.sink.event(n,r)},e}(Rr);/** @license MIT License (c) copyright 2010-2016 original author or authors */var r$=function(t){ir(e,t);function e(n,r){var i=t.call(this,r)||this;return i.index=n,i.active=!0,i.value=void 0,i}return e.prototype.event=function(n,r){!this.active||(this.value=r,this.sink.event(n,this))},e.prototype.end=function(n){!this.active||(this.active=!1,this.sink.event(n,this))},e}(Rr);/** @license MIT License (c) copyright 2010-2016 original author or authors */function rG(t,e){switch(e.length){case 0:return t();case 1:return t(e[0]);case 2:return t(e[0],e[1]);case 3:return t(e[0],e[1],e[2]);case 4:return t(e[0],e[1],e[2],e[3]);case 5:return t(e[0],e[1],e[2],e[3],e[4]);default:return t.apply(void 0,e)}}/** @license MIT License (c) copyright 2010 original author or authors */var iG=function(t,e,n){return _Me(t,[e,n])},_Me=function(t,e){return e.length===0||ZW(e)?Ni():e.length===1?BC(t,e[0]):new SMe(t,e)},SMe=function(){function t(e,n){this.f=e,this.sources=n}return t.prototype.run=function(e,n){for(var r=this.sources.length,i=new Array(r),s=new Array(r),o=new CMe(i,s.length,e,this.f),a=void 0,l=0;l<r;++l)a=s[l]=new r$(l,o),i[l]=this.sources[l].run(a,n);return fb(i)},t}(),CMe=function(t){ir(e,t);function e(n,r,i,s){var o=t.call(this,i)||this;return o.disposables=n,o.f=s,o.awaiting=r,o.values=new Array(r),o.hasValue=new Array(r).fill(!1),o.activeCount=r,o}return e.prototype.event=function(n,r){if(!r.active){this.dispose(n,r.index);return}var i=r.index,s=this.updateReady(i);this.values[i]=r.value,s===0&&this.sink.event(n,rG(this.f,this.values))},e.prototype.updateReady=function(n){return this.awaiting>0&&(this.hasValue[n]||(this.hasValue[n]=!0,this.awaiting-=1)),this.awaiting},e.prototype.dispose=function(n,r){$f(n,this.disposables[r],this.sink),--this.activeCount==0&&this.sink.end(n)},e}(Rr);/** @license MIT License (c) copyright 2010-2016 original author or authors */function TMe(t,e){return iG(lAe,t,e)}/** @license MIT License (c) copyright 2010 original author or authors */var sG=function(t,e){return zC(oAe,t,e)},zC=function(t,e,n){return mi(n)?Ni():new EMe(t,e,n)},EMe=function(){function t(e,n,r){this.f=e,this.concurrency=n,this.source=r}return t.prototype.run=function(e,n){return new AMe(this.f,this.concurrency,this.source,e,n)},t}(),kMe=function(t){return t.length>0},AMe=function(){function t(e,n,r,i,s){this.f=e,this.concurrency=n,this.sink=i,this.scheduler=s,this.pending=[],this.current=[],this.disposable=ZN(r.run(this,s)),this.active=!0}return t.prototype.event=function(e,n){this.addInner(e,n)},t.prototype.addInner=function(e,n){this.current.length<this.concurrency?this.startInner(e,n):this.pending.push(n)},t.prototype.startInner=function(e,n){try{this.initInner(e,n)}catch(r){this.error(e,r)}},t.prototype.initInner=function(e,n){var r=new IMe(e,this,this.sink);r.disposable=MMe(this.f,e,n,r,this.scheduler),this.current.push(r)},t.prototype.end=function(e){this.active=!1,$f(e,this.disposable,this.sink),this.checkEnd(e)},t.prototype.error=function(e,n){this.active=!1,this.sink.error(e,n)},t.prototype.dispose=function(){this.active=!1,this.pending.length=0,this.disposable.dispose(),fb(this.current).dispose()},t.prototype.endInner=function(e,n){var r=this.current.indexOf(n);r>=0&&this.current.splice(r,1),$f(e,n,this);var i=this.pending;kMe(i)?this.startInner(e,i.shift()):this.checkEnd(e)},t.prototype.checkEnd=function(e){!this.active&&this.current.length===0&&this.sink.end(e)},t}(),MMe=function(t,e,n,r,i){return t(n).run(r,YN(e,i))},IMe=function(){function t(e,n,r){this.time=e,this.outer=n,this.sink=r,this.disposable=hb()}return t.prototype.event=function(e,n){this.sink.event(e+this.time,n)},t.prototype.end=function(e){this.outer.endInner(e+this.time,this)},t.prototype.error=function(e,n){this.outer.error(e+this.time,n)},t.prototype.dispose=function(){return this.disposable.dispose()},t}();/** @license MIT License (c) copyright 2010-2016 original author or authors */var NMe=function(t,e){return zC(t,1/0,e)},oG=function(t){return sG(1/0,t)};/** @license MIT License (c) copyright 2010-2016 original author or authors */var $Me=function(t,e){return zC(t,1,e)};/** @license MIT License (c) copyright 2010-2016 original author or authors */function RMe(t,e){return DMe([t,e])}var DMe=function(t){return PMe(OMe(t))},PMe=function(t){return t.length===0?Ni():t.length===1?t[0]:new aG(RC(LMe,[],t))},OMe=function(t){return t.filter(FMe)},FMe=function(t){return!mi(t)},LMe=function(t,e){return t.concat(e instanceof aG?e.sources:e)},aG=function(){function t(e){this.sources=e}return t.prototype.run=function(e,n){for(var r=this.sources.length,i=new Array(r),s=new Array(r),o=new BMe(i,s,e),a=void 0,l=0;l<r;++l)a=s[l]=new r$(l,o),i[l]=this.sources[l].run(a,n);return fb(i)},t}(),BMe=function(t){ir(e,t);function e(n,r,i){var s=t.call(this,i)||this;return s.disposables=n,s.activeCount=r.length,s}return e.prototype.event=function(n,r){if(!r.active){this.dispose(n,r.index);return}this.sink.event(n,r.value)},e.prototype.dispose=function(n,r){$f(n,this.disposables[r],this.sink),--this.activeCount==0&&this.sink.end(n)},e}(Rr);/** @license MIT License (c) copyright 2010 original author or authors */var zMe=function(t,e){return lG(function(n){return n},t,e)},lG=function(t,e,n){return mi(n)||mi(e)?Ni():new VMe(t,e,n)},VMe=function(){function t(e,n,r){this.f=e,this.values=n,this.sampler=r}return t.prototype.run=function(e,n){var r=new UMe(this.f,e),i=this.values.run(r.latest,n),s=this.sampler.run(r,n);return Jm(s,i)},t}(),UMe=function(t){ir(e,t);function e(n,r){var i=t.call(this,r)||this;return i.f=n,i.latest=new WMe(i),i}return e.prototype.event=function(n,r){if(this.latest.hasValue){var i=this.f;this.sink.event(n,i(this.latest.value,r))}},e}(Rr),WMe=function(t){ir(e,t);function e(n){var r=t.call(this,n)||this;return r.hasValue=!1,r}return e.prototype.event=function(n,r){this.value=r,this.hasValue=!0},e.prototype.end=function(){},e}(Rr);/** @license MIT License (c) copyright 2010 original author or authors */var cG=function(t,e){var n=Math.max(0,t),r=Math.max(n,e);return{min:n,max:r}},GMe=function(t,e){return cG(t.min+e.min,Math.min(t.max,t.min+e.max))},HMe=function(t){return t.min>=t.max},jMe=function(t){return t.min<=0&&t.max===1/0},uG=function(t,e){return i$(0,t,e)},qMe=function(t,e){return i$(t,1/0,e)},i$=function(t,e,n){return s$(cG(t,e),n)},s$=function(t,e){return XMe(t,e)?Ni():e instanceof pb?YMe(t,e):e instanceof hG?ZMe(t,e):KMe(t,e)},XMe=function(t,e){return mi(e)||HMe(t)},KMe=function(t,e){return jMe(t)?e:new hG(t,e)},YMe=function(t,e){return pb.create(e.f,s$(t,e.source))},ZMe=function(t,e){return s$(GMe(e.bounds,t),e.source)},hG=function(){function t(e,n){this.source=n,this.bounds=e}return t.prototype.run=function(e,n){var r=new LC,i=new JMe(this.bounds.min,this.bounds.max-this.bounds.min,e,r);return r.setDisposable(this.source.run(i,n)),r},t}(),JMe=function(t){ir(e,t);function e(n,r,i,s){var o=t.call(this,i)||this;return o.skip=n,o.take=r,o.disposable=s,o}return e.prototype.event=function(n,r){if(this.skip>0){this.skip-=1;return}this.take!==0&&(this.take-=1,this.sink.event(n,r),this.take===0&&(this.disposable.dispose(),this.sink.end(n)))},e}(Rr),QMe=function(t,e){return mi(e)?Ni():new eIe(t,e)},eIe=function(){function t(e,n){this.p=e,this.source=n}return t.prototype.run=function(e,n){var r=new LC,i=new tIe(this.p,e,r);return r.setDisposable(this.source.run(i,n)),r},t}(),tIe=function(t){ir(e,t);function e(n,r,i){var s=t.call(this,r)||this;return s.p=n,s.active=!0,s.disposable=i,s}return e.prototype.event=function(n,r){if(!!this.active){var i=this.p;this.active=i(r),this.active?this.sink.event(n,r):(this.disposable.dispose(),this.sink.end(n))}},e}(Rr),nIe=function(t,e){return mi(e)?Ni():new rIe(t,e)},rIe=function(){function t(e,n){this.p=e,this.source=n}return t.prototype.run=function(e,n){return this.source.run(new iIe(this.p,e),n)},t}(),iIe=function(t){ir(e,t);function e(n,r){var i=t.call(this,r)||this;return i.p=n,i.skipping=!0,i}return e.prototype.event=function(n,r){if(this.skipping){var i=this.p;if(this.skipping=i(r),this.skipping)return}this.sink.event(n,r)},e}(Rr),sIe=function(t,e){return mi(e)?Ni():new oIe(t,e)},oIe=function(){function t(e,n){this.p=e,this.source=n}return t.prototype.run=function(e,n){return this.source.run(new aIe(this.p,e),n)},t}(),aIe=function(t){ir(e,t);function e(n,r){var i=t.call(this,r)||this;return i.p=n,i.skipping=!1,i}return e.prototype.event=function(n,r){if(!this.skipping){var i=this.p;this.skipping=i(r),this.sink.event(n,r),this.skipping&&this.sink.end(n)}},e}(Rr);/** @license MIT License (c) copyright 2017 original author or authors */var lIe=function(t,e){return fG(cIe,t,e)},fG=function(t,e,n){return mi(n)||e.length===0?Ni():new uIe(t,e,uG(e.length,n))},cIe=function(t){return t},uIe=function(){function t(e,n,r){this.f=e,this.items=n,this.source=r}return t.prototype.run=function(e,n){return this.source.run(new hIe(this.f,this.items,e),n)},t}(),hIe=function(t){ir(e,t);function e(n,r,i){var s=t.call(this,i)||this;return s.f=n,s.items=r,s.index=0,s}return e.prototype.event=function(n,r){var i=this.f;this.sink.event(n,i(this.items[this.index],r)),this.index+=1},e}(Rr),fIe=2,dIe=1e4,pIe=function(){function t(){this.head=0,this.tail=0,this.capacityMask=3,this.list=new Array(4)}return t.prototype.push=function(e){var n=this.tail;return this.list[n]=e,this.tail=n+1&this.capacityMask,this.tail===this.head&&this.growArray(),this.head<this.tail?this.tail-this.head:this.capacityMask+1-(this.head-this.tail)},t.prototype.shift=function(){var e=this.head;if(e!==this.tail){var n=this.list[e];return this.list[e]=void 0,this.head=e+1&this.capacityMask,e<fIe&&this.tail>dIe&&this.tail<=this.list.length>>>2&&this.shrinkArray(),n}},t.prototype.isEmpty=function(){return this.head===this.tail},t.prototype.length=function(){return this.head===this.tail?0:this.head<this.tail?this.tail-this.head:this.capacityMask+1-(this.head-this.tail)},t.prototype.growArray=function(){this.head&&(this.list=this.copyArray(),this.head=0),this.tail=this.list.length,this.list.length*=2,this.capacityMask=this.capacityMask<<1|1},t.prototype.shrinkArray=function(){this.list.length>>>=1,this.capacityMask>>>=1},t.prototype.copyArray=function(){var e=[],n=this.list,r=n.length,i;for(i=this.head;i<r;i++)e.push(n[i]);for(i=0;i<this.tail;i++)e.push(n[i]);return e},t}();/** @license MIT License (c) copyright 2010 original author or authors */function mIe(t,e,n){return gIe(t,[e,n])}var gIe=function(t,e){return e.length===0||ZW(e)?Ni():e.length===1?BC(t,e[0]):new vIe(t,e)},vIe=function(){function t(e,n){this.f=e,this.sources=n}return t.prototype.run=function(e,n){for(var r=this.sources.length,i=new Array(r),s=new Array(r),o=new Array(r),a=new yIe(this.f,o,s,e),l=void 0,c=0;c<r;++c)o[c]=new pIe,l=s[c]=new r$(c,a),i[c]=this.sources[c].run(l,n);return fb(i)},t}(),yIe=function(t){ir(e,t);function e(n,r,i,s){var o=t.call(this,s)||this;return o.f=n,o.sinks=i,o.buffers=r,o}return e.prototype.event=function(n,r){if(!r.active){this.dispose(n,r.index);return}var i=this.buffers,s=i[r.index];if(s.push(r.value),s.length()===1){if(!_Ie(i))return;bIe(this.f,n,i,this.sink),xIe(this.buffers,this.sinks)&&this.sink.end(n)}},e.prototype.dispose=function(n,r){var i=this.buffers[r];i.isEmpty()&&this.sink.end(n)},e}(Rr),bIe=function(t,e,n,r){return r.event(e,rG(t,nAe(wIe,n)))},wIe=function(t){return t.shift()};function xIe(t,e){for(var n=0,r=t.length;n<r;++n)if(t[n].isEmpty()&&!e[n].active)return!0;return!1}function _Ie(t){for(var e=0,n=t.length;e<n;++e)if(t[e].isEmpty())return!1;return!0}/** @license MIT License (c) copyright 2010-2016 original author or authors */var SIe=function(t){return mi(t)?Ni():new CIe(t)},CIe=function(){function t(e){this.source=e}return t.prototype.run=function(e,n){var r=new TIe(e,n);return Jm(r,this.source.run(r,n))},t}(),TIe=function(){function t(e,n){this.sink=e,this.scheduler=n,this.current=null,this.ended=!1}return t.prototype.event=function(e,n){this.disposeCurrent(e),this.current=new EIe(n,e,1/0,this,this.sink,this.scheduler)},t.prototype.end=function(e){this.ended=!0,this.checkEnd(e)},t.prototype.error=function(e,n){this.ended=!0,this.sink.error(e,n)},t.prototype.dispose=function(){return this.disposeCurrent(DC(this.scheduler))},t.prototype.disposeCurrent=function(e){if(this.current!==null)return this.current.dispose(e)},t.prototype.disposeInner=function(e,n){n.dispose(e),n===this.current&&(this.current=null)},t.prototype.checkEnd=function(e){this.ended&&this.current===null&&this.sink.end(e)},t.prototype.endInner=function(e,n){this.disposeInner(e,n),this.checkEnd(e)},t.prototype.errorInner=function(e,n,r){this.disposeInner(e,r),this.sink.error(e,n)},t}(),EIe=function(){function t(e,n,r,i,s,o){this.min=n,this.max=r,this.outer=i,this.sink=s,this.disposable=e.run(this,YN(n,o))}return t.prototype.event=function(e,n){var r=Math.max(0,e+this.min);r<this.max&&this.sink.event(r,n)},t.prototype.end=function(e){this.outer.endInner(e+this.min,this)},t.prototype.error=function(e,n){this.outer.errorInner(e+this.min,n,this)},t.prototype.dispose=function(e){$f(e,this.disposable,this.sink)},t}();/** @license MIT License (c) copyright 2010-2016 original author or authors */function kIe(t,e){return nG.create(t,e)}var AIe=function(t){return dG(NIe,t)},dG=function(t,e){return mi(e)?Ni():new MIe(t,e)},MIe=function(){function t(e,n){this.equals=e,this.source=n}return t.prototype.run=function(e,n){return this.source.run(new IIe(this.equals,e),n)},t}(),IIe=function(t){ir(e,t);function e(n,r){var i=t.call(this,r)||this;return i.equals=n,i.value=void 0,i.init=!0,i}return e.prototype.event=function(n,r){this.init?(this.init=!1,this.value=r,this.sink.event(n,r)):this.equals(this.value,r)||(this.value=r,this.sink.event(n,r))},e}(Rr);function NIe(t,e){return t===e}/** @license MIT License (c) copyright 2010-2016 original author or authors */var pG=function(t,e){return new RIe(t,e)},mG=function(t,e){return new DIe(t,e)},$Ie=function(t,e){return pG(oG(t),mG(t,e))},RIe=function(){function t(e,n){this.maxSignal=e,this.source=n}return t.prototype.run=function(e,n){var r=new LC,i=this.source.run(e,n),s=this.maxSignal.run(new FIe(e,r),n);return r.setDisposable(Jm(i,s)),r},t}(),DIe=function(){function t(e,n){this.minSignal=e,this.source=n}return t.prototype.run=function(e,n){var r=new OIe(this.minSignal,e,n),i=this.source.run(new PIe(r,e),n);return Jm(r,i)},t}(),PIe=function(t){ir(e,t);function e(n,r){var i=t.call(this,r)||this;return i.min=n,i}return e.prototype.event=function(n,r){this.min.allow&&this.sink.event(n,r)},e}(Rr),OIe=function(t){ir(e,t);function e(n,r,i){var s=t.call(this,r)||this;return s.allow=!1,s.disposable=n.run(s,i),s}return e.prototype.event=function(){this.allow=!0,this.dispose()},e.prototype.end=function(){},e.prototype.dispose=function(){this.disposable.dispose()},e}(Rr),FIe=function(t){ir(e,t);function e(n,r){var i=t.call(this,n)||this;return i.disposable=r,i}return e.prototype.event=function(n){this.disposable.dispose(),this.sink.end(n)},e.prototype.end=function(){},e}(Rr);/** @license MIT License (c) copyright 2010-2016 original author or authors */var LIe=function(t,e){return t<=0?e:new BIe(t,e)},BIe=function(){function t(e,n){this.dt=e,this.source=n}return t.prototype.run=function(e,n){var r=new zIe(this.dt,e,n);return Jm(r,this.source.run(r,n))},t}(),zIe=function(t){ir(e,t);function e(n,r,i){var s=t.call(this,r)||this;return s.dt=n,s.scheduler=i,s.tasks=[],s}return e.prototype.dispose=function(){this.tasks.forEach(kAe)},e.prototype.event=function(n,r){this.tasks.push(OC(this.dt,QN(r,this.sink),this.scheduler))},e.prototype.end=function(){this.tasks.push(OC(this.dt,YW(this.sink),this.scheduler))},e}(Rr);/** @license MIT License (c) copyright 2010-2017 original author or authors */var gG=function(t,e){return mi(e)?Ni():e instanceof pb?VIe(t,e):e instanceof o$?UIe(t,e):new o$(t,e)},VIe=function(t,e){return pb.create(e.f,gG(t,e.source))},UIe=function(t,e){return new o$(Math.max(t,e.period),e.source)},o$=function(){function t(e,n){this.period=e,this.source=n}return t.prototype.run=function(e,n){return this.source.run(new WIe(this.period,e),n)},t}(),WIe=function(t){ir(e,t);function e(n,r){var i=t.call(this,r)||this;return i.time=0,i.period=n,i}return e.prototype.event=function(n,r){n>=this.time&&(this.time=n+this.period,this.sink.event(n,r))},e}(Rr),GIe=function(t,e){return mi(e)?Ni():new HIe(t,e)},HIe=function(){function t(e,n){this.dt=e,this.source=n}return t.prototype.run=function(e,n){return new jIe(this.dt,this.source,e,n)},t}(),jIe=function(){function t(e,n,r,i){this.dt=e,this.sink=r,this.scheduler=i,this.timer=null,this.disposable=n.run(this,i)}return t.prototype.event=function(e,n){this.clearTimer(),this.value=n,this.timer=OC(this.dt,new qIe(this,n),this.scheduler)},t.prototype.handleEventFromTask=function(e,n){this.clearTimer(),this.sink.event(e,n)},t.prototype.end=function(e){this.clearTimer()&&(this.sink.event(e,this.value),this.value=void 0),this.sink.end(e)},t.prototype.error=function(e,n){this.clearTimer(),this.sink.error(e,n)},t.prototype.dispose=function(){this.clearTimer(),this.disposable.dispose()},t.prototype.clearTimer=function(){return this.timer===null?!1:(this.timer.dispose(),this.timer=null,!0)},t}(),qIe=function(){function t(e,n){this.sink=e,this.value=n}return t.prototype.run=function(e){this.sink.handleEventFromTask(e,this.value)},t.prototype.error=function(e,n){this.sink.error(e,n)},t.prototype.dispose=function(){},t}();/** @license MIT License (c) copyright 2010-2016 original author or authors */var vG=function(t){return mi(t)?Ni():new XIe(t)},XIe=function(){function t(e){this.source=e}return t.prototype.run=function(e,n){return this.source.run(new KIe(e,n),n)},t}(),KIe=function(){function t(e,n){var r=this;this.eventBound=function(i){return r.sink.event(DC(r.scheduler),i)},this.endBound=function(){return r.sink.end(DC(r.scheduler))},this.errorBound=function(i){return r.sink.error(DC(r.scheduler),i)},this.sink=e,this.scheduler=n,this.queue=Promise.resolve()}return t.prototype.event=function(e,n){var r=this;this.queue=this.queue.then(function(){return r.handlePromise(n)}).catch(this.errorBound)},t.prototype.end=function(){this.queue=this.queue.then(this.endBound).catch(this.errorBound)},t.prototype.error=function(e,n){var r=this;this.queue=this.queue.then(function(){return r.errorBound(n)}).catch(KW)},t.prototype.handlePromise=function(e){return e.then(this.eventBound)},t}(),YIe=function(){function t(e){this.sink=e,this.active=!0}return t.prototype.event=function(e,n){!this.active||this.sink.event(e,n)},t.prototype.end=function(e){!this.active||(this.disable(),this.sink.end(e))},t.prototype.error=function(e,n){this.disable(),this.sink.error(e,n)},t.prototype.disable=function(){return this.active=!1,this.sink},t}();/** @license MIT License (c) copyright 2010-2016 original author or authors */function yG(t,e,n){try{n.event(t,e)}catch(r){n.error(t,r)}}function bG(t,e){try{e.end(t)}catch(n){e.error(t,n)}}/** @license MIT License (c) copyright 2010-2016 original author or authors */var ZIe=function(t,e){return mi(e)?Ni():new eNe(t,e)},JIe=function(t){return new QIe(t)},QIe=function(){function t(e){this.value=e}return t.prototype.run=function(e,n){return PC(zAe(this.value,e),n)},t}(),eNe=function(){function t(e,n){this.f=e,this.source=n}return t.prototype.run=function(e,n){return new tNe(this.f,this.source,e,n)},t}(),tNe=function(){function t(e,n,r,i){this.f=e,this.sink=new YIe(r),this.scheduler=i,this.disposable=n.run(this,i)}return t.prototype.event=function(e,n){yG(e,n,this.sink)},t.prototype.end=function(e){bG(e,this.sink)},t.prototype.error=function(e,n){var r=this.sink.disable();$f(e,this.disposable,this.sink),this._startNext(e,n,r)},t.prototype._startNext=function(e,n,r){try{this.disposable=this._continue(this.f,e,n,r)}catch(i){r.error(e,i)}},t.prototype._continue=function(e,n,r,i){return eG(i,this.scheduler,n$(n,e(r)))},t.prototype.dispose=function(){return this.disposable.dispose()},t}(),nNe=function(t){return t instanceof wG||mi(t)?t:new wG(t)},wG=function(){function t(e){this.source=new rNe(e)}return t.prototype.run=function(e,n){return this.source.run(e,n)},t}(),rNe=function(){function t(e){this.source=e,this.sinks=[],this.disposable=hb()}return t.prototype.run=function(e,n){var r=this.add(e);return r===1&&(this.disposable=this.source.run(this,n)),ZN(new iNe(this,e))},t.prototype.dispose=function(){var e=this.disposable;return this.disposable=hb(),e.dispose()},t.prototype.add=function(e){return this.sinks=FW(e,this.sinks),this.sinks.length},t.prototype.remove=function(e){var n=LW(e,this.sinks);return n>=0&&(this.sinks=rAe(n,this.sinks)),this.sinks.length},t.prototype.event=function(e,n){var r=this.sinks;if(r.length===1)return r[0].event(e,n);for(var i=0;i<r.length;++i)yG(e,n,r[i])},t.prototype.end=function(e){for(var n=this.sinks,r=0;r<n.length;++r)bG(e,n[r])},t.prototype.error=function(e,n){for(var r=this.sinks,i=0;i<r.length;++i)r[i].error(e,n)},t}(),iNe=function(){function t(e,n){this.source=e,this.sink=n}return t.prototype.dispose=function(){this.source.remove(this.sink)===0&&this.source.dispose()},t}(),sNe=Vn(n$),oNe=tl(iMe),aNe=tl(aMe),xG=Vn(fMe),th=Vn(BC),lNe=Vn(yMe),_G=Vn(bMe),cNe=Vn(TMe),uNe=Vn(NMe),hNe=Vn(tG),fNe=Vn($Me),dNe=Vn(sG),pNe=tl(zC),SG=Vn(RMe),mNe=tl(iG),CG=Vn(zMe),gNe=tl(lG),vNe=tl(fG),yNe=Vn(lIe),bNe=tl(mIe),wNe=Vn(kIe),xNe=Vn(dG),_Ne=Vn(uG),SNe=Vn(qMe),CNe=tl(i$),TNe=Vn(QMe),ENe=Vn(nIe),kNe=Vn(sIe),TG=Vn(pG),ANe=Vn(mG),MNe=Vn($Ie),INe=Vn(LIe),NNe=Vn(gG),$Ne=Vn(GIe),RNe=Vn(ZIe),EG=function(){var t=[];return[function(e){return DNe(t,e)},new PNe(t)]},DNe=function(t,e){return t.forEach(function(n){var r=n.sink,i=n.scheduler;return FNe(i.currentTime(),e,r)})},PNe=function(){function t(e){this.sinks=e}return t.prototype.run=function(e,n){var r={sink:e,scheduler:n};return this.sinks.push(r),new ONe(r,this.sinks)},t}(),ONe=function(){function t(e,n){this.sink=e,this.sinks=n}return t.prototype.dispose=function(){var e=this.sinks.indexOf(this.sink);e>=0&&this.sinks.splice(e,1)},t}();function FNe(t,e,n){try{n.event(t,e)}catch(r){n.error(t,r)}}var a$={exports:{}},LNe=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,BNe=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],kG=function(e){var n=e,r=e.indexOf("["),i=e.indexOf("]");r!=-1&&i!=-1&&(e=e.substring(0,r)+e.substring(r,i).replace(/:/g,";")+e.substring(i,e.length));for(var s=LNe.exec(e||""),o={},a=14;a--;)o[BNe[a]]=s[a]||"";return r!=-1&&i!=-1&&(o.source=n,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=zNe(o,o.path),o.queryKey=VNe(o,o.query),o};function zNe(t,e){var n=/\/{2,9}/g,r=e.replace(n,"/").split("/");return(e.substr(0,1)=="/"||e.length===0)&&r.splice(0,1),e.substr(e.length-1,1)=="/"&&r.splice(r.length-1,1),r}function VNe(t,e){var n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,s){i&&(n[i]=s)}),n}var Qm={exports:{}},l$={exports:{}},mb=1e3,gb=mb*60,vb=gb*60,yb=vb*24,UNe=yb*365.25,WNe=function(t,e){e=e||{};var n=typeof t;if(n==="string"&&t.length>0)return GNe(t);if(n==="number"&&isNaN(t)===!1)return e.long?jNe(t):HNe(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function GNe(t){if(t=String(t),!(t.length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!!e){var n=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*UNe;case"days":case"day":case"d":return n*yb;case"hours":case"hour":case"hrs":case"hr":case"h":return n*vb;case"minutes":case"minute":case"mins":case"min":case"m":return n*gb;case"seconds":case"second":case"secs":case"sec":case"s":return n*mb;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function HNe(t){return t>=yb?Math.round(t/yb)+"d":t>=vb?Math.round(t/vb)+"h":t>=gb?Math.round(t/gb)+"m":t>=mb?Math.round(t/mb)+"s":t+"ms"}function jNe(t){return VC(t,yb,"day")||VC(t,vb,"hour")||VC(t,gb,"minute")||VC(t,mb,"second")||t+" ms"}function VC(t,e,n){if(!(t<e))return t<e*1.5?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}(function(t,e){e=t.exports=r.debug=r.default=r,e.coerce=l,e.disable=o,e.enable=s,e.enabled=a,e.humanize=WNe,e.instances=[],e.names=[],e.skips=[],e.formatters={};function n(c){var u=0,h;for(h in c)u=(u<<5)-u+c.charCodeAt(h),u|=0;return e.colors[Math.abs(u)%e.colors.length]}function r(c){var u;function h(){if(!!h.enabled){var f=h,d=+new Date,p=d-(u||d);f.diff=p,f.prev=u,f.curr=d,u=d;for(var m=new Array(arguments.length),v=0;v<m.length;v++)m[v]=arguments[v];m[0]=e.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");var y=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,function(x,_){if(x==="%%")return x;y++;var S=e.formatters[_];if(typeof S=="function"){var T=m[y];x=S.call(f,T),m.splice(y,1),y--}return x}),e.formatArgs.call(f,m);var w=h.log||e.log||console.log.bind(console);w.apply(f,m)}}return h.namespace=c,h.enabled=e.enabled(c),h.useColors=e.useColors(),h.color=n(c),h.destroy=i,typeof e.init=="function"&&e.init(h),e.instances.push(h),h}function i(){var c=e.instances.indexOf(this);return c!==-1?(e.instances.splice(c,1),!0):!1}function s(c){e.save(c),e.names=[],e.skips=[];var u,h=(typeof c=="string"?c:"").split(/[\s,]+/),f=h.length;for(u=0;u<f;u++)!h[u]||(c=h[u].replace(/\*/g,".*?"),c[0]==="-"?e.skips.push(new RegExp("^"+c.substr(1)+"$")):e.names.push(new RegExp("^"+c+"$")));for(u=0;u<e.instances.length;u++){var d=e.instances[u];d.enabled=e.enabled(d.namespace)}}function o(){e.enable("")}function a(c){if(c[c.length-1]==="*")return!0;var u,h;for(u=0,h=e.skips.length;u<h;u++)if(e.skips[u].test(c))return!1;for(u=0,h=e.names.length;u<h;u++)if(e.names[u].test(c))return!0;return!1}function l(c){return c instanceof Error?c.stack||c.message:c}})(l$,l$.exports);(function(t,e){e=t.exports=l$.exports,e.log=i,e.formatArgs=r,e.save=s,e.load=o,e.useColors=n,e.storage=typeof chrome!="undefined"&&typeof chrome.storage!="undefined"?chrome.storage.local:a(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){return typeof window!="undefined"&&window.process&&window.process.type==="renderer"?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}e.formatters.j=function(l){try{return JSON.stringify(l)}catch(c){return"[UnexpectedJSONParseError]: "+c.message}};function r(l){var c=this.useColors;if(l[0]=(c?"%c":"")+this.namespace+(c?" %c":" ")+l[0]+(c?"%c ":" ")+"+"+e.humanize(this.diff),!!c){var u="color: "+this.color;l.splice(1,0,u,"color: inherit");var h=0,f=0;l[0].replace(/%[a-zA-Z%]/g,function(d){d!=="%%"&&(h++,d==="%c"&&(f=h))}),l.splice(f,0,u)}}function i(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(l){try{l==null?e.storage.removeItem("debug"):e.storage.debug=l}catch{}}function o(){var l;try{l=e.storage.debug}catch{}return!l&&typeof process!="undefined"&&"env"in process&&(l={}.DEBUG),l}e.enable(o());function a(){try{return window.localStorage}catch{}}})(Qm,Qm.exports);var qNe=kG,AG=Qm.exports("socket.io-client:url"),XNe=KNe;function KNe(t,e){var n=t;e=e||typeof location!="undefined"&&location,t==null&&(t=e.protocol+"//"+e.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=e.protocol+t:t=e.host+t),/^(https?|wss?):\/\//.test(t)||(AG("protocol-less url %s",t),typeof e!="undefined"?t=e.protocol+"//"+t:t="https://"+t),AG("parse %s",t),n=qNe(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";var r=n.host.indexOf(":")!==-1,i=r?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+i+":"+n.port,n.href=n.protocol+"://"+i+(e&&e.port===n.port?"":":"+n.port),n}var UC={},c$={exports:{}},u$={exports:{}},bb=1e3,wb=bb*60,xb=wb*60,_b=xb*24,YNe=_b*365.25,ZNe=function(t,e){e=e||{};var n=typeof t;if(n==="string"&&t.length>0)return JNe(t);if(n==="number"&&isNaN(t)===!1)return e.long?e$e(t):QNe(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function JNe(t){if(t=String(t),!(t.length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!!e){var n=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*YNe;case"days":case"day":case"d":return n*_b;case"hours":case"hour":case"hrs":case"hr":case"h":return n*xb;case"minutes":case"minute":case"mins":case"min":case"m":return n*wb;case"seconds":case"second":case"secs":case"sec":case"s":return n*bb;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function QNe(t){return t>=_b?Math.round(t/_b)+"d":t>=xb?Math.round(t/xb)+"h":t>=wb?Math.round(t/wb)+"m":t>=bb?Math.round(t/bb)+"s":t+"ms"}function e$e(t){return WC(t,_b,"day")||WC(t,xb,"hour")||WC(t,wb,"minute")||WC(t,bb,"second")||t+" ms"}function WC(t,e,n){if(!(t<e))return t<e*1.5?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}(function(t,e){e=t.exports=r.debug=r.default=r,e.coerce=l,e.disable=o,e.enable=s,e.enabled=a,e.humanize=ZNe,e.instances=[],e.names=[],e.skips=[],e.formatters={};function n(c){var u=0,h;for(h in c)u=(u<<5)-u+c.charCodeAt(h),u|=0;return e.colors[Math.abs(u)%e.colors.length]}function r(c){var u;function h(){if(!!h.enabled){var f=h,d=+new Date,p=d-(u||d);f.diff=p,f.prev=u,f.curr=d,u=d;for(var m=new Array(arguments.length),v=0;v<m.length;v++)m[v]=arguments[v];m[0]=e.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");var y=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,function(x,_){if(x==="%%")return x;y++;var S=e.formatters[_];if(typeof S=="function"){var T=m[y];x=S.call(f,T),m.splice(y,1),y--}return x}),e.formatArgs.call(f,m);var w=h.log||e.log||console.log.bind(console);w.apply(f,m)}}return h.namespace=c,h.enabled=e.enabled(c),h.useColors=e.useColors(),h.color=n(c),h.destroy=i,typeof e.init=="function"&&e.init(h),e.instances.push(h),h}function i(){var c=e.instances.indexOf(this);return c!==-1?(e.instances.splice(c,1),!0):!1}function s(c){e.save(c),e.names=[],e.skips=[];var u,h=(typeof c=="string"?c:"").split(/[\s,]+/),f=h.length;for(u=0;u<f;u++)!h[u]||(c=h[u].replace(/\*/g,".*?"),c[0]==="-"?e.skips.push(new RegExp("^"+c.substr(1)+"$")):e.names.push(new RegExp("^"+c+"$")));for(u=0;u<e.instances.length;u++){var d=e.instances[u];d.enabled=e.enabled(d.namespace)}}function o(){e.enable("")}function a(c){if(c[c.length-1]==="*")return!0;var u,h;for(u=0,h=e.skips.length;u<h;u++)if(e.skips[u].test(c))return!1;for(u=0,h=e.names.length;u<h;u++)if(e.names[u].test(c))return!0;return!1}function l(c){return c instanceof Error?c.stack||c.message:c}})(u$,u$.exports);(function(t,e){e=t.exports=u$.exports,e.log=i,e.formatArgs=r,e.save=s,e.load=o,e.useColors=n,e.storage=typeof chrome!="undefined"&&typeof chrome.storage!="undefined"?chrome.storage.local:a(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){return typeof window!="undefined"&&window.process&&window.process.type==="renderer"?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}e.formatters.j=function(l){try{return JSON.stringify(l)}catch(c){return"[UnexpectedJSONParseError]: "+c.message}};function r(l){var c=this.useColors;if(l[0]=(c?"%c":"")+this.namespace+(c?" %c":" ")+l[0]+(c?"%c ":" ")+"+"+e.humanize(this.diff),!!c){var u="color: "+this.color;l.splice(1,0,u,"color: inherit");var h=0,f=0;l[0].replace(/%[a-zA-Z%]/g,function(d){d!=="%%"&&(h++,d==="%c"&&(f=h))}),l.splice(f,0,u)}}function i(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(l){try{l==null?e.storage.removeItem("debug"):e.storage.debug=l}catch{}}function o(){var l;try{l=e.storage.debug}catch{}return!l&&typeof process!="undefined"&&"env"in process&&(l={}.DEBUG),l}e.enable(o());function a(){try{return window.localStorage}catch{}}})(c$,c$.exports);var Rf={exports:{}};(function(t){t.exports=e;function e(r){if(r)return n(r)}function n(r){for(var i in e.prototype)r[i]=e.prototype[i];return r}e.prototype.on=e.prototype.addEventListener=function(r,i){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(i),this},e.prototype.once=function(r,i){function s(){this.off(r,s),i.apply(this,arguments)}return s.fn=i,this.on(r,s),this},e.prototype.off=e.prototype.removeListener=e.prototype.removeAllListeners=e.prototype.removeEventListener=function(r,i){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var s=this._callbacks["$"+r];if(!s)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var o,a=0;a<s.length;a++)if(o=s[a],o===i||o.fn===i){s.splice(a,1);break}return s.length===0&&delete this._callbacks["$"+r],this},e.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var i=new Array(arguments.length-1),s=this._callbacks["$"+r],o=1;o<arguments.length;o++)i[o-1]=arguments[o];if(s){s=s.slice(0);for(var o=0,a=s.length;o<a;++o)s[o].apply(this,i)}return this},e.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]},e.prototype.hasListeners=function(r){return!!this.listeners(r).length}})(Rf);var GC={},t$e={}.toString,h$=Array.isArray||function(t){return t$e.call(t)=="[object Array]"},MG=s$e,n$e=typeof Buffer=="function"&&typeof Buffer.isBuffer=="function",r$e=typeof ArrayBuffer=="function",i$e=function(t){return typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer};function s$e(t){return n$e&&Buffer.isBuffer(t)||r$e&&(t instanceof ArrayBuffer||i$e(t))}var f$=h$,IG=MG,NG=Object.prototype.toString,o$e=typeof Blob=="function"||typeof Blob!="undefined"&&NG.call(Blob)==="[object BlobConstructor]",a$e=typeof File=="function"||typeof File!="undefined"&&NG.call(File)==="[object FileConstructor]";GC.deconstructPacket=function(t){var e=[],n=t.data,r=t;return r.data=d$(n,e),r.attachments=e.length,{packet:r,buffers:e}};function d$(t,e){if(!t)return t;if(IG(t)){var n={_placeholder:!0,num:e.length};return e.push(t),n}else if(f$(t)){for(var r=new Array(t.length),i=0;i<t.length;i++)r[i]=d$(t[i],e);return r}else if(typeof t=="object"&&!(t instanceof Date)){var r={};for(var s in t)r[s]=d$(t[s],e);return r}return t}GC.reconstructPacket=function(t,e){return t.data=p$(t.data,e),t.attachments=void 0,t};function p$(t,e){if(!t)return t;if(t&&t._placeholder)return e[t.num];if(f$(t))for(var n=0;n<t.length;n++)t[n]=p$(t[n],e);else if(typeof t=="object")for(var r in t)t[r]=p$(t[r],e);return t}GC.removeBlobs=function(t,e){function n(s,o,a){if(!s)return s;if(o$e&&s instanceof Blob||a$e&&s instanceof File){r++;var l=new FileReader;l.onload=function(){a?a[o]=this.result:i=this.result,--r||e(i)},l.readAsArrayBuffer(s)}else if(f$(s))for(var c=0;c<s.length;c++)n(s[c],c,s);else if(typeof s=="object"&&!IG(s))for(var u in s)n(s[u],u,s)}var r=0,i=t;n(i),r||e(i)};(function(t){var e=c$.exports("socket.io-parser"),n=Rf.exports,r=GC,i=h$,s=MG;t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=o,t.Decoder=h;function o(){}var a=t.ERROR+'"encode error"';o.prototype.encode=function(v,y){if(e("encoding packet %j",v),t.BINARY_EVENT===v.type||t.BINARY_ACK===v.type)u(v,y);else{var w=l(v);y([w])}};function l(v){var y=""+v.type;if((t.BINARY_EVENT===v.type||t.BINARY_ACK===v.type)&&(y+=v.attachments+"-"),v.nsp&&v.nsp!=="/"&&(y+=v.nsp+","),v.id!=null&&(y+=v.id),v.data!=null){var w=c(v.data);if(w!==!1)y+=w;else return a}return e("encoded %j as %s",v,y),y}function c(v){try{return JSON.stringify(v)}catch{return!1}}function u(v,y){function w(x){var _=r.deconstructPacket(x),S=l(_.packet),T=_.buffers;T.unshift(S),y(T)}r.removeBlobs(v,w)}function h(){this.reconstructor=null}n(h.prototype),h.prototype.add=function(v){var y;if(typeof v=="string")y=f(v),t.BINARY_EVENT===y.type||t.BINARY_ACK===y.type?(this.reconstructor=new p(y),this.reconstructor.reconPack.attachments===0&&this.emit("decoded",y)):this.emit("decoded",y);else if(s(v)||v.base64)if(this.reconstructor)y=this.reconstructor.takeBinaryData(v),y&&(this.reconstructor=null,this.emit("decoded",y));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+v)};function f(v){var y=0,w={type:Number(v.charAt(0))};if(t.types[w.type]==null)return m("unknown packet type "+w.type);if(t.BINARY_EVENT===w.type||t.BINARY_ACK===w.type){for(var x=y+1;v.charAt(++y)!=="-"&&y!=v.length;);var _=v.substring(x,y);if(_!=Number(_)||v.charAt(y)!=="-")throw new Error("Illegal attachments");w.attachments=Number(_)}if(v.charAt(y+1)==="/"){for(var x=y+1;++y;){var S=v.charAt(y);if(S===","||y===v.length)break}w.nsp=v.substring(x,y)}else w.nsp="/";var T=v.charAt(y+1);if(T!==""&&Number(T)==T){for(var x=y+1;++y;){var S=v.charAt(y);if(S==null||Number(S)!=S){--y;break}if(y===v.length)break}w.id=Number(v.substring(x,y+1))}if(v.charAt(++y)){var E=d(v.substr(y)),k=E!==!1&&(w.type===t.ERROR||i(E));if(k)w.data=E;else return m("invalid payload")}return e("decoded %s as %j",v,w),w}function d(v){try{return JSON.parse(v)}catch{return!1}}h.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};function p(v){this.reconPack=v,this.buffers=[]}p.prototype.takeBinaryData=function(v){if(this.buffers.push(v),this.buffers.length===this.reconPack.attachments){var y=r.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),y}return null},p.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]};function m(v){return{type:t.ERROR,data:"parser error: "+v}}})(UC);var m$={exports:{}},HC={},g$={exports:{}};try{g$.exports=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch{g$.exports=!1}var v$=function(){return typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")()}(),l$e=g$.exports,c$e=v$,y$=function(t){var e=t.xdomain,n=t.xscheme,r=t.enablesXDR;try{if(typeof XMLHttpRequest!="undefined"&&(!e||l$e))return new XMLHttpRequest}catch{}try{if(typeof XDomainRequest!="undefined"&&!n&&r)return new XDomainRequest}catch{}if(!e)try{return new c$e[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}},b$={exports:{}},Df={},u$e=Object.keys||function(e){var n=[],r=Object.prototype.hasOwnProperty;for(var i in e)r.call(e,i)&&n.push(i);return n},h$e=h$,$G=Object.prototype.toString,f$e=typeof Blob=="function"||typeof Blob!="undefined"&&$G.call(Blob)==="[object BlobConstructor]",d$e=typeof File=="function"||typeof File!="undefined"&&$G.call(File)==="[object FileConstructor]",RG=jC;function jC(t){if(!t||typeof t!="object")return!1;if(h$e(t)){for(var e=0,n=t.length;e<n;e++)if(jC(t[e]))return!0;return!1}if(typeof Buffer=="function"&&Buffer.isBuffer&&Buffer.isBuffer(t)||typeof ArrayBuffer=="function"&&t instanceof ArrayBuffer||f$e&&t instanceof Blob||d$e&&t instanceof File)return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return jC(t.toJSON(),!0);for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&jC(t[r]))return!0;return!1}var p$e=function(t,e,n){var r=t.byteLength;if(e=e||0,n=n||r,t.slice)return t.slice(e,n);if(e<0&&(e+=r),n<0&&(n+=r),n>r&&(n=r),e>=r||e>=n||r===0)return new ArrayBuffer(0);for(var i=new Uint8Array(t),s=new Uint8Array(n-e),o=e,a=0;o<n;o++,a++)s[a]=i[o];return s.buffer},m$e=g$e;function g$e(t,e,n){var r=!1;return n=n||v$e,i.count=t,t===0?e():i;function i(s,o){if(i.count<=0)throw new Error("after called too many times");--i.count,s?(r=!0,e(s),e=n):i.count===0&&!r&&e(null,o)}}function v$e(){}/*! https://mths.be/utf8js v2.1.2 by @mathias */var nh=String.fromCharCode;function DG(t){for(var e=[],n=0,r=t.length,i,s;n<r;)i=t.charCodeAt(n++),i>=55296&&i<=56319&&n<r?(s=t.charCodeAt(n++),(s&64512)==56320?e.push(((i&1023)<<10)+(s&1023)+65536):(e.push(i),n--)):e.push(i);return e}function y$e(t){for(var e=t.length,n=-1,r,i="";++n<e;)r=t[n],r>65535&&(r-=65536,i+=nh(r>>>10&1023|55296),r=56320|r&1023),i+=nh(r);return i}function PG(t,e){if(t>=55296&&t<=57343){if(e)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function w$(t,e){return nh(t>>e&63|128)}function b$e(t,e){if((t&4294967168)==0)return nh(t);var n="";return(t&4294965248)==0?n=nh(t>>6&31|192):(t&4294901760)==0?(PG(t,e)||(t=65533),n=nh(t>>12&15|224),n+=w$(t,6)):(t&4292870144)==0&&(n=nh(t>>18&7|240),n+=w$(t,12),n+=w$(t,6)),n+=nh(t&63|128),n}function w$e(t,e){e=e||{};for(var n=e.strict!==!1,r=DG(t),i=r.length,s=-1,o,a="";++s<i;)o=r[s],a+=b$e(o,n);return a}function eg(){if(rh>=XC)throw Error("Invalid byte index");var t=qC[rh]&255;if(rh++,(t&192)==128)return t&63;throw Error("Invalid continuation byte")}function x$e(t){var e,n,r,i,s;if(rh>XC)throw Error("Invalid byte index");if(rh==XC)return!1;if(e=qC[rh]&255,rh++,(e&128)==0)return e;if((e&224)==192){if(n=eg(),s=(e&31)<<6|n,s>=128)return s;throw Error("Invalid continuation byte")}if((e&240)==224){if(n=eg(),r=eg(),s=(e&15)<<12|n<<6|r,s>=2048)return PG(s,t)?s:65533;throw Error("Invalid continuation byte")}if((e&248)==240&&(n=eg(),r=eg(),i=eg(),s=(e&7)<<18|n<<12|r<<6|i,s>=65536&&s<=1114111))return s;throw Error("Invalid UTF-8 detected")}var qC,XC,rh;function _$e(t,e){e=e||{};var n=e.strict!==!1;qC=DG(t),XC=qC.length,rh=0;for(var r=[],i;(i=x$e(n))!==!1;)r.push(i);return y$e(r)}var S$e={version:"2.1.2",encode:w$e,decode:_$e},x$={};(function(t){x$.encode=function(e){var n=new Uint8Array(e),r,i=n.length,s="";for(r=0;r<i;r+=3)s+=t[n[r]>>2],s+=t[(n[r]&3)<<4|n[r+1]>>4],s+=t[(n[r+1]&15)<<2|n[r+2]>>6],s+=t[n[r+2]&63];return i%3==2?s=s.substring(0,s.length-1)+"=":i%3==1&&(s=s.substring(0,s.length-2)+"=="),s},x$.decode=function(e){var n=e.length*.75,r=e.length,i,s=0,o,a,l,c;e[e.length-1]==="="&&(n--,e[e.length-2]==="="&&n--);var u=new ArrayBuffer(n),h=new Uint8Array(u);for(i=0;i<r;i+=4)o=t.indexOf(e[i]),a=t.indexOf(e[i+1]),l=t.indexOf(e[i+2]),c=t.indexOf(e[i+3]),h[s++]=o<<2|a>>4,h[s++]=(a&15)<<4|l>>2,h[s++]=(l&3)<<6|c&63;return u}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/");var tg=typeof tg!="undefined"?tg:typeof WebKitBlobBuilder!="undefined"?WebKitBlobBuilder:typeof MSBlobBuilder!="undefined"?MSBlobBuilder:typeof MozBlobBuilder!="undefined"?MozBlobBuilder:!1,OG=function(){try{var t=new Blob(["hi"]);return t.size===2}catch{return!1}}(),C$e=OG&&function(){try{var t=new Blob([new Uint8Array([1,2])]);return t.size===2}catch{return!1}}(),T$e=tg&&tg.prototype.append&&tg.prototype.getBlob;function FG(t){return t.map(function(e){if(e.buffer instanceof ArrayBuffer){var n=e.buffer;if(e.byteLength!==n.byteLength){var r=new Uint8Array(e.byteLength);r.set(new Uint8Array(n,e.byteOffset,e.byteLength)),n=r.buffer}return n}return e})}function LG(t,e){e=e||{};var n=new tg;return FG(t).forEach(function(r){n.append(r)}),e.type?n.getBlob(e.type):n.getBlob()}function BG(t,e){return new Blob(FG(t),e||{})}typeof Blob!="undefined"&&(LG.prototype=Blob.prototype,BG.prototype=Blob.prototype);var E$e=function(){return OG?C$e?Blob:BG:T$e?LG:void 0}();(function(t){var e=u$e,n=RG,r=p$e,i=m$e,s=S$e,o;typeof ArrayBuffer!="undefined"&&(o=x$);var a=typeof navigator!="undefined"&&/Android/i.test(navigator.userAgent),l=typeof navigator!="undefined"&&/PhantomJS/i.test(navigator.userAgent),c=a||l;t.protocol=3;var u=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},h=e(u),f={type:"error",data:"parser error"},d=E$e;t.encodePacket=function(_,S,T,E){typeof S=="function"&&(E=S,S=!1),typeof T=="function"&&(E=T,T=null);var k=_.data===void 0?void 0:_.data.buffer||_.data;if(typeof ArrayBuffer!="undefined"&&k instanceof ArrayBuffer)return m(_,S,E);if(typeof d!="undefined"&&k instanceof d)return y(_,S,E);if(k&&k.base64)return p(_,E);var A=u[_.type];return _.data!==void 0&&(A+=T?s.encode(String(_.data),{strict:!1}):String(_.data)),E(""+A)};function p(_,S){var T="b"+t.packets[_.type]+_.data.data;return S(T)}function m(_,S,T){if(!S)return t.encodeBase64Packet(_,T);var E=_.data,k=new Uint8Array(E),A=new Uint8Array(1+E.byteLength);A[0]=u[_.type];for(var M=0;M<k.length;M++)A[M+1]=k[M];return T(A.buffer)}function v(_,S,T){if(!S)return t.encodeBase64Packet(_,T);var E=new FileReader;return E.onload=function(){t.encodePacket({type:_.type,data:E.result},S,!0,T)},E.readAsArrayBuffer(_.data)}function y(_,S,T){if(!S)return t.encodeBase64Packet(_,T);if(c)return v(_,S,T);var E=new Uint8Array(1);E[0]=u[_.type];var k=new d([E.buffer,_.data]);return T(k)}t.encodeBase64Packet=function(_,S){var T="b"+t.packets[_.type];if(typeof d!="undefined"&&_.data instanceof d){var E=new FileReader;return E.onload=function(){var P=E.result.split(",")[1];S(T+P)},E.readAsDataURL(_.data)}var k;try{k=String.fromCharCode.apply(null,new Uint8Array(_.data))}catch{for(var A=new Uint8Array(_.data),M=new Array(A.length),D=0;D<A.length;D++)M[D]=A[D];k=String.fromCharCode.apply(null,M)}return T+=btoa(k),S(T)},t.decodePacket=function(_,S,T){if(_===void 0)return f;if(typeof _=="string"){if(_.charAt(0)==="b")return t.decodeBase64Packet(_.substr(1),S);if(T&&(_=w(_),_===!1))return f;var k=_.charAt(0);return Number(k)!=k||!h[k]?f:_.length>1?{type:h[k],data:_.substring(1)}:{type:h[k]}}var E=new Uint8Array(_),k=E[0],A=r(_,1);return d&&S==="blob"&&(A=new d([A])),{type:h[k],data:A}};function w(_){try{_=s.decode(_,{strict:!1})}catch{return!1}return _}t.decodeBase64Packet=function(_,S){var T=h[_.charAt(0)];if(!o)return{type:T,data:{base64:!0,data:_.substr(1)}};var E=o.decode(_.substr(1));return S==="blob"&&d&&(E=new d([E])),{type:T,data:E}},t.encodePayload=function(_,S,T){typeof S=="function"&&(T=S,S=null);var E=n(_);if(S&&E)return d&&!c?t.encodePayloadAsBlob(_,T):t.encodePayloadAsArrayBuffer(_,T);if(!_.length)return T("0:");function k(M){return M.length+":"+M}function A(M,D){t.encodePacket(M,E?S:!1,!1,function(P){D(null,k(P))})}x(_,A,function(M,D){return T(D.join(""))})};function x(_,S,T){for(var E=new Array(_.length),k=i(_.length,T),A=function(D,P,N){S(P,function(R,F){E[D]=F,N(R,E)})},M=0;M<_.length;M++)A(M,_[M],k)}t.decodePayload=function(_,S,T){if(typeof _!="string")return t.decodePayloadAsBinary(_,S,T);typeof S=="function"&&(T=S,S=null);var E;if(_==="")return T(f,0,1);for(var k="",A,M,D=0,P=_.length;D<P;D++){var N=_.charAt(D);if(N!==":"){k+=N;continue}if(k===""||k!=(A=Number(k))||(M=_.substr(D+1,A),k!=M.length))return T(f,0,1);if(M.length){if(E=t.decodePacket(M,S,!1),f.type===E.type&&f.data===E.data)return T(f,0,1);var R=T(E,D+A,P);if(R===!1)return}D+=A,k=""}if(k!=="")return T(f,0,1)},t.encodePayloadAsArrayBuffer=function(_,S){if(!_.length)return S(new ArrayBuffer(0));function T(E,k){t.encodePacket(E,!0,!0,function(A){return k(null,A)})}x(_,T,function(E,k){var A=k.reduce(function(P,N){var R;return typeof N=="string"?R=N.length:R=N.byteLength,P+R.toString().length+R+2},0),M=new Uint8Array(A),D=0;return k.forEach(function(P){var N=typeof P=="string",R=P;if(N){for(var K=new Uint8Array(P.length),F=0;F<P.length;F++)K[F]=P.charCodeAt(F);R=K.buffer}N?M[D++]=0:M[D++]=1;for(var O=R.byteLength.toString(),F=0;F<O.length;F++)M[D++]=parseInt(O[F]);M[D++]=255;for(var K=new Uint8Array(R),F=0;F<K.length;F++)M[D++]=K[F]}),S(M.buffer)})},t.encodePayloadAsBlob=function(_,S){function T(E,k){t.encodePacket(E,!0,!0,function(A){var M=new Uint8Array(1);if(M[0]=1,typeof A=="string"){for(var D=new Uint8Array(A.length),P=0;P<A.length;P++)D[P]=A.charCodeAt(P);A=D.buffer,M[0]=0}for(var N=A instanceof ArrayBuffer?A.byteLength:A.size,R=N.toString(),F=new Uint8Array(R.length+1),P=0;P<R.length;P++)F[P]=parseInt(R[P]);if(F[R.length]=255,d){var O=new d([M.buffer,F.buffer,A]);k(null,O)}})}x(_,T,function(E,k){return S(new d(k))})},t.decodePayloadAsBinary=function(_,S,T){typeof S=="function"&&(T=S,S=null);for(var E=_,k=[];E.byteLength>0;){for(var A=new Uint8Array(E),M=A[0]===0,D="",P=1;A[P]!==255;P++){if(D.length>310)return T(f,0,1);D+=A[P]}E=r(E,2+D.length),D=parseInt(D);var N=r(E,0,D);if(M)try{N=String.fromCharCode.apply(null,new Uint8Array(N))}catch{var R=new Uint8Array(N);N="";for(var P=0;P<R.length;P++)N+=String.fromCharCode(R[P])}k.push(N),E=r(E,D)}var F=k.length;k.forEach(function(O,K){T(t.decodePacket(O,S,!0),K,F)})}})(Df);var k$e=Df,A$e=Rf.exports,_$=ql;function ql(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState="",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.withCredentials=t.withCredentials,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.forceNode=t.forceNode,this.isReactNative=t.isReactNative,this.extraHeaders=t.extraHeaders,this.localAddress=t.localAddress}A$e(ql.prototype);ql.prototype.onError=function(t,e){var n=new Error(t);return n.type="TransportError",n.description=e,this.emit("error",n),this};ql.prototype.open=function(){return(this.readyState==="closed"||this.readyState==="")&&(this.readyState="opening",this.doOpen()),this};ql.prototype.close=function(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this};ql.prototype.send=function(t){if(this.readyState==="open")this.write(t);else throw new Error("Transport not open")};ql.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")};ql.prototype.onData=function(t){var e=k$e.decodePacket(t,this.socket.binaryType);this.onPacket(e)};ql.prototype.onPacket=function(t){this.emit("packet",t)};ql.prototype.onClose=function(){this.readyState="closed",this.emit("close")};var ng={};ng.encode=function(t){var e="";for(var n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e};ng.decode=function(t){for(var e={},n=t.split("&"),r=0,i=n.length;r<i;r++){var s=n[r].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e};var KC=function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t},zG="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),YC=64,VG={},UG=0,ih=0,WG;function S$(t){var e="";do e=zG[t%YC]+e,t=Math.floor(t/YC);while(t>0);return e}function M$e(t){var e=0;for(ih=0;ih<t.length;ih++)e=e*YC+VG[t.charAt(ih)];return e}function C$(){var t=S$(+new Date);return t!==WG?(UG=0,WG=t):t+"."+S$(UG++)}for(;ih<YC;ih++)VG[zG[ih]]=ih;C$.encode=S$;C$.decode=M$e;var GG=C$,rg={exports:{}},T$={exports:{}},Sb=1e3,Cb=Sb*60,Tb=Cb*60,Eb=Tb*24,I$e=Eb*365.25,N$e=function(t,e){e=e||{};var n=typeof t;if(n==="string"&&t.length>0)return $$e(t);if(n==="number"&&isNaN(t)===!1)return e.long?D$e(t):R$e(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function $$e(t){if(t=String(t),!(t.length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!!e){var n=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*I$e;case"days":case"day":case"d":return n*Eb;case"hours":case"hour":case"hrs":case"hr":case"h":return n*Tb;case"minutes":case"minute":case"mins":case"min":case"m":return n*Cb;case"seconds":case"second":case"secs":case"sec":case"s":return n*Sb;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function R$e(t){return t>=Eb?Math.round(t/Eb)+"d":t>=Tb?Math.round(t/Tb)+"h":t>=Cb?Math.round(t/Cb)+"m":t>=Sb?Math.round(t/Sb)+"s":t+"ms"}function D$e(t){return ZC(t,Eb,"day")||ZC(t,Tb,"hour")||ZC(t,Cb,"minute")||ZC(t,Sb,"second")||t+" ms"}function ZC(t,e,n){if(!(t<e))return t<e*1.5?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}(function(t,e){e=t.exports=r.debug=r.default=r,e.coerce=l,e.disable=o,e.enable=s,e.enabled=a,e.humanize=N$e,e.instances=[],e.names=[],e.skips=[],e.formatters={};function n(c){var u=0,h;for(h in c)u=(u<<5)-u+c.charCodeAt(h),u|=0;return e.colors[Math.abs(u)%e.colors.length]}function r(c){var u;function h(){if(!!h.enabled){var f=h,d=+new Date,p=d-(u||d);f.diff=p,f.prev=u,f.curr=d,u=d;for(var m=new Array(arguments.length),v=0;v<m.length;v++)m[v]=arguments[v];m[0]=e.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");var y=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,function(x,_){if(x==="%%")return x;y++;var S=e.formatters[_];if(typeof S=="function"){var T=m[y];x=S.call(f,T),m.splice(y,1),y--}return x}),e.formatArgs.call(f,m);var w=h.log||e.log||console.log.bind(console);w.apply(f,m)}}return h.namespace=c,h.enabled=e.enabled(c),h.useColors=e.useColors(),h.color=n(c),h.destroy=i,typeof e.init=="function"&&e.init(h),e.instances.push(h),h}function i(){var c=e.instances.indexOf(this);return c!==-1?(e.instances.splice(c,1),!0):!1}function s(c){e.save(c),e.names=[],e.skips=[];var u,h=(typeof c=="string"?c:"").split(/[\s,]+/),f=h.length;for(u=0;u<f;u++)!h[u]||(c=h[u].replace(/\*/g,".*?"),c[0]==="-"?e.skips.push(new RegExp("^"+c.substr(1)+"$")):e.names.push(new RegExp("^"+c+"$")));for(u=0;u<e.instances.length;u++){var d=e.instances[u];d.enabled=e.enabled(d.namespace)}}function o(){e.enable("")}function a(c){if(c[c.length-1]==="*")return!0;var u,h;for(u=0,h=e.skips.length;u<h;u++)if(e.skips[u].test(c))return!1;for(u=0,h=e.names.length;u<h;u++)if(e.names[u].test(c))return!0;return!1}function l(c){return c instanceof Error?c.stack||c.message:c}})(T$,T$.exports);(function(t,e){e=t.exports=T$.exports,e.log=i,e.formatArgs=r,e.save=s,e.load=o,e.useColors=n,e.storage=typeof chrome!="undefined"&&typeof chrome.storage!="undefined"?chrome.storage.local:a(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){return typeof window!="undefined"&&window.process&&window.process.type==="renderer"?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}e.formatters.j=function(l){try{return JSON.stringify(l)}catch(c){return"[UnexpectedJSONParseError]: "+c.message}};function r(l){var c=this.useColors;if(l[0]=(c?"%c":"")+this.namespace+(c?" %c":" ")+l[0]+(c?"%c ":" ")+"+"+e.humanize(this.diff),!!c){var u="color: "+this.color;l.splice(1,0,u,"color: inherit");var h=0,f=0;l[0].replace(/%[a-zA-Z%]/g,function(d){d!=="%%"&&(h++,d==="%c"&&(f=h))}),l.splice(f,0,u)}}function i(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(l){try{l==null?e.storage.removeItem("debug"):e.storage.debug=l}catch{}}function o(){var l;try{l=e.storage.debug}catch{}return!l&&typeof process!="undefined"&&"env"in process&&(l={}.DEBUG),l}e.enable(o());function a(){try{return window.localStorage}catch{}}})(rg,rg.exports);var HG=_$,P$e=ng,jG=Df,O$e=KC,F$e=GG,nl=rg.exports("engine.io-client:polling"),qG=Xl,L$e=function(){var t=y$,e=new t({xdomain:!1});return e.responseType!=null}();function Xl(t){var e=t&&t.forceBase64;(!L$e||e)&&(this.supportsBinary=!1),HG.call(this,t)}O$e(Xl,HG);Xl.prototype.name="polling";Xl.prototype.doOpen=function(){this.poll()};Xl.prototype.pause=function(t){var e=this;this.readyState="pausing";function n(){nl("paused"),e.readyState="paused",t()}if(this.polling||!this.writable){var r=0;this.polling&&(nl("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){nl("pre-pause polling complete"),--r||n()})),this.writable||(nl("we are currently writing - waiting to pause"),r++,this.once("drain",function(){nl("pre-pause writing complete"),--r||n()}))}else n()};Xl.prototype.poll=function(){nl("polling"),this.polling=!0,this.doPoll(),this.emit("poll")};Xl.prototype.onData=function(t){var e=this;nl("polling got data %s",t);var n=function(r,i,s){if(e.readyState==="opening"&&r.type==="open"&&e.onOpen(),r.type==="close")return e.onClose(),!1;e.onPacket(r)};jG.decodePayload(t,this.socket.binaryType,n),this.readyState!=="closed"&&(this.polling=!1,this.emit("pollComplete"),this.readyState==="open"?this.poll():nl('ignoring poll - transport state "%s"',this.readyState))};Xl.prototype.doClose=function(){var t=this;function e(){nl("writing close packet"),t.write([{type:"close"}])}this.readyState==="open"?(nl("transport open - closing"),e()):(nl("transport not open - deferring close"),this.once("open",e))};Xl.prototype.write=function(t){var e=this;this.writable=!1;var n=function(){e.writable=!0,e.emit("drain")};jG.encodePayload(t,this.supportsBinary,function(r){e.doWrite(r,n)})};Xl.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",n="";this.timestampRequests!==!1&&(t[this.timestampParam]=F$e()),!this.supportsBinary&&!t.sid&&(t.b64=1),t=P$e.encode(t),this.port&&(e==="https"&&Number(this.port)!==443||e==="http"&&Number(this.port)!==80)&&(n=":"+this.port),t.length&&(t="?"+t);var r=this.hostname.indexOf(":")!==-1;return e+"://"+(r?"["+this.hostname+"]":this.hostname)+n+this.path+t};var B$e=y$,XG=qG,z$e=Rf.exports,V$e=KC,E$=rg.exports("engine.io-client:polling-xhr"),U$e=v$;b$.exports=ig;b$.exports.Request=$i;function KG(){}function ig(t){if(XG.call(this,t),this.requestTimeout=t.requestTimeout,this.extraHeaders=t.extraHeaders,typeof location!="undefined"){var e=location.protocol==="https:",n=location.port;n||(n=e?443:80),this.xd=typeof location!="undefined"&&t.hostname!==location.hostname||n!==t.port,this.xs=t.secure!==e}}V$e(ig,XG);ig.prototype.supportsBinary=!0;ig.prototype.request=function(t){return t=t||{},t.uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.withCredentials=this.withCredentials,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.requestTimeout=this.requestTimeout,t.extraHeaders=this.extraHeaders,new $i(t)};ig.prototype.doWrite=function(t,e){var n=typeof t!="string"&&t!==void 0,r=this.request({method:"POST",data:t,isBinary:n}),i=this;r.on("success",e),r.on("error",function(s){i.onError("xhr post error",s)}),this.sendXhr=r};ig.prototype.doPoll=function(){E$("xhr poll");var t=this.request(),e=this;t.on("data",function(n){e.onData(n)}),t.on("error",function(n){e.onError("xhr poll error",n)}),this.pollXhr=t};function $i(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.withCredentials=t.withCredentials,this.requestTimeout=t.requestTimeout,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}z$e($i.prototype);$i.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized;var e=this.xhr=new B$e(t),n=this;try{E$("xhr open %s: %s",this.method,this.uri),e.open(this.method,this.uri,this.async);try{if(this.extraHeaders){e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0);for(var r in this.extraHeaders)this.extraHeaders.hasOwnProperty(r)&&e.setRequestHeader(r,this.extraHeaders[r])}}catch{}if(this.method==="POST")try{this.isBinary?e.setRequestHeader("Content-type","application/octet-stream"):e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{e.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in e&&(e.withCredentials=this.withCredentials),this.requestTimeout&&(e.timeout=this.requestTimeout),this.hasXDR()?(e.onload=function(){n.onLoad()},e.onerror=function(){n.onError(e.responseText)}):e.onreadystatechange=function(){if(e.readyState===2)try{var i=e.getResponseHeader("Content-Type");(n.supportsBinary&&i==="application/octet-stream"||i==="application/octet-stream; charset=UTF-8")&&(e.responseType="arraybuffer")}catch{}e.readyState===4&&(e.status===200||e.status===1223?n.onLoad():setTimeout(function(){n.onError(typeof e.status=="number"?e.status:0)},0))},E$("xhr data %s",this.data),e.send(this.data)}catch(i){setTimeout(function(){n.onError(i)},0);return}typeof document!="undefined"&&(this.index=$i.requestsCount++,$i.requests[this.index]=this)};$i.prototype.onSuccess=function(){this.emit("success"),this.cleanup()};$i.prototype.onData=function(t){this.emit("data",t),this.onSuccess()};$i.prototype.onError=function(t){this.emit("error",t),this.cleanup(!0)};$i.prototype.cleanup=function(t){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=KG:this.xhr.onreadystatechange=KG,t)try{this.xhr.abort()}catch{}typeof document!="undefined"&&delete $i.requests[this.index],this.xhr=null}};$i.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type")}catch{}e==="application/octet-stream"||e==="application/octet-stream; charset=UTF-8"?t=this.xhr.response||this.xhr.responseText:t=this.xhr.responseText}catch(n){this.onError(n)}t!=null&&this.onData(t)};$i.prototype.hasXDR=function(){return typeof XDomainRequest!="undefined"&&!this.xs&&this.enablesXDR};$i.prototype.abort=function(){this.cleanup()};$i.requestsCount=0;$i.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",YG);else if(typeof addEventListener=="function"){var W$e="onpagehide"in U$e?"pagehide":"unload";addEventListener(W$e,YG,!1)}}function YG(){for(var t in $i.requests)$i.requests.hasOwnProperty(t)&&$i.requests[t].abort()}var k$=qG,G$e=KC,ZG=v$,H$e=sg,j$e=/\n/g,q$e=/\\n/g,JC;function X$e(){}function sg(t){k$.call(this,t),this.query=this.query||{},JC||(JC=ZG.___eio=ZG.___eio||[]),this.index=JC.length;var e=this;JC.push(function(n){e.onData(n)}),this.query.j=this.index,typeof addEventListener=="function"&&addEventListener("beforeunload",function(){e.script&&(e.script.onerror=X$e)},!1)}G$e(sg,k$);sg.prototype.supportsBinary=!1;sg.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),k$.prototype.doClose.call(this)};sg.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(i){t.onError("jsonp poll error",i)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(e,n):(document.head||document.body).appendChild(e),this.script=e;var r=typeof navigator!="undefined"&&/gecko/i.test(navigator.userAgent);r&&setTimeout(function(){var i=document.createElement("iframe");document.body.appendChild(i),document.body.removeChild(i)},100)};sg.prototype.doWrite=function(t,e){var n=this;if(!this.form){var r=document.createElement("form"),i=document.createElement("textarea"),s=this.iframeId="eio_iframe_"+this.index,o;r.className="socketio",r.style.position="absolute",r.style.top="-1000px",r.style.left="-1000px",r.target=s,r.method="POST",r.setAttribute("accept-charset","utf-8"),i.name="d",r.appendChild(i),document.body.appendChild(r),this.form=r,this.area=i}this.form.action=this.uri();function a(){l(),e()}function l(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(u){n.onError("jsonp polling iframe removal error",u)}try{var c='<iframe src="javascript:0" name="'+n.iframeId+'">';o=document.createElement(c)}catch{o=document.createElement("iframe"),o.name=n.iframeId,o.src="javascript:0"}o.id=n.iframeId,n.form.appendChild(o),n.iframe=o}l(),t=t.replace(q$e,`\\
`),this.area.value=t.replace(j$e,"\\n");try{this.form.submit()}catch{}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){n.iframe.readyState==="complete"&&a()}:this.iframe.onload=a};var A$=_$,K$e=Df,Y$e=ng,Z$e=KC,J$e=GG,Q$e=rg.exports("engine.io-client:websocket"),QC,M$;typeof WebSocket!="undefined"?QC=WebSocket:typeof self!="undefined"&&(QC=self.WebSocket||self.MozWebSocket);if(typeof window=="undefined")try{M$=require("ws")}catch{}var og=QC||M$,eRe=da;function da(t){var e=t&&t.forceBase64;e&&(this.supportsBinary=!1),this.perMessageDeflate=t.perMessageDeflate,this.usingBrowserWebSocket=QC&&!t.forceNode,this.protocols=t.protocols,this.usingBrowserWebSocket||(og=M$),A$.call(this,t)}Z$e(da,A$);da.prototype.name="websocket";da.prototype.supportsBinary=!0;da.prototype.doOpen=function(){if(!!this.check()){var t=this.uri(),e=this.protocols,n={};this.isReactNative||(n.agent=this.agent,n.perMessageDeflate=this.perMessageDeflate,n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized),this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?e?new og(t,e):new og(t):new og(t,e,n)}catch(r){return this.emit("error",r)}this.ws.binaryType===void 0&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}};da.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}};da.prototype.write=function(t){var e=this;this.writable=!1;for(var n=t.length,r=0,i=n;r<i;r++)(function(o){K$e.encodePacket(o,e.supportsBinary,function(a){if(!e.usingBrowserWebSocket){var l={};if(o.options&&(l.compress=o.options.compress),e.perMessageDeflate){var c=typeof a=="string"?Buffer.byteLength(a):a.length;c<e.perMessageDeflate.threshold&&(l.compress=!1)}}try{e.usingBrowserWebSocket?e.ws.send(a):e.ws.send(a,l)}catch{Q$e("websocket closed before onclose event")}--n||s()})})(t[r]);function s(){e.emit("flush"),setTimeout(function(){e.writable=!0,e.emit("drain")},0)}};da.prototype.onClose=function(){A$.prototype.onClose.call(this)};da.prototype.doClose=function(){typeof this.ws!="undefined"&&this.ws.close()};da.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",n="";this.port&&(e==="wss"&&Number(this.port)!==443||e==="ws"&&Number(this.port)!==80)&&(n=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=J$e()),this.supportsBinary||(t.b64=1),t=Y$e.encode(t),t.length&&(t="?"+t);var r=this.hostname.indexOf(":")!==-1;return e+"://"+(r?"["+this.hostname+"]":this.hostname)+n+this.path+t};da.prototype.check=function(){return!!og&&!("__initialize"in og&&this.name===da.prototype.name)};var tRe=y$,nRe=b$.exports,rRe=H$e,iRe=eRe;HC.polling=sRe;HC.websocket=iRe;function sRe(t){var e,n=!1,r=!1,i=t.jsonp!==!1;if(typeof location!="undefined"){var s=location.protocol==="https:",o=location.port;o||(o=s?443:80),n=t.hostname!==location.hostname||o!==t.port,r=t.secure!==s}if(t.xdomain=n,t.xscheme=r,e=new tRe(t),"open"in e&&!t.forceJSONP)return new nRe(t);if(!i)throw new Error("JSONP disabled");return new rRe(t)}var oRe=[].indexOf,JG=function(t,e){if(oRe)return t.indexOf(e);for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1},aRe=HC,lRe=Rf.exports,gi=rg.exports("engine.io-client:socket"),cRe=JG,QG=Df,eH=kG,uRe=ng,hRe=Dn;function Dn(t,e){if(!(this instanceof Dn))return new Dn(t,e);e=e||{},t&&typeof t=="object"&&(e=t,t=null),t?(t=eH(t),e.hostname=t.host,e.secure=t.protocol==="https"||t.protocol==="wss",e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=eH(e.host).host),this.secure=e.secure!=null?e.secure:typeof location!="undefined"&&location.protocol==="https:",e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.agent=e.agent||!1,this.hostname=e.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=e.port||(typeof location!="undefined"&&location.port?location.port:this.secure?443:80),this.query=e.query||{},typeof this.query=="string"&&(this.query=uRe.decode(this.query)),this.upgrade=e.upgrade!==!1,this.path=(e.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!e.forceJSONP,this.jsonp=e.jsonp!==!1,this.forceBase64=!!e.forceBase64,this.enablesXDR=!!e.enablesXDR,this.withCredentials=e.withCredentials!==!1,this.timestampParam=e.timestampParam||"t",this.timestampRequests=e.timestampRequests,this.transports=e.transports||["polling","websocket"],this.transportOptions=e.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=e.policyPort||843,this.rememberUpgrade=e.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=e.onlyBinaryUpgrades,this.perMessageDeflate=e.perMessageDeflate!==!1?e.perMessageDeflate||{}:!1,this.perMessageDeflate===!0&&(this.perMessageDeflate={}),this.perMessageDeflate&&this.perMessageDeflate.threshold==null&&(this.perMessageDeflate.threshold=1024),this.pfx=e.pfx||void 0,this.key=e.key||void 0,this.passphrase=e.passphrase||void 0,this.cert=e.cert||void 0,this.ca=e.ca||void 0,this.ciphers=e.ciphers||void 0,this.rejectUnauthorized=e.rejectUnauthorized===void 0?!0:e.rejectUnauthorized,this.forceNode=!!e.forceNode,this.isReactNative=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",(typeof self=="undefined"||this.isReactNative)&&(e.extraHeaders&&Object.keys(e.extraHeaders).length>0&&(this.extraHeaders=e.extraHeaders),e.localAddress&&(this.localAddress=e.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}Dn.priorWebsocketSuccess=!1;lRe(Dn.prototype);Dn.protocol=QG.protocol;Dn.Socket=Dn;Dn.Transport=_$;Dn.transports=HC;Dn.parser=Df;Dn.prototype.createTransport=function(t){gi('creating transport "%s"',t);var e=fRe(this.query);e.EIO=QG.protocol,e.transport=t;var n=this.transportOptions[t]||{};this.id&&(e.sid=this.id);var r=new aRe[t]({query:e,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,withCredentials:n.withCredentials||this.withCredentials,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0,isReactNative:this.isReactNative});return r};function fRe(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}Dn.prototype.open=function(){var t;if(this.rememberUpgrade&&Dn.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)t="websocket";else if(this.transports.length===0){var e=this;setTimeout(function(){e.emit("error","No transports available")},0);return}else t=this.transports[0];this.readyState="opening";try{t=this.createTransport(t)}catch{this.transports.shift(),this.open();return}t.open(),this.setTransport(t)};Dn.prototype.setTransport=function(t){gi("setting transport %s",t.name);var e=this;this.transport&&(gi("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",function(){e.onDrain()}).on("packet",function(n){e.onPacket(n)}).on("error",function(n){e.onError(n)}).on("close",function(){e.onClose("transport close")})};Dn.prototype.probe=function(t){gi('probing transport "%s"',t);var e=this.createTransport(t,{probe:1}),n=!1,r=this;Dn.priorWebsocketSuccess=!1;function i(){if(r.onlyBinaryUpgrades){var h=!this.supportsBinary&&r.transport.supportsBinary;n=n||h}n||(gi('probe transport "%s" opened',t),e.send([{type:"ping",data:"probe"}]),e.once("packet",function(f){if(!n)if(f.type==="pong"&&f.data==="probe"){if(gi('probe transport "%s" pong',t),r.upgrading=!0,r.emit("upgrading",e),!e)return;Dn.priorWebsocketSuccess=e.name==="websocket",gi('pausing current transport "%s"',r.transport.name),r.transport.pause(function(){n||r.readyState!=="closed"&&(gi("changing transport and sending upgrade packet"),u(),r.setTransport(e),e.send([{type:"upgrade"}]),r.emit("upgrade",e),e=null,r.upgrading=!1,r.flush())})}else{gi('probe transport "%s" failed',t);var d=new Error("probe error");d.transport=e.name,r.emit("upgradeError",d)}}))}function s(){n||(n=!0,u(),e.close(),e=null)}function o(h){var f=new Error("probe error: "+h);f.transport=e.name,s(),gi('probe transport "%s" failed because of error: %s',t,h),r.emit("upgradeError",f)}function a(){o("transport closed")}function l(){o("socket closed")}function c(h){e&&h.name!==e.name&&(gi('"%s" works - aborting "%s"',h.name,e.name),s())}function u(){e.removeListener("open",i),e.removeListener("error",o),e.removeListener("close",a),r.removeListener("close",l),r.removeListener("upgrading",c)}e.once("open",i),e.once("error",o),e.once("close",a),this.once("close",l),this.once("upgrading",c),e.open()};Dn.prototype.onOpen=function(){if(gi("socket open"),this.readyState="open",Dn.priorWebsocketSuccess=this.transport.name==="websocket",this.emit("open"),this.flush(),this.readyState==="open"&&this.upgrade&&this.transport.pause){gi("starting upgrade probes");for(var t=0,e=this.upgrades.length;t<e;t++)this.probe(this.upgrades[t])}};Dn.prototype.onPacket=function(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(gi('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data);break}else gi('packet received with socket readyState "%s"',this.readyState)};Dn.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),this.readyState!=="closed"&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))};Dn.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout(function(){e.readyState!=="closed"&&e.onClose("ping timeout")},t||e.pingInterval+e.pingTimeout)};Dn.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout(function(){gi("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)},t.pingInterval)};Dn.prototype.ping=function(){var t=this;this.sendPacket("ping",function(){t.emit("ping")})};Dn.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emit("drain"):this.flush()};Dn.prototype.flush=function(){this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(gi("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))};Dn.prototype.write=Dn.prototype.send=function(t,e,n){return this.sendPacket("message",t,e,n),this};Dn.prototype.sendPacket=function(t,e,n,r){if(typeof e=="function"&&(r=e,e=void 0),typeof n=="function"&&(r=n,n=null),!(this.readyState==="closing"||this.readyState==="closed")){n=n||{},n.compress=n.compress!==!1;var i={type:t,data:e,options:n};this.emit("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}};Dn.prototype.close=function(){if(this.readyState==="opening"||this.readyState==="open"){this.readyState="closing";var t=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?r():e()}):this.upgrading?r():e()}function e(){t.onClose("forced close"),gi("socket closing - telling transport to close"),t.transport.close()}function n(){t.removeListener("upgrade",n),t.removeListener("upgradeError",n),e()}function r(){t.once("upgrade",n),t.once("upgradeError",n)}return this};Dn.prototype.onError=function(t){gi("socket error %j",t),Dn.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)};Dn.prototype.onClose=function(t,e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){gi('socket close with reason: "%s"',t);var n=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",t,e),n.writeBuffer=[],n.prevBufferLen=0}};Dn.prototype.filterUpgrades=function(t){for(var e=[],n=0,r=t.length;n<r;n++)~cRe(this.transports,t[n])&&e.push(t[n]);return e};m$.exports=hRe;m$.exports.parser=Df;var I$={exports:{}},dRe=pRe;function pRe(t,e){var n=[];e=e||0;for(var r=e||0;r<t.length;r++)n[r-e]=t[r];return n}var tH=mRe;function mRe(t,e,n){return t.on(e,n),{destroy:function(){t.removeListener(e,n)}}}var nH=[].slice,rH=function(t,e){if(typeof e=="string"&&(e=t[e]),typeof e!="function")throw new Error("bind() requires a function");var n=nH.call(arguments,2);return function(){return e.apply(t,n.concat(nH.call(arguments)))}};(function(t,e){var n=UC,r=Rf.exports,i=dRe,s=tH,o=rH,a=Qm.exports("socket.io-client:socket"),l=ng,c=RG;t.exports=f;var u={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},h=r.prototype.emit;function f(d,p,m){this.io=d,this.nsp=p,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},m&&m.query&&(this.query=m.query),this.io.autoConnect&&this.open()}r(f.prototype),f.prototype.subEvents=function(){if(!this.subs){var d=this.io;this.subs=[s(d,"open",o(this,"onopen")),s(d,"packet",o(this,"onpacket")),s(d,"close",o(this,"onclose"))]}},f.prototype.open=f.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.reconnecting||this.io.open(),this.io.readyState==="open"&&this.onopen(),this.emit("connecting"),this)},f.prototype.send=function(){var d=i(arguments);return d.unshift("message"),this.emit.apply(this,d),this},f.prototype.emit=function(d){if(u.hasOwnProperty(d))return h.apply(this,arguments),this;var p=i(arguments),m={type:(this.flags.binary!==void 0?this.flags.binary:c(p))?n.BINARY_EVENT:n.EVENT,data:p};return m.options={},m.options.compress=!this.flags||this.flags.compress!==!1,typeof p[p.length-1]=="function"&&(a("emitting packet with ack id %d",this.ids),this.acks[this.ids]=p.pop(),m.id=this.ids++),this.connected?this.packet(m):this.sendBuffer.push(m),this.flags={},this},f.prototype.packet=function(d){d.nsp=this.nsp,this.io.packet(d)},f.prototype.onopen=function(){if(a("transport is open - connecting"),this.nsp!=="/")if(this.query){var d=typeof this.query=="object"?l.encode(this.query):this.query;a("sending connect packet with query %s",d),this.packet({type:n.CONNECT,query:d})}else this.packet({type:n.CONNECT})},f.prototype.onclose=function(d){a("close (%s)",d),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",d)},f.prototype.onpacket=function(d){var p=d.nsp===this.nsp,m=d.type===n.ERROR&&d.nsp==="/";if(!(!p&&!m))switch(d.type){case n.CONNECT:this.onconnect();break;case n.EVENT:this.onevent(d);break;case n.BINARY_EVENT:this.onevent(d);break;case n.ACK:this.onack(d);break;case n.BINARY_ACK:this.onack(d);break;case n.DISCONNECT:this.ondisconnect();break;case n.ERROR:this.emit("error",d.data);break}},f.prototype.onevent=function(d){var p=d.data||[];a("emitting event %j",p),d.id!=null&&(a("attaching ack callback to event"),p.push(this.ack(d.id))),this.connected?h.apply(this,p):this.receiveBuffer.push(p)},f.prototype.ack=function(d){var p=this,m=!1;return function(){if(!m){m=!0;var v=i(arguments);a("sending ack %j",v),p.packet({type:c(v)?n.BINARY_ACK:n.ACK,id:d,data:v})}}},f.prototype.onack=function(d){var p=this.acks[d.id];typeof p=="function"?(a("calling ack %s with %j",d.id,d.data),p.apply(this,d.data),delete this.acks[d.id]):a("bad ack %s",d.id)},f.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},f.prototype.emitBuffered=function(){var d;for(d=0;d<this.receiveBuffer.length;d++)h.apply(this,this.receiveBuffer[d]);for(this.receiveBuffer=[],d=0;d<this.sendBuffer.length;d++)this.packet(this.sendBuffer[d]);this.sendBuffer=[]},f.prototype.ondisconnect=function(){a("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},f.prototype.destroy=function(){if(this.subs){for(var d=0;d<this.subs.length;d++)this.subs[d].destroy();this.subs=null}this.io.destroy(this)},f.prototype.close=f.prototype.disconnect=function(){return this.connected&&(a("performing disconnect (%s)",this.nsp),this.packet({type:n.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},f.prototype.compress=function(d){return this.flags.compress=d,this},f.prototype.binary=function(d){return this.flags.binary=d,this}})(I$);var gRe=ag;function ag(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}ag.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=(Math.floor(e*10)&1)==0?t-n:t+n}return Math.min(t,this.max)|0};ag.prototype.reset=function(){this.attempts=0};ag.prototype.setMin=function(t){this.ms=t};ag.prototype.setMax=function(t){this.max=t};ag.prototype.setJitter=function(t){this.jitter=t};var vRe=m$.exports,yRe=I$.exports,bRe=Rf.exports,wRe=UC,sh=tH,lg=rH,bs=Qm.exports("socket.io-client:manager"),iH=JG,xRe=gRe,sH=Object.prototype.hasOwnProperty,oH=Un;function Un(t,e){if(!(this instanceof Un))return new Un(t,e);t&&typeof t=="object"&&(e=t,t=void 0),e=e||{},e.path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(e.reconnection!==!1),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new xRe({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(e.timeout==null?2e4:e.timeout),this.readyState="closed",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=e.parser||wRe;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=e.autoConnect!==!1,this.autoConnect&&this.open()}Un.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var t in this.nsps)sH.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)};Un.prototype.updateSocketIds=function(){for(var t in this.nsps)sH.call(this.nsps,t)&&(this.nsps[t].id=this.generateId(t))};Un.prototype.generateId=function(t){return(t==="/"?"":t+"#")+this.engine.id};bRe(Un.prototype);Un.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection};Un.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts};Un.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay};Un.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor};Un.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax};Un.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout};Un.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()};Un.prototype.open=Un.prototype.connect=function(t,e){if(bs("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;bs("opening %s",this.uri),this.engine=vRe(this.uri,this.opts);var n=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var i=sh(n,"open",function(){r.onopen(),t&&t()}),s=sh(n,"error",function(l){if(bs("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",l),t){var c=new Error("Connection error");c.data=l,t(c)}else r.maybeReconnectOnOpen()});if(this._timeout!==!1){var o=this._timeout;bs("connect attempt will timeout after %d",o),o===0&&i.destroy();var a=setTimeout(function(){bs("connect attempt timed out after %d",o),i.destroy(),n.close(),n.emit("error","timeout"),r.emitAll("connect_timeout",o)},o);this.subs.push({destroy:function(){clearTimeout(a)}})}return this.subs.push(i),this.subs.push(s),this};Un.prototype.onopen=function(){bs("open"),this.cleanup(),this.readyState="open",this.emit("open");var t=this.engine;this.subs.push(sh(t,"data",lg(this,"ondata"))),this.subs.push(sh(t,"ping",lg(this,"onping"))),this.subs.push(sh(t,"pong",lg(this,"onpong"))),this.subs.push(sh(t,"error",lg(this,"onerror"))),this.subs.push(sh(t,"close",lg(this,"onclose"))),this.subs.push(sh(this.decoder,"decoded",lg(this,"ondecoded")))};Un.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")};Un.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)};Un.prototype.ondata=function(t){this.decoder.add(t)};Un.prototype.ondecoded=function(t){this.emit("packet",t)};Un.prototype.onerror=function(t){bs("error",t),this.emitAll("error",t)};Un.prototype.socket=function(t,e){var n=this.nsps[t];if(!n){n=new yRe(this,t,e),this.nsps[t]=n;var r=this;n.on("connecting",i),n.on("connect",function(){n.id=r.generateId(t)}),this.autoConnect&&i()}function i(){~iH(r.connecting,n)||r.connecting.push(n)}return n};Un.prototype.destroy=function(t){var e=iH(this.connecting,t);~e&&this.connecting.splice(e,1),!this.connecting.length&&this.close()};Un.prototype.packet=function(t){bs("writing packet %j",t);var e=this;t.query&&t.type===0&&(t.nsp+="?"+t.query),e.encoding?e.packetBuffer.push(t):(e.encoding=!0,this.encoder.encode(t,function(n){for(var r=0;r<n.length;r++)e.engine.write(n[r],t.options);e.encoding=!1,e.processPacketQueue()}))};Un.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}};Un.prototype.cleanup=function(){bs("cleanup");for(var t=this.subs.length,e=0;e<t;e++){var n=this.subs.shift();n.destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()};Un.prototype.close=Un.prototype.disconnect=function(){bs("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,this.readyState==="opening"&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()};Un.prototype.onclose=function(t){bs("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()};Un.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)bs("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();bs("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var n=setTimeout(function(){t.skipReconnect||(bs("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),!t.skipReconnect&&t.open(function(r){r?(bs("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",r.data)):(bs("reconnect success"),t.onreconnect())}))},e);this.subs.push({destroy:function(){clearTimeout(n)}})}};Un.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",t)};(function(t,e){var n=XNe,r=UC,i=oH,s=Qm.exports("socket.io-client");t.exports=e=a;var o=e.managers={};function a(l,c){typeof l=="object"&&(c=l,l=void 0),c=c||{};var u=n(l),h=u.source,f=u.id,d=u.path,p=o[f]&&d in o[f].nsps,m=c.forceNew||c["force new connection"]||c.multiplex===!1||p,v;return m?(s("ignoring socket cache for %s",h),v=i(h,c)):(o[f]||(s("new io instance for %s",h),o[f]=i(h,c)),v=o[f]),u.query&&!c.query&&(c.query=u.query),v.socket(u.path,c)}e.protocol=r.protocol,e.connect=a,e.Manager=oH,e.Socket=I$.exports})(a$,a$.exports);var _Re=a$.exports,N$={exports:{}},e2={},kb={exports:{}},cg=1e3,ug=cg*60,hg=ug*60,Pf=hg*24,SRe=Pf*7,CRe=Pf*365.25,TRe=function(t,e){e=e||{};var n=typeof t;if(n==="string"&&t.length>0)return ERe(t);if(n==="number"&&isFinite(t))return e.long?ARe(t):kRe(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function ERe(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!!e){var n=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*CRe;case"weeks":case"week":case"w":return n*SRe;case"days":case"day":case"d":return n*Pf;case"hours":case"hour":case"hrs":case"hr":case"h":return n*hg;case"minutes":case"minute":case"mins":case"min":case"m":return n*ug;case"seconds":case"second":case"secs":case"sec":case"s":return n*cg;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function kRe(t){var e=Math.abs(t);return e>=Pf?Math.round(t/Pf)+"d":e>=hg?Math.round(t/hg)+"h":e>=ug?Math.round(t/ug)+"m":e>=cg?Math.round(t/cg)+"s":t+"ms"}function ARe(t){var e=Math.abs(t);return e>=Pf?t2(t,e,Pf,"day"):e>=hg?t2(t,e,hg,"hour"):e>=ug?t2(t,e,ug,"minute"):e>=cg?t2(t,e,cg,"second"):t+" ms"}function t2(t,e,n,r){var i=e>=n*1.5;return Math.round(t/n)+" "+r+(i?"s":"")}function MRe(t){n.debug=n,n.default=n,n.coerce=l,n.disable=s,n.enable=i,n.enabled=o,n.humanize=TRe,n.destroy=c,Object.keys(t).forEach(u=>{n[u]=t[u]}),n.names=[],n.skips=[],n.formatters={};function e(u){let h=0;for(let f=0;f<u.length;f++)h=(h<<5)-h+u.charCodeAt(f),h|=0;return n.colors[Math.abs(h)%n.colors.length]}n.selectColor=e;function n(u){let h,f=null,d,p;function m(...v){if(!m.enabled)return;const y=m,w=Number(new Date),x=w-(h||w);y.diff=x,y.prev=h,y.curr=w,h=w,v[0]=n.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let _=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(T,E)=>{if(T==="%%")return"%";_++;const k=n.formatters[E];if(typeof k=="function"){const A=v[_];T=k.call(y,A),v.splice(_,1),_--}return T}),n.formatArgs.call(y,v),(y.log||n.log).apply(y,v)}return m.namespace=u,m.useColors=n.useColors(),m.color=n.selectColor(u),m.extend=r,m.destroy=n.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(d!==n.namespaces&&(d=n.namespaces,p=n.enabled(u)),p),set:v=>{f=v}}),typeof n.init=="function"&&n.init(m),m}function r(u,h){const f=n(this.namespace+(typeof h=="undefined"?":":h)+u);return f.log=this.log,f}function i(u){n.save(u),n.namespaces=u,n.names=[],n.skips=[];let h;const f=(typeof u=="string"?u:"").split(/[\s,]+/),d=f.length;for(h=0;h<d;h++)!f[h]||(u=f[h].replace(/\*/g,".*?"),u[0]==="-"?n.skips.push(new RegExp("^"+u.substr(1)+"$")):n.names.push(new RegExp("^"+u+"$")))}function s(){const u=[...n.names.map(a),...n.skips.map(a).map(h=>"-"+h)].join(",");return n.enable(""),u}function o(u){if(u[u.length-1]==="*")return!0;let h,f;for(h=0,f=n.skips.length;h<f;h++)if(n.skips[h].test(u))return!1;for(h=0,f=n.names.length;h<f;h++)if(n.names[h].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function l(u){return u instanceof Error?u.stack||u.message:u}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}var IRe=MRe;(function(t,e){e.formatArgs=r,e.save=i,e.load=s,e.useColors=n,e.storage=o(),e.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const c="color: "+this.color;l.splice(1,0,c,"color: inherit");let u=0,h=0;l[0].replace(/%[a-zA-Z%]/g,f=>{f!=="%%"&&(u++,f==="%c"&&(h=u))}),l.splice(h,0,c)}e.log=console.debug||console.log||(()=>{});function i(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch{}}function s(){let l;try{l=e.storage.getItem("debug")}catch{}return!l&&typeof process!="undefined"&&"env"in process&&(l={}.DEBUG),l}function o(){try{return localStorage}catch{}}t.exports=IRe(e);const{formatters:a}=t.exports;a.j=function(l){try{return JSON.stringify(l)}catch(c){return"[UnexpectedJSONParseError]: "+c.message}}})(kb,kb.exports);const aH=kb.exports("@feathersjs/errors");function xn(t,e,n,r,i){t=t||"Error";let s,o,a;t instanceof Error?(o=t.message||"Error",t.errors&&(s=t.errors)):typeof t=="object"?(o=t.message||"Error",i=t):o=t,i&&(a=JSON.parse(JSON.stringify(i)),a.errors?(s=a.errors,delete a.errors):i.errors&&(s=JSON.parse(JSON.stringify(i.errors)))),this.type="FeathersError",this.name=e,this.message=o,this.code=n,this.className=r,this.data=a,this.errors=s||{},aH(`${this.name}(${this.code}): ${this.message}`),aH(this.errors),Error.captureStackTrace?Error.captureStackTrace(this,xn):this.stack=new Error().stack}function ji(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t}ji(xn,Error);Object.defineProperty(xn.prototype,"toJSON",{value:function(){return{name:this.name,message:this.message,code:this.code,className:this.className,data:this.data,errors:this.errors}}});function $$(t,e){xn.call(this,t,"BadRequest",400,"bad-request",e)}ji($$,xn);function R$(t,e){xn.call(this,t,"NotAuthenticated",401,"not-authenticated",e)}ji(R$,xn);function D$(t,e){xn.call(this,t,"PaymentError",402,"payment-error",e)}ji(D$,xn);function P$(t,e){xn.call(this,t,"Forbidden",403,"forbidden",e)}ji(P$,xn);function O$(t,e){xn.call(this,t,"NotFound",404,"not-found",e)}ji(O$,xn);function F$(t,e){xn.call(this,t,"MethodNotAllowed",405,"method-not-allowed",e)}ji(F$,xn);function L$(t,e){xn.call(this,t,"NotAcceptable",406,"not-acceptable",e)}ji(L$,xn);function B$(t,e){xn.call(this,t,"Timeout",408,"timeout",e)}ji(B$,xn);function z$(t,e){xn.call(this,t,"Conflict",409,"conflict",e)}ji(z$,xn);function V$(t,e){xn(this,t,"Gone",410,"gone")}ji(V$,xn);function U$(t,e){xn.call(this,t,"LengthRequired",411,"length-required",e)}ji(U$,xn);function W$(t,e){xn.call(this,t,"Unprocessable",422,"unprocessable",e)}ji(W$,xn);function G$(t,e){xn.call(this,t,"TooManyRequests",429,"too-many-requests",e)}ji(G$,xn);function H$(t,e){xn.call(this,t,"GeneralError",500,"general-error",e)}ji(H$,xn);function j$(t,e){xn.call(this,t,"NotImplemented",501,"not-implemented",e)}ji(j$,xn);function q$(t,e){xn.call(this,t,"BadGateway",502,"bad-gateway",e)}ji(q$,xn);function X$(t,e){xn.call(this,t,"Unavailable",503,"unavailable",e)}ji(X$,xn);const lH={FeathersError:xn,BadRequest:$$,NotAuthenticated:R$,PaymentError:D$,Forbidden:P$,NotFound:O$,MethodNotAllowed:F$,NotAcceptable:L$,Timeout:B$,Conflict:z$,Gone:V$,LengthRequired:U$,Unprocessable:W$,TooManyRequests:G$,GeneralError:H$,NotImplemented:j$,BadGateway:q$,Unavailable:X$,400:$$,401:R$,402:D$,403:P$,404:O$,405:F$,406:L$,408:B$,409:z$,410:V$,411:U$,422:W$,429:G$,500:H$,501:j$,502:q$,503:X$};function NRe(t){if(!t)return t;const e=lH[t.name],n=e?new e(t.message,t.data):new Error(t.message||t);return typeof t=="object"&&Object.assign(n,t),n}var Ab=Object.assign({convert:NRe},lH),Of={};Object.defineProperty(Of,"__esModule",{value:!0});Of.StorageWrapper=Of.MemoryStorage=void 0;class $Re{constructor(){this.store={}}getItem(e){return Promise.resolve(this.store[e])}setItem(e,n){return Promise.resolve(this.store[e]=n)}removeItem(e){const n=this.store[e];return delete this.store[e],Promise.resolve(n)}}Of.MemoryStorage=$Re;class RRe{constructor(e){this.storage=e}getItem(e){return Promise.resolve(this.storage.getItem(e))}setItem(e,n){return Promise.resolve(this.storage.setItem(e,n))}removeItem(e){return Promise.resolve(this.storage.removeItem(e))}}Of.StorageWrapper=RRe;Object.defineProperty(e2,"__esModule",{value:!0});e2.AuthenticationClient=void 0;const cH=Ab,DRe=Of,uH=(t,e)=>{const n=new RegExp(`(?:&?)${e}=([^&]*)`),r=t.hash?t.hash.match(n):null;if(r!==null){const[,i]=r;return[i,n]}return[null,n]};class PRe{constructor(e,n){const r=e.io||e.primus,i=new DRe.StorageWrapper(e.get("storage")||n.storage);this.app=e,this.options=n,this.authenticated=!1,this.app.set("storage",i),r&&this.handleSocket(r)}get service(){return this.app.service(this.options.path)}get storage(){return this.app.get("storage")}handleSocket(e){const n=this.app.io?"connect":"open",r=this.app.io?"disconnect":"disconnection";e.on(r,()=>{const i=new Promise(s=>e.once(n,o=>s(o))).then(()=>this.authenticated?this.reAuthenticate(!0):null);this.app.set("authentication",i)})}getFromLocation(e){const[n,r]=uH(e,this.options.locationKey);if(n!==null)return e.hash=e.hash.replace(r,""),Promise.resolve(n);const[i,s]=uH(e,this.options.locationErrorKey);return i!==null?(e.hash=e.hash.replace(s,""),Promise.reject(new cH.NotAuthenticated(decodeURIComponent(i)))):Promise.resolve(null)}setAccessToken(e){return this.storage.setItem(this.options.storageKey,e)}getAccessToken(){return this.storage.getItem(this.options.storageKey).then(e=>!e&&typeof window!="undefined"&&window.location?this.getFromLocation(window.location):e||null)}removeAccessToken(){return this.storage.removeItem(this.options.storageKey)}reset(){return this.app.set("authentication",null),this.authenticated=!1,Promise.resolve(null)}handleError(e,n){if(e.code===401||e.code===403){const r=this.removeAccessToken().then(()=>this.reset());return n==="logout"?r:r.then(()=>Promise.reject(e))}return Promise.reject(e)}reAuthenticate(e=!1,n){const r=this.app.get("authentication");return!r||e===!0?this.getAccessToken().then(i=>{if(!i)throw new cH.NotAuthenticated("No accessToken found in storage");return this.authenticate({strategy:n||this.options.jwtStrategy,accessToken:i})}):r}authenticate(e,n){if(!e)return this.reAuthenticate();const r=this.service.create(e,n).then(i=>{const{accessToken:s}=i;return this.authenticated=!0,this.app.emit("login",i),this.app.emit("authenticated",i),this.setAccessToken(s).then(()=>i)}).catch(i=>this.handleError(i,"authenticate"));return this.app.set("authentication",r),r}logout(){return Promise.resolve(this.app.get("authentication")).then(()=>this.service.remove(null).then(e=>this.removeAccessToken().then(()=>this.reset()).then(()=>(this.app.emit("logout",e),e)))).catch(e=>this.handleError(e,"logout"))}}e2.AuthenticationClient=PRe;var hH={},n2={},oh={},vi={},K$={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.createSymbol=t.makeUrl=t.isPromise=t._=t.stripSlashes=void 0;function e(s){return s.replace(/^(\/+)|(\/+)$/g,"")}t.stripSlashes=e,t._={each(s,o){s&&typeof s.forEach=="function"?s.forEach(o):t._.isObject(s)&&Object.keys(s).forEach(a=>o(s[a],a))},some(s,o){return Object.keys(s).map(a=>[s[a],a]).some(([a,l])=>o(a,l))},every(s,o){return Object.keys(s).map(a=>[s[a],a]).every(([a,l])=>o(a,l))},keys(s){return Object.keys(s)},values(s){return t._.keys(s).map(o=>s[o])},isMatch(s,o){return t._.keys(o).every(a=>s[a]===o[a])},isEmpty(s){return t._.keys(s).length===0},isObject(s){return typeof s=="object"&&!Array.isArray(s)&&s!==null},isObjectOrArray(s){return typeof s=="object"&&s!==null},extend(s,...o){return Object.assign(s,...o)},omit(s,...o){const a=t._.extend({},s);return o.forEach(l=>delete a[l]),a},pick(s,...o){return o.reduce((a,l)=>(s[l]!==void 0&&(a[l]=s[l]),a),{})},merge(s,o){return t._.isObject(s)&&t._.isObject(o)&&Object.keys(o).forEach(a=>{t._.isObject(o[a])?(s[a]||Object.assign(s,{[a]:{}}),t._.merge(s[a],o[a])):Object.assign(s,{[a]:o[a]})}),s}};function n(s){return t._.isObject(s)&&typeof s.then=="function"}t.isPromise=n;function r(s,o={}){const a=typeof o.get=="function"?o.get.bind(o):()=>{},l=a("env")||"production",c=a("host")||{}.HOST_NAME||"localhost",u=l==="development"||l==="test"||l===void 0?"http":"https",h=a("port")||{}.PORT||3030,f=l==="development"||l==="test"||l===void 0?`:${h}`:"";return s=s||"",`${u}://${c}${f}/${t.stripSlashes(s)}`}t.makeUrl=r;function i(s){return typeof Symbol!="undefined"?Symbol(s):s}t.createSymbol=i})(K$);Object.defineProperty(vi,"__esModule",{value:!0});vi.enableHooks=vi.processHooks=vi.getHooks=vi.isHookObject=vi.convertHookData=vi.makeArguments=vi.defaultMakeArguments=vi.createHookObject=vi.ACTIVATE_HOOKS=void 0;const fH=K$,{each:Y$,pick:ORe}=fH._;vi.ACTIVATE_HOOKS=(0,fH.createSymbol)("__feathersActivateHooks");function FRe(t,e={}){const n={};return Object.defineProperty(n,"toJSON",{value(){return ORe(this,"type","method","path","params","id","data","result","error")}}),Object.assign(n,e,{method:t,get path(){const{app:r,service:i}=e;return!i||!r||!r.services?null:Object.keys(r.services).find(s=>r.services[s]===i)}})}vi.createHookObject=FRe;function dH(t){const e=[];return typeof t.id!="undefined"&&e.push(t.id),t.data&&e.push(t.data),e.push(t.params||{}),e}vi.defaultMakeArguments=dH;function LRe(t){switch(t.method){case"find":return[t.params];case"get":case"remove":return[t.id,t.params];case"update":case"patch":return[t.id,t.data,t.params];case"create":return[t.data,t.params]}return dH(t)}vi.makeArguments=LRe;function pH(t){let e={};return Array.isArray(t)?e={all:t}:typeof t!="object"?e={all:[t]}:Y$(t,function(n,r){e[r]=Array.isArray(n)?n:[n]}),e}vi.convertHookData=pH;function mH(t){return typeof t=="object"&&typeof t.method=="string"&&typeof t.type=="string"}vi.isHookObject=mH;function BRe(t,e,n,r,i=!1){const s=t.__hooks[n][r]||[],o=e.__hooks[n][r]||[];return i?o.concat(s):s.concat(o)}vi.getHooks=BRe;function zRe(t,e){let n=e;const r=s=>{if(s){if(!mH(s))throw new Error(`${n.type} hook for '${n.method}' method returned invalid hook object`);n=s}return n};return t.reduce((s,o)=>{const a=o.bind(this);return s.then(l=>a(l)).then(r)},Promise.resolve(n)).then(()=>n).catch(s=>{throw s.hook=n,s})}vi.processHooks=zRe;function VRe(t,e,n){if(typeof t.hooks=="function")return t;const r={};return n.forEach(i=>{r[i]={}}),Object.defineProperty(t,"__hooks",{configurable:!0,value:r,writable:!0}),Object.assign(t,{hooks(i){return Y$(i,(s,o)=>{if(!this.__hooks[o])throw new Error(`'${o}' is not a valid hook type`);const a=pH(s);Y$(a,(l,c)=>{if(c!=="all"&&e.indexOf(c)===-1)throw new Error(`'${c}' is not a valid hook method`)}),e.forEach(l=>{const c=this.__hooks[o][l]||(this.__hooks[o][l]=[]);a.all&&c.push.apply(c,a.all),a[l]&&c.push.apply(c,a[l])})}),this}})}vi.enableHooks=VRe;(function(t){var e=$t&&$t.__createBinding||(Object.create?function(o,a,l,c){c===void 0&&(c=l),Object.defineProperty(o,c,{enumerable:!0,get:function(){return a[l]}})}:function(o,a,l,c){c===void 0&&(c=l),o[c]=a[l]}),n=$t&&$t.__setModuleDefault||(Object.create?function(o,a){Object.defineProperty(o,"default",{enumerable:!0,value:a})}:function(o,a){o.default=a}),r=$t&&$t.__importStar||function(o){if(o&&o.__esModule)return o;var a={};if(o!=null)for(var l in o)l!=="default"&&Object.prototype.hasOwnProperty.call(o,l)&&e(a,o,l);return n(a,o),a},i=$t&&$t.__exportStar||function(o,a){for(var l in o)l!=="default"&&!Object.prototype.hasOwnProperty.call(a,l)&&e(a,o,l)};Object.defineProperty(t,"__esModule",{value:!0}),t.hooks=void 0;const s=r(vi);i(K$,t),t.hooks=s})(oh);Object.defineProperty(n2,"__esModule",{value:!0});n2.authentication=void 0;const URe=oh,WRe=()=>t=>{const{app:e,params:n,path:r,method:i,app:{authentication:s}}=t;return(0,URe.stripSlashes)(s.options.path)===r&&i==="create"?t:Promise.resolve(e.get("authentication")).then(o=>(o&&(t.params=Object.assign({},o,n)),t))};n2.authentication=WRe;var r2={};Object.defineProperty(r2,"__esModule",{value:!0});r2.populateHeader=void 0;const GRe=()=>t=>{const{app:e,params:{accessToken:n}}=t,r=e.authentication;if(e.rest&&n){const{scheme:i,header:s}=r.options,o=`${i} ${n}`;t.params.headers=Object.assign({},{[s]:o},t.params.headers)}return t};r2.populateHeader=GRe;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.populateHeader=t.authentication=void 0;var e=n2;Object.defineProperty(t,"authentication",{enumerable:!0,get:function(){return e.authentication}});var n=r2;Object.defineProperty(t,"populateHeader",{enumerable:!0,get:function(){return n.populateHeader}})})(hH);(function(t,e){var n=$t&&$t.__createBinding||(Object.create?function(u,h,f,d){d===void 0&&(d=f),Object.defineProperty(u,d,{enumerable:!0,get:function(){return h[f]}})}:function(u,h,f,d){d===void 0&&(d=f),u[d]=h[f]}),r=$t&&$t.__setModuleDefault||(Object.create?function(u,h){Object.defineProperty(u,"default",{enumerable:!0,value:h})}:function(u,h){u.default=h}),i=$t&&$t.__importStar||function(u){if(u&&u.__esModule)return u;var h={};if(u!=null)for(var f in u)f!=="default"&&Object.prototype.hasOwnProperty.call(u,f)&&n(h,u,f);return r(h,u),h};Object.defineProperty(e,"__esModule",{value:!0}),e.defaults=e.defaultStorage=e.hooks=e.MemoryStorage=e.AuthenticationClient=e.getDefaultStorage=void 0;const s=e2;Object.defineProperty(e,"AuthenticationClient",{enumerable:!0,get:function(){return s.AuthenticationClient}});const o=i(hH);e.hooks=o;const a=Of;Object.defineProperty(e,"MemoryStorage",{enumerable:!0,get:function(){return a.MemoryStorage}});const l=()=>{try{return new a.StorageWrapper(window.localStorage)}catch{}return new a.MemoryStorage};e.getDefaultStorage=l,e.defaultStorage=(0,e.getDefaultStorage)(),e.defaults={header:"Authorization",scheme:"Bearer",storageKey:"feathers-jwt",locationKey:"access_token",locationErrorKey:"error",jwtStrategy:"jwt",path:"/authentication",Authentication:s.AuthenticationClient,storage:e.defaultStorage};const c=(u={})=>{const h=Object.assign({},e.defaults,u),{Authentication:f}=h;return d=>{const p=new f(d,h);d.authentication=p,d.authenticate=p.authenticate.bind(p),d.reAuthenticate=p.reAuthenticate.bind(p),d.logout=p.logout.bind(p),d.hooks({before:{all:[o.authentication(),o.populateHeader()]}})}};e.default=c,t.exports=Object.assign(c,t.exports)})(N$,N$.exports);var HRe=Hse(N$.exports),Z$={exports:{}},i2={exports:{}};(function(t,e){(function(n,r){t.exports=r()})($t,function(){var n=typeof Object.getOwnPropertySymbols=="function";function r(i,s,o,a){var l=typeof s=="function",c=function(){var u=this._super;this._super=l?s:i[o];var h=a.apply(this,arguments);return this._super=u,h};return l&&(Object.keys(s).forEach(function(u){c[u]=s[u]}),n&&Object.getOwnPropertySymbols(s).forEach(function(u){c[u]=s[u]})),c}return{create:function(){var i=Object.create(this),s=typeof i.__init=="string"?i.__init:"init";return typeof i[s]=="function"&&i[s].apply(i,arguments),i},mixin:function(i,s){var o=s||this,a=/\b_super\b/,l=Object.getPrototypeOf(o)||o.prototype,c={},u=i,h=function(d){var p=Object.getOwnPropertyDescriptor(u,d);!c[d]&&p&&(c[d]=p)};do Object.getOwnPropertyNames(u).forEach(h),n&&Object.getOwnPropertySymbols(u).forEach(h);while((u=Object.getPrototypeOf(u))&&Object.getPrototypeOf(u));var f=function(d){var p=c[d];typeof p.value=="function"&&a.test(p.value)&&(p.value=r(l,o[d],d,p.value)),Object.defineProperty(o,d,p)};return Object.keys(c).forEach(f),n&&Object.getOwnPropertySymbols(c).forEach(f),o},extend:function(i,s){return this.mixin(i,Object.create(s||this))},proxy:function(i){var s=this[i],o=Array.prototype.slice.call(arguments,1);return o.unshift(this),s.bind.apply(s,o)}}})})(i2);var J$={exports:{}},Q$={exports:{}},fg=typeof Reflect=="object"?Reflect:null,gH=fg&&typeof fg.apply=="function"?fg.apply:function(e,n,r){return Function.prototype.apply.call(e,n,r)},s2;fg&&typeof fg.ownKeys=="function"?s2=fg.ownKeys:Object.getOwnPropertySymbols?s2=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:s2=function(e){return Object.getOwnPropertyNames(e)};function jRe(t){console&&console.warn&&console.warn(t)}var vH=Number.isNaN||function(e){return e!==e};function sr(){sr.init.call(this)}Q$.exports=sr;Q$.exports.once=YRe;sr.EventEmitter=sr;sr.prototype._events=void 0;sr.prototype._eventsCount=0;sr.prototype._maxListeners=void 0;var yH=10;function o2(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(sr,"defaultMaxListeners",{enumerable:!0,get:function(){return yH},set:function(t){if(typeof t!="number"||t<0||vH(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");yH=t}});sr.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};sr.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||vH(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function bH(t){return t._maxListeners===void 0?sr.defaultMaxListeners:t._maxListeners}sr.prototype.getMaxListeners=function(){return bH(this)};sr.prototype.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(n.length>0&&(o=n[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=s[e];if(l===void 0)return!1;if(typeof l=="function")gH(l,this,n);else for(var c=l.length,u=CH(l,c),r=0;r<c;++r)gH(u[r],this,n);return!0};function wH(t,e,n,r){var i,s,o;if(o2(n),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),s=t._events),o=s[e]),o===void 0)o=s[e]=n,++t._eventsCount;else if(typeof o=="function"?o=s[e]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),i=bH(t),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,jRe(a)}return t}sr.prototype.addListener=function(e,n){return wH(this,e,n,!1)};sr.prototype.on=sr.prototype.addListener;sr.prototype.prependListener=function(e,n){return wH(this,e,n,!0)};function qRe(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function xH(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=qRe.bind(r);return i.listener=n,r.wrapFn=i,i}sr.prototype.once=function(e,n){return o2(n),this.on(e,xH(this,e,n)),this};sr.prototype.prependOnceListener=function(e,n){return o2(n),this.prependListener(e,xH(this,e,n)),this};sr.prototype.removeListener=function(e,n){var r,i,s,o,a;if(o2(n),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount==0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===n||r[o].listener===n){a=r[o].listener,s=o;break}if(s<0)return this;s===0?r.shift():XRe(r,s),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||n)}return this};sr.prototype.off=sr.prototype.removeListener;sr.prototype.removeAllListeners=function(e){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var s=Object.keys(r),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(e,n[i]);return this};function _H(t,e,n){var r=t._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?KRe(i):CH(i,i.length)}sr.prototype.listeners=function(e){return _H(this,e,!0)};sr.prototype.rawListeners=function(e){return _H(this,e,!1)};sr.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):SH.call(t,e)};sr.prototype.listenerCount=SH;function SH(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}sr.prototype.eventNames=function(){return this._eventsCount>0?s2(this._events):[]};function CH(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function XRe(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function KRe(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function YRe(t,e){return new Promise(function(n,r){function i(o){t.removeListener(e,s),r(o)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",i),n([].slice.call(arguments))}TH(t,e,s,{once:!0}),e!=="error"&&ZRe(t,i,{once:!0})})}function ZRe(t,e,n){typeof t.on=="function"&&TH(t,"error",e,n)}function TH(t,e,n,r){if(typeof t.on=="function")r.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(s){r.once&&t.removeEventListener(e,i),n(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}(function(t,e){const{EventEmitter:n}=Q$.exports,r=i2.exports,i=e.eventHook=function(){return function(a){const{app:l,service:c}=a,u=a.event===null?a.event:l.eventMappings[a.method],h=c._hookEvents&&c._hookEvents.indexOf(u)!==-1;u&&h&&a.type!=="error"&&(Array.isArray(a.result)?a.result:[a.result]).forEach(d=>c.emit(u,d,a))}},s=e.eventMixin=function(a){if(a._serviceEvents)return;const l=this,c=typeof a.on=="function"&&typeof a.emit=="function";typeof a.mixin=="function"&&!c&&a.mixin(n.prototype),Object.defineProperties(a,{_serviceEvents:{value:Array.isArray(a.events)?a.events.slice():[]},_hookEvents:{value:[]}}),Object.keys(l.eventMappings).forEach(u=>{const h=l.eventMappings[u],f=a._serviceEvents.indexOf(h)!==-1;typeof a[u]=="function"&&!f&&(a._serviceEvents.push(h),a._hookEvents.push(h))})};t.exports=function(){return function(o){Object.assign(o,{eventMappings:{create:"created",update:"updated",remove:"removed",patch:"patched"}}),o.hooks({finally:i()}),r.mixin(n.prototype,o),o.mixins.push(s)}}})(J$,J$.exports);var a2={exports:{}};const{_:JRe}=oh,QRe=t=>{const{service:e,method:n}=t,r=e.methods[n];return t.arguments.forEach((i,s)=>{t[r[s]]=i}),t.params||(t.params={}),t},eDe=t=>{const{service:e,method:n,path:r}=t,i=e.methods[n];if(i.includes("id")&&t.id===void 0)throw new Error(`An id must be provided to the '${r}.${n}' method`);if(i.includes("data")&&!JRe.isObjectOrArray(t.data))throw new Error(`A data object must be provided to the '${r}.${n}' method`);return t};var tDe=[QRe,eDe];(function(t,e){const{hooks:n,isPromise:r}=oh,i=tDe,{createHookObject:s,getHooks:o,processHooks:a,enableHooks:l,ACTIVATE_HOOKS:c}=n,u=function({app:d,service:p,method:m,original:v}){return(y={})=>{const w=d.hookTypes.reduce((x,_)=>{const S=y[_]||[];return x[_]=Array.isArray(S)?S:[S],x},{});return function(...x){const _=x[x.length-1]===!0?x.pop():!1,S=s(m,{type:"before",arguments:x,service:p,app:d});return Promise.resolve(S).then(T=>a.call(p,i.concat(w.before),T)).then(T=>typeof T.result!="undefined"?T:new Promise(k=>{const A=v||p[m],M=p.methods[m].map(P=>T[P]),D=A.apply(p,M);if(!r(D))throw new Error(`Service method '${T.method}' for '${T.path}' service must return a promise`);k(D)}).then(k=>(T.result=k,T)).catch(k=>{throw k.hook=T,k})).then(T=>{const E=Object.assign({},T,{type:"after"});return a.call(p,w.after,E)}).catch(T=>{const E=Object.assign({},T.hook,{type:"error",original:T.hook,error:T,result:void 0});return a.call(p,w.error,E).catch(k=>Object.assign({},k.hook,{error:k,result:void 0}))}).then(T=>a.call(p,w.finally,T).catch(E=>Object.assign({},E.hook,{error:E,result:void 0}))).then(T=>typeof T.error!="undefined"&&typeof T.result=="undefined"?Promise.reject(_?T:T.error):_?T:T.result)}}},h=e.hookMixin=function(d){if(typeof d.hooks=="function")return;d.methods=Object.getOwnPropertyNames(d).filter(y=>typeof d[y]=="function"&&d[y][c]).reduce((y,w)=>(y[w]=d[w][c],y),d.methods||{}),Object.assign(d.methods,{find:["params"],get:["id","params"],create:["data","params"],update:["id","data","params"],patch:["id","data","params"],remove:["id","params"]});const p=this,m=Object.keys(d.methods),v=m.reduce((y,w)=>(typeof d[w]!="function"||(y[w]=function(){const x=this,_=Array.from(arguments),S=x._super.bind(x);return u({app:p,service:x,method:w,original:S})({before:o(p,x,"before",w),after:o(p,x,"after",w,!0),error:o(p,x,"error",w,!0),finally:o(p,x,"finally",w,!0)})(..._)}),y),{});l(d,m,p.hookTypes),d.mixin(v)};t.exports=function(){return function(f){Object.assign(f,{hookTypes:["before","after","error","finally"]}),l(f,f.methods,f.hookTypes),f.mixins.push(h)}},t.exports.withHooks=u,t.exports.ACTIVATE_HOOKS=c,t.exports.activateHooks=function(d){return p=>(Object.defineProperty(p,c,{value:d}),p)}})(a2,a2.exports);var EH="4.5.12";const eR=kb.exports("feathers:application"),{stripSlashes:kH}=oh,nDe=i2.exports,rDe=J$.exports,iDe=a2.exports,sDe=EH,AH=nDe.extend({create:null}),oDe={init(){Object.assign(this,{version:sDe,methods:["find","get","create","update","patch","remove"],mixins:[],services:{},providers:[],_setup:!1,settings:{}}),this.configure(iDe()),this.configure(rDe())},get(t){return this.settings[t]},set(t,e){return this.settings[t]=e,this},disable(t){return this.settings[t]=!1,this},disabled(t){return!this.settings[t]},enable(t){return this.settings[t]=!0,this},enabled(t){return!!this.settings[t]},configure(t){return t.call(this,this),this},service(t,e){if(typeof e!="undefined")throw new Error("Registering a new service with `app.service(path, service)` is no longer supported. Use `app.use(path, service)` instead.");const n=kH(t)||"/",r=this.services[n];return typeof r=="undefined"&&typeof this.defaultService=="function"?this.use(n,this.defaultService(n)).service(n):r},use(t,e,n={}){if(typeof t!="string")throw new Error(`'${t}' is not a valid service path.`);const r=kH(t)||"/",i=typeof e.service=="function"&&e.services,s=this.methods.concat("setup").some(a=>typeof e[a]=="function");if(i){const a=e;return Object.keys(a.services).forEach(l=>this.use(`${r}/${l}`,a.service(l))),this}if(!s)throw new Error(`Invalid service object passed for path \`${r}\``);const o=AH.isPrototypeOf(e)?e:AH.extend(e);return eR(`Registering new service at \`${r}\``),this.mixins.forEach(a=>a.call(this,o,r,n)),typeof o._setup=="function"&&o._setup(this,r),this.providers.forEach(a=>a.call(this,o,r,n)),this._isSetup&&typeof o.setup=="function"&&(eR(`Setting up service for \`${r}\``),o.setup(this,r)),this.services[r]=o,this},setup(){return Object.keys(this.services).forEach(t=>{const e=this.services[t];eR(`Setting up service for \`${t}\``),typeof e.setup=="function"&&e.setup(this,t)}),this._isSetup=!0,this}};var aDe=oDe;const lDe=i2.exports,cDe=aDe,uDe=EH,{ACTIVATE_HOOKS:hDe,activateHooks:fDe}=a2.exports,dDe=Object.create(null);function Mb(){const t=Object.create(dDe);return lDe.mixin(cDe,t),t.init(),t}Mb.version=uDe;Mb.ACTIVATE_HOOKS=hDe;Mb.activateHooks=fDe;Z$.exports=Mb;Z$.exports.default=Mb;var pDe=Z$.exports,tR={exports:{}},l2={},mDe=$t&&$t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(l2,"__esModule",{value:!0});l2.Service=void 0;const gDe=mDe(kb.exports),MH=Ab,IH=(0,gDe.default)("@feathersjs/transport-commons/client"),vDe=["addListener","emit","listenerCount","listeners","on","once","prependListener","prependOnceListener","removeAllListeners","removeListener"],yDe=["eventNames","getMaxListeners","setMaxListeners"],bDe=t=>{yDe.forEach(e=>{t[e]=function(...n){if(typeof this.connection[e]!="function")throw new Error(`Can not call '${e}' on the client service connection`);return this.connection[e](...n)}}),vDe.forEach(e=>{t[e]=function(n,...r){if(typeof this.connection[e]!="function")throw new Error(`Can not call '${e}' on the client service connection`);const i=`${this.path} ${n}`;IH(`Calling emitter method ${e} with namespaced event '${i}'`);const s=this.connection[e](i,...r);return s===this.connection?this:s}})};class wDe{constructor(e){this.events=e.events,this.path=e.name,this.connection=e.connection,this.method=e.method,this.timeout=e.timeout||5e3,bDe(this)}send(e,...n){return new Promise((r,i)=>{const s=setTimeout(()=>i(new MH.Timeout(`Timeout of ${this.timeout}ms exceeded calling ${e} on ${this.path}`,{timeout:this.timeout,method:e,path:this.path})),this.timeout);n.unshift(e,this.path),n.push(function(o,a){return o=(0,MH.convert)(o),clearTimeout(s),o?i(o):r(a)}),IH(`Sending socket.${this.method}`,n),this.connection[this.method](...n)})}find(e={}){return this.send("find",e.query||{})}get(e,n={}){return this.send("get",e,n.query||{})}create(e,n={}){return this.send("create",e,n.query||{})}update(e,n,r={}){return this.send("update",e,n,r.query||{})}patch(e,n,r={}){return this.send("patch",e,n,r.query||{})}remove(e,n={}){return this.send("remove",e,n.query||{})}off(e,...n){if(typeof this.connection.off=="function"){const r=this.connection.off(`${this.path} ${e}`,...n);return r===this.connection?this:r}else if(n.length===0)return this.removeAllListeners(e);return this.removeListener(e,...n)}}l2.Service=wDe;var xDe=l2.Service;const NH=xDe;function $H(t,e){if(!t)throw new Error("Socket.io connection needs to be provided");if(t&&t.io&&t.io.engine&&t.io.engine.transport&&t.io.engine.transport.query&&t.io.engine.transport.query.EIO>3)throw console.error("You are trying to use the Socket.io client version 3 or later with Feathers v4 which only supports Socket.io version 2. Please use socket.io-client version 2 instead."),new Error("socket.io-client must be version 2.x");const n=function(i){const s=Object.keys(this.eventMappings||{}).map(a=>this.eventMappings[a]),o=Object.assign({},e,{events:s,name:i,connection:t,method:"emit"});return new NH(o)},r=function(i){if(typeof i.defaultService=="function")throw new Error("Only one default client provider can be configured");i.io=t,i.defaultService=n};return r.Service=NH,r.service=n,r}tR.exports=$H;tR.exports.default=$H;var _De=tR.exports,c2={exports:{}},RH={},u2={},h2={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.OPERATORS=e.FILTERS=void 0;const n=oh,r=Ab;function i(u){if(typeof u!="undefined")return Math.abs(parseInt(u,10))}function s(u,h){if(h&&h.default){const f=typeof u=="number"&&!isNaN(u)?u:h.default,d=typeof h.max=="number"?h.max:Number.MAX_VALUE;return Math.min(f,d)}return u}function o(u){return typeof u!="object"||Array.isArray(u)?u:Object.keys(u).reduce((h,f)=>(h[f]=typeof u[f]=="object"?u[f]:parseInt(u[f],10),h),{})}function a(u,h,f){if(Array.isArray(u))return u.map(d=>a(d,h,f));if(n._.isObject(u)&&u.constructor==={}.constructor){const d={};return n._.each(u,(p,m)=>{if(m[0]==="$"){if(f[m]!==void 0)return;if(!h.includes(m))throw new r.BadRequest(`Invalid query parameter ${m}`,u)}d[m]=a(p,h,f)}),Object.getOwnPropertySymbols(u).forEach(p=>{d[p]=u[p]}),d}return u}function l(u,h,f,d){return Array.isArray(f)?n._.each(f,p=>{h[p]!==void 0&&(u[p]=h[p])}):n._.each(f,(p,m)=>{const v=p(h[m],d);v!==void 0&&(u[m]=v)}),u}e.FILTERS={$sort:u=>o(u),$limit:(u,h)=>s(i(u),h.paginate),$skip:u=>i(u),$select:u=>u},e.OPERATORS=["$in","$nin","$lt","$lte","$gt","$gte","$ne","$or"];function c(u,h={}){const{filters:f={},operators:d=[]}=h,p={};return p.filters=l({},u,e.FILTERS,h),p.filters=l(p.filters,u,f,h),p.query=a(u,e.OPERATORS.concat(d),p.filters),p}e.default=c,t.exports=Object.assign(c,t.exports)})(h2,h2.exports);var SDe=$t&&$t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(u2,"__esModule",{value:!0});u2.AdapterService=void 0;const Ib=Ab,CDe=SDe(h2.exports),dg=(t,e,...n)=>typeof t[e]!="function"?Promise.reject(new Ib.NotImplemented(`Method ${e} not available`)):t[e](...n),TDe={find:!0,get:!1,update:!1};class EDe{constructor(e){this.options=Object.assign({id:"id",events:[],paginate:{},multi:!1,filters:[],whitelist:[]},e)}get id(){return this.options.id}get events(){return this.options.events}filterQuery(e={},n={}){const r=typeof e.paginate!="undefined"?e.paginate:this.options.paginate,{query:i={}}=e,s=Object.assign({operators:this.options.whitelist||[],filters:this.options.filters,paginate:r},n),o=(0,CDe.default)(i,s);return Object.assign(o,{paginate:r})}allowsMulti(e){const n=TDe[e];if(typeof n!="undefined")return n;const r=this.options.multi;return r===!0||r===!1?r:r.includes(e)}find(e){return dg(this,"_find",e)}get(e,n){return dg(this,"_get",e,n)}create(e,n){return Array.isArray(e)&&!this.allowsMulti("create")?Promise.reject(new Ib.MethodNotAllowed("Can not create multiple entries")):dg(this,"_create",e,n)}update(e,n,r){return e===null||Array.isArray(n)?Promise.reject(new Ib.BadRequest("You can not replace multiple instances. Did you mean 'patch'?")):dg(this,"_update",e,n,r)}patch(e,n,r){return e===null&&!this.allowsMulti("patch")?Promise.reject(new Ib.MethodNotAllowed("Can not patch multiple entries")):dg(this,"_patch",e,n,r)}remove(e,n){return e===null&&!this.allowsMulti("remove")?Promise.reject(new Ib.MethodNotAllowed("Can not remove multiple entries")):dg(this,"_remove",e,n)}}u2.AdapterService=EDe;var DH={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sorter=t.compare=t.compareArrays=t.compareNSB=void 0;function e(s,o){return s<o?-1:s>o?1:0}t.compareNSB=e;function n(s,o){let a,l;for(a=0;a<Math.min(s.length,o.length);a+=1)if(l=t.compare(s[a],o[a]),l!==0)return l;return t.compareNSB(s.length,o.length)}t.compareArrays=n;function r(s,o,a=t.compareNSB){const{compareNSB:l,compare:c,compareArrays:u}=t;if(s===void 0)return o===void 0?0:-1;if(o===void 0)return s===void 0?0:1;if(s===null)return o===null?0:-1;if(o===null)return s===null?0:1;if(typeof s=="number")return typeof o=="number"?l(s,o):-1;if(typeof o=="number")return typeof s=="number"?l(s,o):1;if(typeof s=="string")return typeof o=="string"?a(s,o):-1;if(typeof o=="string")return typeof s=="string"?a(s,o):1;if(typeof s=="boolean")return typeof o=="boolean"?l(s,o):-1;if(typeof o=="boolean")return typeof s=="boolean"?l(s,o):1;if(s instanceof Date)return o instanceof Date?l(s.getTime(),o.getTime()):-1;if(o instanceof Date)return s instanceof Date?l(s.getTime(),o.getTime()):1;if(Array.isArray(s))return Array.isArray(o)?u(s,o):-1;if(Array.isArray(o))return Array.isArray(s)?u(s,o):1;const h=Object.keys(s).sort(),f=Object.keys(o).sort();let d=0;for(let p=0;p<Math.min(h.length,f.length);p+=1)if(d=c(s[h[p]],o[f[p]]),d!==0)return d;return l(h.length,f.length)}t.compare=r;function i(s){const o=Object.keys(s).map(a=>{const l=s[a];return{key:a,direction:l}});return function(a,l){let c;for(const u of o)if(c=u.direction*t.compare(a[u.key],l[u.key]),c!==0)return c;return 0}}t.sorter=i})(DH);(function(t){var e=$t&&$t.__createBinding||(Object.create?function(l,c,u,h){h===void 0&&(h=u),Object.defineProperty(l,h,{enumerable:!0,get:function(){return c[u]}})}:function(l,c,u,h){h===void 0&&(h=u),l[h]=c[u]}),n=$t&&$t.__exportStar||function(l,c){for(var u in l)u!=="default"&&!Object.prototype.hasOwnProperty.call(c,u)&&e(c,l,u)},r=$t&&$t.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(t,"__esModule",{value:!0}),t.select=t.OPERATORS=t.FILTERS=t.filterQuery=t.AdapterService=void 0;const i=oh;var s=u2;Object.defineProperty(t,"AdapterService",{enumerable:!0,get:function(){return s.AdapterService}});var o=h2.exports;Object.defineProperty(t,"filterQuery",{enumerable:!0,get:function(){return r(o).default}}),Object.defineProperty(t,"FILTERS",{enumerable:!0,get:function(){return o.FILTERS}}),Object.defineProperty(t,"OPERATORS",{enumerable:!0,get:function(){return o.OPERATORS}}),n(DH,t);function a(l,...c){const u=l&&l.query&&l.query.$select;Array.isArray(u)&&c.length&&u.push(...c);const h=f=>Array.isArray(u)?i._.pick(f,...u):f;return f=>Array.isArray(f)?f.map(h):h(f)}t.select=a})(RH);function nR(t){var e="[object "+t+"]";return function(n){return Object.prototype.toString.call(n)===e}}var ah=nR("Array"),PH=nR("Object"),kDe=nR("Function");function pa(t,e){return kDe(t.get)?t.get(e):t[e]}const ADe=t=>(e,n,r,i,s)=>s?Boolean(s.find(([o,a,l])=>t(e,a,l))):t(e,n,r,i),ma=ADe(t=>function(e,n,r,i,s){if(!ah(n)||!n.length)return t(e,n);for(var o=0,a=n.length;o<a;o++)if(t(e,pa(n,o)))return!0;return!1});function OH(t){return function(e,n,r,i){if(!ah(n)||!n.length)return t(e,n,r,i);for(var s=0,o=n.length;s<o;s++)if(!t(e,pa(n,s),n,i))return!1;return!0}}function rl(t,e,n,r,i){return t.validate(t.options,e,n,r,i)}var f2={$eq:ma(function(t,e){return t(e)}),$ne:OH(function(t,e){return t(e)}),$gt:ma(function(t,e){return t(e)}),$gte:ma(function(t,e){return t(e)}),$lt:ma(function(t,e){return t(e)}),$lte:ma(function(t,e){return t(e)}),$mod:ma(function(t,e){return t(e)}),$in(t,e){return t(e)},$nin:function(t,e){return t(e)},$not:function(t,e,n,r){return t(e,n,r)},$type:function(t,e){return t(e)},$all:function(t,e,n,r,i){return f2.$and(t,e,n,r,i)},$size:function(t,e){return e?t===e.length:!1},$or:function(t,e,n,r){for(var i=0,s=t.length;i<s;i++)if(rl(pa(t,i),e,n,r))return!0;return!1},$nor:function(t,e,n,r){return!f2.$or(t,e,n,r)},$and:function(t,e,n,r,i){if(i){for(var s=0,o=t.length;s<o;s++)if(!rl(pa(t,s),e,n,r,i))return!1}else for(var s=0,o=t.length;s<o;s++)if(!rl(pa(t,s),e,n,r,i))return!1;return!0},$regex:ma(function(t,e){return typeof e=="string"&&t.test(e)}),$where:function(t,e,n,r){return t.call(e,e,n,r)},$elemMatch:function(t,e,n,r){return ah(e)?!!~MDe(e,t):rl(t,e,n,r)},$exists:function(t,e,n,r){return r.hasOwnProperty(n)===t}},Nb={$eq:function(t,e,{comparable:n,compare:r}){return t instanceof RegExp?ma(function(i){return typeof i=="string"&&t.test(i)}):t instanceof Function?ma(t):ah(t)&&!t.length?ma(function(i){return ah(i)&&!i.length}):ma(t===null?function(i){return i==null}:function(i){return r(n(i),n(t))===0})},$gt:function(t,e,{comparable:n,compare:r}){return function(i){return r(n(i),n(t))>0}},$gte:function(t,e,{comparable:n,compare:r}){return function(i){return r(n(i),n(t))>=0}},$lt:function(t,e,{comparable:n,compare:r}){return function(i){return r(n(i),n(t))<0}},$lte:function(t,e,{comparable:n,compare:r}){return function(i){return r(n(i),n(t))<=0}},$in:function(t,e,n){const{comparable:r}=n;return function(i){if(i instanceof Array){for(var s=i.length;s--;)if(~t.indexOf(r(pa(i,s))))return!0}else{var o=r(i);if(o===i&&typeof i=="object"){for(var s=t.length;s--;)if(String(t[s])===String(i)&&String(i)!=="[object Object]")return!0}if(typeof o=="undefined"){for(var s=t.length;s--;)if(t[s]==null)return!0}for(var s=t.length;s--;){var a=LH(pa(t,s),n),l=rl(a,o,s,t);if(l&&String(l)!=="[object Object]"&&String(o)!=="[object Object]")return!0}return!!~t.indexOf(o)}return!1}},$nin:function(t,e,n){const r=Nb.$in(t,e,n);return function(i,s,o,a){return!r(i,s,o,a)}},$mod:function(t){return function(e){return e%t[0]==t[1]}},$ne:function(t,e,n){const r=Nb.$eq(t,e,n);return OH(function(i,s,o,a){return!r(i,s,o,a)})},$and:function(t,e,n){return t.map(pg(n))},$all:function(t,e,n){return Nb.$and(t,e,n)},$or:function(t,e,n){return t.map(pg(n))},$nor:function(t,e,n){return t.map(pg(n))},$not:function(t,e,n){const r=pg(n)(t);return function(i,s,o){return!rl(r,i,s,o)}},$type:function(t){return function(e,n,r){return e!=null?e instanceof t||e.constructor==t:!1}},$regex:function(t,e){return new RegExp(t,e.$options)},$where:function(t){return typeof t=="string"?new Function("obj","return "+t):t},$elemMatch:function(t,e,n){return pg(n)(t)},$exists:function(t){return!!t}};function MDe(t,e){for(var n=0;n<t.length;n++)if(pa(t,n),rl(e,pa(t,n)))return n;return-1}function d2(t,e){return{options:t,validate:e}}function IDe({keyPath:t,child:e,query:n},r){const i=[];if(rR(r,t,0,r,i),i.length===1){const[s,o,a]=i[0];return rl(e,s,o,a)}return n&&n.$ne,i.map(([s])=>s),rl(e,void 0,void 0,void 0,i)}function rR(t,e,n,r,i){if(n===e.length||t==null){i.push([t,e[n-1],r]);return}var s=pa(e,n);if(ah(t)&&isNaN(Number(s)))for(var o=0,a=t.length;o<a;o++)rR(pa(t,o),e,n,t,i);else rR(pa(t,s),e,n+1,t,i)}function NDe(t,e,n){return d2({keyPath:t,child:e,query:n},IDe)}function $De(t){return t&&(t.constructor===Object||t.constructor===Array||t.constructor.toString()==="function Object() { [native code] }"||t.constructor.toString()==="function Array() { [native code] }")}function pg(t){const{comparable:e,expressions:n}=t;var r=function(a){return(!a||!$De(a))&&(a={$eq:a}),a},i=function(a){a=e(a);var l=[];for(var c in a){var u=a[c];if(c!=="$options"){var h=f2[c]||t&&n&&n[c];if(h)Nb[c]&&(u=Nb[c](u,a,t)),l.push(d2(e(u),h));else{if(c.charCodeAt(0)===36)throw new Error("Unknown operation "+c);var f=c.split(".");l.push(NDe(f,s(u),u))}}}return l.length===1?l[0]:d2(l,f2.$and)},s=function(a){return a=r(a),RDe(a)?d2(a,p2):i(a)},o=function(a){return i(r(a))};return o}function p2(t,e){if(Object.prototype.toString.call(t)!==Object.prototype.toString.call(e))return!1;if(PH(t)){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var n in t)if(!p2(t[n],e[n]))return!1;return!0}else if(ah(t)){if(t.length!==e.length)return!1;for(var r=0,i=t.length;r<i;r++)if(!p2(t[r],e[r]))return!1;return!0}else return t===e}function FH(t,e){if(!PH(t))return e;for(var n in t)e.push(n),FH(t[n],e);return e}function RDe(t){return FH(t,[]).join(",").search(/[$.]/)===-1}function LH(t,e){var n=pg(e)(t);return e&&e.select&&(n={options:n,validate:function(r,i,s,o){return rl(r,i&&e.select(i),s,o)}}),n}function DDe(t,e){e=Object.assign({compare:BH,comparable:iR},e);var n=LH(t,e);return function(r,i,s){return rl(n,r,i,s)}}function BH(t,e){if(p2(t,e))return 0;if(typeof t==typeof e){if(t>e)return 1;if(t<e)return-1}}function iR(t){return t instanceof Date?t.getTime():ah(t)?t.map(iR):t&&typeof t.toJSON=="function"?t.toJSON():t}var PDe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:DDe,compare:BH,comparable:iR}),ODe=A0(PDe);const FDe=Ab,{_:mg}=oh,{sorter:LDe,select:BDe,AdapterService:zDe}=RH,VDe=ODe.default,m2=(t,...e)=>BDe(...e)(JSON.parse(JSON.stringify(t)));class zH extends zDe{constructor(e={}){super(mg.extend({id:"id",matcher:VDe,sorter:LDe},e));this._uId=e.startId||0,this.store=e.store||{}}async getEntries(e={}){const{query:n}=this.filterQuery(e);return this._find(Object.assign({},e,{paginate:!1,query:n}))}async _find(e={}){const{query:n,filters:r,paginate:i}=this.filterQuery(e);let s=mg.values(this.store).filter(this.options.matcher(n));const o=s.length;r.$sort!==void 0&&s.sort(this.options.sorter(r.$sort)),r.$skip!==void 0&&(s=s.slice(r.$skip)),r.$limit!==void 0&&(s=s.slice(0,r.$limit));const a={total:o,limit:r.$limit,skip:r.$skip||0,data:s.map(l=>m2(l,e))};return i&&i.default?a:a.data}async _get(e,n={}){if(e in this.store){const{query:r}=this.filterQuery(n),i=this.store[e];if(this.options.matcher(r)(i))return m2(i,n,this.id)}throw new FDe.NotFound(`No record found for id '${e}'`)}async _create(e,n={}){if(Array.isArray(e))return Promise.all(e.map(o=>this._create(o,n)));const r=e[this.id]||this._uId++,i=mg.extend({},e,{[this.id]:r}),s=this.store[r]=i;return m2(s,n,this.id)}async _update(e,n,r={}){const s=(await this._get(e))[this.id];return e=s==e?s:e,this.store[e]=mg.extend({},n,{[this.id]:e}),this._get(e,r)}async _patch(e,n,r={}){const i=s=>{const o=s[this.id];return this.store[o]=mg.extend(this.store[o],mg.omit(n,this.id)),m2(this.store[o],r,this.id)};return e===null?(await this.getEntries(r)).map(i):i(await this._get(e,r))}async _remove(e,n={}){if(e===null){const i=await this.getEntries(n);return Promise.all(i.map(s=>this._remove(s[this.id],n)))}const r=await this._get(e,n);return delete this.store[e],r}}c2.exports=t=>new zH(t);c2.exports.Service=zH;var UDe=c2.exports,sR={exports:{}};const{Service:VH}=c2.exports,UH=[];class WDe extends VH{constructor(e={}){super(e);if(this._storageKey=e.name||"feathers",this._storage=e.storage||typeof window!="undefined"&&window.localStorage,this._throttle=e.throttle||200,this._reuseKeys=e.reuseKeys||!1,this.store=null,!this._storage)throw new Error("The `storage` option needs to be provided");if(UH.indexOf(this._storageKey)===-1)UH.push(this._storageKey);else if(!this._reuseKeys)throw new Error(`The storage name '${this._storageKey}' is already in use by another instance.`);this.ready()}ready(){return this.store?Promise.resolve(this.store):Promise.resolve(this._storage.getItem(this._storageKey)).then(e=>JSON.parse(e||"{}")).then(e=>{const n=Object.keys(e),r=e[n[n.length-1]];return this._uId=n.length&&typeof r[this.id]!="undefined"?r[this.id]+1:this._uId,this.store=e})}flush(e){return this._timeout||(this._timeout=setTimeout(()=>{this._storage.setItem(this._storageKey,JSON.stringify(this.store)),delete this._timeout},this._throttle)),e}execute(e,...n){return this.ready().then(()=>super[e](...n))}find(...e){return this.execute("find",...e)}get(...e){return this.execute("get",...e)}create(...e){return this.execute("create",...e).then(n=>this.flush(n))}patch(...e){return this.execute("patch",...e).then(n=>this.flush(n))}update(...e){return this.execute("update",...e).then(n=>this.flush(n))}remove(...e){return this.execute("remove",...e).then(n=>this.flush(n))}}sR.exports=function(e){return new WDe(e)};sR.exports.Service=VH;var GDe=sR.exports,oR={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(t,e){(function(){var n,r="4.17.21",i=200,s="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",o="Expected a function",a="Invalid `variable` option passed into `_.template`",l="__lodash_hash_undefined__",c=500,u="__lodash_placeholder__",h=1,f=2,d=4,p=1,m=2,v=1,y=2,w=4,x=8,_=16,S=32,T=64,E=128,k=256,A=512,M=30,D="...",P=800,N=16,R=1,F=2,O=3,K=1/0,J=9007199254740991,re=17976931348623157e292,ae=0/0,pe=4294967295,ke=pe-1,Te=pe>>>1,Ne=[["ary",E],["bind",v],["bindKey",y],["curry",x],["curryRight",_],["flip",A],["partial",S],["partialRight",T],["rearg",k]],we="[object Arguments]",me="[object Array]",He="[object AsyncFunction]",Fe="[object Boolean]",je="[object Date]",Ve="[object DOMException]",Se="[object Error]",nt="[object Function]",Ct="[object GeneratorFunction]",pt="[object Map]",Ht="[object Number]",Mt="[object Null]",q="[object Object]",Y="[object Promise]",Xe="[object Proxy]",Re="[object RegExp]",Et="[object Set]",st="[object String]",ee="[object Symbol]",We="[object Undefined]",ot="[object WeakMap]",rt="[object WeakSet]",Ke="[object ArrayBuffer]",lt="[object DataView]",it="[object Float32Array]",ce="[object Float64Array]",qe="[object Int8Array]",bt="[object Int16Array]",Ot="[object Int32Array]",gt="[object Uint8Array]",dn="[object Uint8ClampedArray]",Kn="[object Uint16Array]",ur="[object Uint32Array]",go=/\b__p \+= '';/g,Yn=/\b(__p \+=) '' \+/g,Ds=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Li=/&(?:amp|lt|gt|quot|#39);/g,wc=/[&<>"']/g,vo=RegExp(Li.source),tp=RegExp(wc.source),qs=/<%-([\s\S]+?)%>/g,np=/<%([\s\S]+?)%>/g,xc=/<%=([\s\S]+?)%>/g,jk=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,qk=/^\w*$/,Xk=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,oy=/[\\^$.*+?()[\]{}|]/g,Kk=RegExp(oy.source),ay=/^\s+/,d1=/\s/,Yk=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Zk=/\{\n\/\* \[wrapped with (.+)\] \*/,Jk=/,? & /,Qk=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,eA=/[()=,{}\[\]\/\s]/,tA=/\\(\\)?/g,nA=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,B=/\w*$/,W=/^[-+]0x[0-9a-f]+$/i,he=/^0b[01]+$/i,Me=/^\[object .+?Constructor\]$/,Ye=/^0o[0-7]+$/i,Ft=/^(?:0|[1-9]\d*)$/,kt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,cn=/($^)/,Jt=/['\n\r\u2028\u2029\\]/g,Zt="\\ud800-\\udfff",Zn="\\u0300-\\u036f",Gn="\\ufe20-\\ufe2f",kn="\\u20d0-\\u20ff",It=Zn+Gn+kn,Lt="\\u2700-\\u27bf",yo="a-z\\xdf-\\xf6\\xf8-\\xff",Qr="\\xac\\xb1\\xd7\\xf7",Eu="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ps="\\u2000-\\u206f",Yi=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",rp="A-Z\\xc0-\\xd6\\xd8-\\xde",qh="\\ufe0e\\ufe0f",ip=Qr+Eu+Ps+Yi,rA="['\u2019]",SJ="["+Zt+"]",jO="["+ip+"]",p1="["+It+"]",qO="\\d+",CJ="["+Lt+"]",XO="["+yo+"]",KO="[^"+Zt+ip+qO+Lt+yo+rp+"]",iA="\\ud83c[\\udffb-\\udfff]",TJ="(?:"+p1+"|"+iA+")",YO="[^"+Zt+"]",sA="(?:\\ud83c[\\udde6-\\uddff]){2}",oA="[\\ud800-\\udbff][\\udc00-\\udfff]",sp="["+rp+"]",ZO="\\u200d",JO="(?:"+XO+"|"+KO+")",EJ="(?:"+sp+"|"+KO+")",QO="(?:"+rA+"(?:d|ll|m|re|s|t|ve))?",eF="(?:"+rA+"(?:D|LL|M|RE|S|T|VE))?",tF=TJ+"?",nF="["+qh+"]?",kJ="(?:"+ZO+"(?:"+[YO,sA,oA].join("|")+")"+nF+tF+")*",AJ="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",MJ="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",rF=nF+tF+kJ,IJ="(?:"+[CJ,sA,oA].join("|")+")"+rF,NJ="(?:"+[YO+p1+"?",p1,sA,oA,SJ].join("|")+")",$J=RegExp(rA,"g"),RJ=RegExp(p1,"g"),aA=RegExp(iA+"(?="+iA+")|"+NJ+rF,"g"),DJ=RegExp([sp+"?"+XO+"+"+QO+"(?="+[jO,sp,"$"].join("|")+")",EJ+"+"+eF+"(?="+[jO,sp+JO,"$"].join("|")+")",sp+"?"+JO+"+"+QO,sp+"+"+eF,MJ,AJ,qO,IJ].join("|"),"g"),PJ=RegExp("["+ZO+Zt+It+qh+"]"),OJ=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,FJ=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],LJ=-1,Cr={};Cr[it]=Cr[ce]=Cr[qe]=Cr[bt]=Cr[Ot]=Cr[gt]=Cr[dn]=Cr[Kn]=Cr[ur]=!0,Cr[we]=Cr[me]=Cr[Ke]=Cr[Fe]=Cr[lt]=Cr[je]=Cr[Se]=Cr[nt]=Cr[pt]=Cr[Ht]=Cr[q]=Cr[Re]=Cr[Et]=Cr[st]=Cr[ot]=!1;var mr={};mr[we]=mr[me]=mr[Ke]=mr[lt]=mr[Fe]=mr[je]=mr[it]=mr[ce]=mr[qe]=mr[bt]=mr[Ot]=mr[pt]=mr[Ht]=mr[q]=mr[Re]=mr[Et]=mr[st]=mr[ee]=mr[gt]=mr[dn]=mr[Kn]=mr[ur]=!0,mr[Se]=mr[nt]=mr[ot]=!1;var BJ={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},zJ={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},VJ={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},UJ={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},WJ=parseFloat,GJ=parseInt,iF=typeof $t=="object"&&$t&&$t.Object===Object&&$t,HJ=typeof self=="object"&&self&&self.Object===Object&&self,Zi=iF||HJ||Function("return this")(),lA=e&&!e.nodeType&&e,Xh=lA&&!0&&t&&!t.nodeType&&t,sF=Xh&&Xh.exports===lA,cA=sF&&iF.process,Jo=function(){try{var ge=Xh&&Xh.require&&Xh.require("util").types;return ge||cA&&cA.binding&&cA.binding("util")}catch{}}(),oF=Jo&&Jo.isArrayBuffer,aF=Jo&&Jo.isDate,lF=Jo&&Jo.isMap,cF=Jo&&Jo.isRegExp,uF=Jo&&Jo.isSet,hF=Jo&&Jo.isTypedArray;function bo(ge,Ae,xe){switch(xe.length){case 0:return ge.call(Ae);case 1:return ge.call(Ae,xe[0]);case 2:return ge.call(Ae,xe[0],xe[1]);case 3:return ge.call(Ae,xe[0],xe[1],xe[2])}return ge.apply(Ae,xe)}function jJ(ge,Ae,xe,vt){for(var en=-1,Wn=ge==null?0:ge.length;++en<Wn;){var Ti=ge[en];Ae(vt,Ti,xe(Ti),ge)}return vt}function Qo(ge,Ae){for(var xe=-1,vt=ge==null?0:ge.length;++xe<vt&&Ae(ge[xe],xe,ge)!==!1;);return ge}function qJ(ge,Ae){for(var xe=ge==null?0:ge.length;xe--&&Ae(ge[xe],xe,ge)!==!1;);return ge}function fF(ge,Ae){for(var xe=-1,vt=ge==null?0:ge.length;++xe<vt;)if(!Ae(ge[xe],xe,ge))return!1;return!0}function ku(ge,Ae){for(var xe=-1,vt=ge==null?0:ge.length,en=0,Wn=[];++xe<vt;){var Ti=ge[xe];Ae(Ti,xe,ge)&&(Wn[en++]=Ti)}return Wn}function m1(ge,Ae){var xe=ge==null?0:ge.length;return!!xe&&op(ge,Ae,0)>-1}function uA(ge,Ae,xe){for(var vt=-1,en=ge==null?0:ge.length;++vt<en;)if(xe(Ae,ge[vt]))return!0;return!1}function Mr(ge,Ae){for(var xe=-1,vt=ge==null?0:ge.length,en=Array(vt);++xe<vt;)en[xe]=Ae(ge[xe],xe,ge);return en}function Au(ge,Ae){for(var xe=-1,vt=Ae.length,en=ge.length;++xe<vt;)ge[en+xe]=Ae[xe];return ge}function hA(ge,Ae,xe,vt){var en=-1,Wn=ge==null?0:ge.length;for(vt&&Wn&&(xe=ge[++en]);++en<Wn;)xe=Ae(xe,ge[en],en,ge);return xe}function XJ(ge,Ae,xe,vt){var en=ge==null?0:ge.length;for(vt&&en&&(xe=ge[--en]);en--;)xe=Ae(xe,ge[en],en,ge);return xe}function fA(ge,Ae){for(var xe=-1,vt=ge==null?0:ge.length;++xe<vt;)if(Ae(ge[xe],xe,ge))return!0;return!1}var KJ=dA("length");function YJ(ge){return ge.split("")}function ZJ(ge){return ge.match(Qk)||[]}function dF(ge,Ae,xe){var vt;return xe(ge,function(en,Wn,Ti){if(Ae(en,Wn,Ti))return vt=Wn,!1}),vt}function g1(ge,Ae,xe,vt){for(var en=ge.length,Wn=xe+(vt?1:-1);vt?Wn--:++Wn<en;)if(Ae(ge[Wn],Wn,ge))return Wn;return-1}function op(ge,Ae,xe){return Ae===Ae?cQ(ge,Ae,xe):g1(ge,pF,xe)}function JJ(ge,Ae,xe,vt){for(var en=xe-1,Wn=ge.length;++en<Wn;)if(vt(ge[en],Ae))return en;return-1}function pF(ge){return ge!==ge}function mF(ge,Ae){var xe=ge==null?0:ge.length;return xe?mA(ge,Ae)/xe:ae}function dA(ge){return function(Ae){return Ae==null?n:Ae[ge]}}function pA(ge){return function(Ae){return ge==null?n:ge[Ae]}}function gF(ge,Ae,xe,vt,en){return en(ge,function(Wn,Ti,hr){xe=vt?(vt=!1,Wn):Ae(xe,Wn,Ti,hr)}),xe}function QJ(ge,Ae){var xe=ge.length;for(ge.sort(Ae);xe--;)ge[xe]=ge[xe].value;return ge}function mA(ge,Ae){for(var xe,vt=-1,en=ge.length;++vt<en;){var Wn=Ae(ge[vt]);Wn!==n&&(xe=xe===n?Wn:xe+Wn)}return xe}function gA(ge,Ae){for(var xe=-1,vt=Array(ge);++xe<ge;)vt[xe]=Ae(xe);return vt}function eQ(ge,Ae){return Mr(Ae,function(xe){return[xe,ge[xe]]})}function vF(ge){return ge&&ge.slice(0,xF(ge)+1).replace(ay,"")}function wo(ge){return function(Ae){return ge(Ae)}}function vA(ge,Ae){return Mr(Ae,function(xe){return ge[xe]})}function ly(ge,Ae){return ge.has(Ae)}function yF(ge,Ae){for(var xe=-1,vt=ge.length;++xe<vt&&op(Ae,ge[xe],0)>-1;);return xe}function bF(ge,Ae){for(var xe=ge.length;xe--&&op(Ae,ge[xe],0)>-1;);return xe}function tQ(ge,Ae){for(var xe=ge.length,vt=0;xe--;)ge[xe]===Ae&&++vt;return vt}var nQ=pA(BJ),rQ=pA(zJ);function iQ(ge){return"\\"+UJ[ge]}function sQ(ge,Ae){return ge==null?n:ge[Ae]}function ap(ge){return PJ.test(ge)}function oQ(ge){return OJ.test(ge)}function aQ(ge){for(var Ae,xe=[];!(Ae=ge.next()).done;)xe.push(Ae.value);return xe}function yA(ge){var Ae=-1,xe=Array(ge.size);return ge.forEach(function(vt,en){xe[++Ae]=[en,vt]}),xe}function wF(ge,Ae){return function(xe){return ge(Ae(xe))}}function Mu(ge,Ae){for(var xe=-1,vt=ge.length,en=0,Wn=[];++xe<vt;){var Ti=ge[xe];(Ti===Ae||Ti===u)&&(ge[xe]=u,Wn[en++]=xe)}return Wn}function v1(ge){var Ae=-1,xe=Array(ge.size);return ge.forEach(function(vt){xe[++Ae]=vt}),xe}function lQ(ge){var Ae=-1,xe=Array(ge.size);return ge.forEach(function(vt){xe[++Ae]=[vt,vt]}),xe}function cQ(ge,Ae,xe){for(var vt=xe-1,en=ge.length;++vt<en;)if(ge[vt]===Ae)return vt;return-1}function uQ(ge,Ae,xe){for(var vt=xe+1;vt--;)if(ge[vt]===Ae)return vt;return vt}function lp(ge){return ap(ge)?fQ(ge):KJ(ge)}function Ua(ge){return ap(ge)?dQ(ge):YJ(ge)}function xF(ge){for(var Ae=ge.length;Ae--&&d1.test(ge.charAt(Ae)););return Ae}var hQ=pA(VJ);function fQ(ge){for(var Ae=aA.lastIndex=0;aA.test(ge);)++Ae;return Ae}function dQ(ge){return ge.match(aA)||[]}function pQ(ge){return ge.match(DJ)||[]}var mQ=function ge(Ae){Ae=Ae==null?Zi:cp.defaults(Zi.Object(),Ae,cp.pick(Zi,FJ));var xe=Ae.Array,vt=Ae.Date,en=Ae.Error,Wn=Ae.Function,Ti=Ae.Math,hr=Ae.Object,bA=Ae.RegExp,gQ=Ae.String,ea=Ae.TypeError,y1=xe.prototype,vQ=Wn.prototype,up=hr.prototype,b1=Ae["__core-js_shared__"],w1=vQ.toString,Jn=up.hasOwnProperty,yQ=0,_F=function(){var g=/[^.]+$/.exec(b1&&b1.keys&&b1.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),x1=up.toString,bQ=w1.call(hr),wQ=Zi._,xQ=bA("^"+w1.call(Jn).replace(oy,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_1=sF?Ae.Buffer:n,Iu=Ae.Symbol,S1=Ae.Uint8Array,SF=_1?_1.allocUnsafe:n,C1=wF(hr.getPrototypeOf,hr),CF=hr.create,TF=up.propertyIsEnumerable,T1=y1.splice,EF=Iu?Iu.isConcatSpreadable:n,cy=Iu?Iu.iterator:n,Kh=Iu?Iu.toStringTag:n,E1=function(){try{var g=ef(hr,"defineProperty");return g({},"",{}),g}catch{}}(),_Q=Ae.clearTimeout!==Zi.clearTimeout&&Ae.clearTimeout,SQ=vt&&vt.now!==Zi.Date.now&&vt.now,CQ=Ae.setTimeout!==Zi.setTimeout&&Ae.setTimeout,k1=Ti.ceil,A1=Ti.floor,wA=hr.getOwnPropertySymbols,TQ=_1?_1.isBuffer:n,kF=Ae.isFinite,EQ=y1.join,kQ=wF(hr.keys,hr),Ei=Ti.max,cs=Ti.min,AQ=vt.now,MQ=Ae.parseInt,AF=Ti.random,IQ=y1.reverse,xA=ef(Ae,"DataView"),uy=ef(Ae,"Map"),_A=ef(Ae,"Promise"),hp=ef(Ae,"Set"),hy=ef(Ae,"WeakMap"),fy=ef(hr,"create"),M1=hy&&new hy,fp={},NQ=tf(xA),$Q=tf(uy),RQ=tf(_A),DQ=tf(hp),PQ=tf(hy),I1=Iu?Iu.prototype:n,dy=I1?I1.valueOf:n,MF=I1?I1.toString:n;function V(g){if(Wr(g)&&!nn(g)&&!(g instanceof An)){if(g instanceof ta)return g;if(Jn.call(g,"__wrapped__"))return IL(g)}return new ta(g)}var dp=function(){function g(){}return function(b){if(!Lr(b))return{};if(CF)return CF(b);g.prototype=b;var C=new g;return g.prototype=n,C}}();function N1(){}function ta(g,b){this.__wrapped__=g,this.__actions__=[],this.__chain__=!!b,this.__index__=0,this.__values__=n}V.templateSettings={escape:qs,evaluate:np,interpolate:xc,variable:"",imports:{_:V}},V.prototype=N1.prototype,V.prototype.constructor=V,ta.prototype=dp(N1.prototype),ta.prototype.constructor=ta;function An(g){this.__wrapped__=g,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=pe,this.__views__=[]}function OQ(){var g=new An(this.__wrapped__);return g.__actions__=Xs(this.__actions__),g.__dir__=this.__dir__,g.__filtered__=this.__filtered__,g.__iteratees__=Xs(this.__iteratees__),g.__takeCount__=this.__takeCount__,g.__views__=Xs(this.__views__),g}function FQ(){if(this.__filtered__){var g=new An(this);g.__dir__=-1,g.__filtered__=!0}else g=this.clone(),g.__dir__*=-1;return g}function LQ(){var g=this.__wrapped__.value(),b=this.__dir__,C=nn(g),I=b<0,L=C?g.length:0,G=Yee(0,L,this.__views__),Z=G.start,le=G.end,ye=le-Z,De=I?le:Z-1,Pe=this.__iteratees__,ze=Pe.length,at=0,At=cs(ye,this.__takeCount__);if(!C||!I&&L==ye&&At==ye)return QF(g,this.__actions__);var Ut=[];e:for(;ye--&&at<At;){De+=b;for(var pn=-1,Wt=g[De];++pn<ze;){var Sn=Pe[pn],$n=Sn.iteratee,So=Sn.type,Ls=$n(Wt);if(So==F)Wt=Ls;else if(!Ls){if(So==R)continue e;break e}}Ut[at++]=Wt}return Ut}An.prototype=dp(N1.prototype),An.prototype.constructor=An;function Yh(g){var b=-1,C=g==null?0:g.length;for(this.clear();++b<C;){var I=g[b];this.set(I[0],I[1])}}function BQ(){this.__data__=fy?fy(null):{},this.size=0}function zQ(g){var b=this.has(g)&&delete this.__data__[g];return this.size-=b?1:0,b}function VQ(g){var b=this.__data__;if(fy){var C=b[g];return C===l?n:C}return Jn.call(b,g)?b[g]:n}function UQ(g){var b=this.__data__;return fy?b[g]!==n:Jn.call(b,g)}function WQ(g,b){var C=this.__data__;return this.size+=this.has(g)?0:1,C[g]=fy&&b===n?l:b,this}Yh.prototype.clear=BQ,Yh.prototype.delete=zQ,Yh.prototype.get=VQ,Yh.prototype.has=UQ,Yh.prototype.set=WQ;function _c(g){var b=-1,C=g==null?0:g.length;for(this.clear();++b<C;){var I=g[b];this.set(I[0],I[1])}}function GQ(){this.__data__=[],this.size=0}function HQ(g){var b=this.__data__,C=$1(b,g);if(C<0)return!1;var I=b.length-1;return C==I?b.pop():T1.call(b,C,1),--this.size,!0}function jQ(g){var b=this.__data__,C=$1(b,g);return C<0?n:b[C][1]}function qQ(g){return $1(this.__data__,g)>-1}function XQ(g,b){var C=this.__data__,I=$1(C,g);return I<0?(++this.size,C.push([g,b])):C[I][1]=b,this}_c.prototype.clear=GQ,_c.prototype.delete=HQ,_c.prototype.get=jQ,_c.prototype.has=qQ,_c.prototype.set=XQ;function Sc(g){var b=-1,C=g==null?0:g.length;for(this.clear();++b<C;){var I=g[b];this.set(I[0],I[1])}}function KQ(){this.size=0,this.__data__={hash:new Yh,map:new(uy||_c),string:new Yh}}function YQ(g){var b=G1(this,g).delete(g);return this.size-=b?1:0,b}function ZQ(g){return G1(this,g).get(g)}function JQ(g){return G1(this,g).has(g)}function QQ(g,b){var C=G1(this,g),I=C.size;return C.set(g,b),this.size+=C.size==I?0:1,this}Sc.prototype.clear=KQ,Sc.prototype.delete=YQ,Sc.prototype.get=ZQ,Sc.prototype.has=JQ,Sc.prototype.set=QQ;function Zh(g){var b=-1,C=g==null?0:g.length;for(this.__data__=new Sc;++b<C;)this.add(g[b])}function eee(g){return this.__data__.set(g,l),this}function tee(g){return this.__data__.has(g)}Zh.prototype.add=Zh.prototype.push=eee,Zh.prototype.has=tee;function Wa(g){var b=this.__data__=new _c(g);this.size=b.size}function nee(){this.__data__=new _c,this.size=0}function ree(g){var b=this.__data__,C=b.delete(g);return this.size=b.size,C}function iee(g){return this.__data__.get(g)}function see(g){return this.__data__.has(g)}function oee(g,b){var C=this.__data__;if(C instanceof _c){var I=C.__data__;if(!uy||I.length<i-1)return I.push([g,b]),this.size=++C.size,this;C=this.__data__=new Sc(I)}return C.set(g,b),this.size=C.size,this}Wa.prototype.clear=nee,Wa.prototype.delete=ree,Wa.prototype.get=iee,Wa.prototype.has=see,Wa.prototype.set=oee;function IF(g,b){var C=nn(g),I=!C&&nf(g),L=!C&&!I&&Pu(g),G=!C&&!I&&!L&&vp(g),Z=C||I||L||G,le=Z?gA(g.length,gQ):[],ye=le.length;for(var De in g)(b||Jn.call(g,De))&&!(Z&&(De=="length"||L&&(De=="offset"||De=="parent")||G&&(De=="buffer"||De=="byteLength"||De=="byteOffset")||kc(De,ye)))&&le.push(De);return le}function NF(g){var b=g.length;return b?g[RA(0,b-1)]:n}function aee(g,b){return H1(Xs(g),Jh(b,0,g.length))}function lee(g){return H1(Xs(g))}function SA(g,b,C){(C!==n&&!Ga(g[b],C)||C===n&&!(b in g))&&Cc(g,b,C)}function py(g,b,C){var I=g[b];(!(Jn.call(g,b)&&Ga(I,C))||C===n&&!(b in g))&&Cc(g,b,C)}function $1(g,b){for(var C=g.length;C--;)if(Ga(g[C][0],b))return C;return-1}function cee(g,b,C,I){return Nu(g,function(L,G,Z){b(I,L,C(L),Z)}),I}function $F(g,b){return g&&Dl(b,Bi(b),g)}function uee(g,b){return g&&Dl(b,Ys(b),g)}function Cc(g,b,C){b=="__proto__"&&E1?E1(g,b,{configurable:!0,enumerable:!0,value:C,writable:!0}):g[b]=C}function CA(g,b){for(var C=-1,I=b.length,L=xe(I),G=g==null;++C<I;)L[C]=G?n:iM(g,b[C]);return L}function Jh(g,b,C){return g===g&&(C!==n&&(g=g<=C?g:C),b!==n&&(g=g>=b?g:b)),g}function na(g,b,C,I,L,G){var Z,le=b&h,ye=b&f,De=b&d;if(C&&(Z=L?C(g,I,L,G):C(g)),Z!==n)return Z;if(!Lr(g))return g;var Pe=nn(g);if(Pe){if(Z=Jee(g),!le)return Xs(g,Z)}else{var ze=us(g),at=ze==nt||ze==Ct;if(Pu(g))return nL(g,le);if(ze==q||ze==we||at&&!L){if(Z=ye||at?{}:xL(g),!le)return ye?Vee(g,uee(Z,g)):zee(g,$F(Z,g))}else{if(!mr[ze])return L?g:{};Z=Qee(g,ze,le)}}G||(G=new Wa);var At=G.get(g);if(At)return At;G.set(g,Z),YL(g)?g.forEach(function(Wt){Z.add(na(Wt,b,C,Wt,g,G))}):XL(g)&&g.forEach(function(Wt,Sn){Z.set(Sn,na(Wt,b,C,Sn,g,G))});var Ut=De?ye?GA:WA:ye?Ys:Bi,pn=Pe?n:Ut(g);return Qo(pn||g,function(Wt,Sn){pn&&(Sn=Wt,Wt=g[Sn]),py(Z,Sn,na(Wt,b,C,Sn,g,G))}),Z}function hee(g){var b=Bi(g);return function(C){return RF(C,g,b)}}function RF(g,b,C){var I=C.length;if(g==null)return!I;for(g=hr(g);I--;){var L=C[I],G=b[L],Z=g[L];if(Z===n&&!(L in g)||!G(Z))return!1}return!0}function DF(g,b,C){if(typeof g!="function")throw new ea(o);return xy(function(){g.apply(n,C)},b)}function my(g,b,C,I){var L=-1,G=m1,Z=!0,le=g.length,ye=[],De=b.length;if(!le)return ye;C&&(b=Mr(b,wo(C))),I?(G=uA,Z=!1):b.length>=i&&(G=ly,Z=!1,b=new Zh(b));e:for(;++L<le;){var Pe=g[L],ze=C==null?Pe:C(Pe);if(Pe=I||Pe!==0?Pe:0,Z&&ze===ze){for(var at=De;at--;)if(b[at]===ze)continue e;ye.push(Pe)}else G(b,ze,I)||ye.push(Pe)}return ye}var Nu=aL(Rl),PF=aL(EA,!0);function fee(g,b){var C=!0;return Nu(g,function(I,L,G){return C=!!b(I,L,G),C}),C}function R1(g,b,C){for(var I=-1,L=g.length;++I<L;){var G=g[I],Z=b(G);if(Z!=null&&(le===n?Z===Z&&!_o(Z):C(Z,le)))var le=Z,ye=G}return ye}function dee(g,b,C,I){var L=g.length;for(C=un(C),C<0&&(C=-C>L?0:L+C),I=I===n||I>L?L:un(I),I<0&&(I+=L),I=C>I?0:JL(I);C<I;)g[C++]=b;return g}function OF(g,b){var C=[];return Nu(g,function(I,L,G){b(I,L,G)&&C.push(I)}),C}function Ji(g,b,C,I,L){var G=-1,Z=g.length;for(C||(C=tte),L||(L=[]);++G<Z;){var le=g[G];b>0&&C(le)?b>1?Ji(le,b-1,C,I,L):Au(L,le):I||(L[L.length]=le)}return L}var TA=lL(),FF=lL(!0);function Rl(g,b){return g&&TA(g,b,Bi)}function EA(g,b){return g&&FF(g,b,Bi)}function D1(g,b){return ku(b,function(C){return Ac(g[C])})}function Qh(g,b){b=Ru(b,g);for(var C=0,I=b.length;g!=null&&C<I;)g=g[Pl(b[C++])];return C&&C==I?g:n}function LF(g,b,C){var I=b(g);return nn(g)?I:Au(I,C(g))}function Os(g){return g==null?g===n?We:Mt:Kh&&Kh in hr(g)?Kee(g):lte(g)}function kA(g,b){return g>b}function pee(g,b){return g!=null&&Jn.call(g,b)}function mee(g,b){return g!=null&&b in hr(g)}function gee(g,b,C){return g>=cs(b,C)&&g<Ei(b,C)}function AA(g,b,C){for(var I=C?uA:m1,L=g[0].length,G=g.length,Z=G,le=xe(G),ye=1/0,De=[];Z--;){var Pe=g[Z];Z&&b&&(Pe=Mr(Pe,wo(b))),ye=cs(Pe.length,ye),le[Z]=!C&&(b||L>=120&&Pe.length>=120)?new Zh(Z&&Pe):n}Pe=g[0];var ze=-1,at=le[0];e:for(;++ze<L&&De.length<ye;){var At=Pe[ze],Ut=b?b(At):At;if(At=C||At!==0?At:0,!(at?ly(at,Ut):I(De,Ut,C))){for(Z=G;--Z;){var pn=le[Z];if(!(pn?ly(pn,Ut):I(g[Z],Ut,C)))continue e}at&&at.push(Ut),De.push(At)}}return De}function vee(g,b,C,I){return Rl(g,function(L,G,Z){b(I,C(L),G,Z)}),I}function gy(g,b,C){b=Ru(b,g),g=TL(g,b);var I=g==null?g:g[Pl(ia(b))];return I==null?n:bo(I,g,C)}function BF(g){return Wr(g)&&Os(g)==we}function yee(g){return Wr(g)&&Os(g)==Ke}function bee(g){return Wr(g)&&Os(g)==je}function vy(g,b,C,I,L){return g===b?!0:g==null||b==null||!Wr(g)&&!Wr(b)?g!==g&&b!==b:wee(g,b,C,I,vy,L)}function wee(g,b,C,I,L,G){var Z=nn(g),le=nn(b),ye=Z?me:us(g),De=le?me:us(b);ye=ye==we?q:ye,De=De==we?q:De;var Pe=ye==q,ze=De==q,at=ye==De;if(at&&Pu(g)){if(!Pu(b))return!1;Z=!0,Pe=!1}if(at&&!Pe)return G||(G=new Wa),Z||vp(g)?yL(g,b,C,I,L,G):qee(g,b,ye,C,I,L,G);if(!(C&p)){var At=Pe&&Jn.call(g,"__wrapped__"),Ut=ze&&Jn.call(b,"__wrapped__");if(At||Ut){var pn=At?g.value():g,Wt=Ut?b.value():b;return G||(G=new Wa),L(pn,Wt,C,I,G)}}return at?(G||(G=new Wa),Xee(g,b,C,I,L,G)):!1}function xee(g){return Wr(g)&&us(g)==pt}function MA(g,b,C,I){var L=C.length,G=L,Z=!I;if(g==null)return!G;for(g=hr(g);L--;){var le=C[L];if(Z&&le[2]?le[1]!==g[le[0]]:!(le[0]in g))return!1}for(;++L<G;){le=C[L];var ye=le[0],De=g[ye],Pe=le[1];if(Z&&le[2]){if(De===n&&!(ye in g))return!1}else{var ze=new Wa;if(I)var at=I(De,Pe,ye,g,b,ze);if(!(at===n?vy(Pe,De,p|m,I,ze):at))return!1}}return!0}function zF(g){if(!Lr(g)||rte(g))return!1;var b=Ac(g)?xQ:Me;return b.test(tf(g))}function _ee(g){return Wr(g)&&Os(g)==Re}function See(g){return Wr(g)&&us(g)==Et}function Cee(g){return Wr(g)&&Z1(g.length)&&!!Cr[Os(g)]}function VF(g){return typeof g=="function"?g:g==null?Zs:typeof g=="object"?nn(g)?GF(g[0],g[1]):WF(g):cB(g)}function IA(g){if(!wy(g))return kQ(g);var b=[];for(var C in hr(g))Jn.call(g,C)&&C!="constructor"&&b.push(C);return b}function Tee(g){if(!Lr(g))return ate(g);var b=wy(g),C=[];for(var I in g)I=="constructor"&&(b||!Jn.call(g,I))||C.push(I);return C}function NA(g,b){return g<b}function UF(g,b){var C=-1,I=Ks(g)?xe(g.length):[];return Nu(g,function(L,G,Z){I[++C]=b(L,G,Z)}),I}function WF(g){var b=jA(g);return b.length==1&&b[0][2]?SL(b[0][0],b[0][1]):function(C){return C===g||MA(C,g,b)}}function GF(g,b){return XA(g)&&_L(b)?SL(Pl(g),b):function(C){var I=iM(C,g);return I===n&&I===b?sM(C,g):vy(b,I,p|m)}}function P1(g,b,C,I,L){g!==b&&TA(b,function(G,Z){if(L||(L=new Wa),Lr(G))Eee(g,b,Z,C,P1,I,L);else{var le=I?I(YA(g,Z),G,Z+"",g,b,L):n;le===n&&(le=G),SA(g,Z,le)}},Ys)}function Eee(g,b,C,I,L,G,Z){var le=YA(g,C),ye=YA(b,C),De=Z.get(ye);if(De){SA(g,C,De);return}var Pe=G?G(le,ye,C+"",g,b,Z):n,ze=Pe===n;if(ze){var at=nn(ye),At=!at&&Pu(ye),Ut=!at&&!At&&vp(ye);Pe=ye,at||At||Ut?nn(le)?Pe=le:ei(le)?Pe=Xs(le):At?(ze=!1,Pe=nL(ye,!0)):Ut?(ze=!1,Pe=rL(ye,!0)):Pe=[]:_y(ye)||nf(ye)?(Pe=le,nf(le)?Pe=QL(le):(!Lr(le)||Ac(le))&&(Pe=xL(ye))):ze=!1}ze&&(Z.set(ye,Pe),L(Pe,ye,I,G,Z),Z.delete(ye)),SA(g,C,Pe)}function HF(g,b){var C=g.length;if(!!C)return b+=b<0?C:0,kc(b,C)?g[b]:n}function jF(g,b,C){b.length?b=Mr(b,function(G){return nn(G)?function(Z){return Qh(Z,G.length===1?G[0]:G)}:G}):b=[Zs];var I=-1;b=Mr(b,wo(Vt()));var L=UF(g,function(G,Z,le){var ye=Mr(b,function(De){return De(G)});return{criteria:ye,index:++I,value:G}});return QJ(L,function(G,Z){return Bee(G,Z,C)})}function kee(g,b){return qF(g,b,function(C,I){return sM(g,I)})}function qF(g,b,C){for(var I=-1,L=b.length,G={};++I<L;){var Z=b[I],le=Qh(g,Z);C(le,Z)&&yy(G,Ru(Z,g),le)}return G}function Aee(g){return function(b){return Qh(b,g)}}function $A(g,b,C,I){var L=I?JJ:op,G=-1,Z=b.length,le=g;for(g===b&&(b=Xs(b)),C&&(le=Mr(g,wo(C)));++G<Z;)for(var ye=0,De=b[G],Pe=C?C(De):De;(ye=L(le,Pe,ye,I))>-1;)le!==g&&T1.call(le,ye,1),T1.call(g,ye,1);return g}function XF(g,b){for(var C=g?b.length:0,I=C-1;C--;){var L=b[C];if(C==I||L!==G){var G=L;kc(L)?T1.call(g,L,1):OA(g,L)}}return g}function RA(g,b){return g+A1(AF()*(b-g+1))}function Mee(g,b,C,I){for(var L=-1,G=Ei(k1((b-g)/(C||1)),0),Z=xe(G);G--;)Z[I?G:++L]=g,g+=C;return Z}function DA(g,b){var C="";if(!g||b<1||b>J)return C;do b%2&&(C+=g),b=A1(b/2),b&&(g+=g);while(b);return C}function bn(g,b){return ZA(CL(g,b,Zs),g+"")}function Iee(g){return NF(yp(g))}function Nee(g,b){var C=yp(g);return H1(C,Jh(b,0,C.length))}function yy(g,b,C,I){if(!Lr(g))return g;b=Ru(b,g);for(var L=-1,G=b.length,Z=G-1,le=g;le!=null&&++L<G;){var ye=Pl(b[L]),De=C;if(ye==="__proto__"||ye==="constructor"||ye==="prototype")return g;if(L!=Z){var Pe=le[ye];De=I?I(Pe,ye,le):n,De===n&&(De=Lr(Pe)?Pe:kc(b[L+1])?[]:{})}py(le,ye,De),le=le[ye]}return g}var KF=M1?function(g,b){return M1.set(g,b),g}:Zs,$ee=E1?function(g,b){return E1(g,"toString",{configurable:!0,enumerable:!1,value:aM(b),writable:!0})}:Zs;function Ree(g){return H1(yp(g))}function ra(g,b,C){var I=-1,L=g.length;b<0&&(b=-b>L?0:L+b),C=C>L?L:C,C<0&&(C+=L),L=b>C?0:C-b>>>0,b>>>=0;for(var G=xe(L);++I<L;)G[I]=g[I+b];return G}function Dee(g,b){var C;return Nu(g,function(I,L,G){return C=b(I,L,G),!C}),!!C}function O1(g,b,C){var I=0,L=g==null?I:g.length;if(typeof b=="number"&&b===b&&L<=Te){for(;I<L;){var G=I+L>>>1,Z=g[G];Z!==null&&!_o(Z)&&(C?Z<=b:Z<b)?I=G+1:L=G}return L}return PA(g,b,Zs,C)}function PA(g,b,C,I){var L=0,G=g==null?0:g.length;if(G===0)return 0;b=C(b);for(var Z=b!==b,le=b===null,ye=_o(b),De=b===n;L<G;){var Pe=A1((L+G)/2),ze=C(g[Pe]),at=ze!==n,At=ze===null,Ut=ze===ze,pn=_o(ze);if(Z)var Wt=I||Ut;else De?Wt=Ut&&(I||at):le?Wt=Ut&&at&&(I||!At):ye?Wt=Ut&&at&&!At&&(I||!pn):At||pn?Wt=!1:Wt=I?ze<=b:ze<b;Wt?L=Pe+1:G=Pe}return cs(G,ke)}function YF(g,b){for(var C=-1,I=g.length,L=0,G=[];++C<I;){var Z=g[C],le=b?b(Z):Z;if(!C||!Ga(le,ye)){var ye=le;G[L++]=Z===0?0:Z}}return G}function ZF(g){return typeof g=="number"?g:_o(g)?ae:+g}function xo(g){if(typeof g=="string")return g;if(nn(g))return Mr(g,xo)+"";if(_o(g))return MF?MF.call(g):"";var b=g+"";return b=="0"&&1/g==-K?"-0":b}function $u(g,b,C){var I=-1,L=m1,G=g.length,Z=!0,le=[],ye=le;if(C)Z=!1,L=uA;else if(G>=i){var De=b?null:Hee(g);if(De)return v1(De);Z=!1,L=ly,ye=new Zh}else ye=b?[]:le;e:for(;++I<G;){var Pe=g[I],ze=b?b(Pe):Pe;if(Pe=C||Pe!==0?Pe:0,Z&&ze===ze){for(var at=ye.length;at--;)if(ye[at]===ze)continue e;b&&ye.push(ze),le.push(Pe)}else L(ye,ze,C)||(ye!==le&&ye.push(ze),le.push(Pe))}return le}function OA(g,b){return b=Ru(b,g),g=TL(g,b),g==null||delete g[Pl(ia(b))]}function JF(g,b,C,I){return yy(g,b,C(Qh(g,b)),I)}function F1(g,b,C,I){for(var L=g.length,G=I?L:-1;(I?G--:++G<L)&&b(g[G],G,g););return C?ra(g,I?0:G,I?G+1:L):ra(g,I?G+1:0,I?L:G)}function QF(g,b){var C=g;return C instanceof An&&(C=C.value()),hA(b,function(I,L){return L.func.apply(L.thisArg,Au([I],L.args))},C)}function FA(g,b,C){var I=g.length;if(I<2)return I?$u(g[0]):[];for(var L=-1,G=xe(I);++L<I;)for(var Z=g[L],le=-1;++le<I;)le!=L&&(G[L]=my(G[L]||Z,g[le],b,C));return $u(Ji(G,1),b,C)}function eL(g,b,C){for(var I=-1,L=g.length,G=b.length,Z={};++I<L;){var le=I<G?b[I]:n;C(Z,g[I],le)}return Z}function LA(g){return ei(g)?g:[]}function BA(g){return typeof g=="function"?g:Zs}function Ru(g,b){return nn(g)?g:XA(g,b)?[g]:ML(Hn(g))}var Pee=bn;function Du(g,b,C){var I=g.length;return C=C===n?I:C,!b&&C>=I?g:ra(g,b,C)}var tL=_Q||function(g){return Zi.clearTimeout(g)};function nL(g,b){if(b)return g.slice();var C=g.length,I=SF?SF(C):new g.constructor(C);return g.copy(I),I}function zA(g){var b=new g.constructor(g.byteLength);return new S1(b).set(new S1(g)),b}function Oee(g,b){var C=b?zA(g.buffer):g.buffer;return new g.constructor(C,g.byteOffset,g.byteLength)}function Fee(g){var b=new g.constructor(g.source,B.exec(g));return b.lastIndex=g.lastIndex,b}function Lee(g){return dy?hr(dy.call(g)):{}}function rL(g,b){var C=b?zA(g.buffer):g.buffer;return new g.constructor(C,g.byteOffset,g.length)}function iL(g,b){if(g!==b){var C=g!==n,I=g===null,L=g===g,G=_o(g),Z=b!==n,le=b===null,ye=b===b,De=_o(b);if(!le&&!De&&!G&&g>b||G&&Z&&ye&&!le&&!De||I&&Z&&ye||!C&&ye||!L)return 1;if(!I&&!G&&!De&&g<b||De&&C&&L&&!I&&!G||le&&C&&L||!Z&&L||!ye)return-1}return 0}function Bee(g,b,C){for(var I=-1,L=g.criteria,G=b.criteria,Z=L.length,le=C.length;++I<Z;){var ye=iL(L[I],G[I]);if(ye){if(I>=le)return ye;var De=C[I];return ye*(De=="desc"?-1:1)}}return g.index-b.index}function sL(g,b,C,I){for(var L=-1,G=g.length,Z=C.length,le=-1,ye=b.length,De=Ei(G-Z,0),Pe=xe(ye+De),ze=!I;++le<ye;)Pe[le]=b[le];for(;++L<Z;)(ze||L<G)&&(Pe[C[L]]=g[L]);for(;De--;)Pe[le++]=g[L++];return Pe}function oL(g,b,C,I){for(var L=-1,G=g.length,Z=-1,le=C.length,ye=-1,De=b.length,Pe=Ei(G-le,0),ze=xe(Pe+De),at=!I;++L<Pe;)ze[L]=g[L];for(var At=L;++ye<De;)ze[At+ye]=b[ye];for(;++Z<le;)(at||L<G)&&(ze[At+C[Z]]=g[L++]);return ze}function Xs(g,b){var C=-1,I=g.length;for(b||(b=xe(I));++C<I;)b[C]=g[C];return b}function Dl(g,b,C,I){var L=!C;C||(C={});for(var G=-1,Z=b.length;++G<Z;){var le=b[G],ye=I?I(C[le],g[le],le,C,g):n;ye===n&&(ye=g[le]),L?Cc(C,le,ye):py(C,le,ye)}return C}function zee(g,b){return Dl(g,qA(g),b)}function Vee(g,b){return Dl(g,bL(g),b)}function L1(g,b){return function(C,I){var L=nn(C)?jJ:cee,G=b?b():{};return L(C,g,Vt(I,2),G)}}function pp(g){return bn(function(b,C){var I=-1,L=C.length,G=L>1?C[L-1]:n,Z=L>2?C[2]:n;for(G=g.length>3&&typeof G=="function"?(L--,G):n,Z&&Fs(C[0],C[1],Z)&&(G=L<3?n:G,L=1),b=hr(b);++I<L;){var le=C[I];le&&g(b,le,I,G)}return b})}function aL(g,b){return function(C,I){if(C==null)return C;if(!Ks(C))return g(C,I);for(var L=C.length,G=b?L:-1,Z=hr(C);(b?G--:++G<L)&&I(Z[G],G,Z)!==!1;);return C}}function lL(g){return function(b,C,I){for(var L=-1,G=hr(b),Z=I(b),le=Z.length;le--;){var ye=Z[g?le:++L];if(C(G[ye],ye,G)===!1)break}return b}}function Uee(g,b,C){var I=b&v,L=by(g);function G(){var Z=this&&this!==Zi&&this instanceof G?L:g;return Z.apply(I?C:this,arguments)}return G}function cL(g){return function(b){b=Hn(b);var C=ap(b)?Ua(b):n,I=C?C[0]:b.charAt(0),L=C?Du(C,1).join(""):b.slice(1);return I[g]()+L}}function mp(g){return function(b){return hA(aB(oB(b).replace($J,"")),g,"")}}function by(g){return function(){var b=arguments;switch(b.length){case 0:return new g;case 1:return new g(b[0]);case 2:return new g(b[0],b[1]);case 3:return new g(b[0],b[1],b[2]);case 4:return new g(b[0],b[1],b[2],b[3]);case 5:return new g(b[0],b[1],b[2],b[3],b[4]);case 6:return new g(b[0],b[1],b[2],b[3],b[4],b[5]);case 7:return new g(b[0],b[1],b[2],b[3],b[4],b[5],b[6])}var C=dp(g.prototype),I=g.apply(C,b);return Lr(I)?I:C}}function Wee(g,b,C){var I=by(g);function L(){for(var G=arguments.length,Z=xe(G),le=G,ye=gp(L);le--;)Z[le]=arguments[le];var De=G<3&&Z[0]!==ye&&Z[G-1]!==ye?[]:Mu(Z,ye);if(G-=De.length,G<C)return pL(g,b,B1,L.placeholder,n,Z,De,n,n,C-G);var Pe=this&&this!==Zi&&this instanceof L?I:g;return bo(Pe,this,Z)}return L}function uL(g){return function(b,C,I){var L=hr(b);if(!Ks(b)){var G=Vt(C,3);b=Bi(b),C=function(le){return G(L[le],le,L)}}var Z=g(b,C,I);return Z>-1?L[G?b[Z]:Z]:n}}function hL(g){return Ec(function(b){var C=b.length,I=C,L=ta.prototype.thru;for(g&&b.reverse();I--;){var G=b[I];if(typeof G!="function")throw new ea(o);if(L&&!Z&&W1(G)=="wrapper")var Z=new ta([],!0)}for(I=Z?I:C;++I<C;){G=b[I];var le=W1(G),ye=le=="wrapper"?HA(G):n;ye&&KA(ye[0])&&ye[1]==(E|x|S|k)&&!ye[4].length&&ye[9]==1?Z=Z[W1(ye[0])].apply(Z,ye[3]):Z=G.length==1&&KA(G)?Z[le]():Z.thru(G)}return function(){var De=arguments,Pe=De[0];if(Z&&De.length==1&&nn(Pe))return Z.plant(Pe).value();for(var ze=0,at=C?b[ze].apply(this,De):Pe;++ze<C;)at=b[ze].call(this,at);return at}})}function B1(g,b,C,I,L,G,Z,le,ye,De){var Pe=b&E,ze=b&v,at=b&y,At=b&(x|_),Ut=b&A,pn=at?n:by(g);function Wt(){for(var Sn=arguments.length,$n=xe(Sn),So=Sn;So--;)$n[So]=arguments[So];if(At)var Ls=gp(Wt),Co=tQ($n,Ls);if(I&&($n=sL($n,I,L,At)),G&&($n=oL($n,G,Z,At)),Sn-=Co,At&&Sn<De){var ti=Mu($n,Ls);return pL(g,b,B1,Wt.placeholder,C,$n,ti,le,ye,De-Sn)}var Ha=ze?C:this,Ic=at?Ha[g]:g;return Sn=$n.length,le?$n=cte($n,le):Ut&&Sn>1&&$n.reverse(),Pe&&ye<Sn&&($n.length=ye),this&&this!==Zi&&this instanceof Wt&&(Ic=pn||by(Ic)),Ic.apply(Ha,$n)}return Wt}function fL(g,b){return function(C,I){return vee(C,g,b(I),{})}}function z1(g,b){return function(C,I){var L;if(C===n&&I===n)return b;if(C!==n&&(L=C),I!==n){if(L===n)return I;typeof C=="string"||typeof I=="string"?(C=xo(C),I=xo(I)):(C=ZF(C),I=ZF(I)),L=g(C,I)}return L}}function VA(g){return Ec(function(b){return b=Mr(b,wo(Vt())),bn(function(C){var I=this;return g(b,function(L){return bo(L,I,C)})})})}function V1(g,b){b=b===n?" ":xo(b);var C=b.length;if(C<2)return C?DA(b,g):b;var I=DA(b,k1(g/lp(b)));return ap(b)?Du(Ua(I),0,g).join(""):I.slice(0,g)}function Gee(g,b,C,I){var L=b&v,G=by(g);function Z(){for(var le=-1,ye=arguments.length,De=-1,Pe=I.length,ze=xe(Pe+ye),at=this&&this!==Zi&&this instanceof Z?G:g;++De<Pe;)ze[De]=I[De];for(;ye--;)ze[De++]=arguments[++le];return bo(at,L?C:this,ze)}return Z}function dL(g){return function(b,C,I){return I&&typeof I!="number"&&Fs(b,C,I)&&(C=I=n),b=Mc(b),C===n?(C=b,b=0):C=Mc(C),I=I===n?b<C?1:-1:Mc(I),Mee(b,C,I,g)}}function U1(g){return function(b,C){return typeof b=="string"&&typeof C=="string"||(b=sa(b),C=sa(C)),g(b,C)}}function pL(g,b,C,I,L,G,Z,le,ye,De){var Pe=b&x,ze=Pe?Z:n,at=Pe?n:Z,At=Pe?G:n,Ut=Pe?n:G;b|=Pe?S:T,b&=~(Pe?T:S),b&w||(b&=~(v|y));var pn=[g,b,L,At,ze,Ut,at,le,ye,De],Wt=C.apply(n,pn);return KA(g)&&EL(Wt,pn),Wt.placeholder=I,kL(Wt,g,b)}function UA(g){var b=Ti[g];return function(C,I){if(C=sa(C),I=I==null?0:cs(un(I),292),I&&kF(C)){var L=(Hn(C)+"e").split("e"),G=b(L[0]+"e"+(+L[1]+I));return L=(Hn(G)+"e").split("e"),+(L[0]+"e"+(+L[1]-I))}return b(C)}}var Hee=hp&&1/v1(new hp([,-0]))[1]==K?function(g){return new hp(g)}:uM;function mL(g){return function(b){var C=us(b);return C==pt?yA(b):C==Et?lQ(b):eQ(b,g(b))}}function Tc(g,b,C,I,L,G,Z,le){var ye=b&y;if(!ye&&typeof g!="function")throw new ea(o);var De=I?I.length:0;if(De||(b&=~(S|T),I=L=n),Z=Z===n?Z:Ei(un(Z),0),le=le===n?le:un(le),De-=L?L.length:0,b&T){var Pe=I,ze=L;I=L=n}var at=ye?n:HA(g),At=[g,b,C,I,L,Pe,ze,G,Z,le];if(at&&ote(At,at),g=At[0],b=At[1],C=At[2],I=At[3],L=At[4],le=At[9]=At[9]===n?ye?0:g.length:Ei(At[9]-De,0),!le&&b&(x|_)&&(b&=~(x|_)),!b||b==v)var Ut=Uee(g,b,C);else b==x||b==_?Ut=Wee(g,b,le):(b==S||b==(v|S))&&!L.length?Ut=Gee(g,b,C,I):Ut=B1.apply(n,At);var pn=at?KF:EL;return kL(pn(Ut,At),g,b)}function gL(g,b,C,I){return g===n||Ga(g,up[C])&&!Jn.call(I,C)?b:g}function vL(g,b,C,I,L,G){return Lr(g)&&Lr(b)&&(G.set(b,g),P1(g,b,n,vL,G),G.delete(b)),g}function jee(g){return _y(g)?n:g}function yL(g,b,C,I,L,G){var Z=C&p,le=g.length,ye=b.length;if(le!=ye&&!(Z&&ye>le))return!1;var De=G.get(g),Pe=G.get(b);if(De&&Pe)return De==b&&Pe==g;var ze=-1,at=!0,At=C&m?new Zh:n;for(G.set(g,b),G.set(b,g);++ze<le;){var Ut=g[ze],pn=b[ze];if(I)var Wt=Z?I(pn,Ut,ze,b,g,G):I(Ut,pn,ze,g,b,G);if(Wt!==n){if(Wt)continue;at=!1;break}if(At){if(!fA(b,function(Sn,$n){if(!ly(At,$n)&&(Ut===Sn||L(Ut,Sn,C,I,G)))return At.push($n)})){at=!1;break}}else if(!(Ut===pn||L(Ut,pn,C,I,G))){at=!1;break}}return G.delete(g),G.delete(b),at}function qee(g,b,C,I,L,G,Z){switch(C){case lt:if(g.byteLength!=b.byteLength||g.byteOffset!=b.byteOffset)return!1;g=g.buffer,b=b.buffer;case Ke:return!(g.byteLength!=b.byteLength||!G(new S1(g),new S1(b)));case Fe:case je:case Ht:return Ga(+g,+b);case Se:return g.name==b.name&&g.message==b.message;case Re:case st:return g==b+"";case pt:var le=yA;case Et:var ye=I&p;if(le||(le=v1),g.size!=b.size&&!ye)return!1;var De=Z.get(g);if(De)return De==b;I|=m,Z.set(g,b);var Pe=yL(le(g),le(b),I,L,G,Z);return Z.delete(g),Pe;case ee:if(dy)return dy.call(g)==dy.call(b)}return!1}function Xee(g,b,C,I,L,G){var Z=C&p,le=WA(g),ye=le.length,De=WA(b),Pe=De.length;if(ye!=Pe&&!Z)return!1;for(var ze=ye;ze--;){var at=le[ze];if(!(Z?at in b:Jn.call(b,at)))return!1}var At=G.get(g),Ut=G.get(b);if(At&&Ut)return At==b&&Ut==g;var pn=!0;G.set(g,b),G.set(b,g);for(var Wt=Z;++ze<ye;){at=le[ze];var Sn=g[at],$n=b[at];if(I)var So=Z?I($n,Sn,at,b,g,G):I(Sn,$n,at,g,b,G);if(!(So===n?Sn===$n||L(Sn,$n,C,I,G):So)){pn=!1;break}Wt||(Wt=at=="constructor")}if(pn&&!Wt){var Ls=g.constructor,Co=b.constructor;Ls!=Co&&"constructor"in g&&"constructor"in b&&!(typeof Ls=="function"&&Ls instanceof Ls&&typeof Co=="function"&&Co instanceof Co)&&(pn=!1)}return G.delete(g),G.delete(b),pn}function Ec(g){return ZA(CL(g,n,RL),g+"")}function WA(g){return LF(g,Bi,qA)}function GA(g){return LF(g,Ys,bL)}var HA=M1?function(g){return M1.get(g)}:uM;function W1(g){for(var b=g.name+"",C=fp[b],I=Jn.call(fp,b)?C.length:0;I--;){var L=C[I],G=L.func;if(G==null||G==g)return L.name}return b}function gp(g){var b=Jn.call(V,"placeholder")?V:g;return b.placeholder}function Vt(){var g=V.iteratee||lM;return g=g===lM?VF:g,arguments.length?g(arguments[0],arguments[1]):g}function G1(g,b){var C=g.__data__;return nte(b)?C[typeof b=="string"?"string":"hash"]:C.map}function jA(g){for(var b=Bi(g),C=b.length;C--;){var I=b[C],L=g[I];b[C]=[I,L,_L(L)]}return b}function ef(g,b){var C=sQ(g,b);return zF(C)?C:n}function Kee(g){var b=Jn.call(g,Kh),C=g[Kh];try{g[Kh]=n;var I=!0}catch{}var L=x1.call(g);return I&&(b?g[Kh]=C:delete g[Kh]),L}var qA=wA?function(g){return g==null?[]:(g=hr(g),ku(wA(g),function(b){return TF.call(g,b)}))}:hM,bL=wA?function(g){for(var b=[];g;)Au(b,qA(g)),g=C1(g);return b}:hM,us=Os;(xA&&us(new xA(new ArrayBuffer(1)))!=lt||uy&&us(new uy)!=pt||_A&&us(_A.resolve())!=Y||hp&&us(new hp)!=Et||hy&&us(new hy)!=ot)&&(us=function(g){var b=Os(g),C=b==q?g.constructor:n,I=C?tf(C):"";if(I)switch(I){case NQ:return lt;case $Q:return pt;case RQ:return Y;case DQ:return Et;case PQ:return ot}return b});function Yee(g,b,C){for(var I=-1,L=C.length;++I<L;){var G=C[I],Z=G.size;switch(G.type){case"drop":g+=Z;break;case"dropRight":b-=Z;break;case"take":b=cs(b,g+Z);break;case"takeRight":g=Ei(g,b-Z);break}}return{start:g,end:b}}function Zee(g){var b=g.match(Zk);return b?b[1].split(Jk):[]}function wL(g,b,C){b=Ru(b,g);for(var I=-1,L=b.length,G=!1;++I<L;){var Z=Pl(b[I]);if(!(G=g!=null&&C(g,Z)))break;g=g[Z]}return G||++I!=L?G:(L=g==null?0:g.length,!!L&&Z1(L)&&kc(Z,L)&&(nn(g)||nf(g)))}function Jee(g){var b=g.length,C=new g.constructor(b);return b&&typeof g[0]=="string"&&Jn.call(g,"index")&&(C.index=g.index,C.input=g.input),C}function xL(g){return typeof g.constructor=="function"&&!wy(g)?dp(C1(g)):{}}function Qee(g,b,C){var I=g.constructor;switch(b){case Ke:return zA(g);case Fe:case je:return new I(+g);case lt:return Oee(g,C);case it:case ce:case qe:case bt:case Ot:case gt:case dn:case Kn:case ur:return rL(g,C);case pt:return new I;case Ht:case st:return new I(g);case Re:return Fee(g);case Et:return new I;case ee:return Lee(g)}}function ete(g,b){var C=b.length;if(!C)return g;var I=C-1;return b[I]=(C>1?"& ":"")+b[I],b=b.join(C>2?", ":" "),g.replace(Yk,`{
/* [wrapped with `+b+`] */
`)}function tte(g){return nn(g)||nf(g)||!!(EF&&g&&g[EF])}function kc(g,b){var C=typeof g;return b=b==null?J:b,!!b&&(C=="number"||C!="symbol"&&Ft.test(g))&&g>-1&&g%1==0&&g<b}function Fs(g,b,C){if(!Lr(C))return!1;var I=typeof b;return(I=="number"?Ks(C)&&kc(b,C.length):I=="string"&&b in C)?Ga(C[b],g):!1}function XA(g,b){if(nn(g))return!1;var C=typeof g;return C=="number"||C=="symbol"||C=="boolean"||g==null||_o(g)?!0:qk.test(g)||!jk.test(g)||b!=null&&g in hr(b)}function nte(g){var b=typeof g;return b=="string"||b=="number"||b=="symbol"||b=="boolean"?g!=="__proto__":g===null}function KA(g){var b=W1(g),C=V[b];if(typeof C!="function"||!(b in An.prototype))return!1;if(g===C)return!0;var I=HA(C);return!!I&&g===I[0]}function rte(g){return!!_F&&_F in g}var ite=b1?Ac:fM;function wy(g){var b=g&&g.constructor,C=typeof b=="function"&&b.prototype||up;return g===C}function _L(g){return g===g&&!Lr(g)}function SL(g,b){return function(C){return C==null?!1:C[g]===b&&(b!==n||g in hr(C))}}function ste(g){var b=K1(g,function(I){return C.size===c&&C.clear(),I}),C=b.cache;return b}function ote(g,b){var C=g[1],I=b[1],L=C|I,G=L<(v|y|E),Z=I==E&&C==x||I==E&&C==k&&g[7].length<=b[8]||I==(E|k)&&b[7].length<=b[8]&&C==x;if(!(G||Z))return g;I&v&&(g[2]=b[2],L|=C&v?0:w);var le=b[3];if(le){var ye=g[3];g[3]=ye?sL(ye,le,b[4]):le,g[4]=ye?Mu(g[3],u):b[4]}return le=b[5],le&&(ye=g[5],g[5]=ye?oL(ye,le,b[6]):le,g[6]=ye?Mu(g[5],u):b[6]),le=b[7],le&&(g[7]=le),I&E&&(g[8]=g[8]==null?b[8]:cs(g[8],b[8])),g[9]==null&&(g[9]=b[9]),g[0]=b[0],g[1]=L,g}function ate(g){var b=[];if(g!=null)for(var C in hr(g))b.push(C);return b}function lte(g){return x1.call(g)}function CL(g,b,C){return b=Ei(b===n?g.length-1:b,0),function(){for(var I=arguments,L=-1,G=Ei(I.length-b,0),Z=xe(G);++L<G;)Z[L]=I[b+L];L=-1;for(var le=xe(b+1);++L<b;)le[L]=I[L];return le[b]=C(Z),bo(g,this,le)}}function TL(g,b){return b.length<2?g:Qh(g,ra(b,0,-1))}function cte(g,b){for(var C=g.length,I=cs(b.length,C),L=Xs(g);I--;){var G=b[I];g[I]=kc(G,C)?L[G]:n}return g}function YA(g,b){if(!(b==="constructor"&&typeof g[b]=="function")&&b!="__proto__")return g[b]}var EL=AL(KF),xy=CQ||function(g,b){return Zi.setTimeout(g,b)},ZA=AL($ee);function kL(g,b,C){var I=b+"";return ZA(g,ete(I,ute(Zee(I),C)))}function AL(g){var b=0,C=0;return function(){var I=AQ(),L=N-(I-C);if(C=I,L>0){if(++b>=P)return arguments[0]}else b=0;return g.apply(n,arguments)}}function H1(g,b){var C=-1,I=g.length,L=I-1;for(b=b===n?I:b;++C<b;){var G=RA(C,L),Z=g[G];g[G]=g[C],g[C]=Z}return g.length=b,g}var ML=ste(function(g){var b=[];return g.charCodeAt(0)===46&&b.push(""),g.replace(Xk,function(C,I,L,G){b.push(L?G.replace(tA,"$1"):I||C)}),b});function Pl(g){if(typeof g=="string"||_o(g))return g;var b=g+"";return b=="0"&&1/g==-K?"-0":b}function tf(g){if(g!=null){try{return w1.call(g)}catch{}try{return g+""}catch{}}return""}function ute(g,b){return Qo(Ne,function(C){var I="_."+C[0];b&C[1]&&!m1(g,I)&&g.push(I)}),g.sort()}function IL(g){if(g instanceof An)return g.clone();var b=new ta(g.__wrapped__,g.__chain__);return b.__actions__=Xs(g.__actions__),b.__index__=g.__index__,b.__values__=g.__values__,b}function hte(g,b,C){(C?Fs(g,b,C):b===n)?b=1:b=Ei(un(b),0);var I=g==null?0:g.length;if(!I||b<1)return[];for(var L=0,G=0,Z=xe(k1(I/b));L<I;)Z[G++]=ra(g,L,L+=b);return Z}function fte(g){for(var b=-1,C=g==null?0:g.length,I=0,L=[];++b<C;){var G=g[b];G&&(L[I++]=G)}return L}function dte(){var g=arguments.length;if(!g)return[];for(var b=xe(g-1),C=arguments[0],I=g;I--;)b[I-1]=arguments[I];return Au(nn(C)?Xs(C):[C],Ji(b,1))}var pte=bn(function(g,b){return ei(g)?my(g,Ji(b,1,ei,!0)):[]}),mte=bn(function(g,b){var C=ia(b);return ei(C)&&(C=n),ei(g)?my(g,Ji(b,1,ei,!0),Vt(C,2)):[]}),gte=bn(function(g,b){var C=ia(b);return ei(C)&&(C=n),ei(g)?my(g,Ji(b,1,ei,!0),n,C):[]});function vte(g,b,C){var I=g==null?0:g.length;return I?(b=C||b===n?1:un(b),ra(g,b<0?0:b,I)):[]}function yte(g,b,C){var I=g==null?0:g.length;return I?(b=C||b===n?1:un(b),b=I-b,ra(g,0,b<0?0:b)):[]}function bte(g,b){return g&&g.length?F1(g,Vt(b,3),!0,!0):[]}function wte(g,b){return g&&g.length?F1(g,Vt(b,3),!0):[]}function xte(g,b,C,I){var L=g==null?0:g.length;return L?(C&&typeof C!="number"&&Fs(g,b,C)&&(C=0,I=L),dee(g,b,C,I)):[]}function NL(g,b,C){var I=g==null?0:g.length;if(!I)return-1;var L=C==null?0:un(C);return L<0&&(L=Ei(I+L,0)),g1(g,Vt(b,3),L)}function $L(g,b,C){var I=g==null?0:g.length;if(!I)return-1;var L=I-1;return C!==n&&(L=un(C),L=C<0?Ei(I+L,0):cs(L,I-1)),g1(g,Vt(b,3),L,!0)}function RL(g){var b=g==null?0:g.length;return b?Ji(g,1):[]}function _te(g){var b=g==null?0:g.length;return b?Ji(g,K):[]}function Ste(g,b){var C=g==null?0:g.length;return C?(b=b===n?1:un(b),Ji(g,b)):[]}function Cte(g){for(var b=-1,C=g==null?0:g.length,I={};++b<C;){var L=g[b];I[L[0]]=L[1]}return I}function DL(g){return g&&g.length?g[0]:n}function Tte(g,b,C){var I=g==null?0:g.length;if(!I)return-1;var L=C==null?0:un(C);return L<0&&(L=Ei(I+L,0)),op(g,b,L)}function Ete(g){var b=g==null?0:g.length;return b?ra(g,0,-1):[]}var kte=bn(function(g){var b=Mr(g,LA);return b.length&&b[0]===g[0]?AA(b):[]}),Ate=bn(function(g){var b=ia(g),C=Mr(g,LA);return b===ia(C)?b=n:C.pop(),C.length&&C[0]===g[0]?AA(C,Vt(b,2)):[]}),Mte=bn(function(g){var b=ia(g),C=Mr(g,LA);return b=typeof b=="function"?b:n,b&&C.pop(),C.length&&C[0]===g[0]?AA(C,n,b):[]});function Ite(g,b){return g==null?"":EQ.call(g,b)}function ia(g){var b=g==null?0:g.length;return b?g[b-1]:n}function Nte(g,b,C){var I=g==null?0:g.length;if(!I)return-1;var L=I;return C!==n&&(L=un(C),L=L<0?Ei(I+L,0):cs(L,I-1)),b===b?uQ(g,b,L):g1(g,pF,L,!0)}function $te(g,b){return g&&g.length?HF(g,un(b)):n}var Rte=bn(PL);function PL(g,b){return g&&g.length&&b&&b.length?$A(g,b):g}function Dte(g,b,C){return g&&g.length&&b&&b.length?$A(g,b,Vt(C,2)):g}function Pte(g,b,C){return g&&g.length&&b&&b.length?$A(g,b,n,C):g}var Ote=Ec(function(g,b){var C=g==null?0:g.length,I=CA(g,b);return XF(g,Mr(b,function(L){return kc(L,C)?+L:L}).sort(iL)),I});function Fte(g,b){var C=[];if(!(g&&g.length))return C;var I=-1,L=[],G=g.length;for(b=Vt(b,3);++I<G;){var Z=g[I];b(Z,I,g)&&(C.push(Z),L.push(I))}return XF(g,L),C}function JA(g){return g==null?g:IQ.call(g)}function Lte(g,b,C){var I=g==null?0:g.length;return I?(C&&typeof C!="number"&&Fs(g,b,C)?(b=0,C=I):(b=b==null?0:un(b),C=C===n?I:un(C)),ra(g,b,C)):[]}function Bte(g,b){return O1(g,b)}function zte(g,b,C){return PA(g,b,Vt(C,2))}function Vte(g,b){var C=g==null?0:g.length;if(C){var I=O1(g,b);if(I<C&&Ga(g[I],b))return I}return-1}function Ute(g,b){return O1(g,b,!0)}function Wte(g,b,C){return PA(g,b,Vt(C,2),!0)}function Gte(g,b){var C=g==null?0:g.length;if(C){var I=O1(g,b,!0)-1;if(Ga(g[I],b))return I}return-1}function Hte(g){return g&&g.length?YF(g):[]}function jte(g,b){return g&&g.length?YF(g,Vt(b,2)):[]}function qte(g){var b=g==null?0:g.length;return b?ra(g,1,b):[]}function Xte(g,b,C){return g&&g.length?(b=C||b===n?1:un(b),ra(g,0,b<0?0:b)):[]}function Kte(g,b,C){var I=g==null?0:g.length;return I?(b=C||b===n?1:un(b),b=I-b,ra(g,b<0?0:b,I)):[]}function Yte(g,b){return g&&g.length?F1(g,Vt(b,3),!1,!0):[]}function Zte(g,b){return g&&g.length?F1(g,Vt(b,3)):[]}var Jte=bn(function(g){return $u(Ji(g,1,ei,!0))}),Qte=bn(function(g){var b=ia(g);return ei(b)&&(b=n),$u(Ji(g,1,ei,!0),Vt(b,2))}),ene=bn(function(g){var b=ia(g);return b=typeof b=="function"?b:n,$u(Ji(g,1,ei,!0),n,b)});function tne(g){return g&&g.length?$u(g):[]}function nne(g,b){return g&&g.length?$u(g,Vt(b,2)):[]}function rne(g,b){return b=typeof b=="function"?b:n,g&&g.length?$u(g,n,b):[]}function QA(g){if(!(g&&g.length))return[];var b=0;return g=ku(g,function(C){if(ei(C))return b=Ei(C.length,b),!0}),gA(b,function(C){return Mr(g,dA(C))})}function OL(g,b){if(!(g&&g.length))return[];var C=QA(g);return b==null?C:Mr(C,function(I){return bo(b,n,I)})}var ine=bn(function(g,b){return ei(g)?my(g,b):[]}),sne=bn(function(g){return FA(ku(g,ei))}),one=bn(function(g){var b=ia(g);return ei(b)&&(b=n),FA(ku(g,ei),Vt(b,2))}),ane=bn(function(g){var b=ia(g);return b=typeof b=="function"?b:n,FA(ku(g,ei),n,b)}),lne=bn(QA);function cne(g,b){return eL(g||[],b||[],py)}function une(g,b){return eL(g||[],b||[],yy)}var hne=bn(function(g){var b=g.length,C=b>1?g[b-1]:n;return C=typeof C=="function"?(g.pop(),C):n,OL(g,C)});function FL(g){var b=V(g);return b.__chain__=!0,b}function fne(g,b){return b(g),g}function j1(g,b){return b(g)}var dne=Ec(function(g){var b=g.length,C=b?g[0]:0,I=this.__wrapped__,L=function(G){return CA(G,g)};return b>1||this.__actions__.length||!(I instanceof An)||!kc(C)?this.thru(L):(I=I.slice(C,+C+(b?1:0)),I.__actions__.push({func:j1,args:[L],thisArg:n}),new ta(I,this.__chain__).thru(function(G){return b&&!G.length&&G.push(n),G}))});function pne(){return FL(this)}function mne(){return new ta(this.value(),this.__chain__)}function gne(){this.__values__===n&&(this.__values__=ZL(this.value()));var g=this.__index__>=this.__values__.length,b=g?n:this.__values__[this.__index__++];return{done:g,value:b}}function vne(){return this}function yne(g){for(var b,C=this;C instanceof N1;){var I=IL(C);I.__index__=0,I.__values__=n,b?L.__wrapped__=I:b=I;var L=I;C=C.__wrapped__}return L.__wrapped__=g,b}function bne(){var g=this.__wrapped__;if(g instanceof An){var b=g;return this.__actions__.length&&(b=new An(this)),b=b.reverse(),b.__actions__.push({func:j1,args:[JA],thisArg:n}),new ta(b,this.__chain__)}return this.thru(JA)}function wne(){return QF(this.__wrapped__,this.__actions__)}var xne=L1(function(g,b,C){Jn.call(g,C)?++g[C]:Cc(g,C,1)});function _ne(g,b,C){var I=nn(g)?fF:fee;return C&&Fs(g,b,C)&&(b=n),I(g,Vt(b,3))}function Sne(g,b){var C=nn(g)?ku:OF;return C(g,Vt(b,3))}var Cne=uL(NL),Tne=uL($L);function Ene(g,b){return Ji(q1(g,b),1)}function kne(g,b){return Ji(q1(g,b),K)}function Ane(g,b,C){return C=C===n?1:un(C),Ji(q1(g,b),C)}function LL(g,b){var C=nn(g)?Qo:Nu;return C(g,Vt(b,3))}function BL(g,b){var C=nn(g)?qJ:PF;return C(g,Vt(b,3))}var Mne=L1(function(g,b,C){Jn.call(g,C)?g[C].push(b):Cc(g,C,[b])});function Ine(g,b,C,I){g=Ks(g)?g:yp(g),C=C&&!I?un(C):0;var L=g.length;return C<0&&(C=Ei(L+C,0)),J1(g)?C<=L&&g.indexOf(b,C)>-1:!!L&&op(g,b,C)>-1}var Nne=bn(function(g,b,C){var I=-1,L=typeof b=="function",G=Ks(g)?xe(g.length):[];return Nu(g,function(Z){G[++I]=L?bo(b,Z,C):gy(Z,b,C)}),G}),$ne=L1(function(g,b,C){Cc(g,C,b)});function q1(g,b){var C=nn(g)?Mr:UF;return C(g,Vt(b,3))}function Rne(g,b,C,I){return g==null?[]:(nn(b)||(b=b==null?[]:[b]),C=I?n:C,nn(C)||(C=C==null?[]:[C]),jF(g,b,C))}var Dne=L1(function(g,b,C){g[C?0:1].push(b)},function(){return[[],[]]});function Pne(g,b,C){var I=nn(g)?hA:gF,L=arguments.length<3;return I(g,Vt(b,4),C,L,Nu)}function One(g,b,C){var I=nn(g)?XJ:gF,L=arguments.length<3;return I(g,Vt(b,4),C,L,PF)}function Fne(g,b){var C=nn(g)?ku:OF;return C(g,Y1(Vt(b,3)))}function Lne(g){var b=nn(g)?NF:Iee;return b(g)}function Bne(g,b,C){(C?Fs(g,b,C):b===n)?b=1:b=un(b);var I=nn(g)?aee:Nee;return I(g,b)}function zne(g){var b=nn(g)?lee:Ree;return b(g)}function Vne(g){if(g==null)return 0;if(Ks(g))return J1(g)?lp(g):g.length;var b=us(g);return b==pt||b==Et?g.size:IA(g).length}function Une(g,b,C){var I=nn(g)?fA:Dee;return C&&Fs(g,b,C)&&(b=n),I(g,Vt(b,3))}var Wne=bn(function(g,b){if(g==null)return[];var C=b.length;return C>1&&Fs(g,b[0],b[1])?b=[]:C>2&&Fs(b[0],b[1],b[2])&&(b=[b[0]]),jF(g,Ji(b,1),[])}),X1=SQ||function(){return Zi.Date.now()};function Gne(g,b){if(typeof b!="function")throw new ea(o);return g=un(g),function(){if(--g<1)return b.apply(this,arguments)}}function zL(g,b,C){return b=C?n:b,b=g&&b==null?g.length:b,Tc(g,E,n,n,n,n,b)}function VL(g,b){var C;if(typeof b!="function")throw new ea(o);return g=un(g),function(){return--g>0&&(C=b.apply(this,arguments)),g<=1&&(b=n),C}}var eM=bn(function(g,b,C){var I=v;if(C.length){var L=Mu(C,gp(eM));I|=S}return Tc(g,I,b,C,L)}),UL=bn(function(g,b,C){var I=v|y;if(C.length){var L=Mu(C,gp(UL));I|=S}return Tc(b,I,g,C,L)});function WL(g,b,C){b=C?n:b;var I=Tc(g,x,n,n,n,n,n,b);return I.placeholder=WL.placeholder,I}function GL(g,b,C){b=C?n:b;var I=Tc(g,_,n,n,n,n,n,b);return I.placeholder=GL.placeholder,I}function HL(g,b,C){var I,L,G,Z,le,ye,De=0,Pe=!1,ze=!1,at=!0;if(typeof g!="function")throw new ea(o);b=sa(b)||0,Lr(C)&&(Pe=!!C.leading,ze="maxWait"in C,G=ze?Ei(sa(C.maxWait)||0,b):G,at="trailing"in C?!!C.trailing:at);function At(ti){var Ha=I,Ic=L;return I=L=n,De=ti,Z=g.apply(Ic,Ha),Z}function Ut(ti){return De=ti,le=xy(Sn,b),Pe?At(ti):Z}function pn(ti){var Ha=ti-ye,Ic=ti-De,uB=b-Ha;return ze?cs(uB,G-Ic):uB}function Wt(ti){var Ha=ti-ye,Ic=ti-De;return ye===n||Ha>=b||Ha<0||ze&&Ic>=G}function Sn(){var ti=X1();if(Wt(ti))return $n(ti);le=xy(Sn,pn(ti))}function $n(ti){return le=n,at&&I?At(ti):(I=L=n,Z)}function So(){le!==n&&tL(le),De=0,I=ye=L=le=n}function Ls(){return le===n?Z:$n(X1())}function Co(){var ti=X1(),Ha=Wt(ti);if(I=arguments,L=this,ye=ti,Ha){if(le===n)return Ut(ye);if(ze)return tL(le),le=xy(Sn,b),At(ye)}return le===n&&(le=xy(Sn,b)),Z}return Co.cancel=So,Co.flush=Ls,Co}var Hne=bn(function(g,b){return DF(g,1,b)}),jne=bn(function(g,b,C){return DF(g,sa(b)||0,C)});function qne(g){return Tc(g,A)}function K1(g,b){if(typeof g!="function"||b!=null&&typeof b!="function")throw new ea(o);var C=function(){var I=arguments,L=b?b.apply(this,I):I[0],G=C.cache;if(G.has(L))return G.get(L);var Z=g.apply(this,I);return C.cache=G.set(L,Z)||G,Z};return C.cache=new(K1.Cache||Sc),C}K1.Cache=Sc;function Y1(g){if(typeof g!="function")throw new ea(o);return function(){var b=arguments;switch(b.length){case 0:return!g.call(this);case 1:return!g.call(this,b[0]);case 2:return!g.call(this,b[0],b[1]);case 3:return!g.call(this,b[0],b[1],b[2])}return!g.apply(this,b)}}function Xne(g){return VL(2,g)}var Kne=Pee(function(g,b){b=b.length==1&&nn(b[0])?Mr(b[0],wo(Vt())):Mr(Ji(b,1),wo(Vt()));var C=b.length;return bn(function(I){for(var L=-1,G=cs(I.length,C);++L<G;)I[L]=b[L].call(this,I[L]);return bo(g,this,I)})}),tM=bn(function(g,b){var C=Mu(b,gp(tM));return Tc(g,S,n,b,C)}),jL=bn(function(g,b){var C=Mu(b,gp(jL));return Tc(g,T,n,b,C)}),Yne=Ec(function(g,b){return Tc(g,k,n,n,n,b)});function Zne(g,b){if(typeof g!="function")throw new ea(o);return b=b===n?b:un(b),bn(g,b)}function Jne(g,b){if(typeof g!="function")throw new ea(o);return b=b==null?0:Ei(un(b),0),bn(function(C){var I=C[b],L=Du(C,0,b);return I&&Au(L,I),bo(g,this,L)})}function Qne(g,b,C){var I=!0,L=!0;if(typeof g!="function")throw new ea(o);return Lr(C)&&(I="leading"in C?!!C.leading:I,L="trailing"in C?!!C.trailing:L),HL(g,b,{leading:I,maxWait:b,trailing:L})}function ere(g){return zL(g,1)}function tre(g,b){return tM(BA(b),g)}function nre(){if(!arguments.length)return[];var g=arguments[0];return nn(g)?g:[g]}function rre(g){return na(g,d)}function ire(g,b){return b=typeof b=="function"?b:n,na(g,d,b)}function sre(g){return na(g,h|d)}function ore(g,b){return b=typeof b=="function"?b:n,na(g,h|d,b)}function are(g,b){return b==null||RF(g,b,Bi(b))}function Ga(g,b){return g===b||g!==g&&b!==b}var lre=U1(kA),cre=U1(function(g,b){return g>=b}),nf=BF(function(){return arguments}())?BF:function(g){return Wr(g)&&Jn.call(g,"callee")&&!TF.call(g,"callee")},nn=xe.isArray,ure=oF?wo(oF):yee;function Ks(g){return g!=null&&Z1(g.length)&&!Ac(g)}function ei(g){return Wr(g)&&Ks(g)}function hre(g){return g===!0||g===!1||Wr(g)&&Os(g)==Fe}var Pu=TQ||fM,fre=aF?wo(aF):bee;function dre(g){return Wr(g)&&g.nodeType===1&&!_y(g)}function pre(g){if(g==null)return!0;if(Ks(g)&&(nn(g)||typeof g=="string"||typeof g.splice=="function"||Pu(g)||vp(g)||nf(g)))return!g.length;var b=us(g);if(b==pt||b==Et)return!g.size;if(wy(g))return!IA(g).length;for(var C in g)if(Jn.call(g,C))return!1;return!0}function mre(g,b){return vy(g,b)}function gre(g,b,C){C=typeof C=="function"?C:n;var I=C?C(g,b):n;return I===n?vy(g,b,n,C):!!I}function nM(g){if(!Wr(g))return!1;var b=Os(g);return b==Se||b==Ve||typeof g.message=="string"&&typeof g.name=="string"&&!_y(g)}function vre(g){return typeof g=="number"&&kF(g)}function Ac(g){if(!Lr(g))return!1;var b=Os(g);return b==nt||b==Ct||b==He||b==Xe}function qL(g){return typeof g=="number"&&g==un(g)}function Z1(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=J}function Lr(g){var b=typeof g;return g!=null&&(b=="object"||b=="function")}function Wr(g){return g!=null&&typeof g=="object"}var XL=lF?wo(lF):xee;function yre(g,b){return g===b||MA(g,b,jA(b))}function bre(g,b,C){return C=typeof C=="function"?C:n,MA(g,b,jA(b),C)}function wre(g){return KL(g)&&g!=+g}function xre(g){if(ite(g))throw new en(s);return zF(g)}function _re(g){return g===null}function Sre(g){return g==null}function KL(g){return typeof g=="number"||Wr(g)&&Os(g)==Ht}function _y(g){if(!Wr(g)||Os(g)!=q)return!1;var b=C1(g);if(b===null)return!0;var C=Jn.call(b,"constructor")&&b.constructor;return typeof C=="function"&&C instanceof C&&w1.call(C)==bQ}var rM=cF?wo(cF):_ee;function Cre(g){return qL(g)&&g>=-J&&g<=J}var YL=uF?wo(uF):See;function J1(g){return typeof g=="string"||!nn(g)&&Wr(g)&&Os(g)==st}function _o(g){return typeof g=="symbol"||Wr(g)&&Os(g)==ee}var vp=hF?wo(hF):Cee;function Tre(g){return g===n}function Ere(g){return Wr(g)&&us(g)==ot}function kre(g){return Wr(g)&&Os(g)==rt}var Are=U1(NA),Mre=U1(function(g,b){return g<=b});function ZL(g){if(!g)return[];if(Ks(g))return J1(g)?Ua(g):Xs(g);if(cy&&g[cy])return aQ(g[cy]());var b=us(g),C=b==pt?yA:b==Et?v1:yp;return C(g)}function Mc(g){if(!g)return g===0?g:0;if(g=sa(g),g===K||g===-K){var b=g<0?-1:1;return b*re}return g===g?g:0}function un(g){var b=Mc(g),C=b%1;return b===b?C?b-C:b:0}function JL(g){return g?Jh(un(g),0,pe):0}function sa(g){if(typeof g=="number")return g;if(_o(g))return ae;if(Lr(g)){var b=typeof g.valueOf=="function"?g.valueOf():g;g=Lr(b)?b+"":b}if(typeof g!="string")return g===0?g:+g;g=vF(g);var C=he.test(g);return C||Ye.test(g)?GJ(g.slice(2),C?2:8):W.test(g)?ae:+g}function QL(g){return Dl(g,Ys(g))}function Ire(g){return g?Jh(un(g),-J,J):g===0?g:0}function Hn(g){return g==null?"":xo(g)}var Nre=pp(function(g,b){if(wy(b)||Ks(b)){Dl(b,Bi(b),g);return}for(var C in b)Jn.call(b,C)&&py(g,C,b[C])}),eB=pp(function(g,b){Dl(b,Ys(b),g)}),Q1=pp(function(g,b,C,I){Dl(b,Ys(b),g,I)}),$re=pp(function(g,b,C,I){Dl(b,Bi(b),g,I)}),Rre=Ec(CA);function Dre(g,b){var C=dp(g);return b==null?C:$F(C,b)}var Pre=bn(function(g,b){g=hr(g);var C=-1,I=b.length,L=I>2?b[2]:n;for(L&&Fs(b[0],b[1],L)&&(I=1);++C<I;)for(var G=b[C],Z=Ys(G),le=-1,ye=Z.length;++le<ye;){var De=Z[le],Pe=g[De];(Pe===n||Ga(Pe,up[De])&&!Jn.call(g,De))&&(g[De]=G[De])}return g}),Ore=bn(function(g){return g.push(n,vL),bo(tB,n,g)});function Fre(g,b){return dF(g,Vt(b,3),Rl)}function Lre(g,b){return dF(g,Vt(b,3),EA)}function Bre(g,b){return g==null?g:TA(g,Vt(b,3),Ys)}function zre(g,b){return g==null?g:FF(g,Vt(b,3),Ys)}function Vre(g,b){return g&&Rl(g,Vt(b,3))}function Ure(g,b){return g&&EA(g,Vt(b,3))}function Wre(g){return g==null?[]:D1(g,Bi(g))}function Gre(g){return g==null?[]:D1(g,Ys(g))}function iM(g,b,C){var I=g==null?n:Qh(g,b);return I===n?C:I}function Hre(g,b){return g!=null&&wL(g,b,pee)}function sM(g,b){return g!=null&&wL(g,b,mee)}var jre=fL(function(g,b,C){b!=null&&typeof b.toString!="function"&&(b=x1.call(b)),g[b]=C},aM(Zs)),qre=fL(function(g,b,C){b!=null&&typeof b.toString!="function"&&(b=x1.call(b)),Jn.call(g,b)?g[b].push(C):g[b]=[C]},Vt),Xre=bn(gy);function Bi(g){return Ks(g)?IF(g):IA(g)}function Ys(g){return Ks(g)?IF(g,!0):Tee(g)}function Kre(g,b){var C={};return b=Vt(b,3),Rl(g,function(I,L,G){Cc(C,b(I,L,G),I)}),C}function Yre(g,b){var C={};return b=Vt(b,3),Rl(g,function(I,L,G){Cc(C,L,b(I,L,G))}),C}var Zre=pp(function(g,b,C){P1(g,b,C)}),tB=pp(function(g,b,C,I){P1(g,b,C,I)}),Jre=Ec(function(g,b){var C={};if(g==null)return C;var I=!1;b=Mr(b,function(G){return G=Ru(G,g),I||(I=G.length>1),G}),Dl(g,GA(g),C),I&&(C=na(C,h|f|d,jee));for(var L=b.length;L--;)OA(C,b[L]);return C});function Qre(g,b){return nB(g,Y1(Vt(b)))}var eie=Ec(function(g,b){return g==null?{}:kee(g,b)});function nB(g,b){if(g==null)return{};var C=Mr(GA(g),function(I){return[I]});return b=Vt(b),qF(g,C,function(I,L){return b(I,L[0])})}function tie(g,b,C){b=Ru(b,g);var I=-1,L=b.length;for(L||(L=1,g=n);++I<L;){var G=g==null?n:g[Pl(b[I])];G===n&&(I=L,G=C),g=Ac(G)?G.call(g):G}return g}function nie(g,b,C){return g==null?g:yy(g,b,C)}function rie(g,b,C,I){return I=typeof I=="function"?I:n,g==null?g:yy(g,b,C,I)}var rB=mL(Bi),iB=mL(Ys);function iie(g,b,C){var I=nn(g),L=I||Pu(g)||vp(g);if(b=Vt(b,4),C==null){var G=g&&g.constructor;L?C=I?new G:[]:Lr(g)?C=Ac(G)?dp(C1(g)):{}:C={}}return(L?Qo:Rl)(g,function(Z,le,ye){return b(C,Z,le,ye)}),C}function sie(g,b){return g==null?!0:OA(g,b)}function oie(g,b,C){return g==null?g:JF(g,b,BA(C))}function aie(g,b,C,I){return I=typeof I=="function"?I:n,g==null?g:JF(g,b,BA(C),I)}function yp(g){return g==null?[]:vA(g,Bi(g))}function lie(g){return g==null?[]:vA(g,Ys(g))}function cie(g,b,C){return C===n&&(C=b,b=n),C!==n&&(C=sa(C),C=C===C?C:0),b!==n&&(b=sa(b),b=b===b?b:0),Jh(sa(g),b,C)}function uie(g,b,C){return b=Mc(b),C===n?(C=b,b=0):C=Mc(C),g=sa(g),gee(g,b,C)}function hie(g,b,C){if(C&&typeof C!="boolean"&&Fs(g,b,C)&&(b=C=n),C===n&&(typeof b=="boolean"?(C=b,b=n):typeof g=="boolean"&&(C=g,g=n)),g===n&&b===n?(g=0,b=1):(g=Mc(g),b===n?(b=g,g=0):b=Mc(b)),g>b){var I=g;g=b,b=I}if(C||g%1||b%1){var L=AF();return cs(g+L*(b-g+WJ("1e-"+((L+"").length-1))),b)}return RA(g,b)}var fie=mp(function(g,b,C){return b=b.toLowerCase(),g+(C?sB(b):b)});function sB(g){return oM(Hn(g).toLowerCase())}function oB(g){return g=Hn(g),g&&g.replace(kt,nQ).replace(RJ,"")}function die(g,b,C){g=Hn(g),b=xo(b);var I=g.length;C=C===n?I:Jh(un(C),0,I);var L=C;return C-=b.length,C>=0&&g.slice(C,L)==b}function pie(g){return g=Hn(g),g&&tp.test(g)?g.replace(wc,rQ):g}function mie(g){return g=Hn(g),g&&Kk.test(g)?g.replace(oy,"\\$&"):g}var gie=mp(function(g,b,C){return g+(C?"-":"")+b.toLowerCase()}),vie=mp(function(g,b,C){return g+(C?" ":"")+b.toLowerCase()}),yie=cL("toLowerCase");function bie(g,b,C){g=Hn(g),b=un(b);var I=b?lp(g):0;if(!b||I>=b)return g;var L=(b-I)/2;return V1(A1(L),C)+g+V1(k1(L),C)}function wie(g,b,C){g=Hn(g),b=un(b);var I=b?lp(g):0;return b&&I<b?g+V1(b-I,C):g}function xie(g,b,C){g=Hn(g),b=un(b);var I=b?lp(g):0;return b&&I<b?V1(b-I,C)+g:g}function _ie(g,b,C){return C||b==null?b=0:b&&(b=+b),MQ(Hn(g).replace(ay,""),b||0)}function Sie(g,b,C){return(C?Fs(g,b,C):b===n)?b=1:b=un(b),DA(Hn(g),b)}function Cie(){var g=arguments,b=Hn(g[0]);return g.length<3?b:b.replace(g[1],g[2])}var Tie=mp(function(g,b,C){return g+(C?"_":"")+b.toLowerCase()});function Eie(g,b,C){return C&&typeof C!="number"&&Fs(g,b,C)&&(b=C=n),C=C===n?pe:C>>>0,C?(g=Hn(g),g&&(typeof b=="string"||b!=null&&!rM(b))&&(b=xo(b),!b&&ap(g))?Du(Ua(g),0,C):g.split(b,C)):[]}var kie=mp(function(g,b,C){return g+(C?" ":"")+oM(b)});function Aie(g,b,C){return g=Hn(g),C=C==null?0:Jh(un(C),0,g.length),b=xo(b),g.slice(C,C+b.length)==b}function Mie(g,b,C){var I=V.templateSettings;C&&Fs(g,b,C)&&(b=n),g=Hn(g),b=Q1({},b,I,gL);var L=Q1({},b.imports,I.imports,gL),G=Bi(L),Z=vA(L,G),le,ye,De=0,Pe=b.interpolate||cn,ze="__p += '",at=bA((b.escape||cn).source+"|"+Pe.source+"|"+(Pe===xc?nA:cn).source+"|"+(b.evaluate||cn).source+"|$","g"),At="//# sourceURL="+(Jn.call(b,"sourceURL")?(b.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++LJ+"]")+`
`;g.replace(at,function(Wt,Sn,$n,So,Ls,Co){return $n||($n=So),ze+=g.slice(De,Co).replace(Jt,iQ),Sn&&(le=!0,ze+=`' +
__e(`+Sn+`) +
'`),Ls&&(ye=!0,ze+=`';
`+Ls+`;
__p += '`),$n&&(ze+=`' +
((__t = (`+$n+`)) == null ? '' : __t) +
'`),De=Co+Wt.length,Wt}),ze+=`';
`;var Ut=Jn.call(b,"variable")&&b.variable;if(!Ut)ze=`with (obj) {
`+ze+`
}
`;else if(eA.test(Ut))throw new en(a);ze=(ye?ze.replace(go,""):ze).replace(Yn,"$1").replace(Ds,"$1;"),ze="function("+(Ut||"obj")+`) {
`+(Ut?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(le?", __e = _.escape":"")+(ye?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+ze+`return __p
}`;var pn=lB(function(){return Wn(G,At+"return "+ze).apply(n,Z)});if(pn.source=ze,nM(pn))throw pn;return pn}function Iie(g){return Hn(g).toLowerCase()}function Nie(g){return Hn(g).toUpperCase()}function $ie(g,b,C){if(g=Hn(g),g&&(C||b===n))return vF(g);if(!g||!(b=xo(b)))return g;var I=Ua(g),L=Ua(b),G=yF(I,L),Z=bF(I,L)+1;return Du(I,G,Z).join("")}function Rie(g,b,C){if(g=Hn(g),g&&(C||b===n))return g.slice(0,xF(g)+1);if(!g||!(b=xo(b)))return g;var I=Ua(g),L=bF(I,Ua(b))+1;return Du(I,0,L).join("")}function Die(g,b,C){if(g=Hn(g),g&&(C||b===n))return g.replace(ay,"");if(!g||!(b=xo(b)))return g;var I=Ua(g),L=yF(I,Ua(b));return Du(I,L).join("")}function Pie(g,b){var C=M,I=D;if(Lr(b)){var L="separator"in b?b.separator:L;C="length"in b?un(b.length):C,I="omission"in b?xo(b.omission):I}g=Hn(g);var G=g.length;if(ap(g)){var Z=Ua(g);G=Z.length}if(C>=G)return g;var le=C-lp(I);if(le<1)return I;var ye=Z?Du(Z,0,le).join(""):g.slice(0,le);if(L===n)return ye+I;if(Z&&(le+=ye.length-le),rM(L)){if(g.slice(le).search(L)){var De,Pe=ye;for(L.global||(L=bA(L.source,Hn(B.exec(L))+"g")),L.lastIndex=0;De=L.exec(Pe);)var ze=De.index;ye=ye.slice(0,ze===n?le:ze)}}else if(g.indexOf(xo(L),le)!=le){var at=ye.lastIndexOf(L);at>-1&&(ye=ye.slice(0,at))}return ye+I}function Oie(g){return g=Hn(g),g&&vo.test(g)?g.replace(Li,hQ):g}var Fie=mp(function(g,b,C){return g+(C?" ":"")+b.toUpperCase()}),oM=cL("toUpperCase");function aB(g,b,C){return g=Hn(g),b=C?n:b,b===n?oQ(g)?pQ(g):ZJ(g):g.match(b)||[]}var lB=bn(function(g,b){try{return bo(g,n,b)}catch(C){return nM(C)?C:new en(C)}}),Lie=Ec(function(g,b){return Qo(b,function(C){C=Pl(C),Cc(g,C,eM(g[C],g))}),g});function Bie(g){var b=g==null?0:g.length,C=Vt();return g=b?Mr(g,function(I){if(typeof I[1]!="function")throw new ea(o);return[C(I[0]),I[1]]}):[],bn(function(I){for(var L=-1;++L<b;){var G=g[L];if(bo(G[0],this,I))return bo(G[1],this,I)}})}function zie(g){return hee(na(g,h))}function aM(g){return function(){return g}}function Vie(g,b){return g==null||g!==g?b:g}var Uie=hL(),Wie=hL(!0);function Zs(g){return g}function lM(g){return VF(typeof g=="function"?g:na(g,h))}function Gie(g){return WF(na(g,h))}function Hie(g,b){return GF(g,na(b,h))}var jie=bn(function(g,b){return function(C){return gy(C,g,b)}}),qie=bn(function(g,b){return function(C){return gy(g,C,b)}});function cM(g,b,C){var I=Bi(b),L=D1(b,I);C==null&&!(Lr(b)&&(L.length||!I.length))&&(C=b,b=g,g=this,L=D1(b,Bi(b)));var G=!(Lr(C)&&"chain"in C)||!!C.chain,Z=Ac(g);return Qo(L,function(le){var ye=b[le];g[le]=ye,Z&&(g.prototype[le]=function(){var De=this.__chain__;if(G||De){var Pe=g(this.__wrapped__),ze=Pe.__actions__=Xs(this.__actions__);return ze.push({func:ye,args:arguments,thisArg:g}),Pe.__chain__=De,Pe}return ye.apply(g,Au([this.value()],arguments))})}),g}function Xie(){return Zi._===this&&(Zi._=wQ),this}function uM(){}function Kie(g){return g=un(g),bn(function(b){return HF(b,g)})}var Yie=VA(Mr),Zie=VA(fF),Jie=VA(fA);function cB(g){return XA(g)?dA(Pl(g)):Aee(g)}function Qie(g){return function(b){return g==null?n:Qh(g,b)}}var ese=dL(),tse=dL(!0);function hM(){return[]}function fM(){return!1}function nse(){return{}}function rse(){return""}function ise(){return!0}function sse(g,b){if(g=un(g),g<1||g>J)return[];var C=pe,I=cs(g,pe);b=Vt(b),g-=pe;for(var L=gA(I,b);++C<g;)b(C);return L}function ose(g){return nn(g)?Mr(g,Pl):_o(g)?[g]:Xs(ML(Hn(g)))}function ase(g){var b=++yQ;return Hn(g)+b}var lse=z1(function(g,b){return g+b},0),cse=UA("ceil"),use=z1(function(g,b){return g/b},1),hse=UA("floor");function fse(g){return g&&g.length?R1(g,Zs,kA):n}function dse(g,b){return g&&g.length?R1(g,Vt(b,2),kA):n}function pse(g){return mF(g,Zs)}function mse(g,b){return mF(g,Vt(b,2))}function gse(g){return g&&g.length?R1(g,Zs,NA):n}function vse(g,b){return g&&g.length?R1(g,Vt(b,2),NA):n}var yse=z1(function(g,b){return g*b},1),bse=UA("round"),wse=z1(function(g,b){return g-b},0);function xse(g){return g&&g.length?mA(g,Zs):0}function _se(g,b){return g&&g.length?mA(g,Vt(b,2)):0}return V.after=Gne,V.ary=zL,V.assign=Nre,V.assignIn=eB,V.assignInWith=Q1,V.assignWith=$re,V.at=Rre,V.before=VL,V.bind=eM,V.bindAll=Lie,V.bindKey=UL,V.castArray=nre,V.chain=FL,V.chunk=hte,V.compact=fte,V.concat=dte,V.cond=Bie,V.conforms=zie,V.constant=aM,V.countBy=xne,V.create=Dre,V.curry=WL,V.curryRight=GL,V.debounce=HL,V.defaults=Pre,V.defaultsDeep=Ore,V.defer=Hne,V.delay=jne,V.difference=pte,V.differenceBy=mte,V.differenceWith=gte,V.drop=vte,V.dropRight=yte,V.dropRightWhile=bte,V.dropWhile=wte,V.fill=xte,V.filter=Sne,V.flatMap=Ene,V.flatMapDeep=kne,V.flatMapDepth=Ane,V.flatten=RL,V.flattenDeep=_te,V.flattenDepth=Ste,V.flip=qne,V.flow=Uie,V.flowRight=Wie,V.fromPairs=Cte,V.functions=Wre,V.functionsIn=Gre,V.groupBy=Mne,V.initial=Ete,V.intersection=kte,V.intersectionBy=Ate,V.intersectionWith=Mte,V.invert=jre,V.invertBy=qre,V.invokeMap=Nne,V.iteratee=lM,V.keyBy=$ne,V.keys=Bi,V.keysIn=Ys,V.map=q1,V.mapKeys=Kre,V.mapValues=Yre,V.matches=Gie,V.matchesProperty=Hie,V.memoize=K1,V.merge=Zre,V.mergeWith=tB,V.method=jie,V.methodOf=qie,V.mixin=cM,V.negate=Y1,V.nthArg=Kie,V.omit=Jre,V.omitBy=Qre,V.once=Xne,V.orderBy=Rne,V.over=Yie,V.overArgs=Kne,V.overEvery=Zie,V.overSome=Jie,V.partial=tM,V.partialRight=jL,V.partition=Dne,V.pick=eie,V.pickBy=nB,V.property=cB,V.propertyOf=Qie,V.pull=Rte,V.pullAll=PL,V.pullAllBy=Dte,V.pullAllWith=Pte,V.pullAt=Ote,V.range=ese,V.rangeRight=tse,V.rearg=Yne,V.reject=Fne,V.remove=Fte,V.rest=Zne,V.reverse=JA,V.sampleSize=Bne,V.set=nie,V.setWith=rie,V.shuffle=zne,V.slice=Lte,V.sortBy=Wne,V.sortedUniq=Hte,V.sortedUniqBy=jte,V.split=Eie,V.spread=Jne,V.tail=qte,V.take=Xte,V.takeRight=Kte,V.takeRightWhile=Yte,V.takeWhile=Zte,V.tap=fne,V.throttle=Qne,V.thru=j1,V.toArray=ZL,V.toPairs=rB,V.toPairsIn=iB,V.toPath=ose,V.toPlainObject=QL,V.transform=iie,V.unary=ere,V.union=Jte,V.unionBy=Qte,V.unionWith=ene,V.uniq=tne,V.uniqBy=nne,V.uniqWith=rne,V.unset=sie,V.unzip=QA,V.unzipWith=OL,V.update=oie,V.updateWith=aie,V.values=yp,V.valuesIn=lie,V.without=ine,V.words=aB,V.wrap=tre,V.xor=sne,V.xorBy=one,V.xorWith=ane,V.zip=lne,V.zipObject=cne,V.zipObjectDeep=une,V.zipWith=hne,V.entries=rB,V.entriesIn=iB,V.extend=eB,V.extendWith=Q1,cM(V,V),V.add=lse,V.attempt=lB,V.camelCase=fie,V.capitalize=sB,V.ceil=cse,V.clamp=cie,V.clone=rre,V.cloneDeep=sre,V.cloneDeepWith=ore,V.cloneWith=ire,V.conformsTo=are,V.deburr=oB,V.defaultTo=Vie,V.divide=use,V.endsWith=die,V.eq=Ga,V.escape=pie,V.escapeRegExp=mie,V.every=_ne,V.find=Cne,V.findIndex=NL,V.findKey=Fre,V.findLast=Tne,V.findLastIndex=$L,V.findLastKey=Lre,V.floor=hse,V.forEach=LL,V.forEachRight=BL,V.forIn=Bre,V.forInRight=zre,V.forOwn=Vre,V.forOwnRight=Ure,V.get=iM,V.gt=lre,V.gte=cre,V.has=Hre,V.hasIn=sM,V.head=DL,V.identity=Zs,V.includes=Ine,V.indexOf=Tte,V.inRange=uie,V.invoke=Xre,V.isArguments=nf,V.isArray=nn,V.isArrayBuffer=ure,V.isArrayLike=Ks,V.isArrayLikeObject=ei,V.isBoolean=hre,V.isBuffer=Pu,V.isDate=fre,V.isElement=dre,V.isEmpty=pre,V.isEqual=mre,V.isEqualWith=gre,V.isError=nM,V.isFinite=vre,V.isFunction=Ac,V.isInteger=qL,V.isLength=Z1,V.isMap=XL,V.isMatch=yre,V.isMatchWith=bre,V.isNaN=wre,V.isNative=xre,V.isNil=Sre,V.isNull=_re,V.isNumber=KL,V.isObject=Lr,V.isObjectLike=Wr,V.isPlainObject=_y,V.isRegExp=rM,V.isSafeInteger=Cre,V.isSet=YL,V.isString=J1,V.isSymbol=_o,V.isTypedArray=vp,V.isUndefined=Tre,V.isWeakMap=Ere,V.isWeakSet=kre,V.join=Ite,V.kebabCase=gie,V.last=ia,V.lastIndexOf=Nte,V.lowerCase=vie,V.lowerFirst=yie,V.lt=Are,V.lte=Mre,V.max=fse,V.maxBy=dse,V.mean=pse,V.meanBy=mse,V.min=gse,V.minBy=vse,V.stubArray=hM,V.stubFalse=fM,V.stubObject=nse,V.stubString=rse,V.stubTrue=ise,V.multiply=yse,V.nth=$te,V.noConflict=Xie,V.noop=uM,V.now=X1,V.pad=bie,V.padEnd=wie,V.padStart=xie,V.parseInt=_ie,V.random=hie,V.reduce=Pne,V.reduceRight=One,V.repeat=Sie,V.replace=Cie,V.result=tie,V.round=bse,V.runInContext=ge,V.sample=Lne,V.size=Vne,V.snakeCase=Tie,V.some=Une,V.sortedIndex=Bte,V.sortedIndexBy=zte,V.sortedIndexOf=Vte,V.sortedLastIndex=Ute,V.sortedLastIndexBy=Wte,V.sortedLastIndexOf=Gte,V.startCase=kie,V.startsWith=Aie,V.subtract=wse,V.sum=xse,V.sumBy=_se,V.template=Mie,V.times=sse,V.toFinite=Mc,V.toInteger=un,V.toLength=JL,V.toLower=Iie,V.toNumber=sa,V.toSafeInteger=Ire,V.toString=Hn,V.toUpper=Nie,V.trim=$ie,V.trimEnd=Rie,V.trimStart=Die,V.truncate=Pie,V.unescape=Oie,V.uniqueId=ase,V.upperCase=Fie,V.upperFirst=oM,V.each=LL,V.eachRight=BL,V.first=DL,cM(V,function(){var g={};return Rl(V,function(b,C){Jn.call(V.prototype,C)||(g[C]=b)}),g}(),{chain:!1}),V.VERSION=r,Qo(["bind","bindKey","curry","curryRight","partial","partialRight"],function(g){V[g].placeholder=V}),Qo(["drop","take"],function(g,b){An.prototype[g]=function(C){C=C===n?1:Ei(un(C),0);var I=this.__filtered__&&!b?new An(this):this.clone();return I.__filtered__?I.__takeCount__=cs(C,I.__takeCount__):I.__views__.push({size:cs(C,pe),type:g+(I.__dir__<0?"Right":"")}),I},An.prototype[g+"Right"]=function(C){return this.reverse()[g](C).reverse()}}),Qo(["filter","map","takeWhile"],function(g,b){var C=b+1,I=C==R||C==O;An.prototype[g]=function(L){var G=this.clone();return G.__iteratees__.push({iteratee:Vt(L,3),type:C}),G.__filtered__=G.__filtered__||I,G}}),Qo(["head","last"],function(g,b){var C="take"+(b?"Right":"");An.prototype[g]=function(){return this[C](1).value()[0]}}),Qo(["initial","tail"],function(g,b){var C="drop"+(b?"":"Right");An.prototype[g]=function(){return this.__filtered__?new An(this):this[C](1)}}),An.prototype.compact=function(){return this.filter(Zs)},An.prototype.find=function(g){return this.filter(g).head()},An.prototype.findLast=function(g){return this.reverse().find(g)},An.prototype.invokeMap=bn(function(g,b){return typeof g=="function"?new An(this):this.map(function(C){return gy(C,g,b)})}),An.prototype.reject=function(g){return this.filter(Y1(Vt(g)))},An.prototype.slice=function(g,b){g=un(g);var C=this;return C.__filtered__&&(g>0||b<0)?new An(C):(g<0?C=C.takeRight(-g):g&&(C=C.drop(g)),b!==n&&(b=un(b),C=b<0?C.dropRight(-b):C.take(b-g)),C)},An.prototype.takeRightWhile=function(g){return this.reverse().takeWhile(g).reverse()},An.prototype.toArray=function(){return this.take(pe)},Rl(An.prototype,function(g,b){var C=/^(?:filter|find|map|reject)|While$/.test(b),I=/^(?:head|last)$/.test(b),L=V[I?"take"+(b=="last"?"Right":""):b],G=I||/^find/.test(b);!L||(V.prototype[b]=function(){var Z=this.__wrapped__,le=I?[1]:arguments,ye=Z instanceof An,De=le[0],Pe=ye||nn(Z),ze=function(Sn){var $n=L.apply(V,Au([Sn],le));return I&&at?$n[0]:$n};Pe&&C&&typeof De=="function"&&De.length!=1&&(ye=Pe=!1);var at=this.__chain__,At=!!this.__actions__.length,Ut=G&&!at,pn=ye&&!At;if(!G&&Pe){Z=pn?Z:new An(this);var Wt=g.apply(Z,le);return Wt.__actions__.push({func:j1,args:[ze],thisArg:n}),new ta(Wt,at)}return Ut&&pn?g.apply(this,le):(Wt=this.thru(ze),Ut?I?Wt.value()[0]:Wt.value():Wt)})}),Qo(["pop","push","shift","sort","splice","unshift"],function(g){var b=y1[g],C=/^(?:push|sort|unshift)$/.test(g)?"tap":"thru",I=/^(?:pop|shift)$/.test(g);V.prototype[g]=function(){var L=arguments;if(I&&!this.__chain__){var G=this.value();return b.apply(nn(G)?G:[],L)}return this[C](function(Z){return b.apply(nn(Z)?Z:[],L)})}}),Rl(An.prototype,function(g,b){var C=V[b];if(C){var I=C.name+"";Jn.call(fp,I)||(fp[I]=[]),fp[I].push({name:b,func:C})}}),fp[B1(n,y).name]=[{name:"wrapper",func:n}],An.prototype.clone=OQ,An.prototype.reverse=FQ,An.prototype.value=LQ,V.prototype.at=dne,V.prototype.chain=pne,V.prototype.commit=mne,V.prototype.next=gne,V.prototype.plant=yne,V.prototype.reverse=bne,V.prototype.toJSON=V.prototype.valueOf=V.prototype.value=wne,V.prototype.first=V.prototype.head,cy&&(V.prototype[cy]=vne),V},cp=mQ();Xh?((Xh.exports=cp)._=cp,lA._=cp):Zi._=cp}).call($t)})(oR,oR.exports);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HDe=Ce();HDe.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var ga;(function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"})(ga||(ga={}));var WH;(function(t){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(WH||(WH={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aR={};function jDe(t,e){const n={tfOpName:t,category:"custom",inputs:[],attrs:[],customExecutor:e};aR[t]=n}function GH(t){return aR[t]}function qDe(t){delete aR[t]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $(t,e,n,r,i){const s=e.inputParams[t];if(s&&s.inputIndexStart!==void 0){const a=s.inputIndexStart,l=s.inputIndexEnd===0?void 0:s.inputIndexEnd===void 0?a+1:s.inputIndexEnd;if(s.type==="tensor")return ws(e.inputNames[s.inputIndexStart],n,r,i);if(s.type==="tensors")return e.inputNames.slice(a,l).map(f=>ws(f,n,r,i));const c=ws(e.inputNames.slice(a)[0],n,r,i),u=c.dataSync();return s.type==="number"?u[0]:Eo(c.shape,u)}const o=e.attrParams[t];return o&&o.value}function ws(t,e,n,r){const[i,s]=co(t);if(r!=null){const a=r.getHashTableHandleByName(i);if(a!=null)return a}const o=n.currentContextIds.find(a=>!!e[g2(i,a)]);return o!==void 0?e[g2(i,o)][s]:void 0}function XDe(t,e,n){return e[g2(t,n.currentContextId)]}function Kl(t,e){const[n,r,i]=co(t);return[g2(n,e&&e.currentContextId),r,i]}function g2(t,e){return e?`${t}-${e}`:t}function co(t){const e=t.split(":");if(e.length===1)return[t,0,void 0];const n=e[0],r=e.length===3?e[1]:void 0,i=Number(e[e.length-1]);return[n,i,r]}function v2(t,e,n){let r=$("pad",t,e,n);if(r==="explicit"){r=$("explicitPaddings",t,e,n);const i=[[0,0],[0,0],[0,0],[0,0]];for(let s=0;s<4;s++)i[s][0]=r[s*2],i[s][1]=r[s*2+1];return i}return r}function Gc(t){return t.kept?t:Oc(t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KDe=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}];var YDe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",json:KDe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZDe=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}];var JDe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",json:ZDe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QDe=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]}];var e3e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",json:QDe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t3e=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number"}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}];var n3e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",json:t3e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r3e=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}];var i3e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",json:r3e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s3e=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}];var o3e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",json:s3e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a3e=[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}];var l3e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",json:a3e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c3e=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}];var u3e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",json:c3e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h3e=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}];var f3e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",json:h3e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d3e=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}];var p3e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",json:d3e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m3e=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}];var g3e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",json:m3e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v3e=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}];var y3e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",json:v3e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b3e=[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}];var w3e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",json:b3e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x3e=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}];var _3e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",json:x3e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S3e=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}];var C3e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",json:S3e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T3e=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}];var E3e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",json:T3e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k3e=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}];var A3e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",json:k3e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M3e=[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}];var I3e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",json:M3e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N3e=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}];var $3e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",json:N3e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HH{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[YDe,JDe,e3e,n3e,i3e,o3e,l3e,u3e,f3e,p3e,g3e,y3e,w3e,_3e,C3e,E3e,A3e,I3e,$3e],n=[].concat(...e.map(r=>r.json));this.opMappers=n.reduce((r,i)=>(r[i.tfOpName]=i,r),{})}transformGraph(e,n={}){const r=e.node,i=[],s=[],o=[],a=r.reduce((m,v)=>(m[v.name]=this.mapNode(v),v.op.startsWith("Placeholder")?i.push(m[v.name]):v.op==="Const"?s.push(m[v.name]):(v.input==null||v.input.length===0)&&o.push(m[v.name]),m),{});let l=[];const c=[];let u={},h={};n!=null&&(u=this.mapSignatureEntries(n.inputs),h=this.mapSignatureEntries(n.outputs));const f=Object.keys(a);f.forEach(m=>{const v=a[m];v.inputNames.forEach((y,w)=>{const[x,,_]=Kl(y),S=a[x];if(S.outputs!=null){const T=S.outputs.indexOf(_);if(T!==-1){const E=`${x}:${T}`;v.inputNames[w]=E}}v.inputs.push(S),S.children.push(v)})}),Object.keys(h).length===0?f.forEach(m=>{const v=a[m];v.children.length===0&&c.push(v)}):Object.keys(h).forEach(m=>{const[v]=Kl(m),y=a[v];y!=null&&(y.signatureKey=h[m],c.push(y))}),Object.keys(u).length>0?Object.keys(u).forEach(m=>{const[v]=Kl(m),y=a[v];y&&(y.signatureKey=u[m],l.push(y))}):l=i;let d={};e.library!=null&&e.library.function!=null&&(d=e.library.function.reduce((m,v)=>(m[v.signature.name]=this.mapFunction(v),m),{}));const p={nodes:a,inputs:l,outputs:c,weights:s,placeholders:i,signature:n,functions:d};return o.length>0&&(p.initNodes=o),p}mapSignatureEntries(e){return Object.keys(e||{}).reduce((n,r)=>(n[e[r].name]=r,n),{})}mapNode(e){const n=GH(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});const r={name:e.name,op:e.op,category:n.category,inputNames:(e.input||[]).map(i=>i.startsWith("^")?i.substr(1):i),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:n.outputs};return n.inputs!=null&&(r.inputParams=n.inputs.reduce((i,s)=>(i[s.name]={type:s.type,inputIndexStart:s.start,inputIndexEnd:s.end},i),{})),n.attrs!=null&&(r.attrParams=n.attrs.reduce((i,s)=>{const o=s.type;let a;switch(s.type){case"string":a=lR(e.attr,s.tfName,s.defaultValue),a===void 0&&!!s.tfDeprecatedName&&(a=lR(e.attr,s.tfDeprecatedName,s.defaultValue));break;case"string[]":a=gR(e.attr,s.tfName,s.defaultValue),a===void 0&&!!s.tfDeprecatedName&&(a=gR(e.attr,s.tfDeprecatedName,s.defaultValue));break;case"number":a=uR(e.attr,s.tfName,s.defaultValue||0),a===void 0&&!!s.tfDeprecatedName&&(a=uR(e.attr,s.tfDeprecatedName,s.defaultValue));break;case"number[]":a=mR(e.attr,s.tfName,s.defaultValue),a===void 0&&!!s.tfDeprecatedName&&(a=mR(e.attr,s.tfDeprecatedName,s.defaultValue));break;case"bool":a=cR(e.attr,s.tfName,s.defaultValue),a===void 0&&!!s.tfDeprecatedName&&(a=cR(e.attr,s.tfDeprecatedName,s.defaultValue));break;case"bool[]":a=yR(e.attr,s.tfName,s.defaultValue),a===void 0&&!!s.tfDeprecatedName&&(a=yR(e.attr,s.tfDeprecatedName,s.defaultValue));break;case"shape":a=pR(e.attr,s.tfName,s.defaultValue),a===void 0&&!!s.tfDeprecatedName&&(a=pR(e.attr,s.tfDeprecatedName,s.defaultValue));break;case"shape[]":a=vR(e.attr,s.tfName,s.defaultValue),a===void 0&&!!s.tfDeprecatedName&&(a=vR(e.attr,s.tfDeprecatedName,s.defaultValue));break;case"dtype":a=fR(e.attr,s.tfName,s.defaultValue),a===void 0&&!!s.tfDeprecatedName&&(a=fR(e.attr,s.tfDeprecatedName,s.defaultValue));break;case"dtype[]":a=dR(e.attr,s.tfName,s.defaultValue),a===void 0&&!!s.tfDeprecatedName&&(a=dR(e.attr,s.tfDeprecatedName,s.defaultValue));break;case"func":a=qH(e.attr,s.tfName,s.defaultValue),a===void 0&&!!s.tfDeprecatedName&&(a=qH(e.attr,s.tfDeprecatedName,s.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${s.type} for op: ${e.op}`)}return i[s.name]={value:a,type:o},i},{})),r}mapFunction(e){const n=e.nodeDef,r=[],i=[];let s={};n!=null&&(s=n.reduce((h,f)=>(h[f.name]=this.mapNode(f),f.op==="Const"&&i.push(h[f.name]),h),{}));const o=[],a=[];e.signature.inputArg.forEach(h=>{const[f]=Kl(h.name),d={name:f,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:hR(h.type),type:"dtype"}},children:[]};d.signatureKey=h.name,o.push(d),s[f]=d}),Object.keys(s).forEach(h=>{const f=s[h];f.inputNames.forEach((d,p)=>{const[m,,v]=Kl(d),y=s[m];if(y.outputs!=null){const w=y.outputs.indexOf(v);if(w!==-1){const x=`${m}:${w}`;f.inputNames[p]=x}}f.inputs.push(y),y.children.push(f)})});const c=e.ret;e.signature.outputArg.forEach(h=>{const[f,d]=Kl(c[h.name]),p=s[f];p!=null&&(p.defaultOutput=d,a.push(p))});const u=this.mapArgsToSignature(e);return{nodes:s,inputs:o,outputs:a,weights:i,placeholders:r,signature:u}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((n,r)=>(n[r.name]=this.mapArgToTensorInfo(r),n),{}),outputs:e.signature.outputArg.reduce((n,r)=>(n[r.name]=this.mapArgToTensorInfo(r,e.ret),n),{})}}mapArgToTensorInfo(e,n){let r=e.name;return n!=null&&(r=n[r]),{name:r,dtype:e.type}}}function R3e(t){const e=Ce().global;if(typeof e.atob!="undefined")return e.atob(t);if(typeof Buffer!="undefined")return new Buffer(t,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function jH(t,e){const n=Array.isArray(t)?String.fromCharCode.apply(null,t):R3e(t);return e?n:n.toLowerCase()}function lR(t,e,n,r=!1){const i=t[e];return i!=null?jH(i.s,r):n}function cR(t,e,n){const r=t[e];return r?r.b:n}function uR(t,e,n){const r=t[e]||{},i=r.i!=null?r.i:r.f!=null?r.f:n;return typeof i=="number"?i:parseInt(i,10)}function hR(t){switch(typeof t=="string"&&(t=ga[t]),t){case ga.DT_FLOAT:case ga.DT_HALF:return"float32";case ga.DT_INT32:case ga.DT_INT64:case ga.DT_INT8:case ga.DT_UINT8:return"int32";case ga.DT_BOOL:return"bool";case ga.DT_DOUBLE:return"float32";case ga.DT_STRING:return"string";default:return null}}function qH(t,e,n){const r=t[e];return r&&r.func?r.func.name:n}function fR(t,e,n){const r=t[e];return r&&r.type?hR(r.type):n}function dR(t,e,n){const r=t[e];return r&&r.list&&r.list.type?r.list.type.map(i=>hR(i)):n}function XH(t){if(!t.unknownRank)return t.dim!=null?t.dim.map(e=>typeof e.size=="number"?e.size:parseInt(e.size,10)):[]}function pR(t,e,n){const r=t[e];return r&&r.shape?XH(r.shape):n}function mR(t,e,n){const r=t[e];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map(i=>typeof i=="number"?i:parseInt(i,10)):n}function gR(t,e,n,r=!1){const i=t[e];return i&&i.list&&i.list.s?i.list.s.map(s=>jH(s,r)):n}function vR(t,e,n){const r=t[e];return r&&r.list&&r.list.shape?r.list.shape.map(i=>XH(i)):n}function yR(t,e,n){const r=t[e];return r&&r.list&&r.list.b?r.list.b:n}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D3e{constructor(e,n,r){this.node=e,this.tensorMap=n,this.context=r,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(i=>this.getInput(i)),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce((i,s)=>(i[s]=this.getAttr(s),i),{}))}getInput(e){return ws(e,this.tensorMap,this.context)}getAttr(e,n){const r=this.node.rawAttrs[e];if(r.tensor!=null)return ws(e,this.tensorMap,this.context);if(r.i!=null||r.f!=null)return uR(this.node.rawAttrs,e,n);if(r.s!=null)return lR(this.node.rawAttrs,e,n);if(r.b!=null)return cR(this.node.rawAttrs,e,n);if(r.shape!=null)return pR(this.node.rawAttrs,e,n);if(r.type!=null)return fR(this.node.rawAttrs,e,n);if(r.list!=null){if(r.list.i!=null||r.list.f!=null)return mR(this.node.rawAttrs,e,n);if(r.list.s!=null)return gR(this.node.rawAttrs,e,n);if(r.list.shape!=null)return vR(this.node.rawAttrs,e,n);if(r.list.b!=null)return yR(this.node.rawAttrs,e,n);if(r.list.type!=null)return dR(this.node.rawAttrs,e,n)}return n}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P3e=(t,e,n)=>{switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[Be($("a",t,e,n),$("b",t,e,n))];case"AddN":return[Iz($("tensors",t,e,n))];case"FloorMod":case"Mod":return[c4($("a",t,e,n),$("b",t,e,n))];case"Mul":return[se($("a",t,e,n),$("b",t,e,n))];case"RealDiv":case"Div":return[Tt($("a",t,e,n),$("b",t,e,n))];case"DivNoNan":return[Zz($("a",t,e,n),$("b",t,e,n))];case"FloorDiv":return[gI($("a",t,e,n),$("b",t,e,n))];case"Sub":return[mt($("a",t,e,n),$("b",t,e,n))];case"Minimum":return[U0($("a",t,e,n),$("b",t,e,n))];case"Maximum":return[Bc($("a",t,e,n),$("b",t,e,n))];case"Pow":return[Xu($("a",t,e,n),$("b",t,e,n))];case"SquaredDifference":return[GI($("a",t,e,n),$("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O3e=(t,e,n)=>{switch(t.op){case"Abs":case"ComplexAbs":return[pi($("x",t,e,n))];case"Acos":return[Az($("x",t,e,n))];case"Acosh":return[Mz($("x",t,e,n))];case"Asin":return[$z($("x",t,e,n))];case"Asinh":return[Rz($("x",t,e,n))];case"Atan":return[Dz($("x",t,e,n))];case"Atan2":return[Pz($("x",t,e,n),$("y",t,e,n))];case"Atanh":return[Oz($("x",t,e,n))];case"Ceil":return[Vz($("x",t,e,n))];case"Complex":return[zu($("real",t,e,n),$("imag",t,e,n))];case"Cos":return[AS($("x",t,e,n))];case"Cosh":return[EI($("x",t,e,n))];case"Elu":return[z0($("x",t,e,n))];case"Erf":return[Qz($("x",t,e,n))];case"Exp":return[Mo($("x",t,e,n))];case"Expm1":return[e4($("x",t,e,n))];case"Floor":return[V0($("x",t,e,n))];case"Log":return[$o($("x",t,e,n))];case"Log1p":return[NS($("x",t,e,n))];case"Imag":return[MS($("x",t,e,n))];case"Neg":return[$r($("x",t,e,n))];case"Reciprocal":return[b4($("x",t,e,n))];case"Real":return[W0($("x",t,e,n))];case"Relu":return[Ul($("x",t,e,n))];case"Round":return[FI($("x",t,e,n))];case"Selu":return[BI($("x",t,e,n))];case"Sigmoid":return[Bl($("x",t,e,n))];case"Sin":return[zI($("x",t,e,n))];case"Sign":return[_4($("x",t,e,n))];case"Sinh":return[VI($("x",t,e,n))];case"Softplus":return[Nm($("x",t,e,n))];case"Sqrt":return[es($("x",t,e,n))];case"Square":return[nr($("x",t,e,n))];case"Tanh":return[km($("x",t,e,n))];case"Tan":return[C4($("x",t,e,n))];case"ClipByValue":return[ro($("x",t,e,n),$("clipValueMin",t,e,n),$("clipValueMax",t,e,n))];case"Relu6":return[OI($("x",t,e,n))];case"Rsqrt":return[LI(ws(t.inputNames[0],e,n))];case"Prod":return[DI($("x",t,e,n),$("axes",t,e,n))];case"LeakyRelu":return[IS($("x",t,e,n),$("alpha",t,e,n))];case"Prelu":return[LS($("x",t,e,n),$("alpha",t,e,n))];case"IsNan":return[t4(ws(t.inputNames[0],e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function va(t,e,n=""){if(!(typeof t=="number"||typeof e=="number")){z(t.length===e.length,()=>n+` Shapes ${t} and ${e} must match`);for(let r=0;r<t.length;r++){const i=t[r],s=e[r];z(i<0||s<0||i===s,()=>n+` Shapes ${t} and ${e} must match`)}}}function KH(t){return!(typeof t=="number"||t.some(e=>e<0))}function $b(t,e,n){let r=bR(t,n);const i=!KH(r);if(i&&e.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${r}`);if(i&&e.forEach(s=>{r=bR(s.shape,r)}),!KH(r))throw new Error(`Non-fully-defined elementShape: ${r}`);return r}function bR(t,e){if(typeof t=="number")return e;if(typeof e=="number")return t;if(t.length!==e.length)throw new Error(`Incompatible ranks during merge: ${t} vs. ${e}`);const n=[];for(let r=0;r<t.length;++r){const i=t[r],s=e[r];if(i>=0&&s>=0&&i!==s)throw new Error(`Incompatible shape during merge: ${t} vs. ${e}`);n[r]=i>=0?i:s}return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class F3e{constructor(e,n,r,i,s,o,a){this.name=e,this.dtype=n,this.maxSize=r,this.elementShape=i,this.identicalElementShapes=s,this.dynamicSize=o,this.clearAfterRead=a,this.tensors=[],this.closed_=!1,this.idTensor=Nt(0),Tr(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(n=>{(e==null||!e.has(n.tensor.id))&&n.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);const n=this.tensors[e];if(n.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(n.cleared=!0),n.read=!0,n.tensor}readMany(e){return e.map(n=>this.read(n))}write(e,n){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);const r=this.tensors[e]||{};if(n.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},
          because the value dtype is ${n.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=n.shape),va(this.elementShape,n.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),r.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(r.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);r.tensor=n,Tr(n),r.written=!0,this.tensors[e]=r}writeMany(e,n){if(e.length!==n.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${n.length}.`);e.forEach((r,i)=>this.write(r,n[i]))}gather(e,n){if(!!n&&n!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${n}`);if(e)e=e.slice(0,this.size());else{e=[];for(let i=0;i<this.size();i++)e.push(i)}if(e.length===0)return to([],[0].concat(this.elementShape));const r=this.readMany(e);return va(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),ha(r,0)}concat(e){if(!!e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(this.size()===0)return to([],[0].concat(this.elementShape));const n=[];for(let i=0;i<this.size();i++)n.push(i);const r=this.readMany(n);return va(this.elementShape,r[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${r[0].shape})`),ii(r,0)}scatter(e,n){if(n.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${n.dtype}`);if(e.length!==n.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${n.shape[0]}`);const r=Math.max(...e);if(!this.dynamicSize&&r>=this.maxSize)throw new Error(`Max index must be < array size (${r}  vs. ${this.maxSize})`);this.writeMany(e,Qa(n,0))}split(e,n){if(n.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${n.dtype}`);let r=0;const i=e.map(l=>(r+=l,r));if(r!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${r}, and tensor's shape is: ${n.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);const s=r===0?0:n.size/r,o=[];de(()=>{n=fe(n,[1,r,s]);for(let l=0;l<e.length;++l){const c=l===0?0:i[l-1],u=[0,c,0],h=[1,e[l],s];o[l]=fe(Cn(n,u,h),this.elementShape)}return o});const a=[];for(let l=0;l<e.length;l++)a[l]=l;this.writeMany(a,o)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gg{constructor(e,n,r,i=-1){this.tensors=e,this.elementShape=n,this.elementDtype=r,e!=null&&e.forEach(s=>{if(r!==s.dtype)throw new Error(`Invalid data types; op elements ${r}, but list elements ${s.dtype}`);va(n,s.shape,"TensorList shape mismatch: "),Tr(s)}),this.idTensor=Nt(0),this.maxNumElements=i,Tr(this.idTensor)}get id(){return this.idTensor.id}copy(){return new gg([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach(n=>{(e==null||!e.has(n.id))&&n.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,n,r=-1){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(r!==-1&&this.tensors.length!==r)throw new Error(`Operation expected a list with ${r} elements but got a list with ${this.tensors.length} elements.`);va(e,this.elementShape,"TensorList shape mismatch: ");const i=$b(this.elementShape,this.tensors,e);return de(()=>{const s=this.tensors.map(o=>fe(o,i));return ha(s,0)})}popBack(e,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");const r=$b(this.elementShape,this.tensors,e),i=this.tensors.pop();return va(i.shape,e,"TensorList shape mismatch: "),fe(i,r)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(va(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Tr(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${e}`);if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);this.tensors.length=e}getItem(e,n,r){if(r!==this.elementDtype)throw new Error(`Invalid data types; op elements ${r}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw new Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(this.tensors[e]==null)throw new Error(`element at index ${e} is null.`);va(this.tensors[e].shape,n,"TensorList shape mismatch: ");const i=$b(this.elementShape,this.tensors,n);return fe(this.tensors[e],i)}setItem(e,n){if(n.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${this.elementDtype}`);if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);va(this.elementShape,n.shape,"TensorList shape mismatch: "),Tr(n),this.tensors[e]=n}gather(e,n,r){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);va(this.elementShape,r,"TensorList shape mismatch: "),e=e.slice(0,this.size());const i=$b(this.elementShape,this.tensors,r);return e.length===0?to([],[0].concat(i)):de(()=>{const s=e.map(o=>fe(this.tensors[o],i));return ha(s,0)})}concat(e,n){if(!!e&&e!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);va(this.elementShape,n,"TensorList shape mismatch: ");const r=$b(this.elementShape,this.tensors,n);return this.size()===0?to([],[0].concat(r)):de(()=>{const i=this.tensors.map(s=>fe(s,r));return ii(i,0)})}}function L3e(t,e,n){const r=t.dtype;if(t.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${t.shape}`);if(t.dtype!==n)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${n}`);const i=t.shape.slice(1);va(i,e,"TensorList shape mismatch: ");const s=Qa(t);return new gg(s,e,r)}function B3e(t,e,n){return new gg([],t,e,n)}function z3e(t,e,n,r){if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const i=Math.max(...e);if(r!=null&&r!==-1&&i>=r)throw new Error(`Max index must be < array size (${i}  vs. ${r})`);const s=new gg([],n,t.dtype,r),o=Qa(t,0);return e.forEach((a,l)=>{s.setItem(a,o[l])}),s}function V3e(t,e,n){let r=0;const i=e.map(u=>(r+=u,r));if(r!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${r}, and tensor's shape is: ${t.shape}`);const s=t.shape.slice(1),o=bR(s,n),a=r===0?0:t.size/r,l=de(()=>{const u=[];t=fe(t,[1,r,a]);for(let h=0;h<e.length;++h){const f=h===0?0:i[h-1],d=[0,f,0],p=[1,e[h],a];u[h]=fe(Cn(t,d,p),o)}return t.dispose(),u}),c=new gg([],n,t.dtype,e.length);for(let u=0;u<l.length;u++)c.setItem(u,l[u]);return c}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U3e=async(t,e,n)=>{switch(t.op){case"If":case"StatelessIf":{const r=$("thenBranch",t,e,n),i=$("elseBranch",t,e,n),s=$("cond",t,e,n),o=$("args",t,e,n);return(await s.data())[0]?n.functionMap[r].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap):n.functionMap[i].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const r=$("body",t,e,n),i=$("cond",t,e,n),s=$("args",t,e,n),o=await n.functionMap[i].executeFunctionAsync(s,n.tensorArrayMap,n.tensorListMap),a=s.map(u=>u.id);let l=await o[0].data();o.forEach(u=>{!u.kept&&a.indexOf(u.id)===-1&&u.dispose()});let c=s;for(;l[0];){const u=c;c=await n.functionMap[r].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);const h=c.map(d=>d.id);u.forEach(d=>{!d.kept&&a.indexOf(d.id)===-1&&h.indexOf(d.id)===-1&&d.dispose()});const f=await n.functionMap[i].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);l=await f[0].data(),f.forEach(d=>{!d.kept&&a.indexOf(d.id)===-1&&h.indexOf(d.id)===-1&&d.dispose()})}return c}case"LoopCond":{const r=$("pred",t,e,n);return[Gc(r)]}case"Switch":{const r=$("pred",t,e,n);let i=$("data",t,e,n);return i.kept||(i=Gc(i)),(await r.data())[0]?[void 0,i]:[i,void 0]}case"Merge":{const r=t.inputNames.find(i=>ws(i,e,n)!==void 0);if(r){const i=ws(r,e,n);return[Gc(i)]}return}case"Enter":{const r=$("frameName",t,e,n),i=$("tensor",t,e,n);return n.enterFrame(r),[Gc(i)]}case"Exit":{const r=$("tensor",t,e,n);return n.exitFrame(),[Gc(r)]}case"NextIteration":{const r=$("tensor",t,e,n);return n.nextIteration(),[Gc(r)]}case"TensorArrayV3":{const r=$("size",t,e,n),i=$("dtype",t,e,n),s=$("elementShape",t,e,n),o=$("dynamicSize",t,e,n),a=$("clearAfterRead",t,e,n),l=$("identicalElementShapes",t,e,n),c=$("name",t,e,n),u=new F3e(c,i,r,s,l,o,a);return n.addTensorArray(u),[u.idTensor,Nt(1)]}case"TensorArrayWriteV3":{const r=$("tensorArrayId",t,e,n),i=$("index",t,e,n),s=$("tensor",t,e,n),o=n.getTensorArray(r.id);return o.write(i,s),[o.idTensor]}case"TensorArrayReadV3":{const r=$("tensorArrayId",t,e,n),i=$("index",t,e,n);return[n.getTensorArray(r.id).read(i)]}case"TensorArrayGatherV3":{const r=$("tensorArrayId",t,e,n),i=$("indices",t,e,n),s=$("dtype",t,e,n);return[n.getTensorArray(r.id).gather(i,s)]}case"TensorArrayScatterV3":{const r=$("tensorArrayId",t,e,n),i=$("indices",t,e,n),s=$("tensor",t,e,n),o=n.getTensorArray(r.id);return o.scatter(i,s),[o.idTensor]}case"TensorArrayConcatV3":{const r=$("tensorArrayId",t,e,n),i=n.getTensorArray(r.id),s=$("dtype",t,e,n);return[i.concat(s)]}case"TensorArraySplitV3":{const r=$("tensorArrayId",t,e,n),i=$("tensor",t,e,n),s=$("lengths",t,e,n),o=n.getTensorArray(r.id);return o.split(s,i),[o.idTensor]}case"TensorArraySizeV3":{const r=$("tensorArrayId",t,e,n),i=n.getTensorArray(r.id);return[Nt(i.size(),"int32")]}case"TensorArrayCloseV3":{const r=$("tensorArrayId",t,e,n),i=n.getTensorArray(r.id);return i.clearAndClose(),[i.idTensor]}case"TensorListSetItem":{const r=$("tensorListId",t,e,n),i=$("index",t,e,n),s=$("tensor",t,e,n),o=n.getTensorList(r.id);return o.setItem(i,s),[o.idTensor]}case"TensorListGetItem":{const r=$("tensorListId",t,e,n),i=$("index",t,e,n),s=$("elementShape",t,e,n),o=$("elementDType",t,e,n);return[n.getTensorList(r.id).getItem(i,s,o)]}case"TensorListScatterV2":case"TensorListScatter":{const r=$("indices",t,e,n),i=$("tensor",t,e,n),s=$("elementShape",t,e,n),o=$("numElements",t,e,n),a=z3e(i,r,s,o);return n.addTensorList(a),[a.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const r=$("elementShape",t,e,n),i=$("elementDType",t,e,n);let s;t.op==="TensorListReserve"?s="numElements":s="maxNumElements";const o=$(s,t,e,n),a=B3e(r,i,o);return n.addTensorList(a),[a.idTensor]}case"TensorListGather":{const r=$("tensorListId",t,e,n),i=$("indices",t,e,n),s=$("elementShape",t,e,n),o=$("elementDType",t,e,n);return[n.getTensorList(r.id).gather(i,o,s)]}case"TensorListStack":{const r=$("tensorListId",t,e,n),i=$("elementShape",t,e,n),s=$("elementDType",t,e,n),o=$("numElements",t,e,n);return[n.getTensorList(r.id).stack(i,s,o)]}case"TensorListFromTensor":{const r=$("tensor",t,e,n),i=$("elementShape",t,e,n),s=$("elementDType",t,e,n),o=L3e(r,i,s);return n.addTensorList(o),[o.idTensor]}case"TensorListConcat":{const r=$("tensorListId",t,e,n),i=n.getTensorList(r.id),s=$("dtype",t,e,n),o=$("elementShape",t,e,n);return[i.concat(s,o)]}case"TensorListPushBack":{const r=$("tensorListId",t,e,n),i=$("tensor",t,e,n),s=n.getTensorList(r.id);return s.pushBack(i),[s.idTensor]}case"TensorListPopBack":{const r=$("tensorListId",t,e,n),i=$("elementShape",t,e,n),s=$("elementDType",t,e,n);return[n.getTensorList(r.id).popBack(i,s)]}case"TensorListSplit":{const r=$("tensor",t,e,n),i=$("elementShape",t,e,n),s=$("lengths",t,e,n),o=V3e(r,s,i);return n.addTensorList(o),[o.idTensor]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YH(t,e,n){const[r,i]=$("fusedOps",t,e,n),s=r==="biasadd",o=!s,a=i==="prelu",l=r==="fusedbatchnorm",c=$("numArgs",t,e,n);if(s){if(a&&c!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&s&&c!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const u=$("strides",t,e,n),h=v2(t,e,n),f=$("dataFormat",t,e,n).toUpperCase(),d=$("dilations",t,e,n);let[p,m]=$("args",t,e,n);o&&(m=p,p=void 0);const v=$("leakyreluAlpha",t,e,n);return{stride:u,pad:h,dataFormat:f,dilations:d,biasArg:p,preluArg:m,activationFunc:i,leakyreluAlpha:v}}const W3e=(t,e,n)=>{switch(t.op){case"Conv1D":{const r=$("stride",t,e,n),i=$("pad",t,e,n),s=$("dataFormat",t,e,n).toUpperCase(),o=$("dilation",t,e,n);return[_I($("x",t,e,n),$("filter",t,e,n),r,i,s,o)]}case"Conv2D":{const r=$("strides",t,e,n),i=v2(t,e,n),s=$("dataFormat",t,e,n).toUpperCase(),o=$("dilations",t,e,n);return[ju($("x",t,e,n),$("filter",t,e,n),[r[1],r[2]],i,s,[o[1],o[2]])]}case"_FusedConv2D":{const{stride:r,pad:i,dataFormat:s,dilations:o,biasArg:a,preluArg:l,activationFunc:c,leakyreluAlpha:u}=YH(t,e,n);return[ZI({x:$("x",t,e,n),filter:$("filter",t,e,n),strides:[r[1],r[2]],pad:i,dataFormat:s,dilations:[o[1],o[2]],bias:a,activation:c,preluActivationWeights:l,leakyreluAlpha:u})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:i,dataFormat:s,dilations:o,biasArg:a,preluArg:l,activationFunc:c,leakyreluAlpha:u}=YH(t,e,n);return[P4({x:$("x",t,e,n),filter:$("filter",t,e,n),strides:[r[1],r[2]],pad:i,dataFormat:s,dilations:[o[1],o[2]],bias:a,activation:c,preluActivationWeights:l,leakyreluAlpha:u})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=$("outputShape",t,e,n),i=$("strides",t,e,n),s=v2(t,e,n);return[CI($("x",t,e,n),$("filter",t,e,n),r,[i[1],i[2]],s)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=$("strides",t,e,n),i=v2(t,e,n),s=$("dilations",t,e,n),o=$("dataFormat",t,e,n).toUpperCase();return[B0($("input",t,e,n),$("filter",t,e,n),[r[1],r[2]],i,o,[s[1],s[2]])]}case"Conv3D":{const r=$("strides",t,e,n),i=$("pad",t,e,n),s=$("dataFormat",t,e,n).toUpperCase(),o=$("dilations",t,e,n);return[TI($("x",t,e,n),$("filter",t,e,n),[r[1],r[2],r[3]],i,s,[o[1],o[2],o[3]])]}case"AvgPool":{const r=$("strides",t,e,n),i=$("pad",t,e,n),s=$("kernelSize",t,e,n);return[ES($("x",t,e,n),[s[1],s[2]],[r[1],r[2]],i)]}case"MaxPool":{const r=$("strides",t,e,n),i=$("pad",t,e,n),s=$("kernelSize",t,e,n);return[DS($("x",t,e,n),[s[1],s[2]],[r[1],r[2]],i)]}case"MaxPoolWithArgmax":{const r=$("strides",t,e,n),i=$("pad",t,e,n),s=$("kernelSize",t,e,n),o=$("includeBatchInIndex",t,e,n),{result:a,indexes:l}=a4($("x",t,e,n),[s[1],s[2]],[r[1],r[2]],i,o);return[a,l]}case"AvgPool3D":{const r=$("strides",t,e,n),i=$("pad",t,e,n),s=$("kernelSize",t,e,n);return[wI($("x",t,e,n),[s[1],s[2],s[3]],[r[1],r[2],r[3]],i)]}case"MaxPool3D":{const r=$("strides",t,e,n),i=$("pad",t,e,n),s=$("kernelSize",t,e,n);return[RI($("x",t,e,n),[s[1],s[2],s[3]],[r[1],r[2],r[3]],i)]}case"Dilation2D":{const r=$("strides",t,e,n),i=$("pad",t,e,n),s=$("dilations",t,e,n),o=r[1],a=r[2],l=s[1],c=s[2];return[Yz($("x",t,e,n),$("filter",t,e,n),[o,a],i,[l,c],"NHWC")]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G3e=(t,e,n)=>{switch(t.op){case"Fill":{const r=$("shape",t,e,n),i=$("dtype",t,e,n),s=$("value",t,e,n);return[Mm(r,s,i)]}case"LinSpace":{const r=$("start",t,e,n),i=$("stop",t,e,n),s=$("num",t,e,n);return[n4(r,i,s)]}case"Multinomial":{const r=$("logits",t,e,n),i=$("numSamples",t,e,n),s=$("seed",t,e,n);return[u4(r,i,s)]}case"OneHot":{const r=$("indices",t,e,n),i=$("depth",t,e,n),s=$("onValue",t,e,n),o=$("offValue",t,e,n);return[O0(r,i,s,o)]}case"Ones":return[io($("shape",t,e,n),$("dtype",t,e,n))];case"OnesLike":return[Ro($("x",t,e,n))];case"RandomUniform":return[Dm($("shape",t,e,n),$("minval",t,e,n),$("maxval",t,e,n),$("dtype",t,e,n))];case"Range":{const r=$("start",t,e,n),i=$("stop",t,e,n),s=$("step",t,e,n);return[Pm(r,i,s,$("dtype",t,e,n))]}case"TruncatedNormal":{const r=$("shape",t,e,n),i=$("mean",t,e,n),s=$("stdDev",t,e,n),o=$("seed",t,e,n);return[GS(r,i,s,$("dtype",t,e,n),o)]}case"Zeros":return[zr($("shape",t,e,n),$("dtype",t,e,n))];case"ZerosLike":return[In($("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wR(t,e,n){const r=$("boxes",t,e,n),i=$("scores",t,e,n),s=$("maxOutputSize",t,e,n),o=$("iouThreshold",t,e,n),a=$("scoreThreshold",t,e,n),l=$("softNmsSigma",t,e,n);return{boxes:r,scores:i,maxOutputSize:s,iouThreshold:o,scoreThreshold:a,softNmsSigma:l}}const H3e=async(t,e,n)=>{switch(t.op){case"NonMaxSuppressionV5":{const{boxes:r,scores:i,maxOutputSize:s,iouThreshold:o,scoreThreshold:a,softNmsSigma:l}=wR(t,e,n),c=await Po.nonMaxSuppressionWithScoreAsync(r,i,s,o,a,l);return[c.selectedIndices,c.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:r,scores:i,maxOutputSize:s,iouThreshold:o,scoreThreshold:a}=wR(t,e,n),l=$("padToMaxOutputSize",t,e,n),c=await Po.nonMaxSuppressionPaddedAsync(r,i,s,o,a,l);return[c.selectedIndices,c.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:r,scores:i,maxOutputSize:s,iouThreshold:o,scoreThreshold:a}=wR(t,e,n);return[await Po.nonMaxSuppressionAsync(r,i,s,o,a)]}case"Where":{const r=Qe($("condition",t,e,n),"bool"),i=[await jI(r)];return r.dispose(),i}case"ListDiff":return x4($("x",t,e,n),$("y",t,e,n));default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j3e=(t,e,n)=>{switch(t.op){case"TopKV2":{const r=$("x",t,e,n),i=$("k",t,e,n),s=$("sorted",t,e,n),o=T4(r,i,s);return[o.values,o.indices]}case"Unique":{const r=$("x",t,e,n),i=HI(r);return[i.values,i.indices]}case"UniqueV2":{const r=$("x",t,e,n),i=$("axis",t,e,n),s=HI(r,i);return[s.values,s.indices]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q3e=(t,e,n)=>{switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":const r=$("default",t,e,n);return[ws(t.name,e,n)||r];case"Placeholder":return[ws(t.name,e,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{const c=$("x",t,e,n);return[Gc(c)]}case"IdentityN":return $("x",t,e,n).map(c=>Gc(c));case"Snapshot":const i=$("x",t,e,n);return[Gc(i)];case"Shape":return[ts($("x",t,e,n).shape,"int32")];case"ShapeN":return $("x",t,e,n).map(c=>ts(c.shape));case"Size":return[Nt($("x",t,e,n).size,"int32")];case"Rank":return[Nt($("x",t,e,n).rank,"int32")];case"NoOp":return[Nt(1)];case"Print":const s=$("x",t,e,n),o=$("data",t,e,n),a=$("message",t,e,n),l=$("summarize",t,e,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(a);for(let c=0;c<o.length;c++)console.log(Array.prototype.slice.call(o[c].dataSync()).slice(0,l));return[s];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class X3e{constructor(e,n){this.keyDType=e,this.valueDType=n,this.handle=Nt(0),this.tensorMap=new Map,Tr(this.handle)}get id(){return this.handle.id}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return Nt(this.size(),"int32")}async import(e,n){this.checkKeyAndValueTensor(e,n);const r=await e.data();return this.tensorMap.forEach(i=>i.dispose()),this.tensorMap.clear(),de(()=>{const i=Qa(n),s=r.length,o=i.length;z(s===o,()=>`The number of elements doesn't match, keys has ${s} elements, the values has ${o} elements.`);for(let a=0;a<s;a++){const l=r[a],c=i[a];Tr(c),this.tensorMap.set(l,c)}return this.handle})}async find(e,n){this.checkKeyAndValueTensor(e,n);const r=await e.data();return de(()=>{const i=[];for(let s=0;s<r.length;s++){const o=r[s],a=this.findWithDefault(o,n);i.push(a)}return ha(i)})}findWithDefault(e,n){const r=this.tensorMap.get(e);return r!=null?r:n}checkKeyAndValueTensor(e,n){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(n.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${n.dtype}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K3e=async(t,e,n,r)=>{switch(t.op){case"HashTable":case"HashTableV2":{const i=$("keyDType",t,e,n),s=$("valueDType",t,e,n),o=new X3e(i,s);return r.addHashTable(t.name,o),[o.handle]}case"LookupTableImport":case"LookupTableImportV2":{const i=$("tableHandle",t,e,n,r),s=$("keys",t,e,n),o=$("values",t,e,n);return[await r.getHashTableById(i.id).import(s,o)]}case"LookupTableFind":case"LookupTableFindV2":{const i=$("tableHandle",t,e,n,r),s=$("keys",t,e,n),o=$("defaultValue",t,e,n);return[await r.getHashTableById(i.id).find(s,o)]}case"LookupTableSize":case"LookupTableSizeV2":{const i=$("tableHandle",t,e,n,r);return[r.getHashTableById(i.id).tensorSize()]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y3e=(t,e,n)=>{switch(t.op){case"ResizeBilinear":{const r=$("images",t,e,n),i=$("size",t,e,n),s=$("alignCorners",t,e,n),o=$("halfPixelCenters",t,e,n);return[Po.resizeBilinear(r,[i[0],i[1]],s,o)]}case"ResizeNearestNeighbor":{const r=$("images",t,e,n),i=$("size",t,e,n),s=$("alignCorners",t,e,n),o=$("halfPixelCenters",t,e,n);return[Po.resizeNearestNeighbor(r,[i[0],i[1]],s,o)]}case"CropAndResize":{const r=$("image",t,e,n),i=$("boxes",t,e,n),s=$("boxInd",t,e,n),o=$("cropSize",t,e,n),a=$("method",t,e,n),l=$("extrapolationValue",t,e,n);return[Po.cropAndResize(r,i,s,o,a,l)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z3e=(t,e,n)=>{switch(t.op){case"Equal":return[Za($("a",t,e,n),$("b",t,e,n))];case"NotEqual":return[Rm($("a",t,e,n),$("b",t,e,n))];case"Greater":return[No($("a",t,e,n),$("b",t,e,n))];case"GreaterEqual":return[xf($("a",t,e,n),$("b",t,e,n))];case"Less":return[MI($("a",t,e,n),$("b",t,e,n))];case"LessEqual":return[_f($("a",t,e,n),$("b",t,e,n))];case"LogicalAnd":return[Vl($("a",t,e,n),$("b",t,e,n))];case"LogicalNot":return[RS($("a",t,e,n))];case"LogicalOr":return[$I($("a",t,e,n),$("b",t,e,n))];case"Select":case"SelectV2":return[Bs($("condition",t,e,n),$("a",t,e,n),$("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J3e=(t,e,n)=>{switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[gn($("a",t,e,n),$("b",t,e,n),$("transposeA",t,e,n),$("transposeB",t,e,n))];case"Einsum":return[Jz($("equation",t,e,n),...$("tensors",t,e,n))];case"Transpose":return[Mn($("x",t,e,n),$("perm",t,e,n))];case"_FusedMatMul":const[r,i]=$("fusedOps",t,e,n),s=r==="biasadd",o=i==="prelu",a=$("numArgs",t,e,n),l=$("leakyreluAlpha",t,e,n);if(s){if(o&&a!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!o&&a!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[c,u]=$("args",t,e,n);return[YS({a:$("a",t,e,n),b:$("b",t,e,n),transposeA:$("transposeA",t,e,n),transposeB:$("transposeB",t,e,n),bias:c,activation:i,preluActivationWeights:u,leakyreluAlpha:l})];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q3e=(t,e,n)=>{switch(t.op){case"FusedBatchNorm":case"FusedBatchNormV2":return[Am($("x",t,e,n),$("mean",t,e,n),$("variance",t,e,n),$("offset",t,e,n),$("scale",t,e,n),$("epsilon",t,e,n))];case"FusedBatchNormV3":return[Am($("x",t,e,n),$("mean",t,e,n),$("variance",t,e,n),$("offset",t,e,n),$("scale",t,e,n),$("epsilon",t,e,n))];case"LRN":return[r4($("x",t,e,n),$("radius",t,e,n),$("bias",t,e,n),$("alpha",t,e,n),$("beta",t,e,n))];case"Softmax":return[H0($("x",t,e,n))];case"LogSoftmax":return[II($("x",t,e,n))];case"SparseToDense":return[XI($("sparseIndices",t,e,n),$("outputShape",t,e,n),$("sparseValues",t,e,n),$("defaultValue",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ePe=(t,e,n)=>{switch(t.op){case"Max":{const o=$("axis",t,e,n),a=$("keepDims",t,e,n);return[Ja($("x",t,e,n),o,a)]}case"Mean":{const o=$("axis",t,e,n),a=$("keepDims",t,e,n);return[Br($("x",t,e,n),o,a)]}case"Min":{const o=$("axis",t,e,n),a=$("keepDims",t,e,n);return[PS($("x",t,e,n),o,a)]}case"Sum":{const o=$("axis",t,e,n),a=$("keepDims",t,e,n);return[xt($("x",t,e,n),o,a)]}case"All":{const o=$("axis",t,e,n),a=$("keepDims",t,e,n);return[vI($("x",t,e,n),o,a)]}case"Any":{const o=$("axis",t,e,n),a=$("keepDims",t,e,n);return[CS($("x",t,e,n),o,a)]}case"ArgMax":{const o=$("axis",t,e,n);return[Tm($("x",t,e,n),o)]}case"ArgMin":{const o=$("axis",t,e,n);return[Nz($("x",t,e,n),o)]}case"Prod":{const o=$("axis",t,e,n),a=$("keepDims",t,e,n);return[DI($("x",t,e,n),o,a)]}case"Cumsum":{const o=$("axis",t,e,n),a=$("exclusive",t,e,n),l=$("reverse",t,e,n);return[kI($("x",t,e,n),o,a,l)]}case"Bincount":const r=$("x",t,e,n),i=$("weights",t,e,n),s=$("size",t,e,n);return[xI(r,i,s)];case"DenseBincount":{const o=$("x",t,e,n),a=$("weights",t,e,n),l=$("size",t,e,n),c=$("binaryOutput",t,e,n);return[Xz(o,a,l,c)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tPe=(t,e,n)=>{switch(t.op){case"ConcatV2":case"Concat":{const r=$("n",t,e,n),i=$("axis",t,e,n);let s=$("tensors",t,e,n);return s=s.slice(0,r),[ii(s,i)]}case"Gather":{const r=$("x",t,e,n),i=$("indices",t,e,n);return[Im(r,Qe(i,"int32"),0)]}case"GatherV2":{const r=$("axis",t,e,n),i=$("batchDims",t,e,n),s=$("x",t,e,n),o=$("indices",t,e,n);return[Im(s,Qe(o,"int32"),r,i)]}case"Reverse":{const r=$("dims",t,e,n),i=[];for(let o=0;o<r.length;o++)r[o]&&i.push(o);const s=$("x",t,e,n);return[Do(s,i)]}case"ReverseV2":{const r=$("axis",t,e,n),i=$("x",t,e,n);return[Do(i,r)]}case"Slice":{const r=$("begin",t,e,n),i=$("size",t,e,n);return[Cn($("x",t,e,n),r,i)]}case"StridedSlice":{const r=$("begin",t,e,n),i=$("end",t,e,n),s=$("strides",t,e,n),o=$("beginMask",t,e,n),a=$("endMask",t,e,n),l=$("ellipsisMask",t,e,n),c=$("newAxisMask",t,e,n),u=$("shrinkAxisMask",t,e,n),h=$("x",t,e,n);return[S4(h,r,i,s,o,a,l,c,u)]}case"Pack":return de(()=>{const r=$("axis",t,e,n),i=$("tensors",t,e,n),s=i[0].shape,o=Wl(i[0]).shape,a=i.map(l=>{const c=wn(l.shape,s);if(!c&&!wn(Wl(l).shape,o))throw new Error("the input tensors shape does not match");return c?l:fe(l,s)});return[ha(a,r)]});case"Unpack":{const r=$("axis",t,e,n),i=$("tensor",t,e,n);return Qa(i,r)}case"Tile":{const r=$("reps",t,e,n);return[ua($("x",t,e,n),r)]}case"Split":case"SplitV":{const r=$("axis",t,e,n),i=$("numOrSizeSplits",t,e,n),s=$("x",t,e,n);return so(s,i,r)}case"ScatterNd":{const r=$("indices",t,e,n),i=$("values",t,e,n),s=$("shape",t,e,n);return[M4(r,i,s)]}case"GatherNd":{const r=$("x",t,e,n),i=$("indices",t,e,n);return[I4(r,i)]}case"SparseToDense":{const r=$("sparseIndices",t,e,n),i=$("outputShape",t,e,n),s=$("sparseValues",t,e,n),o=$("defaultValue",t,e,n);return[XI(r,s,i,s.dtype===o.dtype?o:Qe(o,s.dtype))]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nPe=(t,e,n)=>{switch(t.op){case"SparseFillEmptyRows":{const{outputIndices:r,outputValues:i,emptyRowIndicator:s,reverseIndexMap:o}=X0.sparseFillEmptyRows($("indices",t,e,n),$("values",t,e,n),$("denseShape",t,e,n),$("defaultValue",t,e,n));return[r,i,s,o]}case"SparseReshape":{const{outputIndices:r,outputShape:i}=X0.sparseReshape($("inputIndices",t,e,n),$("inputShape",t,e,n),$("newShape",t,e,n));return[r,i]}case"SparseSegmentMean":return[X0.sparseSegmentMean($("data",t,e,n),$("indices",t,e,n),$("segmentIds",t,e,n))];case"SparseSegmentSum":return[X0.sparseSegmentSum($("data",t,e,n),$("indices",t,e,n),$("segmentIds",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rPe=(t,e,n)=>{switch(t.op){case"FFT":return[US($("x",t,e,n))];case"IFFT":return[j0($("x",t,e,n))];case"RFFT":return[WS($("x",t,e,n))];case"IRFFT":return[WI($("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iPe=(t,e,n)=>{switch(t.op){case"StringNGrams":{const{nGrams:r,nGramsSplits:i}=eC.stringNGrams($("data",t,e,n),$("dataSplits",t,e,n),$("separator",t,e,n),$("nGramWidths",t,e,n),$("leftPad",t,e,n),$("rightPad",t,e,n),$("padWidth",t,e,n),$("preserveShortSequences",t,e,n));return[r,i]}case"StringSplit":{const{indices:r,values:i,shape:s}=eC.stringSplit($("input",t,e,n),$("delimiter",t,e,n),$("skipEmpty",t,e,n));return[r,i,s]}case"StringToHashBucketFast":return[eC.stringToHashBucketFast($("input",t,e,n),$("numBuckets",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sPe=(t,e,n)=>{switch(t.op){case"Cast":return[Qe($("x",t,e,n),$("dtype",t,e,n))];case"ExpandDims":{const r=$("axis",t,e,n);return[Io($("x",t,e,n),r)]}case"Squeeze":{const r=$("axis",t,e,n);return[Wl($("x",t,e,n),r)]}case"Reshape":return[fe($("x",t,e,n),$("shape",t,e,n))];case"MirrorPad":return[l4($("x",t,e,n),$("padding",t,e,n),$("mode",t,e,n))];case"PadV2":case"Pad":return[qu($("x",t,e,n),$("padding",t,e,n),$("constantValue",t,e,n))];case"SpaceToBatchND":{const r=$("blockShape",t,e,n),i=$("paddings",t,e,n);return[FS($("x",t,e,n),r,i)]}case"BatchToSpaceND":{const r=$("blockShape",t,e,n),i=$("crops",t,e,n);return[kS($("x",t,e,n),r,i)]}case"DepthToSpace":{const r=$("blockSize",t,e,n),i=$("dataFormat",t,e,n).toUpperCase();return[Kz($("x",t,e,n),r,i)]}case"BroadcastTo":return[L0($("x",t,e,n),$("shape",t,e,n))];case"BroadcastArgs":return[zz($("s0",t,e,n),$("s1",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZH(t,e,n,r){const i=((s,o,a)=>{switch(s.category){case"arithmetic":return de(()=>P3e(s,o,a));case"basic_math":return de(()=>O3e(s,o,a));case"control":return U3e(s,o,a);case"convolution":return de(()=>W3e(s,o,a));case"creation":return de(()=>G3e(s,o,a));case"dynamic":return H3e(s,o,a);case"evaluation":return de(()=>j3e(s,o,a));case"image":return de(()=>Y3e(s,o,a));case"graph":return de(()=>q3e(s,o,a));case"logical":return de(()=>Z3e(s,o,a));case"matrices":return de(()=>J3e(s,o,a));case"normalization":return de(()=>Q3e(s,o,a));case"reduction":return de(()=>ePe(s,o,a));case"slice_join":return de(()=>tPe(s,o,a));case"sparse":return de(()=>nPe(s,o,a));case"spectral":return de(()=>rPe(s,o,a));case"string":return de(()=>iPe(s,o,a));case"transformation":return de(()=>sPe(s,o,a));case"hash_table":return K3e(s,o,a,r);case"custom":const l=GH(s.op);if(l&&l.customExecutor)return l.customExecutor(new D3e(s,o,a));throw TypeError(`Custom op ${s.op} is not registered.`);default:throw TypeError(`Unknown op '${s.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(t,e,n);return xp(i)?i.then(s=>[].concat(s)):[].concat(i)}class JH{constructor(e={},n={},r={},i={}){this.weightMap=e,this.tensorArrayMap=n,this.tensorListMap=r,this.functionMap=i,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,n){return{id:e,frameName:n,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let n=0;n<this.contexts.length-1;n++){const r=this.contexts.slice(0,this.contexts.length-n);e.push(this.contextIdforContexts(r))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(n=>n.id===0&&n.iterationId===0?"":`${n.frameName}-${n.iterationId}`).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const n in this.tensorArrayMap)this.tensorArrayMap[n].clearAndClose(e);for(const n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QH(t,e,n,r){const i=new Set,s=[];let o=null,a=null;const l=new Set,c=Object.keys(t).map(f=>co(f)[0]);let u=[];r!=null&&(u=r.map(f=>co(f.name)[0]));const h=[...e];for(;h.length>0;){const f=h.pop();if((e5(f)||uPe(f)||hPe(f))&&o==null&&(o=f,a=o.children.map(d=>d.name).filter(d=>i.has(d))),i.add(f.name),n[f.name]==null&&c.indexOf(f.name)===-1&&u.indexOf(f.name)===-1){if(f.inputs.length===0){s.push(f.name);continue}f.inputs.forEach(d=>{l.has(d.name)||(l.add(d.name),h.push(d))})}}return{inputs:t,outputs:e,usedNodes:i,missingInputs:s,dynamicNode:o,syncInputs:a}}function oPe(t,e,n){const{usedNodes:r,inputs:i}=n,s=[],o=Object.keys(i).map(u=>co(u)[0]).map(u=>t.nodes[u]),a=t.initNodes;o.forEach(u=>{r.has(u.name)&&s.push(u)}),t.weights.forEach(u=>{r.has(u.name)&&s.push(u)}),a!=null&&a.forEach(u=>{r.has(u.name)&&s.push(u)});const l=new Set,c=[];for(;s.length>0;){const u=s.pop();l.add(u.name),e[u.name]||c.push(u),u.children.forEach(h=>{!l.has(h.name)&&r.has(h.name)&&h.inputs.every(f=>l.has(f.name))&&s.push(h)})}return c}const aPe=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],lPe=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],cPe=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function e5(t){return aPe.indexOf(t.op)>=0}function uPe(t){return lPe.indexOf(t.op)>=0}function hPe(t){return cPe.indexOf(t.op)>=0}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y2{constructor(e,n){this.graph=e,this.parent=n,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(r=>{this._functionExecutorMap[r]=new y2(e.functions[r],this)})}get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const n=Object.keys(e).map(r=>e[r].map(i=>i.id));this._weightIds=[].concat(...n),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(e=>e.signatureKey||e.name)}get outputNodes(){return this._outputs.map(e=>{const n=e.signatureKey||e.name;return e.defaultOutput?`${n}:${e.defaultOutput}`:n})}get functions(){return Object.keys(this._functions).reduce((e,n)=>(e[n]=this._functions[n].signature,e),{})}getCompilationKey(e,n){const r=e.map(s=>s.name).sort(),i=n.map(s=>s.name).sort();return r.join(this.SEPERATOR)+"--"+i.join(this.SEPERATOR)}compile(e,n){const r=QH(e,n,this.weightMap,this._initNodes),{missingInputs:i,dynamicNode:s,syncInputs:o}=r;if(s!=null)throw new Error(`This execution contains the node '${s.name}', which has the dynamic op '${s.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${o}]`);if(i.length>0){const a=n.map(c=>c.name),l=Object.keys(e);throw new Error(`Cannot compute the outputs [${a}] from the provided inputs [${l}]. Missing the following inputs: [${i}]`)}return oPe(this.graph,this.weightMap,r)}execute(e,n){e=this.mapInputs(e);const r=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),n=this.mapOutputs(n),this.checkOutputs(n);const i=r.map(h=>this.graph.nodes[co(h)[0]]),s=n.map(h=>co(h)[0]);let o=s.map(h=>this.graph.nodes[h]);this.resetIntermediateTensors(),o.length===0&&(o=this._outputs);const a=this.getCompilationKey(i,o);let l=this.compiledMap.get(a);l==null&&(l=this.compile(e,o),this.compiledMap.set(a,l));const c={},u={};return de(()=>{const h=new JH(this.weightMap,c,u,this.functionExecutorMap),f=Object.assign({},this.weightMap);Object.keys(e).forEach(m=>{const[v,y]=co(m),w=[];w[y]=e[m],f[v]=w});const d=this.getFrozenTensorIds(f),p={};for(let m=0;m<l.length;m++){const v=l[m];if(!f[v.name]){const y=ZH(v,f,h,this._resourceManager);if(xp(y))throw new Error(`The execution of the op '${v.op}' returned a promise. Please use model.executeAsync() instead.`);f[v.name]=y,this.checkTensorForDisposal(v.name,v,f,h,d,s,p)}}return this.parent==null&&h.dispose(d),n.map(m=>ws(m,f,h))})}getFrozenTensorIds(e){const n=[].concat.apply([],Object.keys(e).map(r=>e[r]).map(r=>r.map(i=>i.id)));return new Set(n)}checkTensorForDisposal(e,n,r,i,s,o,a){n.category==="control"||o.indexOf(e)!==-1||(r[e].forEach(l=>{l!=null&&(a[l.id]=(a[l.id]||0)+n.children.length)}),n.inputs.forEach(l=>{if(l.category!=="control"){const c=XDe(l.name,r,i);c!=null&&c.forEach(u=>{if(u&&!u.kept&&!s.has(u.id)){const h=a[u.id];if(h===1){if(!this.keepTensorForDebug)u.dispose();else{const[f,d]=Kl(n.name,i);this.intermediateTensors[f]?this.intermediateTensors[f][d]=u:(this.intermediateTensors[f]=[],this.intermediateTensors[f][d]=u)}delete a[u.id]}else h!=null&&a[u.id]--}})}}))}async executeAsync(e,n){return this._executeAsync(e,n)}disposeIntermediateTensors(){!this.intermediateTensors||(Object.keys(this.intermediateTensors).forEach(e=>this.intermediateTensors[e].forEach(n=>n.dispose())),this.disposeTensorsMap())}disposeTensorsMap(){!this.tensorsMap||Object.keys(this.tensorsMap).forEach(e=>{this.tensorsMap[e].forEach(r=>{r&&!r.kept&&!r.isDisposed&&!this.keepIds.has(r.id)&&r.dispose()})})}getIntermediateTensors(){return this.tensorsMap}resetIntermediateTensors(){for(const e in this.intermediateTensors)this.intermediateTensors[e].forEach(n=>n.dispose()),delete this.intermediateTensors[e]}async _executeAsync(e,n,r=!1,i={},s={}){r||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepTensorForDebug=Ce().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(u){console.warn(u.message)}this.resetIntermediateTensors();const o=new JH(this.weightMap,i,s,this.functionExecutorMap);this.tensorsMap=await this.executeWithControlFlow(e,o,n,r);const a=n.map(u=>ws(u,this.tensorsMap,o)),l=a.map(u=>u.id),c=Object.keys(e).map(u=>e[u].id);return this.keepIds=new Set([...l,...c,...this.weightIds]),this.keepTensorForDebug||this.disposeTensorsMap(),this.parent==null&&o.dispose(this.keepIds),a}async executeFunctionAsync(e,n,r){const i=e.reduce((s,o,a)=>(s[this.inputs[a].name]=o,s),{});return this._executeAsync(i,this.outputNodes,!0,n,r)}async executeWithControlFlow(e,n,r,i){const s=Object.keys(e),o=s.map(x=>this.graph.nodes[co(x)[0]]),a=r.map(x=>co(x)[0]);let l=a.map(x=>this.graph.nodes[x]);l.length===0&&(l=this._outputs);const{usedNodes:c,missingInputs:u,dynamicNode:h,syncInputs:f}=QH(e,l,this.weightMap,this._initNodes),d=[...o,...this.graph.weights,...this._initNodes||[]].map(x=>({node:x,contexts:n.currentContext})),p=Object.assign({},this.weightMap);Object.keys(e).forEach(x=>{const[_,S]=co(x),T=[];T[S]=e[x],p[_]=T});const m={},v=this.getFrozenTensorIds(p),y={};for(;d.length>0;){const x=this.processStack(o,d,n,p,y,v,a,m,c);await Promise.all(x)}h==null&&!i&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const w=l.filter(x=>!e5(x)&&!ws(x.name,p,n)).map(x=>x.name);if(w.length>0){let x="";throw h!=null&&(x=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${f}]`),new Error(`Cannot compute the outputs [${w}] from the provided inputs [${s}]. Consider providing the following inputs: [${u}]. ${x}`)}return p}processStack(e,n,r,i,s,o,a,l,c){const u=[];for(;n.length>0;){const h=n.pop();r.currentContext=h.contexts;let f="";if(h.node.op==="Enter"&&$("isConstant",h.node,i,r)&&([f]=Kl(h.node.name,r)),i[h.node.name]==null){const d=ZH(h.node,i,r,this._resourceManager);f||([f]=Kl(h.node.name,r));const p=r.currentContext;xp(d)?u.push(d.then(m=>(i[f]=m,r.currentContext=p,this.checkTensorForDisposal(f,h.node,i,r,o,a,l),this.processChildNodes(h.node,n,r,i,s,c),m))):(i[f]=d,this.checkTensorForDisposal(f,h.node,i,r,o,a,l),this.processChildNodes(h.node,n,r,i,s,c))}else this.processChildNodes(h.node,n,r,i,s,c)}return u}processChildNodes(e,n,r,i,s,o){e.children.forEach(a=>{const[l]=Kl(a.name,r);s[l]||!o.has(a.name)||(a.op==="Merge"?a.inputNames.some(c=>!!ws(c,i,r))&&(s[l]=!0,n.push({contexts:r.currentContext,node:a})):a.inputNames.every(c=>!!ws(c,i,r))&&(s[l]=!0,n.push({contexts:r.currentContext,node:a})))})}dispose(){Object.keys(this.weightMap).forEach(e=>this.weightMap[e].forEach(n=>n.dispose()))}checkInputShapeAndType(e){Object.keys(e).forEach(n=>{const r=e[n],[i]=co(n),s=this.graph.nodes[i];if(s.attrParams.shape&&s.attrParams.shape.value){const o=s.attrParams.shape.value,a=o.length===r.shape.length&&r.shape.every((l,c)=>o[c]===-1||o[c]===l);z(a,()=>`The shape of dict['${s.name}'] provided in model.execute(dict) must be [${o}], but was [${r.shape}]`)}s.attrParams.dtype&&s.attrParams.dtype.value&&z(r.dtype===s.attrParams.dtype.value,()=>`The dtype of dict['${s.name}'] provided in model.execute(dict) must be ${s.attrParams.dtype.value}, but was ${r.dtype}`)})}mapInputs(e){const n={};for(const r in e)if(this._signature!=null&&this._signature.inputs!=null&&this._signature.inputs[r]!=null){const i=this._signature.inputs[r];n[i.name]=e[r]}else n[r]=e[r];return n}checkInputs(e){const n=Object.keys(e).filter(r=>{const[i]=co(r);return this.graph.nodes[i]==null});if(n.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${n}] that are not part of graph`)}mapOutputs(e){return e.map(n=>this._signature!=null&&this._signature.outputs!=null&&this._signature.outputs[n]!=null?this._signature.outputs[n].name:n,{})}checkOutputs(e){e.forEach(n=>{const[r]=co(n);if(!this.graph.nodes[r])throw new Error(`The output '${n}' is not found in the graph`)})}}class fPe{constructor(e={},n={}){this.hashTableNameToHandle=e,this.hashTableMap=n}addHashTable(e,n){this.hashTableNameToHandle[e]=n.handle,this.hashTableMap[n.id]=n}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dPe="?tfjs-format=file",pPe="model.json";class t5{constructor(e,n={}){this.modelUrl=e,this.loadOptions=n,this.version="n/a",n==null&&(this.loadOptions={}),this.resourceManager=new fPe}get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}findIOHandler(){const e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=wS(e,this.loadOptions);else{const n=qM(e,this.loadOptions);if(n.length===0)n.push(wS(e,this.loadOptions));else if(n.length>1)throw new Error(`Found more than one (${n.length}) load handlers for URL '${[e]}'`);this.handler=n[0]}}async load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=await this.handler.load();return this.loadSync(e)}loadSync(e){this.artifacts=e;const n=this.artifacts.modelTopology;let r;this.artifacts.userDefinedMetadata!=null&&this.artifacts.userDefinedMetadata.signature!=null?r=this.artifacts.userDefinedMetadata.signature:r=this.artifacts.signature,this.signature=r,this.version=`${n.versions.producer}.${n.versions.minConsumer}`;const i=gS(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new y2(HH.Instance.transformGraph(n,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(i),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){const s=HH.Instance.transformGraph(e.modelInitializer);this.initializer=new y2(s),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}async save(e,n){if(typeof e=="string"){const r=jM(e);if(r.length===0)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(r.length>1)throw new Error(`Found more than one (${r.length}) save handlers for URL '${e}'`);e=r[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}predict(e,n){return this.execute(e,this.outputNodes)}normalizeInputs(e){if(!(e instanceof Qn)&&!Array.isArray(e))return e;if(e=Array.isArray(e)?e:[e],e.length!==this.inputNodes.length)throw new Error(`Input tensor count mismatch,the graph model has ${this.inputNodes.length} placeholders, while there are ${e.length} input tensors.`);return this.inputNodes.reduce((n,r,i)=>(n[r]=e[i],n),{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}execute(e,n){e=this.normalizeInputs(e),n=this.normalizeOutputs(n);const r=this.executor.execute(e,n);return r.length>1?r:r[0]}async executeAsync(e,n){e=this.normalizeInputs(e),n=this.normalizeOutputs(n);const r=await this.executor.executeAsync(e,n);return r.length>1?r:r[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((n,r)=>(n[r]=[e[r]],n),{})}dispose(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}async function Ff(t,e={}){if(t==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");e==null&&(e={}),e.fromTFHub&&t.load==null&&(t.endsWith("/")||(t=t+"/"),t=`${t}${pPe}${dPe}`);const n=new t5(t,e);return await n.load(),n}/** @license See the LICENSE file. */const mPe="3.12.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var gPe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",GraphModel:t5,loadGraphModel:Ff,deregisterOp:qDe,registerOp:jDe,version_converter:mPe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n5={kernelName:Sy,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>se(t,q0(Qe(n,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vPe={kernelName:_p,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const r=nr(Qe(n,"float32")),i=es(mt(Nt(1),r));return $r(Tt(t,i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yPe={kernelName:Sp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const r=es(mt(nr(Qe(n,"float32")),1));return Tt(t,r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bPe={kernelName:af,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Qt(n.shape,r.shape);return{a:()=>{let a=t;const l=ri(n.shape,i);return l.length>0&&(a=xt(a,l)),fe(a,n.shape)},b:()=>{let a=t;const l=ri(r.shape,i);return l.length>0&&(a=xt(a,l)),fe(a,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wPe={kernelName:Cy,saveAllInputs:!0,gradFunc:(t,e)=>{const n={};return e.forEach((r,i)=>{n[i]=()=>t.clone()}),n}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xPe={kernelName:Ty,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>In(n)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Pe={kernelName:Ey,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>In(n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SPe={kernelName:Cp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Tt(t,es(mt(Nt(1),nr(Qe(n,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CPe={kernelName:Tp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const r=es(Be(Nt(1),nr(Qe(n,"float32"))));return Tt(t,r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TPe={kernelName:Ap,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Qt(n.shape,r.shape);return{a:()=>{const a=Be(nr(n),nr(r));let l=se(t,Tt(r,a));const c=ri(n.shape,i);return c.length>0&&(l=xt(l,c)),fe(l,n.shape)},b:()=>{const a=Be(nr(n),nr(r));let l=$r(se(t,Tt(n,a)));const c=ri(r.shape,i);return c.length>0&&(l=xt(l,c)),fe(l,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EPe={kernelName:Ep,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Tt(t,Be(nr(Qe(n,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kPe={kernelName:kp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Tt(t,mt(Nt(1),nr(Qe(n,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function APe(t,e,n,r,i,s){const o=U(t,"dy","avgPool3dGrad"),a=U(e,"input","avgPool3dGrad");let l=o,c=a,u=!1;a.rank===4&&(u=!0,l=fe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=fe(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),z(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),z(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),ps("avgPool3dGrad",i,s);const h={dy:l,input:c},f={filterSize:n,strides:r,pad:i,dimRoundingMode:s},d=Q.runKernel(c_,h,f);return u?fe(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const MPe=te({avgPool3dGrad_:APe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IPe={kernelName:Ay,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{filterSize:i,strides:s,pad:o,dimRoundingMode:a}=n;return{x:()=>MPe(t,r,i,s,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NPe(t,e,n,r,i){const s=U(t,"dy","avgPoolGrad"),o=U(e,"input","avgPoolGrad");z(o.rank===s.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${s.rank})`);let a=o,l=s,c=!1;o.rank===3&&(c=!0,a=fe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=fe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),z(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),z(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const u={dy:l,input:a},h={filterSize:n,strides:r,pad:i},f=Q.runKernel(l_,u,h);return c?fe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const $Pe=te({avgPoolGrad_:NPe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RPe={kernelName:ky,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{filterSize:i,strides:s,pad:o}=n;return{x:()=>$Pe(t,r,i,s,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DPe={kernelName:My,inputsToSave:["a","b"],gradFunc:(t,e,n)=>{const[r,i]=e,{transposeA:s,transposeB:o}=n;return!s&&!o?{a:()=>gn(t,i,!1,!0),b:()=>gn(r,t,!0,!1)}:!s&&o?{a:()=>gn(t,i,!1,!1),b:()=>gn(t,r,!0,!1)}:s&&!o?{a:()=>gn(i,t,!1,!0),b:()=>gn(r,t,!1,!1)}:{a:()=>gn(i,t,!0,!0),b:()=>gn(t,r,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PPe={kernelName:Iy,gradFunc:(t,e,n)=>{const{blockShape:r,crops:i}=n;return{x:()=>FS(t,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OPe={kernelName:SB,gradFunc:(t,e,n)=>{const r=n,i=r.inputShape,s=r.shape,o=Array.from(s);for(let l=i.length-1;l>=0;l--)if(i[l]===s[l])o[l]=1;else if(i[l]!==1)throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${s}].`);const a=[];for(let l=0;l<o.length;l++)o[l]>1&&a.push(l);return{x:()=>xt(t,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FPe={kernelName:Mp,gradFunc:t=>({x:()=>t.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LPe={kernelName:Ip,gradFunc:t=>({x:()=>In(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BPe={kernelName:Np,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{clipValueMin:i,clipValueMax:s}=n;return{x:()=>Bs(Vl(xf(r,i),_f(r,s)),t,In(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zPe={kernelName:Ny,inputsToSave:["x"],gradFunc:n5.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VPe={kernelName:$y,saveAllInputs:!0,gradFunc:(t,e,n)=>{const r=e.map(l=>l.shape),{axis:i}=n,s=hn(i,e[0].shape)[0],o=r.map(l=>l[s]);return so(t,o,s).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UPe={kernelName:Ry,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[r,i]=e,{dilations:s,strides:o,pad:a,dataFormat:l}=n;return z(Hu(s),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`),{x:()=>SI(r.shape,t,i,o,a,l),filter:()=>YI(r,t,i.shape,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WPe={kernelName:Dy,inputsToSave:["dy","filter"],gradFunc:(t,e,n)=>{const[r,i]=e,{strides:s,pad:o,dataFormat:a,dimRoundingMode:l}=n;return{dy:()=>ju(t,i,s,o,a,1,l),filter:()=>YI(t,r,i.shape,s,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GPe(t,e,n,r,i){let s=t;t.rank===4&&(s=fe(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let o=e;o.rank===4&&(o=fe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),z(s.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${s.shape}.`),z(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),z(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),z(s.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${s.shape[4]}) must match input depth in filter (${n[3]}.`),z(o.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${n[4]}).`);const a={x:s,dy:o},l={strides:r,pad:i,filterShape:n};return Q.runKernel(p_,a,l)}const HPe=te({conv3DBackpropFilter_:GPe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jPe={kernelName:Py,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:r,strides:i,pad:s}=n;z(Hu(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);const[o,a]=e;return{x:()=>jz(o.shape,t,a,i,s),filter:()=>HPe(o,t,a.shape,i,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qPe={kernelName:$p,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>se($r(zI(Qe(n,"float32"))),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XPe={kernelName:Rp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>se(VI(Qe(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KPe={kernelName:Oy,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{axis:i,exclusive:s,reverse:o}=n;return{x:()=>{const a=Hr([i],r.rank);let l=kI(t,i,s,!o);return a!=null&&(l=Mn(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YPe={kernelName:Fy,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:r,strides:i,pad:s,dimRoundingMode:o}=n,a=r==null?[1,1]:r;z(Hu(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,c]=e;return z(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),z(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),z(l.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),z(Ui(i,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${i} and dilations '${a}'.`),ps("depthwiseConv2d",s,o),{x:()=>D4(l.shape,t,c,i,s,a,o),filter:()=>R4(l,t,c.shape,i,s,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZPe={kernelName:Ly,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[r,i]=e,s={x:r,filter:i,dy:t},o={x:r,filter:i,dy:t};return{x:()=>Q.runKernel(__,s,n),filter:()=>Q.runKernel(S_,o,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JPe={kernelName:Pp,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e,r={dy:t,y:n};return{x:()=>Q.runKernel(T_,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QPe={kernelName:Op,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,r=se(Mo($r(nr(n))),2/Math.sqrt(Math.PI));return{x:()=>se(t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eOe={kernelName:Fp,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>se(t,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tOe={kernelName:zy,inputsToSave:["input"],gradFunc:(t,e)=>{const[n]=e;return{input:()=>fe(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nOe={kernelName:Lp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>se(t,Mo(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rOe={kernelName:Bp,gradFunc:t=>({x:()=>In(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iOe={kernelName:zp,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Qt(n.shape,r.shape);return{a:()=>{const a=Tt(t,Qe(r,"float32")),l=ri(n.shape,i);return l.length>0?fe(xt(a,l),n.shape):a},b:()=>{let a=se(t,Qe(n,"float32"));const l=ri(r.shape,i);l.length>0&&(a=fe(xt(a,l),r.shape));const c=nr(r);return $r(Tt(a,Qe(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sOe={kernelName:Vy,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,n)=>{const{varianceEpsilon:r}=n,[i,s,o,a]=e,l=a==null?Nt(1):a,c=ri(s.shape,i.shape),u=[];if(s.rank===1){for(let _=0;_<i.shape.length-1;++_)u.push(i.shape[_]);u.push(1)}const h=mt(i,s),f=se(t,l),d=LI(Be(o,Nt(r))),p=se(se(se(d,d),d),Nt(-.5));return{x:()=>s.rank===1?fe(se(se(t,ua(fe(d,[1,1,1,s.shape[0]]),u)),l),i.shape):fe(se(se(t,d),l),i.shape),mean:()=>{let _=se(se(d,Nt(-1)),f);return s.rank===1&&(_=xt(_,c)),fe(_,s.shape)},variance:()=>{let _=se(se(p,h),f);return s.rank===1&&(_=xt(_,c)),fe(_,s.shape)},scale:()=>{const _=se(h,d);let S=se(t,_);return s.rank===1&&(S=xt(S,c)),fe(S,s.shape)},offset:()=>{let _=t;return s.rank===1&&(_=xt(_,c)),fe(_,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oOe={kernelName:Uy,inputsToSave:["x","indices"],gradFunc:(t,e,n)=>{const[r,i]=e,{axis:s}=n,o=hn(s,r.shape)[0];return{x:()=>{const l=r.shape,c=i.size,u=l.slice(0,o),h=u.length,f=l.slice(s,l.length).slice(1),d=f.length,p=r5(0,h),m=r5(h+1,h+1+d),v=i5([u,[c],f]),y=fe(t,v),w=fe(i,[c]),x=i5([[h],p,m]),_=Mn(y,x);let S=E4(_,w,r.shape[o]);const T=$m(x);return S=Mn(S,T),S},indices:()=>i}}};function r5(t,e){const n=[];for(let r=t;r<e;++r)n.push(r);return n}function i5(t){const e=[];for(let n=0;n<t.length;++n)for(let r=0;r<t[n].length;++r)e.push(t[n][r]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aOe={kernelName:Vp,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e;return{a:()=>In(n),b:()=>In(r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lOe={kernelName:Up,gradFunc:t=>({x:()=>Qe(t,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cOe={kernelName:Wp,gradFunc:t=>({x:()=>In(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uOe={kernelName:Gp,gradFunc:t=>({x:()=>In(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hOe={kernelName:Hp,gradFunc:t=>({x:()=>In(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fOe={kernelName:Gy,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{alpha:i}=n,s=No(r,0);return{x:()=>Bs(s,t,se(t,i))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dOe={kernelName:qp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Tt(t,Be(n,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pOe={kernelName:jp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Tt(t,Qe(n,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mOe={kernelName:CB,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r]=e,{axis:i}=n;return{logits:()=>{const s=!0,o=Mo(r);return mt(t,se(xt(t,i,s),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gOe(t,e,n,r=5,i=1,s=1,o=.5){const a={x:t,y:e,dy:n},l={depthRadius:r,bias:i,alpha:s,beta:o};return Q.runKernel(R_,a,l)}const vOe=te({localResponseNormalizationBackprop_:gOe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yOe={kernelName:Yy,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r,i]=e,{depthRadius:s,bias:o,alpha:a,beta:l}=n;return{x:()=>vOe(r,i,t,s,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s5(t,e,n,r){return e.rank<n.rank&&(e=fe(e,Gr(e.shape,r))),t.rank<n.rank&&(t=fe(t,Gr(t.shape,r))),{x:()=>se(t,Qe(Za(n,e),t.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o5={kernelName:Zy,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const r=n,{reductionIndices:i}=r,s=e[0],o=e[1],a=hn(i,s.shape),l=s5(t,o,s,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bOe={kernelName:Xp,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e;return{a:()=>se(t,Qe(xf(n,r),"float32")),b:()=>se(t,Qe(MI(n,r),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wOe(t,e,n,r,i,s,o){const a=U(t,"dy","maxPool3dGrad"),l=U(e,"input","maxPool3dGrad"),c=U(n,"output","maxPool3dGrad");let u=a,h=l,f=c,d=!1;l.rank===4&&(d=!0,u=fe(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),h=fe(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),f=fe(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),z(u.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),z(h.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),z(f.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${f.rank}.`),ps("maxPool3dGrad",s,o);const p={dy:u,input:h,output:f},m={filterSize:r,strides:i,pad:s,dimRoundingMode:o},v=Q.runKernel(P_,p,m);return d?fe(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}const xOe=te({maxPool3dGrad_:wOe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Oe={kernelName:Qy,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r,i]=e,{filterSize:s,strides:o,pad:a,dimRoundingMode:l}=n;return{x:()=>xOe(t,r,i,s,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SOe(t,e,n,r,i,s,o){const a=U(t,"dy","maxPoolGrad"),l=U(e,"input","maxPoolGrad"),c=U(n,"output","maxPoolGrad");z(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),z(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),z(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),ps("maxPoolGrad",s,o);const u={dy:a,input:l,output:c},h={filterSize:r,strides:i,pad:s,dimRoundingMode:o};return Q.runKernel(D_,u,h)}const COe=te({maxPoolGrad_:SOe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TOe={kernelName:Jy,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r,i]=e,{filterSize:s,strides:o,pad:a}=n;return{x:()=>COe(t,r,i,s,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EOe={kernelName:e0,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{axis:i}=n,s=hn(i,r.shape),a=Mi(r.shape,s)[1],l=_e(a);return{x:()=>{const u=r.shape.slice();s.forEach(d=>{u[d]=1});const h=fe(t,u);return Tt(se(h,io(r.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kOe={kernelName:t0,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const r=n,{axis:i}=r,[s,o]=e,a=hn(i,s.shape),l=s5(t,o,s,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AOe={kernelName:Kp,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e;return{a:()=>se(t,Qe(_f(n,r),"float32")),b:()=>se(t,Qe(No(n,r),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MOe={kernelName:n0,inputsToSave:["x"],gradFunc:(t,e,n)=>{const r=e[0],{paddings:i}=n,s=i.map(o=>o[0]);return{x:()=>Cn(t,s,r.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IOe={kernelName:Yp,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Qt(n.shape,r.shape);return{a:()=>{const a=ri(n.shape,i);return a.length>0?fe(xt(t,a),n.shape):t},b:()=>{const a=se(t,$r(V0(Tt(n,r)))),l=ri(r.shape,i);return l.length>0?fe(xt(a,l),r.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NOe={kernelName:Zp,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Qt(n.shape,r.shape);return{a:()=>{const a=se(t,Qe(r,"float32")),l=ri(n.shape,i);return l.length>0?fe(xt(a,l),n.shape):a},b:()=>{const a=se(t,Qe(n,"float32")),l=ri(r.shape,i);return l.length>0?fe(xt(a,l),r.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Oe={kernelName:r0,gradFunc:t=>({x:()=>$r(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ROe={kernelName:o0,inputsToSave:["indices"],gradFunc:(t,e)=>{const n=e[0];return{indices:()=>zr(n.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DOe={kernelName:s0,gradFunc:t=>({x:()=>In(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const POe={kernelName:a0,saveAllInputs:!0,gradFunc:(t,e,n)=>{const{axis:r}=n;return Qa(t,r).map(s=>()=>s)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a5={kernelName:l0,inputsToSave:["x"],gradFunc:(t,e,n)=>{const r=e[0],{paddings:i}=n,s=i.map(o=>o[0]);return{x:()=>Cn(t,s,r.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OOe={kernelName:Jp,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[n,r,i]=e,s=n,o=r,a=Qt(s.shape,o.shape);return{a:()=>{const u=Qe(o,"float32");let h=se(t,se(u,Xu(s,mt(u,Nt(1)))));const f=ri(s.shape,a);return f.length>0&&(h=xt(h,f)),fe(h,s.shape)},b:()=>{const u=No(s,0),h=Bs(u,$o(s),In(s));let f=se(t,se(i,h));const d=ri(o.shape,a);return d.length>0&&(f=xt(f,d)),fe(f,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FOe={kernelName:c0,inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[n,r]=e,i=No(n,0);return{x:()=>Bs(i,t,se(t,r)),alpha:()=>{let s=Bs(i,In(t),se(t,n));const o=ri(r.shape,t.shape);return o.length>0&&(s=xt(s,o)),fe(s,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LOe={kernelName:Dp,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Qt(n.shape,r.shape);return{a:()=>{const a=Tt(t,Qe(r,"float32")),l=ri(n.shape,i);return l.length>0?fe(xt(a,l),n.shape):a},b:()=>{let a=se(t,Qe(n,"float32"));const l=ri(r.shape,i);l.length>0&&(a=fe(xt(a,l),r.shape));const c=nr(r);return $r(Tt(a,Qe(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BOe={kernelName:Qp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Tt(t,$r(nr(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zOe={kernelName:tm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,r=se(_f(n,6),q0(n));return{x:()=>se(t,Qe(r,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VOe={kernelName:em,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>se(t,Qe(q0(n),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UOe={kernelName:u0,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>fe(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WOe={kernelName:f0,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[r]=e,i={dy:t,images:r};return{images:()=>Q.runKernel(H_,i,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GOe={kernelName:h0,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[r]=e,i={dy:t,images:r};return{images:()=>Q.runKernel(G_,i,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HOe={kernelName:d0,gradFunc:(t,e,n)=>{const{dims:r}=n,i=hn(r,t.shape);return{x:()=>Do(t,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jOe={kernelName:nm,gradFunc:t=>({x:()=>In(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qOe={kernelName:rm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>$r(Tt(t,se(Xu(n,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XOe={kernelName:p0,inputsToSave:["condition"],gradFunc:(t,e)=>{const[n]=e;return{condition:()=>Qe(In(n),"float32"),t:()=>se(t,Qe(n,t.dtype)),e:()=>se(t,Qe(RS(n),t.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KOe={kernelName:im,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const r=No(n,Nt(0)),i=Nt(lC),s=Nt(cC),o=se(t,s),a=se(se(t,i),Mo(Qe(n,"float32")));return Bs(r,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YOe={kernelName:lm,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>se(t,se(n,mt(Nt(1),n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZOe={kernelName:am,gradFunc:t=>({x:()=>In(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JOe={kernelName:sm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>se(AS(Qe(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QOe={kernelName:om,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>se(EI(Qe(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eFe={kernelName:m0,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{begin:i,size:s}=n,o=r.shape,[a,l]=_S(r,i,s),c=[];for(let u=0;u<t.rank;u++)c.push([a[u],o[u]-a[u]-l[u]]);return{x:()=>qu(t,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tFe={kernelName:b0,outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r]=e,{dim:i}=n,s=!0,o=se(t,r);return{logits:()=>mt(o,se(xt(o,[i],s),r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nFe={kernelName:cm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>se(t,Bl(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l5={kernelName:v0,gradFunc:(t,e,n)=>{const{blockShape:r,paddings:i}=n;return{x:()=>kS(t,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c5={kernelName:y0,gradFunc:(t,e,n)=>{const{axis:r}=n;return{x:()=>ii(t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rFe={kernelName:um,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Tt(t,se(es(Qe(n,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iFe={kernelName:J_,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>se(t,se(Qe(n,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sFe={kernelName:hm,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Nt(2);return{a:()=>se(t,se(i,mt(n,r))),b:()=>se(t,se(i,mt(r,n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oFe={kernelName:gm,gradFunc:t=>({x:()=>In(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aFe={kernelName:fm,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Qt(n.shape,r.shape);return{a:()=>{let a=t;const l=ri(n.shape,i);return l.length>0&&(a=xt(a,l)),fe(a,n.shape)},b:()=>{let a=t;const l=ri(r.shape,i);return l.length>0&&(a=xt(a,l)),fe($r(a),r.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lFe={kernelName:g0,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,i=r.shape.slice(),{axis:s}=n;hn(s,r.shape).forEach(c=>{i[c]=1});const a=fe(t,i),l=se(a,io(r.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cFe={kernelName:dm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Tt(t,nr(AS(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uFe={kernelName:pm,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>se(mt(Nt(1),nr(n)),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hFe={kernelName:mm,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{reps:i}=n;return{x:()=>{let o=In(r);if(r.rank===1)for(let a=0;a<i[0];++a)o=Be(o,Cn(t,[a*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let a=0;a<i[0];++a)for(let l=0;l<i[1];++l)o=Be(o,Cn(t,[a*r.shape[0],l*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let a=0;a<i[0];++a)for(let l=0;l<i[1];++l)for(let c=0;c<i[2];++c)o=Be(o,Cn(t,[a*r.shape[0],l*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let a=0;a<i[0];++a)for(let l=0;l<i[1];++l)for(let c=0;c<i[2];++c)for(let u=0;u<i[3];++u)o=Be(o,Cn(t,[a*r.shape[0],l*r.shape[1],c*r.shape[2],u*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fFe={kernelName:w0,gradFunc:(t,e,n)=>{const r=n,{perm:i}=r,s=$m(i);return{x:()=>Mn(t,s)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dFe={kernelName:x0,gradFunc:(t,e,n)=>{const r=n,{axis:i}=r;return{value:()=>ha(t,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pFe={kernelName:_0,inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>mFe(t,n)}}};function mFe(t,e){const n=Bc(e,In(e)),r=Im(t,n);let i=xf(e,Nt(0,"int32"));const s=r.rank-i.rank;for(let a=0;a<s;++a)i=Io(i,a+1);i=Vl(i,io(r.shape,"bool"));const o=In(r);return Bs(i,r,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gFe={kernelName:S0,gradFunc:t=>({x:()=>In(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vFe=[n5,vPe,yPe,bPe,wPe,xPe,_Pe,SPe,CPe,TPe,EPe,kPe,IPe,RPe,DPe,PPe,OPe,FPe,LPe,BPe,zPe,VPe,WPe,UPe,jPe,qPe,XPe,KPe,YPe,ZPe,LOe,JPe,QPe,eOe,tOe,nOe,iOe,rOe,sOe,oOe,aOe,lOe,cOe,uOe,hOe,fOe,dOe,pOe,mOe,yOe,o5,o5,bOe,_Oe,TOe,EOe,kOe,AOe,MOe,IOe,NOe,$Oe,ROe,DOe,POe,a5,a5,OOe,FOe,BOe,zOe,VOe,UOe,WOe,GOe,HOe,jOe,qOe,XOe,KOe,YOe,ZOe,JOe,QOe,eFe,tFe,nFe,l5,l5,c5,c5,rFe,sFe,iFe,oFe,aFe,lFe,cFe,uFe,hFe,fFe,dFe,pFe,gFe];for(const t of vFe)TB(t);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let xR;function yi(){return xR==null&&(xR=kz().epsilon()),xR}function il(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Yl extends Error{constructor(e){super(e);Object.setPrototypeOf(this,Yl.prototype)}}class ya extends Error{constructor(e){super(e);Object.setPrototypeOf(this,ya.prototype)}}class ue extends Error{constructor(e){super(e);Object.setPrototypeOf(this,ue.prototype)}}class tn extends Error{constructor(e){super(e);Object.setPrototypeOf(this,tn.prototype)}}class _R extends Error{constructor(e){super(e);Object.setPrototypeOf(this,_R.prototype)}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Lf(t,e){if(Array.isArray(t)){let n=[];for(let r=0;r<e;r++)n=n.concat(t);return n}else{const n=new Array(e);return n.fill(t),n}}function Zl(t,e){if(!t)throw new _R(e)}function u5(t,e){let n=0;for(const r of t)r===e&&n++;return n}function Vs(t){return t.length===1?t[0]:t}function yr(t){return Array.isArray(t)?t:[t]}function Hc(t){const n=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return n[0]!=="_"?n:"private"+n}function Bf(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(e,n)=>n.toUpperCase())}let ba={};function SR(t){if(t==null)return null;const e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function CR(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(e=>CR(e));else{const e=Object.keys(t);for(const n of e){const r=t[n];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?t[n]=r.value:CR(r))}}}function Rb(t,e={},n={},r="object",i=!1){if(typeof t=="string"){const s=t;let o;if(s in n)o=n[s];else if(s in ba)o=ba[s];else if(o=e[s],o==null)throw new ue(`Unknown ${r}: ${t}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const s=t;if(s.className==null||s.config==null)throw new ue(`${r}: Improper config format: ${JSON.stringify(s)}.
'className' and 'config' must set.`);const o=s.className;let a,l;if(o in n?[a,l]=n[o]:o in ba?[a,l]=ba.className:o in e&&([a,l]=e[o]),a==null)throw new ue(`Unknown ${r}: ${o}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const c={};for(const d of Object.keys(ba))c[d]=ba[d];for(const d of Object.keys(n))c[d]=n[d];const u=s.config;u.customObjects=c;const h=Object.assign({},ba);for(const d of Object.keys(n))ba[d]=n[d];CR(s.config);const f=l(a,s.config,n,i);return ba=Object.assign({},h),f}else{const c=Object.assign({},ba);for(const h of Object.keys(n))ba[h]=n[h];const u=new a(s.config);return ba=Object.assign({},c),u}}}function yFe(t,e){return t<e?-1:t>e?1:0}function b2(t,e){return-1*yFe(t,e)}function lh(t){if(t==null)return t;const e=[];for(const n of t)e.indexOf(n)===-1&&e.push(n);return e}function bFe(t){if(t==null)throw new ue(`Invalid value in obj: ${JSON.stringify(t)}`);for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function zf(t,e,n){if(n!=null&&t.indexOf(n)<0)throw new ue(`${n} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function TR(t,e,n=0,r=1/0){return Zl(n>=0),Zl(r>=n),Array.isArray(t)&&t.length>=n&&t.length<=r&&t.every(i=>typeof i===e)}function Ri(t,e){Array.isArray(t)?(z(t.length>0,()=>`${e} is unexpectedly an empty array.`),t.forEach((n,r)=>Ri(n,`element ${r+1} of ${e}`))):z(Number.isInteger(t)&&t>0,()=>`Expected ${e} to be a positive integer, but got ${h5(t)}.`)}function h5(t){return t===null?"null":Array.isArray(t)?"["+t.map(e=>h5(e)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function wFe(t,e,n){let r=n!=null?n():ds(),i;return(...o)=>{const a=n!=null?n():ds();return a-r<e||(r=a,i=t(...o)),i}}function f5(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ER(t,e){return de(()=>es(xt(se(t,t),e,!0)))}class Db extends bf{getConfig(){return{}}}class d5 extends Db{constructor(e){super();this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return de(()=>{const n=ER(e,this.axis),r=ro(n,0,this.maxValue);return se(e,Tt(r,Be(yi(),n)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}d5.className="MaxNorm";Le(d5);class p5 extends Db{constructor(e){super();this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return de(()=>Tt(e,Be(yi(),ER(e,this.axis))))}getConfig(){return{axis:this.axis}}}p5.className="UnitNorm";Le(p5);class m5 extends Db{apply(e){return Ul(e)}}m5.className="NonNeg";Le(m5);class g5 extends Db{constructor(e){super();this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return de(()=>{const n=ER(e,this.axis),r=Be(se(this.rate,ro(n,this.minValue,this.maxValue)),se(1-this.rate,n));return se(e,Tt(r,Be(yi(),n)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}g5.className="MinMaxNorm";Le(g5);const v5={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function bi(t){return SR(t)}function y5(t,e={}){return Rb(t,Ao.getMap().classNameMap,e,"constraint")}function wi(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in v5?v5[t]:t,config:{}};return y5(n)}else return t instanceof Db?t:y5(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const xFe=["channelsFirst","channelsLast"],_Fe=["nearest","bilinear"],SFe=["valid","same","causal"],CFe=["max","avg"],TFe=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const vg=new Map;function jr(t){zf(xFe,"DataFormat",t)}function EFe(t){zf(_Fe,"InterpolationFormat",t)}function Lo(t){zf(SFe,"PaddingMode",t)}function b5(t){zf(CFe,"PoolMode",t)}const Pb=[],w5="/";function Vf(t,e){Pb.push(t);try{const n=e();return Pb.pop(),n}catch(n){throw Pb.pop(),n}}function kFe(){return Pb.length===0?"":Pb.join(w5)+w5}function x5(t){if(!S5(t))throw new Error("Not a valid tensor name: '"+t+"'");return kFe()+t}function _5(t){if(!S5(t))throw new Error("Not a valid tensor name: '"+t+"'");vg.has(t)||vg.set(t,0);const e=vg.get(t);if(vg.set(t,vg.get(t)+1),e>0){const n=`${t}_${e}`;return vg.set(n,1),n}else return t}const AFe=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function S5(t){return!!t.match(AFe)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function MFe(t){return t===parseInt(t.toString(),10)}function ch(t,e,n){e==null&&(e=0),n==null&&(n=t.length);let r=1;for(let i=e;i<n;++i)r*=t[i];return r}function yg(t){if(t.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let n=0;n<t.length;n++){const r=t[n];r<e&&(e=r)}return e}function uh(t){if(t.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const r=t[n];r>e&&(e=r)}return e}function sl(t,e){if(e<t)throw new ue(`end (${e}) < begin (${t}) is forbidden.`);const n=[];for(let r=t;r<e;++r)n.push(r);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function w2(t,e){return Qe(t,e)}function Ob(t,e=-1){const n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),fe(t,n)}function IFe(t,e){return de(()=>{if(t.shape.length!==2)throw new ue(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);const n=Ob(t,1);return MR(n,[1,e,1])})}function NFe(t){const e=[ch(t.shape)];return fe(t,e)}function $Fe(t){if(t.rank<=1)throw new ue(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],ch(t.shape,1)];return fe(t,e)}function Uf(t,e,n){return de(()=>{switch(t.rank){case 1:return zS(t,e,n);case 2:return UI(t,[e,0],[n,t.shape[1]]);case 3:return VS(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return G0(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);case 5:return Cn(t,[e,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return Cn(t,[e,0,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new ue(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function kR(t,e,n){return de(()=>{switch(t.rank){case 1:return zS(t,e,n);case 2:return UI(t,[0,e],[t.shape[0],n]);case 3:return VS(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return G0(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new ue(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function x2(t,e,n,r){return de(()=>{switch(t.rank){case 1:return zS(t,e,n);case 2:switch(r){case 1:return Uf(t,e,n);case 2:return kR(t,e,n);default:throw new ue(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return Uf(t,e,n);case 2:return VS(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return kR(t,e,n);default:throw new ue(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return Uf(t,e,n);case 2:return G0(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return G0(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return kR(t,e,n);default:throw new ue(`The axis is not within the rank of the tensor ${r}`)}default:throw new ue(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function AR(t,e=-1){let n;return e<0&&(n=t[0].rank,n!==0?e=n:e=0),e===t[0].rank&&(e=-1),ii(t,e)}function C5(t,e){switch(t.rank){case 1:return Uz([t,e]);case 2:return Wz([t,e],0);case 3:return Gz([t,e],0);case 4:return Hz([t,e],0);default:throw new ue(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function MR(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new ue(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return ua(t,e)}function _2(t,e=0,n=1,r,i){return y4(t,e,n,r,i)}function Jl(t,e,n,r){if(t.rank<2||e.rank<2)throw new tn(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){const i=t.shape.slice(-1)[0],s=e.shape.slice(-2)[0];if(i!==s)throw new tn(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(t.rank===2&&e.rank===2)return YS({a:t,b:e,transposeA:!1,transposeB:!1,bias:r?IR(t.rank,r,il()):null,activation:n});{const i=t.shape.slice(),s=i.pop();t=fe(t,[-1,s]);const o=e.shape.slice(),a=o.pop(),l=o.pop(),c=[...o,a],u=Array.from({length:e.rank},(p,m)=>m===0?e.rank-2:m<=e.rank-2?m-1:m);e=fe(Mn(e,u),[l,-1]);const h=[...i,...c];return fe(YS({a:t,b:e,transposeA:!1,transposeB:!1,bias:r?IR(t.rank,r,il()):null,activation:n}),h)}}function T5(t,e,n){return de(()=>(Array.isArray(e)?e=ts(e,"int32"):e=Qe(e,"int32"),Im(t,e,n)))}function Fb(t){return se(t,t)}function IR(t,e,n){const r=e.shape;if(e.rank!==1&&e.rank!==t)throw new ue(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(t===5){if(n==="channelsFirst")return r.length===1?fe(e,[1,r[0],1,1,1]):fe(e,[1,r[3],r[0],r[1],r[2]]);if(n==="channelsLast")return r.length===1?fe(e,[1,1,1,1,r[0]]):fe(e,[1].concat(r))}else if(t===4){if(n==="channelsFirst")return r.length===1?fe(e,[1,r[0],1,1]):fe(e,[1,r[2],r[0],r[1]]);if(n==="channelsLast")return r.length===1?fe(e,[1,1,1,r[0]]):fe(e,[1].concat(r))}else if(t===3){if(n==="channelsFirst")return r.length===1?fe(e,[1,r[0],1]):fe(e,[1,r[1],r[0]]);if(n==="channelsLast")return r.length===1?fe(e,[1,1,r[0]]):fe(e,[1].concat(r))}else if(t<3)return e;throw new ue(`Unsupported input rank by biasAdd: ${e.rank}`)}function ol(t,e,n){return de(()=>(n==null&&(n=il()),jr(n),Be(t,IR(t.rank,e,n))))}function RFe(t,e=1){if(e!==1)throw new tn(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return z0(t)}function DFe(t){return de(()=>Tt(t,Be(pi(t),1)))}function E5(t,e,n,r){return de(()=>N4(t,e,n,r))}function PFe(t){return de(()=>{const e=Be(.5,se(.2,t));return ro(e,0,1)})}function Lb(t,e,n=!1){return n?t():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const OFe=["fanIn","fanOut","fanAvg"],FFe=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function LFe(t){zf(OFe,"FanMode",t)}function BFe(t){zf(FFe,"Distribution",t)}class wa extends bf{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class k5 extends wa{apply(e,n){return zr(e,n)}}k5.className="Zeros";Le(k5);class NR extends wa{apply(e,n){return io(e,n)}}NR.className="Ones";Le(NR);class A5 extends wa{constructor(e){super();if(typeof e!="object")throw new ue(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new ue(`config must have value set but got ${e}`);this.value=e.value}apply(e,n){return de(()=>se(Nt(this.value),io(e,n)))}getConfig(){return{value:this.value}}}A5.className="Constant";Le(A5);class M5 extends wa{constructor(e){super();this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,n){return Dm(e,this.minval,this.maxval,n)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}M5.className="RandomUniform";Le(M5);class I5 extends wa{constructor(e){super();this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new tn(`randomNormal does not support dType ${n}.`);return _2(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}I5.className="RandomNormal";Le(I5);class N5 extends wa{constructor(e){super();this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new tn(`truncatedNormal does not support dType ${n}.`);return GS(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}N5.className="TruncatedNormal";Le(N5);class $5 extends wa{constructor(e){super();this.gain=e.gain!=null?e.gain:1}apply(e,n){return de(()=>{if(e.length!==2||e[0]!==e[1])throw new ue("Identity matrix initializer can only be used for 2D square matrices.");return se(this.gain,AI(e[0]))})}getConfig(){return{gain:this.gain}}}$5.className="Identity";Le($5);function zFe(t,e="channelsLast"){let n,r;if(jr(e),t.length===2)n=t[0],r=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(e==="channelsFirst"){const i=ch(t,2);n=t[1]*i,r=t[0]*i}else if(e==="channelsLast"){const i=ch(t,0,t.length-2);n=t[t.length-2]*i,r=t[t.length-1]*i}}else{const i=ch(t);n=Math.sqrt(i),r=Math.sqrt(i)}return[n,r]}class uo extends wa{constructor(e){super();if(e.scale<0)throw new ue(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,LFe(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,BFe(this.distribution),this.seed=e.seed}apply(e,n){const r=zFe(e),i=r[0],s=r[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,i):this.mode==="fanOut"?o/=Math.max(1,s):o/=Math.max(1,(i+s)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new tn(`${this.getClassName()} does not support dType ${n}.`);return GS(e,0,a,n,this.seed)}else{const a=Math.sqrt(3*o);return Dm(e,-a,a,n)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}uo.className="VarianceScaling";Le(uo);class $R extends uo{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return uo.className}}$R.className="GlorotUniform";Le($R);class RR extends uo{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return uo.className}}RR.className="GlorotNormal";Le(RR);class DR extends uo{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return uo.className}}DR.className="HeNormal";Le(DR);class PR extends uo{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return uo.className}}PR.className="HeUniform";Le(PR);class OR extends uo{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return uo.className}}OR.className="LeCunNormal";Le(OR);class FR extends uo{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return uo.className}}FR.className="LeCunNormal";Le(FR);class R5 extends wa{constructor(e){super();if(this.DEFAULT_GAIN=1,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed,this.seed!=null)throw new tn("Random seed is not implemented for Orthogonal Initializer yet.")}apply(e,n){return de(()=>{if(e.length<2)throw new tn("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${e[0]*e[1]}) elements: Slowness may result.`);const r=e[0]>e[1]?[e[1],e[0]]:e,i=_2(r,0,1,"float32");let s=z4.gramSchmidt(i);return e[0]>e[1]&&(s=Mn(s)),se(this.gain,s)})}getConfig(){return{gain:this.gain,seed:this.seed}}}R5.className="Orthogonal";Le(R5);const D5={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function P5(t,e={}){return Rb(t,Ao.getMap().classNameMap,e,"initializer")}function Dr(t){return SR(t)}function kr(t){if(typeof t=="string"){const e=t in D5?D5[t]:t;if(e==="GlorotNormal")return new RR;if(e==="GlorotUniform")return new $R;if(e==="HeNormal")return new DR;if(e==="HeUniform")return new PR;if(e==="LeCunNormal")return new OR;if(e==="LeCunUniform")return new FR;{const n={};return n.className=e,n.config={},P5(n)}}else return t instanceof wa?t:P5(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let VFe=0;function O5(){return VFe++}const S2={};function C2(t=""){return t in S2||(S2[t]=0),S2[t]+=1,t+S2[t].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function LR(t){return Array.isArray(t)&&Array.isArray(t[0])}function T2(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function rn(t){let e;if(Array.isArray(t)){if(t.length!==1)throw new ue(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function qn(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new ue(`Expected exactly 1 Shape; got ${t.length}`)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function E2(t){let e=0;for(const n of t)n.shape.length===0?e+=1:e+=n.shape.reduce((r,i)=>r*i);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const F5="Variable";class UFe{constructor(e,n="float32",r=F5,i=!0,s=null){this.dtype=n==null?"float32":n,this.shape=e.shape,this.id=O5(),r=r==null?F5:r,this.originalName=x5(r),this.name=_5(this.originalName),this.trainable_=i,this.constraint=s,this.val=k4(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),WFe(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function WFe(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}function BR(t){return t.map(e=>e.read())}function zR(t){t.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class xi{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Ql{constructor(e,n,r,i,s,o,a){this.dtype=e,this.shape=n,this.sourceLayer=r,this.inputs=i,this.callArgs=s,this.outputTensorIndex=a,this.id=O5(),o!=null&&(this.originalName=x5(o),this.name=_5(this.originalName)),this.rank=n.length}}let GFe=0;class k2{constructor(e,n){this.callArgs=n,this.id=GFe++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const r of e.inboundLayers)r!=null&&r.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const n of this.inboundLayers)n!=null?e.push(n.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let HFe=0;class Pn extends bf{constructor(e={}){super();this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=HFe++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let n=e.name;if(!n){const r=this.getClassName();n=Hc(r)+"_"+C2(r)}if(this.name=n,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let r;if(e.batchInputShape!=null)r=e.batchInputShape;else if(e.inputShape!=null){let s=null;e.batchSize!=null&&(s=e.batchSize),r=[s].concat(e.inputShape)}this.batchInputShape=r;let i=e.dtype;i==null&&(i=e.inputDType),i==null&&(i="float32"),this.dtype=i}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,n){return e.name+"_ib-"+n.toString()}getNodeAtIndex(e,n){if(this.inboundNodes.length===0)throw new ya(`The layer has never been called and thus has no defined ${n}.`);if(this.inboundNodes.length<=e)throw new ue(`Asked to get ${n} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Vs(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Vs(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Yl(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Yl(`Layer ${this.name} is not connected, no input to return.`);return Vs(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Yl(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Yl(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Vs(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(n=>n.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){if(e=yr(e),this.inputSpec==null||this.inputSpec.length===0)return;const n=yr(this.inputSpec);if(e.length!==n.length)throw new ue(`Layer ${this.name} expects ${n.length} inputs, but it received ${e.length} input tensors. Input received: ${e}`);for(let r=0;r<e.length;r++){const i=e[r],s=n[r];if(s==null)continue;const o=i.rank;if(s.ndim!=null&&o!==s.ndim)throw new ue(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${s.ndim}, found ndim=${o}`);if(s.maxNDim!=null&&o>s.maxNDim)throw new ue(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${s.maxNDim}, found ndim=${o}`);if(s.minNDim!=null&&o<s.minNDim)throw new ue(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${s.minNDim}, found ndim=${o}.`);if(s.dtype!=null&&i.dtype!==s.dtype)throw new ue(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${s.dtype}, found dtype=${i.dtype}.`);if(s.axes){const a=i.shape;for(const l in s.axes){const c=Number(l),u=s.axes[l],h=c>=0?a[c]:a[a.length+c];if(u!=null&&[u,null].indexOf(h)===-1)throw new ue(`Input ${r} is incompatible with layer ${this.name}: expected axis ${c} of input shape to have value ${u} but got shape ${a}.`)}}if(s.shape!=null)for(let a=0;a<s.shape.length;++a){const l=s.shape[a],c=i.shape[a];if(l!=null&&c!=null&&l!==c)throw new ue(`Input ${r} is incompatible with layer ${this.name}: expected shape=${s.shape}, found shape=${i.shape}.`)}}}call(e,n){return e}invokeCallHook(e,n){this._callHook!=null&&this._callHook(e,n)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,n){n=n||{},this.assertNotDisposed();const r=yr(e);let i=!0;for(const o of r)if(!(o instanceof Ql)){i=!1;break}let s=!0;for(const o of r)if(o instanceof Ql){s=!1;break}if(i===s)throw new ue("Arguments to apply() must be all SymbolicTensors or all Tensors");return Vf(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const o=[];for(const a of yr(e))o.push(a.shape);this.build(Vs(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&s&&(this._refCount=1)}if(this.assertInputCompatibility(e),s){let o=this.call(e,n);const a=yr(o),l=[];for(let c of a)r.indexOf(c)!==-1&&(c=c.clone()),l.push(c);if(o=Vs(l),this.activityRegularizer!=null)throw new tn("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=jFe(e),a=this.computeOutputShape(o);let l;const c=qFe(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((u,h)=>new Ql(c,u,this,yr(e),n,this.name,h)):l=new Ql(c,a,this,yr(e),n,this.name),this.addInboundNode(e,l,null,null,o,a,n),this._refCount++,this.activityRegularizer!=null)throw new tn("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let n=!1;this.batchInputShape.forEach((r,i)=>{r!=null&&e[i]!=null&&e[i]!==r&&(n=!0)}),n&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Yl(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const n of this.inboundNodes){const r=JSON.stringify(n.outputShapes);e.indexOf(r)===-1&&e.push(r)}if(e.length===1){const n=this.inboundNodes[0].outputShapes;return Array.isArray(n)&&Array.isArray(n[0])&&n.length===1?n[0]:n}else throw new Yl(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new ya(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return E2(this.weights)}build(e){this.built=!0}getWeights(e=!1){return BR(e?this.trainableWeights:this.weights)}setWeights(e){de(()=>{const n=this.weights;if(n.length!==e.length)throw new ue(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${n.length} weights. Provided weights: ${e}...`);if(n.length===0)return;const r=[],i=BR(n);for(let s=0;s<i.length;++s){const o=i[s],a=n[s],l=e[s];if(!wn(o.shape,l.shape))throw new ue(`Layer weight shape ${o.shape} not compatible with provided weight shape ${l.shape}`);r.push([a,l])}zR(r)})}addWeight(e,n,r,i,s,o,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new ue(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),r==null&&(r="float32"),this.fastWeightInitDuringBuild&&(i=l!=null?l():kr("zeros"));const c=i.apply(n,r),u=new UFe(c,r,e,o,a);return c.dispose(),s!=null&&this.addLoss(()=>s.apply(u.read())),o==null&&(o=!0),o?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=yr(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,n){if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(r=>{if(r!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return n}addInboundNode(e,n,r,i,s,o,a=null){const l=yr(e);n=yr(n),r=yr(r),i=yr(i),s=T2(s),o=T2(o);const c=[],u=[],h=[];for(const f of l)c.push(f.sourceLayer),u.push(f.nodeIndex),h.push(f.tensorIndex);new k2({outboundLayer:this,inboundLayers:c,nodeIndices:u,tensorIndices:h,inputTensors:l,outputTensors:n,inputMasks:r,outputMasks:i,inputShapes:s,outputShapes:o},a);for(let f=0;f<n.length;f++)n[f].sourceLayer=this,n[f].nodeIndex=this.inboundNodes.length-1,n[f].tensorIndex=f}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount==0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function jFe(t){t=yr(t);const e=[];for(const n of t)e.push(n.shape);return Vs(e)}function qFe(t){return"float32"}function L5(t,e,n){if((e==null||n!=null&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),e.inboundNodes.length===0)return[t];{const r=e.inboundNodes[n];if(r.inboundLayers.length===0)return r.inputTensors;{const i=[];for(let s=0;s<r.inboundLayers.length;s++){const o=r.inputTensors[s],a=r.inboundLayers[s],l=r.nodeIndices[s],c=L5(o,a,l);for(const u of c)i.indexOf(u)===-1&&i.push(u)}return i}}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Bb extends Pn{constructor(e){super({dtype:e.dtype,name:e.name!=null?e.name:C2("input").toString()});if(e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new ue("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let n=e.batchInputShape;if(n==null){if(e.inputShape==null)throw new ue("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new ue("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const r=e.dtype||"float32";this.batchInputShape=n,this.dtype=r,this.inputSpec=[{shape:n}];const i=new Ql(this.dtype,this.batchInputShape,this,[],{},this.name);i.nodeIndex=0,i.tensorIndex=0,new k2({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]})}apply(e,n){throw new ue(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Bb.className="InputLayer";Le(Bb);function XFe(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new ue("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;t.shape!=null&&e==null&&(e=[null].concat(t.shape));let n=t.dtype;return n==null&&(n="float32"),new Bb({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Wf(t){if(t==null)return;const e=[],n=[],r=[];for(const i in t){const s=t[i];if(typeof s!="number"){const o=s;e.push(o.data()),n.push(i),r.push(o)}}if(e.length>0){const i=await Promise.all(e);for(let s=0;s<i.length;++s)t[n[s]]=i[s][0];on(r)}}function B5(t){if(t!=null)for(const e in t){const n=t[e];typeof n!="number"&&n.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var z5;(function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"})(z5||(z5={}));const KFe=125;class zb{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,n){}async onEpochEnd(e,n){}async onBatchBegin(e,n){}async onBatchEnd(e,n){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class YFe{constructor(e,n=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=n}append(e){this.callbacks.push(e)}setParams(e){for(const n of this.callbacks)n.setParams(e)}setModel(e){for(const n of this.callbacks)n.setModel(e)}async onEpochBegin(e,n){n==null&&(n={});for(const r of this.callbacks)await r.onEpochBegin(e,n)}async onEpochEnd(e,n){n==null&&(n={});for(const r of this.callbacks)await r.onEpochEnd(e,n)}async onBatchBegin(e,n){n==null&&(n={});for(const r of this.callbacks)await r.onBatchBegin(e,n)}async onBatchEnd(e,n){n==null&&(n={});for(const r of this.callbacks)await r.onBatchEnd(e,n)}async onTrainBegin(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainEnd(e)}}class ZFe extends zb{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,n){n==null&&(n={});const r=n.size==null?0:n.size;this.seen+=r;for(const i in n){const s=n[i];if(typeof s=="number")this.totals.hasOwnProperty(i)||(this.totals[i]=0),this.totals[i]=this.totals[i]+s*r;else{let o;i in this.totals?o=this.totals[i]:this.totals[i]=0;const a=de(()=>Be(this.totals[i],se(s,r)));this.totals[i]=a,o!=null&&o.dispose()}}}async onEpochEnd(e,n){if(n!=null)for(const r of this.params.metrics)this.totals[r]!=null&&(typeof this.totals[r]=="number"?n[r]=this.totals[r]/this.seen:de(()=>{const i=se(Tt(1,this.seen),this.totals[r]);n[r]=i,this.totals[r].dispose(),Tr(n[r])}))}}class JFe extends zb{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,n){n==null&&(n={}),this.epoch.push(e);for(const r in n)this.history[r]==null&&(this.history[r]=[]),this.history[r].push(n[r])}async syncData(){const e=[],n=[],r=[];for(const s in this.history){const o=this.history[s];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const l=o[a];e.push(l.data()),n.push(s),r.push(a)}}const i=await Promise.all(e);for(let s=0;s<i.length;++s)this.history[n[s]][r[s]].dispose(),this.history[n[s]][r[s]]=i[s][0]}}class QFe extends zb{constructor(e,n){super();if(this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||V4,this.yieldEvery=n||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=KFe),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");i_(this.yieldEvery)&&(this.maybeWait=wFe(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,n,r){const i=[];this.yield!=null&&(await Wf(r),i.push(this.yield(e,n,r))),i.push(this.nextFrameFunc()),await Promise.all(i)}async onEpochBegin(e,n){this.currentEpoch=e,this.epochBegin!=null&&(await Wf(n),await this.epochBegin(e,n))}async onEpochEnd(e,n){const r=[];this.epochEnd!=null&&(await Wf(n),r.push(this.epochEnd(e,n))),this.yieldEvery==="epoch"&&r.push(this.nextFrameFunc()),await Promise.all(r)}async onBatchBegin(e,n){this.batchBegin!=null&&(await Wf(n),await this.batchBegin(e,n))}async onBatchEnd(e,n){const r=[];this.batchEnd!=null&&(await Wf(n),r.push(this.batchEnd(e,n))),this.yieldEvery==="batch"?r.push(this.nextFrameFunc()):i_(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,e,n)),await Promise.all(r)}async onTrainBegin(e){this.trainBegin!=null&&(await Wf(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Wf(e),await this.trainEnd(e))}}function V5(t,e){return t==null&&(t={}),t instanceof zb?[t]:Array.isArray(t)&&t[0]instanceof zb?t:yr(t).map(r=>new QFe(r,e))}class xa{constructor(){}static registerCallbackConstructor(e,n){z(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),xa.checkForDuplicate(n),xa.constructors[e]==null&&(xa.constructors[e]=[]),xa.constructors[e].push(n)}static checkForDuplicate(e){for(const n in xa.constructors)xa.constructors[+n].forEach(i=>{if(i===e)throw new ue("Duplicate callback constructor.")})}static clear(){xa.constructors={}}static createCallbacks(e){const n=[];for(const r in xa.constructors){const i=+r;e>=i&&n.push(...xa.constructors[i])}return n.map(r=>new r)}}xa.constructors={};function U5(t,e,n,r,i,s,o,a,l){const c=new JFe,u=[new ZFe,...xa.createCallbacks(e)];t!=null&&u.push(...t),u.push(c);const h=new YFe(u);return h.setParams({epochs:n,initialEpoch:r,samples:i,steps:s,batchSize:o,verbose:e,doValidation:a,metrics:l}),{callbackList:h,history:c}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ec(t,e={},n=!1){return Rb(t,Ao.getMap().classNameMap,e,"layer",n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function A2(t,e){return de(()=>{t.dtype!=="float32"&&(t=Qe(t,"float32"));const n=xt(Fb(t),e,!0),r=Mm(n.shape,yi()),i=es(Bc(n,r));return Tt(t,i)})}function M2(t,e){return de(()=>Br(Fb(mt(e,t)),-1))}function VR(t,e){return de(()=>Br(pi(mt(e,t)),-1))}function UR(t,e){return de(()=>{const n=mt(t,e),r=ro(pi(t),yi(),Number.MAX_VALUE),i=pi(Tt(n,r));return se(100,Br(i,-1))})}function eLe(t,e){return de(()=>{const n=ro(e,yi(),Number.MAX_VALUE),r=$o(Be(1,n)),i=ro(t,yi(),Number.MAX_VALUE),s=$o(Be(1,i));return Br(Fb(mt(r,s)),-1)})}function tLe(t,e){return de(()=>{const n=Bc(0,mt(1,se(t,e)));return Br(Fb(n),-1)})}function nLe(t,e){return de(()=>{const n=Bc(0,mt(1,se(t,e)));return Br(n,-1)})}function rLe(t,e){return de(()=>{const n=xt(se(t,e),-1),r=Ja(se(mt(1,t),e),-1);return Bc(0,Be(1,mt(r,n)))})}function iLe(t,e){return de(()=>{const n=Math.log(2),r=mt(e,t),i=mt(Be(r,Nm(se(-2,r))),n);return Br(i,-1)})}function Vb(t,e,n=!1){return de(()=>{if(n)e=H0(e);else{const r=xt(e,e.shape.length-1,!0);e=Tt(e,r)}return e=ro(e,yi(),1-yi()),$r(xt(se(Qe(t,"float32"),$o(e)),e.shape.length-1))})}function I2(t,e,n=!1){return de(()=>{const r=Qe(V0(NFe(t)),"int32");e=ro(e,yi(),1-yi());const i=e.shape,s=fe(O0(r,i[i.length-1]),i);return Vb(s,e,n)})}function sLe(t,e){if(!wn(t.shape,e.shape))throw new ue(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return de(()=>{const n=Ul(e),r=$r(pi(e));return Be(mt(n,se(e,t)),NS(Mo(r)))})}function N2(t,e){return de(()=>{let n;return n=ro(e,yi(),1-yi()),n=$o(Tt(n,mt(1,n))),Br(sLe(t,n),-1)})}function oLe(t,e){return de(()=>{const n=ro(t,yi(),1),r=ro(e,yi(),1);return xt(se(t,$o(Tt(n,r))),-1)})}function aLe(t,e){return de(()=>{const n=$o(Be(yi(),e));return Br(mt(e,se(t,n)),-1)})}function W5(t,e){return de(()=>{const n=A2(t,-1),r=A2(e,-1),i=se(n,r);return $r(xt(i,-1))})}const $2={meanSquaredError:M2,meanAbsoluteError:VR,meanAbsolutePercentageError:UR,meanSquaredLogarithmicError:eLe,squaredHinge:tLe,hinge:nLe,categoricalHinge:rLe,logcosh:iLe,categoricalCrossentropy:Vb,sparseCategoricalCrossentropy:I2,binaryCrossentropy:N2,kullbackLeiblerDivergence:oLe,poisson:aLe,cosineProximity:W5};function WR(t){if(typeof t=="string"){if(t in $2)return $2[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new ue(e)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function G5(t,e){return de(()=>{const n=se(.5,Ro(e)),r=w2(No(e,n),t.dtype);return Br(Za(t,r),-1)})}function H5(t,e){return de(()=>w2(Za(Tm(t,-1),Tm(e,-1)),"float32"))}function lLe(t,e){return de(()=>Qe(xt(Vl(Za(t,1),Za(e,1))),"float32"))}function cLe(t,e){return de(()=>Qe(xt(Vl(Za(t,0),Za(e,1))),"float32"))}function uLe(t,e){return de(()=>{const n=lLe(t,e),r=cLe(t,e),i=Be(n,r);return Qe(Bs(No(i,0),Tt(n,i),0),"float32")})}function hLe(t,e){return N2(t,e)}function fLe(t,e){return t.rank===e.rank&&(t=Wl(t,[t.rank-1])),e=Tm(e,-1),e.dtype!==t.dtype&&(e=Qe(e,t.dtype)),Qe(Za(t,e),"float32")}const dLe=M2,pLe=M2,mLe=VR,gLe=VR,vLe=UR,yLe=UR,j5=Vb,bLe=W5,q5=I2,R2={binaryAccuracy:G5,categoricalAccuracy:H5,precision:uLe,categoricalCrossentropy:j5,sparseCategoricalCrossentropy:q5,mse:dLe,MSE:pLe,mae:mLe,MAE:gLe,mape:vLe,MAPE:yLe,cosine:bLe};function wLe(t){if(typeof t=="string"&&t in R2)return R2[t];if(typeof t!="string"&&t!=null)return t;throw new ue(`Unknown metric ${t}`)}function D2(t){if(Zl(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let e;for(const n of Object.keys($2))if($2[n]===t){e=n;break}if(e!==void 0)return e;for(const n of Object.keys(R2))if(R2[n]===t){e=n;break}return e!==void 0?e:t.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xLe(t){const e={Adagrad:()=>Yu.adagrad(.01),Adadelta:()=>Yu.adadelta(1,.95,yi()),Adam:()=>Yu.adam(.001,.9,.999,yi()),Adamax:()=>Yu.adamax(.002,.9,.999,yi(),0),RMSProp:()=>Yu.rmsprop(.001,.9,0,yi()),SGD:()=>Yu.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new ue(`Unknown Optimizer ${t}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const X5=1*1024*1024;function K5(t,e,n=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!GR(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const r=JSON.stringify(t);r.length>X5&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${X5}.`)}}function GR(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);for(const n of e)if(typeof n!="string"||!GR(t[n]))return!1;return!0}else if(Array.isArray(t)){for(const e of t)if(!GR(e))return!1;return!0}else return!1;else{const e=typeof t;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _Le(t,e,n,r=console.log){const i=CLe(t),s=["Layer (type)","Output shape","Param #"];i?(e=e||65,n=n||[.45,.85,1]):(e=e||98,n=n||[.33,.55,.67,1]),n[n.length-1]<=1&&(n=n.map(u=>Math.floor(e*u)));let o;if(!i){s.push("Receives inputs"),o=[];for(const u in t.nodesByDepth)o.push(...t.nodesByDepth[u])}r("_".repeat(e)),P2(s,n,r),r("=".repeat(e));const a=t.layers;for(let u=0;u<a.length;++u)i?TLe(a[u],n,r):ELe(a[u],n,o,r),r((u===a.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const l=SLe(t),c=E2(t.nonTrainableWeights);r(`Total params: ${l+c}`),r(`Trainable params: ${l}`),r(`Non-trainable params: ${c}`),r("_".repeat(e))}function SLe(t){let e;return t.collectedTrainableWeights!=null?e=E2(t.collectedTrainableWeights):e=E2(t.trainableWeights),e}function CLe(t){let e=!0;const n=[],r=[];for(const i in t.nodesByDepth)n.push(t.nodesByDepth[i]);for(const i of n){if(i.length>1||i.length===1&&i[0].inboundLayers.length>1){e=!1;break}r.push(...i)}if(e)for(const i of t.layers){let s=!1;for(const o of i.inboundNodes)if(r.indexOf(o)!==-1)if(s){e=!1;break}else s=!0;if(!e)break}return e}function P2(t,e,n=console.log){let r="";for(let i=0;i<t.length;++i)i>0&&(r=r.slice(0,r.length-1)+" "),r+=t[i],r=r.slice(0,e[i]),r+=" ".repeat(e[i]-r.length);n(r)}function TLe(t,e,n){let r;try{r=JSON.stringify(t.outputShape)}catch{r="multiple"}const i=t.name,s=t.getClassName(),o=[`${i} (${s})`,r,t.countParams().toString()];P2(o,e,n)}function ELe(t,e,n,r){let i;try{i=JSON.stringify(t.outputShape)}catch{i="multiple"}const s=[];for(const u of t.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(u)===-1))for(let h=0;h<u.inboundLayers.length;++h){const f=u.inboundLayers[h].name,d=u.nodeIndices[h],p=u.tensorIndices[h];s.push(`${f}[${d}][${p}]`)}const o=t.name,a=t.getClassName(),l=s.length===0?"":s[0],c=[`${o} (${a})`,i,t.countParams().toString(),l];P2(c,e,r);for(let u=1;u<s.length;++u)P2(["","","",s[u]],e,r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Y5(t,e,n){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&e===0&&typeof n=="string"}function O2(t,e){if(t===null)return null;if(typeof t=="string")return Bf(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],r=t.length;for(let i=0;i<r;++i){const s=t[i];Y5(e,i,s)?n.push(s):n.push(O2(s,e))}return n}else{const n={};for(const r of Object.keys(t)){const i=t[r];if(r==="name"&&typeof i=="string")n[r]=i;else{const s=Bf(r);n[s]=O2(i,s)}}return n}}function HR(t,e){if(t==null)return null;if(typeof t=="string")return Hc(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],r=t.length;for(let i=0;i<r;++i){const s=t[i];Y5(e,i,s)?n.push(s):n.push(HR(s,e))}return n}else{const n={};for(const r of Object.keys(t)){const i=t[r],s=Hc(r);(r==="name"||r==="className")&&typeof i=="string"?n[s]=i:n[s]=HR(i,r)}return n}}/** @license See the LICENSE file. */const Z5="3.12.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function kLe(t,e){if(t.dtype==null||t.dtype===e.dtype)return e;try{return Qe(e,t.dtype)}catch{throw new ue(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}class hh{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof hh)for(const n in e.id2Value)this.id2Value[n]=e.id2Value[n],n in e.id2Mask&&(this.id2Mask[n]=e.id2Mask[n]);else{if(e==null)return;for(const n of e)this.add(n.key,n.value)}}add(e,n,r){if(this.id2Value[e.id]==null)this.id2Value[e.id]=kLe(e,n),this.name2Id[e.name]=e.id,r!=null&&(this.id2Mask[e.id]=r);else throw new ue(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Ql){if(this.id2Value[e.id]==null)throw new ue(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const n=this.name2Id[e];if(n==null)throw new ue(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[n]}}getMask(e){if(e instanceof Ql){if(this.id2Value[e.id]==null)throw new ue(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const n=this.name2Id[e];if(n==null)throw new ue(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&on(this.id2Mask)}}const jR={},J5={};function Ub(t,e,n,r){const i=n==null?!1:n.training,s=Array.isArray(t),o=s?t:[t],a=o.map(p=>p.name),l=[],c=e.names();for(const p of a)c.indexOf(p)!==-1?l.push(e.getValue(p)):l.push(null);r!=null&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);const u=a.join(",")+"|"+e.names().join(",");let h,f;if(jR[u]==null){const p=ALe(o,e);h=p.sorted,f=p.recipientCounts,jR[u]=h,J5[u]=f}h=jR[u],f={},i||Object.assign(f,J5[u]);const d=new hh(e);for(let p=0;p<h.length;++p){if(r!=null){const A=SS().numTensors;A>r.maxNumTensors&&(r.maxNumTensors=A),A<r.minNumTensors&&(r.minNumTensors=A)}const m=h[p],v=m.sourceLayer;if(v instanceof Bb)continue;const y=[],w=[],x=[];let _=!1;for(const A of m.inputs){const M=d.getValue(A),D=d.getMask(A);y.push(M),w.push(D),D!=null&&(_=!0),i||(f[A.name]--,f[A.name]===0&&!e.hasKey(A)&&a.indexOf(A.name)===-1&&!M.isDisposed&&A.sourceLayer.stateful!==!0&&x.push(M))}_&&(n=n||{},n.mask=w[0]);const S=yr(v.apply(y,n));let T=null;v.supportsMasking&&(T=v.computeMask(y,w));const E=ILe(m),k=Array.isArray(E)?E:[E];for(let A=0;A<k.length;++A){d.hasKey(k[A])||d.add(k[A],S[A],Array.isArray(T)?T[0]:T);const M=a.indexOf(k[A].name);M!==-1&&(l[M]=S[A])}i||on(x)}return d.disposeMasks(),s?l:l[0]}function ALe(t,e){z(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let n=[],r={};if(t.length===1){const i=Q5(t[0],e);n=i.sorted,r=i.recipientMap}else{const i=new Set;for(const s of t){const{sorted:o,recipientMap:a}=Q5(s,e);for(const l of o)i.has(l.name)||(n.push(l),i.add(l.name));for(const l in a)r[l]==null&&(r[l]=new Set),a[l].forEach(c=>r[l].add(c))}}return{sorted:n,recipientCounts:MLe(r)}}function MLe(t){const e={};for(const n in t)e[n]=t[n].size;return e}function Q5(t,e){const n=new Set,r=[],i={};for(const a of e.names())n.add(a);const s=[],o=[];for(s.push(t);s.length>0;){const a=s[s.length-1];if(n.has(a.name)){s.pop();continue}const l=o[o.length-1]===s.length-1;if(a.inputs.length===0||l)s.pop(),r.push(a),n.add(a.name),l&&o.pop();else{o.push(s.length-1);for(const c of a.inputs)i[c.name]==null&&(i[c.name]=new Set),i[c.name].add(a.name),!n.has(c.name)&&s.push(c)}}return{sorted:r,recipientMap:i}}function ILe(t){let e;if(t.sourceLayer.inboundNodes.length===1)e=t.sourceLayer.output;else{let n=null;for(let r=0;r<t.sourceLayer.inboundNodes.length;++r)for(const i of t.sourceLayer.inboundNodes[r].outputTensors)if(i.id===t.id){n=r;break}e=t.sourceLayer.getOutputAt(n)}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class al extends Pn{constructor(e){super({});if(this.containerNodes=new Set,this.name=e.name,this.name==null){const w=this.getClassName().toLowerCase();this.name=C2(w)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],lh(this.inputs).length!==this.inputs.length)throw new ue(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(w=>w.name)}`);lh(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(w=>w.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const w of this.outputs){const x=w.sourceLayer,_=w.nodeIndex,S=w.tensorIndex;this.outputLayers.push(x),this.outputLayersNodeIndices.push(_),this.outputLayersTensorIndices.push(S)}for(const w of this.inputs){const x=w.sourceLayer,_=w.nodeIndex,S=w.tensorIndex;Zl(_===0,"input layer has >1 nodes"),Zl(S===0,"input layer has >1 tensors"),this.inputLayers.push(x),this.inputLayersNodeIndices.push(_),this.inputLayersTensorIndices.push(S)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let w=0;w<this.inputLayers.length;w++){const x=this.inputLayers[w];if(!(x instanceof Bb))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${w} (0-based) originates from layer type ${x.getClassName()}.`);this.inputNames.push(x.name),this.feedInputShapes.push(x.batchInputShape),this.feedInputNames.push(x.name)}for(const w of this.outputLayers)this.outputNames.push(w.name);this.internalInputShapes=this.inputs.map(w=>w.shape),this.internalOutputShapes=this.outputs.map(w=>w.shape);const n={},r={},i={},s={},o={},a=[],l=(w,x,_,S,T,E)=>{(S==null||T==null||E==null)&&(S=w.sourceLayer,T=w.nodeIndex,E=w.tensorIndex);const k=S.inboundNodes[T];if(_.indexOf(k)!==-1)throw new ya(`The tensor ${w.name} at layer "${S.name}" is part of a cycle.`);if(x.indexOf(k)!==-1)return;this.containerNodes.add(al.nodeKey(S,T)),S.id in o||(o[S.id]=Object.keys(o).length),_.indexOf(k)===-1&&_.push(k);const A=k.inboundLayers.length;for(let M=0;M<A;M++){const D=k.inputTensors[M],P=k.inboundLayers[M],N=k.nodeIndices[M],R=k.tensorIndices[M];l(D,x,_,P,N,R)}for(x.push(k);_.indexOf(k)>=0;)_.splice(_.indexOf(k),1);a.push(k)},c=[],u=[];for(const w of this.outputs)l(w,c,u);const h=a.slice().reverse();for(const w of h){r[w.id]=w,w.id in n||(n[w.id]=0);let x=n[w.id];const _=i[w.outboundLayer.id]==null?0:i[w.outboundLayer.id];x=Math.max(x,_),i[w.outboundLayer.id]=x,s[w.outboundLayer.id]=w.outboundLayer,n[w.id]=x;for(let S=0;S<w.inboundLayers.length;S++){const T=w.inboundLayers[S],E=w.nodeIndices[S],k=T.inboundNodes[E],A=n[k.id]==null?0:n[k.id];n[k.id]=Math.max(x+1,A),r[k.id]=k}}const f={};for(const w in n){const x=n[w];x in f||(f[x]=[]),f[x].push(r[w])}const d={};for(const w in i){const x=i[w];x in d||(d[x]=[]),d[x].push(s[w])}let p=Object.keys(d).map(w=>parseInt(w,10)).sort(b2);this.layers=[];for(const w of p){const x=d[w];x.sort((_,S)=>{const T=o[_.id],E=o[S.id];return T<E?-1:T>E?1:0});for(const _ of x)_ instanceof al&&this.internalContainerRefs.push(_),this.layers.push(_)}this.layersByDepth=d,p=Object.keys(f).map(w=>parseInt(w,10)).sort(b2);const m=this.inputs.slice(),v=[];for(const w of p)for(const x of f[w]){const _=x.outboundLayer;if(_!=null){for(const S of x.inputTensors)if(m.indexOf(S)===-1)throw new ya(`Graph disconnected: cannot obtain value for tensor ${S} at layer "${_.name}". The following previous layers were accessed without issue: ${v}`);for(const S of x.outputTensors)m.push(S);v.push(_.name)}}this.nodesByDepth=f;const y=this.layers.map(w=>w.name);for(const w of y){const x=y.filter(_=>_===w).length;if(x!==1)throw new ya(`The name "${w}" is used ${x} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(y))}this.outboundNodes=[],this.inboundNodes=[],new k2({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(w=>null),outputMasks:this.outputs.map(w=>null),inputShapes:this.inputs.map(w=>w.shape),outputShapes:this.outputs.map(w=>w.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount==0){for(const n of this.layers)e.numDisposedVariables+=n.dispose().numDisposedVariables;for(const n of this.internalContainerRefs)e.numDisposedVariables+=n.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(n=>{n._trainableWeights.forEach(r=>r.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new ue("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const n of this.layers)e=e.concat(n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.layers)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const r of this.layers)n.push(...r.trainableWeights);return n.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,n=!0){const r={};let i=0;for(const o of this.layers)for(const a of o.weights){if(r[a.originalName]!=null)throw new ue(`Duplicate weight name: ${a.originalName}`);r[a.originalName]=a,i++}const s=[];for(const o in e){let a=o;if(r[o]==null){const l=o.split("/");a=l.slice(0,-2).concat([l[l.length-1]]).join("/")}if(r[a]!=null)s.push([r[a],e[o]]);else if(n)throw new ue(`Provided weight data has no target variable: ${o}`);delete r[a]}if(n){const o=[];for(const a in r)o.push(a);if(o.length>0)throw new ue(`${o.length} of ${i} weights are not set: ${o}`)}zR(s)}updatedConfig(){const e=this.getConfig(),n={};return n.className=this.getClassName(),n.config=e,n.kerasVersion=`tfjs-layers ${Z5}`,n.backend="TensorFlow.js",n}toJSON(e,n=!0){const r=HR(this.updatedConfig());return n?JSON.stringify(r):r}call(e,n){return de(()=>{e=yr(e);const r=new hh;for(let i=0;i<this.inputs.length;++i)r.add(this.inputs[i],e[i]);return Ub(this.outputs,r,n)})}computeMask(e,n){return de(()=>{e=yr(e);let r;return n==null?r=Lf(null,e.length):r=yr(n),this.runInternalGraph(e,r)[1]})}computeOutputShape(e){const n=T2(e);if(n.length!==this.inputLayers.length)throw new ue(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const r={};for(let a=0;a<n.length;a++){const l=this.inputLayers[a],c=n[a],u=l.name+"_0_0";r[u]=c}const i=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(b2);if(i.length>1)for(const a of i){const l=this.nodesByDepth[a];for(const c of l){const u=c.outboundLayer;if(this.inputLayers.map(m=>m.id).indexOf(u.id)!==-1)continue;const h=[];for(let m=0;m<c.inboundLayers.length;m++){const v=c.inboundLayers[m],y=c.nodeIndices[m],w=c.tensorIndices[m],x=`${v.name}_${y}_${w}`,_=r[x];h.push(_)}const f=u.computeOutputShape(Vs(h)),d=T2(f),p=u.inboundNodes.indexOf(c);for(let m=0;m<d.length;m++){const v=`${u.name}_${p}_${m}`;r[v]=d[m]}}}const s=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],c=this.outputLayersNodeIndices[a],u=this.outputLayersTensorIndices[a],h=`${l.name}_${c}_${u}`;o.push(h)}for(let a=0;a<o.length;a++){const l=o[a];Zl(l in r),s.push(r[l])}return Vs(s)}runInternalGraph(e,n){n==null&&(n=Lf(null,e.length));const r={};for(let l=0;l<this.inputs.length;++l){const c=this.inputs[l],u=e[l],h=n[l];r[c.id]=[u,h]}const i=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(b2);for(const l of i){const c=this.nodesByDepth[l];for(const u of c){const h=u.outboundLayer,f=u.inputTensors,d=u.outputTensors,p=new Array;for(const m of f)m.id in r&&p.push(r[m.id]);if(p.length===f.length){let m={},v,y,w,x;if(u.callArgs!=null&&(m=u.callArgs),p.length===1){const[_,S]=p[0];m.mask==null&&(m.mask=S),w=yr(h.call(_,m)),x=yr(h.computeMask(_,S)),v=[_],y=[S]}else v=p.map(_=>_[0]),y=p.map(_=>_[1]),m.mask==null&&(m.mask=y),w=yr(h.call(v,m)),x=yr(h.computeMask(v,y));if(h.activityRegularizer)throw new tn("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let _=0;_<d.length;++_){const S=d[_],T=w[_],E=x[_];r[S.id]=[T,E]}}}}const s=[],o=[],a=[];for(const l of this.outputs){Zl(l.id in r,`Could not compute output ${l.name} : ${l.id}`);const[c,u]=r[l.id];a.push(c.shape),s.push(c),o.push(u)}return[s,o,a]}buildNodeConversionMap(e){const n={};let r;for(const i of this.layers){r=i instanceof al?1:0;for(let s=0;s<i.inboundNodes.length;s++){const o=al.nodeKey(i,s);this.containerNodes.has(o)&&(n[o]=r,r+=1)}}return n}getLayer(e,n){if(n!=null){if(this.layers.length<=n)throw new ue(`Was asked to retrieve layer at index ${n}, but model only has ${this.layers.length} layer(s).`);return this.layers[n]}else if(e==null)throw new ue("Provide either a layer name or layer index");for(const r of this.layers)if(r.name===e)return r;throw new ue(`No such layer: ${e}`)}calculateLosses(){return de(()=>{const e=[];for(const n of this.layers)for(let r=0;r<n.inboundNodes.length;++r){const i=al.nodeKey(n,r);this.containerNodes.has(i)&&e.push(...n.calculateLosses())}return e})}getConfig(){const e={name:this.name},n=this.buildNodeConversionMap(this.layers),r=[];for(const o of this.layers){const a=o.getClassName(),l=o.getConfig(),c=[];for(let h=0;h<o.inboundNodes.length;h++){const f=o.inboundNodes[h],d=al.nodeKey(o,h);let p={};if(this.containerNodes.has(d)){if(f.callArgs)try{JSON.stringify(f.callArgs),p=f.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${f.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),p={}}if(f.inboundLayers.length>0){const m=[];for(let v=0;v<f.inboundLayers.length;v++){const y=f.inboundLayers[v],w=f.nodeIndices[v],x=f.tensorIndices[v],_=al.nodeKey(y,w);let S=n[_];S==null&&(S=0),m.push([y.name,S,x,p])}c.push(m)}}}const u={};u.name=o.name,u.className=a,u.config=l,u.inboundNodes=c,r.push(u)}e.layers=r;const i=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],l=this.inputLayersNodeIndices[o],c=al.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=n[c];u==null&&(u=0);const h=this.inputLayersTensorIndices[o];i.push([a.name,u,h])}e.inputLayers=i;const s=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],l=this.outputLayersNodeIndices[o],c=al.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=n[c];u==null&&(u=0);const h=this.outputLayersTensorIndices[o];s.push([a.name,u,h])}return e.outputLayers=s,e}static fromConfig(e,n,r={},i=!1){const s={},o={};function a(v,y){v.name in o?o[v.name].push(y):o[v.name]=[y]}function l(v,y){const w=[];let x;for(const _ of y){const S=_[0],T=_[1],E=_[2];if(x=_[3]==null?{}:_[3],!(S in s)){a(v,y);return}const k=s[S];if(k.inboundNodes.length<=T){a(v,y);return}const A=k.inboundNodes[T];w.push(A.outputTensors[E])}w.length>0&&v.apply(Vs(w),x)}function c(v){const y=v.name,w=ec(v,n.customObjects!=null?n.customObjects:{});w.setFastWeightInitDuringBuild(i),s[y]=w,v.inboundNodes.forEach(_=>{if(!(_ instanceof Array))throw new ue(`Corrupted configuration, expected array for nodeData: ${_}`);a(w,_)})}const u=n.name,h=n.layers;for(const v of h)c(v);for(;!bFe(o);)for(const v of h){const y=s[v.name];if(y.name in o){const w=o[y.name];delete o[y.name];for(const x of w)l(y,x)}}const f=[],d=[],p=n.inputLayers;for(const v of p){const y=v[0],w=v[1],x=v[2];Zl(y in s);const S=s[y].inboundNodes[w].outputTensors;f.push(S[x])}const m=n.outputLayers;for(const v of m){const y=v[0],w=v[1],x=v[2];Zl(y in s);const S=s[y].inboundNodes[w].outputTensors;d.push(S[x])}return new e({inputs:f,outputs:d,name:u})}get stateful(){if(this._stateful)throw new ue("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){de(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function NLe(t,e,n){const r=e.length;if(t==null||Array.isArray(t)&&t.length===0)return e.map(i=>null);if(r===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==r)throw new Error(`Provided ${n} is an array of ${t.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){const i=[];return e.forEach(s=>{s in t?i.push(t[s]):i.push(null)}),i}else throw new Error(`The model has multiple (${r}) outputs, so ${n} must be either an array with ${r} elements or an object with ${e} keys. Provided ${n} not understood: ${JSON.stringify(t)}`)}function e6(t,e){return NLe(t,e,"classWeight")}async function t6(t,e,n,r){if(e!=null||r!=null)throw new Error("Support sampleWeight is not implemented yet");if(n!=null){const i=de(()=>{if(t.shape.length===1)return Oc(t);if(t.shape.length===2){if(t.shape[1]>1)return Tm(t,1);if(t.shape[1]===1)return fe(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),s=Array.from(await i.data());on(i);const o=[];return s.forEach(a=>{if(n[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(n[a])}),ts(o,"float32")}else return null}function $Le(t,e){return se(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const RLe=32;function n6(t,e){let n,r;const i=e;n=i.xs,r=i.ys,z(n!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const s=r6("input",t.inputNames,n),o=r6("output",t.outputNames,r),a=s[0].shape[0];z(s.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${s.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),z(o.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let l=0;l<s.length;l++)z(s[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${s[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<o.length;l++)z(o[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:s,ys:o}}function r6(t,e,n){if(n instanceof Qn)return[n];if(Array.isArray(n))return z(n.length===e.length,()=>`Received an array of ${n.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`),n;{const r=[];for(const i of e){if(n[i]==null)throw new ue(`The feature data generated by the dataset lacks the required ${t} key '${i}'.`);r.push(n[i])}return r}}function DLe(t){if(t.length===3)throw new tn("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function PLe(t,e,n){const r=n.batchesPerEpoch!=null;if(z(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),z(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),z(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),z(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),z(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const i=n.validationData!=null;let s,o;if(i)if(i6(n.validationData))z(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{const v=DLe(n.validationData);s=v.xs,o=v.ys}const a=t.makeTrainFunction(),l=t.getDedupedMetricsNames();let c;i?c=l.slice().concat(l.map(v=>"val_"+v)):c=l.slice();const u=V5(n.callbacks,n.yieldEvery),h=n.verbose==null?1:n.verbose,{callbackList:f,history:d}=U5(u,h,n.epochs,null,null,OLe(e,n),null,i,c);f.setModel(t),t.history=d,await f.onTrainBegin(),t.stopTraining_=!1;let p=n.initialEpoch==null?0:n.initialEpoch,m=await e.iterator();for(;p<n.epochs;){const v={};await f.onEpochBegin(p);let y=0,w=0;for(r||(m=await e.iterator());r?y<n.batchesPerEpoch:!0;){const x=await m.next();if(r&&x.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${y} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(x.value!=null){const{xs:_,ys:S}=n6(t,x.value),T={};T.batch=w,T.size=_[0].shape[0],await f.onBatchBegin(w,T);const E=[];if(n.classWeight!=null){const M=e6(n.classWeight,t.outputNames);for(let D=0;D<M.length;++D)E.push(await t6(S[D],null,M[D]))}const k=_.concat(S).concat(E),A=a(k);on(k);for(let M=0;M<l.length;++M){const D=l[M],P=A[M];T[D]=P,Tr(P)}await f.onBatchEnd(w,T),B5(T),w++,y++}if(r?y>=n.batchesPerEpoch:x.done){if(i){let _;i6(n.validationData)?_=yr(await t.evaluateDataset(n.validationData,{batches:n.validationBatches})):_=yr(t.evaluate(s,o,{batchSize:n.validationBatchSize==null?RLe:n.validationBatchSize,verbose:0}));for(let S=0;S<t.metricsNames.length;++S)v[`val_${t.metricsNames[S]}`]=_[S]}break}if(t.stopTraining_)break}if(await f.onEpochEnd(p,v),p++,t.stopTraining_)break}return await f.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function OLe(t,e){let n=null;return e.batchesPerEpoch!=null?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size),n}function i6(t){return typeof t.iterator=="function"}function FLe(t){return typeof t.next=="function"}async function LLe(t,e,n){n=n||{};const r=n.batches!=null,i=t.testFunction;let s=[];if(n.verbose>0)throw new tn("Verbose mode is not implemented yet.");z(!r||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);const o=FLe(e)?e:await e.iterator();let a=0,l=0;for(;r?l<n.batches:!0;){const c=await o.next();if(s=de(()=>{if(c.value){const{xs:u,ys:h}=n6(t,c.value),f=u.concat(h),d=de(()=>i(f));if(on(f),l===0)for(let m=0;m<d.length;++m)s.push(Nt(0));const p=f[0].shape[0];for(let m=0;m<d.length;++m){const v=d[m],y=s[m];s[m]=de(()=>Be(s[m],se(p,v))),l>0&&on(y)}on(d),a+=p,++l}return s}),c.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<s.length;++c){const u=s[c];s[c]=Tt(s[c],a),on(u)}return Vs(s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function qR(t){z(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function Wb(t,e,n){return t==null?[null]:Array.isArray(t)?t.map(r=>Uf(r,e,n-e)):Uf(t,e,n-e)}function XR(t,e){return de(()=>t==null?null:Array.isArray(t)?t.map(n=>XR(n,e)):T5(t,e.dtype==="int32"?e:Qe(e,"int32")))}function KR(t,e){const n=[];let r=0,i=null;for(;r<t;)i=r+e,i>=t&&(i=t),n.push([r,i]),r=i;return n}async function BLe(t,e,n,r,i,s,o,a,l,c,u,h,f,d,p){i==null&&(i=32),s==null&&(s=1),u==null&&(u=!0),f==null&&(f=0);let m=!1;if(l!=null&&c!=null&&(m=!0),p!=null&&(m=!0,d==null))throw new ue("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const v=t.checkNumSamples(n,i,d,"steps_per_epoch");let y;v!=null&&(y=sl(0,v)),o==null&&(o=1);const{callbackList:w,history:x}=U5(a,o,s,f,v,d,i,m,h);w.setModel(t),t.history=x,await w.onTrainBegin(),t.stopTraining_=!1;for(let _=f;_<s;++_){await w.onEpochBegin(_);const S={};if(d!=null)throw new tn("stepsPerEpoch mode is not implemented yet.");{if(u==="batch")throw new tn("batch shuffling is not implemneted yet");u&&pM(y);const T=ts(y),E=KR(v,i);for(let k=0;k<E.length;++k){const A={};if(await w.onBatchBegin(k,A),de(()=>{const M=E[k][0],D=E[k][1],P=Uf(T,M,D-M);A.batch=k,A.size=D-M;const N=XR(n,P),R=e(N);for(let F=0;F<r.length;++F){const O=r[F],K=R[F];A[O]=K,Tr(K)}if(k===E.length-1&&m){const F=t.testLoop(l,c,i);for(let O=0;O<r.length;++O){const K=r[O],J=F[O];Tr(J),S["val_"+K]=J}}}),await w.onBatchEnd(k,A),B5(A),t.stopTraining_)break}T.dispose()}if(await w.onEpochEnd(_,S),t.stopTraining_)break}return await w.onTrainEnd(),await t.history.syncData(),t.history}async function zLe(t,e,n,r={}){if(t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;let i,s,o,a,l,c,u;try{const h=r.batchSize==null?32:r.batchSize;qR(h);const f=!1,d=await t.standardizeUserData(e,n,r.sampleWeight,r.classWeight,f,h);i=d[0],s=d[1],u=d[2];let p=!1,m;if(r.validationData!=null&&r.validationData.length>0){if(p=!0,r.validationData.length===2)o=r.validationData[0],a=r.validationData[1];else throw r.validationData.length===3?new tn("validationData including sample weights is not supported yet."):new ue(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);const E=!0,k=await t.standardizeUserData(o,a,null,null,E,h);l=k[0],c=k[1],m=l.concat(c)}else if(r.validationSplit!=null&&r.validationSplit>0&&r.validationSplit<1){p=!0;const E=Math.floor(i[0].shape[0]*(1-r.validationSplit)),k=i[0].shape[0];l=Wb(i,E,k),i=Wb(i,0,E),c=Wb(s,E,k),s=Wb(s,0,E),m=l.concat(c)}else r.validationSteps!=null&&(p=!0);const v=i.concat(s).concat(u);t.checkTrainableWeightsConsistency();const y=t.makeTrainFunction(),w=t.getDedupedMetricsNames();let x,_;p?(t.makeTestFunction(),x=t.testFunction,_=w.slice().concat(w.map(E=>"val_"+E))):(x=null,m=[],_=w.slice());const S=V5(r.callbacks,r.yieldEvery);return await BLe(t,y,v,w,h,r.epochs,r.verbose,S,x,m,r.shuffle,_,r.initialEpoch,null,null)}finally{t.isTraining=!1,Gf(i,e),Gf(s,n),Gf(l,o),Gf(c,a),u!=null&&on(u)}}function s6(t){const e=[];t instanceof Qn&&(t=[t]);for(let n=0;n<t.length;++n){const r=t[n];if(r.rank===1)e.push(Ob(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(r)}}return e}function Gf(t,e){if(t==null)return;const n=[];if(e instanceof Qn)n.push(e.id);else if(Array.isArray(e))e.forEach(i=>n.push(i.id));else if(e!=null)for(const i in e){const s=e[i];n.push(s.id)}const r=[];if(t instanceof Qn)n.indexOf(t.id)===-1&&r.push(t);else if(Array.isArray(t))t.forEach(i=>{n.indexOf(i.id)===-1&&r.push(i)});else if(t!=null)for(const i in t){const s=t[i];n.indexOf(s.id)===-1&&r.push(s)}r.forEach(i=>{i.isDisposed||i.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function VLe(t){return t instanceof Qn}function YR(t){return Array.isArray(t)}function o6(t){return!VLe(t)&&!YR(t)}function a6(t,e,n,r=!0,i=""){if(e==null||e.length===0){if(t!=null){let o=!1;if(YR(t)&&t.length>0)o=!0;else if(o6(t)){for(const a in t)if(t.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new ue(`Error when checking model ${i} expected no data, but got ${t}`)}return[]}if(t==null)return e.map(o=>null);let s;if(o6(t)){t=t,s=[];for(const o of e){if(t[o]==null)throw new ue(`No data provided for "${o}". Need data for each key in: ${e}`);s.push(t[o])}}else if(YR(t)){if(t=t,t.length!==e.length)throw new ue(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);s=t}else{if(t=t,e.length>1)throw new ue(`The model ${i} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);s=[t]}if(s=s6(s),n!=null)for(let o=0;o<e.length;++o){if(n[o]==null)continue;const a=s[o];if(a.shape.length!==n[o].length)throw new ue(`Error when checking ${i}: expected ${e[o]} to have ${n[o].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<n[o].length;++l){if(l===0&&!r)continue;const c=a.shape[l],u=n[o][l];if(u!=null&&u>=0&&c!==u)throw new ue(`${i} expected a batch of elements where each example has shape [${n[o].slice(1,n[o].length)}] (i.e.,tensor shape [*,${n[o].slice(1,n[o].length)}]) but the ${i} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return s}function ULe(t,e,n){const r=lh(t.map(s=>s.shape[0]));r.sort();const i=lh(e.map(s=>s.shape[0]));if(i.sort(),r.length>1)throw new ue(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(s=>s.shape))}`);if(i.length>1)throw new ue(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(s=>s.shape))}`);if(r.length>0&&i.length>0&&!wn(r,i))throw new ue(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${i[0]} target sample(s).`)}function WLe(t,e,n){const r=[M2,N2,Vb];for(let i=0;i<t.length;++i){const s=t[i],o=e[i],a=n[i];if(o!=null){if(o===Vb&&s.shape[s.shape.length-1]===1)throw new ue(`You are passing a target array of shape ${s.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(o)!==-1){const l=s.shape.slice(1),c=a.slice(1);for(let u=0;u<l.length;++u){const h=l[u],f=c[u];if(f!=null&&h!==f)throw new ue(`A target Tensor with shape ${s.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function l6(t,e,n,r=!0,i=""){let s;if(Array.isArray(t)){if(t.length!==e.length)throw new ue(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);s=t}else{if(e.length>1)throw new ue(`The model expects ${e.length} ${i} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);s=[t]}if(n!=null)for(let o=0;o<e.length;++o){if(n[o]==null)continue;const a=s[o];if(a.shape.length!==n[o].length)throw new ue(`Error when checking ${i}: expected ${e[o]} to have ${n[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<n[o].length;++l){if(l===0&&!r)continue;const c=a.shape[l],u=n[o][l];if(u!=null&&u!==c)throw new ue(`Error when checking ${i}: expected ${e[o]} to have shape ${JSON.stringify(n[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function GLe(t,e){if(t==null||Array.isArray(t)&&t.length===0)return e.map(r=>[]);let n;if(typeof t=="string"||typeof t=="function")n=[t];else if(Array.isArray(t)||typeof t=="object")n=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(n))return e.map(r=>n);{const r=[];for(const i of e){let s=n.hasOwnProperty(i)?n[i]:[];Array.isArray(s)||(s=[s]),r.push(s)}return r}}const HLe="layers-model";class fh extends al{constructor(e){super(e);this.isTraining=!1}summary(e,n,r=console.log){if(!this.built)throw new ue("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");_Le(this,e,n,r)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=xLe(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Vc))throw new ue("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let n=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const o in e.loss)if(this.outputNames.indexOf(o)===-1)throw new ue(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)e.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),n.push(WR(e.loss[o]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new ue(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);n=e.loss.map(a=>WR(a))}else{const o=WR(e.loss);this.outputs.forEach(a=>{n.push(o)})}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],l=this.outputNames[o];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const r=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Vf("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(r.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const i=GLe(e.metrics,this.outputNames),s=(o,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,o])};Vf("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(r.indexOf(o)!==-1)continue;const a=i[o];(c=>{const u="";let h,f,d;for(const p of c){if(typeof p=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(p)!==-1){const v=this.internalOutputShapes[o];v[v.length-1]===1||this.lossFunctions[o]===N2?["accuracy","acc"].indexOf(p)!==-1?f=G5:["crossentropy","ce"].indexOf(p)!==-1&&(f=hLe):this.lossFunctions[o]===I2?["accuracy","acc"].indexOf(p)!==-1?f=fLe:["crossentropy","ce"].indexOf(p)!==-1&&(f=q5):["accuracy","acc"].indexOf(p)!==-1?f=H5:["crossentropy","ce"].indexOf(p)!==-1&&(f=j5);let y;["accuracy","acc"].indexOf(p)!==-1?y="acc":["crossentropy","ce"].indexOf(p)!==-1&&(y="ce"),d=f,h=u+y}else d=wLe(p),h=u+D2(p);let m;Vf(h,()=>{m=d}),s(o,h,m)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,n,r={}){const i=r.batchSize==null?32:r.batchSize;qR(i);const s=!0,o=this.standardizeUserDataXY(e,n,s,i);try{const a=o[0].concat(o[1]);this.makeTestFunction();const l=this.testFunction,c=this.testLoop(l,a,i,r.verbose,r.steps);return Vs(c)}finally{Gf(o[0],e),Gf(o[1],n)}}async evaluateDataset(e,n){return this.makeTestFunction(),LLe(this,e,n)}checkNumSamples(e,n,r,i="steps"){let s;if(r!=null){if(s=null,n!=null)throw new ue(`If ${i} is set, batchSize must be null or undefined.Got batchSize = ${n}`)}else if(e!=null)Array.isArray(e)?s=e[0].shape[0]:s=e.shape[0];else throw new ue(`Either the input data should have a defined shape, or ${i} shoud be specified.`);return s}execute(e,n){if(Array.isArray(n)&&n.length===0)throw new ue("`outputs` is an empty Array, which is not allowed.");const r=Array.isArray(n),i=r?n:[n],s=this.retrieveSymbolicTensors(i),o=new hh;if(e instanceof Qn&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new ue(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)o.add(this.inputs[l],e[l])}else for(const l of this.inputs){const c=e[l.name];if(c==null)throw new ue(`No value is provided for the model's input ${l.name}`);o.add(l,c)}const a=Ub(s,o);return r?a:a[0]}retrieveSymbolicTensors(e){const n=Lf(null,e.length);let r=e.length;for(const i of this.layers){const s=Array.isArray(i.output)?i.output:[i.output],o=s.map(a=>a.name);for(let a=0;a<e.length;++a){const l=o.indexOf(e[a]);if(l!==-1&&(n[a]=s[l],r--),r===0)break}if(r===0)break}if(r>0){const i=[];throw n.forEach((s,o)=>{s==null&&i.push(e[o])}),new ue(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(i)}`)}return n}predictLoop(e,n=32,r=!1){return de(()=>{const i=this.checkNumSamples(e);if(r)throw new tn("Verbose predictLoop() is not implemented yet.");const s=KR(i,n),o=this.outputs.map(a=>[]);for(let a=0;a<s.length;++a)de(()=>{const c=s[a][0],u=s[a][1],h=Wb(e,c,u),f=[];if(Array.isArray(h))for(let p=0;p<h.length;++p)f.push({key:this.inputs[p],value:h[p]});else f.push({key:this.inputs[0],value:h});const d=new hh(f);return Ub(this.outputs,d)}).forEach((c,u)=>o[u].push(c));return Vs(o.map(a=>ii(a,0)))})}predict(e,n={}){const r=s6(e);l6(r,this.inputNames,this.feedInputShapes,!1);try{const i=n.batchSize==null?32:n.batchSize;return qR(i),this.predictLoop(r,i)}finally{Gf(r,e)}}predictOnBatch(e){l6(e,this.inputNames,this.feedInputShapes,!0);const n=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,n)}standardizeUserDataXY(e,n,r=!0,i){if(this.optimizer_==null)throw new ya("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const s=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===I2?s.push(a.slice(0,a.length-1).concat([1])):s.push(a)}if(e=a6(e,this.feedInputNames,this.feedInputShapes,!1,"input"),n=a6(n,this.feedOutputNames,s,!1,"target"),ULe(e,n),WLe(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&e[0].shape[0]%i!=0)throw new ue(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${i}. Found: ${e[0].shape[0]} sample(s).`);return[e,n]}async standardizeUserData(e,n,r,i,s=!0,o){const[a,l]=this.standardizeUserDataXY(e,n,s,o);if(r!=null)throw new Error("sample weight is not supported yet.");let c=null;if(i!=null){const u=e6(i,this.outputNames);c=[];for(let h=0;h<u.length;++h)c.push(await t6(l[h],null,u[h]))}return[a,l,c]}testLoop(e,n,r,i=0,s){return de(()=>{const o=this.checkNumSamples(n,r,s,"steps"),a=[];if(i>0)throw new tn("Verbose mode is not implemented yet.");if(s!=null)throw new tn("steps mode in testLoop() is not implemented yet");{const l=KR(o,r),c=ts(sl(0,o));for(let u=0;u<l.length;++u){const h=l[u][0],f=l[u][1],d=Uf(c,h,f-h),p=XR(n,d),m=e(p);if(u===0)for(let v=0;v<m.length;++v)a.push(Nt(0));for(let v=0;v<m.length;++v){const y=m[v];a[v]=Be(a[v],se(f-h,y))}}for(let u=0;u<a.length;++u)a[u]=Tt(a[u],o)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,n=[];for(let r=0;r<e.length;++r){const i=e[r];let s=i;u5(e,i)>1&&(s+=`_${u5(e.slice(0,r),i)}`),n.push(s)}return n}makeTrainFunction(){return e=>{const n=[],r=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const h=[];for(let m=0;m<this.inputs.length;++m)h.push({key:this.inputs[m],value:r[m]});const f=new hh(h),d=Ub(this.outputs,f,{training:!0});let p;for(let m=0;m<this.lossFunctions.length;++m){let y=this.lossFunctions[m](i[m],d[m]);s[m]!=null&&(y=$Le(y,s[m]));const w=Br(y);n.push(w),m===0?p=y:p=Be(p,y)}for(let m=0;m<this.metricsTensors.length;++m){let v;if(this.outputs.length>1&&m<this.outputs.length)v=n[m];else{const y=this.metricsTensors[m][0],w=this.metricsTensors[m][1];v=Br(y(i[w],d[w]))}Tr(v),o.push(v)}return p=Br(p),this.calculateLosses().forEach(m=>{p=Be(p,m)}),p},l=this.collectedTrainableWeights.map(h=>h.read()),c=!0;return[this.optimizer_.minimize(a,c,l)].concat(o)}}makeTestFunction(){this.testFunction=e=>de(()=>{const n=[];let r;const i=e.slice(0,this.inputs.length),s=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let c=0;c<this.inputs.length;++c)o.push({key:this.inputs[c],value:i[c]});const a=new hh(o),l=Ub(this.outputs,a);for(let c=0;c<this.lossFunctions.length;++c){const u=this.lossFunctions[c],h=Br(u(s[c],l[c]));c===0?r=h:r=Be(r,h),n.push(r)}for(let c=0;c<this.metricsTensors.length;++c){const u=this.metricsTensors[c][0],h=this.metricsTensors[c][1],f=Br(u(s[h],l[h]));n.push(f)}return n})}async fit(e,n,r={}){return zLe(this,e,n,r)}async fitDataset(e,n){return PLe(this,e,n)}async trainOnBatch(e,n){const r=await this.standardizeUserData(e,n),i=r[0],s=r[1],a=this.makeTrainFunction()(i.concat(s)),l=[];for(const c of a){const u=await c.data();l.push(u[0])}return on(a),Vs(l)}getNamedWeights(e){const n=[],r=e!=null&&e.trainableOnly,i=r?this.trainableWeights:this.weights,s=this.getWeights(r);for(let o=0;o<i.length;++o)r&&!i[o].trainable||n.push({name:i[o].originalName,tensor:s[o]});return n}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const n=SS().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=n-SS().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Hc(this.loss);else if(Array.isArray(this.loss)){for(const n of this.loss)if(typeof n!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(n=>Hc(n))}else{const n=Object.keys(this.loss);e={};const r=this.loss;for(const i of n)if(typeof r[i]=="string")e[i]=Hc(r[i]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Hc(D2(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Hc(D2(e)));{const e={};for(const n in this.metrics)e[n]=Hc(D2(this.metrics[n]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const n=O2(e.optimizer_config),r=ec(n);let i;if(typeof e.loss=="string")i=Bf(e.loss);else if(Array.isArray(e.loss))i=e.loss.map(o=>Bf(o));else if(e.loss!=null){i={};for(const o in e.loss)i[o]=Bf(e.loss[o])}let s;if(Array.isArray(e.metrics))s=e.metrics.map(o=>Bf(o));else if(e.metrics!=null){s={};for(const o in e.metrics)s[o]=Bf(e.metrics[o])}this.compile({loss:i,metrics:s,optimizer:r})}async save(e,n){if(typeof e=="string"){const c=jM(e);if(c.length===0)throw new ue(`Cannot find any save handlers for URL '${e}'`);if(c.length>1)throw new ue(`Found more than one (${c.length}) save handlers for URL '${e}'`);e=c[0]}if(e.save==null)throw new ue("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const r=await WM(this.getNamedWeights(n)),i=!1,s=null,a={modelTopology:this.toJSON(s,i),format:HLe,generatedBy:`TensorFlow.js tfjs-layers v${Z5}`,convertedBy:null};if((n==null?!1:n.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const c="optimizer",{data:u,specs:h}=await WM(await this.optimizer.getWeights(),c);r.specs.push(...h),r.data=vS([r.data,u])}if(this.userDefinedMetadata!=null){const c=!0;K5(this.userDefinedMetadata,this.name,c),a.userDefinedMetadata=this.userDefinedMetadata}return a.weightData=r.data,a.weightSpecs=r.specs,e.save(a)}setUserDefinedMetadata(e){K5(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}fh.className="Model";Le(fh);class c6 extends fh{}c6.className="Functional";Le(c6);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function jLe(t,e){if(e==null&&(e={}),typeof t=="string"){const n=qM(t,e);if(n.length===0)n.push(wS(t,e));else if(n.length>1)throw new ue(`Found more than one (${n.length}) load handlers for URL '${t}'`);t=n[0]}return qLe(t,void 0,e)}async function qLe(t,e,n){if(n==null&&(n={}),t.load==null)throw new ue("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const r=await t.load();let i=r.modelTopology;i.model_config!=null&&(i=i.model_config);const s=n.strict==null?!0:n.strict,o=r.weightData!=null&&r.weightSpecs!=null&&s,a=ec(O2(i),e,o),l=r.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),r.userDefinedMetadata!=null&&a.setUserDefinedMetadata(r.userDefinedMetadata),r.weightData!=null){if(r.weightSpecs==null)throw new ue("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:c,optimizerWeights:u}=XLe(r.weightData,r.weightSpecs);a.loadWeights(c,s),a.optimizer!=null&&u.length>0&&await a.optimizer.setWeights(u),on(c),on(u.map(h=>h.tensor))}return a}function XLe(t,e){const n=gS(t,e),r={},i=[];return e.forEach(s=>{s.group==="optimizer"?i.push({name:s.name,tensor:n[s.name]}):r[s.name]=n[s.name]}),{modelWeights:r,optimizerWeights:i}}class bg extends fh{constructor(e){super({inputs:[],outputs:[]});if(e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:C2("sequential_"),e.layers!=null)for(const n of e.layers)this.add(n)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(r=>r<0))throw new ue(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const n=e instanceof bg||e instanceof fh;let r;if(n){if(r=e,r.outputs.length!==1)throw new ue("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(r.inputs.length!==1)throw new ue("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new ue("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const i=XFe({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(i)}if(n)this.outputs=r.outputs,this.inputs=r.inputs;else{if(e.inboundNodes.length!==1)throw new ue(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new ue("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=L5(this.outputs[0])}this.inboundNodes=[],new k2({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Lf(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(i=>i.shape),outputShapes:this.outputs[0].shape})}else{const i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,n){return this.model==null&&this.build(),this.model.call(e,n)}build(e){if(qn(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new fh({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,n,r=console.log){this.built||this.build(),super.summary(e,n,r)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,n,r={}){if(!this.built)throw new ya("The model needs to be compiled before being used.");return this.model.evaluate(e,n,r)}async evaluateDataset(e,n){if(!this.built)throw new ya("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,n)}predict(e,n={}){return this.model==null&&this.build(),this.model.predict(e,n)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,n,r={}){if(!this.built)throw new ya("The model needs to be compiled before being used.");return this.model.fit(e,n,r)}async fitDataset(e,n){if(!this.built)throw new ya("The model needs to be compiled before being used.");return this.model.fitDataset(e,n)}async trainOnBatch(e,n){return this.model.trainOnBatch(e,n)}static fromConfig(e,n,r={},i=!1){let s,o={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new ue("Legacy serialization format not supported yet.");s=n}else z(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),s=n.layers,delete n.layers,o=n;const a=new e(o);if(!(a instanceof bg))throw new tn(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of s){const u=ec(l,void 0,i);i&&u.setFastWeightInitDuringBuild(!0),a.add(u)}return a}set stopTraining(e){if(this.model==null)throw new ue("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new ue("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const n of this.layers){const r={};r.className=n.getClassName(),r.config=n.getConfig(),e.push(r)}return{name:this.name,layers:e}}}bg.className="Sequential";Le(bg);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function KLe(t){return new bg(t)}function Gb(t,e){return e==null&&(e={}),jLe(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Us extends bf{getConfig(){return{}}}class u6 extends Us{apply(e,n=1){return RFe(e,n)}}u6.className="elu";Le(u6);class h6 extends Us{apply(e){return BI(e)}}h6.className="selu";Le(h6);class f6 extends Us{apply(e){return Ul(e)}}f6.className="relu";Le(f6);class d6 extends Us{apply(e){return de(()=>U0(6,Ul(e)))}}d6.className="relu6";Le(d6);class p6 extends Us{apply(e){return e}}p6.className="linear";Le(p6);class m6 extends Us{apply(e){return Bl(e)}}m6.className="sigmoid";Le(m6);class g6 extends Us{apply(e){return PFe(e)}}g6.className="hardSigmoid";Le(g6);class v6 extends Us{apply(e){return Nm(e)}}v6.className="softplus";Le(v6);class y6 extends Us{apply(e){return DFe(e)}}y6.className="softsign";Le(y6);class b6 extends Us{apply(e){return km(e)}}b6.className="tanh";Le(b6);class ZR extends Us{apply(e,n=-1){return H0(e,n)}}ZR.className="softmax";Le(ZR);class w6 extends Us{apply(e,n=-1){return II(e,n)}}w6.className="logSoftmax";Le(w6);class x6 extends Us{apply(e,n=1){return de(()=>se(Bl(se(e,n)),e))}}x6.className="swish";Le(x6);class _6 extends Us{apply(e){return de(()=>se(e,km(Nm(e))))}}_6.className="mish";Le(_6);function dh(t){return t.getClassName()}function JR(t,e={}){return Rb(t,Ao.getMap().classNameMap,e,"activation")}function ph(t){if(t==null){const e={};return e.className="linear",e.config={},JR(e)}if(typeof t=="string"){const e={};return e.className=t,e.config={},JR(e)}else return t instanceof Us?t:JR(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function YLe(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}class S6 extends bf{}class C6 extends S6{constructor(e){super();YLe(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return de(()=>{let n=zr([1]);return this.hasL1&&(n=Be(n,xt(se(this.l1,pi(e))))),this.hasL2&&(n=Be(n,xt(se(this.l2,Fb(e))))),fe(n,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,n){return new e({l1:n.l1,l2:n.l2})}}C6.className="L1L2";Le(C6);const T6={l1l2:"L1L2"};function or(t){return SR(t)}function E6(t,e={}){return Rb(t,Ao.getMap().classNameMap,e,"regularizer")}function Ar(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in T6?T6[t]:t,config:{}};return E6(n)}else return t instanceof S6?t:E6(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class k6 extends Pn{constructor(e){super(e==null?{}:e);this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,n){e=rn(e);let r=Ul(e);return this.maxValue!=null&&(r=ro(r,0,this.maxValue)),r}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},n=super.getConfig();return Object.assign(e,n),e}}k6.className="ReLU";Le(k6);class A6 extends Pn{constructor(e){super(e==null?{}:e);this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const r=rn(e);return IS(r,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}}A6.className="LeakyReLU";Le(A6);class M6 extends Pn{constructor(e){super(e==null?{}:e);if(this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=kr(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Ar(e.alphaRegularizer),this.alphaConstraint=wi(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new ue(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=qn(e);const n=e.slice(1);if(this.sharedAxes!=null)for(const i of this.sharedAxes)n[i-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const r={};if(this.sharedAxes!=null)for(let i=1;i<e.length;++i)r[i]=e[i];this.inputSpec=[new xi({ndim:e.length,axes:r})],this.built=!0}call(e,n){return e=rn(e),LS(e,this.alpha.read())}getConfig(){const e={alphaInitializer:Dr(this.alphaInitializer),alphaRegularizer:or(this.alphaRegularizer),alphaConstraint:bi(this.alphaConstraint),sharedAxes:this.sharedAxes},n=super.getConfig();return Object.assign(e,n),e}}M6.className="PReLU";Le(M6);class I6 extends Pn{constructor(e){super(e==null?{}:e);if(this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new tn(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const r=rn(e);return z0(r)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}}I6.className="ELU";Le(I6);class N6 extends Pn{constructor(e){super(e==null?{}:e);this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,n){const r=rn(e);return se(r,Qe(No(r,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},n=super.getConfig();return Object.assign(e,n),e}}N6.className="ThresholdedReLU";Le(N6);class $6 extends Pn{constructor(e){super(e==null?{}:e);this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new ZR().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,n){const r=rn(e);return this.softmax(r,this.axis)}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}$6.className="Softmax";Le($6);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function wg(t,e,n){if(typeof t=="number")return Lf(t,e);if(t.length!==e)throw new ue(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let r=0;r<e;++r){const i=t[r];if(!MFe(i))throw new ue(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${i}`)}return t}function ll(t,e,n,r,i=1){if(t==null)return t;const s=e+(e-1)*(i-1);let o;return n==="same"?o=t:o=t-s+1,Math.floor((o+r-1)/r)}function tc(t,e,n,r){if(t==null)return null;if(r==="valid")t=t*e+uh([n-e,0]);else if(r==="same")t=t*e;else throw new ue(`Unsupport padding mode: ${r}.`);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function QR(t,e){return de(()=>(jr(e),e==="channelsFirst"?Mn(t,[0,2,3,1]):t))}function R6(t,e){return de(()=>(jr(e),e==="channelsFirst"?Mn(t,[0,2,3,4,1]):t))}function ZLe(t,e,n,r=1,i="valid",s,o=1){return de(()=>{if(s==null&&(s=il()),jr(s),t.shape.length!==3)throw new ue(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(e.shape.length!==3)throw new ue(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new ue(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if(s==="channelsFirst"&&(t=Mn(t,[0,2,1])),i==="causal")throw new tn("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=_I(t,e,r,i==="same"?"same":"valid","NWC",o);return n!=null&&(a=ol(a,n)),a})}function D6(t,e,n,r=[1,1],i="valid",s,o,a=null){return de(()=>{if(s==null&&(s=il()),jr(s),t.rank!==3&&t.rank!==4)throw new ue(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(e.rank!==3&&e.rank!==4)throw new ue(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=QR(t,s);if(i==="causal")throw new tn("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=ZI({x:l,filter:e,strides:r,pad:i==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:a}),s==="channelsFirst"&&(l=Mn(l,[0,3,1,2])),l})}function JLe(t,e,n,r=[1,1,1],i="valid",s,o){return de(()=>{if(s==null&&(s=il()),jr(s),t.rank!==4&&t.rank!==5)throw new ue(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(e.rank!==4&&e.rank!==5)throw new ue(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=R6(t,s);if(i==="causal")throw new tn("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=TI(a,e,r,i==="same"?"same":"valid","NDHWC",o),n!=null&&(a=ol(a,n)),s==="channelsFirst"&&(a=Mn(a,[0,4,1,2,3])),a})}class F2 extends Pn{constructor(e,n){super(n);if(this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",F2.verifyArgs(n),this.rank=e,Ri(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new tn(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=wg(n.kernelSize,e,"kernelSize"),this.strides=wg(n.strides==null?1:n.strides,e,"strides"),this.padding=n.padding==null?"valid":n.padding,Lo(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,jr(this.dataFormat),this.activation=ph(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=kr(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=wi(n.biasConstraint),this.biasRegularizer=Ar(n.biasRegularizer),this.activityRegularizer=Ar(n.activityRegularizer),this.dilationRate=wg(n.dilationRate==null?1:n.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new ue(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new ue(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new ue(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(Zl("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!TR(e.kernelSize,"number",1,3))throw new ue(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:dh(this.activation),useBias:this.useBias,biasInitializer:Dr(this.biasInitializer),biasRegularizer:or(this.biasRegularizer),activityRegularizer:or(this.activityRegularizer),biasConstraint:bi(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}class xg extends F2{constructor(e,n){super(e,n);this.kernel=null,xg.verifyArgs(n),this.filters=n.filters,Ri(this.filters,"filters"),this.kernelInitializer=kr(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=wi(n.kernelConstraint),this.kernelRegularizer=Ar(n.kernelRegularizer)}build(e){e=qn(e);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new ue(`The channel dimension of the input should be defined. Found ${e[n]}`);const r=e[n],i=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:r}}],this.built=!0}call(e,n){return de(()=>{e=rn(e);let r;const i=this.bias==null?null:this.bias.read(),s=f5(this.activation.getClassName());if(s!=null&&this.rank===2)r=D6(e,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate,s);else{if(this.rank===1)r=ZLe(e,this.kernel.read(),i,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=D6(e,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=JLe(e,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new tn("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(e){e=qn(e);const n=[],r=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let s=0;s<r.length;++s){const o=ll(r[s],this.kernelSize[s],this.padding,this.strides[s],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[s]);n.push(o)}let i=[e[0]];return this.dataFormat==="channelsLast"?(i=i.concat(n),i.push(this.filters)):(i.push(this.filters),i=i.concat(n)),i}getConfig(){const e={filters:this.filters,kernelInitializer:Dr(this.kernelInitializer),kernelRegularizer:or(this.kernelRegularizer),kernelConstraint:bi(this.kernelConstraint)},n=super.getConfig();return Object.assign(e,n),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new ue(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Hb extends xg{constructor(e){super(2,e);Hb.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!TR(e.kernelSize,"number",1,2))throw new ue(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Hb.className="Conv2D";Le(Hb);class jb extends xg{constructor(e){super(3,e);jb.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new ue(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}jb.className="Conv3D";Le(jb);class P6 extends Hb{constructor(e){super(e);if(this.inputSpec=[new xi({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new ue(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=qn(e),e.length!==4)throw new ue("Input should have rank 4; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new ue("The channel dimension of the inputs should be defined. Found `None`.");const r=e[n],i=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new xi({ndim:4,axes:{[n]:r}})],this.built=!0}call(e,n){return de(()=>{let r=rn(e);if(r.shape.length!==4)throw new ue(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const i=r.shape,s=i[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const l=i[o],c=i[a],u=this.kernelSize[0],h=this.kernelSize[1],f=this.strides[0],d=this.strides[1],p=tc(l,f,u,this.padding),m=tc(c,d,h,this.padding),v=[s,p,m,this.filters];this.dataFormat!=="channelsLast"&&(r=Mn(r,[0,2,3,1]));let y=CI(r,this.kernel.read(),v,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(y=Mn(y,[0,3,1,2])),this.bias!=null&&(y=ol(y,this.bias.read(),this.dataFormat)),this.activation!=null&&(y=this.activation.apply(y)),y})}computeOutputShape(e){e=qn(e);const n=e.slice();let r,i,s;this.dataFormat==="channelsFirst"?(r=1,i=2,s=3):(r=3,i=1,s=2);const o=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],c=this.strides[1];return n[r]=this.filters,n[i]=tc(n[i],l,o,this.padding),n[s]=tc(n[s],c,a,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}P6.className="Conv2DTranspose";Le(P6);class O6 extends jb{constructor(e){super(e);if(this.inputSpec=[new xi({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new ue(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=qn(e),e.length!==5)throw new ue("Input should have rank 5; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new ue("The channel dimension of the inputs should be defined. Found `None`.");const r=e[n],i=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new xi({ndim:5,axes:{[n]:r}})],this.built=!0}call(e,n){return de(()=>{let r=rn(e);if(r.shape.length!==5)throw new ue(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const i=r.shape,s=i[0];let o,a,l;this.dataFormat==="channelsFirst"?(l=2,o=3,a=4):(l=1,o=2,a=3);const c=i[l],u=i[o],h=i[a],f=this.kernelSize[0],d=this.kernelSize[1],p=this.kernelSize[2],m=this.strides[0],v=this.strides[1],y=this.strides[2],w=tc(c,m,f,this.padding),x=tc(u,v,d,this.padding),_=tc(h,y,p,this.padding),S=[s,w,x,_,this.filters];this.dataFormat!=="channelsLast"&&(r=Mn(r,[0,2,3,4,1]));let T=qz(r,this.kernel.read(),S,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(T=Mn(T,[0,4,1,2,3])),this.bias!==null&&(T=ol(T,this.bias.read(),this.dataFormat)),this.activation!==null&&(T=this.activation.apply(T)),T})}computeOutputShape(e){e=qn(e);const n=e.slice();let r,i,s,o;this.dataFormat==="channelsFirst"?(r=1,i=2,s=3,o=4):(r=4,i=1,s=2,o=3);const a=this.kernelSize[0],l=this.kernelSize[1],c=this.kernelSize[2],u=this.strides[0],h=this.strides[1],f=this.strides[2];return n[r]=this.filters,n[i]=tc(n[i],u,a,this.padding),n[s]=tc(n[s],h,l,this.padding),n[o]=tc(n[o],f,c,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}O6.className="Conv3DTranspose";Le(O6);class F6 extends xg{constructor(e,n){super(e,n);if(this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,n.filters==null)throw new ue("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new ue("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new ue(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(n.padding)}`);this.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,this.depthwiseInitializer=kr(n.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Ar(n.depthwiseRegularizer),this.depthwiseConstraint=wi(n.depthwiseConstraint),this.pointwiseInitializer=kr(n.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Ar(n.pointwiseRegularizer),this.pointwiseConstraint=wi(n.pointwiseConstraint)}build(e){if(e=qn(e),e.length<this.rank+2)throw new ue(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null||e[n]<0)throw new ue(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[n])}`);const r=e[n],i=this.kernelSize.concat([r,this.depthMultiplier]),s=[];for(let a=0;a<this.rank;++a)s.push(1);s.push(r*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new xi({ndim:this.rank+2,axes:{[n]:r}})],this.built=!0}call(e,n){return de(()=>{e=rn(e);let r;if(this.rank===1)throw new tn("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=Mn(e,[0,2,3,1])),r=w4(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(r=ol(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),this.dataFormat==="channelsFirst"&&(r=Mn(r,[0,3,1,2])),r})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Dr(this.depthwiseInitializer),e.pointwiseInitializer=Dr(this.pointwiseInitializer),e.depthwiseRegularizer=or(this.depthwiseRegularizer),e.pointwiseRegularizer=or(this.pointwiseRegularizer),e.depthwiseConstraint=bi(this.depthwiseConstraint),e.pointwiseConstraint=bi(this.pointwiseConstraint),e}}F6.className="SeparableConv";class L6 extends F6{constructor(e){super(2,e)}}L6.className="SeparableConv2D";Le(L6);class L2 extends xg{constructor(e){super(1,e);L2.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!TR(e.kernelSize,"number",1,1))throw new ue(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}L2.className="Conv1D";Le(L2);class B6 extends Pn{constructor(e){super(e);typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,n){return de(()=>{if(e=rn(e),this.dataFormat==="channelsLast"){const r=x2(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return x2(r,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const r=x2(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return x2(r,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}B6.className="Cropping2D";Le(B6);class z6 extends Pn{constructor(e){super(e);this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,jr(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,EFe(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const n=e[2]==null?null:this.size[0]*e[2],r=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],n,r]}else{const n=e[1]==null?null:this.size[0]*e[1],r=e[2]==null?null:this.size[1]*e[2];return[e[0],n,r,e[3]]}}call(e,n){return de(()=>{let r=rn(e);const i=r.shape;if(this.dataFormat==="channelsFirst"){r=Mn(r,[0,2,3,1]);const s=this.size[0]*i[2],o=this.size[1]*i[3],a=this.interpolation==="nearest"?Po.resizeNearestNeighbor(r,[s,o]):Po.resizeBilinear(r,[s,o]);return Mn(a,[0,3,1,2])}else{const s=this.size[0]*i[1],o=this.size[1]*i[2];return this.interpolation==="nearest"?Po.resizeNearestNeighbor(r,[s,o]):Po.resizeBilinear(r,[s,o])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}z6.className="UpSampling2D";Le(z6);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function QLe(t,e,n=[1,1],r="valid",i,s){return de(()=>{i==null&&(i=il()),jr(i);let o=QR(t,i);if(t.rank!==4)throw new ue(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(e.rank!==4)throw new ue(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=B0(o,e,n,r==="same"?"same":"valid","NHWC",s),i==="channelsFirst"&&(o=Mn(o,[0,3,1,2])),o})}class V6 extends F2{constructor(e){super(2,e);this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=kr(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=wi(e.depthwiseConstraint),this.depthwiseRegularizer=Ar(e.depthwiseRegularizer)}build(e){if(e=qn(e),e.length<4)throw new ue(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const n=this.dataFormat==="channelsFirst"?1:3;if(e[n]==null||e[n]<0)throw new ue(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[n]}).`);const r=e[n],i=[this.kernelSize[0],this.kernelSize[1],r,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[r*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return de(()=>{e=rn(e);let r=QLe(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(r=ol(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),r})}computeOutputShape(e){e=qn(e);const n=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2],i=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,s=ll(n,this.kernelSize[0],this.padding,this.strides[0]),o=ll(r,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],i,s,o]:[e[0],s,o,i]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Dr(this.depthwiseInitializer),e.depthwiseRegularizer=or(this.depthwiseRegularizer),e.depthwiseConstraint=bi(this.depthwiseRegularizer),e}}V6.className="DepthwiseConv2D";Le(V6);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function U6(t,e,n,r){if(Array.isArray(t)){if(e!=null||n!=null)throw new ue("When inputs is an array, neither initialState or constants should be provided");r!=null&&(n=t.slice(t.length-r,t.length),t=t.slice(0,t.length-r)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function i(s){return s==null||Array.isArray(s)?s:[s]}return e=i(e),n=i(n),{inputs:t,initialState:e,constants:n}}function W6(t,e,n,r=!1,i,s,o=!1,a=!1){return de(()=>{const l=e.shape.length;if(l<3)throw new ue(`Input should be at least 3D, but is ${l}D.`);const c=[1,0].concat(sl(2,l));if(e=Mn(e,c),s!=null)throw new tn("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),i!=null&&(i=Qe(Qe(i,"bool"),"float32"),i.rank===l-1&&(i=Io(i,-1)),i=Mn(i,c)),r&&(e=Do(e,0),i!=null&&(i=Do(i,0)));const u=[];let h,f=n;const d=e.shape[0],p=Qa(e);let m;i!=null&&(m=Qa(i));for(let y=0;y<d;++y){const w=p[y],x=de(()=>t(w,f));if(i==null)h=x[0],f=x[1];else{const _=de(()=>{const S=m[y],T=mt(Ro(S),S),E=Be(se(x[0],S),se(f[0],T)),k=f.map((A,M)=>Be(se(x[1][M],S),se(A,T)));return{output:E,newStates:k}});h=_.output,f=_.newStates}a&&u.push(h)}let v;return a&&(v=ha(u,1)),[h,v,f]})}class mh extends Pn{constructor(e){super(e);let n;if(e.cell==null)throw new ue("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?n=new nD({cells:e.cell}):n=e.cell,n.stateSize==null)throw new ue("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new xi({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return sl(0,e).map(n=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){LR(e)&&(e=e[0]),e=e;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);const r=n[0];let i;if(this.returnSequences?i=[e[0],e[1],r]:i=[e[0],r],this.returnState){const s=[];for(const o of n)s.push([e[0],o]);return[i].concat(s)}else return i}computeMask(e,n){return de(()=>{Array.isArray(n)&&(n=n[0]);const r=this.returnSequences?n:null;if(this.returnState){const i=this.states.map(s=>null);return[r].concat(i)}else return r})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let r=0;r<e;++r)n.push(null);return n}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new tn("Constants support is not implemented in RNN yet.");LR(e)&&(e=e[0]),e=e;const n=this.stateful?e[0]:null,r=e.slice(2);this.inputSpec[0]=new xi({shape:[n,null,...r]});const i=[e[0]].concat(e.slice(2));this.cell.build(i);let s;if(Array.isArray(this.cell.stateSize)?s=this.cell.stateSize:s=[this.cell.stateSize],this.stateSpec!=null){if(!wn(this.stateSpec.map(o=>o.shape[o.shape.length-1]),s))throw new ue(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=s.map(o=>new xi({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(e,n=!1){de(()=>{if(!this.stateful)throw new Yl("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape[0];if(r==null)throw new ue("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>zr([r,i])):this.states_=[zr([r,this.cell.stateSize])];else if(e==null)on(this.states_),this.keptStates!=null&&(on(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>zr([r,i])):this.states_[0]=zr([r,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new ue(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n===!0?this.keptStates.push(this.states_.slice()):on(this.states_);for(let i=0;i<this.states_.length;++i){const s=e[i],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[i]:this.cell.stateSize,a=[r,o];if(!wn(s.shape,a))throw new ue(`State ${i} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${s.shape}`);this.states_[i]=s}}this.states_=this.states_.map(i=>Tr(i.clone()))})}apply(e,n){let r=n==null?null:n.initialState,i=n==null?null:n.constants;n==null&&(n={});const s=U6(e,r,i,this.numConstants);e=s.inputs,r=s.initialState,i=s.constants;let o=[],a=[];if(r!=null){n.initialState=r,o=o.concat(r),this.stateSpec=[];for(const c of r)this.stateSpec.push(new xi({shape:c.shape}));a=a.concat(this.stateSpec)}if(i!=null&&(n.constants=i,o=o.concat(i),this.numConstants=i.length),o[0]instanceof Ql){const c=[e].concat(o),u=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=u;const f=super.apply(c,n);return this.inputSpec=h,f}else return super.apply(e,n)}call(e,n){return de(()=>{const r=n==null?null:n.mask,i=n==null?null:n.training;let s=n==null?null:n.initialState;e=rn(e),s==null&&(this.stateful?s=this.states_:s=this.getInitialState(e));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(s.length!==o)throw new ue(`RNN Layer has ${o} state(s) but was passed ${s.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:i},c=W6((p,m)=>{const v=this.cell.call([p].concat(m),a);return[v[0],v.slice(1)]},e,s,this.goBackwards,r,null,this.unroll,this.returnSequences),u=c[0],h=c[1],f=c[2];this.stateful&&this.resetStates(f,i);const d=this.returnSequences?h:u;return this.returnState?[d].concat(f):d})}getInitialState(e){return de(()=>{let n=zr(e.shape);return n=xt(n,[1,2]),n=Ob(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(r=>r>1?MR(n,[1,r]):n):this.cell.stateSize>1?[MR(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);const r=this.cell.getConfig();return this.getClassName()===mh.className&&(n.cell={className:this.cell.getClassName(),config:r}),Object.assign({},r,e,n)}static fromConfig(e,n,r={}){const i=n.cell,s=ec(i,r);return new e(Object.assign(n,{cell:s}))}}mh.className="RNN";Le(mh);class B2 extends Pn{}class eD extends B2{constructor(e){super(e);this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Ri(this.units,"units"),this.activation=ph(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=kr(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=kr(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=kr(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Ar(e.kernelRegularizer),this.recurrentRegularizer=Ar(e.recurrentRegularizer),this.biasRegularizer=Ar(e.biasRegularizer),this.kernelConstraint=wi(e.kernelConstraint),this.recurrentConstraint=wi(e.recurrentConstraint),this.biasConstraint=wi(e.biasConstraint),this.dropout=yg([1,uh([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=yg([1,uh([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=qn(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return de(()=>{if(e=e,e.length!==2)throw new ue(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let r=e[1];e=e[0];const i=n.training==null?!1:n.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=gh({ones:()=>Ro(e),rate:this.dropout,training:i,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=gh({ones:()=>Ro(r),rate:this.recurrentDropout,training:i,dropoutFunc:this.dropoutFunc}));let s;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?s=Jl(se(e,o),this.kernel.read()):s=Jl(e,this.kernel.read()),this.bias!=null&&(s=ol(s,this.bias.read())),a!=null&&(r=se(r,a));let l=Be(s,Jl(r,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:dh(this.activation),useBias:this.useBias,kernelInitializer:Dr(this.kernelInitializer),recurrentInitializer:Dr(this.recurrentInitializer),biasInitializer:Dr(this.biasInitializer),kernelRegularizer:or(this.kernelRegularizer),recurrentRegularizer:or(this.recurrentRegularizer),biasRegularizer:or(this.biasRegularizer),activityRegularizer:or(this.activityRegularizer),kernelConstraint:bi(this.kernelConstraint),recurrentConstraint:bi(this.recurrentConstraint),biasConstraint:bi(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,n)}}eD.className="SimpleRNNCell";Le(eD);class G6 extends mh{constructor(e){e.cell=new eD(e);super(e)}call(e,n){return de(()=>{this.cell.dropoutMask!=null&&(on(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(on(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=n==null?null:n.mask,i=n==null?null:n.training,s=n==null?null:n.initialState;return super.call(e,{mask:r,training:i,initialState:s})})}static fromConfig(e,n){return new e(n)}}G6.className="SimpleRNN";Le(G6);class tD extends B2{constructor(e){super(e);if(this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new ue("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Ri(this.units,"units"),this.activation=ph(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ph(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=kr(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=kr(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=kr(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Ar(e.kernelRegularizer),this.recurrentRegularizer=Ar(e.recurrentRegularizer),this.biasRegularizer=Ar(e.biasRegularizer),this.kernelConstraint=wi(e.kernelConstraint),this.recurrentConstraint=wi(e.recurrentConstraint),this.biasConstraint=wi(e.biasConstraint),this.dropout=yg([1,uh([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=yg([1,uh([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=qn(e);const n=e[e.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return de(()=>{if(e=e,e.length!==2)throw new ue(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const r=n.training==null?!1:n.training;let i=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=gh({ones:()=>Ro(e),rate:this.dropout,training:r,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=gh({ones:()=>Ro(i),rate:this.recurrentDropout,training:r,count:3,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,o=this.recurrentDropoutMask;let a,l,c;0<this.dropout&&this.dropout<1&&(e=se(e,s[0]));let u=Jl(e,this.kernel.read());this.useBias&&(u=ol(u,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(i=se(i,o[0]));const h=this.recurrentKernel.read(),[f,d]=so(h,[2*this.units,this.units],h.rank-1),p=Jl(i,f),[m,v,y]=so(u,3,u.rank-1),[w,x]=so(p,2,p.rank-1);a=this.recurrentActivation.apply(Be(m,w)),l=this.recurrentActivation.apply(Be(v,x));const _=Jl(se(l,i),d);c=this.activation.apply(Be(y,_));const S=Be(se(a,i),se(Be(1,$r(a)),c));return[S,S]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:dh(this.activation),recurrentActivation:dh(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Dr(this.kernelInitializer),recurrentInitializer:Dr(this.recurrentInitializer),biasInitializer:Dr(this.biasInitializer),kernelRegularizer:or(this.kernelRegularizer),recurrentRegularizer:or(this.recurrentRegularizer),biasRegularizer:or(this.biasRegularizer),activityRegularizer:or(this.activityRegularizer),kernelConstraint:bi(this.kernelConstraint),recurrentConstraint:bi(this.recurrentConstraint),biasConstraint:bi(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,n)}}tD.className="GRUCell";Le(tD);class H6 extends mh{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new tD(e);super(e)}call(e,n){return de(()=>{this.cell.dropoutMask!=null&&(on(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(on(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=n==null?null:n.mask,i=n==null?null:n.training,s=n==null?null:n.initialState;return super.call(e,{mask:r,training:i,initialState:s})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}H6.className="GRU";Le(H6);class z2 extends B2{constructor(e){super(e);this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Ri(this.units,"units"),this.activation=ph(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ph(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=kr(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=kr(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=kr(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Ar(e.kernelRegularizer),this.recurrentRegularizer=Ar(e.recurrentRegularizer),this.biasRegularizer=Ar(e.biasRegularizer),this.kernelConstraint=wi(e.kernelConstraint),this.recurrentConstraint=wi(e.recurrentConstraint),this.biasConstraint=wi(e.biasConstraint),this.dropout=yg([1,uh([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=yg([1,uh([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var n;e=qn(e);const r=e[e.length-1];this.kernel=this.addWeight("kernel",[r,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let i;if(this.useBias){if(this.unitForgetBias){const s=this.biasInitializer,o=this.units;i=new(n=class extends wa{apply(l,c){const u=s.apply([o]),h=new NR().apply([o]),f=s.apply([o*2]);return C5(C5(u,h),f)}},n.className="CustomInit",n)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,n){return de(()=>{const r=n.training==null?!1:n.training;if(e=e,e.length!==3)throw new ue(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let i=e[1];const s=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=gh({ones:()=>Ro(e),rate:this.dropout,training:r,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=gh({ones:()=>Ro(i),rate:this.recurrentDropout,training:r,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let l,c,u,h;0<this.dropout&&this.dropout<1&&(e=se(e,o[0]));let f=Jl(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(i=se(i,a[0])),f=Be(f,Jl(i,this.recurrentKernel.read())),this.useBias&&(f=ol(f,this.bias.read()));const[d,p,m,v]=so(f,4,f.rank-1);l=this.recurrentActivation.apply(d),c=this.recurrentActivation.apply(p),u=Be(se(c,s),se(l,this.activation.apply(m))),h=this.recurrentActivation.apply(v);const y=se(h,this.activation.apply(u));return[y,y,u]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:dh(this.activation),recurrentActivation:dh(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Dr(this.kernelInitializer),recurrentInitializer:Dr(this.recurrentInitializer),biasInitializer:Dr(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:or(this.kernelRegularizer),recurrentRegularizer:or(this.recurrentRegularizer),biasRegularizer:or(this.biasRegularizer),activityRegularizer:or(this.activityRegularizer),kernelConstraint:bi(this.kernelConstraint),recurrentConstraint:bi(this.recurrentConstraint),biasConstraint:bi(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,n)}}z2.className="LSTMCell";Le(z2);class j6 extends mh{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new z2(e);super(e)}call(e,n){return de(()=>{this.cell.dropoutMask!=null&&(on(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(on(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=n==null?null:n.mask,i=n==null?null:n.training,s=n==null?null:n.initialState;return super.call(e,{mask:r,training:i,initialState:s})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}j6.className="LSTM";Le(j6);class nD extends B2{constructor(e){super(e);this.cells=e.cells}get stateSize(){const e=[];for(const n of this.cells.slice().reverse())Array.isArray(n.stateSize)?e.push(...n.stateSize):e.push(n.stateSize);return e}call(e,n){return de(()=>{e=e;let r=e.slice(1);const i=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?i.push(r.splice(0,a.stateSize.length)):i.push(r.splice(0,1));i.reverse();const s=[];let o;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];r=i[a],a===0?o=[e[0]].concat(r):o=[o[0]].concat(r),o=l.call(o,n),s.push(o.slice(1))}r=[];for(const a of s.slice().reverse())r.push(...a);return[o[0]].concat(r)})}build(e){LR(e)&&(e=e[0]),e=e;let n;this.cells.forEach((r,i)=>{Vf(`RNNCell_${i}`,()=>{r.build(e),Array.isArray(r.stateSize)?n=r.stateSize[0]:n=r.stateSize,e=[e[0],n]})}),this.built=!0}getConfig(){const e=super.getConfig(),n=s=>({className:s.getClassName(),config:s.getConfig()}),i={cells:this.cells.map(n)};return Object.assign({},e,i)}static fromConfig(e,n,r={}){const i=[];for(const s of n.cells)i.push(ec(s,r));return new e({cells:i})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const n of this.cells)e.push(...n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.cells)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const r of this.cells)n.push(...r.trainableWeights);return n.concat(e)}return e}getWeights(){const e=[];for(const n of this.cells)e.push(...n.weights);return BR(e)}setWeights(e){const n=[];for(const r of this.cells){const i=r.weights.length,s=e.splice(i);for(let o=0;o<r.weights.length;++o)n.push([r.weights[o],s[o]])}zR(n)}}nD.className="StackedRNNCells";Le(nD);function gh(t){const{ones:e,rate:n,training:r=!1,count:i=1,dropoutFunc:s}=t,o=()=>s!=null?s(e(),n):E5(e(),n),a=()=>Lb(o,e,r);return!i||i<=1?Tr(a().clone()):Array(i).fill(void 0).map(a).map(c=>Tr(c.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var eBe=globalThis&&globalThis.__rest||function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n};class q6 extends mh{constructor(e){if(e.unroll)throw new tn("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new tn("It is not possible at the moment to stack convolutional cells.");super(e);this.inputSpec=[new xi({ndim:5})]}call(e,n){return de(()=>{if(this.cell.dropoutMask!=null&&(on(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(on(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),n&&n.constants)throw new ue("ConvRNN2D cell does not support constants");const r=n==null?null:n.mask,i=n==null?null:n.training,s=n==null?null:n.initialState;return super.call(e,{mask:r,training:i,initialState:s})})}computeOutputShape(e){let n=this.computeSingleOutputShape(e);return this.returnSequences||(n=[n[0],...n.slice(2)]),this.returnState&&(n=[n,...Array(2).fill([e[0],...n.slice(-3)])]),n}getInitialState(e){return de(()=>{const{stateSize:n}=this.cell,r=e.shape,i=this.computeSingleOutputShape(r),s=[i[0],...i.slice(2)],o=zr(s);return Array.isArray(n)?Array(n.length).fill(o):[o]})}resetStates(e,n=!1){de(()=>{if(!this.stateful)throw new Yl("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape,i=this.computeSingleOutputShape(r),s=[i[0],...i.slice(2)];if(r[0]==null)throw new ue("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>zr(s)):this.states_=[zr(s)];else if(e==null)on(this.states_),this.keptStates!=null&&(on(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>zr(s)):this.states_[0]=zr(s);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new ue(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n?this.keptStates.push(this.states_.slice()):on(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],c=s;if(!wn(l.shape,c))throw new ue(`State ${a} is incompatible with layer ${this.name}: expected shape=${c}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>Tr(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:n,filters:r,kernelSize:i,padding:s,strides:o,dilationRate:a}=this.cell,l=n==="channelsFirst",c=e[l?3:2],u=e[l?4:3],h=ll(c,i[0],s,o[0],a[0]),f=ll(u,i[1],s,o[1],a[1]);return[...e.slice(0,2),...l?[r,h,f]:[h,f,r]]}}q6.className="ConvRNN2D";class rD extends z2{constructor(e){const{filters:n,kernelSize:r,strides:i,padding:s,dataFormat:o,dilationRate:a}=e;super(Object.assign({},e,{units:n}));this.filters=n,Ri(this.filters,"filters"),this.kernelSize=wg(r,2,"kernelSize"),this.kernelSize.forEach(l=>Ri(l,"kernelSize")),this.strides=wg(i||1,2,"strides"),this.strides.forEach(l=>Ri(l,"strides")),this.padding=s||"valid",Lo(this.padding),this.dataFormat=o||"channelsLast",jr(this.dataFormat),this.dilationRate=wg(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>Ri(l,"dilationRate"))}build(e){var n;e=qn(e);const r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new ue(`The channel dimension of the input should be defined. Found ${e[r]}`);const i=e[r],s=4,o=this.kernelSize.concat([i,this.filters*s]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*s]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const c=this.biasInitializer,u=this.filters;l=new(n=class extends wa{apply(f,d){const p=c.apply([u]),m=io([u]),v=c.apply([u*2]);return AR([p,m,v])}},n.className="CustomInit",n)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*s],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,n){return de(()=>{if(e.length!==3)throw new ue(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const r=n.training||!1,i=e[0],s=e[1],o=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=gh({ones:()=>Ro(i),rate:this.dropout,training:r,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,c=(ae,pe,ke)=>!pe||!pe[ke]?ae:se(pe[ke],ae);let u=c(i,l,0),h=c(i,l,1),f=c(i,l,2),d=c(i,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=gh({ones:()=>Ro(s),rate:this.recurrentDropout,training:r,count:a,dropoutFunc:this.dropoutFunc}));const p=this.recurrentDropoutMask;let m=c(s,p,0),v=c(s,p,1),y=c(s,p,2),w=c(s,p,3);const x=3,[_,S,T,E]=so(this.kernel.read(),a,x),[k,A,M,D]=this.useBias?so(this.bias.read(),a):[null,null,null,null];u=this.inputConv(u,_,k,this.padding),h=this.inputConv(h,S,A,this.padding),f=this.inputConv(f,T,M,this.padding),d=this.inputConv(d,E,D,this.padding);const[P,N,R,F]=so(this.recurrentKernel.read(),a,x);m=this.recurrentConv(m,P),v=this.recurrentConv(v,N),y=this.recurrentConv(y,R),w=this.recurrentConv(w,F);const O=this.recurrentActivation.apply(Be(u,m)),K=this.recurrentActivation.apply(Be(h,v)),J=Be(se(K,o),se(O,this.activation.apply(Be(f,y)))),re=se(this.recurrentActivation.apply(Be(d,w)),this.activation.apply(J));return[re,re,J]})}getConfig(){const e=super.getConfig(),n=eBe(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},n,r)}inputConv(e,n,r,i){const s=ju(e,n,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return r?ol(s,r,this.dataFormat):s}recurrentConv(e,n){return ju(e,n,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}rD.className="ConvLSTM2DCell";Le(rD);class X6 extends q6{constructor(e){const n=new rD(e);super(Object.assign({},e,{cell:n}))}static fromConfig(e,n){return new e(n)}}X6.className="ConvLSTM2D";Le(X6);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class iD extends Pn{constructor(e){super(e);this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const n=e.shape,r=[];for(let i=0;i<this.noiseShape.length;++i)r.push(this.noiseShape[i]==null?n[i]:this.noiseShape[i]);return r}call(e,n){return de(()=>{this.invokeCallHook(e,n);const r=rn(e);if(0<this.rate&&this.rate<1){const i=n.training==null?!1:n.training,s=this.getNoiseShape(r);return Lb(()=>E5(r,this.rate,s,this.seed),()=>r,i)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=super.getConfig();return Object.assign(e,n),e}dispose(){return super.dispose()}}iD.className="Dropout";Le(iD);class K6 extends iD{constructor(e){super(e);this.inputSpec=[{ndim:3}]}getNoiseShape(e){const n=e.shape;return[n[0],1,n[2]]}}K6.className="SpatialDropout1D";Le(K6);class sD extends Pn{constructor(e){super(e);if(this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let n=null;e.batchSize!=null&&(n=e.batchSize),this.batchInputShape=[n,e.inputDim]}this.units=e.units,Ri(this.units,"units"),this.activation=ph(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=kr(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=kr(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=wi(e.kernelConstraint),this.biasConstraint=wi(e.biasConstraint),this.kernelRegularizer=Ar(e.kernelRegularizer),this.biasRegularizer=Ar(e.biasRegularizer),this.activityRegularizer=Ar(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=qn(e);const n=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:n}}],this.built=!0}computeOutputShape(e){e=qn(e);const n=e.slice();return n[n.length-1]=this.units,n}call(e,n){return de(()=>{this.invokeCallHook(e,n);const r=rn(e),i=f5(this.activation.getClassName());let s;return i!=null?s=Jl(r,this.kernel.read(),i,this.bias?this.bias.read():null):(s=Jl(r,this.kernel.read()),this.bias!=null&&(s=ol(s,this.bias.read())),this.activation!=null&&(s=this.activation.apply(s))),s})}getConfig(){const e={units:this.units,activation:dh(this.activation),useBias:this.useBias,kernelInitializer:Dr(this.kernelInitializer),biasInitializer:Dr(this.biasInitializer),kernelRegularizer:or(this.kernelRegularizer),biasRegularizer:or(this.biasRegularizer),activityRegularizer:or(this.activityRegularizer),kernelConstraint:bi(this.kernelConstraint),biasConstraint:bi(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}sD.className="Dense";Le(sD);class Y6 extends Pn{constructor(e){e=e||{};super(e);this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=qn(e);for(const n of e.slice(1))if(n==null)throw new ue(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],ch(e,1)]}call(e,n){return de(()=>{this.invokeCallHook(e,n);let r=rn(e);if(this.dataFormat==="channelsFirst"&&r.rank>1){const i=[0];for(let s=2;s<r.rank;++s)i.push(s);i.push(1),r=Mn(r,i)}return $Fe(r)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const n=super.getConfig();return Object.assign(e,n),e}}Y6.className="Flatten";Le(Y6);class Z6 extends Pn{constructor(e){super(e);this.supportsMasking=!0,this.activation=ph(e.activation)}call(e,n){return de(()=>{this.invokeCallHook(e,n);const r=rn(e);return this.activation.apply(r)})}getConfig(){const e={activation:dh(this.activation)},n=super.getConfig();return Object.assign(e,n),e}}Z6.className="Activation";Le(Z6);class J6 extends Pn{constructor(e){super(e);this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,n){return de(()=>(e=rn(e),IFe(e,this.n)))}getConfig(){const e={n:this.n},n=super.getConfig();return Object.assign(e,n),e}}J6.className="RepeatVector";Le(J6);class Q6 extends Pn{constructor(e){super(e);this.targetShape=e.targetShape;for(let n=0;n<this.targetShape.length;++n)this.isUnknown(this.targetShape[n])&&(this.targetShape[n]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,n){const r="Total size of new array must be unchanged.",i=n.slice();let s=1,o=null;for(let l=0;l<i.length;++l){const c=i[l];if(this.isUnknown(c))if(o===null)o=l;else throw new ue("Can only specifiy one unknown dimension.");else s*=c}const a=ch(e);if(o!==null){if(s===0||a%s!=0)throw new ue(r);i[o]=a/s}else if(a!==s)throw new ue(r);return i}computeOutputShape(e){let n=!1;for(let r=0;r<e.length;++r)if(this.isUnknown(e[r])){n=!0;break}return n?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,n){return de(()=>{this.invokeCallHook(e,n);const r=rn(e),i=r.shape,s=i.slice(0,1).concat(this.fixUnknownDimension(i.slice(1),this.targetShape));return fe(r,s)})}getConfig(){const e={targetShape:this.targetShape},n=super.getConfig();return Object.assign(e,n),e}}Q6.className="Reshape";Le(Q6);class e8 extends Pn{constructor(e){super(e);if(e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const n=sl(1,e.dims.length+1);if(!wn(e.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new xi({ndim:this.dims.length+1})]}computeOutputShape(e){e=qn(e);const n=e.slice();return this.dims.forEach((r,i)=>{n[i+1]=e[r]}),n}call(e,n){return Mn(rn(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},n=super.getConfig();return Object.assign(e,n),e}}e8.className="Permute";Le(e8);class t8 extends Pn{constructor(e){super(e==null?{}:e);this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={maskValue:this.maskValue};return Object.assign(n,e),n}computeMask(e,n){const r=rn(e),i=-1;return CS(Rm(r,this.maskValue),i)}call(e,n){return de(()=>{this.invokeCallHook(e,n);const r=rn(e),i=-1,s=!0,o=CS(Rm(r,this.maskValue),i,s);return se(r,Qe(o,r.dtype))})}}t8.className="Masking";Le(t8);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class n8 extends Pn{constructor(e){super(e);if(this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let n=null;e.batchSize!=null&&(n=e.batchSize),e.inputLength==null?this.batchInputShape=[n,null]:this.batchInputShape=[n].concat(yr(e.inputLength))}this.inputDim=e.inputDim,Ri(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Ri(this.outputDim,"outputDim"),this.embeddingsInitializer=kr(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Ar(e.embeddingsRegularizer),this.activityRegularizer=Ar(e.activityRegularizer),this.embeddingsConstraint=wi(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,n){return de(()=>this.maskZero?(e=rn(e),Rm(e,In(e))):null)}computeOutputShape(e){if(e=qn(e),this.inputLength==null)return[...e,this.outputDim];const n=yr(this.inputLength);if(n.length!==e.length-1)throw new ue(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let r=0;for(let i=0;i<n.length;++i){const s=n[i],o=e[i+1];if(s!=null&&o!=null&&s!==o)throw new ue(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);s==null&&(n[r]=o),r++}}return[e[0],...n,this.outputDim]}call(e,n){return de(()=>{this.invokeCallHook(e,n);let r=rn(e);r.dtype!=="int32"&&(r=w2(r,"int32"));const i=T5(this.embeddings.read(),fe(r,[r.size]));return fe(i,qn(this.computeOutputShape(r.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Dr(this.embeddingsInitializer),embeddingsRegularizer:or(this.embeddingsRegularizer),activityRegularizer:or(this.activityRegularizer),embeddingsConstraint:bi(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=super.getConfig();return Object.assign(e,n),e}}n8.className="Embedding";Le(n8);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Hf extends Pn{constructor(e){super(e||{});this.supportsMasking=!0}mergeFunction(e){throw new tn}computeElementwiseOpOutputShape(e,n){if(e==null||n==null)return null;if(e.length<n.length)return this.computeElementwiseOpOutputShape(n,e);if(n.length===0)return e;const r=e.slice(0,e.length-n.length);for(let i=0;i<n.length;++i){const s=e[e.length-n.length+i],o=n[i];if(s==null||o==null||s<0||o<0)r.push(null);else if(s===1)r.push(o);else if(o===1)r.push(s);else{if(s!==o)throw new ue("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(n));r.push(s)}}return r}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[qn(e)]),e=e,e.length<2)throw new ue(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let n=[];for(const s of e)s!=null&&s[0]!==null&&n.push(s[0]);if(n=lh(n),n.length>1)throw new ue(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let r=e[0]==null?null:e[0].slice(1);for(let s=1;s<e.length;++s){const o=e[s]==null?null:e[s].slice(1);r=this.computeElementwiseOpOutputShape(r,o)}const i=e.map(s=>s.length);e.indexOf(null)===-1&&lh(i).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,n){return de(()=>{if(e=e,this.reshapeRequired){const r=[],i=e.map(s=>s.rank);if(i.indexOf(null)===-1){const s=uh(i);for(let o of e){const a=o.rank;for(let l=0;l<s-a;++l)o=Ob(o,1);r.push(o)}return this.mergeFunction(r)}else{let s=!1;for(const l of e){const c=l.rank;if(c==null){const u=l.shape,h=u[0],f=u.slice(1).concat([h]);let d=fe(l,[h].concat(ch(u.slice(1))));d=Mn(d,[1,0]),d=fe(d,f),r.push(d),s=!0}else if(c>1){const u=sl(1,c).concat([0]);r.push(Mn(l,u)),s=!0}else r.push(l)}let o=this.mergeFunction(r);const a=o.rank;if(s){if(a==null){const l=o.shape,c=l.length,u=l[c-1],h=[u].concat(l.slice(0,l.length-1));o=fe(Mn(fe(o,[-1,u]),[1,0]),h)}else if(a>1){const l=[a-1].concat(sl(0,a-1));o=Mn(o,l)}}return o}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let n;e[0]==null?n=null:n=e[0].slice(1);for(let i=1;i<e.length;++i){const s=e[i]==null?null:e[i].slice(1);n=this.computeElementwiseOpOutputShape(n,s)}let r=[];for(const i of e)i!=null&&i[0]!==null&&r.push(i[0]);return r=lh(r),r.length===1?n=r.concat(n):n=[null].concat(n),n}computeMask(e,n){return de(()=>{if(n==null)return null;if(!Array.isArray(n))throw new ue("`mask` should be an Array");if(!Array.isArray(e))throw new ue("`inputs` should be an Array");if(n.length!==e.length)throw new ue(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${n.length})`);if(n.every(i=>i==null))return null;n=n.map(i=>i==null?i:Io(i,0));let r=n[0];for(let i=1;i<n.length-1;++i)r=Vl(r,n[i]);return r})}}class r8 extends Hf{constructor(e){super(e)}mergeFunction(e){return de(()=>{let n=e[0].clone();for(let r=1;r<e.length;++r)n=Be(n,e[r]);return n})}}r8.className="Add";Le(r8);class i8 extends Hf{constructor(e){super(e)}mergeFunction(e){return de(()=>{let n=e[0].clone();for(let r=1;r<e.length;++r)n=se(n,e[r]);return n})}}i8.className="Multiply";Le(i8);class s8 extends Hf{constructor(e){super(e)}mergeFunction(e){return de(()=>{let n=e[0].clone();for(let r=1;r<e.length;++r)n=Be(n,e[r]);return se(1/e.length,n)})}}s8.className="Average";Le(s8);class o8 extends Hf{constructor(e){super(e)}mergeFunction(e){return de(()=>{let n=e[0];for(let r=1;r<e.length;++r)n=Bc(n,e[r]);return n})}}o8.className="Maximum";Le(o8);class a8 extends Hf{constructor(e){super(e)}mergeFunction(e){return de(()=>{let n=e[0];for(let r=1;r<e.length;++r)n=U0(n,e[r]);return n})}}a8.className="Minimum";Le(a8);class l8 extends Hf{constructor(e){super(e);this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new ue("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let n=!0;for(const i of e)if(i!=null){n=!1;break}if(n)return;const r=[];for(let i=0;i<e.length;++i){const s=e[i].slice();s.splice(this.axis,1);let o=!1;for(const a of r)if(wn(a,s)){o=!0;break}o||r.push(s)}if(r.length>1)throw new ue("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return de(()=>AR(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new ue("A `Concatenate` layer should be called on a list of inputs.");const n=e,r=n[0].slice(),i=this.axis<0?r.length+this.axis:this.axis;for(const s of n.slice(1)){if(r[i]==null||s[i]==null){r[i]=null;break}r[i]+=s[i]}return r}computeMask(e,n){if(n==null)return null;if(!Array.isArray(n))throw new ue("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new ue("`inputs` should be an array for Concatenate");if(n.length!==e.length)throw new ue(`Mismatch in the length of mask (${n.length}) and the legnth of inputs (${e.length})`);return de(()=>{let r=!0;if(n.forEach(o=>{if(o!=null){r=!1;return}}),r)return null;const i=[];for(let o=0;o<e.length;++o)n[o]==null?i.push(Qe(Ro(e[o]),"bool")):n[o].rank<e[o].rank?i.push(Io(n[o],-1)):i.push(n[o]);const s=ii(i,this.axis);return vI(s,-1,!1)})}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}l8.className="Concatenate";Le(l8);function qb(t,e){for(;t<0;)t+=e;return t}function tBe(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new tn("batchDot is not implemented for tensors of 4D or higher rank yet");if(z(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),z(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof n=="number"&&(n=[n,n]),t.dtype==="complex64"||e.dtype==="complex64")throw new tn("batchDot is not implemented for complex64-type Tensors yet.");const r=t.shape.length,i=e.shape.length;n==null&&(n=[r-1,i-2]);const s=n;return de(()=>{let o;if(r>i){o=r-i;const l=[];for(let c=0;c<o;++c)l.push(1);e=fe(e,e.shape.concat(l))}else if(i>r){o=i-r;const l=[];for(let c=0;c<o;++c)l.push(1);t=fe(t,t.shape.concat(l))}else o=0;let a;if(t.shape.length===2&&e.shape.length===2)s[0]===s[1]?a=xt(se(t,e),s[0]):a=xt(se(Mn(t,[1,0]),e),s[1]);else{const l=s[0]!==t.shape.length-1,c=s[1]===e.shape.length-1;a=gn(t,e,l,c)}if(o>0){let l;r>i?l=r+i-3:l=r-1;const c=[];for(let u=l;u<l+o;++u)c.push(u);a=Wl(a,c)}return a.shape.length===1&&(a=Io(a,1)),a})}class c8 extends Hf{constructor(e){super(e);this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){z(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0],r=e[1];if(n.length>3||r.length>3)throw new tn("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(n,r);if(n[i[0]]!==r[i[1]])throw new ue(`Dimension incompatibility: ${n[i[0]]} !== ${r[i[1]]}`)}mergeFunction(e){if(e.length!==2)throw new ue(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let n=e[0],r=e[1],i;return Array.isArray(this.axes)?i=this.axes.map((s,o)=>qb(s,e[o].shape.length)):i=[qb(this.axes,n.shape.length),qb(this.axes,r.shape.length)],this.normalize&&(n=A2(n,i[0]),r=A2(r,i[1])),tBe(n,r,i)}interpretAxes(e,n){let r;return Array.isArray(this.axes)?r=this.axes:r=[qb(this.axes,e.length),qb(this.axes,n.length)],r}computeOutputShape(e){z(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0].slice(),r=e[1].slice();if(n.length>3||r.length>3)throw new tn("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(n,r);n.splice(i[0],1),r.splice(i[1],1),r.splice(0,1);const s=n.concat(r);return s.length===1&&s.push(1),s}computeMask(e,n){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},n=super.getConfig();return Object.assign(e,n),e}}c8.className="Dot";Le(c8);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class u8 extends Pn{constructor(e){super(e);this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={stddev:this.stddev};return Object.assign(n,e),n}call(e,n){return de(()=>{this.invokeCallHook(e,n);const r=rn(e);return Lb(()=>Be(_2(r.shape,0,this.stddev),r),()=>r,n.training||!1)})}}u8.className="GaussianNoise";Le(u8);class h8 extends Pn{constructor(e){super(e);this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return de(()=>{this.invokeCallHook(e,n);const r=rn(e);return this.rate>0&&this.rate<1?Lb(()=>{const s=Math.sqrt(this.rate/(1-this.rate));return se(r,_2(r.shape,1,s))},()=>r,n.training||!1):r})}}h8.className="GaussianDropout";Le(h8);class f8 extends Pn{constructor(e){super(e);this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||rn(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return de(()=>{if(this.rate<1&&this.rate>0){const r=this._getNoiseShape(e);return Lb(()=>{const s=rn(e),o=1.6732632423543772,a=1.0507009873554805,l=-o*a;let c=xf(Dm(r),this.rate);c=w2(c,"float32");const u=((1-this.rate)*(1+this.rate*l**2))**-.5,h=-u*l*this.rate,f=Be(se(s,c),se(Be(c,-1),l));return Be(se(f,u),h)},()=>rn(e),n.training||!1)}return e})}}f8.className="AlphaDropout";Le(f8);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Xb(t,e,n,r,i,s=.001){let o;if(t.rank===2)o=Fz(t,e,n,r,i,s);else if(t.rank===3)o=Lz(t,e,n,r,i,s);else if(t.rank===4)o=Bz(t,e,n,r,i,s);else throw new tn(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return o}function nBe(t,e,n,r,i=.001){return de(()=>{const s=OS(t,r),o=s.mean,a=s.variance;return[Xb(t,o,a,n,e,i),o,a]})}function rBe(t,e,n,r,i=.001){return de(()=>{const s=OS(t,r),o=s.mean,a=s.variance,l=[];for(const p of sl(0,t.rank))r.indexOf(p)!==-1?l.push(1):l.push(t.shape[p]);const c=fe(o,l),u=fe(a,l),h=e==null?null:fe(e,l),f=n==null?null:fe(n,l);return[Xb(t,c,u,f,h,i),o,a]})}function iBe(t,e,n,r,i=.001){return wn(r.slice().sort(),sl(0,t.rank-1))?nBe(t,e,n,r,i):rBe(t,e,n,r,i)}class d8 extends Pn{constructor(e){e==null&&(e={});super(e);this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=kr(e.betaInitializer||"zeros"),this.gammaInitializer=kr(e.gammaInitializer||"ones"),this.movingMeanInitializer=kr(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=kr(e.movingVarianceInitializer||"ones"),this.betaConstraint=wi(e.betaConstraint),this.gammaConstraint=wi(e.gammaConstraint),this.betaRegularizer=Ar(e.betaRegularizer),this.gammaRegularizer=Ar(e.gammaRegularizer)}build(e){e=qn(e);const n=this.axis>=0?this.axis:this.axis+e.length,r=e[n];if(r==null)throw new ue(`Axis ${n} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new xi({ndim:e.length,axes:{[n]:r}})];const i=[r];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,n){return de(()=>{const r=n.training==null?!1:n.training,i=rn(e),s=i.shape,o=s.length,a=sl(0,o),l=this.axis>=0?this.axis:this.axis+o;a.splice(l,1);const c=Lf(1,o);c[l]=s[l];const u=a.slice();u.sort();const h=!wn(u,sl(0,o).slice(0,o-1)),f=()=>{if(h){const w=fe(this.movingMean.read(),c),x=fe(this.movingVariance.read(),c),_=this.center?fe(this.beta.read(),c):null,S=this.scale?fe(this.gamma.read(),c):null;return Xb(i,w,x,_,S,this.epsilon)}else return Xb(i,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!r)return f();const[d,p,m]=iBe(i,this.gamma.read(),this.beta.read(),a,this.epsilon),v=(w,x,_)=>{de(()=>{const S=1-_,T=w.read(),E=se(mt(T,x),S);w.write(mt(T,E))})};return(()=>{v(this.movingMean,p,this.momentum),v(this.movingVariance,m,this.momentum)})(),d})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Dr(this.betaInitializer),gammaInitializer:Dr(this.gammaInitializer),movingMeanInitializer:Dr(this.movingMeanInitializer),movingVarianceInitializer:Dr(this.movingVarianceInitializer),betaRegularizer:or(this.betaRegularizer),gammaRegularizer:or(this.gammaRegularizer),betaConstraint:bi(this.betaConstraint),gammaConstraint:bi(this.gammaConstraint)},n=super.getConfig();return Object.assign(e,n),e}}d8.className="BatchNormalization";Le(d8);class p8 extends Pn{constructor(e){e==null&&(e={});super(e);if(this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const n of this.axis)if(!Number.isInteger(n))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=kr(e.betaInitializer||"zeros"),this.gammaInitializer=kr(e.gammaInitializer||"ones"),this.betaRegularizer=Ar(e.betaRegularizer),this.gammaRegularizer=Ar(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=qn(e);const n=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let s=0;s<this.axis.length;++s)this.axis[s]<0&&(this.axis[s]+=n);for(const s of this.axis)if(s<0||s>=n)throw new Error(`Invalid axis: ${s}`);if(this.axis.length!==lh(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const r=this.axis.map(s=>e[s]),i=!0;this.scale?this.gamma=this.addWeight("gamma",r,"float32",this.gammaInitializer,this.gammaRegularizer,i):this.gamma=null,this.center?this.beta=this.addWeight("beta",r,"float32",this.betaInitializer,this.betaRegularizer,i):this.beta=null,this.built=!0}call(e,n){const r=rn(e),i=r.shape,s=i.length;return de(()=>{const o=!0;let{mean:a,variance:l}=OS(r,this.axis,o);const c=Lf(1,s);for(const m of this.axis)c[m]=i[m];const u=m=>m!=null&&m.shape.length!==s?fe(m,c):m;let h=u(this.gamma.read()),f=u(this.beta.read());const d=[],p=[];for(let m=0;m<s;++m)this.axis.indexOf(m)!==-1?(d.push(i[m]),p.push(1)):(d.push(1),p.push(i[m]));return a=ua(a,d),l=ua(l,d),h=ua(h,p),f=ua(f,p),Xb(r,a,l,f,h,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Dr(this.betaInitializer),gammaInitializer:Dr(this.gammaInitializer),betaRegularizer:or(this.betaRegularizer),gammaRegularizer:or(this.gammaRegularizer)},n=super.getConfig();return Object.assign(e,n),e}}p8.className="LayerNormalization";Le(p8);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sBe(t,e,n){return de(()=>{if(t.rank!==4)throw new ue(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new ue("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=il()),n!=="channelsLast"&&n!=="channelsFirst")throw new ue(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return n==="channelsFirst"?r=[[0,0],[0,0],e[0],e[1]]:r=[[0,0],e[0],e[1],[0,0]],qu(t,r)})}class m8 extends Pn{constructor(e){e==null&&(e={});super(e);if(this.dataFormat=e.dataFormat==null?il():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new ue(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let n,r;if(typeof e.padding[0]=="number")n=[e.padding[0],e.padding[0]],r=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new ue(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(n=e.padding[0],e.padding[1].length!==2)throw new ue(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);r=e.padding[1]}this.padding=[n,r]}this.inputSpec=[new xi({ndim:4})]}computeOutputShape(e){e=qn(e);let n,r;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?n=e[2]+this.padding[0][0]+this.padding[0][1]:n=null,e[3]!=null&&e[3]>=0?r=e[3]+this.padding[1][0]+this.padding[1][1]:r=null,[e[0],e[1],n,r]):(e[1]!=null&&e[1]>=0?n=e[1]+this.padding[0][0]+this.padding[0][1]:n=null,e[2]!=null&&e[2]>=0?r=e[2]+this.padding[1][0]+this.padding[1][1]:r=null,[e[0],n,r,e[3]])}call(e,n){return de(()=>sBe(rn(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}m8.className="ZeroPadding2D";Le(m8);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function V2(t,e,n,r,i,s){return de(()=>{jr(i),b5(s),Lo(r),n==null&&(n=[1,1]),r==null&&(r="valid"),i==null&&(i=il()),s==null&&(s="max"),t=QR(t,i);let o;const a=r==="same"?"same":"valid";return s==="max"?o=DS(t,e,n,a):o=ES(t,e,n,a),i==="channelsFirst"&&(o=Mn(o,[0,3,1,2])),o})}function g8(t,e,n,r,i,s){return de(()=>{jr(i),b5(s),Lo(r),n==null&&(n=[1,1,1]),r==null&&(r="valid"),i==null&&(i=il()),s==null&&(s="max"),t=R6(t,i);let o;const a=r==="same"?"same":"valid";return s==="max"?o=RI(t,e,n,a):o=wI(t,e,n,a),i==="channelsFirst"&&(o=Mn(o,[0,4,1,2,3])),o})}class v8 extends Pn{constructor(e){e.poolSize==null&&(e.poolSize=2);super(e);if(typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new ue(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(Ri(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new ue(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);Ri(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Lo(this.padding),this.inputSpec=[new xi({ndim:3})]}computeOutputShape(e){e=qn(e);const n=ll(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],n,e[2]]}call(e,n){return de(()=>{this.invokeCallHook(e,n),e=Ob(rn(e),2);const r=this.poolingFunction(rn(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Wl(r,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=super.getConfig();return Object.assign(e,n),e}}class y8 extends v8{constructor(e){super(e)}poolingFunction(e,n,r,i,s){return jr(s),Lo(i),V2(e,n,r,i,s,"max")}}y8.className="MaxPooling1D";Le(y8);class b8 extends v8{constructor(e){super(e)}poolingFunction(e,n,r,i,s){return jr(s),Lo(i),V2(e,n,r,i,s,"avg")}}b8.className="AveragePooling1D";Le(b8);class w8 extends Pn{constructor(e){e.poolSize==null&&(e.poolSize=[2,2]);super(e);if(this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new ue(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Ri(this.poolSize,"poolSize"),Ri(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,jr(this.dataFormat),Lo(this.padding),this.inputSpec=[new xi({ndim:4})]}computeOutputShape(e){e=qn(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2];return n=ll(n,this.poolSize[0],this.padding,this.strides[0]),r=ll(r,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,r]:[e[0],n,r,e[3]]}call(e,n){return de(()=>(this.invokeCallHook(e,n),this.poolingFunction(rn(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class x8 extends w8{constructor(e){super(e)}poolingFunction(e,n,r,i,s){return jr(s),Lo(i),V2(e,n,r,i,s,"max")}}x8.className="MaxPooling2D";Le(x8);class _8 extends w8{constructor(e){super(e)}poolingFunction(e,n,r,i,s){return jr(s),Lo(i),V2(e,n,r,i,s,"avg")}}_8.className="AveragePooling2D";Le(_8);class S8 extends Pn{constructor(e){e.poolSize==null&&(e.poolSize=[2,2,2]);super(e);if(this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new ue(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Ri(this.poolSize,"poolSize"),Ri(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,jr(this.dataFormat),Lo(this.padding),this.inputSpec=[new xi({ndim:5})]}computeOutputShape(e){e=qn(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2],i=this.dataFormat==="channelsFirst"?e[4]:e[3];return n=ll(n,this.poolSize[0],this.padding,this.strides[0]),r=ll(r,this.poolSize[1],this.padding,this.strides[1]),i=ll(i,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,r,i]:[e[0],n,r,i,e[4]]}call(e,n){return de(()=>(this.invokeCallHook(e,n),this.poolingFunction(rn(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class C8 extends S8{constructor(e){super(e)}poolingFunction(e,n,r,i,s){return jr(s),Lo(i),g8(e,n,r,i,s,"max")}}C8.className="MaxPooling3D";Le(C8);class T8 extends S8{constructor(e){super(e)}poolingFunction(e,n,r,i,s){return jr(s),Lo(i),g8(e,n,r,i,s,"avg")}}T8.className="AveragePooling3D";Le(T8);class E8 extends Pn{constructor(e){super(e);this.inputSpec=[new xi({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,n){throw new tn}}class k8 extends E8{constructor(e){super(e||{})}call(e,n){return de(()=>{const r=rn(e);return Br(r,1)})}}k8.className="GlobalAveragePooling1D";Le(k8);class A8 extends E8{constructor(e){super(e||{})}call(e,n){return de(()=>{const r=rn(e);return Ja(r,1)})}}A8.className="GlobalMaxPooling1D";Le(A8);class M8 extends Pn{constructor(e){super(e);this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,jr(this.dataFormat),this.inputSpec=[new xi({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,n){throw new tn}getConfig(){const e={dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class I8 extends M8{call(e,n){return de(()=>{const r=rn(e);return this.dataFormat==="channelsLast"?Br(r,[1,2]):Br(r,[2,3])})}}I8.className="GlobalAveragePooling2D";Le(I8);class N8 extends M8{call(e,n){return de(()=>{const r=rn(e);return this.dataFormat==="channelsLast"?Ja(r,[1,2]):Ja(r,[2,3])})}}N8.className="GlobalMaxPooling2D";Le(N8);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class $8 extends Pn{constructor(e){super(e);this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=super.getConfig();return Object.assign(e,n),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,n,r={}){const i=n.layer,s=ec(i,r);delete n.layer;const o={layer:s};return Object.assign(o,n),new e(o)}}class R8 extends $8{constructor(e){super(e);this.supportsMasking=!0}build(e){if(e=qn(e),e.length<3)throw new ue(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const n=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=qn(e);const n=[e[0]].concat(e.slice(2)),r=this.layer.computeOutputShape(n),i=e[1];return[r[0],i].concat(r.slice(1))}call(e,n){return de(()=>(e=rn(e),W6((o,a)=>[rn(this.layer.call(o,n)),[]],e,[],!1,null,null,!1,!0)[1]))}}R8.className="TimeDistributed";Le(R8);function oBe(t){zf(TFe,"BidirectionalMergeMode",t)}const aBe="concat";class D8 extends $8{constructor(e){super(e);const n=e.layer.getConfig(),r={};r.className=e.layer.getClassName(),r.config=n,this.forwardLayer=ec(r),n.goBackwards=n.goBackwards!==!0;const i={};if(i.className=e.layer.getClassName(),i.config=n,this.backwardLayer=ec(i),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?aBe:e.mergeMode,oBe(this.mergeMode),e.weights)throw new tn("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const n=e.length,r=Math.floor(n/2);this.forwardLayer.setWeights(e.slice(0,r)),this.backwardLayer.setWeights(e.slice(r))}computeOutputShape(e){let n=this.forwardLayer.computeOutputShape(e);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;let r,i,s;return this.returnState&&(s=n.slice(1)),r=n[0],r=r,this.mergeMode==="concat"?(r[r.length-1]*=2,i=[r]):this.mergeMode==null?i=[r,r.slice()]:i=[r],this.returnState?this.mergeMode==null?i.concat(s).concat(s.slice()):[r].concat(s).concat(s.slice()):Vs(i)}apply(e,n){let r=n==null?null:n.initialState,i=n==null?null:n.constants;n==null&&(n={});const s=U6(e,r,i,this.numConstants);if(e=s.inputs,r=s.initialState,i=s.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(r==null||r.length===0)&&i==null)return super.apply(e,n);const o=[],a=[];if(r!=null){const c=r.length;if(c%2>0)throw new ue("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=r,o.push(...r);const u=r.map(h=>new xi({shape:h.shape}));this.forwardLayer.stateSpec=u.slice(0,c/2),this.backwardLayer.stateSpec=u.slice(c/2),a.push(...u)}if(i!=null)throw new tn("Support for constants in Bidirectional layers is not implemented yet.");const l=o[0]instanceof Ql;for(const c of o)if(c instanceof Ql!==l)throw new ue("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const c=[e].concat(o),u=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=u;const f=super.apply(c,n);return this.inputSpec=h,f}else return super.apply(e,n)}call(e,n){return de(()=>{const r=n.initialState;let i,s;if(r==null)i=this.forwardLayer.call(e,n),s=this.backwardLayer.call(e,n);else{const l=r.slice(0,r.length/2),c=r.slice(r.length/2);i=this.forwardLayer.call(e,Object.assign(n,{initialState:l})),s=this.backwardLayer.call(e,Object.assign(n,{initialState:c}))}let o;this.returnState&&(Array.isArray(i)&&(o=i.slice(1).concat(s.slice(1))),i=i[0],s=s[0]),this.returnSequences&&(s=Do(s,1));let a;return this.mergeMode==="concat"?a=AR([i,s]):this.mergeMode==="sum"?a=Be(i,s):this.mergeMode==="ave"?a=se(.5,Be(i,s)):this.mergeMode==="mul"?a=se(i,s):this.mergeMode==null&&(a=[i,s]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Vf(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Vf(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,n){Array.isArray(n)&&(n=n[0]);let r;if(this.returnSequences?this.mergeMode==null?r=[n,n]:r=n:this.mergeMode==null?r=[null,null]:r=null,this.returnState){const s=this.forwardLayer.states.map(o=>null);return Array.isArray(r)?r.concat(s).concat(s):[r].concat(s).concat(s)}else return r}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},n=super.getConfig();return Object.assign(e,n),e}static fromConfig(e,n){const r=ec(n.layer);if(delete n.layer,n.numConstants!=null)throw new tn("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const i=n;return i.layer=r,new e(i)}}D8.className="Bidirectional";Le(D8);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function P8(t){return new sD(t)}var U2={exports:{}},lBe=A0(gPe),cBe=A0(hV);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(function(t,e){(function(n,r){r(e,lBe,cBe)})($t,function(n,r,i){const s={1:{name:"/m/01g317",id:1,displayName:"person"},2:{name:"/m/0199g",id:2,displayName:"bicycle"},3:{name:"/m/0k4j",id:3,displayName:"car"},4:{name:"/m/04_sv",id:4,displayName:"motorcycle"},5:{name:"/m/05czz6l",id:5,displayName:"airplane"},6:{name:"/m/01bjv",id:6,displayName:"bus"},7:{name:"/m/07jdr",id:7,displayName:"train"},8:{name:"/m/07r04",id:8,displayName:"truck"},9:{name:"/m/019jd",id:9,displayName:"boat"},10:{name:"/m/015qff",id:10,displayName:"traffic light"},11:{name:"/m/01pns0",id:11,displayName:"fire hydrant"},13:{name:"/m/02pv19",id:13,displayName:"stop sign"},14:{name:"/m/015qbp",id:14,displayName:"parking meter"},15:{name:"/m/0cvnqh",id:15,displayName:"bench"},16:{name:"/m/015p6",id:16,displayName:"bird"},17:{name:"/m/01yrx",id:17,displayName:"cat"},18:{name:"/m/0bt9lr",id:18,displayName:"dog"},19:{name:"/m/03k3r",id:19,displayName:"horse"},20:{name:"/m/07bgp",id:20,displayName:"sheep"},21:{name:"/m/01xq0k1",id:21,displayName:"cow"},22:{name:"/m/0bwd_0j",id:22,displayName:"elephant"},23:{name:"/m/01dws",id:23,displayName:"bear"},24:{name:"/m/0898b",id:24,displayName:"zebra"},25:{name:"/m/03bk1",id:25,displayName:"giraffe"},27:{name:"/m/01940j",id:27,displayName:"backpack"},28:{name:"/m/0hnnb",id:28,displayName:"umbrella"},31:{name:"/m/080hkjn",id:31,displayName:"handbag"},32:{name:"/m/01rkbr",id:32,displayName:"tie"},33:{name:"/m/01s55n",id:33,displayName:"suitcase"},34:{name:"/m/02wmf",id:34,displayName:"frisbee"},35:{name:"/m/071p9",id:35,displayName:"skis"},36:{name:"/m/06__v",id:36,displayName:"snowboard"},37:{name:"/m/018xm",id:37,displayName:"sports ball"},38:{name:"/m/02zt3",id:38,displayName:"kite"},39:{name:"/m/03g8mr",id:39,displayName:"baseball bat"},40:{name:"/m/03grzl",id:40,displayName:"baseball glove"},41:{name:"/m/06_fw",id:41,displayName:"skateboard"},42:{name:"/m/019w40",id:42,displayName:"surfboard"},43:{name:"/m/0dv9c",id:43,displayName:"tennis racket"},44:{name:"/m/04dr76w",id:44,displayName:"bottle"},46:{name:"/m/09tvcd",id:46,displayName:"wine glass"},47:{name:"/m/08gqpm",id:47,displayName:"cup"},48:{name:"/m/0dt3t",id:48,displayName:"fork"},49:{name:"/m/04ctx",id:49,displayName:"knife"},50:{name:"/m/0cmx8",id:50,displayName:"spoon"},51:{name:"/m/04kkgm",id:51,displayName:"bowl"},52:{name:"/m/09qck",id:52,displayName:"banana"},53:{name:"/m/014j1m",id:53,displayName:"apple"},54:{name:"/m/0l515",id:54,displayName:"sandwich"},55:{name:"/m/0cyhj_",id:55,displayName:"orange"},56:{name:"/m/0hkxq",id:56,displayName:"broccoli"},57:{name:"/m/0fj52s",id:57,displayName:"carrot"},58:{name:"/m/01b9xk",id:58,displayName:"hot dog"},59:{name:"/m/0663v",id:59,displayName:"pizza"},60:{name:"/m/0jy4k",id:60,displayName:"donut"},61:{name:"/m/0fszt",id:61,displayName:"cake"},62:{name:"/m/01mzpv",id:62,displayName:"chair"},63:{name:"/m/02crq1",id:63,displayName:"couch"},64:{name:"/m/03fp41",id:64,displayName:"potted plant"},65:{name:"/m/03ssj5",id:65,displayName:"bed"},67:{name:"/m/04bcr3",id:67,displayName:"dining table"},70:{name:"/m/09g1w",id:70,displayName:"toilet"},72:{name:"/m/07c52",id:72,displayName:"tv"},73:{name:"/m/01c648",id:73,displayName:"laptop"},74:{name:"/m/020lf",id:74,displayName:"mouse"},75:{name:"/m/0qjjc",id:75,displayName:"remote"},76:{name:"/m/01m2v",id:76,displayName:"keyboard"},77:{name:"/m/050k8",id:77,displayName:"cell phone"},78:{name:"/m/0fx9l",id:78,displayName:"microwave"},79:{name:"/m/029bxz",id:79,displayName:"oven"},80:{name:"/m/01k6s3",id:80,displayName:"toaster"},81:{name:"/m/0130jx",id:81,displayName:"sink"},82:{name:"/m/040b_t",id:82,displayName:"refrigerator"},84:{name:"/m/0bt_c3",id:84,displayName:"book"},85:{name:"/m/01x3z",id:85,displayName:"clock"},86:{name:"/m/02s195",id:86,displayName:"vase"},87:{name:"/m/01lsmm",id:87,displayName:"scissors"},88:{name:"/m/0kmg4",id:88,displayName:"teddy bear"},89:{name:"/m/03wvsk",id:89,displayName:"hair drier"},90:{name:"/m/012xff",id:90,displayName:"toothbrush"}};class o{constructor(l,c){this.modelPath=c||`https://storage.googleapis.com/tfjs-models/savedmodel/${this.getPrefix(l)}/model.json`}getPrefix(l){return l==="lite_mobilenet_v2"?`ssd${l}`:`ssd_${l}`}async load(){this.model=await r.loadGraphModel(this.modelPath);const l=i.zeros([1,300,300,3],"int32"),c=await this.model.executeAsync(l);await Promise.all(c.map(u=>u.data())),c.map(u=>u.dispose()),l.dispose()}async infer(l,c,u){const h=i.tidy(()=>(l instanceof i.Tensor||(l=i.browser.fromPixels(l)),i.expandDims(l))),f=h.shape[1],d=h.shape[2],p=await this.model.executeAsync(h),m=p[0].dataSync(),v=p[1].dataSync();h.dispose(),i.dispose(p);const[y,w]=this.calculateMaxScores(m,p[0].shape[1],p[0].shape[2]),x=i.getBackend();i.getBackend()==="webgl"&&i.setBackend("cpu");const _=i.tidy(()=>{const T=i.tensor2d(v,[p[1].shape[1],p[1].shape[3]]);return i.image.nonMaxSuppression(T,y,c,u,u)}),S=_.dataSync();return _.dispose(),x!==i.getBackend()&&i.setBackend(x),this.buildDetectedObjects(d,f,v,y,S,w)}buildDetectedObjects(l,c,u,h,f,d){const p=f.length,m=[];for(let v=0;v<p;v++){const y=[];for(let T=0;T<4;T++)y[T]=u[4*f[v]+T];const w=y[0]*c,x=y[1]*l,_=y[2]*c,S=y[3]*l;y[0]=x,y[1]=w,y[2]=S-x,y[3]=_-w,m.push({bbox:y,class:s[d[f[v]]+1].displayName,score:h[f[v]]})}return m}calculateMaxScores(l,c,u){const h=[],f=[];for(let d=0;d<c;d++){let p=Number.MIN_VALUE,m=-1;for(let v=0;v<u;v++)l[d*u+v]>p&&(p=l[d*u+v],m=v);h[d]=p,f[d]=m}return[h,f]}async detect(l,c=20,u=.5){return this.infer(l,c,u)}dispose(){this.model!=null&&this.model.dispose()}}n.ObjectDetection=o,n.load=async function(a={}){if(i==null)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");const l=a.base||"lite_mobilenet_v2",c=a.modelUrl;if(["mobilenet_v1","mobilenet_v2","lite_mobilenet_v2"].indexOf(l)===-1)throw new Error(`ObjectDetection constructed with invalid base model ${l}. Valid names are 'mobilenet_v1', 'mobilenet_v2' and 'lite_mobilenet_v2'.`);const u=new o(l,c);return await u.load(),u},n.version="2.2.2",Object.defineProperty(n,"__esModule",{value:!0})})})(U2,U2.exports);/*!
 * Chart.js v3.7.0
 * https://www.chartjs.org
 * (c) 2021 Chart.js Contributors
 * Released under the MIT License
 */const O8=function(){return typeof window=="undefined"?function(t){return t()}:window.requestAnimationFrame}();function F8(t,e,n){const r=n||(o=>Array.prototype.slice.call(o));let i=!1,s=[];return function(...o){s=r(o),i||(i=!0,O8.call(window,()=>{i=!1,t.apply(e,s)}))}}function uBe(t,e){let n;return function(...r){return e?(clearTimeout(n),n=setTimeout(t,e,r)):t.apply(this,r),e}}const oD=t=>t==="start"?"left":t==="end"?"right":"center",xs=(t,e,n)=>t==="start"?e:t==="end"?n:(e+n)/2,hBe=(t,e,n,r)=>t===(r?"left":"right")?n:t==="center"?(e+n)/2:e;function jc(){}const fBe=function(){let t=0;return function(){return t++}}();function er(t){return t===null||typeof t=="undefined"}function br(t){if(Array.isArray&&Array.isArray(t))return!0;const e=Object.prototype.toString.call(t);return e.substr(0,7)==="[object"&&e.substr(-6)==="Array]"}function Nn(t){return t!==null&&Object.prototype.toString.call(t)==="[object Object]"}const ai=t=>(typeof t=="number"||t instanceof Number)&&isFinite(+t);function _a(t,e){return ai(t)?t:e}function fn(t,e){return typeof t=="undefined"?e:t}const dBe=(t,e)=>typeof t=="string"&&t.endsWith("%")?parseFloat(t)/100:t/e,L8=(t,e)=>typeof t=="string"&&t.endsWith("%")?parseFloat(t)/100*e:+t;function wr(t,e,n){if(t&&typeof t.call=="function")return t.apply(n,e)}function tr(t,e,n,r){let i,s,o;if(br(t))if(s=t.length,r)for(i=s-1;i>=0;i--)e.call(n,t[i],i);else for(i=0;i<s;i++)e.call(n,t[i],i);else if(Nn(t))for(o=Object.keys(t),s=o.length,i=0;i<s;i++)e.call(n,t[o[i]],o[i])}function W2(t,e){let n,r,i,s;if(!t||!e||t.length!==e.length)return!1;for(n=0,r=t.length;n<r;++n)if(i=t[n],s=e[n],i.datasetIndex!==s.datasetIndex||i.index!==s.index)return!1;return!0}function G2(t){if(br(t))return t.map(G2);if(Nn(t)){const e=Object.create(null),n=Object.keys(t),r=n.length;let i=0;for(;i<r;++i)e[n[i]]=G2(t[n[i]]);return e}return t}function B8(t){return["__proto__","prototype","constructor"].indexOf(t)===-1}function pBe(t,e,n,r){if(!B8(t))return;const i=e[t],s=n[t];Nn(i)&&Nn(s)?Kb(i,s,r):e[t]=G2(s)}function Kb(t,e,n){const r=br(e)?e:[e],i=r.length;if(!Nn(t))return t;n=n||{};const s=n.merger||pBe;for(let o=0;o<i;++o){if(e=r[o],!Nn(e))continue;const a=Object.keys(e);for(let l=0,c=a.length;l<c;++l)s(a[l],t,e,n)}return t}function Yb(t,e){return Kb(t,e,{merger:mBe})}function mBe(t,e,n){if(!B8(t))return;const r=e[t],i=n[t];Nn(r)&&Nn(i)?Yb(r,i):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=G2(i))}const gBe="",vBe=".";function z8(t,e){const n=t.indexOf(vBe,e);return n===-1?t.length:n}function jf(t,e){if(e===gBe)return t;let n=0,r=z8(e,n);for(;t&&r>n;)t=t[e.substr(n,r-n)],n=r+1,r=z8(e,n);return t}function aD(t){return t.charAt(0).toUpperCase()+t.slice(1)}const Sa=t=>typeof t!="undefined",vh=t=>typeof t=="function",V8=(t,e)=>{if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0};function yBe(t){return t.type==="mouseup"||t.type==="click"||t.type==="contextmenu"}const Pr=Math.PI,dr=2*Pr,bBe=dr+Pr,H2=Number.POSITIVE_INFINITY,wBe=Pr/180,qr=Pr/2,Zb=Pr/4,U8=Pr*2/3,Ca=Math.log10,nc=Math.sign;function W8(t){const e=Math.round(t);t=Qb(t,e,t/1e3)?e:t;const n=Math.pow(10,Math.floor(Ca(t))),r=t/n;return(r<=1?1:r<=2?2:r<=5?5:10)*n}function xBe(t){const e=[],n=Math.sqrt(t);let r;for(r=1;r<n;r++)t%r==0&&(e.push(r),e.push(t/r));return n===(n|0)&&e.push(n),e.sort((i,s)=>i-s).pop(),e}function Jb(t){return!isNaN(parseFloat(t))&&isFinite(t)}function Qb(t,e,n){return Math.abs(t-e)<n}function _Be(t,e){const n=Math.round(t);return n-e<=t&&n+e>=t}function G8(t,e,n){let r,i,s;for(r=0,i=t.length;r<i;r++)s=t[r][n],isNaN(s)||(e.min=Math.min(e.min,s),e.max=Math.max(e.max,s))}function cl(t){return t*(Pr/180)}function lD(t){return t*(180/Pr)}function H8(t){if(!ai(t))return;let e=1,n=0;for(;Math.round(t*e)/e!==t;)e*=10,n++;return n}function j8(t,e){const n=e.x-t.x,r=e.y-t.y,i=Math.sqrt(n*n+r*r);let s=Math.atan2(r,n);return s<-.5*Pr&&(s+=dr),{angle:s,distance:i}}function cD(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function SBe(t,e){return(t-e+bBe)%dr-Pr}function Bo(t){return(t%dr+dr)%dr}function ew(t,e,n,r){const i=Bo(t),s=Bo(e),o=Bo(n),a=Bo(s-i),l=Bo(o-i),c=Bo(i-s),u=Bo(i-o);return i===s||i===o||r&&s===o||a>l&&c<u}function _s(t,e,n){return Math.max(e,Math.min(n,t))}function CBe(t){return _s(t,-32768,32767)}function qc(t,e,n,r=1e-6){return t>=Math.min(e,n)-r&&t<=Math.max(e,n)+r}const j2=t=>t===0||t===1,q8=(t,e,n)=>-(Math.pow(2,10*(t-=1))*Math.sin((t-e)*dr/n)),X8=(t,e,n)=>Math.pow(2,-10*t)*Math.sin((t-e)*dr/n)+1,tw={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>-Math.cos(t*qr)+1,easeOutSine:t=>Math.sin(t*qr),easeInOutSine:t=>-.5*(Math.cos(Pr*t)-1),easeInExpo:t=>t===0?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>t===1?1:-Math.pow(2,-10*t)+1,easeInOutExpo:t=>j2(t)?t:t<.5?.5*Math.pow(2,10*(t*2-1)):.5*(-Math.pow(2,-10*(t*2-1))+2),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>j2(t)?t:q8(t,.075,.3),easeOutElastic:t=>j2(t)?t:X8(t,.075,.3),easeInOutElastic(t){const e=.1125,n=.45;return j2(t)?t:t<.5?.5*q8(t*2,e,n):.5+.5*X8(t*2-1,e,n)},easeInBack(t){const e=1.70158;return t*t*((e+1)*t-e)},easeOutBack(t){const e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},easeInOutBack(t){let e=1.70158;return(t/=.5)<1?.5*(t*t*(((e*=1.525)+1)*t-e)):.5*((t-=2)*t*(((e*=1.525)+1)*t+e)+2)},easeInBounce:t=>1-tw.easeOutBounce(1-t),easeOutBounce(t){const e=7.5625,n=2.75;return t<1/n?e*t*t:t<2/n?e*(t-=1.5/n)*t+.75:t<2.5/n?e*(t-=2.25/n)*t+.9375:e*(t-=2.625/n)*t+.984375},easeInOutBounce:t=>t<.5?tw.easeInBounce(t*2)*.5:tw.easeOutBounce(t*2-1)*.5+.5};/*!
 * @kurkle/color v0.1.9
 * https://github.com/kurkle/color#readme
 * (c) 2020 Jukka Kurkela
 * Released under the MIT License
 */const Ta={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},uD="0123456789ABCDEF",TBe=t=>uD[t&15],EBe=t=>uD[(t&240)>>4]+uD[t&15],q2=t=>(t&240)>>4==(t&15);function kBe(t){return q2(t.r)&&q2(t.g)&&q2(t.b)&&q2(t.a)}function ABe(t){var e=t.length,n;return t[0]==="#"&&(e===4||e===5?n={r:255&Ta[t[1]]*17,g:255&Ta[t[2]]*17,b:255&Ta[t[3]]*17,a:e===5?Ta[t[4]]*17:255}:(e===7||e===9)&&(n={r:Ta[t[1]]<<4|Ta[t[2]],g:Ta[t[3]]<<4|Ta[t[4]],b:Ta[t[5]]<<4|Ta[t[6]],a:e===9?Ta[t[7]]<<4|Ta[t[8]]:255})),n}function MBe(t){var e=kBe(t)?TBe:EBe;return t&&"#"+e(t.r)+e(t.g)+e(t.b)+(t.a<255?e(t.a):"")}function nw(t){return t+.5|0}const X2=(t,e,n)=>Math.max(Math.min(t,n),e);function rw(t){return X2(nw(t*2.55),0,255)}function iw(t){return X2(nw(t*255),0,255)}function hD(t){return X2(nw(t/2.55)/100,0,1)}function K8(t){return X2(nw(t*100),0,100)}const IBe=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function NBe(t){const e=IBe.exec(t);let n=255,r,i,s;if(!!e){if(e[7]!==r){const o=+e[7];n=255&(e[8]?rw(o):o*255)}return r=+e[1],i=+e[3],s=+e[5],r=255&(e[2]?rw(r):r),i=255&(e[4]?rw(i):i),s=255&(e[6]?rw(s):s),{r,g:i,b:s,a:n}}}function $Be(t){return t&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${hD(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`)}const RBe=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Y8(t,e,n){const r=e*Math.min(n,1-n),i=(s,o=(s+t/30)%12)=>n-r*Math.max(Math.min(o-3,9-o,1),-1);return[i(0),i(8),i(4)]}function DBe(t,e,n){const r=(i,s=(i+t/60)%6)=>n-n*e*Math.max(Math.min(s,4-s,1),0);return[r(5),r(3),r(1)]}function PBe(t,e,n){const r=Y8(t,1,.5);let i;for(e+n>1&&(i=1/(e+n),e*=i,n*=i),i=0;i<3;i++)r[i]*=1-e-n,r[i]+=e;return r}function fD(t){const e=255,n=t.r/e,r=t.g/e,i=t.b/e,s=Math.max(n,r,i),o=Math.min(n,r,i),a=(s+o)/2;let l,c,u;return s!==o&&(u=s-o,c=a>.5?u/(2-s-o):u/(s+o),l=s===n?(r-i)/u+(r<i?6:0):s===r?(i-n)/u+2:(n-r)/u+4,l=l*60+.5),[l|0,c||0,a]}function dD(t,e,n,r){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,n,r)).map(iw)}function pD(t,e,n){return dD(Y8,t,e,n)}function OBe(t,e,n){return dD(PBe,t,e,n)}function FBe(t,e,n){return dD(DBe,t,e,n)}function Z8(t){return(t%360+360)%360}function LBe(t){const e=RBe.exec(t);let n=255,r;if(!e)return;e[5]!==r&&(n=e[6]?rw(+e[5]):iw(+e[5]));const i=Z8(+e[2]),s=+e[3]/100,o=+e[4]/100;return e[1]==="hwb"?r=OBe(i,s,o):e[1]==="hsv"?r=FBe(i,s,o):r=pD(i,s,o),{r:r[0],g:r[1],b:r[2],a:n}}function BBe(t,e){var n=fD(t);n[0]=Z8(n[0]+e),n=pD(n),t.r=n[0],t.g=n[1],t.b=n[2]}function zBe(t){if(!t)return;const e=fD(t),n=e[0],r=K8(e[1]),i=K8(e[2]);return t.a<255?`hsla(${n}, ${r}%, ${i}%, ${hD(t.a)})`:`hsl(${n}, ${r}%, ${i}%)`}const J8={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Q8={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function VBe(){const t={},e=Object.keys(Q8),n=Object.keys(J8);let r,i,s,o,a;for(r=0;r<e.length;r++){for(o=a=e[r],i=0;i<n.length;i++)s=n[i],a=a.replace(s,J8[s]);s=parseInt(Q8[o],16),t[a]=[s>>16&255,s>>8&255,s&255]}return t}let K2;function UBe(t){K2||(K2=VBe(),K2.transparent=[0,0,0,0]);const e=K2[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}function Y2(t,e,n){if(t){let r=fD(t);r[e]=Math.max(0,Math.min(r[e]+r[e]*n,e===0?360:1)),r=pD(r),t.r=r[0],t.g=r[1],t.b=r[2]}}function ej(t,e){return t&&Object.assign(e||{},t)}function tj(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=iw(t[3]))):(e=ej(t,{r:0,g:0,b:0,a:1}),e.a=iw(e.a)),e}function WBe(t){return t.charAt(0)==="r"?NBe(t):LBe(t)}class Z2{constructor(e){if(e instanceof Z2)return e;const n=typeof e;let r;n==="object"?r=tj(e):n==="string"&&(r=ABe(e)||UBe(e)||WBe(e)),this._rgb=r,this._valid=!!r}get valid(){return this._valid}get rgb(){var e=ej(this._rgb);return e&&(e.a=hD(e.a)),e}set rgb(e){this._rgb=tj(e)}rgbString(){return this._valid?$Be(this._rgb):this._rgb}hexString(){return this._valid?MBe(this._rgb):this._rgb}hslString(){return this._valid?zBe(this._rgb):this._rgb}mix(e,n){const r=this;if(e){const i=r.rgb,s=e.rgb;let o;const a=n===o?.5:n,l=2*a-1,c=i.a-s.a,u=((l*c==-1?l:(l+c)/(1+l*c))+1)/2;o=1-u,i.r=255&u*i.r+o*s.r+.5,i.g=255&u*i.g+o*s.g+.5,i.b=255&u*i.b+o*s.b+.5,i.a=a*i.a+(1-a)*s.a,r.rgb=i}return r}clone(){return new Z2(this.rgb)}alpha(e){return this._rgb.a=iw(e),this}clearer(e){const n=this._rgb;return n.a*=1-e,this}greyscale(){const e=this._rgb,n=nw(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=n,this}opaquer(e){const n=this._rgb;return n.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return Y2(this._rgb,2,e),this}darken(e){return Y2(this._rgb,2,-e),this}saturate(e){return Y2(this._rgb,1,e),this}desaturate(e){return Y2(this._rgb,1,-e),this}rotate(e){return BBe(this._rgb,e),this}}function nj(t){return new Z2(t)}const rj=t=>t instanceof CanvasGradient||t instanceof CanvasPattern;function ij(t){return rj(t)?t:nj(t)}function mD(t){return rj(t)?t:nj(t).saturate(.5).darken(.1).hexString()}const qf=Object.create(null),gD=Object.create(null);function sw(t,e){if(!e)return t;const n=e.split(".");for(let r=0,i=n.length;r<i;++r){const s=n[r];t=t[s]||(t[s]=Object.create(null))}return t}function vD(t,e,n){return typeof e=="string"?Kb(sw(t,e),n):Kb(sw(t,""),e)}class GBe{constructor(e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=n=>n.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(n,r)=>mD(r.backgroundColor),this.hoverBorderColor=(n,r)=>mD(r.borderColor),this.hoverColor=(n,r)=>mD(r.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e)}set(e,n){return vD(this,e,n)}get(e){return sw(this,e)}describe(e,n){return vD(gD,e,n)}override(e,n){return vD(qf,e,n)}route(e,n,r,i){const s=sw(this,e),o=sw(this,r),a="_"+n;Object.defineProperties(s,{[a]:{value:s[n],writable:!0},[n]:{enumerable:!0,get(){const l=this[a],c=o[i];return Nn(l)?Object.assign({},c,l):fn(l,c)},set(l){this[a]=l}}})}}var On=new GBe({_scriptable:t=>!t.startsWith("on"),_indexable:t=>t!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}});function HBe(t){return!t||er(t.size)||er(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}function J2(t,e,n,r,i){let s=e[i];return s||(s=e[i]=t.measureText(i).width,n.push(i)),s>r&&(r=s),r}function jBe(t,e,n,r){r=r||{};let i=r.data=r.data||{},s=r.garbageCollect=r.garbageCollect||[];r.font!==e&&(i=r.data={},s=r.garbageCollect=[],r.font=e),t.save(),t.font=e;let o=0;const a=n.length;let l,c,u,h,f;for(l=0;l<a;l++)if(h=n[l],h!=null&&br(h)!==!0)o=J2(t,i,s,o,h);else if(br(h))for(c=0,u=h.length;c<u;c++)f=h[c],f!=null&&!br(f)&&(o=J2(t,i,s,o,f));t.restore();const d=s.length/2;if(d>n.length){for(l=0;l<d;l++)delete i[s[l]];s.splice(0,d)}return o}function Xf(t,e,n){const r=t.currentDevicePixelRatio,i=n!==0?Math.max(n/2,.5):0;return Math.round((e-i)*r)/r+i}function sj(t,e){e=e||t.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore()}function Q2(t,e,n,r){let i,s,o,a,l;const c=e.pointStyle,u=e.rotation,h=e.radius;let f=(u||0)*wBe;if(c&&typeof c=="object"&&(i=c.toString(),i==="[object HTMLImageElement]"||i==="[object HTMLCanvasElement]")){t.save(),t.translate(n,r),t.rotate(f),t.drawImage(c,-c.width/2,-c.height/2,c.width,c.height),t.restore();return}if(!(isNaN(h)||h<=0)){switch(t.beginPath(),c){default:t.arc(n,r,h,0,dr),t.closePath();break;case"triangle":t.moveTo(n+Math.sin(f)*h,r-Math.cos(f)*h),f+=U8,t.lineTo(n+Math.sin(f)*h,r-Math.cos(f)*h),f+=U8,t.lineTo(n+Math.sin(f)*h,r-Math.cos(f)*h),t.closePath();break;case"rectRounded":l=h*.516,a=h-l,s=Math.cos(f+Zb)*a,o=Math.sin(f+Zb)*a,t.arc(n-s,r-o,l,f-Pr,f-qr),t.arc(n+o,r-s,l,f-qr,f),t.arc(n+s,r+o,l,f,f+qr),t.arc(n-o,r+s,l,f+qr,f+Pr),t.closePath();break;case"rect":if(!u){a=Math.SQRT1_2*h,t.rect(n-a,r-a,2*a,2*a);break}f+=Zb;case"rectRot":s=Math.cos(f)*h,o=Math.sin(f)*h,t.moveTo(n-s,r-o),t.lineTo(n+o,r-s),t.lineTo(n+s,r+o),t.lineTo(n-o,r+s),t.closePath();break;case"crossRot":f+=Zb;case"cross":s=Math.cos(f)*h,o=Math.sin(f)*h,t.moveTo(n-s,r-o),t.lineTo(n+s,r+o),t.moveTo(n+o,r-s),t.lineTo(n-o,r+s);break;case"star":s=Math.cos(f)*h,o=Math.sin(f)*h,t.moveTo(n-s,r-o),t.lineTo(n+s,r+o),t.moveTo(n+o,r-s),t.lineTo(n-o,r+s),f+=Zb,s=Math.cos(f)*h,o=Math.sin(f)*h,t.moveTo(n-s,r-o),t.lineTo(n+s,r+o),t.moveTo(n+o,r-s),t.lineTo(n-o,r+s);break;case"line":s=Math.cos(f)*h,o=Math.sin(f)*h,t.moveTo(n-s,r-o),t.lineTo(n+s,r+o);break;case"dash":t.moveTo(n,r),t.lineTo(n+Math.cos(f)*h,r+Math.sin(f)*h);break}t.fill(),e.borderWidth>0&&t.stroke()}}function Kf(t,e,n){return n=n||.5,!e||t&&t.x>e.left-n&&t.x<e.right+n&&t.y>e.top-n&&t.y<e.bottom+n}function eT(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function tT(t){t.restore()}function qBe(t,e,n,r,i){if(!e)return t.lineTo(n.x,n.y);if(i==="middle"){const s=(e.x+n.x)/2;t.lineTo(s,e.y),t.lineTo(s,n.y)}else i==="after"!=!!r?t.lineTo(e.x,n.y):t.lineTo(n.x,e.y);t.lineTo(n.x,n.y)}function XBe(t,e,n,r){if(!e)return t.lineTo(n.x,n.y);t.bezierCurveTo(r?e.cp1x:e.cp2x,r?e.cp1y:e.cp2y,r?n.cp2x:n.cp1x,r?n.cp2y:n.cp1y,n.x,n.y)}function Yf(t,e,n,r,i,s={}){const o=br(e)?e:[e],a=s.strokeWidth>0&&s.strokeColor!=="";let l,c;for(t.save(),t.font=i.string,KBe(t,s),l=0;l<o.length;++l)c=o[l],a&&(s.strokeColor&&(t.strokeStyle=s.strokeColor),er(s.strokeWidth)||(t.lineWidth=s.strokeWidth),t.strokeText(c,n,r,s.maxWidth)),t.fillText(c,n,r,s.maxWidth),YBe(t,n,r,c,s),r+=i.lineHeight;t.restore()}function KBe(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]),er(e.rotation)||t.rotate(e.rotation),e.color&&(t.fillStyle=e.color),e.textAlign&&(t.textAlign=e.textAlign),e.textBaseline&&(t.textBaseline=e.textBaseline)}function YBe(t,e,n,r,i){if(i.strikethrough||i.underline){const s=t.measureText(r),o=e-s.actualBoundingBoxLeft,a=e+s.actualBoundingBoxRight,l=n-s.actualBoundingBoxAscent,c=n+s.actualBoundingBoxDescent,u=i.strikethrough?(l+c)/2:c;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=i.decorationWidth||2,t.moveTo(o,u),t.lineTo(a,u),t.stroke()}}function Zf(t,e){const{x:n,y:r,w:i,h:s,radius:o}=e;t.arc(n+o.topLeft,r+o.topLeft,o.topLeft,-qr,Pr,!0),t.lineTo(n,r+s-o.bottomLeft),t.arc(n+o.bottomLeft,r+s-o.bottomLeft,o.bottomLeft,Pr,qr,!0),t.lineTo(n+i-o.bottomRight,r+s),t.arc(n+i-o.bottomRight,r+s-o.bottomRight,o.bottomRight,qr,0,!0),t.lineTo(n+i,r+o.topRight),t.arc(n+i-o.topRight,r+o.topRight,o.topRight,0,-qr,!0),t.lineTo(n+o.topLeft,r)}const ZBe=new RegExp(/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/),JBe=new RegExp(/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/);function QBe(t,e){const n=(""+t).match(ZBe);if(!n||n[1]==="normal")return e*1.2;switch(t=+n[2],n[3]){case"px":return t;case"%":t/=100;break}return e*t}const eze=t=>+t||0;function yD(t,e){const n={},r=Nn(e),i=r?Object.keys(e):e,s=Nn(t)?r?o=>fn(t[o],t[e[o]]):o=>t[o]:()=>t;for(const o of i)n[o]=eze(s(o));return n}function oj(t){return yD(t,{top:"y",right:"x",bottom:"y",left:"x"})}function Jf(t){return yD(t,["topLeft","topRight","bottomLeft","bottomRight"])}function Ss(t){const e=oj(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function Di(t,e){t=t||{},e=e||On.font;let n=fn(t.size,e.size);typeof n=="string"&&(n=parseInt(n,10));let r=fn(t.style,e.style);r&&!(""+r).match(JBe)&&(console.warn('Invalid font style specified: "'+r+'"'),r="");const i={family:fn(t.family,e.family),lineHeight:QBe(fn(t.lineHeight,e.lineHeight),n),size:n,style:r,weight:fn(t.weight,e.weight),string:""};return i.string=HBe(i),i}function nT(t,e,n,r){let i=!0,s,o,a;for(s=0,o=t.length;s<o;++s)if(a=t[s],a!==void 0&&(e!==void 0&&typeof a=="function"&&(a=a(e),i=!1),n!==void 0&&br(a)&&(a=a[n%a.length],i=!1),a!==void 0))return r&&!i&&(r.cacheable=!1),a}function tze(t,e,n){const{min:r,max:i}=t,s=L8(e,(i-r)/2),o=(a,l)=>n&&a===0?0:a+l;return{min:o(r,-Math.abs(s)),max:o(i,s)}}function yh(t,e){return Object.assign(Object.create(t),e)}function bD(t,e,n){n=n||(o=>t[o]<e);let r=t.length-1,i=0,s;for(;r-i>1;)s=i+r>>1,n(s)?i=s:r=s;return{lo:i,hi:r}}const Qf=(t,e,n)=>bD(t,n,r=>t[r][e]<n),nze=(t,e,n)=>bD(t,n,r=>t[r][e]>=n);function rze(t,e,n){let r=0,i=t.length;for(;r<i&&t[r]<e;)r++;for(;i>r&&t[i-1]>n;)i--;return r>0||i<t.length?t.slice(r,i):t}const aj=["push","pop","shift","splice","unshift"];function ize(t,e){if(t._chartjs){t._chartjs.listeners.push(e);return}Object.defineProperty(t,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),aj.forEach(n=>{const r="_onData"+aD(n),i=t[n];Object.defineProperty(t,n,{configurable:!0,enumerable:!1,value(...s){const o=i.apply(this,s);return t._chartjs.listeners.forEach(a=>{typeof a[r]=="function"&&a[r](...s)}),o}})})}function lj(t,e){const n=t._chartjs;if(!n)return;const r=n.listeners,i=r.indexOf(e);i!==-1&&r.splice(i,1),!(r.length>0)&&(aj.forEach(s=>{delete t[s]}),delete t._chartjs)}function cj(t){const e=new Set;let n,r;for(n=0,r=t.length;n<r;++n)e.add(t[n]);return e.size===r?t:Array.from(e)}function wD(t,e=[""],n=t,r,i=()=>t[0]){Sa(r)||(r=pj("_fallback",t));const s={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:n,_fallback:r,_getTarget:i,override:o=>wD([o,...t],e,n,r)};return new Proxy(s,{deleteProperty(o,a){return delete o[a],delete o._keys,delete t[0][a],!0},get(o,a){return hj(o,a,()=>fze(a,e,t,o))},getOwnPropertyDescriptor(o,a){return Reflect.getOwnPropertyDescriptor(o._scopes[0],a)},getPrototypeOf(){return Reflect.getPrototypeOf(t[0])},has(o,a){return mj(o).includes(a)},ownKeys(o){return mj(o)},set(o,a,l){const c=o._storage||(o._storage=i());return o[a]=c[a]=l,delete o._keys,!0}})}function _g(t,e,n,r){const i={_cacheable:!1,_proxy:t,_context:e,_subProxy:n,_stack:new Set,_descriptors:uj(t,r),setContext:s=>_g(t,s,n,r),override:s=>_g(t.override(s),e,n,r)};return new Proxy(i,{deleteProperty(s,o){return delete s[o],delete t[o],!0},get(s,o,a){return hj(s,o,()=>oze(s,o,a))},getOwnPropertyDescriptor(s,o){return s._descriptors.allKeys?Reflect.has(t,o)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,o)},getPrototypeOf(){return Reflect.getPrototypeOf(t)},has(s,o){return Reflect.has(t,o)},ownKeys(){return Reflect.ownKeys(t)},set(s,o,a){return t[o]=a,delete s[o],!0}})}function uj(t,e={scriptable:!0,indexable:!0}){const{_scriptable:n=e.scriptable,_indexable:r=e.indexable,_allKeys:i=e.allKeys}=t;return{allKeys:i,scriptable:n,indexable:r,isScriptable:vh(n)?n:()=>n,isIndexable:vh(r)?r:()=>r}}const sze=(t,e)=>t?t+aD(e):e,xD=(t,e)=>Nn(e)&&t!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function hj(t,e,n){if(Object.prototype.hasOwnProperty.call(t,e))return t[e];const r=n();return t[e]=r,r}function oze(t,e,n){const{_proxy:r,_context:i,_subProxy:s,_descriptors:o}=t;let a=r[e];return vh(a)&&o.isScriptable(e)&&(a=aze(e,a,t,n)),br(a)&&a.length&&(a=lze(e,a,t,o.isIndexable)),xD(e,a)&&(a=_g(a,i,s&&s[e],o)),a}function aze(t,e,n,r){const{_proxy:i,_context:s,_subProxy:o,_stack:a}=n;if(a.has(t))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+t);return a.add(t),e=e(s,o||r),a.delete(t),xD(t,e)&&(e=_D(i._scopes,i,t,e)),e}function lze(t,e,n,r){const{_proxy:i,_context:s,_subProxy:o,_descriptors:a}=n;if(Sa(s.index)&&r(t))e=e[s.index%e.length];else if(Nn(e[0])){const l=e,c=i._scopes.filter(u=>u!==l);e=[];for(const u of l){const h=_D(c,i,t,u);e.push(_g(h,s,o&&o[t],a))}}return e}function fj(t,e,n){return vh(t)?t(e,n):t}const cze=(t,e)=>t===!0?e:typeof t=="string"?jf(e,t):void 0;function uze(t,e,n,r,i){for(const s of e){const o=cze(n,s);if(o){t.add(o);const a=fj(o._fallback,n,i);if(Sa(a)&&a!==n&&a!==r)return a}else if(o===!1&&Sa(r)&&n!==r)return null}return!1}function _D(t,e,n,r){const i=e._rootScopes,s=fj(e._fallback,n,r),o=[...t,...i],a=new Set;a.add(r);let l=dj(a,o,n,s||n,r);return l===null||Sa(s)&&s!==n&&(l=dj(a,o,s,l,r),l===null)?!1:wD(Array.from(a),[""],i,s,()=>hze(e,n,r))}function dj(t,e,n,r,i){for(;n;)n=uze(t,e,n,r,i);return n}function hze(t,e,n){const r=t._getTarget();e in r||(r[e]={});const i=r[e];return br(i)&&Nn(n)?n:i}function fze(t,e,n,r){let i;for(const s of e)if(i=pj(sze(s,t),n),Sa(i))return xD(t,i)?_D(n,r,t,i):i}function pj(t,e){for(const n of e){if(!n)continue;const r=n[t];if(Sa(r))return r}}function mj(t){let e=t._keys;return e||(e=t._keys=dze(t._scopes)),e}function dze(t){const e=new Set;for(const n of t)for(const r of Object.keys(n).filter(i=>!i.startsWith("_")))e.add(r);return Array.from(e)}const pze=Number.EPSILON||1e-14,Sg=(t,e)=>e<t.length&&!t[e].skip&&t[e],gj=t=>t==="x"?"y":"x";function mze(t,e,n,r){const i=t.skip?e:t,s=e,o=n.skip?e:n,a=cD(s,i),l=cD(o,s);let c=a/(a+l),u=l/(a+l);c=isNaN(c)?0:c,u=isNaN(u)?0:u;const h=r*c,f=r*u;return{previous:{x:s.x-h*(o.x-i.x),y:s.y-h*(o.y-i.y)},next:{x:s.x+f*(o.x-i.x),y:s.y+f*(o.y-i.y)}}}function gze(t,e,n){const r=t.length;let i,s,o,a,l,c=Sg(t,0);for(let u=0;u<r-1;++u)if(l=c,c=Sg(t,u+1),!(!l||!c)){if(Qb(e[u],0,pze)){n[u]=n[u+1]=0;continue}i=n[u]/e[u],s=n[u+1]/e[u],a=Math.pow(i,2)+Math.pow(s,2),!(a<=9)&&(o=3/Math.sqrt(a),n[u]=i*o*e[u],n[u+1]=s*o*e[u])}}function vze(t,e,n="x"){const r=gj(n),i=t.length;let s,o,a,l=Sg(t,0);for(let c=0;c<i;++c){if(o=a,a=l,l=Sg(t,c+1),!a)continue;const u=a[n],h=a[r];o&&(s=(u-o[n])/3,a[`cp1${n}`]=u-s,a[`cp1${r}`]=h-s*e[c]),l&&(s=(l[n]-u)/3,a[`cp2${n}`]=u+s,a[`cp2${r}`]=h+s*e[c])}}function yze(t,e="x"){const n=gj(e),r=t.length,i=Array(r).fill(0),s=Array(r);let o,a,l,c=Sg(t,0);for(o=0;o<r;++o)if(a=l,l=c,c=Sg(t,o+1),!!l){if(c){const u=c[e]-l[e];i[o]=u!==0?(c[n]-l[n])/u:0}s[o]=a?c?nc(i[o-1])!==nc(i[o])?0:(i[o-1]+i[o])/2:i[o-1]:i[o]}gze(t,i,s),vze(t,s,e)}function rT(t,e,n){return Math.max(Math.min(t,n),e)}function bze(t,e){let n,r,i,s,o,a=Kf(t[0],e);for(n=0,r=t.length;n<r;++n)o=s,s=a,a=n<r-1&&Kf(t[n+1],e),!!s&&(i=t[n],o&&(i.cp1x=rT(i.cp1x,e.left,e.right),i.cp1y=rT(i.cp1y,e.top,e.bottom)),a&&(i.cp2x=rT(i.cp2x,e.left,e.right),i.cp2y=rT(i.cp2y,e.top,e.bottom)))}function wze(t,e,n,r,i){let s,o,a,l;if(e.spanGaps&&(t=t.filter(c=>!c.skip)),e.cubicInterpolationMode==="monotone")yze(t,i);else{let c=r?t[t.length-1]:t[0];for(s=0,o=t.length;s<o;++s)a=t[s],l=mze(c,a,t[Math.min(s+1,o-(r?0:1))%o],e.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,c=a}e.capBezierPoints&&bze(t,n)}function vj(){return typeof window!="undefined"&&typeof document!="undefined"}function SD(t){let e=t.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function iT(t,e,n){let r;return typeof t=="string"?(r=parseInt(t,10),t.indexOf("%")!==-1&&(r=r/100*e.parentNode[n])):r=t,r}const sT=t=>window.getComputedStyle(t,null);function xze(t,e){return sT(t).getPropertyValue(e)}const _ze=["top","right","bottom","left"];function ed(t,e,n){const r={};n=n?"-"+n:"";for(let i=0;i<4;i++){const s=_ze[i];r[s]=parseFloat(t[e+"-"+s+n])||0}return r.width=r.left+r.right,r.height=r.top+r.bottom,r}const Sze=(t,e,n)=>(t>0||e>0)&&(!n||!n.shadowRoot);function Cze(t,e){const n=t.native||t,r=n.touches,i=r&&r.length?r[0]:n,{offsetX:s,offsetY:o}=i;let a=!1,l,c;if(Sze(s,o,n.target))l=s,c=o;else{const u=e.getBoundingClientRect();l=i.clientX-u.left,c=i.clientY-u.top,a=!0}return{x:l,y:c,box:a}}function yj(t,e){const{canvas:n,currentDevicePixelRatio:r}=e,i=sT(n),s=i.boxSizing==="border-box",o=ed(i,"padding"),a=ed(i,"border","width"),{x:l,y:c,box:u}=Cze(t,n),h=o.left+(u&&a.left),f=o.top+(u&&a.top);let{width:d,height:p}=e;return s&&(d-=o.width+a.width,p-=o.height+a.height),{x:Math.round((l-h)/d*n.width/r),y:Math.round((c-f)/p*n.height/r)}}function Tze(t,e,n){let r,i;if(e===void 0||n===void 0){const s=SD(t);if(!s)e=t.clientWidth,n=t.clientHeight;else{const o=s.getBoundingClientRect(),a=sT(s),l=ed(a,"border","width"),c=ed(a,"padding");e=o.width-c.width-l.width,n=o.height-c.height-l.height,r=iT(a.maxWidth,s,"clientWidth"),i=iT(a.maxHeight,s,"clientHeight")}}return{width:e,height:n,maxWidth:r||H2,maxHeight:i||H2}}const CD=t=>Math.round(t*10)/10;function Eze(t,e,n,r){const i=sT(t),s=ed(i,"margin"),o=iT(i.maxWidth,t,"clientWidth")||H2,a=iT(i.maxHeight,t,"clientHeight")||H2,l=Tze(t,e,n);let{width:c,height:u}=l;if(i.boxSizing==="content-box"){const h=ed(i,"border","width"),f=ed(i,"padding");c-=f.width+h.width,u-=f.height+h.height}return c=Math.max(0,c-s.width),u=Math.max(0,r?Math.floor(c/r):u-s.height),c=CD(Math.min(c,o,l.maxWidth)),u=CD(Math.min(u,a,l.maxHeight)),c&&!u&&(u=CD(c/2)),{width:c,height:u}}function bj(t,e,n){const r=e||1,i=Math.floor(t.height*r),s=Math.floor(t.width*r);t.height=i/r,t.width=s/r;const o=t.canvas;return o.style&&(n||!o.style.height&&!o.style.width)&&(o.style.height=`${t.height}px`,o.style.width=`${t.width}px`),t.currentDevicePixelRatio!==r||o.height!==i||o.width!==s?(t.currentDevicePixelRatio=r,o.height=i,o.width=s,t.ctx.setTransform(r,0,0,r,0,0),!0):!1}const kze=function(){let t=!1;try{const e={get passive(){return t=!0,!1}};window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch{}return t}();function wj(t,e){const n=xze(t,e),r=n&&n.match(/^(\d+)(\.\d+)?px$/);return r?+r[1]:void 0}function td(t,e,n,r){return{x:t.x+n*(e.x-t.x),y:t.y+n*(e.y-t.y)}}function Aze(t,e,n,r){return{x:t.x+n*(e.x-t.x),y:r==="middle"?n<.5?t.y:e.y:r==="after"?n<1?t.y:e.y:n>0?e.y:t.y}}function Mze(t,e,n,r){const i={x:t.cp2x,y:t.cp2y},s={x:e.cp1x,y:e.cp1y},o=td(t,i,n),a=td(i,s,n),l=td(s,e,n),c=td(o,a,n),u=td(a,l,n);return td(c,u,n)}const xj=new Map;function Ize(t,e){e=e||{};const n=t+JSON.stringify(e);let r=xj.get(n);return r||(r=new Intl.NumberFormat(t,e),xj.set(n,r)),r}function ow(t,e,n){return Ize(e,n).format(t)}const Nze=function(t,e){return{x(n){return t+t+e-n},setWidth(n){e=n},textAlign(n){return n==="center"?n:n==="right"?"left":"right"},xPlus(n,r){return n-r},leftForLtr(n,r){return n-r}}},$ze=function(){return{x(t){return t},setWidth(t){},textAlign(t){return t},xPlus(t,e){return t+e},leftForLtr(t,e){return t}}};function Cg(t,e,n){return t?Nze(e,n):$ze()}function _j(t,e){let n,r;(e==="ltr"||e==="rtl")&&(n=t.canvas.style,r=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",e,"important"),t.prevTextDirection=r)}function Sj(t,e){e!==void 0&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}function Cj(t){return t==="angle"?{between:ew,compare:SBe,normalize:Bo}:{between:qc,compare:(e,n)=>e-n,normalize:e=>e}}function Tj({start:t,end:e,count:n,loop:r,style:i}){return{start:t%n,end:e%n,loop:r&&(e-t+1)%n==0,style:i}}function Rze(t,e,n){const{property:r,start:i,end:s}=n,{between:o,normalize:a}=Cj(r),l=e.length;let{start:c,end:u,loop:h}=t,f,d;if(h){for(c+=l,u+=l,f=0,d=l;f<d&&o(a(e[c%l][r]),i,s);++f)c--,u--;c%=l,u%=l}return u<c&&(u+=l),{start:c,end:u,loop:h,style:t.style}}function Ej(t,e,n){if(!n)return[t];const{property:r,start:i,end:s}=n,o=e.length,{compare:a,between:l,normalize:c}=Cj(r),{start:u,end:h,loop:f,style:d}=Rze(t,e,n),p=[];let m=!1,v=null,y,w,x;const _=()=>l(i,x,y)&&a(i,x)!==0,S=()=>a(s,y)===0||l(s,x,y),T=()=>m||_(),E=()=>!m||S();for(let k=u,A=u;k<=h;++k)w=e[k%o],!w.skip&&(y=c(w[r]),y!==x&&(m=l(y,i,s),v===null&&T()&&(v=a(y,i)===0?k:A),v!==null&&E()&&(p.push(Tj({start:v,end:k,loop:f,count:o,style:d})),v=null),A=k,x=y));return v!==null&&p.push(Tj({start:v,end:h,loop:f,count:o,style:d})),p}function kj(t,e){const n=[],r=t.segments;for(let i=0;i<r.length;i++){const s=Ej(r[i],t.points,e);s.length&&n.push(...s)}return n}function Dze(t,e,n,r){let i=0,s=e-1;if(n&&!r)for(;i<e&&!t[i].skip;)i++;for(;i<e&&t[i].skip;)i++;for(i%=e,n&&(s+=i);s>i&&t[s%e].skip;)s--;return s%=e,{start:i,end:s}}function Pze(t,e,n,r){const i=t.length,s=[];let o=e,a=t[e],l;for(l=e+1;l<=n;++l){const c=t[l%i];c.skip||c.stop?a.skip||(r=!1,s.push({start:e%i,end:(l-1)%i,loop:r}),e=o=c.stop?l:null):(o=l,a.skip&&(e=l)),a=c}return o!==null&&s.push({start:e%i,end:o%i,loop:r}),s}function Oze(t,e){const n=t.points,r=t.options.spanGaps,i=n.length;if(!i)return[];const s=!!t._loop,{start:o,end:a}=Dze(n,i,s,r);if(r===!0)return Aj(t,[{start:o,end:a,loop:s}],n,e);const l=a<o?a+i:a,c=!!t._fullLoop&&o===0&&a===i-1;return Aj(t,Pze(n,o,l,c),n,e)}function Aj(t,e,n,r){return!r||!r.setContext||!n?e:Fze(t,e,n,r)}function Fze(t,e,n,r){const i=t._chart.getContext(),s=Mj(t.options),{_datasetIndex:o,options:{spanGaps:a}}=t,l=n.length,c=[];let u=s,h=e[0].start,f=h;function d(p,m,v,y){const w=a?-1:1;if(p!==m){for(p+=l;n[p%l].skip;)p-=w;for(;n[m%l].skip;)m+=w;p%l!=m%l&&(c.push({start:p%l,end:m%l,loop:v,style:y}),u=y,h=m%l)}}for(const p of e){h=a?h:p.start;let m=n[h%l],v;for(f=h+1;f<=p.end;f++){const y=n[f%l];v=Mj(r.setContext(yh(i,{type:"segment",p0:m,p1:y,p0DataIndex:(f-1)%l,p1DataIndex:f%l,datasetIndex:o}))),Lze(v,u)&&d(h,f-1,p.loop,u),m=y,u=v}h<f-1&&d(h,f-1,p.loop,u)}return c}function Mj(t){return{backgroundColor:t.backgroundColor,borderCapStyle:t.borderCapStyle,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderJoinStyle:t.borderJoinStyle,borderWidth:t.borderWidth,borderColor:t.borderColor}}function Lze(t,e){return e&&JSON.stringify(t)!==JSON.stringify(e)}/*!
 * Chart.js v3.7.0
 * https://www.chartjs.org
 * (c) 2021 Chart.js Contributors
 * Released under the MIT License
 */class Bze{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,n,r,i){const s=n.listeners[i],o=n.duration;s.forEach(a=>a({chart:e,initial:n.initial,numSteps:o,currentStep:Math.min(r-n.start,o)}))}_refresh(){this._request||(this._running=!0,this._request=O8.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let n=0;this._charts.forEach((r,i)=>{if(!r.running||!r.items.length)return;const s=r.items;let o=s.length-1,a=!1,l;for(;o>=0;--o)l=s[o],l._active?(l._total>r.duration&&(r.duration=l._total),l.tick(e),a=!0):(s[o]=s[s.length-1],s.pop());a&&(i.draw(),this._notify(i,r,e,"progress")),s.length||(r.running=!1,this._notify(i,r,e,"complete"),r.initial=!1),n+=s.length}),this._lastDate=e,n===0&&(this._running=!1)}_getAnims(e){const n=this._charts;let r=n.get(e);return r||(r={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},n.set(e,r)),r}listen(e,n,r){this._getAnims(e).listeners[n].push(r)}add(e,n){!n||!n.length||this._getAnims(e).items.push(...n)}has(e){return this._getAnims(e).items.length>0}start(e){const n=this._charts.get(e);!n||(n.running=!0,n.start=Date.now(),n.duration=n.items.reduce((r,i)=>Math.max(r,i._duration),0),this._refresh())}running(e){if(!this._running)return!1;const n=this._charts.get(e);return!(!n||!n.running||!n.items.length)}stop(e){const n=this._charts.get(e);if(!n||!n.items.length)return;const r=n.items;let i=r.length-1;for(;i>=0;--i)r[i].cancel();n.items=[],this._notify(e,n,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var Xc=new Bze;const Ij="transparent",zze={boolean(t,e,n){return n>.5?e:t},color(t,e,n){const r=ij(t||Ij),i=r.valid&&ij(e||Ij);return i&&i.valid?i.mix(r,n).hexString():e},number(t,e,n){return t+(e-t)*n}};class Vze{constructor(e,n,r,i){const s=n[r];i=nT([e.to,i,s,e.from]);const o=nT([e.from,s,i]);this._active=!0,this._fn=e.fn||zze[e.type||typeof o],this._easing=tw[e.easing]||tw.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=n,this._prop=r,this._from=o,this._to=i,this._promises=void 0}active(){return this._active}update(e,n,r){if(this._active){this._notify(!1);const i=this._target[this._prop],s=r-this._start,o=this._duration-s;this._start=r,this._duration=Math.floor(Math.max(o,e.duration)),this._total+=s,this._loop=!!e.loop,this._to=nT([e.to,n,i,e.from]),this._from=nT([e.from,i,n])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const n=e-this._start,r=this._duration,i=this._prop,s=this._from,o=this._loop,a=this._to;let l;if(this._active=s!==a&&(o||n<r),!this._active){this._target[i]=a,this._notify(!0);return}if(n<0){this._target[i]=s;return}l=n/r%2,l=o&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[i]=this._fn(s,a,l)}wait(){const e=this._promises||(this._promises=[]);return new Promise((n,r)=>{e.push({res:n,rej:r})})}_notify(e){const n=e?"res":"rej",r=this._promises||[];for(let i=0;i<r.length;i++)r[i][n]()}}const Uze=["x","y","borderWidth","radius","tension"],Wze=["color","borderColor","backgroundColor"];On.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0});const Gze=Object.keys(On.animation);On.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"});On.set("animations",{colors:{type:"color",properties:Wze},numbers:{type:"number",properties:Uze}});On.describe("animations",{_fallback:"animation"});On.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}});class Nj{constructor(e,n){this._chart=e,this._properties=new Map,this.configure(n)}configure(e){if(!Nn(e))return;const n=this._properties;Object.getOwnPropertyNames(e).forEach(r=>{const i=e[r];if(!Nn(i))return;const s={};for(const o of Gze)s[o]=i[o];(br(i.properties)&&i.properties||[r]).forEach(o=>{(o===r||!n.has(o))&&n.set(o,s)})})}_animateOptions(e,n){const r=n.options,i=jze(e,r);if(!i)return[];const s=this._createAnimations(i,r);return r.$shared&&Hze(e.options.$animations,r).then(()=>{e.options=r},()=>{}),s}_createAnimations(e,n){const r=this._properties,i=[],s=e.$animations||(e.$animations={}),o=Object.keys(n),a=Date.now();let l;for(l=o.length-1;l>=0;--l){const c=o[l];if(c.charAt(0)==="$")continue;if(c==="options"){i.push(...this._animateOptions(e,n));continue}const u=n[c];let h=s[c];const f=r.get(c);if(h)if(f&&h.active()){h.update(f,u,a);continue}else h.cancel();if(!f||!f.duration){e[c]=u;continue}s[c]=h=new Vze(f,e,c,u),i.push(h)}return i}update(e,n){if(this._properties.size===0){Object.assign(e,n);return}const r=this._createAnimations(e,n);if(r.length)return Xc.add(this._chart,r),!0}}function Hze(t,e){const n=[],r=Object.keys(e);for(let i=0;i<r.length;i++){const s=t[r[i]];s&&s.active()&&n.push(s.wait())}return Promise.all(n)}function jze(t,e){if(!e)return;let n=t.options;if(!n){t.options=e;return}return n.$shared&&(t.options=n=Object.assign({},n,{$shared:!1,$animations:{}})),n}function $j(t,e){const n=t&&t.options||{},r=n.reverse,i=n.min===void 0?e:0,s=n.max===void 0?e:0;return{start:r?s:i,end:r?i:s}}function qze(t,e,n){if(n===!1)return!1;const r=$j(t,n),i=$j(e,n);return{top:i.end,right:r.end,bottom:i.start,left:r.start}}function Xze(t){let e,n,r,i;return Nn(t)?(e=t.top,n=t.right,r=t.bottom,i=t.left):e=n=r=i=t,{top:e,right:n,bottom:r,left:i,disabled:t===!1}}function Rj(t,e){const n=[],r=t._getSortedDatasetMetas(e);let i,s;for(i=0,s=r.length;i<s;++i)n.push(r[i].index);return n}function Dj(t,e,n,r={}){const i=t.keys,s=r.mode==="single";let o,a,l,c;if(e!==null){for(o=0,a=i.length;o<a;++o){if(l=+i[o],l===n){if(r.all)continue;break}c=t.values[l],ai(c)&&(s||e===0||nc(e)===nc(c))&&(e+=c)}return e}}function Kze(t){const e=Object.keys(t),n=new Array(e.length);let r,i,s;for(r=0,i=e.length;r<i;++r)s=e[r],n[r]={x:s,y:t[s]};return n}function Pj(t,e){const n=t&&t.options.stacked;return n||n===void 0&&e.stack!==void 0}function Yze(t,e,n){return`${t.id}.${e.id}.${n.stack||n.type}`}function Zze(t){const{min:e,max:n,minDefined:r,maxDefined:i}=t.getUserBounds();return{min:r?e:Number.NEGATIVE_INFINITY,max:i?n:Number.POSITIVE_INFINITY}}function Jze(t,e,n){const r=t[e]||(t[e]={});return r[n]||(r[n]={})}function Oj(t,e,n,r){for(const i of e.getMatchingVisibleMetas(r).reverse()){const s=t[i.index];if(n&&s>0||!n&&s<0)return i.index}return null}function Fj(t,e){const{chart:n,_cachedMeta:r}=t,i=n._stacks||(n._stacks={}),{iScale:s,vScale:o,index:a}=r,l=s.axis,c=o.axis,u=Yze(s,o,r),h=e.length;let f;for(let d=0;d<h;++d){const p=e[d],{[l]:m,[c]:v}=p,y=p._stacks||(p._stacks={});f=y[c]=Jze(i,u,m),f[a]=v,f._top=Oj(f,o,!0,r.type),f._bottom=Oj(f,o,!1,r.type)}}function TD(t,e){const n=t.scales;return Object.keys(n).filter(r=>n[r].axis===e).shift()}function Qze(t,e){return yh(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function e4e(t,e,n){return yh(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:n,index:e,mode:"default",type:"data"})}function aw(t,e){const n=t.controller.index,r=t.vScale&&t.vScale.axis;if(!!r){e=e||t._parsed;for(const i of e){const s=i._stacks;if(!s||s[r]===void 0||s[r][n]===void 0)return;delete s[r][n]}}}const ED=t=>t==="reset"||t==="none",Lj=(t,e)=>e?t:Object.assign({},t),t4e=(t,e,n)=>t&&!e.hidden&&e._stacked&&{keys:Rj(n,!0),values:null};class ul{constructor(e,n){this.chart=e,this._ctx=e.ctx,this.index=n,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.$context=void 0,this._syncList=[],this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=Pj(e.vScale,e),this.addElements()}updateIndex(e){this.index!==e&&aw(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,n=this._cachedMeta,r=this.getDataset(),i=(h,f,d,p)=>h==="x"?f:h==="r"?p:d,s=n.xAxisID=fn(r.xAxisID,TD(e,"x")),o=n.yAxisID=fn(r.yAxisID,TD(e,"y")),a=n.rAxisID=fn(r.rAxisID,TD(e,"r")),l=n.indexAxis,c=n.iAxisID=i(l,s,o,a),u=n.vAxisID=i(l,o,s,a);n.xScale=this.getScaleForId(s),n.yScale=this.getScaleForId(o),n.rScale=this.getScaleForId(a),n.iScale=this.getScaleForId(c),n.vScale=this.getScaleForId(u)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const n=this._cachedMeta;return e===n.iScale?n.vScale:n.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&lj(this._data,this),e._stacked&&aw(e)}_dataCheck(){const e=this.getDataset(),n=e.data||(e.data=[]),r=this._data;if(Nn(n))this._data=Kze(n);else if(r!==n){if(r){lj(r,this);const i=this._cachedMeta;aw(i),i._parsed=[]}n&&Object.isExtensible(n)&&ize(n,this),this._syncList=[],this._data=n}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const n=this._cachedMeta,r=this.getDataset();let i=!1;this._dataCheck();const s=n._stacked;n._stacked=Pj(n.vScale,n),n.stack!==r.stack&&(i=!0,aw(n),n.stack=r.stack),this._resyncElements(e),(i||s!==n._stacked)&&Fj(this,n._parsed)}configure(){const e=this.chart.config,n=e.datasetScopeKeys(this._type),r=e.getOptionScopes(this.getDataset(),n,!0);this.options=e.createResolver(r,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,n){const{_cachedMeta:r,_data:i}=this,{iScale:s,_stacked:o}=r,a=s.axis;let l=e===0&&n===i.length?!0:r._sorted,c=e>0&&r._parsed[e-1],u,h,f;if(this._parsing===!1)r._parsed=i,r._sorted=!0,f=i;else{br(i[e])?f=this.parseArrayData(r,i,e,n):Nn(i[e])?f=this.parseObjectData(r,i,e,n):f=this.parsePrimitiveData(r,i,e,n);const d=()=>h[a]===null||c&&h[a]<c[a];for(u=0;u<n;++u)r._parsed[u+e]=h=f[u],l&&(d()&&(l=!1),c=h);r._sorted=l}o&&Fj(this,f)}parsePrimitiveData(e,n,r,i){const{iScale:s,vScale:o}=e,a=s.axis,l=o.axis,c=s.getLabels(),u=s===o,h=new Array(i);let f,d,p;for(f=0,d=i;f<d;++f)p=f+r,h[f]={[a]:u||s.parse(c[p],p),[l]:o.parse(n[p],p)};return h}parseArrayData(e,n,r,i){const{xScale:s,yScale:o}=e,a=new Array(i);let l,c,u,h;for(l=0,c=i;l<c;++l)u=l+r,h=n[u],a[l]={x:s.parse(h[0],u),y:o.parse(h[1],u)};return a}parseObjectData(e,n,r,i){const{xScale:s,yScale:o}=e,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=new Array(i);let u,h,f,d;for(u=0,h=i;u<h;++u)f=u+r,d=n[f],c[u]={x:s.parse(jf(d,a),f),y:o.parse(jf(d,l),f)};return c}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,n,r){const i=this.chart,s=this._cachedMeta,o=n[e.axis],a={keys:Rj(i,!0),values:n._stacks[e.axis]};return Dj(a,o,s.index,{mode:r})}updateRangeFromParsed(e,n,r,i){const s=r[n.axis];let o=s===null?NaN:s;const a=i&&r._stacks[n.axis];i&&a&&(i.values=a,o=Dj(i,s,this._cachedMeta.index)),e.min=Math.min(e.min,o),e.max=Math.max(e.max,o)}getMinMax(e,n){const r=this._cachedMeta,i=r._parsed,s=r._sorted&&e===r.iScale,o=i.length,a=this._getOtherScale(e),l=t4e(n,r,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:u,max:h}=Zze(a);let f,d;function p(){d=i[f];const m=d[a.axis];return!ai(d[e.axis])||u>m||h<m}for(f=0;f<o&&!(!p()&&(this.updateRangeFromParsed(c,e,d,l),s));++f);if(s){for(f=o-1;f>=0;--f)if(!p()){this.updateRangeFromParsed(c,e,d,l);break}}return c}getAllParsedValues(e){const n=this._cachedMeta._parsed,r=[];let i,s,o;for(i=0,s=n.length;i<s;++i)o=n[i][e.axis],ai(o)&&r.push(o);return r}getMaxOverflow(){return!1}getLabelAndValue(e){const n=this._cachedMeta,r=n.iScale,i=n.vScale,s=this.getParsed(e);return{label:r?""+r.getLabelForValue(s[r.axis]):"",value:i?""+i.getLabelForValue(s[i.axis]):""}}_update(e){const n=this._cachedMeta;this.update(e||"default"),n._clip=Xze(fn(this.options.clip,qze(n.xScale,n.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,n=this.chart,r=this._cachedMeta,i=r.data||[],s=n.chartArea,o=[],a=this._drawStart||0,l=this._drawCount||i.length-a,c=this.options.drawActiveElementsOnTop;let u;for(r.dataset&&r.dataset.draw(e,s,a,l),u=a;u<a+l;++u){const h=i[u];h.hidden||(h.active&&c?o.push(h):h.draw(e,s))}for(u=0;u<o.length;++u)o[u].draw(e,s)}getStyle(e,n){const r=n?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(r):this.resolveDataElementOptions(e||0,r)}getContext(e,n,r){const i=this.getDataset();let s;if(e>=0&&e<this._cachedMeta.data.length){const o=this._cachedMeta.data[e];s=o.$context||(o.$context=e4e(this.getContext(),e,o)),s.parsed=this.getParsed(e),s.raw=i.data[e],s.index=s.dataIndex=e}else s=this.$context||(this.$context=Qze(this.chart.getContext(),this.index)),s.dataset=i,s.index=s.datasetIndex=this.index;return s.active=!!n,s.mode=r,s}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,n){return this._resolveElementOptions(this.dataElementType.id,n,e)}_resolveElementOptions(e,n="default",r){const i=n==="active",s=this._cachedDataOpts,o=e+"-"+n,a=s[o],l=this.enableOptionSharing&&Sa(r);if(a)return Lj(a,l);const c=this.chart.config,u=c.datasetElementScopeKeys(this._type,e),h=i?[`${e}Hover`,"hover",e,""]:[e,""],f=c.getOptionScopes(this.getDataset(),u),d=Object.keys(On.elements[e]),p=()=>this.getContext(r,i),m=c.resolveNamedOptions(f,d,p,h);return m.$shared&&(m.$shared=l,s[o]=Object.freeze(Lj(m,l))),m}_resolveAnimations(e,n,r){const i=this.chart,s=this._cachedDataOpts,o=`animation-${n}`,a=s[o];if(a)return a;let l;if(i.options.animation!==!1){const u=this.chart.config,h=u.datasetAnimationScopeKeys(this._type,n),f=u.getOptionScopes(this.getDataset(),h);l=u.createResolver(f,this.getContext(e,r,n))}const c=new Nj(i,l&&l.animations);return l&&l._cacheable&&(s[o]=Object.freeze(c)),c}getSharedOptions(e){if(!!e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,n){return!n||ED(e)||this.chart._animationsDisabled}updateElement(e,n,r,i){ED(i)?Object.assign(e,r):this._resolveAnimations(n,i).update(e,r)}updateSharedOptions(e,n,r){e&&!ED(n)&&this._resolveAnimations(void 0,n).update(e,r)}_setStyle(e,n,r,i){e.active=i;const s=this.getStyle(n,i);this._resolveAnimations(n,r,i).update(e,{options:!i&&this.getSharedOptions(s)||s})}removeHoverStyle(e,n,r){this._setStyle(e,r,"active",!1)}setHoverStyle(e,n,r){this._setStyle(e,r,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const n=this._data,r=this._cachedMeta.data;for(const[a,l,c]of this._syncList)this[a](l,c);this._syncList=[];const i=r.length,s=n.length,o=Math.min(s,i);o&&this.parse(0,o),s>i?this._insertElements(i,s-i,e):s<i&&this._removeElements(s,i-s)}_insertElements(e,n,r=!0){const i=this._cachedMeta,s=i.data,o=e+n;let a;const l=c=>{for(c.length+=n,a=c.length-1;a>=o;a--)c[a]=c[a-n]};for(l(s),a=e;a<o;++a)s[a]=new this.dataElementType;this._parsing&&l(i._parsed),this.parse(e,n),r&&this.updateElements(s,e,n,"reset")}updateElements(e,n,r,i){}_removeElements(e,n){const r=this._cachedMeta;if(this._parsing){const i=r._parsed.splice(e,n);r._stacked&&aw(r,i)}r.data.splice(e,n)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[n,r,i]=e;this[n](r,i)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,n){n&&this._sync(["_removeElements",e,n]);const r=arguments.length-2;r&&this._sync(["_insertElements",e,r])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}ul.defaults={};ul.prototype.datasetElementType=null;ul.prototype.dataElementType=null;function n4e(t,e){if(!t._cache.$bar){const n=t.getMatchingVisibleMetas(e);let r=[];for(let i=0,s=n.length;i<s;i++)r=r.concat(n[i].controller.getAllParsedValues(t));t._cache.$bar=cj(r.sort((i,s)=>i-s))}return t._cache.$bar}function r4e(t){const e=t.iScale,n=n4e(e,t.type);let r=e._length,i,s,o,a;const l=()=>{o===32767||o===-32768||(Sa(a)&&(r=Math.min(r,Math.abs(o-a)||r)),a=o)};for(i=0,s=n.length;i<s;++i)o=e.getPixelForValue(n[i]),l();for(a=void 0,i=0,s=e.ticks.length;i<s;++i)o=e.getPixelForTick(i),l();return r}function i4e(t,e,n,r){const i=n.barThickness;let s,o;return er(i)?(s=e.min*n.categoryPercentage,o=n.barPercentage):(s=i*r,o=1),{chunk:s/r,ratio:o,start:e.pixels[t]-s/2}}function s4e(t,e,n,r){const i=e.pixels,s=i[t];let o=t>0?i[t-1]:null,a=t<i.length-1?i[t+1]:null;const l=n.categoryPercentage;o===null&&(o=s-(a===null?e.end-e.start:a-s)),a===null&&(a=s+s-o);const c=s-(s-Math.min(o,a))/2*l;return{chunk:Math.abs(a-o)/2*l/r,ratio:n.barPercentage,start:c}}function o4e(t,e,n,r){const i=n.parse(t[0],r),s=n.parse(t[1],r),o=Math.min(i,s),a=Math.max(i,s);let l=o,c=a;Math.abs(o)>Math.abs(a)&&(l=a,c=o),e[n.axis]=c,e._custom={barStart:l,barEnd:c,start:i,end:s,min:o,max:a}}function Bj(t,e,n,r){return br(t)?o4e(t,e,n,r):e[n.axis]=n.parse(t,r),e}function zj(t,e,n,r){const i=t.iScale,s=t.vScale,o=i.getLabels(),a=i===s,l=[];let c,u,h,f;for(c=n,u=n+r;c<u;++c)f=e[c],h={},h[i.axis]=a||i.parse(o[c],c),l.push(Bj(f,h,s,c));return l}function kD(t){return t&&t.barStart!==void 0&&t.barEnd!==void 0}function a4e(t,e,n){return t!==0?nc(t):(e.isHorizontal()?1:-1)*(e.min>=n?1:-1)}function l4e(t){let e,n,r,i,s;return t.horizontal?(e=t.base>t.x,n="left",r="right"):(e=t.base<t.y,n="bottom",r="top"),e?(i="end",s="start"):(i="start",s="end"),{start:n,end:r,reverse:e,top:i,bottom:s}}function c4e(t,e,n,r){let i=e.borderSkipped;const s={};if(!i){t.borderSkipped=s;return}const{start:o,end:a,reverse:l,top:c,bottom:u}=l4e(t);i==="middle"&&n&&(t.enableBorderRadius=!0,(n._top||0)===r?i=c:(n._bottom||0)===r?i=u:(s[Vj(u,o,a,l)]=!0,i=c)),s[Vj(i,o,a,l)]=!0,t.borderSkipped=s}function Vj(t,e,n,r){return r?(t=u4e(t,e,n),t=Uj(t,n,e)):t=Uj(t,e,n),t}function u4e(t,e,n){return t===e?n:t===n?e:t}function Uj(t,e,n){return t==="start"?e:t==="end"?n:t}function h4e(t,{inflateAmount:e},n){t.inflateAmount=e==="auto"?n===1?.33:0:e}class oT extends ul{parsePrimitiveData(e,n,r,i){return zj(e,n,r,i)}parseArrayData(e,n,r,i){return zj(e,n,r,i)}parseObjectData(e,n,r,i){const{iScale:s,vScale:o}=e,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=s.axis==="x"?a:l,u=o.axis==="x"?a:l,h=[];let f,d,p,m;for(f=r,d=r+i;f<d;++f)m=n[f],p={},p[s.axis]=s.parse(jf(m,c),f),h.push(Bj(jf(m,u),p,o,f));return h}updateRangeFromParsed(e,n,r,i){super.updateRangeFromParsed(e,n,r,i);const s=r._custom;s&&n===this._cachedMeta.vScale&&(e.min=Math.min(e.min,s.min),e.max=Math.max(e.max,s.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const n=this._cachedMeta,{iScale:r,vScale:i}=n,s=this.getParsed(e),o=s._custom,a=kD(o)?"["+o.start+", "+o.end+"]":""+i.getLabelForValue(s[i.axis]);return{label:""+r.getLabelForValue(s[r.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();const e=this._cachedMeta;e.stack=this.getDataset().stack}update(e){const n=this._cachedMeta;this.updateElements(n.data,0,n.data.length,e)}updateElements(e,n,r,i){const s=i==="reset",{index:o,_cachedMeta:{vScale:a}}=this,l=a.getBasePixel(),c=a.isHorizontal(),u=this._getRuler(),h=this.resolveDataElementOptions(n,i),f=this.getSharedOptions(h),d=this.includeOptions(i,f);this.updateSharedOptions(f,i,h);for(let p=n;p<n+r;p++){const m=this.getParsed(p),v=s||er(m[a.axis])?{base:l,head:l}:this._calculateBarValuePixels(p),y=this._calculateBarIndexPixels(p,u),w=(m._stacks||{})[a.axis],x={horizontal:c,base:v.base,enableBorderRadius:!w||kD(m._custom)||o===w._top||o===w._bottom,x:c?v.head:y.center,y:c?y.center:v.head,height:c?y.size:Math.abs(v.size),width:c?Math.abs(v.size):y.size};d&&(x.options=f||this.resolveDataElementOptions(p,e[p].active?"active":i));const _=x.options||e[p].options;c4e(x,_,w,o),h4e(x,_,u.ratio),this.updateElement(e[p],p,x,i)}}_getStacks(e,n){const i=this._cachedMeta.iScale,s=i.getMatchingVisibleMetas(this._type),o=i.options.stacked,a=s.length,l=[];let c,u;for(c=0;c<a;++c)if(u=s[c],!!u.controller.options.grouped){if(typeof n!="undefined"){const h=u.controller.getParsed(n)[u.controller._cachedMeta.vScale.axis];if(er(h)||isNaN(h))continue}if((o===!1||l.indexOf(u.stack)===-1||o===void 0&&u.stack===void 0)&&l.push(u.stack),u.index===e)break}return l.length||l.push(void 0),l}_getStackCount(e){return this._getStacks(void 0,e).length}_getStackIndex(e,n,r){const i=this._getStacks(e,r),s=n!==void 0?i.indexOf(n):-1;return s===-1?i.length-1:s}_getRuler(){const e=this.options,n=this._cachedMeta,r=n.iScale,i=[];let s,o;for(s=0,o=n.data.length;s<o;++s)i.push(r.getPixelForValue(this.getParsed(s)[r.axis],s));const a=e.barThickness;return{min:a||r4e(n),pixels:i,start:r._startPixel,end:r._endPixel,stackCount:this._getStackCount(),scale:r,grouped:e.grouped,ratio:a?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:n,_stacked:r},options:{base:i,minBarLength:s}}=this,o=i||0,a=this.getParsed(e),l=a._custom,c=kD(l);let u=a[n.axis],h=0,f=r?this.applyStack(n,a,r):u,d,p;f!==u&&(h=f-u,f=u),c&&(u=l.barStart,f=l.barEnd-l.barStart,u!==0&&nc(u)!==nc(l.barEnd)&&(h=0),h+=u);const m=!er(i)&&!c?i:h;let v=n.getPixelForValue(m);if(this.chart.getDataVisibility(e)?d=n.getPixelForValue(h+f):d=v,p=d-v,Math.abs(p)<s&&(p=a4e(p,n,o)*s,u===o&&(v-=p/2),d=v+p),v===n.getPixelForValue(o)){const y=nc(p)*n.getLineWidthForValue(o)/2;v+=y,p-=y}return{size:p,base:v,head:d,center:d+p/2}}_calculateBarIndexPixels(e,n){const r=n.scale,i=this.options,s=i.skipNull,o=fn(i.maxBarThickness,1/0);let a,l;if(n.grouped){const c=s?this._getStackCount(e):n.stackCount,u=i.barThickness==="flex"?s4e(e,n,i,c):i4e(e,n,i,c),h=this._getStackIndex(this.index,this._cachedMeta.stack,s?e:void 0);a=u.start+u.chunk*h+u.chunk/2,l=Math.min(o,u.chunk*u.ratio)}else a=r.getPixelForValue(this.getParsed(e)[r.axis],e),l=Math.min(o,n.min*n.ratio);return{base:a-l/2,head:a+l/2,center:a,size:l}}draw(){const e=this._cachedMeta,n=e.vScale,r=e.data,i=r.length;let s=0;for(;s<i;++s)this.getParsed(s)[n.axis]!==null&&r[s].draw(this._ctx)}}oT.id="bar";oT.defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};oT.overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};class aT extends ul{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(e,n,r,i){const s=super.parsePrimitiveData(e,n,r,i);for(let o=0;o<s.length;o++)s[o]._custom=this.resolveDataElementOptions(o+r).radius;return s}parseArrayData(e,n,r,i){const s=super.parseArrayData(e,n,r,i);for(let o=0;o<s.length;o++){const a=n[r+o];s[o]._custom=fn(a[2],this.resolveDataElementOptions(o+r).radius)}return s}parseObjectData(e,n,r,i){const s=super.parseObjectData(e,n,r,i);for(let o=0;o<s.length;o++){const a=n[r+o];s[o]._custom=fn(a&&a.r&&+a.r,this.resolveDataElementOptions(o+r).radius)}return s}getMaxOverflow(){const e=this._cachedMeta.data;let n=0;for(let r=e.length-1;r>=0;--r)n=Math.max(n,e[r].size(this.resolveDataElementOptions(r))/2);return n>0&&n}getLabelAndValue(e){const n=this._cachedMeta,{xScale:r,yScale:i}=n,s=this.getParsed(e),o=r.getLabelForValue(s.x),a=i.getLabelForValue(s.y),l=s._custom;return{label:n.label,value:"("+o+", "+a+(l?", "+l:"")+")"}}update(e){const n=this._cachedMeta.data;this.updateElements(n,0,n.length,e)}updateElements(e,n,r,i){const s=i==="reset",{iScale:o,vScale:a}=this._cachedMeta,l=this.resolveDataElementOptions(n,i),c=this.getSharedOptions(l),u=this.includeOptions(i,c),h=o.axis,f=a.axis;for(let d=n;d<n+r;d++){const p=e[d],m=!s&&this.getParsed(d),v={},y=v[h]=s?o.getPixelForDecimal(.5):o.getPixelForValue(m[h]),w=v[f]=s?a.getBasePixel():a.getPixelForValue(m[f]);v.skip=isNaN(y)||isNaN(w),u&&(v.options=this.resolveDataElementOptions(d,p.active?"active":i),s&&(v.options.radius=0)),this.updateElement(p,d,v,i)}this.updateSharedOptions(c,i,l)}resolveDataElementOptions(e,n){const r=this.getParsed(e);let i=super.resolveDataElementOptions(e,n);i.$shared&&(i=Object.assign({},i,{$shared:!1}));const s=i.radius;return n!=="active"&&(i.radius=0),i.radius+=fn(r&&r._custom,s),i}}aT.id="bubble";aT.defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};aT.overrides={scales:{x:{type:"linear"},y:{type:"linear"}},plugins:{tooltip:{callbacks:{title(){return""}}}}};function f4e(t,e,n){let r=1,i=1,s=0,o=0;if(e<dr){const a=t,l=a+e,c=Math.cos(a),u=Math.sin(a),h=Math.cos(l),f=Math.sin(l),d=(x,_,S)=>ew(x,a,l,!0)?1:Math.max(_,_*n,S,S*n),p=(x,_,S)=>ew(x,a,l,!0)?-1:Math.min(_,_*n,S,S*n),m=d(0,c,h),v=d(qr,u,f),y=p(Pr,c,h),w=p(Pr+qr,u,f);r=(m-y)/2,i=(v-w)/2,s=-(m+y)/2,o=-(v+w)/2}return{ratioX:r,ratioY:i,offsetX:s,offsetY:o}}class Tg extends ul{constructor(e,n){super(e,n);this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,n){const r=this.getDataset().data,i=this._cachedMeta;if(this._parsing===!1)i._parsed=r;else{let s=l=>+r[l];if(Nn(r[e])){const{key:l="value"}=this._parsing;s=c=>+jf(r[c],l)}let o,a;for(o=e,a=e+n;o<a;++o)i._parsed[o]=s(o)}}_getRotation(){return cl(this.options.rotation-90)}_getCircumference(){return cl(this.options.circumference)}_getRotationExtents(){let e=dr,n=-dr;for(let r=0;r<this.chart.data.datasets.length;++r)if(this.chart.isDatasetVisible(r)){const i=this.chart.getDatasetMeta(r).controller,s=i._getRotation(),o=i._getCircumference();e=Math.min(e,s),n=Math.max(n,s+o)}return{rotation:e,circumference:n-e}}update(e){const n=this.chart,{chartArea:r}=n,i=this._cachedMeta,s=i.data,o=this.getMaxBorderWidth()+this.getMaxOffset(s)+this.options.spacing,a=Math.max((Math.min(r.width,r.height)-o)/2,0),l=Math.min(dBe(this.options.cutout,a),1),c=this._getRingWeight(this.index),{circumference:u,rotation:h}=this._getRotationExtents(),{ratioX:f,ratioY:d,offsetX:p,offsetY:m}=f4e(h,u,l),v=(r.width-o)/f,y=(r.height-o)/d,w=Math.max(Math.min(v,y)/2,0),x=L8(this.options.radius,w),_=Math.max(x*l,0),S=(x-_)/this._getVisibleDatasetWeightTotal();this.offsetX=p*x,this.offsetY=m*x,i.total=this.calculateTotal(),this.outerRadius=x-S*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-S*c,0),this.updateElements(s,0,s.length,e)}_circumference(e,n){const r=this.options,i=this._cachedMeta,s=this._getCircumference();return n&&r.animation.animateRotate||!this.chart.getDataVisibility(e)||i._parsed[e]===null||i.data[e].hidden?0:this.calculateCircumference(i._parsed[e]*s/dr)}updateElements(e,n,r,i){const s=i==="reset",o=this.chart,a=o.chartArea,c=o.options.animation,u=(a.left+a.right)/2,h=(a.top+a.bottom)/2,f=s&&c.animateScale,d=f?0:this.innerRadius,p=f?0:this.outerRadius,m=this.resolveDataElementOptions(n,i),v=this.getSharedOptions(m),y=this.includeOptions(i,v);let w=this._getRotation(),x;for(x=0;x<n;++x)w+=this._circumference(x,s);for(x=n;x<n+r;++x){const _=this._circumference(x,s),S=e[x],T={x:u+this.offsetX,y:h+this.offsetY,startAngle:w,endAngle:w+_,circumference:_,outerRadius:p,innerRadius:d};y&&(T.options=v||this.resolveDataElementOptions(x,S.active?"active":i)),w+=_,this.updateElement(S,x,T,i)}this.updateSharedOptions(v,i,m)}calculateTotal(){const e=this._cachedMeta,n=e.data;let r=0,i;for(i=0;i<n.length;i++){const s=e._parsed[i];s!==null&&!isNaN(s)&&this.chart.getDataVisibility(i)&&!n[i].hidden&&(r+=Math.abs(s))}return r}calculateCircumference(e){const n=this._cachedMeta.total;return n>0&&!isNaN(e)?dr*(Math.abs(e)/n):0}getLabelAndValue(e){const n=this._cachedMeta,r=this.chart,i=r.data.labels||[],s=ow(n._parsed[e],r.options.locale);return{label:i[e]||"",value:s}}getMaxBorderWidth(e){let n=0;const r=this.chart;let i,s,o,a,l;if(!e){for(i=0,s=r.data.datasets.length;i<s;++i)if(r.isDatasetVisible(i)){o=r.getDatasetMeta(i),e=o.data,a=o.controller;break}}if(!e)return 0;for(i=0,s=e.length;i<s;++i)l=a.resolveDataElementOptions(i),l.borderAlign!=="inner"&&(n=Math.max(n,l.borderWidth||0,l.hoverBorderWidth||0));return n}getMaxOffset(e){let n=0;for(let r=0,i=e.length;r<i;++r){const s=this.resolveDataElementOptions(r);n=Math.max(n,s.offset||0,s.hoverOffset||0)}return n}_getRingWeightOffset(e){let n=0;for(let r=0;r<e;++r)this.chart.isDatasetVisible(r)&&(n+=this._getRingWeight(r));return n}_getRingWeight(e){return Math.max(fn(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}Tg.id="doughnut";Tg.defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};Tg.descriptors={_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"};Tg.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:n}}=t.legend.options;return e.labels.map((r,i)=>{const o=t.getDatasetMeta(0).controller.getStyle(i);return{text:r,fillStyle:o.backgroundColor,strokeStyle:o.borderColor,lineWidth:o.borderWidth,pointStyle:n,hidden:!t.getDataVisibility(i),index:i}})}return[]}},onClick(t,e,n){n.chart.toggleDataVisibility(e.index),n.chart.update()}},tooltip:{callbacks:{title(){return""},label(t){let e=t.label;const n=": "+t.formattedValue;return br(e)?(e=e.slice(),e[0]+=n):e+=n,e}}}}};class lw extends ul{initialize(){this.enableOptionSharing=!0,super.initialize()}update(e){const n=this._cachedMeta,{dataset:r,data:i=[],_dataset:s}=n,o=this.chart._animationsDisabled;let{start:a,count:l}=d4e(n,i,o);this._drawStart=a,this._drawCount=l,p4e(n)&&(a=0,l=i.length),r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!s._decimated,r.points=i;const c=this.resolveDatasetElementOptions(e);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(r,void 0,{animated:!o,options:c},e),this.updateElements(i,a,l,e)}updateElements(e,n,r,i){const s=i==="reset",{iScale:o,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,u=this.resolveDataElementOptions(n,i),h=this.getSharedOptions(u),f=this.includeOptions(i,h),d=o.axis,p=a.axis,{spanGaps:m,segment:v}=this.options,y=Jb(m)?m:Number.POSITIVE_INFINITY,w=this.chart._animationsDisabled||s||i==="none";let x=n>0&&this.getParsed(n-1);for(let _=n;_<n+r;++_){const S=e[_],T=this.getParsed(_),E=w?S:{},k=er(T[p]),A=E[d]=o.getPixelForValue(T[d],_),M=E[p]=s||k?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,T,l):T[p],_);E.skip=isNaN(A)||isNaN(M)||k,E.stop=_>0&&T[d]-x[d]>y,v&&(E.parsed=T,E.raw=c.data[_]),f&&(E.options=h||this.resolveDataElementOptions(_,S.active?"active":i)),w||this.updateElement(S,_,E,i),x=T}this.updateSharedOptions(h,i,u)}getMaxOverflow(){const e=this._cachedMeta,n=e.dataset,r=n.options&&n.options.borderWidth||0,i=e.data||[];if(!i.length)return r;const s=i[0].size(this.resolveDataElementOptions(0)),o=i[i.length-1].size(this.resolveDataElementOptions(i.length-1));return Math.max(r,s,o)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}lw.id="line";lw.defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};lw.overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};function d4e(t,e,n){const r=e.length;let i=0,s=r;if(t._sorted){const{iScale:o,_parsed:a}=t,l=o.axis,{min:c,max:u,minDefined:h,maxDefined:f}=o.getUserBounds();h&&(i=_s(Math.min(Qf(a,o.axis,c).lo,n?r:Qf(e,l,o.getPixelForValue(c)).lo),0,r-1)),f?s=_s(Math.max(Qf(a,o.axis,u).hi+1,n?0:Qf(e,l,o.getPixelForValue(u)).hi+1),i,r)-i:s=r-i}return{start:i,count:s}}function p4e(t){const{xScale:e,yScale:n,_scaleRanges:r}=t,i={xmin:e.min,xmax:e.max,ymin:n.min,ymax:n.max};if(!r)return t._scaleRanges=i,!0;const s=r.xmin!==e.min||r.xmax!==e.max||r.ymin!==n.min||r.ymax!==n.max;return Object.assign(r,i),s}class lT extends ul{constructor(e,n){super(e,n);this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(e){const n=this._cachedMeta,r=this.chart,i=r.data.labels||[],s=ow(n._parsed[e].r,r.options.locale);return{label:i[e]||"",value:s}}update(e){const n=this._cachedMeta.data;this._updateRadius(),this.updateElements(n,0,n.length,e)}_updateRadius(){const e=this.chart,n=e.chartArea,r=e.options,i=Math.min(n.right-n.left,n.bottom-n.top),s=Math.max(i/2,0),o=Math.max(r.cutoutPercentage?s/100*r.cutoutPercentage:1,0),a=(s-o)/e.getVisibleDatasetCount();this.outerRadius=s-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(e,n,r,i){const s=i==="reset",o=this.chart,a=this.getDataset(),c=o.options.animation,u=this._cachedMeta.rScale,h=u.xCenter,f=u.yCenter,d=u.getIndexAngle(0)-.5*Pr;let p=d,m;const v=360/this.countVisibleElements();for(m=0;m<n;++m)p+=this._computeAngle(m,i,v);for(m=n;m<n+r;m++){const y=e[m];let w=p,x=p+this._computeAngle(m,i,v),_=o.getDataVisibility(m)?u.getDistanceFromCenterForValue(a.data[m]):0;p=x,s&&(c.animateScale&&(_=0),c.animateRotate&&(w=x=d));const S={x:h,y:f,innerRadius:0,outerRadius:_,startAngle:w,endAngle:x,options:this.resolveDataElementOptions(m,y.active?"active":i)};this.updateElement(y,m,S,i)}}countVisibleElements(){const e=this.getDataset(),n=this._cachedMeta;let r=0;return n.data.forEach((i,s)=>{!isNaN(e.data[s])&&this.chart.getDataVisibility(s)&&r++}),r}_computeAngle(e,n,r){return this.chart.getDataVisibility(e)?cl(this.resolveDataElementOptions(e,n).angle||r):0}}lT.id="polarArea";lT.defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};lT.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:n}}=t.legend.options;return e.labels.map((r,i)=>{const o=t.getDatasetMeta(0).controller.getStyle(i);return{text:r,fillStyle:o.backgroundColor,strokeStyle:o.borderColor,lineWidth:o.borderWidth,pointStyle:n,hidden:!t.getDataVisibility(i),index:i}})}return[]}},onClick(t,e,n){n.chart.toggleDataVisibility(e.index),n.chart.update()}},tooltip:{callbacks:{title(){return""},label(t){return t.chart.data.labels[t.dataIndex]+": "+t.formattedValue}}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};class AD extends Tg{}AD.id="pie";AD.defaults={cutout:0,rotation:0,circumference:360,radius:"100%"};class cT extends ul{getLabelAndValue(e){const n=this._cachedMeta.vScale,r=this.getParsed(e);return{label:n.getLabels()[e],value:""+n.getLabelForValue(r[n.axis])}}update(e){const n=this._cachedMeta,r=n.dataset,i=n.data||[],s=n.iScale.getLabels();if(r.points=i,e!=="resize"){const o=this.resolveDatasetElementOptions(e);this.options.showLine||(o.borderWidth=0);const a={_loop:!0,_fullLoop:s.length===i.length,options:o};this.updateElement(r,void 0,a,e)}this.updateElements(i,0,i.length,e)}updateElements(e,n,r,i){const s=this.getDataset(),o=this._cachedMeta.rScale,a=i==="reset";for(let l=n;l<n+r;l++){const c=e[l],u=this.resolveDataElementOptions(l,c.active?"active":i),h=o.getPointPositionForValue(l,s.data[l]),f=a?o.xCenter:h.x,d=a?o.yCenter:h.y,p={x:f,y:d,angle:h.angle,skip:isNaN(f)||isNaN(d),options:u};this.updateElement(c,l,p,i)}}}cT.id="radar";cT.defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};cT.overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};class uT extends lw{}uT.id="scatter";uT.defaults={showLine:!1,fill:!1};uT.overrides={interaction:{mode:"point"},plugins:{tooltip:{callbacks:{title(){return""},label(t){return"("+t.label+", "+t.formattedValue+")"}}}},scales:{x:{type:"linear"},y:{type:"linear"}}};function nd(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class MD{constructor(e){this.options=e||{}}formats(){return nd()}parse(e,n){return nd()}format(e,n){return nd()}add(e,n,r){return nd()}diff(e,n,r){return nd()}startOf(e,n,r){return nd()}endOf(e,n){return nd()}}MD.override=function(t){Object.assign(MD.prototype,t)};var m4e={_date:MD};function cw(t,e){return"native"in t?{x:t.x,y:t.y}:yj(t,e)}function g4e(t,e){const n=t.getSortedVisibleDatasetMetas();let r,i,s;for(let o=0,a=n.length;o<a;++o){({index:r,data:i}=n[o]);for(let l=0,c=i.length;l<c;++l)s=i[l],s.skip||e(s,r,l)}}function v4e(t,e,n,r){const{controller:i,data:s,_sorted:o}=t,a=i._cachedMeta.iScale;if(a&&e===a.axis&&e!=="r"&&o&&s.length){const l=a._reversePixels?nze:Qf;if(r){if(i._sharedOptions){const c=s[0],u=typeof c.getRange=="function"&&c.getRange(e);if(u){const h=l(s,e,n-u),f=l(s,e,n+u);return{lo:h.lo,hi:f.hi}}}}else return l(s,e,n)}return{lo:0,hi:s.length-1}}function ID(t,e,n,r,i){const s=t.getSortedVisibleDatasetMetas(),o=n[e];for(let a=0,l=s.length;a<l;++a){const{index:c,data:u}=s[a],{lo:h,hi:f}=v4e(s[a],e,o,i);for(let d=h;d<=f;++d){const p=u[d];p.skip||r(p,c,d)}}}function y4e(t){const e=t.indexOf("x")!==-1,n=t.indexOf("y")!==-1;return function(r,i){const s=e?Math.abs(r.x-i.x):0,o=n?Math.abs(r.y-i.y):0;return Math.sqrt(Math.pow(s,2)+Math.pow(o,2))}}function ND(t,e,n,r){const i=[];return Kf(e,t.chartArea,t._minPadding)&&ID(t,n,e,function(o,a,l){o.inRange(e.x,e.y,r)&&i.push({element:o,datasetIndex:a,index:l})},!0),i}function b4e(t,e,n,r){let i=[];function s(o,a,l){const{startAngle:c,endAngle:u}=o.getProps(["startAngle","endAngle"],r),{angle:h}=j8(o,{x:e.x,y:e.y});ew(h,c,u)&&i.push({element:o,datasetIndex:a,index:l})}return ID(t,n,e,s),i}function w4e(t,e,n,r,i){let s=[];const o=y4e(n);let a=Number.POSITIVE_INFINITY;function l(c,u,h){const f=c.inRange(e.x,e.y,i);if(r&&!f)return;const d=c.getCenterPoint(i);if(!Kf(d,t.chartArea,t._minPadding)&&!f)return;const m=o(e,d);m<a?(s=[{element:c,datasetIndex:u,index:h}],a=m):m===a&&s.push({element:c,datasetIndex:u,index:h})}return ID(t,n,e,l),s}function $D(t,e,n,r,i){return Kf(e,t.chartArea,t._minPadding)?n==="r"&&!r?b4e(t,e,n,i):w4e(t,e,n,r,i):[]}function Wj(t,e,n,r){const i=cw(e,t),s=[],o=n.axis,a=o==="x"?"inXRange":"inYRange";let l=!1;return g4e(t,(c,u,h)=>{c[a](i[o],r)&&s.push({element:c,datasetIndex:u,index:h}),c.inRange(i.x,i.y,r)&&(l=!0)}),n.intersect&&!l?[]:s}var x4e={modes:{index(t,e,n,r){const i=cw(e,t),s=n.axis||"x",o=n.intersect?ND(t,i,s,r):$D(t,i,s,!1,r),a=[];return o.length?(t.getSortedVisibleDatasetMetas().forEach(l=>{const c=o[0].index,u=l.data[c];u&&!u.skip&&a.push({element:u,datasetIndex:l.index,index:c})}),a):[]},dataset(t,e,n,r){const i=cw(e,t),s=n.axis||"xy";let o=n.intersect?ND(t,i,s,r):$D(t,i,s,!1,r);if(o.length>0){const a=o[0].datasetIndex,l=t.getDatasetMeta(a).data;o=[];for(let c=0;c<l.length;++c)o.push({element:l[c],datasetIndex:a,index:c})}return o},point(t,e,n,r){const i=cw(e,t),s=n.axis||"xy";return ND(t,i,s,r)},nearest(t,e,n,r){const i=cw(e,t),s=n.axis||"xy";return $D(t,i,s,n.intersect,r)},x(t,e,n,r){return Wj(t,e,{axis:"x",intersect:n.intersect},r)},y(t,e,n,r){return Wj(t,e,{axis:"y",intersect:n.intersect},r)}}};const Gj=["left","top","right","bottom"];function uw(t,e){return t.filter(n=>n.pos===e)}function Hj(t,e){return t.filter(n=>Gj.indexOf(n.pos)===-1&&n.box.axis===e)}function hw(t,e){return t.sort((n,r)=>{const i=e?r:n,s=e?n:r;return i.weight===s.weight?i.index-s.index:i.weight-s.weight})}function _4e(t){const e=[];let n,r,i,s,o,a;for(n=0,r=(t||[]).length;n<r;++n)i=t[n],{position:s,options:{stack:o,stackWeight:a=1}}=i,e.push({index:n,box:i,pos:s,horizontal:i.isHorizontal(),weight:i.weight,stack:o&&s+o,stackWeight:a});return e}function S4e(t){const e={};for(const n of t){const{stack:r,pos:i,stackWeight:s}=n;if(!r||!Gj.includes(i))continue;const o=e[r]||(e[r]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=s}return e}function C4e(t,e){const n=S4e(t),{vBoxMaxWidth:r,hBoxMaxHeight:i}=e;let s,o,a;for(s=0,o=t.length;s<o;++s){a=t[s];const{fullSize:l}=a.box,c=n[a.stack],u=c&&a.stackWeight/c.weight;a.horizontal?(a.width=u?u*r:l&&e.availableWidth,a.height=i):(a.width=r,a.height=u?u*i:l&&e.availableHeight)}return n}function T4e(t){const e=_4e(t),n=hw(e.filter(c=>c.box.fullSize),!0),r=hw(uw(e,"left"),!0),i=hw(uw(e,"right")),s=hw(uw(e,"top"),!0),o=hw(uw(e,"bottom")),a=Hj(e,"x"),l=Hj(e,"y");return{fullSize:n,leftAndTop:r.concat(s),rightAndBottom:i.concat(l).concat(o).concat(a),chartArea:uw(e,"chartArea"),vertical:r.concat(i).concat(l),horizontal:s.concat(o).concat(a)}}function jj(t,e,n,r){return Math.max(t[n],e[n])+Math.max(t[r],e[r])}function qj(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function E4e(t,e,n,r){const{pos:i,box:s}=n,o=t.maxPadding;if(!Nn(i)){n.size&&(t[i]-=n.size);const h=r[n.stack]||{size:0,count:1};h.size=Math.max(h.size,n.horizontal?s.height:s.width),n.size=h.size/h.count,t[i]+=n.size}s.getPadding&&qj(o,s.getPadding());const a=Math.max(0,e.outerWidth-jj(o,t,"left","right")),l=Math.max(0,e.outerHeight-jj(o,t,"top","bottom")),c=a!==t.w,u=l!==t.h;return t.w=a,t.h=l,n.horizontal?{same:c,other:u}:{same:u,other:c}}function k4e(t){const e=t.maxPadding;function n(r){const i=Math.max(e[r]-t[r],0);return t[r]+=i,i}t.y+=n("top"),t.x+=n("left"),n("right"),n("bottom")}function A4e(t,e){const n=e.maxPadding;function r(i){const s={left:0,top:0,right:0,bottom:0};return i.forEach(o=>{s[o]=Math.max(e[o],n[o])}),s}return r(t?["left","right"]:["top","bottom"])}function fw(t,e,n,r){const i=[];let s,o,a,l,c,u;for(s=0,o=t.length,c=0;s<o;++s){a=t[s],l=a.box,l.update(a.width||e.w,a.height||e.h,A4e(a.horizontal,e));const{same:h,other:f}=E4e(e,n,a,r);c|=h&&i.length,u=u||f,l.fullSize||i.push(a)}return c&&fw(i,e,n,r)||u}function hT(t,e,n,r,i){t.top=n,t.left=e,t.right=e+r,t.bottom=n+i,t.width=r,t.height=i}function Xj(t,e,n,r){const i=n.padding;let{x:s,y:o}=e;for(const a of t){const l=a.box,c=r[a.stack]||{count:1,placed:0,weight:1},u=a.stackWeight/c.weight||1;if(a.horizontal){const h=e.w*u,f=c.size||l.height;Sa(c.start)&&(o=c.start),l.fullSize?hT(l,i.left,o,n.outerWidth-i.right-i.left,f):hT(l,e.left+c.placed,o,h,f),c.start=o,c.placed+=h,o=l.bottom}else{const h=e.h*u,f=c.size||l.width;Sa(c.start)&&(s=c.start),l.fullSize?hT(l,s,i.top,f,n.outerHeight-i.bottom-i.top):hT(l,s,e.top+c.placed,f,h),c.start=s,c.placed+=h,s=l.right}}e.x=s,e.y=o}On.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}});var Ea={addBox(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(n){e.draw(n)}}]},t.boxes.push(e)},removeBox(t,e){const n=t.boxes?t.boxes.indexOf(e):-1;n!==-1&&t.boxes.splice(n,1)},configure(t,e,n){e.fullSize=n.fullSize,e.position=n.position,e.weight=n.weight},update(t,e,n,r){if(!t)return;const i=Ss(t.options.layout.padding),s=Math.max(e-i.width,0),o=Math.max(n-i.height,0),a=T4e(t.boxes),l=a.vertical,c=a.horizontal;tr(t.boxes,m=>{typeof m.beforeLayout=="function"&&m.beforeLayout()});const u=l.reduce((m,v)=>v.box.options&&v.box.options.display===!1?m:m+1,0)||1,h=Object.freeze({outerWidth:e,outerHeight:n,padding:i,availableWidth:s,availableHeight:o,vBoxMaxWidth:s/2/u,hBoxMaxHeight:o/2}),f=Object.assign({},i);qj(f,Ss(r));const d=Object.assign({maxPadding:f,w:s,h:o,x:i.left,y:i.top},i),p=C4e(l.concat(c),h);fw(a.fullSize,d,h,p),fw(l,d,h,p),fw(c,d,h,p)&&fw(l,d,h,p),k4e(d),Xj(a.leftAndTop,d,h,p),d.x+=d.w,d.y+=d.h,Xj(a.rightAndBottom,d,h,p),t.chartArea={left:d.left,top:d.top,right:d.left+d.w,bottom:d.top+d.h,height:d.h,width:d.w},tr(a.chartArea,m=>{const v=m.box;Object.assign(v,t.chartArea),v.update(d.w,d.h,{left:0,top:0,right:0,bottom:0})})}};class Kj{acquireContext(e,n){}releaseContext(e){return!1}addEventListener(e,n,r){}removeEventListener(e,n,r){}getDevicePixelRatio(){return 1}getMaximumSize(e,n,r,i){return n=Math.max(0,n||e.width),r=r||e.height,{width:n,height:Math.max(0,i?Math.floor(n/i):r)}}isAttached(e){return!0}updateConfig(e){}}class M4e extends Kj{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const fT="$chartjs",I4e={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Yj=t=>t===null||t==="";function N4e(t,e){const n=t.style,r=t.getAttribute("height"),i=t.getAttribute("width");if(t[fT]={initial:{height:r,width:i,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",Yj(i)){const s=wj(t,"width");s!==void 0&&(t.width=s)}if(Yj(r))if(t.style.height==="")t.height=t.width/(e||2);else{const s=wj(t,"height");s!==void 0&&(t.height=s)}return t}const Zj=kze?{passive:!0}:!1;function $4e(t,e,n){t.addEventListener(e,n,Zj)}function R4e(t,e,n){t.canvas.removeEventListener(e,n,Zj)}function D4e(t,e){const n=I4e[t.type]||t.type,{x:r,y:i}=yj(t,e);return{type:n,chart:e,native:t,x:r!==void 0?r:null,y:i!==void 0?i:null}}function dT(t,e){for(const n of t)if(n===e||n.contains(e))return!0}function P4e(t,e,n){const r=t.canvas,i=new MutationObserver(s=>{let o=!1;for(const a of s)o=o||dT(a.addedNodes,r),o=o&&!dT(a.removedNodes,r);o&&n()});return i.observe(document,{childList:!0,subtree:!0}),i}function O4e(t,e,n){const r=t.canvas,i=new MutationObserver(s=>{let o=!1;for(const a of s)o=o||dT(a.removedNodes,r),o=o&&!dT(a.addedNodes,r);o&&n()});return i.observe(document,{childList:!0,subtree:!0}),i}const dw=new Map;let Jj=0;function Qj(){const t=window.devicePixelRatio;t!==Jj&&(Jj=t,dw.forEach((e,n)=>{n.currentDevicePixelRatio!==t&&e()}))}function F4e(t,e){dw.size||window.addEventListener("resize",Qj),dw.set(t,e)}function L4e(t){dw.delete(t),dw.size||window.removeEventListener("resize",Qj)}function B4e(t,e,n){const r=t.canvas,i=r&&SD(r);if(!i)return;const s=F8((a,l)=>{const c=i.clientWidth;n(a,l),c<i.clientWidth&&n()},window),o=new ResizeObserver(a=>{const l=a[0],c=l.contentRect.width,u=l.contentRect.height;c===0&&u===0||s(c,u)});return o.observe(i),F4e(t,s),o}function RD(t,e,n){n&&n.disconnect(),e==="resize"&&L4e(t)}function z4e(t,e,n){const r=t.canvas,i=F8(s=>{t.ctx!==null&&n(D4e(s,t))},t,s=>{const o=s[0];return[o,o.offsetX,o.offsetY]});return $4e(r,e,i),i}class V4e extends Kj{acquireContext(e,n){const r=e&&e.getContext&&e.getContext("2d");return r&&r.canvas===e?(N4e(e,n),r):null}releaseContext(e){const n=e.canvas;if(!n[fT])return!1;const r=n[fT].initial;["height","width"].forEach(s=>{const o=r[s];er(o)?n.removeAttribute(s):n.setAttribute(s,o)});const i=r.style||{};return Object.keys(i).forEach(s=>{n.style[s]=i[s]}),n.width=n.width,delete n[fT],!0}addEventListener(e,n,r){this.removeEventListener(e,n);const i=e.$proxies||(e.$proxies={}),o={attach:P4e,detach:O4e,resize:B4e}[n]||z4e;i[n]=o(e,n,r)}removeEventListener(e,n){const r=e.$proxies||(e.$proxies={}),i=r[n];if(!i)return;({attach:RD,detach:RD,resize:RD}[n]||R4e)(e,n,i),r[n]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,n,r,i){return Eze(e,n,r,i)}isAttached(e){const n=SD(e);return!!(n&&n.isConnected)}}function U4e(t){return!vj()||typeof OffscreenCanvas!="undefined"&&t instanceof OffscreenCanvas?M4e:V4e}class ka{constructor(){this.x=void 0,this.y=void 0,this.active=!1,this.options=void 0,this.$animations=void 0}tooltipPosition(e){const{x:n,y:r}=this.getProps(["x","y"],e);return{x:n,y:r}}hasValue(){return Jb(this.x)&&Jb(this.y)}getProps(e,n){const r=this.$animations;if(!n||!r)return this;const i={};return e.forEach(s=>{i[s]=r[s]&&r[s].active()?r[s]._to:this[s]}),i}}ka.defaults={};ka.defaultRoutes=void 0;const e9={values(t){return br(t)?t:""+t},numeric(t,e,n){if(t===0)return"0";const r=this.chart.options.locale;let i,s=t;if(n.length>1){const c=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(c<1e-4||c>1e15)&&(i="scientific"),s=W4e(t,n)}const o=Ca(Math.abs(s)),a=Math.max(Math.min(-1*Math.floor(o),20),0),l={notation:i,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),ow(t,r,l)},logarithmic(t,e,n){if(t===0)return"0";const r=t/Math.pow(10,Math.floor(Ca(t)));return r===1||r===2||r===5?e9.numeric.call(this,t,e,n):""}};function W4e(t,e){let n=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(n)>=1&&t!==Math.floor(t)&&(n=t-Math.floor(t)),n}var pT={formatters:e9};On.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1,borderDash:[],borderDashOffset:0,borderWidth:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:pT.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}});On.route("scale.ticks","color","","color");On.route("scale.grid","color","","borderColor");On.route("scale.grid","borderColor","","borderColor");On.route("scale.title","color","","color");On.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"});On.describe("scales",{_fallback:"scale"});On.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"});function G4e(t,e){const n=t.options.ticks,r=n.maxTicksLimit||H4e(t),i=n.major.enabled?q4e(e):[],s=i.length,o=i[0],a=i[s-1],l=[];if(s>r)return X4e(e,l,i,s/r),l;const c=j4e(i,e,r);if(s>0){let u,h;const f=s>1?Math.round((a-o)/(s-1)):null;for(mT(e,l,c,er(f)?0:o-f,o),u=0,h=s-1;u<h;u++)mT(e,l,c,i[u],i[u+1]);return mT(e,l,c,a,er(f)?e.length:a+f),l}return mT(e,l,c),l}function H4e(t){const e=t.options.offset,n=t._tickSize(),r=t._length/n+(e?0:1),i=t._maxLength/n;return Math.floor(Math.min(r,i))}function j4e(t,e,n){const r=K4e(t),i=e.length/n;if(!r)return Math.max(i,1);const s=xBe(r);for(let o=0,a=s.length-1;o<a;o++){const l=s[o];if(l>i)return l}return Math.max(i,1)}function q4e(t){const e=[];let n,r;for(n=0,r=t.length;n<r;n++)t[n].major&&e.push(n);return e}function X4e(t,e,n,r){let i=0,s=n[0],o;for(r=Math.ceil(r),o=0;o<t.length;o++)o===s&&(e.push(t[o]),i++,s=n[i*r])}function mT(t,e,n,r,i){const s=fn(r,0),o=Math.min(fn(i,t.length),t.length);let a=0,l,c,u;for(n=Math.ceil(n),i&&(l=i-r,n=l/Math.floor(l/n)),u=s;u<0;)a++,u=Math.round(s+a*n);for(c=Math.max(s,0);c<o;c++)c===u&&(e.push(t[c]),a++,u=Math.round(s+a*n))}function K4e(t){const e=t.length;let n,r;if(e<2)return!1;for(r=t[0],n=1;n<e;++n)if(t[n]-t[n-1]!==r)return!1;return r}const Y4e=t=>t==="left"?"right":t==="right"?"left":t,t9=(t,e,n)=>e==="top"||e==="left"?t[e]+n:t[e]-n;function n9(t,e){const n=[],r=t.length/e,i=t.length;let s=0;for(;s<i;s+=r)n.push(t[Math.floor(s)]);return n}function Z4e(t,e,n){const r=t.ticks.length,i=Math.min(e,r-1),s=t._startPixel,o=t._endPixel,a=1e-6;let l=t.getPixelForTick(i),c;if(!(n&&(r===1?c=Math.max(l-s,o-l):e===0?c=(t.getPixelForTick(1)-l)/2:c=(l-t.getPixelForTick(i-1))/2,l+=i<e?c:-c,l<s-a||l>o+a)))return l}function J4e(t,e){tr(t,n=>{const r=n.gc,i=r.length/2;let s;if(i>e){for(s=0;s<i;++s)delete n.data[r[s]];r.splice(0,i)}})}function pw(t){return t.drawTicks?t.tickLength:0}function r9(t,e){if(!t.display)return 0;const n=Di(t.font,e),r=Ss(t.padding);return(br(t.text)?t.text.length:1)*n.lineHeight+r.height}function Q4e(t,e){return yh(t,{scale:e,type:"scale"})}function eVe(t,e,n){return yh(t,{tick:n,index:e,type:"tick"})}function tVe(t,e,n){let r=oD(t);return(n&&e!=="right"||!n&&e==="right")&&(r=Y4e(r)),r}function nVe(t,e,n,r){const{top:i,left:s,bottom:o,right:a,chart:l}=t,{chartArea:c,scales:u}=l;let h=0,f,d,p;const m=o-i,v=a-s;if(t.isHorizontal()){if(d=xs(r,s,a),Nn(n)){const y=Object.keys(n)[0],w=n[y];p=u[y].getPixelForValue(w)+m-e}else n==="center"?p=(c.bottom+c.top)/2+m-e:p=t9(t,n,e);f=a-s}else{if(Nn(n)){const y=Object.keys(n)[0],w=n[y];d=u[y].getPixelForValue(w)-v+e}else n==="center"?d=(c.left+c.right)/2-v+e:d=t9(t,n,e);p=xs(r,o,i),h=n==="left"?-qr:qr}return{titleX:d,titleY:p,maxWidth:f,rotation:h}}class rd extends ka{constructor(e){super();this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,n){return e}getUserBounds(){let{_userMin:e,_userMax:n,_suggestedMin:r,_suggestedMax:i}=this;return e=_a(e,Number.POSITIVE_INFINITY),n=_a(n,Number.NEGATIVE_INFINITY),r=_a(r,Number.POSITIVE_INFINITY),i=_a(i,Number.NEGATIVE_INFINITY),{min:_a(e,r),max:_a(n,i),minDefined:ai(e),maxDefined:ai(n)}}getMinMax(e){let{min:n,max:r,minDefined:i,maxDefined:s}=this.getUserBounds(),o;if(i&&s)return{min:n,max:r};const a=this.getMatchingVisibleMetas();for(let l=0,c=a.length;l<c;++l)o=a[l].controller.getMinMax(this,e),i||(n=Math.min(n,o.min)),s||(r=Math.max(r,o.max));return n=s&&n>r?r:n,r=i&&n>r?n:r,{min:_a(n,_a(r,n)),max:_a(r,_a(n,r))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){wr(this.options.beforeUpdate,[this])}update(e,n,r){const{beginAtZero:i,grace:s,ticks:o}=this.options,a=o.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=n,this._margins=r=Object.assign({left:0,right:0,top:0,bottom:0},r),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+r.left+r.right:this.height+r.top+r.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=tze(this,s,i),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=a<this.ticks.length;this._convertTicksToLabels(l?n9(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||o.source==="auto")&&(this.ticks=G4e(this,this.ticks),this._labelSizes=null),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,n,r;this.isHorizontal()?(n=this.left,r=this.right):(n=this.top,r=this.bottom,e=!e),this._startPixel=n,this._endPixel=r,this._reversePixels=e,this._length=r-n,this._alignToPixels=this.options.alignToPixels}afterUpdate(){wr(this.options.afterUpdate,[this])}beforeSetDimensions(){wr(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){wr(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),wr(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){wr(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const n=this.options.ticks;let r,i,s;for(r=0,i=e.length;r<i;r++)s=e[r],s.label=wr(n.callback,[s.value,r,e],this)}afterTickToLabelConversion(){wr(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){wr(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,n=e.ticks,r=this.ticks.length,i=n.minRotation||0,s=n.maxRotation;let o=i,a,l,c;if(!this._isVisible()||!n.display||i>=s||r<=1||!this.isHorizontal()){this.labelRotation=i;return}const u=this._getLabelSizes(),h=u.widest.width,f=u.highest.height,d=_s(this.chart.width-h,0,this.maxWidth);a=e.offset?this.maxWidth/r:d/(r-1),h+6>a&&(a=d/(r-(e.offset?.5:1)),l=this.maxHeight-pw(e.grid)-n.padding-r9(e.title,this.chart.options.font),c=Math.sqrt(h*h+f*f),o=lD(Math.min(Math.asin(_s((u.highest.height+6)/a,-1,1)),Math.asin(_s(l/c,-1,1))-Math.asin(_s(f/c,-1,1)))),o=Math.max(i,Math.min(s,o))),this.labelRotation=o}afterCalculateLabelRotation(){wr(this.options.afterCalculateLabelRotation,[this])}beforeFit(){wr(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:n,options:{ticks:r,title:i,grid:s}}=this,o=this._isVisible(),a=this.isHorizontal();if(o){const l=r9(i,n.options.font);if(a?(e.width=this.maxWidth,e.height=pw(s)+l):(e.height=this.maxHeight,e.width=pw(s)+l),r.display&&this.ticks.length){const{first:c,last:u,widest:h,highest:f}=this._getLabelSizes(),d=r.padding*2,p=cl(this.labelRotation),m=Math.cos(p),v=Math.sin(p);if(a){const y=r.mirror?0:v*h.width+m*f.height;e.height=Math.min(this.maxHeight,e.height+y+d)}else{const y=r.mirror?0:m*h.width+v*f.height;e.width=Math.min(this.maxWidth,e.width+y+d)}this._calculatePadding(c,u,v,m)}}this._handleMargins(),a?(this.width=this._length=n.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=n.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,n,r,i){const{ticks:{align:s,padding:o},position:a}=this.options,l=this.labelRotation!==0,c=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const u=this.getPixelForTick(0)-this.left,h=this.right-this.getPixelForTick(this.ticks.length-1);let f=0,d=0;l?c?(f=i*e.width,d=r*n.height):(f=r*e.height,d=i*n.width):s==="start"?d=n.width:s==="end"?f=e.width:(f=e.width/2,d=n.width/2),this.paddingLeft=Math.max((f-u+o)*this.width/(this.width-u),0),this.paddingRight=Math.max((d-h+o)*this.width/(this.width-h),0)}else{let u=n.height/2,h=e.height/2;s==="start"?(u=0,h=e.height):s==="end"&&(u=n.height,h=0),this.paddingTop=u+o,this.paddingBottom=h+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){wr(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:n}=this.options;return n==="top"||n==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let n,r;for(n=0,r=e.length;n<r;n++)er(e[n].label)&&(e.splice(n,1),r--,n--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const n=this.options.ticks.sampleSize;let r=this.ticks;n<r.length&&(r=n9(r,n)),this._labelSizes=e=this._computeLabelSizes(r,r.length)}return e}_computeLabelSizes(e,n){const{ctx:r,_longestTextCache:i}=this,s=[],o=[];let a=0,l=0,c,u,h,f,d,p,m,v,y,w,x;for(c=0;c<n;++c){if(f=e[c].label,d=this._resolveTickFontOptions(c),r.font=p=d.string,m=i[p]=i[p]||{data:{},gc:[]},v=d.lineHeight,y=w=0,!er(f)&&!br(f))y=J2(r,m.data,m.gc,y,f),w=v;else if(br(f))for(u=0,h=f.length;u<h;++u)x=f[u],!er(x)&&!br(x)&&(y=J2(r,m.data,m.gc,y,x),w+=v);s.push(y),o.push(w),a=Math.max(y,a),l=Math.max(w,l)}J4e(i,n);const _=s.indexOf(a),S=o.indexOf(l),T=E=>({width:s[E]||0,height:o[E]||0});return{first:T(0),last:T(n-1),widest:T(_),highest:T(S),widths:s,heights:o}}getLabelForValue(e){return e}getPixelForValue(e,n){return NaN}getValueForPixel(e){}getPixelForTick(e){const n=this.ticks;return e<0||e>n.length-1?null:this.getPixelForValue(n[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const n=this._startPixel+e*this._length;return CBe(this._alignToPixels?Xf(this.chart,n,0):n)}getDecimalForPixel(e){const n=(e-this._startPixel)/this._length;return this._reversePixels?1-n:n}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:n}=this;return e<0&&n<0?n:e>0&&n>0?e:0}getContext(e){const n=this.ticks||[];if(e>=0&&e<n.length){const r=n[e];return r.$context||(r.$context=eVe(this.getContext(),e,r))}return this.$context||(this.$context=Q4e(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,n=cl(this.labelRotation),r=Math.abs(Math.cos(n)),i=Math.abs(Math.sin(n)),s=this._getLabelSizes(),o=e.autoSkipPadding||0,a=s?s.widest.width+o:0,l=s?s.highest.height+o:0;return this.isHorizontal()?l*r>a*i?a/r:l/i:l*i<a*r?l/r:a/i}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const n=this.axis,r=this.chart,i=this.options,{grid:s,position:o}=i,a=s.offset,l=this.isHorizontal(),u=this.ticks.length+(a?1:0),h=pw(s),f=[],d=s.setContext(this.getContext()),p=d.drawBorder?d.borderWidth:0,m=p/2,v=function(F){return Xf(r,F,p)};let y,w,x,_,S,T,E,k,A,M,D,P;if(o==="top")y=v(this.bottom),T=this.bottom-h,k=y-m,M=v(e.top)+m,P=e.bottom;else if(o==="bottom")y=v(this.top),M=e.top,P=v(e.bottom)-m,T=y+m,k=this.top+h;else if(o==="left")y=v(this.right),S=this.right-h,E=y-m,A=v(e.left)+m,D=e.right;else if(o==="right")y=v(this.left),A=e.left,D=v(e.right)-m,S=y+m,E=this.left+h;else if(n==="x"){if(o==="center")y=v((e.top+e.bottom)/2+.5);else if(Nn(o)){const F=Object.keys(o)[0],O=o[F];y=v(this.chart.scales[F].getPixelForValue(O))}M=e.top,P=e.bottom,T=y+m,k=T+h}else if(n==="y"){if(o==="center")y=v((e.left+e.right)/2);else if(Nn(o)){const F=Object.keys(o)[0],O=o[F];y=v(this.chart.scales[F].getPixelForValue(O))}S=y-m,E=S-h,A=e.left,D=e.right}const N=fn(i.ticks.maxTicksLimit,u),R=Math.max(1,Math.ceil(u/N));for(w=0;w<u;w+=R){const F=s.setContext(this.getContext(w)),O=F.lineWidth,K=F.color,J=s.borderDash||[],re=F.borderDashOffset,ae=F.tickWidth,pe=F.tickColor,ke=F.tickBorderDash||[],Te=F.tickBorderDashOffset;x=Z4e(this,w,a),x!==void 0&&(_=Xf(r,x,O),l?S=E=A=D=_:T=k=M=P=_,f.push({tx1:S,ty1:T,tx2:E,ty2:k,x1:A,y1:M,x2:D,y2:P,width:O,color:K,borderDash:J,borderDashOffset:re,tickWidth:ae,tickColor:pe,tickBorderDash:ke,tickBorderDashOffset:Te}))}return this._ticksLength=u,this._borderValue=y,f}_computeLabelItems(e){const n=this.axis,r=this.options,{position:i,ticks:s}=r,o=this.isHorizontal(),a=this.ticks,{align:l,crossAlign:c,padding:u,mirror:h}=s,f=pw(r.grid),d=f+u,p=h?-u:d,m=-cl(this.labelRotation),v=[];let y,w,x,_,S,T,E,k,A,M,D,P,N="middle";if(i==="top")T=this.bottom-p,E=this._getXAxisLabelAlignment();else if(i==="bottom")T=this.top+p,E=this._getXAxisLabelAlignment();else if(i==="left"){const F=this._getYAxisLabelAlignment(f);E=F.textAlign,S=F.x}else if(i==="right"){const F=this._getYAxisLabelAlignment(f);E=F.textAlign,S=F.x}else if(n==="x"){if(i==="center")T=(e.top+e.bottom)/2+d;else if(Nn(i)){const F=Object.keys(i)[0],O=i[F];T=this.chart.scales[F].getPixelForValue(O)+d}E=this._getXAxisLabelAlignment()}else if(n==="y"){if(i==="center")S=(e.left+e.right)/2-d;else if(Nn(i)){const F=Object.keys(i)[0],O=i[F];S=this.chart.scales[F].getPixelForValue(O)}E=this._getYAxisLabelAlignment(f).textAlign}n==="y"&&(l==="start"?N="top":l==="end"&&(N="bottom"));const R=this._getLabelSizes();for(y=0,w=a.length;y<w;++y){x=a[y],_=x.label;const F=s.setContext(this.getContext(y));k=this.getPixelForTick(y)+s.labelOffset,A=this._resolveTickFontOptions(y),M=A.lineHeight,D=br(_)?_.length:1;const O=D/2,K=F.color,J=F.textStrokeColor,re=F.textStrokeWidth;o?(S=k,i==="top"?c==="near"||m!==0?P=-D*M+M/2:c==="center"?P=-R.highest.height/2-O*M+M:P=-R.highest.height+M/2:c==="near"||m!==0?P=M/2:c==="center"?P=R.highest.height/2-O*M:P=R.highest.height-D*M,h&&(P*=-1)):(T=k,P=(1-D)*M/2);let ae;if(F.showLabelBackdrop){const pe=Ss(F.backdropPadding),ke=R.heights[y],Te=R.widths[y];let Ne=T+P-pe.top,we=S-pe.left;switch(N){case"middle":Ne-=ke/2;break;case"bottom":Ne-=ke;break}switch(E){case"center":we-=Te/2;break;case"right":we-=Te;break}ae={left:we,top:Ne,width:Te+pe.width,height:ke+pe.height,color:F.backdropColor}}v.push({rotation:m,label:_,font:A,color:K,strokeColor:J,strokeWidth:re,textOffset:P,textAlign:E,textBaseline:N,translation:[S,T],backdrop:ae})}return v}_getXAxisLabelAlignment(){const{position:e,ticks:n}=this.options;if(-cl(this.labelRotation))return e==="top"?"left":"right";let i="center";return n.align==="start"?i="left":n.align==="end"&&(i="right"),i}_getYAxisLabelAlignment(e){const{position:n,ticks:{crossAlign:r,mirror:i,padding:s}}=this.options,o=this._getLabelSizes(),a=e+s,l=o.widest.width;let c,u;return n==="left"?i?(u=this.right+s,r==="near"?c="left":r==="center"?(c="center",u+=l/2):(c="right",u+=l)):(u=this.right-a,r==="near"?c="right":r==="center"?(c="center",u-=l/2):(c="left",u=this.left)):n==="right"?i?(u=this.left+s,r==="near"?c="right":r==="center"?(c="center",u-=l/2):(c="left",u-=l)):(u=this.left+a,r==="near"?c="left":r==="center"?(c="center",u+=l/2):(c="right",u=this.right)):c="right",{textAlign:c,x:u}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,n=this.options.position;if(n==="left"||n==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(n==="top"||n==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:n},left:r,top:i,width:s,height:o}=this;n&&(e.save(),e.fillStyle=n,e.fillRect(r,i,s,o),e.restore())}getLineWidthForValue(e){const n=this.options.grid;if(!this._isVisible()||!n.display)return 0;const i=this.ticks.findIndex(s=>s.value===e);return i>=0?n.setContext(this.getContext(i)).lineWidth:0}drawGrid(e){const n=this.options.grid,r=this.ctx,i=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let s,o;const a=(l,c,u)=>{!u.width||!u.color||(r.save(),r.lineWidth=u.width,r.strokeStyle=u.color,r.setLineDash(u.borderDash||[]),r.lineDashOffset=u.borderDashOffset,r.beginPath(),r.moveTo(l.x,l.y),r.lineTo(c.x,c.y),r.stroke(),r.restore())};if(n.display)for(s=0,o=i.length;s<o;++s){const l=i[s];n.drawOnChartArea&&a({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),n.drawTicks&&a({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:n,options:{grid:r}}=this,i=r.setContext(this.getContext()),s=r.drawBorder?i.borderWidth:0;if(!s)return;const o=r.setContext(this.getContext(0)).lineWidth,a=this._borderValue;let l,c,u,h;this.isHorizontal()?(l=Xf(e,this.left,s)-s/2,c=Xf(e,this.right,o)+o/2,u=h=a):(u=Xf(e,this.top,s)-s/2,h=Xf(e,this.bottom,o)+o/2,l=c=a),n.save(),n.lineWidth=i.borderWidth,n.strokeStyle=i.borderColor,n.beginPath(),n.moveTo(l,u),n.lineTo(c,h),n.stroke(),n.restore()}drawLabels(e){if(!this.options.ticks.display)return;const r=this.ctx,i=this._computeLabelArea();i&&eT(r,i);const s=this._labelItems||(this._labelItems=this._computeLabelItems(e));let o,a;for(o=0,a=s.length;o<a;++o){const l=s[o],c=l.font,u=l.label;l.backdrop&&(r.fillStyle=l.backdrop.color,r.fillRect(l.backdrop.left,l.backdrop.top,l.backdrop.width,l.backdrop.height));let h=l.textOffset;Yf(r,u,0,h,c,l)}i&&tT(r)}drawTitle(){const{ctx:e,options:{position:n,title:r,reverse:i}}=this;if(!r.display)return;const s=Di(r.font),o=Ss(r.padding),a=r.align;let l=s.lineHeight/2;n==="bottom"||n==="center"||Nn(n)?(l+=o.bottom,br(r.text)&&(l+=s.lineHeight*(r.text.length-1))):l+=o.top;const{titleX:c,titleY:u,maxWidth:h,rotation:f}=nVe(this,l,n,a);Yf(e,r.text,0,0,s,{color:r.color,maxWidth:h,rotation:f,textAlign:tVe(a,n,i),textBaseline:"middle",translation:[c,u]})}draw(e){!this._isVisible()||(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,n=e.ticks&&e.ticks.z||0,r=fn(e.grid&&e.grid.z,-1);return!this._isVisible()||this.draw!==rd.prototype.draw?[{z:n,draw:i=>{this.draw(i)}}]:[{z:r,draw:i=>{this.drawBackground(),this.drawGrid(i),this.drawTitle()}},{z:r+1,draw:()=>{this.drawBorder()}},{z:n,draw:i=>{this.drawLabels(i)}}]}getMatchingVisibleMetas(e){const n=this.chart.getSortedVisibleDatasetMetas(),r=this.axis+"AxisID",i=[];let s,o;for(s=0,o=n.length;s<o;++s){const a=n[s];a[r]===this.id&&(!e||a.type===e)&&i.push(a)}return i}_resolveTickFontOptions(e){const n=this.options.ticks.setContext(this.getContext(e));return Di(n.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class gT{constructor(e,n,r){this.type=e,this.scope=n,this.override=r,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const n=Object.getPrototypeOf(e);let r;sVe(n)&&(r=this.register(n));const i=this.items,s=e.id,o=this.scope+"."+s;if(!s)throw new Error("class does not have id: "+e);return s in i||(i[s]=e,rVe(e,o,r),this.override&&On.override(e.id,e.overrides)),o}get(e){return this.items[e]}unregister(e){const n=this.items,r=e.id,i=this.scope;r in n&&delete n[r],i&&r in On[i]&&(delete On[i][r],this.override&&delete qf[r])}}function rVe(t,e,n){const r=Kb(Object.create(null),[n?On.get(n):{},On.get(e),t.defaults]);On.set(e,r),t.defaultRoutes&&iVe(e,t.defaultRoutes),t.descriptors&&On.describe(e,t.descriptors)}function iVe(t,e){Object.keys(e).forEach(n=>{const r=n.split("."),i=r.pop(),s=[t].concat(r).join("."),o=e[n].split("."),a=o.pop(),l=o.join(".");On.route(s,i,l,a)})}function sVe(t){return"id"in t&&"defaults"in t}class oVe{constructor(){this.controllers=new gT(ul,"datasets",!0),this.elements=new gT(ka,"elements"),this.plugins=new gT(Object,"plugins"),this.scales=new gT(rd,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,n,r){[...n].forEach(i=>{const s=r||this._getRegistryForType(i);r||s.isForType(i)||s===this.plugins&&i.id?this._exec(e,s,i):tr(i,o=>{const a=r||this._getRegistryForType(o);this._exec(e,a,o)})})}_exec(e,n,r){const i=aD(e);wr(r["before"+i],[],r),n[e](r),wr(r["after"+i],[],r)}_getRegistryForType(e){for(let n=0;n<this._typedRegistries.length;n++){const r=this._typedRegistries[n];if(r.isForType(e))return r}return this.plugins}_get(e,n,r){const i=n.get(e);if(i===void 0)throw new Error('"'+e+'" is not a registered '+r+".");return i}}var Kc=new oVe;class aVe{constructor(){this._init=[]}notify(e,n,r,i){n==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const s=i?this._descriptors(e).filter(i):this._descriptors(e),o=this._notify(s,e,n,r);return n==="afterDestroy"&&(this._notify(s,e,"stop"),this._notify(this._init,e,"uninstall")),o}_notify(e,n,r,i){i=i||{};for(const s of e){const o=s.plugin,a=o[r],l=[n,i,s.options];if(wr(a,l,o)===!1&&i.cancelable)return!1}return!0}invalidate(){er(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const n=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),n}_createDescriptors(e,n){const r=e&&e.config,i=fn(r.options&&r.options.plugins,{}),s=lVe(r);return i===!1&&!n?[]:uVe(e,s,i,n)}_notifyStateChanges(e){const n=this._oldCache||[],r=this._cache,i=(s,o)=>s.filter(a=>!o.some(l=>a.plugin.id===l.plugin.id));this._notify(i(n,r),e,"stop"),this._notify(i(r,n),e,"start")}}function lVe(t){const e=[],n=Object.keys(Kc.plugins.items);for(let i=0;i<n.length;i++)e.push(Kc.getPlugin(n[i]));const r=t.plugins||[];for(let i=0;i<r.length;i++){const s=r[i];e.indexOf(s)===-1&&e.push(s)}return e}function cVe(t,e){return!e&&t===!1?null:t===!0?{}:t}function uVe(t,e,n,r){const i=[],s=t.getContext();for(let o=0;o<e.length;o++){const a=e[o],l=a.id,c=cVe(n[l],r);c!==null&&i.push({plugin:a,options:hVe(t.config,a,c,s)})}return i}function hVe(t,e,n,r){const i=t.pluginScopeKeys(e),s=t.getOptionScopes(n,i);return t.createResolver(s,r,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function DD(t,e){const n=On.datasets[t]||{};return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||n.indexAxis||"x"}function fVe(t,e){let n=t;return t==="_index_"?n=e:t==="_value_"&&(n=e==="x"?"y":"x"),n}function dVe(t,e){return t===e?"_index_":"_value_"}function pVe(t){if(t==="top"||t==="bottom")return"x";if(t==="left"||t==="right")return"y"}function PD(t,e){return t==="x"||t==="y"?t:e.axis||pVe(e.position)||t.charAt(0).toLowerCase()}function mVe(t,e){const n=qf[t.type]||{scales:{}},r=e.scales||{},i=DD(t.type,e),s=Object.create(null),o=Object.create(null);return Object.keys(r).forEach(a=>{const l=r[a];if(!Nn(l))return console.error(`Invalid scale configuration for scale: ${a}`);if(l._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${a}`);const c=PD(a,l),u=dVe(c,i),h=n.scales||{};s[c]=s[c]||a,o[a]=Yb(Object.create(null),[{axis:c},l,h[c],h[u]])}),t.data.datasets.forEach(a=>{const l=a.type||t.type,c=a.indexAxis||DD(l,e),h=(qf[l]||{}).scales||{};Object.keys(h).forEach(f=>{const d=fVe(f,c),p=a[d+"AxisID"]||s[d]||d;o[p]=o[p]||Object.create(null),Yb(o[p],[{axis:d},r[p],h[f]])})}),Object.keys(o).forEach(a=>{const l=o[a];Yb(l,[On.scales[l.type],On.scale])}),o}function i9(t){const e=t.options||(t.options={});e.plugins=fn(e.plugins,{}),e.scales=mVe(t,e)}function s9(t){return t=t||{},t.datasets=t.datasets||[],t.labels=t.labels||[],t}function gVe(t){return t=t||{},t.data=s9(t.data),i9(t),t}const o9=new Map,a9=new Set;function vT(t,e){let n=o9.get(t);return n||(n=e(),o9.set(t,n),a9.add(n)),n}const mw=(t,e,n)=>{const r=jf(e,n);r!==void 0&&t.add(r)};class vVe{constructor(e){this._config=gVe(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=s9(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),i9(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return vT(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,n){return vT(`${e}.transition.${n}`,()=>[[`datasets.${e}.transitions.${n}`,`transitions.${n}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,n){return vT(`${e}-${n}`,()=>[[`datasets.${e}.elements.${n}`,`datasets.${e}`,`elements.${n}`,""]])}pluginScopeKeys(e){const n=e.id,r=this.type;return vT(`${r}-plugin-${n}`,()=>[[`plugins.${n}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,n){const r=this._scopeCache;let i=r.get(e);return(!i||n)&&(i=new Map,r.set(e,i)),i}getOptionScopes(e,n,r){const{options:i,type:s}=this,o=this._cachedScopes(e,r),a=o.get(n);if(a)return a;const l=new Set;n.forEach(u=>{e&&(l.add(e),u.forEach(h=>mw(l,e,h))),u.forEach(h=>mw(l,i,h)),u.forEach(h=>mw(l,qf[s]||{},h)),u.forEach(h=>mw(l,On,h)),u.forEach(h=>mw(l,gD,h))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),a9.has(n)&&o.set(n,c),c}chartOptionScopes(){const{options:e,type:n}=this;return[e,qf[n]||{},On.datasets[n]||{},{type:n},On,gD]}resolveNamedOptions(e,n,r,i=[""]){const s={$shared:!0},{resolver:o,subPrefixes:a}=l9(this._resolverCache,e,i);let l=o;if(bVe(o,n)){s.$shared=!1,r=vh(r)?r():r;const c=this.createResolver(e,r,a);l=_g(o,r,c)}for(const c of n)s[c]=l[c];return s}createResolver(e,n,r=[""],i){const{resolver:s}=l9(this._resolverCache,e,r);return Nn(n)?_g(s,n,void 0,i):s}}function l9(t,e,n){let r=t.get(e);r||(r=new Map,t.set(e,r));const i=n.join();let s=r.get(i);return s||(s={resolver:wD(e,n),subPrefixes:n.filter(a=>!a.toLowerCase().includes("hover"))},r.set(i,s)),s}const yVe=t=>Nn(t)&&Object.getOwnPropertyNames(t).reduce((e,n)=>e||vh(t[n]),!1);function bVe(t,e){const{isScriptable:n,isIndexable:r}=uj(t);for(const i of e){const s=n(i),o=r(i),a=(o||s)&&t[i];if(s&&(vh(a)||yVe(a))||o&&br(a))return!0}return!1}var wVe="3.7.0";const xVe=["top","bottom","left","right","chartArea"];function c9(t,e){return t==="top"||t==="bottom"||xVe.indexOf(t)===-1&&e==="x"}function u9(t,e){return function(n,r){return n[t]===r[t]?n[e]-r[e]:n[t]-r[t]}}function h9(t){const e=t.chart,n=e.options.animation;e.notifyPlugins("afterRender"),wr(n&&n.onComplete,[t],e)}function _Ve(t){const e=t.chart,n=e.options.animation;wr(n&&n.onProgress,[t],e)}function f9(t){return vj()&&typeof t=="string"?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}const yT={},d9=t=>{const e=f9(t);return Object.values(yT).filter(n=>n.canvas===e).pop()};function SVe(t,e,n){const r=Object.keys(t);for(const i of r){const s=+i;if(s>=e){const o=t[i];delete t[i],(n>0||s>e)&&(t[s+n]=o)}}}function CVe(t,e,n,r){return!n||t.type==="mouseout"?null:r?e:t}class Eg{constructor(e,n){const r=this.config=new vVe(n),i=f9(e),s=d9(i);if(s)throw new Error("Canvas is already in use. Chart with ID '"+s.id+"' must be destroyed before the canvas can be reused.");const o=r.createResolver(r.chartOptionScopes(),this.getContext());this.platform=new(r.platform||U4e(i)),this.platform.updateConfig(r);const a=this.platform.acquireContext(i,o.aspectRatio),l=a&&a.canvas,c=l&&l.height,u=l&&l.width;if(this.id=fBe(),this.ctx=a,this.canvas=l,this.width=u,this.height=c,this._options=o,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new aVe,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=uBe(h=>this.update(h),o.resizeDelay||0),this._dataChanges=[],yT[this.id]=this,!a||!l){console.error("Failed to create chart: can't acquire context from the given item");return}Xc.listen(this,"complete",h9),Xc.listen(this,"progress",_Ve),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:n},width:r,height:i,_aspectRatio:s}=this;return er(e)?n&&s?s:i?r/i:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():bj(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return sj(this.canvas,this.ctx),this}stop(){return Xc.stop(this),this}resize(e,n){Xc.running(this)?this._resizeBeforeDraw={width:e,height:n}:this._resize(e,n)}_resize(e,n){const r=this.options,i=this.canvas,s=r.maintainAspectRatio&&this.aspectRatio,o=this.platform.getMaximumSize(i,e,n,s),a=r.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=o.width,this.height=o.height,this._aspectRatio=this.aspectRatio,!!bj(this,a,!0)&&(this.notifyPlugins("resize",{size:o}),wr(r.onResize,[this,o],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const n=this.options.scales||{};tr(n,(r,i)=>{r.id=i})}buildOrUpdateScales(){const e=this.options,n=e.scales,r=this.scales,i=Object.keys(r).reduce((o,a)=>(o[a]=!1,o),{});let s=[];n&&(s=s.concat(Object.keys(n).map(o=>{const a=n[o],l=PD(o,a),c=l==="r",u=l==="x";return{options:a,dposition:c?"chartArea":u?"bottom":"left",dtype:c?"radialLinear":u?"category":"linear"}}))),tr(s,o=>{const a=o.options,l=a.id,c=PD(l,a),u=fn(a.type,o.dtype);(a.position===void 0||c9(a.position,c)!==c9(o.dposition))&&(a.position=o.dposition),i[l]=!0;let h=null;if(l in r&&r[l].type===u)h=r[l];else{const f=Kc.getScale(u);h=new f({id:l,type:u,ctx:this.ctx,chart:this}),r[h.id]=h}h.init(a,e)}),tr(i,(o,a)=>{o||delete r[a]}),tr(r,o=>{Ea.configure(this,o,o.options),Ea.addBox(this,o)})}_updateMetasets(){const e=this._metasets,n=this.data.datasets.length,r=e.length;if(e.sort((i,s)=>i.index-s.index),r>n){for(let i=n;i<r;++i)this._destroyDatasetMeta(i);e.splice(n,r-n)}this._sortedMetasets=e.slice(0).sort(u9("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:n}}=this;e.length>n.length&&delete this._stacks,e.forEach((r,i)=>{n.filter(s=>s===r._dataset).length===0&&this._destroyDatasetMeta(i)})}buildOrUpdateControllers(){const e=[],n=this.data.datasets;let r,i;for(this._removeUnreferencedMetasets(),r=0,i=n.length;r<i;r++){const s=n[r];let o=this.getDatasetMeta(r);const a=s.type||this.config.type;if(o.type&&o.type!==a&&(this._destroyDatasetMeta(r),o=this.getDatasetMeta(r)),o.type=a,o.indexAxis=s.indexAxis||DD(a,this.options),o.order=s.order||0,o.index=r,o.label=""+s.label,o.visible=this.isDatasetVisible(r),o.controller)o.controller.updateIndex(r),o.controller.linkScales();else{const l=Kc.getController(a),{datasetElementType:c,dataElementType:u}=On.datasets[a];Object.assign(l.prototype,{dataElementType:Kc.getElement(u),datasetElementType:c&&Kc.getElement(c)}),o.controller=new l(this,r),e.push(o.controller)}}return this._updateMetasets(),e}_resetElements(){tr(this.data.datasets,(e,n)=>{this.getDatasetMeta(n).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const n=this.config;n.update();const r=this._options=n.createResolver(n.chartOptionScopes(),this.getContext()),i=this._animationsDisabled=!r.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const s=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let o=0;for(let c=0,u=this.data.datasets.length;c<u;c++){const{controller:h}=this.getDatasetMeta(c),f=!i&&s.indexOf(h)===-1;h.buildOrUpdateElements(f),o=Math.max(+h.getMaxOverflow(),o)}o=this._minPadding=r.layout.autoPadding?o:0,this._updateLayout(o),i||tr(s,c=>{c.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(u9("z","_idx"));const{_active:a,_lastEvent:l}=this;l?this._eventHandler(l,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){tr(this.scales,e=>{Ea.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,n=new Set(Object.keys(this._listeners)),r=new Set(e.events);(!V8(n,r)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,n=this._getUniformDataChanges()||[];for(const{method:r,start:i,count:s}of n){const o=r==="_removeElements"?-s:s;SVe(e,i,o)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const n=this.data.datasets.length,r=s=>new Set(e.filter(o=>o[0]===s).map((o,a)=>a+","+o.splice(1).join(","))),i=r(0);for(let s=1;s<n;s++)if(!V8(i,r(s)))return;return Array.from(i).map(s=>s.split(",")).map(s=>({method:s[1],start:+s[2],count:+s[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Ea.update(this,this.width,this.height,e);const n=this.chartArea,r=n.width<=0||n.height<=0;this._layers=[],tr(this.boxes,i=>{r&&i.position==="chartArea"||(i.configure&&i.configure(),this._layers.push(...i._layers()))},this),this._layers.forEach((i,s)=>{i._idx=s}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let n=0,r=this.data.datasets.length;n<r;++n)this.getDatasetMeta(n).controller.configure();for(let n=0,r=this.data.datasets.length;n<r;++n)this._updateDataset(n,vh(e)?e({datasetIndex:n}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,n){const r=this.getDatasetMeta(e),i={meta:r,index:e,mode:n,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",i)!==!1&&(r.controller._update(n),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Xc.has(this)?this.attached&&!Xc.running(this)&&Xc.start(this):(this.draw(),h9({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:r,height:i}=this._resizeBeforeDraw;this._resize(r,i),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const n=this._layers;for(e=0;e<n.length&&n[e].z<=0;++e)n[e].draw(this.chartArea);for(this._drawDatasets();e<n.length;++e)n[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const n=this._sortedMetasets,r=[];let i,s;for(i=0,s=n.length;i<s;++i){const o=n[i];(!e||o.visible)&&r.push(o)}return r}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let n=e.length-1;n>=0;--n)this._drawDataset(e[n]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const n=this.ctx,r=e._clip,i=!r.disabled,s=this.chartArea,o={meta:e,index:e.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",o)!==!1&&(i&&eT(n,{left:r.left===!1?0:s.left-r.left,right:r.right===!1?this.width:s.right+r.right,top:r.top===!1?0:s.top-r.top,bottom:r.bottom===!1?this.height:s.bottom+r.bottom}),e.controller.draw(),i&&tT(n),o.cancelable=!1,this.notifyPlugins("afterDatasetDraw",o))}getElementsAtEventForMode(e,n,r,i){const s=x4e.modes[n];return typeof s=="function"?s(this,e,r,i):[]}getDatasetMeta(e){const n=this.data.datasets[e],r=this._metasets;let i=r.filter(s=>s&&s._dataset===n).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:n&&n.order||0,index:e,_dataset:n,_parsed:[],_sorted:!1},r.push(i)),i}getContext(){return this.$context||(this.$context=yh(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const n=this.data.datasets[e];if(!n)return!1;const r=this.getDatasetMeta(e);return typeof r.hidden=="boolean"?!r.hidden:!n.hidden}setDatasetVisibility(e,n){const r=this.getDatasetMeta(e);r.hidden=!n}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,n,r){const i=r?"show":"hide",s=this.getDatasetMeta(e),o=s.controller._resolveAnimations(void 0,i);Sa(n)?(s.data[n].hidden=!r,this.update()):(this.setDatasetVisibility(e,r),o.update(s,{visible:r}),this.update(a=>a.datasetIndex===e?i:void 0))}hide(e,n){this._updateVisibility(e,n,!1)}show(e,n){this._updateVisibility(e,n,!0)}_destroyDatasetMeta(e){const n=this._metasets[e];n&&n.controller&&n.controller._destroy(),delete this._metasets[e]}_stop(){let e,n;for(this.stop(),Xc.remove(this),e=0,n=this.data.datasets.length;e<n;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:n}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),sj(e,n),this.platform.releaseContext(n),this.canvas=null,this.ctx=null),this.notifyPlugins("destroy"),delete yT[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,n=this.platform,r=(s,o)=>{n.addEventListener(this,s,o),e[s]=o},i=(s,o,a)=>{s.offsetX=o,s.offsetY=a,this._eventHandler(s)};tr(this.options.events,s=>r(s,i))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,n=this.platform,r=(l,c)=>{n.addEventListener(this,l,c),e[l]=c},i=(l,c)=>{e[l]&&(n.removeEventListener(this,l,c),delete e[l])},s=(l,c)=>{this.canvas&&this.resize(l,c)};let o;const a=()=>{i("attach",a),this.attached=!0,this.resize(),r("resize",s),r("detach",o)};o=()=>{this.attached=!1,i("resize",s),this._stop(),this._resize(0,0),r("attach",a)},n.isAttached(this.canvas)?a():o()}unbindEvents(){tr(this._listeners,(e,n)=>{this.platform.removeEventListener(this,n,e)}),this._listeners={},tr(this._responsiveListeners,(e,n)=>{this.platform.removeEventListener(this,n,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,n,r){const i=r?"set":"remove";let s,o,a,l;for(n==="dataset"&&(s=this.getDatasetMeta(e[0].datasetIndex),s.controller["_"+i+"DatasetHoverStyle"]()),a=0,l=e.length;a<l;++a){o=e[a];const c=o&&this.getDatasetMeta(o.datasetIndex).controller;c&&c[i+"HoverStyle"](o.element,o.datasetIndex,o.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const n=this._active||[],r=e.map(({datasetIndex:s,index:o})=>{const a=this.getDatasetMeta(s);if(!a)throw new Error("No dataset found at index "+s);return{datasetIndex:s,element:a.data[o],index:o}});!W2(r,n)&&(this._active=r,this._lastEvent=null,this._updateHoverStyles(r,n))}notifyPlugins(e,n,r){return this._plugins.notify(this,e,n,r)}_updateHoverStyles(e,n,r){const i=this.options.hover,s=(l,c)=>l.filter(u=>!c.some(h=>u.datasetIndex===h.datasetIndex&&u.index===h.index)),o=s(n,e),a=r?e:s(e,n);o.length&&this.updateHoverStyle(o,i.mode,!1),a.length&&i.mode&&this.updateHoverStyle(a,i.mode,!0)}_eventHandler(e,n){const r={event:e,replay:n,cancelable:!0,inChartArea:Kf(e,this.chartArea,this._minPadding)},i=o=>(o.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",r,i)===!1)return;const s=this._handleEvent(e,n,r.inChartArea);return r.cancelable=!1,this.notifyPlugins("afterEvent",r,i),(s||r.changed)&&this.render(),this}_handleEvent(e,n,r){const{_active:i=[],options:s}=this,o=n,a=this._getActiveElements(e,i,r,o),l=yBe(e),c=CVe(e,this._lastEvent,r,l);r&&(this._lastEvent=null,wr(s.onHover,[e,a,this],this),l&&wr(s.onClick,[e,a,this],this));const u=!W2(a,i);return(u||n)&&(this._active=a,this._updateHoverStyles(a,i,n)),this._lastEvent=c,u}_getActiveElements(e,n,r,i){if(e.type==="mouseout")return[];if(!r)return n;const s=this.options.hover;return this.getElementsAtEventForMode(e,s.mode,s,i)}}const p9=()=>tr(Eg.instances,t=>t._plugins.invalidate()),bh=!0;Object.defineProperties(Eg,{defaults:{enumerable:bh,value:On},instances:{enumerable:bh,value:yT},overrides:{enumerable:bh,value:qf},registry:{enumerable:bh,value:Kc},version:{enumerable:bh,value:wVe},getChart:{enumerable:bh,value:d9},register:{enumerable:bh,value:(...t)=>{Kc.add(...t),p9()}},unregister:{enumerable:bh,value:(...t)=>{Kc.remove(...t),p9()}}});function m9(t,e,n){const{startAngle:r,pixelMargin:i,x:s,y:o,outerRadius:a,innerRadius:l}=e;let c=i/a;t.beginPath(),t.arc(s,o,a,r-c,n+c),l>i?(c=i/l,t.arc(s,o,l,n+c,r-c,!0)):t.arc(s,o,i,n+qr,r-qr),t.closePath(),t.clip()}function TVe(t){return yD(t,["outerStart","outerEnd","innerStart","innerEnd"])}function EVe(t,e,n,r){const i=TVe(t.options.borderRadius),s=(n-e)/2,o=Math.min(s,r*e/2),a=l=>{const c=(n-Math.min(s,l))*r/2;return _s(l,0,Math.min(s,c))};return{outerStart:a(i.outerStart),outerEnd:a(i.outerEnd),innerStart:_s(i.innerStart,0,o),innerEnd:_s(i.innerEnd,0,o)}}function kg(t,e,n,r){return{x:n+t*Math.cos(e),y:r+t*Math.sin(e)}}function OD(t,e,n,r,i){const{x:s,y:o,startAngle:a,pixelMargin:l,innerRadius:c}=e,u=Math.max(e.outerRadius+r+n-l,0),h=c>0?c+r+n+l:0;let f=0;const d=i-a;if(r){const O=c>0?c-r:0,K=u>0?u-r:0,J=(O+K)/2,re=J!==0?d*J/(J+r):d;f=(d-re)/2}const p=Math.max(.001,d*u-n/Pr)/u,m=(d-p)/2,v=a+m+f,y=i-m-f,{outerStart:w,outerEnd:x,innerStart:_,innerEnd:S}=EVe(e,h,u,y-v),T=u-w,E=u-x,k=v+w/T,A=y-x/E,M=h+_,D=h+S,P=v+_/M,N=y-S/D;if(t.beginPath(),t.arc(s,o,u,k,A),x>0){const O=kg(E,A,s,o);t.arc(O.x,O.y,x,A,y+qr)}const R=kg(D,y,s,o);if(t.lineTo(R.x,R.y),S>0){const O=kg(D,N,s,o);t.arc(O.x,O.y,S,y+qr,N+Math.PI)}if(t.arc(s,o,h,y-S/h,v+_/h,!0),_>0){const O=kg(M,P,s,o);t.arc(O.x,O.y,_,P+Math.PI,v-qr)}const F=kg(T,v,s,o);if(t.lineTo(F.x,F.y),w>0){const O=kg(T,k,s,o);t.arc(O.x,O.y,w,v-qr,k)}t.closePath()}function kVe(t,e,n,r){const{fullCircles:i,startAngle:s,circumference:o}=e;let a=e.endAngle;if(i){OD(t,e,n,r,s+dr);for(let l=0;l<i;++l)t.fill();isNaN(o)||(a=s+o%dr,o%dr==0&&(a+=dr))}return OD(t,e,n,r,a),t.fill(),a}function AVe(t,e,n){const{x:r,y:i,startAngle:s,pixelMargin:o,fullCircles:a}=e,l=Math.max(e.outerRadius-o,0),c=e.innerRadius+o;let u;for(n&&m9(t,e,s+dr),t.beginPath(),t.arc(r,i,c,s+dr,s,!0),u=0;u<a;++u)t.stroke();for(t.beginPath(),t.arc(r,i,l,s,s+dr),u=0;u<a;++u)t.stroke()}function MVe(t,e,n,r,i){const{options:s}=e,{borderWidth:o,borderJoinStyle:a}=s,l=s.borderAlign==="inner";!o||(l?(t.lineWidth=o*2,t.lineJoin=a||"round"):(t.lineWidth=o,t.lineJoin=a||"bevel"),e.fullCircles&&AVe(t,e,l),l&&m9(t,e,i),OD(t,e,n,r,i),t.stroke())}class bT extends ka{constructor(e){super();this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,n,r){const i=this.getProps(["x","y"],r),{angle:s,distance:o}=j8(i,{x:e,y:n}),{startAngle:a,endAngle:l,innerRadius:c,outerRadius:u,circumference:h}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],r),f=this.options.spacing/2,p=fn(h,l-a)>=dr||ew(s,a,l),m=qc(o,c+f,u+f);return p&&m}getCenterPoint(e){const{x:n,y:r,startAngle:i,endAngle:s,innerRadius:o,outerRadius:a}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius","circumference"],e),{offset:l,spacing:c}=this.options,u=(i+s)/2,h=(o+a+c+l)/2;return{x:n+Math.cos(u)*h,y:r+Math.sin(u)*h}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:n,circumference:r}=this,i=(n.offset||0)/2,s=(n.spacing||0)/2;if(this.pixelMargin=n.borderAlign==="inner"?.33:0,this.fullCircles=r>dr?Math.floor(r/dr):0,r===0||this.innerRadius<0||this.outerRadius<0)return;e.save();let o=0;if(i){o=i/2;const l=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(l)*o,Math.sin(l)*o),this.circumference>=Pr&&(o=i)}e.fillStyle=n.backgroundColor,e.strokeStyle=n.borderColor;const a=kVe(e,this,o,s);MVe(e,this,o,s,a),e.restore()}}bT.id="arc";bT.defaults={borderAlign:"center",borderColor:"#fff",borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0};bT.defaultRoutes={backgroundColor:"backgroundColor"};function g9(t,e,n=e){t.lineCap=fn(n.borderCapStyle,e.borderCapStyle),t.setLineDash(fn(n.borderDash,e.borderDash)),t.lineDashOffset=fn(n.borderDashOffset,e.borderDashOffset),t.lineJoin=fn(n.borderJoinStyle,e.borderJoinStyle),t.lineWidth=fn(n.borderWidth,e.borderWidth),t.strokeStyle=fn(n.borderColor,e.borderColor)}function IVe(t,e,n){t.lineTo(n.x,n.y)}function NVe(t){return t.stepped?qBe:t.tension||t.cubicInterpolationMode==="monotone"?XBe:IVe}function v9(t,e,n={}){const r=t.length,{start:i=0,end:s=r-1}=n,{start:o,end:a}=e,l=Math.max(i,o),c=Math.min(s,a),u=i<o&&s<o||i>a&&s>a;return{count:r,start:l,loop:e.loop,ilen:c<l&&!u?r+c-l:c-l}}function $Ve(t,e,n,r){const{points:i,options:s}=e,{count:o,start:a,loop:l,ilen:c}=v9(i,n,r),u=NVe(s);let{move:h=!0,reverse:f}=r||{},d,p,m;for(d=0;d<=c;++d)p=i[(a+(f?c-d:d))%o],!p.skip&&(h?(t.moveTo(p.x,p.y),h=!1):u(t,m,p,f,s.stepped),m=p);return l&&(p=i[(a+(f?c:0))%o],u(t,m,p,f,s.stepped)),!!l}function RVe(t,e,n,r){const i=e.points,{count:s,start:o,ilen:a}=v9(i,n,r),{move:l=!0,reverse:c}=r||{};let u=0,h=0,f,d,p,m,v,y;const w=_=>(o+(c?a-_:_))%s,x=()=>{m!==v&&(t.lineTo(u,v),t.lineTo(u,m),t.lineTo(u,y))};for(l&&(d=i[w(0)],t.moveTo(d.x,d.y)),f=0;f<=a;++f){if(d=i[w(f)],d.skip)continue;const _=d.x,S=d.y,T=_|0;T===p?(S<m?m=S:S>v&&(v=S),u=(h*u+_)/++h):(x(),t.lineTo(_,S),p=T,h=0,m=v=S),y=S}x()}function FD(t){const e=t.options,n=e.borderDash&&e.borderDash.length;return!t._decimated&&!t._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!n?RVe:$Ve}function DVe(t){return t.stepped?Aze:t.tension||t.cubicInterpolationMode==="monotone"?Mze:td}function PVe(t,e,n,r){let i=e._path;i||(i=e._path=new Path2D,e.path(i,n,r)&&i.closePath()),g9(t,e.options),t.stroke(i)}function OVe(t,e,n,r){const{segments:i,options:s}=e,o=FD(e);for(const a of i)g9(t,s,a.style),t.beginPath(),o(t,e,a,{start:n,end:n+r-1})&&t.closePath(),t.stroke()}const FVe=typeof Path2D=="function";function LVe(t,e,n,r){FVe&&!e.options.segment?PVe(t,e,n,r):OVe(t,e,n,r)}class wh extends ka{constructor(e){super();this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,n){const r=this.options;if((r.tension||r.cubicInterpolationMode==="monotone")&&!r.stepped&&!this._pointsUpdated){const i=r.spanGaps?this._loop:this._fullLoop;wze(this._points,r,e,i,n),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=Oze(this,this.options.segment))}first(){const e=this.segments,n=this.points;return e.length&&n[e[0].start]}last(){const e=this.segments,n=this.points,r=e.length;return r&&n[e[r-1].end]}interpolate(e,n){const r=this.options,i=e[n],s=this.points,o=kj(this,{property:n,start:i,end:i});if(!o.length)return;const a=[],l=DVe(r);let c,u;for(c=0,u=o.length;c<u;++c){const{start:h,end:f}=o[c],d=s[h],p=s[f];if(d===p){a.push(d);continue}const m=Math.abs((i-d[n])/(p[n]-d[n])),v=l(d,p,m,r.stepped);v[n]=e[n],a.push(v)}return a.length===1?a[0]:a}pathSegment(e,n,r){return FD(this)(e,this,n,r)}path(e,n,r){const i=this.segments,s=FD(this);let o=this._loop;n=n||0,r=r||this.points.length-n;for(const a of i)o&=s(e,this,a,{start:n,end:n+r-1});return!!o}draw(e,n,r,i){const s=this.options||{};(this.points||[]).length&&s.borderWidth&&(e.save(),LVe(e,this,r,i),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}wh.id="line";wh.defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};wh.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};wh.descriptors={_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"};function y9(t,e,n,r){const i=t.options,{[n]:s}=t.getProps([n],r);return Math.abs(e-s)<i.radius+i.hitRadius}class wT extends ka{constructor(e){super();this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,n,r){const i=this.options,{x:s,y:o}=this.getProps(["x","y"],r);return Math.pow(e-s,2)+Math.pow(n-o,2)<Math.pow(i.hitRadius+i.radius,2)}inXRange(e,n){return y9(this,e,"x",n)}inYRange(e,n){return y9(this,e,"y",n)}getCenterPoint(e){const{x:n,y:r}=this.getProps(["x","y"],e);return{x:n,y:r}}size(e){e=e||this.options||{};let n=e.radius||0;n=Math.max(n,n&&e.hoverRadius||0);const r=n&&e.borderWidth||0;return(n+r)*2}draw(e,n){const r=this.options;this.skip||r.radius<.1||!Kf(this,n,this.size(r)/2)||(e.strokeStyle=r.borderColor,e.lineWidth=r.borderWidth,e.fillStyle=r.backgroundColor,Q2(e,r,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}wT.id="point";wT.defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};wT.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};function b9(t,e){const{x:n,y:r,base:i,width:s,height:o}=t.getProps(["x","y","base","width","height"],e);let a,l,c,u,h;return t.horizontal?(h=o/2,a=Math.min(n,i),l=Math.max(n,i),c=r-h,u=r+h):(h=s/2,a=n-h,l=n+h,c=Math.min(r,i),u=Math.max(r,i)),{left:a,top:c,right:l,bottom:u}}function xh(t,e,n,r){return t?0:_s(e,n,r)}function BVe(t,e,n){const r=t.options.borderWidth,i=t.borderSkipped,s=oj(r);return{t:xh(i.top,s.top,0,n),r:xh(i.right,s.right,0,e),b:xh(i.bottom,s.bottom,0,n),l:xh(i.left,s.left,0,e)}}function zVe(t,e,n){const{enableBorderRadius:r}=t.getProps(["enableBorderRadius"]),i=t.options.borderRadius,s=Jf(i),o=Math.min(e,n),a=t.borderSkipped,l=r||Nn(i);return{topLeft:xh(!l||a.top||a.left,s.topLeft,0,o),topRight:xh(!l||a.top||a.right,s.topRight,0,o),bottomLeft:xh(!l||a.bottom||a.left,s.bottomLeft,0,o),bottomRight:xh(!l||a.bottom||a.right,s.bottomRight,0,o)}}function VVe(t){const e=b9(t),n=e.right-e.left,r=e.bottom-e.top,i=BVe(t,n/2,r/2),s=zVe(t,n/2,r/2);return{outer:{x:e.left,y:e.top,w:n,h:r,radius:s},inner:{x:e.left+i.l,y:e.top+i.t,w:n-i.l-i.r,h:r-i.t-i.b,radius:{topLeft:Math.max(0,s.topLeft-Math.max(i.t,i.l)),topRight:Math.max(0,s.topRight-Math.max(i.t,i.r)),bottomLeft:Math.max(0,s.bottomLeft-Math.max(i.b,i.l)),bottomRight:Math.max(0,s.bottomRight-Math.max(i.b,i.r))}}}}function LD(t,e,n,r){const i=e===null,s=n===null,a=t&&!(i&&s)&&b9(t,r);return a&&(i||qc(e,a.left,a.right))&&(s||qc(n,a.top,a.bottom))}function UVe(t){return t.topLeft||t.topRight||t.bottomLeft||t.bottomRight}function WVe(t,e){t.rect(e.x,e.y,e.w,e.h)}function BD(t,e,n={}){const r=t.x!==n.x?-e:0,i=t.y!==n.y?-e:0,s=(t.x+t.w!==n.x+n.w?e:0)-r,o=(t.y+t.h!==n.y+n.h?e:0)-i;return{x:t.x+r,y:t.y+i,w:t.w+s,h:t.h+o,radius:t.radius}}class xT extends ka{constructor(e){super();this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:n,options:{borderColor:r,backgroundColor:i}}=this,{inner:s,outer:o}=VVe(this),a=UVe(o.radius)?Zf:WVe;e.save(),(o.w!==s.w||o.h!==s.h)&&(e.beginPath(),a(e,BD(o,n,s)),e.clip(),a(e,BD(s,-n,o)),e.fillStyle=r,e.fill("evenodd")),e.beginPath(),a(e,BD(s,n)),e.fillStyle=i,e.fill(),e.restore()}inRange(e,n,r){return LD(this,e,n,r)}inXRange(e,n){return LD(this,e,null,n)}inYRange(e,n){return LD(this,null,e,n)}getCenterPoint(e){const{x:n,y:r,base:i,horizontal:s}=this.getProps(["x","y","base","horizontal"],e);return{x:s?(n+i)/2:n,y:s?r:(r+i)/2}}getRange(e){return e==="x"?this.width/2:this.height/2}}xT.id="bar";xT.defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};xT.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};function GVe(t,e){const n=t.getDatasetMeta(e);return n&&t.isDatasetVisible(e)?n.dataset:null}function HVe(t){const e=t.options,n=e.fill;let r=fn(n&&n.target,n);return r===void 0&&(r=!!e.backgroundColor),r===!1||r===null?!1:r===!0?"origin":r}function jVe(t,e,n){const r=HVe(t);if(Nn(r))return isNaN(r.value)?!1:r;let i=parseFloat(r);return ai(i)&&Math.floor(i)===i?((r[0]==="-"||r[0]==="+")&&(i=e+i),i===e||i<0||i>=n?!1:i):["origin","start","end","stack","shape"].indexOf(r)>=0&&r}function qVe(t){const{scale:e={},fill:n}=t;let r=null,i;return n==="start"?r=e.bottom:n==="end"?r=e.top:Nn(n)?r=e.getPixelForValue(n.value):e.getBasePixel&&(r=e.getBasePixel()),ai(r)?(i=e.isHorizontal(),{x:i?r:null,y:i?null:r}):null}class w9{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,n,r){const{x:i,y:s,radius:o}=this;return n=n||{start:0,end:dr},e.arc(i,s,o,n.end,n.start,!0),!r.bounds}interpolate(e){const{x:n,y:r,radius:i}=this,s=e.angle;return{x:n+Math.cos(s)*i,y:r+Math.sin(s)*i,angle:s}}}function XVe(t){const{scale:e,fill:n}=t,r=e.options,i=e.getLabels().length,s=[],o=r.reverse?e.max:e.min,a=r.reverse?e.min:e.max;let l,c,u;if(n==="start"?u=o:n==="end"?u=a:Nn(n)?u=n.value:u=e.getBaseValue(),r.grid.circular)return c=e.getPointPositionForValue(0,o),new w9({x:c.x,y:c.y,radius:e.getDistanceFromCenterForValue(u)});for(l=0;l<i;++l)s.push(e.getPointPositionForValue(l,u));return s}function KVe(t){return(t.scale||{}).getPointPositionForValue?XVe(t):qVe(t)}function x9(t,e,n){for(;e>t;e--){const r=n[e];if(!isNaN(r.x)&&!isNaN(r.y))break}return e}function YVe(t,e){const{x:n=null,y:r=null}=t||{},i=e.points,s=[];return e.segments.forEach(({start:o,end:a})=>{a=x9(o,a,i);const l=i[o],c=i[a];r!==null?(s.push({x:l.x,y:r}),s.push({x:c.x,y:r})):n!==null&&(s.push({x:n,y:l.y}),s.push({x:n,y:c.y}))}),s}function ZVe(t){const{scale:e,index:n,line:r}=t,i=[],s=r.segments,o=r.points,a=JVe(e,n);a.push(_9({x:null,y:e.bottom},r));for(let l=0;l<s.length;l++){const c=s[l];for(let u=c.start;u<=c.end;u++)QVe(i,o[u],a)}return new wh({points:i,options:{}})}function JVe(t,e){const n=[],r=t.getMatchingVisibleMetas("line");for(let i=0;i<r.length;i++){const s=r[i];if(s.index===e)break;s.hidden||n.unshift(s.dataset)}return n}function QVe(t,e,n){const r=[];for(let i=0;i<n.length;i++){const s=n[i],{first:o,last:a,point:l}=eUe(s,e,"x");if(!(!l||o&&a)){if(o)r.unshift(l);else if(t.push(l),!a)break}}t.push(...r)}function eUe(t,e,n){const r=t.interpolate(e,n);if(!r)return{};const i=r[n],s=t.segments,o=t.points;let a=!1,l=!1;for(let c=0;c<s.length;c++){const u=s[c],h=o[u.start][n],f=o[u.end][n];if(qc(i,h,f)){a=i===h,l=i===f;break}}return{first:a,last:l,point:r}}function tUe(t){const{chart:e,fill:n,line:r}=t;if(ai(n))return GVe(e,n);if(n==="stack")return ZVe(t);if(n==="shape")return!0;const i=KVe(t);return i instanceof w9?i:_9(i,r)}function _9(t,e){let n=[],r=!1;return br(t)?(r=!0,n=t):n=YVe(t,e),n.length?new wh({points:n,options:{tension:0},_loop:r,_fullLoop:r}):null}function nUe(t,e,n){let i=t[e].fill;const s=[e];let o;if(!n)return i;for(;i!==!1&&s.indexOf(i)===-1;){if(!ai(i))return i;if(o=t[i],!o)return!1;if(o.visible)return i;s.push(i),i=o.fill}return!1}function S9(t,e,n){t.beginPath(),e.path(t),t.lineTo(e.last().x,n),t.lineTo(e.first().x,n),t.closePath(),t.clip()}function zD(t,e,n,r){if(r)return;let i=e[t],s=n[t];return t==="angle"&&(i=Bo(i),s=Bo(s)),{property:t,start:i,end:s}}function C9(t,e,n,r){return t&&e?r(t[n],e[n]):t?t[n]:e?e[n]:0}function rUe(t,e,n){const r=t.segments,i=t.points,s=e.points,o=[];for(const a of r){let{start:l,end:c}=a;c=x9(l,c,i);const u=zD(n,i[l],i[c],a.loop);if(!e.segments){o.push({source:a,target:u,start:i[l],end:i[c]});continue}const h=kj(e,u);for(const f of h){const d=zD(n,s[f.start],s[f.end],f.loop),p=Ej(a,i,d);for(const m of p)o.push({source:m,target:f,start:{[n]:C9(u,d,"start",Math.max)},end:{[n]:C9(u,d,"end",Math.min)}})}}return o}function iUe(t,e,n){const{top:r,bottom:i}=e.chart.chartArea,{property:s,start:o,end:a}=n||{};s==="x"&&(t.beginPath(),t.rect(o,r,a-o,i-r),t.clip())}function T9(t,e,n,r){const i=e.interpolate(n,r);i&&t.lineTo(i.x,i.y)}function E9(t,e){const{line:n,target:r,property:i,color:s,scale:o}=e,a=rUe(n,r,i);for(const{source:l,target:c,start:u,end:h}of a){const{style:{backgroundColor:f=s}={}}=l,d=r!==!0;t.save(),t.fillStyle=f,iUe(t,o,d&&zD(i,u,h)),t.beginPath();const p=!!n.pathSegment(t,l);let m;if(d){p?t.closePath():T9(t,r,h,i);const v=!!r.pathSegment(t,c,{move:p,reverse:!0});m=p&&v,m||T9(t,r,u,i)}t.closePath(),t.fill(m?"evenodd":"nonzero"),t.restore()}}function sUe(t,e){const{line:n,target:r,above:i,below:s,area:o,scale:a}=e,l=n._loop?"angle":e.axis;t.save(),l==="x"&&s!==i&&(S9(t,r,o.top),E9(t,{line:n,target:r,color:i,scale:a,property:l}),t.restore(),t.save(),S9(t,r,o.bottom)),E9(t,{line:n,target:r,color:s,scale:a,property:l}),t.restore()}function VD(t,e,n){const r=tUe(e),{line:i,scale:s,axis:o}=e,a=i.options,l=a.fill,c=a.backgroundColor,{above:u=c,below:h=c}=l||{};r&&i.points.length&&(eT(t,n),sUe(t,{line:i,target:r,above:u,below:h,area:n,scale:s,axis:o}),tT(t))}var oUe={id:"filler",afterDatasetsUpdate(t,e,n){const r=(t.data.datasets||[]).length,i=[];let s,o,a,l;for(o=0;o<r;++o)s=t.getDatasetMeta(o),a=s.dataset,l=null,a&&a.options&&a instanceof wh&&(l={visible:t.isDatasetVisible(o),index:o,fill:jVe(a,o,r),chart:t,axis:s.controller.options.indexAxis,scale:s.vScale,line:a}),s.$filler=l,i.push(l);for(o=0;o<r;++o)l=i[o],!(!l||l.fill===!1)&&(l.fill=nUe(i,o,n.propagate))},beforeDraw(t,e,n){const r=n.drawTime==="beforeDraw",i=t.getSortedVisibleDatasetMetas(),s=t.chartArea;for(let o=i.length-1;o>=0;--o){const a=i[o].$filler;!a||(a.line.updateControlPoints(s,a.axis),r&&VD(t.ctx,a,s))}},beforeDatasetsDraw(t,e,n){if(n.drawTime!=="beforeDatasetsDraw")return;const r=t.getSortedVisibleDatasetMetas();for(let i=r.length-1;i>=0;--i){const s=r[i].$filler;s&&VD(t.ctx,s,t.chartArea)}},beforeDatasetDraw(t,e,n){const r=e.meta.$filler;!r||r.fill===!1||n.drawTime!=="beforeDatasetDraw"||VD(t.ctx,r,t.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const k9=(t,e)=>{let{boxHeight:n=e,boxWidth:r=e}=t;return t.usePointStyle&&(n=Math.min(n,e),r=Math.min(r,e)),{boxWidth:r,boxHeight:n,itemHeight:Math.max(e,n)}},aUe=(t,e)=>t!==null&&e!==null&&t.datasetIndex===e.datasetIndex&&t.index===e.index;class A9 extends ka{constructor(e){super();this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,n,r){this.maxWidth=e,this.maxHeight=n,this._margins=r,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let n=wr(e.generateLabels,[this.chart],this)||[];e.filter&&(n=n.filter(r=>e.filter(r,this.chart.data))),e.sort&&(n=n.sort((r,i)=>e.sort(r,i,this.chart.data))),this.options.reverse&&n.reverse(),this.legendItems=n}fit(){const{options:e,ctx:n}=this;if(!e.display){this.width=this.height=0;return}const r=e.labels,i=Di(r.font),s=i.size,o=this._computeTitleHeight(),{boxWidth:a,itemHeight:l}=k9(r,s);let c,u;n.font=i.string,this.isHorizontal()?(c=this.maxWidth,u=this._fitRows(o,s,a,l)+10):(u=this.maxHeight,c=this._fitCols(o,s,a,l)+10),this.width=Math.min(c,e.maxWidth||this.maxWidth),this.height=Math.min(u,e.maxHeight||this.maxHeight)}_fitRows(e,n,r,i){const{ctx:s,maxWidth:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],u=i+a;let h=e;s.textAlign="left",s.textBaseline="middle";let f=-1,d=-u;return this.legendItems.forEach((p,m)=>{const v=r+n/2+s.measureText(p.text).width;(m===0||c[c.length-1]+v+2*a>o)&&(h+=u,c[c.length-(m>0?0:1)]=0,d+=u,f++),l[m]={left:0,top:d,row:f,width:v,height:i},c[c.length-1]+=v+a}),h}_fitCols(e,n,r,i){const{ctx:s,maxHeight:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],u=o-e;let h=a,f=0,d=0,p=0,m=0;return this.legendItems.forEach((v,y)=>{const w=r+n/2+s.measureText(v.text).width;y>0&&d+i+2*a>u&&(h+=f+a,c.push({width:f,height:d}),p+=f+a,m++,f=d=0),l[y]={left:p,top:d,col:m,width:w,height:i},f=Math.max(f,w),d+=i+a}),h+=f,c.push({width:f,height:d}),h}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:n,options:{align:r,labels:{padding:i},rtl:s}}=this,o=Cg(s,this.left,this.width);if(this.isHorizontal()){let a=0,l=xs(r,this.left+i,this.right-this.lineWidths[a]);for(const c of n)a!==c.row&&(a=c.row,l=xs(r,this.left+i,this.right-this.lineWidths[a])),c.top+=this.top+e+i,c.left=o.leftForLtr(o.x(l),c.width),l+=c.width+i}else{let a=0,l=xs(r,this.top+e+i,this.bottom-this.columnSizes[a].height);for(const c of n)c.col!==a&&(a=c.col,l=xs(r,this.top+e+i,this.bottom-this.columnSizes[a].height)),c.top=l,c.left+=this.left+i,c.left=o.leftForLtr(o.x(c.left),c.width),l+=c.height+i}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;eT(e,this),this._draw(),tT(e)}}_draw(){const{options:e,columnSizes:n,lineWidths:r,ctx:i}=this,{align:s,labels:o}=e,a=On.color,l=Cg(e.rtl,this.left,this.width),c=Di(o.font),{color:u,padding:h}=o,f=c.size,d=f/2;let p;this.drawTitle(),i.textAlign=l.textAlign("left"),i.textBaseline="middle",i.lineWidth=.5,i.font=c.string;const{boxWidth:m,boxHeight:v,itemHeight:y}=k9(o,f),w=function(E,k,A){if(isNaN(m)||m<=0||isNaN(v)||v<0)return;i.save();const M=fn(A.lineWidth,1);if(i.fillStyle=fn(A.fillStyle,a),i.lineCap=fn(A.lineCap,"butt"),i.lineDashOffset=fn(A.lineDashOffset,0),i.lineJoin=fn(A.lineJoin,"miter"),i.lineWidth=M,i.strokeStyle=fn(A.strokeStyle,a),i.setLineDash(fn(A.lineDash,[])),o.usePointStyle){const D={radius:m*Math.SQRT2/2,pointStyle:A.pointStyle,rotation:A.rotation,borderWidth:M},P=l.xPlus(E,m/2),N=k+d;Q2(i,D,P,N)}else{const D=k+Math.max((f-v)/2,0),P=l.leftForLtr(E,m),N=Jf(A.borderRadius);i.beginPath(),Object.values(N).some(R=>R!==0)?Zf(i,{x:P,y:D,w:m,h:v,radius:N}):i.rect(P,D,m,v),i.fill(),M!==0&&i.stroke()}i.restore()},x=function(E,k,A){Yf(i,A.text,E,k+y/2,c,{strikethrough:A.hidden,textAlign:l.textAlign(A.textAlign)})},_=this.isHorizontal(),S=this._computeTitleHeight();_?p={x:xs(s,this.left+h,this.right-r[0]),y:this.top+h+S,line:0}:p={x:this.left+h,y:xs(s,this.top+S+h,this.bottom-n[0].height),line:0},_j(this.ctx,e.textDirection);const T=y+h;this.legendItems.forEach((E,k)=>{i.strokeStyle=E.fontColor||u,i.fillStyle=E.fontColor||u;const A=i.measureText(E.text).width,M=l.textAlign(E.textAlign||(E.textAlign=o.textAlign)),D=m+d+A;let P=p.x,N=p.y;l.setWidth(this.width),_?k>0&&P+D+h>this.right&&(N=p.y+=T,p.line++,P=p.x=xs(s,this.left+h,this.right-r[p.line])):k>0&&N+T>this.bottom&&(P=p.x=P+n[p.line].width+h,p.line++,N=p.y=xs(s,this.top+S+h,this.bottom-n[p.line].height));const R=l.x(P);w(R,N,E),P=hBe(M,P+m+d,_?P+D:this.right,e.rtl),x(l.x(P),N,E),_?p.x+=D+h:p.y+=T}),Sj(this.ctx,e.textDirection)}drawTitle(){const e=this.options,n=e.title,r=Di(n.font),i=Ss(n.padding);if(!n.display)return;const s=Cg(e.rtl,this.left,this.width),o=this.ctx,a=n.position,l=r.size/2,c=i.top+l;let u,h=this.left,f=this.width;if(this.isHorizontal())f=Math.max(...this.lineWidths),u=this.top+c,h=xs(e.align,h,this.right-f);else{const p=this.columnSizes.reduce((m,v)=>Math.max(m,v.height),0);u=c+xs(e.align,this.top,this.bottom-p-e.labels.padding-this._computeTitleHeight())}const d=xs(a,h,h+f);o.textAlign=s.textAlign(oD(a)),o.textBaseline="middle",o.strokeStyle=n.color,o.fillStyle=n.color,o.font=r.string,Yf(o,n.text,d,u,r)}_computeTitleHeight(){const e=this.options.title,n=Di(e.font),r=Ss(e.padding);return e.display?n.lineHeight+r.height:0}_getLegendItemAt(e,n){let r,i,s;if(qc(e,this.left,this.right)&&qc(n,this.top,this.bottom)){for(s=this.legendHitBoxes,r=0;r<s.length;++r)if(i=s[r],qc(e,i.left,i.left+i.width)&&qc(n,i.top,i.top+i.height))return this.legendItems[r]}return null}handleEvent(e){const n=this.options;if(!lUe(e.type,n))return;const r=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"){const i=this._hoveredItem,s=aUe(i,r);i&&!s&&wr(n.onLeave,[e,i,this],this),this._hoveredItem=r,r&&!s&&wr(n.onHover,[e,r,this],this)}else r&&wr(n.onClick,[e,r,this],this)}}function lUe(t,e){return!!(t==="mousemove"&&(e.onHover||e.onLeave)||e.onClick&&(t==="click"||t==="mouseup"))}var cUe={id:"legend",_element:A9,start(t,e,n){const r=t.legend=new A9({ctx:t.ctx,options:n,chart:t});Ea.configure(t,r,n),Ea.addBox(t,r)},stop(t){Ea.removeBox(t,t.legend),delete t.legend},beforeUpdate(t,e,n){const r=t.legend;Ea.configure(t,r,n),r.options=n},afterUpdate(t){const e=t.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(t,e){e.replay||t.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(t,e,n){const r=e.datasetIndex,i=n.chart;i.isDatasetVisible(r)?(i.hide(r),e.hidden=!0):(i.show(r),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:t=>t.chart.options.color,boxWidth:40,padding:10,generateLabels(t){const e=t.data.datasets,{labels:{usePointStyle:n,pointStyle:r,textAlign:i,color:s}}=t.legend.options;return t._getSortedDatasetMetas().map(o=>{const a=o.controller.getStyle(n?0:void 0),l=Ss(a.borderWidth);return{text:e[o.index].label,fillStyle:a.backgroundColor,fontColor:s,hidden:!o.visible,lineCap:a.borderCapStyle,lineDash:a.borderDash,lineDashOffset:a.borderDashOffset,lineJoin:a.borderJoinStyle,lineWidth:(l.width+l.height)/4,strokeStyle:a.borderColor,pointStyle:r||a.pointStyle,rotation:a.rotation,textAlign:i||a.textAlign,borderRadius:0,datasetIndex:o.index}},this)}},title:{color:t=>t.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:t=>!t.startsWith("on"),labels:{_scriptable:t=>!["generateLabels","filter","sort"].includes(t)}}};class M9 extends ka{constructor(e){super();this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,n){const r=this.options;if(this.left=0,this.top=0,!r.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=e,this.height=this.bottom=n;const i=br(r.text)?r.text.length:1;this._padding=Ss(r.padding);const s=i*Di(r.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=s:this.width=s}isHorizontal(){const e=this.options.position;return e==="top"||e==="bottom"}_drawArgs(e){const{top:n,left:r,bottom:i,right:s,options:o}=this,a=o.align;let l=0,c,u,h;return this.isHorizontal()?(u=xs(a,r,s),h=n+e,c=s-r):(o.position==="left"?(u=r+e,h=xs(a,i,n),l=Pr*-.5):(u=s-e,h=xs(a,n,i),l=Pr*.5),c=i-n),{titleX:u,titleY:h,maxWidth:c,rotation:l}}draw(){const e=this.ctx,n=this.options;if(!n.display)return;const r=Di(n.font),s=r.lineHeight/2+this._padding.top,{titleX:o,titleY:a,maxWidth:l,rotation:c}=this._drawArgs(s);Yf(e,n.text,0,0,r,{color:n.color,maxWidth:l,rotation:c,textAlign:oD(n.align),textBaseline:"middle",translation:[o,a]})}}function uUe(t,e){const n=new M9({ctx:t.ctx,options:e,chart:t});Ea.configure(t,n,e),Ea.addBox(t,n),t.titleBlock=n}var I9={id:"title",_element:M9,start(t,e,n){uUe(t,n)},stop(t){const e=t.titleBlock;Ea.removeBox(t,e),delete t.titleBlock},beforeUpdate(t,e,n){const r=t.titleBlock;Ea.configure(t,r,n),r.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const gw={average(t){if(!t.length)return!1;let e,n,r=0,i=0,s=0;for(e=0,n=t.length;e<n;++e){const o=t[e].element;if(o&&o.hasValue()){const a=o.tooltipPosition();r+=a.x,i+=a.y,++s}}return{x:r/s,y:i/s}},nearest(t,e){if(!t.length)return!1;let n=e.x,r=e.y,i=Number.POSITIVE_INFINITY,s,o,a;for(s=0,o=t.length;s<o;++s){const l=t[s].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),u=cD(e,c);u<i&&(i=u,a=l)}}if(a){const l=a.tooltipPosition();n=l.x,r=l.y}return{x:n,y:r}}};function rc(t,e){return e&&(br(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function Yc(t){return(typeof t=="string"||t instanceof String)&&t.indexOf(`
`)>-1?t.split(`
`):t}function hUe(t,e){const{element:n,datasetIndex:r,index:i}=e,s=t.getDatasetMeta(r).controller,{label:o,value:a}=s.getLabelAndValue(i);return{chart:t,label:o,parsed:s.getParsed(i),raw:t.data.datasets[r].data[i],formattedValue:a,dataset:s.getDataset(),dataIndex:i,datasetIndex:r,element:n}}function N9(t,e){const n=t.chart.ctx,{body:r,footer:i,title:s}=t,{boxWidth:o,boxHeight:a}=e,l=Di(e.bodyFont),c=Di(e.titleFont),u=Di(e.footerFont),h=s.length,f=i.length,d=r.length,p=Ss(e.padding);let m=p.height,v=0,y=r.reduce((_,S)=>_+S.before.length+S.lines.length+S.after.length,0);if(y+=t.beforeBody.length+t.afterBody.length,h&&(m+=h*c.lineHeight+(h-1)*e.titleSpacing+e.titleMarginBottom),y){const _=e.displayColors?Math.max(a,l.lineHeight):l.lineHeight;m+=d*_+(y-d)*l.lineHeight+(y-1)*e.bodySpacing}f&&(m+=e.footerMarginTop+f*u.lineHeight+(f-1)*e.footerSpacing);let w=0;const x=function(_){v=Math.max(v,n.measureText(_).width+w)};return n.save(),n.font=c.string,tr(t.title,x),n.font=l.string,tr(t.beforeBody.concat(t.afterBody),x),w=e.displayColors?o+2+e.boxPadding:0,tr(r,_=>{tr(_.before,x),tr(_.lines,x),tr(_.after,x)}),w=0,n.font=u.string,tr(t.footer,x),n.restore(),v+=p.width,{width:v,height:m}}function fUe(t,e){const{y:n,height:r}=e;return n<r/2?"top":n>t.height-r/2?"bottom":"center"}function dUe(t,e,n,r){const{x:i,width:s}=r,o=n.caretSize+n.caretPadding;if(t==="left"&&i+s+o>e.width||t==="right"&&i-s-o<0)return!0}function pUe(t,e,n,r){const{x:i,width:s}=n,{width:o,chartArea:{left:a,right:l}}=t;let c="center";return r==="center"?c=i<=(a+l)/2?"left":"right":i<=s/2?c="left":i>=o-s/2&&(c="right"),dUe(c,t,e,n)&&(c="center"),c}function $9(t,e,n){const r=n.yAlign||e.yAlign||fUe(t,n);return{xAlign:n.xAlign||e.xAlign||pUe(t,e,n,r),yAlign:r}}function mUe(t,e){let{x:n,width:r}=t;return e==="right"?n-=r:e==="center"&&(n-=r/2),n}function gUe(t,e,n){let{y:r,height:i}=t;return e==="top"?r+=n:e==="bottom"?r-=i+n:r-=i/2,r}function R9(t,e,n,r){const{caretSize:i,caretPadding:s,cornerRadius:o}=t,{xAlign:a,yAlign:l}=n,c=i+s,{topLeft:u,topRight:h,bottomLeft:f,bottomRight:d}=Jf(o);let p=mUe(e,a);const m=gUe(e,l,c);return l==="center"?a==="left"?p+=c:a==="right"&&(p-=c):a==="left"?p-=Math.max(u,f)+i:a==="right"&&(p+=Math.max(h,d)+i),{x:_s(p,0,r.width-e.width),y:_s(m,0,r.height-e.height)}}function _T(t,e,n){const r=Ss(n.padding);return e==="center"?t.x+t.width/2:e==="right"?t.x+t.width-r.right:t.x+r.left}function D9(t){return rc([],Yc(t))}function vUe(t,e,n){return yh(t,{tooltip:e,tooltipItems:n,type:"tooltip"})}function P9(t,e){const n=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return n?t.override(n):t}class UD extends ka{constructor(e){super();this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart||e._chart,this._chart=this.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const n=this.chart,r=this.options.setContext(this.getContext()),i=r.enabled&&n.options.animation&&r.animations,s=new Nj(this.chart,i);return i._cacheable&&(this._cachedAnimations=Object.freeze(s)),s}getContext(){return this.$context||(this.$context=vUe(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,n){const{callbacks:r}=n,i=r.beforeTitle.apply(this,[e]),s=r.title.apply(this,[e]),o=r.afterTitle.apply(this,[e]);let a=[];return a=rc(a,Yc(i)),a=rc(a,Yc(s)),a=rc(a,Yc(o)),a}getBeforeBody(e,n){return D9(n.callbacks.beforeBody.apply(this,[e]))}getBody(e,n){const{callbacks:r}=n,i=[];return tr(e,s=>{const o={before:[],lines:[],after:[]},a=P9(r,s);rc(o.before,Yc(a.beforeLabel.call(this,s))),rc(o.lines,a.label.call(this,s)),rc(o.after,Yc(a.afterLabel.call(this,s))),i.push(o)}),i}getAfterBody(e,n){return D9(n.callbacks.afterBody.apply(this,[e]))}getFooter(e,n){const{callbacks:r}=n,i=r.beforeFooter.apply(this,[e]),s=r.footer.apply(this,[e]),o=r.afterFooter.apply(this,[e]);let a=[];return a=rc(a,Yc(i)),a=rc(a,Yc(s)),a=rc(a,Yc(o)),a}_createItems(e){const n=this._active,r=this.chart.data,i=[],s=[],o=[];let a=[],l,c;for(l=0,c=n.length;l<c;++l)a.push(hUe(this.chart,n[l]));return e.filter&&(a=a.filter((u,h,f)=>e.filter(u,h,f,r))),e.itemSort&&(a=a.sort((u,h)=>e.itemSort(u,h,r))),tr(a,u=>{const h=P9(e.callbacks,u);i.push(h.labelColor.call(this,u)),s.push(h.labelPointStyle.call(this,u)),o.push(h.labelTextColor.call(this,u))}),this.labelColors=i,this.labelPointStyles=s,this.labelTextColors=o,this.dataPoints=a,a}update(e,n){const r=this.options.setContext(this.getContext()),i=this._active;let s,o=[];if(!i.length)this.opacity!==0&&(s={opacity:0});else{const a=gw[r.position].call(this,i,this._eventPosition);o=this._createItems(r),this.title=this.getTitle(o,r),this.beforeBody=this.getBeforeBody(o,r),this.body=this.getBody(o,r),this.afterBody=this.getAfterBody(o,r),this.footer=this.getFooter(o,r);const l=this._size=N9(this,r),c=Object.assign({},a,l),u=$9(this.chart,r,c),h=R9(r,c,u,this.chart);this.xAlign=u.xAlign,this.yAlign=u.yAlign,s={opacity:1,x:h.x,y:h.y,width:l.width,height:l.height,caretX:a.x,caretY:a.y}}this._tooltipItems=o,this.$context=void 0,s&&this._resolveAnimations().update(this,s),e&&r.external&&r.external.call(this,{chart:this.chart,tooltip:this,replay:n})}drawCaret(e,n,r,i){const s=this.getCaretPosition(e,r,i);n.lineTo(s.x1,s.y1),n.lineTo(s.x2,s.y2),n.lineTo(s.x3,s.y3)}getCaretPosition(e,n,r){const{xAlign:i,yAlign:s}=this,{caretSize:o,cornerRadius:a}=r,{topLeft:l,topRight:c,bottomLeft:u,bottomRight:h}=Jf(a),{x:f,y:d}=e,{width:p,height:m}=n;let v,y,w,x,_,S;return s==="center"?(_=d+m/2,i==="left"?(v=f,y=v-o,x=_+o,S=_-o):(v=f+p,y=v+o,x=_-o,S=_+o),w=v):(i==="left"?y=f+Math.max(l,u)+o:i==="right"?y=f+p-Math.max(c,h)-o:y=this.caretX,s==="top"?(x=d,_=x-o,v=y-o,w=y+o):(x=d+m,_=x+o,v=y+o,w=y-o),S=x),{x1:v,x2:y,x3:w,y1:x,y2:_,y3:S}}drawTitle(e,n,r){const i=this.title,s=i.length;let o,a,l;if(s){const c=Cg(r.rtl,this.x,this.width);for(e.x=_T(this,r.titleAlign,r),n.textAlign=c.textAlign(r.titleAlign),n.textBaseline="middle",o=Di(r.titleFont),a=r.titleSpacing,n.fillStyle=r.titleColor,n.font=o.string,l=0;l<s;++l)n.fillText(i[l],c.x(e.x),e.y+o.lineHeight/2),e.y+=o.lineHeight+a,l+1===s&&(e.y+=r.titleMarginBottom-a)}}_drawColorBox(e,n,r,i,s){const o=this.labelColors[r],a=this.labelPointStyles[r],{boxHeight:l,boxWidth:c,boxPadding:u}=s,h=Di(s.bodyFont),f=_T(this,"left",s),d=i.x(f),p=l<h.lineHeight?(h.lineHeight-l)/2:0,m=n.y+p;if(s.usePointStyle){const v={radius:Math.min(c,l)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},y=i.leftForLtr(d,c)+c/2,w=m+l/2;e.strokeStyle=s.multiKeyBackground,e.fillStyle=s.multiKeyBackground,Q2(e,v,y,w),e.strokeStyle=o.borderColor,e.fillStyle=o.backgroundColor,Q2(e,v,y,w)}else{e.lineWidth=o.borderWidth||1,e.strokeStyle=o.borderColor,e.setLineDash(o.borderDash||[]),e.lineDashOffset=o.borderDashOffset||0;const v=i.leftForLtr(d,c-u),y=i.leftForLtr(i.xPlus(d,1),c-u-2),w=Jf(o.borderRadius);Object.values(w).some(x=>x!==0)?(e.beginPath(),e.fillStyle=s.multiKeyBackground,Zf(e,{x:v,y:m,w:c,h:l,radius:w}),e.fill(),e.stroke(),e.fillStyle=o.backgroundColor,e.beginPath(),Zf(e,{x:y,y:m+1,w:c-2,h:l-2,radius:w}),e.fill()):(e.fillStyle=s.multiKeyBackground,e.fillRect(v,m,c,l),e.strokeRect(v,m,c,l),e.fillStyle=o.backgroundColor,e.fillRect(y,m+1,c-2,l-2))}e.fillStyle=this.labelTextColors[r]}drawBody(e,n,r){const{body:i}=this,{bodySpacing:s,bodyAlign:o,displayColors:a,boxHeight:l,boxWidth:c,boxPadding:u}=r,h=Di(r.bodyFont);let f=h.lineHeight,d=0;const p=Cg(r.rtl,this.x,this.width),m=function(k){n.fillText(k,p.x(e.x+d),e.y+f/2),e.y+=f+s},v=p.textAlign(o);let y,w,x,_,S,T,E;for(n.textAlign=o,n.textBaseline="middle",n.font=h.string,e.x=_T(this,v,r),n.fillStyle=r.bodyColor,tr(this.beforeBody,m),d=a&&v!=="right"?o==="center"?c/2+u:c+2+u:0,_=0,T=i.length;_<T;++_){for(y=i[_],w=this.labelTextColors[_],n.fillStyle=w,tr(y.before,m),x=y.lines,a&&x.length&&(this._drawColorBox(n,e,_,p,r),f=Math.max(h.lineHeight,l)),S=0,E=x.length;S<E;++S)m(x[S]),f=h.lineHeight;tr(y.after,m)}d=0,f=h.lineHeight,tr(this.afterBody,m),e.y-=s}drawFooter(e,n,r){const i=this.footer,s=i.length;let o,a;if(s){const l=Cg(r.rtl,this.x,this.width);for(e.x=_T(this,r.footerAlign,r),e.y+=r.footerMarginTop,n.textAlign=l.textAlign(r.footerAlign),n.textBaseline="middle",o=Di(r.footerFont),n.fillStyle=r.footerColor,n.font=o.string,a=0;a<s;++a)n.fillText(i[a],l.x(e.x),e.y+o.lineHeight/2),e.y+=o.lineHeight+r.footerSpacing}}drawBackground(e,n,r,i){const{xAlign:s,yAlign:o}=this,{x:a,y:l}=e,{width:c,height:u}=r,{topLeft:h,topRight:f,bottomLeft:d,bottomRight:p}=Jf(i.cornerRadius);n.fillStyle=i.backgroundColor,n.strokeStyle=i.borderColor,n.lineWidth=i.borderWidth,n.beginPath(),n.moveTo(a+h,l),o==="top"&&this.drawCaret(e,n,r,i),n.lineTo(a+c-f,l),n.quadraticCurveTo(a+c,l,a+c,l+f),o==="center"&&s==="right"&&this.drawCaret(e,n,r,i),n.lineTo(a+c,l+u-p),n.quadraticCurveTo(a+c,l+u,a+c-p,l+u),o==="bottom"&&this.drawCaret(e,n,r,i),n.lineTo(a+d,l+u),n.quadraticCurveTo(a,l+u,a,l+u-d),o==="center"&&s==="left"&&this.drawCaret(e,n,r,i),n.lineTo(a,l+h),n.quadraticCurveTo(a,l,a+h,l),n.closePath(),n.fill(),i.borderWidth>0&&n.stroke()}_updateAnimationTarget(e){const n=this.chart,r=this.$animations,i=r&&r.x,s=r&&r.y;if(i||s){const o=gw[e.position].call(this,this._active,this._eventPosition);if(!o)return;const a=this._size=N9(this,e),l=Object.assign({},o,this._size),c=$9(n,e,l),u=R9(e,l,c,n);(i._to!==u.x||s._to!==u.y)&&(this.xAlign=c.xAlign,this.yAlign=c.yAlign,this.width=a.width,this.height=a.height,this.caretX=o.x,this.caretY=o.y,this._resolveAnimations().update(this,u))}}draw(e){const n=this.options.setContext(this.getContext());let r=this.opacity;if(!r)return;this._updateAnimationTarget(n);const i={width:this.width,height:this.height},s={x:this.x,y:this.y};r=Math.abs(r)<.001?0:r;const o=Ss(n.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;n.enabled&&a&&(e.save(),e.globalAlpha=r,this.drawBackground(s,e,i,n),_j(e,n.textDirection),s.y+=o.top,this.drawTitle(s,e,n),this.drawBody(s,e,n),this.drawFooter(s,e,n),Sj(e,n.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,n){const r=this._active,i=e.map(({datasetIndex:a,index:l})=>{const c=this.chart.getDatasetMeta(a);if(!c)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:c.data[l],index:l}}),s=!W2(r,i),o=this._positionChanged(i,n);(s||o)&&(this._active=i,this._eventPosition=n,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,n,r=!0){if(n&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const i=this.options,s=this._active||[],o=this._getActiveElements(e,s,n,r),a=this._positionChanged(o,e),l=n||!W2(o,s)||a;return l&&(this._active=o,(i.enabled||i.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,n))),l}_getActiveElements(e,n,r,i){const s=this.options;if(e.type==="mouseout")return[];if(!i)return n;const o=this.chart.getElementsAtEventForMode(e,s.mode,s,r);return s.reverse&&o.reverse(),o}_positionChanged(e,n){const{caretX:r,caretY:i,options:s}=this,o=gw[s.position].call(this,e,n);return o!==!1&&(r!==o.x||i!==o.y)}}UD.positioners=gw;var O9={id:"tooltip",_element:UD,positioners:gw,afterInit(t,e,n){n&&(t.tooltip=new UD({chart:t,options:n}))},beforeUpdate(t,e,n){t.tooltip&&t.tooltip.initialize(n)},reset(t,e,n){t.tooltip&&t.tooltip.initialize(n)},afterDraw(t){const e=t.tooltip,n={tooltip:e};t.notifyPlugins("beforeTooltipDraw",n)!==!1&&(e&&e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",n))},afterEvent(t,e){if(t.tooltip){const n=e.replay;t.tooltip.handleEvent(e.event,n,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,e)=>e.bodyFont.size,boxWidth:(t,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:{beforeTitle:jc,title(t){if(t.length>0){const e=t[0],n=e.chart.data.labels,r=n?n.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(r>0&&e.dataIndex<r)return n[e.dataIndex]}return""},afterTitle:jc,beforeBody:jc,beforeLabel:jc,label(t){if(this&&this.options&&this.options.mode==="dataset")return t.label+": "+t.formattedValue||t.formattedValue;let e=t.dataset.label||"";e&&(e+=": ");const n=t.formattedValue;return er(n)||(e+=n),e},labelColor(t){const n=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:n.borderColor,backgroundColor:n.backgroundColor,borderWidth:n.borderWidth,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){const n=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:n.pointStyle,rotation:n.rotation}},afterLabel:jc,afterBody:jc,beforeFooter:jc,footer:jc,afterFooter:jc}},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>t!=="filter"&&t!=="itemSort"&&t!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const yUe=(t,e,n,r)=>(typeof e=="string"?(n=t.push(e)-1,r.unshift({index:n,label:e})):isNaN(e)&&(n=null),n);function bUe(t,e,n,r){const i=t.indexOf(e);if(i===-1)return yUe(t,e,n,r);const s=t.lastIndexOf(e);return i!==s?n:i}const wUe=(t,e)=>t===null?null:_s(Math.round(t),0,e);class vw extends rd{constructor(e){super(e);this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const n=this._addedLabels;if(n.length){const r=this.getLabels();for(const{index:i,label:s}of n)r[i]===s&&r.splice(i,1);this._addedLabels=[]}super.init(e)}parse(e,n){if(er(e))return null;const r=this.getLabels();return n=isFinite(n)&&r[n]===e?n:bUe(r,e,fn(n,e),this._addedLabels),wUe(n,r.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:n}=this.getUserBounds();let{min:r,max:i}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(r=0),n||(i=this.getLabels().length-1)),this.min=r,this.max=i}buildTicks(){const e=this.min,n=this.max,r=this.options.offset,i=[];let s=this.getLabels();s=e===0&&n===s.length-1?s:s.slice(e,n+1),this._valueRange=Math.max(s.length-(r?0:1),1),this._startValue=this.min-(r?.5:0);for(let o=e;o<=n;o++)i.push({value:o});return i}getLabelForValue(e){const n=this.getLabels();return e>=0&&e<n.length?n[e]:e}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const n=this.ticks;return e<0||e>n.length-1?null:this.getPixelForValue(n[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}vw.id="category";vw.defaults={ticks:{callback:vw.prototype.getLabelForValue}};function xUe(t,e){const n=[],r=1e-14,{bounds:i,step:s,min:o,max:a,precision:l,count:c,maxTicks:u,maxDigits:h,includeBounds:f}=t,d=s||1,p=u-1,{min:m,max:v}=e,y=!er(o),w=!er(a),x=!er(c),_=(v-m)/(h+1);let S=W8((v-m)/p/d)*d,T,E,k,A;if(S<r&&!y&&!w)return[{value:m},{value:v}];A=Math.ceil(v/S)-Math.floor(m/S),A>p&&(S=W8(A*S/p/d)*d),er(l)||(T=Math.pow(10,l),S=Math.ceil(S*T)/T),i==="ticks"?(E=Math.floor(m/S)*S,k=Math.ceil(v/S)*S):(E=m,k=v),y&&w&&s&&_Be((a-o)/s,S/1e3)?(A=Math.round(Math.min((a-o)/S,u)),S=(a-o)/A,E=o,k=a):x?(E=y?o:E,k=w?a:k,A=c-1,S=(k-E)/A):(A=(k-E)/S,Qb(A,Math.round(A),S/1e3)?A=Math.round(A):A=Math.ceil(A));const M=Math.max(H8(S),H8(E));T=Math.pow(10,er(l)?M:l),E=Math.round(E*T)/T,k=Math.round(k*T)/T;let D=0;for(y&&(f&&E!==o?(n.push({value:o}),E<o&&D++,Qb(Math.round((E+D*S)*T)/T,o,F9(o,_,t))&&D++):E<o&&D++);D<A;++D)n.push({value:Math.round((E+D*S)*T)/T});return w&&f&&k!==a?n.length&&Qb(n[n.length-1].value,a,F9(a,_,t))?n[n.length-1].value=a:n.push({value:a}):(!w||k===a)&&n.push({value:k}),n}function F9(t,e,{horizontal:n,minRotation:r}){const i=cl(r),s=(n?Math.sin(i):Math.cos(i))||.001,o=.75*e*(""+t).length;return Math.min(e/s,o)}class ST extends rd{constructor(e){super(e);this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,n){return er(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:n,maxDefined:r}=this.getUserBounds();let{min:i,max:s}=this;const o=l=>i=n?i:l,a=l=>s=r?s:l;if(e){const l=nc(i),c=nc(s);l<0&&c<0?a(0):l>0&&c>0&&o(0)}if(i===s){let l=1;(s>=Number.MAX_SAFE_INTEGER||i<=Number.MIN_SAFE_INTEGER)&&(l=Math.abs(s*.05)),a(s+l),e||o(i-l)}this.min=i,this.max=s}getTickLimit(){const e=this.options.ticks;let{maxTicksLimit:n,stepSize:r}=e,i;return r?(i=Math.ceil(this.max/r)-Math.floor(this.min/r)+1,i>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${r} would result generating up to ${i} ticks. Limiting to 1000.`),i=1e3)):(i=this.computeTickLimit(),n=n||11),n&&(i=Math.min(n,i)),i}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,n=e.ticks;let r=this.getTickLimit();r=Math.max(2,r);const i={maxTicks:r,bounds:e.bounds,min:e.min,max:e.max,precision:n.precision,step:n.stepSize,count:n.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:n.minRotation||0,includeBounds:n.includeBounds!==!1},s=this._range||this,o=xUe(i,s);return e.bounds==="ticks"&&G8(o,this,"value"),e.reverse?(o.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),o}configure(){const e=this.ticks;let n=this.min,r=this.max;if(super.configure(),this.options.offset&&e.length){const i=(r-n)/Math.max(e.length-1,1)/2;n-=i,r+=i}this._startValue=n,this._endValue=r,this._valueRange=r-n}getLabelForValue(e){return ow(e,this.chart.options.locale,this.options.ticks.format)}}class WD extends ST{determineDataLimits(){const{min:e,max:n}=this.getMinMax(!0);this.min=ai(e)?e:0,this.max=ai(n)?n:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),n=e?this.width:this.height,r=cl(this.options.ticks.minRotation),i=(e?Math.sin(r):Math.cos(r))||.001,s=this._resolveTickFontOptions(0);return Math.ceil(n/Math.min(40,s.lineHeight/i))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}WD.id="linear";WD.defaults={ticks:{callback:pT.formatters.numeric}};function L9(t){return t/Math.pow(10,Math.floor(Ca(t)))===1}function _Ue(t,e){const n=Math.floor(Ca(e.max)),r=Math.ceil(e.max/Math.pow(10,n)),i=[];let s=_a(t.min,Math.pow(10,Math.floor(Ca(e.min)))),o=Math.floor(Ca(s)),a=Math.floor(s/Math.pow(10,o)),l=o<0?Math.pow(10,Math.abs(o)):1;do i.push({value:s,major:L9(s)}),++a,a===10&&(a=1,++o,l=o>=0?1:l),s=Math.round(a*Math.pow(10,o)*l)/l;while(o<n||o===n&&a<r);const c=_a(t.max,s);return i.push({value:c,major:L9(s)}),i}class GD extends rd{constructor(e){super(e);this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,n){const r=ST.prototype.parse.apply(this,[e,n]);if(r===0){this._zero=!0;return}return ai(r)&&r>0?r:null}determineDataLimits(){const{min:e,max:n}=this.getMinMax(!0);this.min=ai(e)?Math.max(0,e):null,this.max=ai(n)?Math.max(0,n):null,this.options.beginAtZero&&(this._zero=!0),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:e,maxDefined:n}=this.getUserBounds();let r=this.min,i=this.max;const s=l=>r=e?r:l,o=l=>i=n?i:l,a=(l,c)=>Math.pow(10,Math.floor(Ca(l))+c);r===i&&(r<=0?(s(1),o(10)):(s(a(r,-1)),o(a(i,1)))),r<=0&&s(a(i,-1)),i<=0&&o(a(r,1)),this._zero&&this.min!==this._suggestedMin&&r===a(this.min,0)&&s(a(r,-1)),this.min=r,this.max=i}buildTicks(){const e=this.options,n={min:this._userMin,max:this._userMax},r=_Ue(n,this);return e.bounds==="ticks"&&G8(r,this,"value"),e.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}getLabelForValue(e){return e===void 0?"0":ow(e,this.chart.options.locale,this.options.ticks.format)}configure(){const e=this.min;super.configure(),this._startValue=Ca(e),this._valueRange=Ca(this.max)-Ca(e)}getPixelForValue(e){return(e===void 0||e===0)&&(e=this.min),e===null||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(Ca(e)-this._startValue)/this._valueRange)}getValueForPixel(e){const n=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+n*this._valueRange)}}GD.id="logarithmic";GD.defaults={ticks:{callback:pT.formatters.logarithmic,major:{enabled:!0}}};function HD(t){const e=t.ticks;if(e.display&&t.display){const n=Ss(e.backdropPadding);return fn(e.font&&e.font.size,On.font.size)+n.height}return 0}function SUe(t,e,n){return n=br(n)?n:[n],{w:jBe(t,e.string,n),h:n.length*e.lineHeight}}function B9(t,e,n,r,i){return t===r||t===i?{start:e-n/2,end:e+n/2}:t<r||t>i?{start:e-n,end:e}:{start:e,end:e+n}}function CUe(t){const e={l:t.left+t._padding.left,r:t.right-t._padding.right,t:t.top+t._padding.top,b:t.bottom-t._padding.bottom},n=Object.assign({},e),r=[],i=[],s=t._pointLabels.length,o=t.options.pointLabels,a=o.centerPointLabels?Pr/s:0;for(let l=0;l<s;l++){const c=o.setContext(t.getPointLabelContext(l));i[l]=c.padding;const u=t.getPointPosition(l,t.drawingArea+i[l],a),h=Di(c.font),f=SUe(t.ctx,h,t._pointLabels[l]);r[l]=f;const d=Bo(t.getIndexAngle(l)+a),p=Math.round(lD(d)),m=B9(p,u.x,f.w,0,180),v=B9(p,u.y,f.h,90,270);TUe(n,e,d,m,v)}t.setCenterPoint(e.l-n.l,n.r-e.r,e.t-n.t,n.b-e.b),t._pointLabelItems=EUe(t,r,i)}function TUe(t,e,n,r,i){const s=Math.abs(Math.sin(n)),o=Math.abs(Math.cos(n));let a=0,l=0;r.start<e.l?(a=(e.l-r.start)/s,t.l=Math.min(t.l,e.l-a)):r.end>e.r&&(a=(r.end-e.r)/s,t.r=Math.max(t.r,e.r+a)),i.start<e.t?(l=(e.t-i.start)/o,t.t=Math.min(t.t,e.t-l)):i.end>e.b&&(l=(i.end-e.b)/o,t.b=Math.max(t.b,e.b+l))}function EUe(t,e,n){const r=[],i=t._pointLabels.length,s=t.options,o=HD(s)/2,a=t.drawingArea,l=s.pointLabels.centerPointLabels?Pr/i:0;for(let c=0;c<i;c++){const u=t.getPointPosition(c,a+o+n[c],l),h=Math.round(lD(Bo(u.angle+qr))),f=e[c],d=MUe(u.y,f.h,h),p=kUe(h),m=AUe(u.x,f.w,p);r.push({x:u.x,y:d,textAlign:p,left:m,top:d,right:m+f.w,bottom:d+f.h})}return r}function kUe(t){return t===0||t===180?"center":t<180?"left":"right"}function AUe(t,e,n){return n==="right"?t-=e:n==="center"&&(t-=e/2),t}function MUe(t,e,n){return n===90||n===270?t-=e/2:(n>270||n<90)&&(t-=e),t}function IUe(t,e){const{ctx:n,options:{pointLabels:r}}=t;for(let i=e-1;i>=0;i--){const s=r.setContext(t.getPointLabelContext(i)),o=Di(s.font),{x:a,y:l,textAlign:c,left:u,top:h,right:f,bottom:d}=t._pointLabelItems[i],{backdropColor:p}=s;if(!er(p)){const m=Ss(s.backdropPadding);n.fillStyle=p,n.fillRect(u-m.left,h-m.top,f-u+m.width,d-h+m.height)}Yf(n,t._pointLabels[i],a,l+o.lineHeight/2,o,{color:s.color,textAlign:c,textBaseline:"middle"})}}function z9(t,e,n,r){const{ctx:i}=t;if(n)i.arc(t.xCenter,t.yCenter,e,0,dr);else{let s=t.getPointPosition(0,e);i.moveTo(s.x,s.y);for(let o=1;o<r;o++)s=t.getPointPosition(o,e),i.lineTo(s.x,s.y)}}function NUe(t,e,n,r){const i=t.ctx,s=e.circular,{color:o,lineWidth:a}=e;!s&&!r||!o||!a||n<0||(i.save(),i.strokeStyle=o,i.lineWidth=a,i.setLineDash(e.borderDash),i.lineDashOffset=e.borderDashOffset,i.beginPath(),z9(t,n,s,r),i.closePath(),i.stroke(),i.restore())}function $Ue(t,e,n){return yh(t,{label:n,index:e,type:"pointLabel"})}class yw extends ST{constructor(e){super(e);this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const e=this._padding=Ss(HD(this.options)/2),n=this.width=this.maxWidth-e.width,r=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+n/2+e.left),this.yCenter=Math.floor(this.top+r/2+e.top),this.drawingArea=Math.floor(Math.min(n,r)/2)}determineDataLimits(){const{min:e,max:n}=this.getMinMax(!1);this.min=ai(e)&&!isNaN(e)?e:0,this.max=ai(n)&&!isNaN(n)?n:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/HD(this.options))}generateTickLabels(e){ST.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((n,r)=>{const i=wr(this.options.pointLabels.callback,[n,r],this);return i||i===0?i:""}).filter((n,r)=>this.chart.getDataVisibility(r))}fit(){const e=this.options;e.display&&e.pointLabels.display?CUe(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,n,r,i){this.xCenter+=Math.floor((e-n)/2),this.yCenter+=Math.floor((r-i)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,n,r,i))}getIndexAngle(e){const n=dr/(this._pointLabels.length||1),r=this.options.startAngle||0;return Bo(e*n+cl(r))}getDistanceFromCenterForValue(e){if(er(e))return NaN;const n=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*n:(e-this.min)*n}getValueForDistanceFromCenter(e){if(er(e))return NaN;const n=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-n:this.min+n}getPointLabelContext(e){const n=this._pointLabels||[];if(e>=0&&e<n.length){const r=n[e];return $Ue(this.getContext(),e,r)}}getPointPosition(e,n,r=0){const i=this.getIndexAngle(e)-qr+r;return{x:Math.cos(i)*n+this.xCenter,y:Math.sin(i)*n+this.yCenter,angle:i}}getPointPositionForValue(e,n){return this.getPointPosition(e,this.getDistanceFromCenterForValue(n))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){const{left:n,top:r,right:i,bottom:s}=this._pointLabelItems[e];return{left:n,top:r,right:i,bottom:s}}drawBackground(){const{backgroundColor:e,grid:{circular:n}}=this.options;if(e){const r=this.ctx;r.save(),r.beginPath(),z9(this,this.getDistanceFromCenterForValue(this._endValue),n,this._pointLabels.length),r.closePath(),r.fillStyle=e,r.fill(),r.restore()}}drawGrid(){const e=this.ctx,n=this.options,{angleLines:r,grid:i}=n,s=this._pointLabels.length;let o,a,l;if(n.pointLabels.display&&IUe(this,s),i.display&&this.ticks.forEach((c,u)=>{if(u!==0){a=this.getDistanceFromCenterForValue(c.value);const h=i.setContext(this.getContext(u-1));NUe(this,h,a,s)}}),r.display){for(e.save(),o=s-1;o>=0;o--){const c=r.setContext(this.getPointLabelContext(o)),{color:u,lineWidth:h}=c;!h||!u||(e.lineWidth=h,e.strokeStyle=u,e.setLineDash(c.borderDash),e.lineDashOffset=c.borderDashOffset,a=this.getDistanceFromCenterForValue(n.ticks.reverse?this.min:this.max),l=this.getPointPosition(o,a),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(l.x,l.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){const e=this.ctx,n=this.options,r=n.ticks;if(!r.display)return;const i=this.getIndexAngle(0);let s,o;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(i),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((a,l)=>{if(l===0&&!n.reverse)return;const c=r.setContext(this.getContext(l)),u=Di(c.font);if(s=this.getDistanceFromCenterForValue(this.ticks[l].value),c.showLabelBackdrop){e.font=u.string,o=e.measureText(a.label).width,e.fillStyle=c.backdropColor;const h=Ss(c.backdropPadding);e.fillRect(-o/2-h.left,-s-u.size/2-h.top,o+h.width,u.size+h.height)}Yf(e,a.label,0,-s,u,{color:c.color})}),e.restore()}drawTitle(){}}yw.id="radialLinear";yw.defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:pT.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}};yw.defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};yw.descriptors={angleLines:{_fallback:"grid"}};const CT={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},ho=Object.keys(CT);function RUe(t,e){return t-e}function V9(t,e){if(er(e))return null;const n=t._adapter,{parser:r,round:i,isoWeekday:s}=t._parseOpts;let o=e;return typeof r=="function"&&(o=r(o)),ai(o)||(o=typeof r=="string"?n.parse(o,r):n.parse(o)),o===null?null:(i&&(o=i==="week"&&(Jb(s)||s===!0)?n.startOf(o,"isoWeek",s):n.startOf(o,i)),+o)}function U9(t,e,n,r){const i=ho.length;for(let s=ho.indexOf(t);s<i-1;++s){const o=CT[ho[s]],a=o.steps?o.steps:Number.MAX_SAFE_INTEGER;if(o.common&&Math.ceil((n-e)/(a*o.size))<=r)return ho[s]}return ho[i-1]}function DUe(t,e,n,r,i){for(let s=ho.length-1;s>=ho.indexOf(n);s--){const o=ho[s];if(CT[o].common&&t._adapter.diff(i,r,o)>=e-1)return o}return ho[n?ho.indexOf(n):0]}function PUe(t){for(let e=ho.indexOf(t)+1,n=ho.length;e<n;++e)if(CT[ho[e]].common)return ho[e]}function W9(t,e,n){if(!n)t[e]=!0;else if(n.length){const{lo:r,hi:i}=bD(n,e),s=n[r]>=e?n[r]:n[i];t[s]=!0}}function OUe(t,e,n,r){const i=t._adapter,s=+i.startOf(e[0].value,r),o=e[e.length-1].value;let a,l;for(a=s;a<=o;a=+i.add(a,1,r))l=n[a],l>=0&&(e[l].major=!0);return e}function G9(t,e,n){const r=[],i={},s=e.length;let o,a;for(o=0;o<s;++o)a=e[o],i[a]=o,r.push({value:a,major:!1});return s===0||!n?r:OUe(t,r,i,n)}class bw extends rd{constructor(e){super(e);this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,n){const r=e.time||(e.time={}),i=this._adapter=new m4e._date(e.adapters.date);Yb(r.displayFormats,i.formats()),this._parseOpts={parser:r.parser,round:r.round,isoWeekday:r.isoWeekday},super.init(e),this._normalized=n.normalized}parse(e,n){return e===void 0?null:V9(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,n=this._adapter,r=e.time.unit||"day";let{min:i,max:s,minDefined:o,maxDefined:a}=this.getUserBounds();function l(c){!o&&!isNaN(c.min)&&(i=Math.min(i,c.min)),!a&&!isNaN(c.max)&&(s=Math.max(s,c.max))}(!o||!a)&&(l(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&l(this.getMinMax(!1))),i=ai(i)&&!isNaN(i)?i:+n.startOf(Date.now(),r),s=ai(s)&&!isNaN(s)?s:+n.endOf(Date.now(),r)+1,this.min=Math.min(i,s-1),this.max=Math.max(i+1,s)}_getLabelBounds(){const e=this.getLabelTimestamps();let n=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;return e.length&&(n=e[0],r=e[e.length-1]),{min:n,max:r}}buildTicks(){const e=this.options,n=e.time,r=e.ticks,i=r.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&i.length&&(this.min=this._userMin||i[0],this.max=this._userMax||i[i.length-1]);const s=this.min,o=this.max,a=rze(i,s,o);return this._unit=n.unit||(r.autoSkip?U9(n.minUnit,this.min,this.max,this._getLabelCapacity(s)):DUe(this,a.length,n.minUnit,this.min,this.max)),this._majorUnit=!r.major.enabled||this._unit==="year"?void 0:PUe(this._unit),this.initOffsets(i),e.reverse&&a.reverse(),G9(this,a,this._majorUnit)}initOffsets(e){let n=0,r=0,i,s;this.options.offset&&e.length&&(i=this.getDecimalForValue(e[0]),e.length===1?n=1-i:n=(this.getDecimalForValue(e[1])-i)/2,s=this.getDecimalForValue(e[e.length-1]),e.length===1?r=s:r=(s-this.getDecimalForValue(e[e.length-2]))/2);const o=e.length<3?.5:.25;n=_s(n,0,o),r=_s(r,0,o),this._offsets={start:n,end:r,factor:1/(n+1+r)}}_generate(){const e=this._adapter,n=this.min,r=this.max,i=this.options,s=i.time,o=s.unit||U9(s.minUnit,n,r,this._getLabelCapacity(n)),a=fn(s.stepSize,1),l=o==="week"?s.isoWeekday:!1,c=Jb(l)||l===!0,u={};let h=n,f,d;if(c&&(h=+e.startOf(h,"isoWeek",l)),h=+e.startOf(h,c?"day":o),e.diff(r,n,o)>1e5*a)throw new Error(n+" and "+r+" are too far apart with stepSize of "+a+" "+o);const p=i.ticks.source==="data"&&this.getDataTimestamps();for(f=h,d=0;f<r;f=+e.add(f,a,o),d++)W9(u,f,p);return(f===r||i.bounds==="ticks"||d===1)&&W9(u,f,p),Object.keys(u).sort((m,v)=>m-v).map(m=>+m)}getLabelForValue(e){const n=this._adapter,r=this.options.time;return r.tooltipFormat?n.format(e,r.tooltipFormat):n.format(e,r.displayFormats.datetime)}_tickFormatFunction(e,n,r,i){const s=this.options,o=s.time.displayFormats,a=this._unit,l=this._majorUnit,c=a&&o[a],u=l&&o[l],h=r[n],f=l&&u&&h&&h.major,d=this._adapter.format(e,i||(f?u:c)),p=s.ticks.callback;return p?wr(p,[d,n,r],this):d}generateTickLabels(e){let n,r,i;for(n=0,r=e.length;n<r;++n)i=e[n],i.label=this._tickFormatFunction(i.value,n,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const n=this._offsets,r=this.getDecimalForValue(e);return this.getPixelForDecimal((n.start+r)*n.factor)}getValueForPixel(e){const n=this._offsets,r=this.getDecimalForPixel(e)/n.factor-n.end;return this.min+r*(this.max-this.min)}_getLabelSize(e){const n=this.options.ticks,r=this.ctx.measureText(e).width,i=cl(this.isHorizontal()?n.maxRotation:n.minRotation),s=Math.cos(i),o=Math.sin(i),a=this._resolveTickFontOptions(0).size;return{w:r*s+a*o,h:r*o+a*s}}_getLabelCapacity(e){const n=this.options.time,r=n.displayFormats,i=r[n.unit]||r.millisecond,s=this._tickFormatFunction(e,0,G9(this,[e],this._majorUnit),i),o=this._getLabelSize(s),a=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return a>0?a:1}getDataTimestamps(){let e=this._cache.data||[],n,r;if(e.length)return e;const i=this.getMatchingVisibleMetas();if(this._normalized&&i.length)return this._cache.data=i[0].controller.getAllParsedValues(this);for(n=0,r=i.length;n<r;++n)e=e.concat(i[n].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let n,r;if(e.length)return e;const i=this.getLabels();for(n=0,r=i.length;n<r;++n)e.push(V9(this,i[n]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return cj(e.sort(RUe))}}bw.id="time";bw.defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",major:{enabled:!1}}};function TT(t,e,n){let r=0,i=t.length-1,s,o,a,l;n?(e>=t[r].pos&&e<=t[i].pos&&({lo:r,hi:i}=Qf(t,"pos",e)),{pos:s,time:a}=t[r],{pos:o,time:l}=t[i]):(e>=t[r].time&&e<=t[i].time&&({lo:r,hi:i}=Qf(t,"time",e)),{time:s,pos:a}=t[r],{time:o,pos:l}=t[i]);const c=o-s;return c?a+(l-a)*(e-s)/c:a}class jD extends bw{constructor(e){super(e);this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),n=this._table=this.buildLookupTable(e);this._minPos=TT(n,this.min),this._tableRange=TT(n,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:n,max:r}=this,i=[],s=[];let o,a,l,c,u;for(o=0,a=e.length;o<a;++o)c=e[o],c>=n&&c<=r&&i.push(c);if(i.length<2)return[{time:n,pos:0},{time:r,pos:1}];for(o=0,a=i.length;o<a;++o)u=i[o+1],l=i[o-1],c=i[o],Math.round((u+l)/2)!==c&&s.push({time:c,pos:o/(a-1)});return s}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const n=this.getDataTimestamps(),r=this.getLabelTimestamps();return n.length&&r.length?e=this.normalize(n.concat(r)):e=n.length?n:r,e=this._cache.all=e,e}getDecimalForValue(e){return(TT(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const n=this._offsets,r=this.getDecimalForPixel(e)/n.factor-n.end;return TT(this._table,r*this._tableRange+this._minPos,!0)}}jD.id="timeseries";jD.defaults=bw.defaults;var H9=Object.prototype.hasOwnProperty;function j9(t,e,n){for(n of t.keys())if(ww(n,e))return n}function ww(t,e){var n,r,i;if(t===e)return!0;if(t&&e&&(n=t.constructor)===e.constructor){if(n===Date)return t.getTime()===e.getTime();if(n===RegExp)return t.toString()===e.toString();if(n===Array){if((r=t.length)===e.length)for(;r--&&ww(t[r],e[r]););return r===-1}if(n===Set){if(t.size!==e.size)return!1;for(r of t)if(i=r,i&&typeof i=="object"&&(i=j9(e,i),!i)||!e.has(i))return!1;return!0}if(n===Map){if(t.size!==e.size)return!1;for(r of t)if(i=r[0],i&&typeof i=="object"&&(i=j9(e,i),!i)||!ww(r[1],e.get(i)))return!1;return!0}if(n===ArrayBuffer)t=new Uint8Array(t),e=new Uint8Array(e);else if(n===DataView){if((r=t.byteLength)===e.byteLength)for(;r--&&t.getInt8(r)===e.getInt8(r););return r===-1}if(ArrayBuffer.isView(t)){if((r=t.byteLength)===e.byteLength)for(;r--&&t[r]===e[r];);return r===-1}if(!n||typeof t=="object"){r=0;for(n in t)if(H9.call(t,n)&&++r&&!H9.call(e,n)||!(n in e)||!ww(t[n],e[n]))return!1;return Object.keys(e).length===r}}return t!==t&&e!==e}/*!
 * chartjs-chart-matrix v1.1.1
 * https://chartjs-chart-matrix.pages.dev/
 * (c) 2021 Jukka Kurkela
 * Released under the MIT license
 */var FUe="1.1.1";class xw extends ul{initialize(){this.enableOptionSharing=!0,super.initialize()}update(e){const n=this,r=n._cachedMeta;n.updateElements(r.data,0,r.data.length,e)}updateElements(e,n,r,i){const s=this,o=i==="reset",{xScale:a,yScale:l}=s._cachedMeta,c=s.resolveDataElementOptions(n,i),u=s.getSharedOptions(i,e[n],c);for(let h=n;h<n+r;h++){const f=!o&&s.getParsed(h),d=o?a.getBasePixel():a.getPixelForValue(f.x),p=o?l.getBasePixel():l.getPixelForValue(f.y),m=s.resolveDataElementOptions(h,i),{width:v,height:y,anchorX:w,anchorY:x}=m,_={x:LUe(w,d,v),y:BUe(x,p,y),width:v,height:y,options:m};s.updateElement(e[h],h,_,i)}s.updateSharedOptions(u,i)}draw(){const e=this,n=e.getMeta().data||[];let r,i;for(r=0,i=n.length;r<i;++r)n[r].draw(e._ctx)}}function LUe(t,e,n){return t==="left"||t==="start"?e:t==="right"||t==="end"?e-n:e-n/2}function BUe(t,e,n){return t==="top"||t==="start"?e:t==="bottom"||t==="end"?e-n:e-n/2}xw.id="matrix";xw.version=FUe;xw.defaults={dataElementType:"matrix",animations:{numbers:{type:"number",properties:["x","y","width","height"]}},anchorX:"center",anchorY:"center"};xw.overrides={interaction:{mode:"nearest",intersect:!0},scales:{x:{type:"linear",offset:!0},y:{type:"linear",reverse:!0}}};function q9(t,e){const{x:n,y:r,width:i,height:s}=t.getProps(["x","y","width","height"],e);return{left:n,top:r,right:n+i,bottom:r+s}}function ET(t,e,n){return Math.max(Math.min(t,n),e)}function zUe(t,e,n){const r=t.options.borderWidth;let i,s,o,a;return Nn(r)?(i=+r.top||0,s=+r.right||0,o=+r.bottom||0,a=+r.left||0):i=s=o=a=+r||0,{t:ET(i,0,n),r:ET(s,0,e),b:ET(o,0,n),l:ET(a,0,e)}}function VUe(t){const e=q9(t),n=e.right-e.left,r=e.bottom-e.top,i=zUe(t,n/2,r/2);return{outer:{x:e.left,y:e.top,w:n,h:r},inner:{x:e.left+i.l,y:e.top+i.t,w:n-i.l-i.r,h:r-i.t-i.b}}}function qD(t,e,n,r){const i=e===null,s=n===null,o=!t||i&&s?!1:q9(t,r);return o&&(i||e>=o.left&&e<=o.right)&&(s||n>=o.top&&n<=o.bottom)}class XD extends ka{constructor(e){super();this.options=void 0,this.width=void 0,this.height=void 0,e&&Object.assign(this,e)}draw(e){const n=this.options,{inner:r,outer:i}=VUe(this),s=Jf(n.borderRadius);e.save(),i.w!==r.w||i.h!==r.h?(e.beginPath(),Zf(e,{x:i.x,y:i.y,w:i.w,h:i.h,radius:s}),Zf(e,{x:r.x,y:r.y,w:r.w,h:r.h,radius:s}),e.fillStyle=n.backgroundColor,e.fill(),e.fillStyle=n.borderColor,e.fill("evenodd")):(e.beginPath(),Zf(e,{x:r.x,y:r.y,w:r.w,h:r.h,radius:s}),e.fillStyle=n.backgroundColor,e.fill()),e.restore()}inRange(e,n,r){return qD(this,e,n,r)}inXRange(e,n){return qD(this,e,null,n)}inYRange(e,n){return qD(this,null,e,n)}getCenterPoint(e){const{x:n,y:r,width:i,height:s}=this.getProps(["x","y","width","height"],e);return{x:n+i/2,y:r+s/2}}tooltipPosition(){return this.getCenterPoint()}getRange(e){return e==="x"?this.width/2:this.height/2}}XD.id="matrix";XD.defaults={backgroundColor:void 0,borderColor:void 0,borderWidth:void 0,borderRadius:0,anchorX:void 0,anchorY:void 0,width:20,height:20};function hl(t,e){if(e.length<t)throw new TypeError(t+" argument"+(t>1?"s":"")+" required, but only "+e.length+" present")}function Cs(t){hl(1,arguments);var e=Object.prototype.toString.call(t);return t instanceof Date||typeof t=="object"&&e==="[object Date]"?new Date(t.getTime()):typeof t=="number"||e==="[object Number]"?new Date(t):((typeof t=="string"||e==="[object String]")&&typeof console!="undefined"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule"),console.warn(new Error().stack)),new Date(NaN))}function X9(t){var e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return e.setUTCFullYear(t.getFullYear()),t.getTime()-e.getTime()}function kT(t,e){hl(2,arguments);var n=Cs(t),r=Cs(e),i=n.getTime()-r.getTime();return i<0?-1:i>0?1:i}function UUe(t,e){hl(2,arguments);var n=Cs(t),r=Cs(e),i=n.getFullYear()-r.getFullYear(),s=n.getMonth()-r.getMonth();return i*12+s}function WUe(t,e){return hl(2,arguments),Cs(t).getTime()-Cs(e).getTime()}var K9={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(t){return t<0?Math.ceil(t):Math.floor(t)}},GUe="trunc";function HUe(t){return t?K9[t]:K9[GUe]}function jUe(t){hl(1,arguments);var e=Cs(t);return e.setHours(23,59,59,999),e}function qUe(t){hl(1,arguments);var e=Cs(t),n=e.getMonth();return e.setFullYear(e.getFullYear(),n+1,0),e.setHours(23,59,59,999),e}function XUe(t){hl(1,arguments);var e=Cs(t);return jUe(e).getTime()===qUe(e).getTime()}function KUe(t,e){hl(2,arguments);var n=Cs(t),r=Cs(e),i=kT(n,r),s=Math.abs(UUe(n,r)),o;if(s<1)o=0;else{n.getMonth()===1&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-i*s);var a=kT(n,r)===-i;XUe(Cs(t))&&s===1&&kT(t,r)===1&&(a=!1),o=i*(s-Number(a))}return o===0?0:o}function YUe(t,e,n){hl(2,arguments);var r=WUe(t,e)/1e3;return HUe(n==null?void 0:n.roundingMethod)(r)}var ZUe={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},JUe=function(t,e,n){var r,i=ZUe[t];return typeof i=="string"?r=i:e===1?r=i.one:r=i.other.replace("{{count}}",e.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r},QUe=JUe;function KD(t){return function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.width?String(e.width):t.defaultWidth,r=t.formats[n]||t.formats[t.defaultWidth];return r}}var eWe={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},tWe={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},nWe={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},rWe={date:KD({formats:eWe,defaultWidth:"full"}),time:KD({formats:tWe,defaultWidth:"full"}),dateTime:KD({formats:nWe,defaultWidth:"full"})},iWe=rWe,sWe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},oWe=function(t,e,n,r){return sWe[t]},aWe=oWe;function _w(t){return function(e,n){var r=n||{},i=r.context?String(r.context):"standalone",s;if(i==="formatting"&&t.formattingValues){var o=t.defaultFormattingWidth||t.defaultWidth,a=r.width?String(r.width):o;s=t.formattingValues[a]||t.formattingValues[o]}else{var l=t.defaultWidth,c=r.width?String(r.width):t.defaultWidth;s=t.values[c]||t.values[l]}var u=t.argumentCallback?t.argumentCallback(e):e;return s[u]}}var lWe={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},cWe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},uWe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},hWe={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},fWe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},dWe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},pWe=function(t,e){var n=Number(t),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},mWe={ordinalNumber:pWe,era:_w({values:lWe,defaultWidth:"wide"}),quarter:_w({values:cWe,defaultWidth:"wide",argumentCallback:function(t){return t-1}}),month:_w({values:uWe,defaultWidth:"wide"}),day:_w({values:hWe,defaultWidth:"wide"}),dayPeriod:_w({values:fWe,defaultWidth:"wide",formattingValues:dWe,defaultFormattingWidth:"wide"})},gWe=mWe;function Sw(t){return function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=n.width,i=r&&t.matchPatterns[r]||t.matchPatterns[t.defaultMatchWidth],s=e.match(i);if(!s)return null;var o=s[0],a=r&&t.parsePatterns[r]||t.parsePatterns[t.defaultParseWidth],l=Array.isArray(a)?yWe(a,function(h){return h.test(o)}):vWe(a,function(h){return h.test(o)}),c;c=t.valueCallback?t.valueCallback(l):l,c=n.valueCallback?n.valueCallback(c):c;var u=e.slice(o.length);return{value:c,rest:u}}}function vWe(t,e){for(var n in t)if(t.hasOwnProperty(n)&&e(t[n]))return n}function yWe(t,e){for(var n=0;n<t.length;n++)if(e(t[n]))return n}function bWe(t){return function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=e.match(t.matchPattern);if(!r)return null;var i=r[0],s=e.match(t.parsePattern);if(!s)return null;var o=t.valueCallback?t.valueCallback(s[0]):s[0];o=n.valueCallback?n.valueCallback(o):o;var a=e.slice(i.length);return{value:o,rest:a}}}var wWe=/^(\d+)(th|st|nd|rd)?/i,xWe=/\d+/i,_We={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},SWe={any:[/^b/i,/^(a|c)/i]},CWe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},TWe={any:[/1/i,/2/i,/3/i,/4/i]},EWe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},kWe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},AWe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},MWe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},IWe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},NWe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},$We={ordinalNumber:bWe({matchPattern:wWe,parsePattern:xWe,valueCallback:function(t){return parseInt(t,10)}}),era:Sw({matchPatterns:_We,defaultMatchWidth:"wide",parsePatterns:SWe,defaultParseWidth:"any"}),quarter:Sw({matchPatterns:CWe,defaultMatchWidth:"wide",parsePatterns:TWe,defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:Sw({matchPatterns:EWe,defaultMatchWidth:"wide",parsePatterns:kWe,defaultParseWidth:"any"}),day:Sw({matchPatterns:AWe,defaultMatchWidth:"wide",parsePatterns:MWe,defaultParseWidth:"any"}),dayPeriod:Sw({matchPatterns:IWe,defaultMatchWidth:"any",parsePatterns:NWe,defaultParseWidth:"any"})},RWe=$We,DWe={code:"en-US",formatDistance:QUe,formatLong:iWe,formatRelative:aWe,localize:gWe,match:RWe,options:{weekStartsOn:0,firstWeekContainsDate:1}},PWe=DWe;function OWe(t,e){if(t==null)throw new TypeError("assign requires that input parameter not be null or undefined");e=e||{};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}function FWe(t){return OWe({},t)}var Y9=1440,LWe=2520,YD=43200,BWe=86400;function zWe(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};hl(2,arguments);var r=n.locale||PWe;if(!r.formatDistance)throw new RangeError("locale must contain formatDistance property");var i=kT(t,e);if(isNaN(i))throw new RangeError("Invalid time value");var s=FWe(n);s.addSuffix=Boolean(n.addSuffix),s.comparison=i;var o,a;i>0?(o=Cs(e),a=Cs(t)):(o=Cs(t),a=Cs(e));var l=YUe(a,o),c=(X9(a)-X9(o))/1e3,u=Math.round((l-c)/60),h;if(u<2)return n.includeSeconds?l<5?r.formatDistance("lessThanXSeconds",5,s):l<10?r.formatDistance("lessThanXSeconds",10,s):l<20?r.formatDistance("lessThanXSeconds",20,s):l<40?r.formatDistance("halfAMinute",null,s):l<60?r.formatDistance("lessThanXMinutes",1,s):r.formatDistance("xMinutes",1,s):u===0?r.formatDistance("lessThanXMinutes",1,s):r.formatDistance("xMinutes",u,s);if(u<45)return r.formatDistance("xMinutes",u,s);if(u<90)return r.formatDistance("aboutXHours",1,s);if(u<Y9){var f=Math.round(u/60);return r.formatDistance("aboutXHours",f,s)}else{if(u<LWe)return r.formatDistance("xDays",1,s);if(u<YD){var d=Math.round(u/Y9);return r.formatDistance("xDays",d,s)}else if(u<BWe)return h=Math.round(u/YD),r.formatDistance("aboutXMonths",h,s)}if(h=KUe(a,o),h<12){var p=Math.round(u/YD);return r.formatDistance("xMonths",p,s)}else{var m=h%12,v=Math.floor(h/12);return m<3?r.formatDistance("aboutXYears",v,s):m<9?r.formatDistance("overXYears",v,s):r.formatDistance("almostXYears",v+1,s)}}function VWe(t,e){return hl(1,arguments),zWe(t,Date.now(),e)}var Zc={exports:{}};(function(t){(function(e){var n=e.URL||e.webkitURL;function r(c){return n?n.createObjectURL(c):!1}function i(c){return n?n.revokeObjectURL(c):!1}function s(c,u){c&&c.slice(0,5)==="blob:"&&!(u&&u.noRevoke)&&i(c)}function o(c,u,h,f){if(!e.FileReader)return!1;var d=new FileReader;d.onload=function(){u.call(d,this.result)},h&&(d.onabort=d.onerror=function(){h.call(d,this.error)});var p=d[f||"readAsDataURL"];if(p)return p.call(d,c),d}function a(c,u){return Object.prototype.toString.call(u)==="[object "+c+"]"}function l(c,u,h){function f(d,p){var m=document.createElement("img"),v;function y(x,_){if(d===p){d&&d(x,_);return}else if(x instanceof Error){p(x);return}_=_||{},_.image=x,d(_)}function w(x,_){_&&e.console&&console.log(_),x&&a("Blob",x)?(c=x,v=r(c)):(v=c,h&&h.crossOrigin&&(m.crossOrigin=h.crossOrigin)),m.src=v}if(m.onerror=function(x){s(v,h),p&&p.call(m,x)},m.onload=function(){s(v,h);var x={originalWidth:m.naturalWidth||m.width,originalHeight:m.naturalHeight||m.height};try{l.transform(m,h,y,c,x)}catch(_){p&&p(_)}},typeof c=="string")return l.requiresMetaData(h)?l.fetchBlob(c,w,h):w(),m;if(a("Blob",c)||a("File",c))return v=r(c),v?(m.src=v,m):o(c,function(x){m.src=x},p)}return e.Promise&&typeof u!="function"?(h=u,new Promise(f)):f(u,u)}l.requiresMetaData=function(c){return c&&c.meta},l.fetchBlob=function(c,u){u()},l.transform=function(c,u,h,f,d){h(c,d)},l.global=e,l.readFile=o,l.isInstanceOf=a,l.createObjectURL=r,l.revokeObjectURL=i,t.exports?t.exports=l:e.loadImage=l})(typeof window!="undefined"&&window||$t)})(Zc);var Z9={exports:{}};(function(t){(function(e){t.exports?e(Zc.exports):e(window.loadImage)})(function(e){var n=e.transform;e.createCanvas=function(r,i,s){if(s&&e.global.OffscreenCanvas)return new OffscreenCanvas(r,i);var o=document.createElement("canvas");return o.width=r,o.height=i,o},e.transform=function(r,i,s,o,a){n.call(e,e.scale(r,i,a),i,s,o,a)},e.transformCoordinates=function(){},e.getTransformedOptions=function(r,i){var s=i.aspectRatio,o,a,l,c;if(!s)return i;o={};for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&(o[a]=i[a]);return o.crop=!0,l=r.naturalWidth||r.width,c=r.naturalHeight||r.height,l/c>s?(o.maxWidth=c*s,o.maxHeight=c):(o.maxWidth=l,o.maxHeight=l/s),o},e.drawImage=function(r,i,s,o,a,l,c,u,h){var f=i.getContext("2d");return h.imageSmoothingEnabled===!1?(f.msImageSmoothingEnabled=!1,f.imageSmoothingEnabled=!1):h.imageSmoothingQuality&&(f.imageSmoothingQuality=h.imageSmoothingQuality),f.drawImage(r,s,o,a,l,0,0,c,u),f},e.requiresCanvas=function(r){return r.canvas||r.crop||!!r.aspectRatio},e.scale=function(r,i,s){i=i||{},s=s||{};var o=r.getContext||e.requiresCanvas(i)&&!!e.global.HTMLCanvasElement,a=r.naturalWidth||r.width,l=r.naturalHeight||r.height,c=a,u=l,h,f,d,p,m,v,y,w,x,_,S,T;function E(){var A=Math.max((d||c)/c,(p||u)/u);A>1&&(c*=A,u*=A)}function k(){var A=Math.min((h||c)/c,(f||u)/u);A<1&&(c*=A,u*=A)}if(o&&(i=e.getTransformedOptions(r,i,s),y=i.left||0,w=i.top||0,i.sourceWidth?(m=i.sourceWidth,i.right!==void 0&&i.left===void 0&&(y=a-m-i.right)):m=a-y-(i.right||0),i.sourceHeight?(v=i.sourceHeight,i.bottom!==void 0&&i.top===void 0&&(w=l-v-i.bottom)):v=l-w-(i.bottom||0),c=m,u=v),h=i.maxWidth,f=i.maxHeight,d=i.minWidth,p=i.minHeight,o&&h&&f&&i.crop?(c=h,u=f,S=m/v-h/f,S<0?(v=f*m/h,i.top===void 0&&i.bottom===void 0&&(w=(l-v)/2)):S>0&&(m=h*v/f,i.left===void 0&&i.right===void 0&&(y=(a-m)/2))):((i.contain||i.cover)&&(d=h=h||d,p=f=f||p),i.cover?(k(),E()):(E(),k())),o){if(x=i.pixelRatio,x>1&&!(r.style.width&&Math.floor(parseFloat(r.style.width,10))===Math.floor(a/x))&&(c*=x,u*=x),e.orientationCropBug&&!r.getContext&&(y||w||m!==a||v!==l)&&(S=r,r=e.createCanvas(a,l,!0),e.drawImage(S,r,0,0,a,l,a,l,i)),_=i.downsamplingRatio,_>0&&_<1&&c<m&&u<v)for(;m*_>c;)T=e.createCanvas(m*_,v*_,!0),e.drawImage(r,T,y,w,m,v,T.width,T.height,i),y=0,w=0,m=T.width,v=T.height,r=T;return T=e.createCanvas(c,u),e.transformCoordinates(T,i,s),x>1&&(T.style.width=T.width/x+"px"),e.drawImage(r,T,y,w,m,v,c,u,i).setTransform(1,0,0,1,0,0),T}return r.width=c,r.height=u,r}})})(Z9);var AT={exports:{}};(function(t){(function(e){t.exports?e(Zc.exports):e(window.loadImage)})(function(e){var n=e.global,r=e.transform,i=n.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),s=n.ArrayBuffer&&ArrayBuffer.prototype.slice||function(u,h){h=h||this.byteLength-u;var f=new Uint8Array(this,u,h),d=new Uint8Array(h);return d.set(f),d.buffer},o={jpeg:{65505:[],65517:[]}};function a(u,h,f,d){var p=this;function m(v,y){if(!(n.DataView&&i&&u&&u.size>=12&&u.type==="image/jpeg"))return v(d);var w=f.maxMetaDataSize||262144;e.readFile(i.call(u,0,w),function(x){var _=new DataView(x);if(_.getUint16(0)!==65496)return y(new Error("Invalid JPEG file: Missing JPEG marker."));for(var S=2,T=_.byteLength-4,E=S,k,A,M,D;S<T&&(k=_.getUint16(S),k>=65504&&k<=65519||k===65534);){if(A=_.getUint16(S+2)+2,S+A>_.byteLength){console.log("Invalid JPEG metadata: Invalid segment size.");break}if(M=o.jpeg[k],M&&!f.disableMetaDataParsers)for(D=0;D<M.length;D+=1)M[D].call(p,_,S,A,d,f);S+=A,E=S}!f.disableImageHead&&E>6&&(d.imageHead=s.call(x,0,E)),v(d)},y,"readAsArrayBuffer")||v(d)}return f=f||{},n.Promise&&typeof h!="function"?(f=h||{},d=f,new Promise(m)):(d=d||{},m(h,h))}function l(u,h,f){return!u||!h||!f?null:new Blob([f,i.call(u,h.byteLength)],{type:"image/jpeg"})}function c(u,h,f){var d={maxMetaDataSize:1024,disableMetaDataParsers:!0};if(!f&&n.Promise)return a(u,d).then(function(p){return l(u,p.imageHead,h)});a(u,function(p){f(l(u,p.imageHead,h))},d)}e.transform=function(u,h,f,d,p){e.requiresMetaData(h)?(p=p||{},a(d,function(m){m!==p&&(n.console&&console.log(m),m=p),r.call(e,u,h,f,d,m)},h,p)):r.apply(e,arguments)},e.blobSlice=i,e.bufferSlice=s,e.replaceHead=c,e.parseMetaData=a,e.metaDataParsers=o})})(AT);var UWe={exports:{}};(function(t){(function(e){t.exports?e(Zc.exports):e(window.loadImage)})(function(e){var n=e.global;n.fetch&&n.Request&&n.Response&&n.Response.prototype.blob?e.fetchBlob=function(r,i,s){function o(a){return a.blob()}if(n.Promise&&typeof i!="function")return fetch(new Request(r,i)).then(o);fetch(new Request(r,s)).then(o).then(i).catch(function(a){i(null,a)})}:n.XMLHttpRequest&&new XMLHttpRequest().responseType===""&&(e.fetchBlob=function(r,i,s){function o(a,l){s=s||{};var c=new XMLHttpRequest;c.open(s.method||"GET",r),s.headers&&Object.keys(s.headers).forEach(function(u){c.setRequestHeader(u,s.headers[u])}),c.withCredentials=s.credentials==="include",c.responseType="blob",c.onload=function(){a(c.response)},c.onerror=c.onabort=c.ontimeout=function(u){a===l?l(null,u):l(u)},c.send(s.body)}return n.Promise&&typeof i!="function"?(s=i,new Promise(o)):o(i,i)})})})(UWe);var J9={exports:{}};(function(t){(function(e){t.exports?e(Zc.exports,AT.exports):e(window.loadImage)})(function(e){function n(c){c&&(Object.defineProperty(this,"map",{value:this.ifds[c].map}),Object.defineProperty(this,"tags",{value:this.tags&&this.tags[c]||{}}))}n.prototype.map={Orientation:274,Thumbnail:"ifd1",Blob:513,Exif:34665,GPSInfo:34853,Interoperability:40965},n.prototype.ifds={ifd1:{name:"Thumbnail",map:n.prototype.map},34665:{name:"Exif",map:{}},34853:{name:"GPSInfo",map:{}},40965:{name:"Interoperability",map:{}}},n.prototype.get=function(c){return this[c]||this[this.map[c]]};function r(c,u,h){if(!!h){if(u+h>c.byteLength){console.log("Invalid Exif data: Invalid thumbnail data.");return}return new Blob([e.bufferSlice.call(c.buffer,u,u+h)],{type:"image/jpeg"})}}var i={1:{getValue:function(c,u){return c.getUint8(u)},size:1},2:{getValue:function(c,u){return String.fromCharCode(c.getUint8(u))},size:1,ascii:!0},3:{getValue:function(c,u,h){return c.getUint16(u,h)},size:2},4:{getValue:function(c,u,h){return c.getUint32(u,h)},size:4},5:{getValue:function(c,u,h){return c.getUint32(u,h)/c.getUint32(u+4,h)},size:8},9:{getValue:function(c,u,h){return c.getInt32(u,h)},size:4},10:{getValue:function(c,u,h){return c.getInt32(u,h)/c.getInt32(u+4,h)},size:8}};i[7]=i[1];function s(c,u,h,f,d,p){var m=i[f],v,y,w,x,_,S;if(!m){console.log("Invalid Exif data: Invalid tag type.");return}if(v=m.size*d,y=v>4?u+c.getUint32(h+8,p):h+8,y+v>c.byteLength){console.log("Invalid Exif data: Invalid data offset.");return}if(d===1)return m.getValue(c,y,p);for(w=[],x=0;x<d;x+=1)w[x]=m.getValue(c,y+x*m.size,p);if(m.ascii){for(_="",x=0;x<w.length&&(S=w[x],S!=="\0");x+=1)_+=S;return _}return w}function o(c,u,h){return(!c||c[h])&&(!u||u[h]!==!0)}function a(c,u,h,f,d,p,m,v){var y,w,x,_,S,T;if(h+6>c.byteLength){console.log("Invalid Exif data: Invalid directory offset.");return}if(y=c.getUint16(h,f),w=h+2+12*y,w+4>c.byteLength){console.log("Invalid Exif data: Invalid directory size.");return}for(x=0;x<y;x+=1)_=h+2+12*x,S=c.getUint16(_,f),!!o(m,v,S)&&(T=s(c,u,_,c.getUint16(_+2,f),c.getUint32(_+4,f),f),d[S]=T,p&&(p[S]=_));return c.getUint32(w,f)}function l(c,u,h,f,d,p,m){var v=c.exif[u];v&&(c.exif[u]=new n(u),c.exifOffsets&&(c.exifOffsets[u]=new n(u)),a(h,f,f+v,d,c.exif[u],c.exifOffsets&&c.exifOffsets[u],p&&p[u],m&&m[u]))}e.parseExifData=function(c,u,h,f,d){if(!d.disableExif){var p=d.includeExifTags,m=d.excludeExifTags||{34665:{37500:!0}},v=u+10,y,w,x;if(c.getUint32(u+4)===1165519206){if(v+8>c.byteLength){console.log("Invalid Exif data: Invalid segment size.");return}if(c.getUint16(u+8)!==0){console.log("Invalid Exif data: Missing byte alignment offset.");return}switch(c.getUint16(v)){case 18761:y=!0;break;case 19789:y=!1;break;default:console.log("Invalid Exif data: Invalid byte alignment marker.");return}if(c.getUint16(v+2,y)!==42){console.log("Invalid Exif data: Missing TIFF marker.");return}w=c.getUint32(v+4,y),f.exif=new n,d.disableExifOffsets||(f.exifOffsets=new n,f.exifTiffOffset=v,f.exifLittleEndian=y),w=a(c,v,v+w,y,f.exif,f.exifOffsets,p,m),w&&o(p,m,"ifd1")&&(f.exif.ifd1=w,f.exifOffsets&&(f.exifOffsets.ifd1=v+w)),Object.keys(f.exif.ifds).forEach(function(_){l(f,_,c,v,y,p,m)}),x=f.exif.ifd1,x&&x[513]&&(x[513]=r(c,v+x[513],x[514]))}}},e.metaDataParsers.jpeg[65505].push(e.parseExifData),e.exifWriters={274:function(c,u,h){var f=u.exifOffsets[274];if(!f)return c;var d=new DataView(c,f+8,2);return d.setUint16(0,h,u.exifLittleEndian),c}},e.writeExifData=function(c,u,h,f){return e.exifWriters[u.exif.map[h]](c,u,f)},e.ExifMap=n})})(J9);var WWe={exports:{}};(function(t){(function(e){t.exports?e(Zc.exports,J9.exports):e(window.loadImage)})(function(e){var n=e.ExifMap.prototype;n.tags={256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright",34665:{36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",42240:"Gamma",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",36880:"OffsetTime",36881:"OffsetTimeOriginal",36882:"OffsetTimeDigitized",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"PhotographicSensitivity",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber"},34853:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},40965:{1:"InteroperabilityIndex"}},n.tags.ifd1=n.tags,n.stringValues={ExposureProgram:{0:"Undefined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Undefined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},ComponentsConfiguration:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"},Orientation:{1:"Original",2:"Horizontal flip",3:"Rotate 180\xB0 CCW",4:"Vertical flip",5:"Vertical flip + Rotate 90\xB0 CW",6:"Rotate 90\xB0 CW",7:"Horizontal flip + Rotate 90\xB0 CW",8:"Rotate 90\xB0 CCW"}},n.getText=function(r){var i=this.get(r);switch(r){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":case"Orientation":return this.stringValues[r][i];case"ExifVersion":case"FlashpixVersion":return i?String.fromCharCode(i[0],i[1],i[2],i[3]):void 0;case"ComponentsConfiguration":return i?this.stringValues[r][i[0]]+this.stringValues[r][i[1]]+this.stringValues[r][i[2]]+this.stringValues[r][i[3]]:void 0;case"GPSVersionID":return i?i[0]+"."+i[1]+"."+i[2]+"."+i[3]:void 0}return String(i)},n.getAll=function(){var r={},i,s,o;for(i in this)Object.prototype.hasOwnProperty.call(this,i)&&(s=this[i],s&&s.getAll?r[this.ifds[i].name]=s.getAll():(o=this.tags[i],o&&(r[o]=this.getText(o))));return r},n.getName=function(r){var i=this.tags[r];return typeof i=="object"?this.ifds[r].name:i},function(){var r=n.tags,i,s,o;for(i in r)if(Object.prototype.hasOwnProperty.call(r,i))if(s=n.ifds[i],s){o=r[i];for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(s.map[o[i]]=Number(i))}else n.map[r[i]]=Number(i)}()})})(WWe);var Q9={exports:{}};(function(t){(function(e){t.exports?e(Zc.exports,AT.exports):e(window.loadImage)})(function(e){function n(){}n.prototype.map={ObjectName:5},n.prototype.types={0:"Uint16",200:"Uint16",201:"Uint16",202:"binary"},n.prototype.get=function(c){return this[c]||this[this.map[c]]};function r(c,u,h){for(var f="",d=u+h,p=u;p<d;p+=1)f+=String.fromCharCode(c.getUint8(p));return f}function i(c,u,h,f,d){return u.types[c]==="binary"?new Blob([h.buffer.slice(f,f+d)]):u.types[c]==="Uint16"?h.getUint16(f):r(h,f,d)}function s(c,u){return c===void 0?u:c instanceof Array?(c.push(u),c):[c,u]}function o(c,u,h,f,d,p){for(var m,v,y,w=u+h,x=u;x<w;)c.getUint8(x)===28&&c.getUint8(x+1)===2&&(y=c.getUint8(x+2),(!d||d[y])&&(!p||!p[y])&&(v=c.getInt16(x+3),m=i(y,f.iptc,c,x+5,v),f.iptc[y]=s(f.iptc[y],m),f.iptcOffsets&&(f.iptcOffsets[y]=x))),x+=1}function a(c,u){return c.getUint32(u)===943868237&&c.getUint16(u+4)===1028}function l(c,u){var h=c.getUint8(u+7);return h%2!=0&&(h+=1),h===0&&(h=4),h}e.parseIptcData=function(c,u,h,f,d){if(!d.disableIptc)for(var p=u+h;u+8<p;){if(a(c,u)){var m=l(c,u),v=u+8+m;if(v>p){console.log("Invalid IPTC data: Invalid segment offset.");break}var y=c.getUint16(u+6+m);if(u+y>p){console.log("Invalid IPTC data: Invalid segment size.");break}f.iptc=new n,d.disableIptcOffsets||(f.iptcOffsets=new n),o(c,v,y,f,d.includeIptcTags,d.excludeIptcTags||{202:!0});return}u+=1}},e.metaDataParsers.jpeg[65517].push(e.parseIptcData),e.IptcMap=n})})(Q9);var GWe={exports:{}};(function(t){(function(e){t.exports?e(Zc.exports,Q9.exports):e(window.loadImage)})(function(e){var n=e.IptcMap.prototype;n.tags={0:"ApplicationRecordVersion",3:"ObjectTypeReference",4:"ObjectAttributeReference",5:"ObjectName",7:"EditStatus",8:"EditorialUpdate",10:"Urgency",12:"SubjectReference",15:"Category",20:"SupplementalCategories",22:"FixtureIdentifier",25:"Keywords",26:"ContentLocationCode",27:"ContentLocationName",30:"ReleaseDate",35:"ReleaseTime",37:"ExpirationDate",38:"ExpirationTime",40:"SpecialInstructions",42:"ActionAdvised",45:"ReferenceService",47:"ReferenceDate",50:"ReferenceNumber",55:"DateCreated",60:"TimeCreated",62:"DigitalCreationDate",63:"DigitalCreationTime",65:"OriginatingProgram",70:"ProgramVersion",75:"ObjectCycle",80:"Byline",85:"BylineTitle",90:"City",92:"Sublocation",95:"State",100:"CountryCode",101:"Country",103:"OriginalTransmissionReference",105:"Headline",110:"Credit",115:"Source",116:"CopyrightNotice",118:"Contact",120:"Caption",121:"LocalCaption",122:"Writer",125:"RasterizedCaption",130:"ImageType",131:"ImageOrientation",135:"LanguageIdentifier",150:"AudioType",151:"AudioSamplingRate",152:"AudioSamplingResolution",153:"AudioDuration",154:"AudioOutcue",184:"JobID",185:"MasterDocumentID",186:"ShortDocumentID",187:"UniqueDocumentID",188:"OwnerID",200:"ObjectPreviewFileFormat",201:"ObjectPreviewFileVersion",202:"ObjectPreviewData",221:"Prefs",225:"ClassifyState",228:"SimilarityIndex",230:"DocumentNotes",231:"DocumentHistory",232:"ExifCameraInfo",255:"CatalogSets"},n.stringValues={10:{0:"0 (reserved)",1:"1 (most urgent)",2:"2",3:"3",4:"4",5:"5 (normal urgency)",6:"6",7:"7",8:"8 (least urgent)",9:"9 (user-defined priority)"},75:{a:"Morning",b:"Both Morning and Evening",p:"Evening"},131:{L:"Landscape",P:"Portrait",S:"Square"}},n.getText=function(r){var i=this.get(r),s=this.map[r],o=this.stringValues[s];return o?o[i]:String(i)},n.getAll=function(){var r={},i,s;for(i in this)Object.prototype.hasOwnProperty.call(this,i)&&(s=this.tags[i],s&&(r[s]=this.getText(s)));return r},n.getName=function(r){return this.tags[r]},function(){var r=n.tags,i=n.map||{},s;for(s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[r[s]]=Number(s))}()})})(GWe);var HWe={exports:{}};(function(t){(function(e){t.exports?e(Zc.exports,Z9.exports,AT.exports):e(window.loadImage)})(function(e){var n=e.transform,r=e.requiresCanvas,i=e.requiresMetaData,s=e.transformCoordinates,o=e.getTransformedOptions;(function(u){if(!!u.global.document){var h="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAIAAwMBEQACEQEDEQH/xABRAAEAAAAAAAAAAAAAAAAAAAAKEAEBAQADAQEAAAAAAAAAAAAGBQQDCAkCBwEBAAAAAAAAAAAAAAAAAAAAABEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8AG8T9NfSMEVMhQvoP3fFiRZ+MTHDifa/95OFSZU5OzRzxkyejv8ciEfhSceSXGjS8eSdLnZc2HDm4M3BxcXwH/9k=",f=document.createElement("img");f.onload=function(){if(u.orientation=f.width===2&&f.height===3,u.orientation){var d=u.createCanvas(1,1,!0),p=d.getContext("2d");p.drawImage(f,1,1,1,1,0,0,1,1),u.orientationCropBug=p.getImageData(0,0,1,1).data.toString()!=="255,255,255,255"}},f.src=h}})(e);function a(u,h){var f=u&&u.orientation;return f===!0&&!e.orientation||f===1&&e.orientation||(!h||e.orientation)&&f>1&&f<9}function l(u,h){return u!==h&&(u===1&&h>1&&h<9||u>1&&u<9)}function c(u,h){if(h>1&&h<9)switch(u){case 2:case 4:return h>4;case 5:case 7:return h%2==0;case 6:case 8:return h===2||h===4||h===5||h===7}return!1}e.requiresCanvas=function(u){return a(u)||r.call(e,u)},e.requiresMetaData=function(u){return a(u,!0)||i.call(e,u)},e.transform=function(u,h,f,d,p){n.call(e,u,h,function(m,v){if(v){var y=e.orientation&&v.exif&&v.exif.get("Orientation");if(y>4&&y<9){var w=v.originalWidth,x=v.originalHeight;v.originalWidth=x,v.originalHeight=w}}f(m,v)},d,p)},e.getTransformedOptions=function(u,h,f){var d=o.call(e,u,h),p=f.exif&&f.exif.get("Orientation"),m=d.orientation,v=e.orientation&&p;if(m===!0&&(m=p),!l(m,v))return d;var y=d.top,w=d.right,x=d.bottom,_=d.left,S={};for(var T in d)Object.prototype.hasOwnProperty.call(d,T)&&(S[T]=d[T]);if(S.orientation=m,(m>4&&!(v>4)||m<5&&v>4)&&(S.maxWidth=d.maxHeight,S.maxHeight=d.maxWidth,S.minWidth=d.minHeight,S.minHeight=d.minWidth,S.sourceWidth=d.sourceHeight,S.sourceHeight=d.sourceWidth),v>1){switch(v){case 2:w=d.left,_=d.right;break;case 3:y=d.bottom,w=d.left,x=d.top,_=d.right;break;case 4:y=d.bottom,x=d.top;break;case 5:y=d.left,w=d.bottom,x=d.right,_=d.top;break;case 6:y=d.left,w=d.top,x=d.right,_=d.bottom;break;case 7:y=d.right,w=d.top,x=d.left,_=d.bottom;break;case 8:y=d.right,w=d.bottom,x=d.left,_=d.top;break}if(c(m,v)){var E=y,k=w;y=x,w=_,x=E,_=k}}switch(S.top=y,S.right=w,S.bottom=x,S.left=_,m){case 2:S.right=_,S.left=w;break;case 3:S.top=x,S.right=_,S.bottom=y,S.left=w;break;case 4:S.top=x,S.bottom=y;break;case 5:S.top=_,S.right=x,S.bottom=w,S.left=y;break;case 6:S.top=w,S.right=x,S.bottom=_,S.left=y;break;case 7:S.top=w,S.right=y,S.bottom=_,S.left=x;break;case 8:S.top=_,S.right=y,S.bottom=w,S.left=x;break}return S},e.transformCoordinates=function(u,h,f){s.call(e,u,h,f);var d=h.orientation,p=e.orientation&&f.exif&&f.exif.get("Orientation");if(!!l(d,p)){var m=u.getContext("2d"),v=u.width,y=u.height,w=v,x=y;switch((d>4&&!(p>4)||d<5&&p>4)&&(u.width=y,u.height=v),d>4&&(w=y,x=v),p){case 2:m.translate(w,0),m.scale(-1,1);break;case 3:m.translate(w,x),m.rotate(Math.PI);break;case 4:m.translate(0,x),m.scale(1,-1);break;case 5:m.rotate(-.5*Math.PI),m.scale(-1,1);break;case 6:m.rotate(-.5*Math.PI),m.translate(-w,0);break;case 7:m.rotate(-.5*Math.PI),m.translate(-w,x),m.scale(1,-1);break;case 8:m.rotate(.5*Math.PI),m.translate(0,-x);break}switch(c(d,p)&&(m.translate(w,x),m.rotate(Math.PI)),d){case 2:m.translate(v,0),m.scale(-1,1);break;case 3:m.translate(v,y),m.rotate(Math.PI);break;case 4:m.translate(0,y),m.scale(1,-1);break;case 5:m.rotate(.5*Math.PI),m.scale(1,-1);break;case 6:m.rotate(.5*Math.PI),m.translate(0,-y);break;case 7:m.rotate(.5*Math.PI),m.translate(v,-y),m.scale(-1,1);break;case 8:m.rotate(-.5*Math.PI),m.translate(-v,0);break}}}})})(HWe);function MT(t,e){let n=0;for(let r=0;r<t.length;r++)n+=(t[r]-e[r])*(t[r]-e[r]);return n}const ZD={distanceFunction:MT};function jWe(t,e,n=ZD){const r=n.distanceFunction||ZD.distanceFunction,i=n.similarityFunction||ZD.similarityFunction;let s=-1;if(typeof i=="function"){let o=Number.MIN_VALUE;for(let a=0;a<t.length;a++){const l=i(e,t[a]);l>o&&(o=l,s=a)}}else if(typeof r=="function"){let o=Number.MAX_VALUE;for(let a=0;a<t.length;a++){const l=r(e,t[a]);l<o&&(o=l,s=a)}}else throw new Error("A similarity or distance function it's required");return s}function qWe(t,e){for(var n=new Array(t.length),r=0;r<t.length;++r)for(var i=r;i<t.length;++i){n[r]||(n[r]=new Array(t.length)),n[i]||(n[i]=new Array(t.length));const s=e(t[r],t[i]);n[r][i]=s,n[i][r]=s}return n}function eq(t,e,n,r){for(var i=0;i<t.length;i++)n[i]=jWe(e,t[i],{distanceFunction:r});return n}function XWe(t,e,n,r){const i=e[0].length;for(var s=new Array(r),o=new Array(r),a=0;a<r;a++){s[a]=new Array(i),o[a]=0;for(var l=0;l<i;l++)s[a][l]=0}for(var c=0;c<e.length;c++){o[n[c]]++;for(var u=0;u<i;u++)s[n[c]][u]+=e[c][u]}for(var h=0;h<r;h++)for(var f=0;f<i;f++)o[h]?s[h][f]/=o[h]:s[h][f]=t[h][f];return s}function KWe(t,e,n,r){for(var i=0;i<t.length;i++)if(n(t[i],e[i])>r)return!1;return!0}const tq=8,YWe=1/16777216,ZWe=15,JWe=18,QWe=11;function eGe(t,e){t>>>=0,e>>>=0;const n=t&65535;return((t-n)*e>>>0)+n*e>>>0}class tGe{constructor(e=Date.now()){this.state=new Uint32Array(4),this.init(e),this.random=this.getFloat.bind(this)}getUint32(){return this.nextState(),this.state[3]+this.state[2]>>>0}getFloat(){return(this.getUint32()>>>8)*YWe}init(e){if(!Number.isInteger(e))throw new TypeError("seed must be an integer");this.state[0]=e,this.state[1]=0,this.state[2]=0,this.state[3]=0;for(let n=1;n<tq;n++)this.state[n&3]^=n+eGe(1812433253,this.state[n-1&3]^this.state[n-1&3]>>>30>>>0)>>>0;this.periodCertification();for(let n=0;n<tq;n++)this.nextState()}periodCertification(){this.state[0]===0&&this.state[1]===0&&this.state[2]===0&&this.state[3]===0&&(this.state[0]=88,this.state[1]=83,this.state[2]=65,this.state[3]=68)}nextState(){let e=this.state[0];e^=e<<ZWe,e^=e>>>JWe,e^=this.state[3]<<QWe,this.state[0]=this.state[1],this.state[1]=this.state[2],this.state[2]=this.state[3],this.state[3]=e}}const nGe=1e-8;function nq(t,e={},n=Math.random){const{size:r=1,replace:i=!1,probabilities:s}=e;let o,a;if(typeof t=="number"?o=rGe(t):o=t.slice(),s){if(!i)throw new Error("choice with probabilities and no replacement is not implemented");if(s.length!==o.length)throw new Error("the length of probabilities option should be equal to the number of choices");a=[s[0]];for(let c=1;c<s.length;c++)a[c]=a[c-1]+s[c];if(Math.abs(1-a[a.length-1])>nGe)throw new Error(`probabilities should sum to 1, but instead sums to ${a[a.length-1]}`)}if(i===!1&&r>o.length)throw new Error("size option is too large");const l=[];for(let c=0;c<r;c++){const u=iGe(o.length,n,a);l.push(o[u]),i||o.splice(u,1)}return l}function rGe(t){const e=[];for(let n=0;n<t;n++)e.push(n);return e}function iGe(t,e,n){const r=e();if(n){let i=0;for(;r>n[i];)i++;return i}else return Math.floor(r*t)}class JD{constructor(e=Math.random){if(typeof e=="number"){const n=new tGe(e);this.randomGenerator=n.random}else this.randomGenerator=e}choice(e,n){return typeof e=="number"?nq(e,n,this.randomGenerator):nq(e,n,this.randomGenerator)}random(){return this.randomGenerator()}randInt(e,n){return n===void 0&&(n=e,e=0),e+Math.floor(this.randomGenerator()*(n-e))}randomSample(e){const n=[];for(let r=0;r<e;r++)n.push(this.random());return n}}const sGe=Object.prototype.toString;function IT(t){return sGe.call(t).endsWith("Array]")}function oGe(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!IT(t))throw new TypeError("input must be an array");if(t.length===0)throw new TypeError("input must not be empty");var n=e.fromIndex,r=n===void 0?0:n,i=e.toIndex,s=i===void 0?t.length:i;if(r<0||r>=t.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=r||s>t.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=t[r],a=r+1;a<s;a++)t[a]>o&&(o=t[a]);return o}function aGe(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!IT(t))throw new TypeError("input must be an array");if(t.length===0)throw new TypeError("input must not be empty");var n=e.fromIndex,r=n===void 0?0:n,i=e.toIndex,s=i===void 0?t.length:i;if(r<0||r>=t.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=r||s>t.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=t[r],a=r+1;a<s;a++)t[a]<o&&(o=t[a]);return o}function rq(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(IT(t)){if(t.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var n;if(e.output!==void 0){if(!IT(e.output))throw new TypeError("output option must be an array if specified");n=e.output}else n=new Array(t.length);var r=aGe(t),i=oGe(t);if(r===i)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var s=e.min,o=s===void 0?e.autoMinMax?r:0:s,a=e.max,l=a===void 0?e.autoMinMax?i:1:a;if(o>=l)throw new RangeError("min option must be smaller than max option");for(var c=(l-o)/(i-r),u=0;u<t.length;u++)n[u]=(t[u]-r)*c+o;return n}const NT=" ".repeat(2),iq=" ".repeat(4);function lGe(){return sq(this)}function sq(t,e={}){const{maxRows:n=15,maxColumns:r=10,maxNumSize:i=8}=e;return`${t.constructor.name} {
${NT}[
${iq}${cGe(t,n,r,i)}
${NT}]
${NT}rows: ${t.rows}
${NT}columns: ${t.columns}
}`}function cGe(t,e,n,r){const{rows:i,columns:s}=t,o=Math.min(i,e),a=Math.min(s,n),l=[];for(let c=0;c<o;c++){let u=[];for(let h=0;h<a;h++)u.push(uGe(t.get(c,h),r));l.push(`${u.join(" ")}`)}return a!==s&&(l[l.length-1]+=` ... ${s-n} more columns`),o!==i&&l.push(`... ${i-e} more rows`),l.join(`
${iq}`)}function uGe(t,e){const n=String(t);if(n.length<=e)return n.padEnd(e," ");const r=t.toPrecision(e-2);if(r.length<=e)return r;const i=t.toExponential(e-2),s=i.indexOf("e"),o=i.slice(s);return i.slice(0,e-o.length)+o}function hGe(t,e){t.prototype.add=function(r){return typeof r=="number"?this.addS(r):this.addM(r)},t.prototype.addS=function(r){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)+r);return this},t.prototype.addM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)+r.get(i,s));return this},t.add=function(r,i){return new e(r).add(i)},t.prototype.sub=function(r){return typeof r=="number"?this.subS(r):this.subM(r)},t.prototype.subS=function(r){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)-r);return this},t.prototype.subM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)-r.get(i,s));return this},t.sub=function(r,i){return new e(r).sub(i)},t.prototype.subtract=t.prototype.sub,t.prototype.subtractS=t.prototype.subS,t.prototype.subtractM=t.prototype.subM,t.subtract=t.sub,t.prototype.mul=function(r){return typeof r=="number"?this.mulS(r):this.mulM(r)},t.prototype.mulS=function(r){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)*r);return this},t.prototype.mulM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)*r.get(i,s));return this},t.mul=function(r,i){return new e(r).mul(i)},t.prototype.multiply=t.prototype.mul,t.prototype.multiplyS=t.prototype.mulS,t.prototype.multiplyM=t.prototype.mulM,t.multiply=t.mul,t.prototype.div=function(r){return typeof r=="number"?this.divS(r):this.divM(r)},t.prototype.divS=function(r){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)/r);return this},t.prototype.divM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)/r.get(i,s));return this},t.div=function(r,i){return new e(r).div(i)},t.prototype.divide=t.prototype.div,t.prototype.divideS=t.prototype.divS,t.prototype.divideM=t.prototype.divM,t.divide=t.div,t.prototype.mod=function(r){return typeof r=="number"?this.modS(r):this.modM(r)},t.prototype.modS=function(r){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)%r);return this},t.prototype.modM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)%r.get(i,s));return this},t.mod=function(r,i){return new e(r).mod(i)},t.prototype.modulus=t.prototype.mod,t.prototype.modulusS=t.prototype.modS,t.prototype.modulusM=t.prototype.modM,t.modulus=t.mod,t.prototype.and=function(r){return typeof r=="number"?this.andS(r):this.andM(r)},t.prototype.andS=function(r){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)&r);return this},t.prototype.andM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)&r.get(i,s));return this},t.and=function(r,i){return new e(r).and(i)},t.prototype.or=function(r){return typeof r=="number"?this.orS(r):this.orM(r)},t.prototype.orS=function(r){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)|r);return this},t.prototype.orM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)|r.get(i,s));return this},t.or=function(r,i){return new e(r).or(i)},t.prototype.xor=function(r){return typeof r=="number"?this.xorS(r):this.xorM(r)},t.prototype.xorS=function(r){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)^r);return this},t.prototype.xorM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)^r.get(i,s));return this},t.xor=function(r,i){return new e(r).xor(i)},t.prototype.leftShift=function(r){return typeof r=="number"?this.leftShiftS(r):this.leftShiftM(r)},t.prototype.leftShiftS=function(r){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)<<r);return this},t.prototype.leftShiftM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)<<r.get(i,s));return this},t.leftShift=function(r,i){return new e(r).leftShift(i)},t.prototype.signPropagatingRightShift=function(r){return typeof r=="number"?this.signPropagatingRightShiftS(r):this.signPropagatingRightShiftM(r)},t.prototype.signPropagatingRightShiftS=function(r){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)>>r);return this},t.prototype.signPropagatingRightShiftM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)>>r.get(i,s));return this},t.signPropagatingRightShift=function(r,i){return new e(r).signPropagatingRightShift(i)},t.prototype.rightShift=function(r){return typeof r=="number"?this.rightShiftS(r):this.rightShiftM(r)},t.prototype.rightShiftS=function(r){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)>>>r);return this},t.prototype.rightShiftM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)>>>r.get(i,s));return this},t.rightShift=function(r,i){return new e(r).rightShift(i)},t.prototype.zeroFillRightShift=t.prototype.rightShift,t.prototype.zeroFillRightShiftS=t.prototype.rightShiftS,t.prototype.zeroFillRightShiftM=t.prototype.rightShiftM,t.zeroFillRightShift=t.rightShift,t.prototype.not=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,~this.get(r,i));return this},t.not=function(r){return new e(r).not()},t.prototype.abs=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.abs(this.get(r,i)));return this},t.abs=function(r){return new e(r).abs()},t.prototype.acos=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.acos(this.get(r,i)));return this},t.acos=function(r){return new e(r).acos()},t.prototype.acosh=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.acosh(this.get(r,i)));return this},t.acosh=function(r){return new e(r).acosh()},t.prototype.asin=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.asin(this.get(r,i)));return this},t.asin=function(r){return new e(r).asin()},t.prototype.asinh=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.asinh(this.get(r,i)));return this},t.asinh=function(r){return new e(r).asinh()},t.prototype.atan=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.atan(this.get(r,i)));return this},t.atan=function(r){return new e(r).atan()},t.prototype.atanh=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.atanh(this.get(r,i)));return this},t.atanh=function(r){return new e(r).atanh()},t.prototype.cbrt=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.cbrt(this.get(r,i)));return this},t.cbrt=function(r){return new e(r).cbrt()},t.prototype.ceil=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.ceil(this.get(r,i)));return this},t.ceil=function(r){return new e(r).ceil()},t.prototype.clz32=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.clz32(this.get(r,i)));return this},t.clz32=function(r){return new e(r).clz32()},t.prototype.cos=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.cos(this.get(r,i)));return this},t.cos=function(r){return new e(r).cos()},t.prototype.cosh=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.cosh(this.get(r,i)));return this},t.cosh=function(r){return new e(r).cosh()},t.prototype.exp=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.exp(this.get(r,i)));return this},t.exp=function(r){return new e(r).exp()},t.prototype.expm1=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.expm1(this.get(r,i)));return this},t.expm1=function(r){return new e(r).expm1()},t.prototype.floor=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.floor(this.get(r,i)));return this},t.floor=function(r){return new e(r).floor()},t.prototype.fround=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.fround(this.get(r,i)));return this},t.fround=function(r){return new e(r).fround()},t.prototype.log=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.log(this.get(r,i)));return this},t.log=function(r){return new e(r).log()},t.prototype.log1p=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.log1p(this.get(r,i)));return this},t.log1p=function(r){return new e(r).log1p()},t.prototype.log10=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.log10(this.get(r,i)));return this},t.log10=function(r){return new e(r).log10()},t.prototype.log2=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.log2(this.get(r,i)));return this},t.log2=function(r){return new e(r).log2()},t.prototype.round=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.round(this.get(r,i)));return this},t.round=function(r){return new e(r).round()},t.prototype.sign=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.sign(this.get(r,i)));return this},t.sign=function(r){return new e(r).sign()},t.prototype.sin=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.sin(this.get(r,i)));return this},t.sin=function(r){return new e(r).sin()},t.prototype.sinh=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.sinh(this.get(r,i)));return this},t.sinh=function(r){return new e(r).sinh()},t.prototype.sqrt=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.sqrt(this.get(r,i)));return this},t.sqrt=function(r){return new e(r).sqrt()},t.prototype.tan=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.tan(this.get(r,i)));return this},t.tan=function(r){return new e(r).tan()},t.prototype.tanh=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.tanh(this.get(r,i)));return this},t.tanh=function(r){return new e(r).tanh()},t.prototype.trunc=function(){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.trunc(this.get(r,i)));return this},t.trunc=function(r){return new e(r).trunc()},t.pow=function(r,i){return new e(r).pow(i)},t.prototype.pow=function(r){return typeof r=="number"?this.powS(r):this.powM(r)},t.prototype.powS=function(r){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.pow(this.get(i,s),r));return this},t.prototype.powM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.pow(this.get(i,s),r.get(i,s)));return this}}function fl(t,e,n){let r=n?t.rows:t.rows-1;if(e<0||e>r)throw new RangeError("Row index out of range")}function dl(t,e,n){let r=n?t.columns:t.columns-1;if(e<0||e>r)throw new RangeError("Column index out of range")}function Ag(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function Mg(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function fGe(t,e,n){return{row:dGe(t,e),column:pGe(t,n)}}function dGe(t,e){if(typeof e!="object")throw new TypeError("unexpected type for row indices");if(e.some(r=>r<0||r>=t.rows))throw new RangeError("row indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function pGe(t,e){if(typeof e!="object")throw new TypeError("unexpected type for column indices");if(e.some(r=>r<0||r>=t.columns))throw new RangeError("column indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function oq(t,e,n,r,i){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(RT("startRow",e),RT("endRow",n),RT("startColumn",r),RT("endColumn",i),e>n||r>i||e<0||e>=t.rows||n<0||n>=t.rows||r<0||r>=t.columns||i<0||i>=t.columns)throw new RangeError("Submatrix indices are out of range")}function $T(t,e=0){let n=[];for(let r=0;r<t;r++)n.push(e);return n}function RT(t,e){if(typeof e!="number")throw new TypeError(`${t} must be a number`)}function Ig(t){if(t.isEmpty())throw new Error("Empty matrix has no elements to index")}function mGe(t){let e=$T(t.rows);for(let n=0;n<t.rows;++n)for(let r=0;r<t.columns;++r)e[n]+=t.get(n,r);return e}function gGe(t){let e=$T(t.columns);for(let n=0;n<t.rows;++n)for(let r=0;r<t.columns;++r)e[r]+=t.get(n,r);return e}function vGe(t){let e=0;for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)e+=t.get(n,r);return e}function yGe(t){let e=$T(t.rows,1);for(let n=0;n<t.rows;++n)for(let r=0;r<t.columns;++r)e[n]*=t.get(n,r);return e}function bGe(t){let e=$T(t.columns,1);for(let n=0;n<t.rows;++n)for(let r=0;r<t.columns;++r)e[r]*=t.get(n,r);return e}function wGe(t){let e=1;for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)e*=t.get(n,r);return e}function xGe(t,e,n){const r=t.rows,i=t.columns,s=[];for(let o=0;o<r;o++){let a=0,l=0,c=0;for(let u=0;u<i;u++)c=t.get(o,u)-n[o],a+=c,l+=c*c;e?s.push((l-a*a/i)/(i-1)):s.push((l-a*a/i)/i)}return s}function _Ge(t,e,n){const r=t.rows,i=t.columns,s=[];for(let o=0;o<i;o++){let a=0,l=0,c=0;for(let u=0;u<r;u++)c=t.get(u,o)-n[o],a+=c,l+=c*c;e?s.push((l-a*a/r)/(r-1)):s.push((l-a*a/r)/r)}return s}function SGe(t,e,n){const r=t.rows,i=t.columns,s=r*i;let o=0,a=0,l=0;for(let c=0;c<r;c++)for(let u=0;u<i;u++)l=t.get(c,u)-n,o+=l,a+=l*l;return e?(a-o*o/s)/(s-1):(a-o*o/s)/s}function CGe(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)-e[n])}function TGe(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)-e[r])}function EGe(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)-e)}function kGe(t){const e=[];for(let n=0;n<t.rows;n++){let r=0;for(let i=0;i<t.columns;i++)r+=Math.pow(t.get(n,i),2)/(t.columns-1);e.push(Math.sqrt(r))}return e}function AGe(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)/e[n])}function MGe(t){const e=[];for(let n=0;n<t.columns;n++){let r=0;for(let i=0;i<t.rows;i++)r+=Math.pow(t.get(i,n),2)/(t.rows-1);e.push(Math.sqrt(r))}return e}function IGe(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)/e[r])}function NGe(t){const e=t.size-1;let n=0;for(let r=0;r<t.columns;r++)for(let i=0;i<t.rows;i++)n+=Math.pow(t.get(i,r),2)/e;return Math.sqrt(n)}function $Ge(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)/e)}class Tn{static from1DArray(e,n,r){if(e*n!==r.length)throw new RangeError("data length does not match given dimensions");let s=new an(e,n);for(let o=0;o<e;o++)for(let a=0;a<n;a++)s.set(o,a,r[o*n+a]);return s}static rowVector(e){let n=new an(1,e.length);for(let r=0;r<e.length;r++)n.set(0,r,e[r]);return n}static columnVector(e){let n=new an(e.length,1);for(let r=0;r<e.length;r++)n.set(r,0,e[r]);return n}static zeros(e,n){return new an(e,n)}static ones(e,n){return new an(e,n).fill(1)}static rand(e,n,r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{random:i=Math.random}=r;let s=new an(e,n);for(let o=0;o<e;o++)for(let a=0;a<n;a++)s.set(o,a,i());return s}static randInt(e,n,r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{min:i=0,max:s=1e3,random:o=Math.random}=r;if(!Number.isInteger(i))throw new TypeError("min must be an integer");if(!Number.isInteger(s))throw new TypeError("max must be an integer");if(i>=s)throw new RangeError("min must be smaller than max");let a=s-i,l=new an(e,n);for(let c=0;c<e;c++)for(let u=0;u<n;u++){let h=i+Math.round(o()*a);l.set(c,u,h)}return l}static eye(e,n,r){n===void 0&&(n=e),r===void 0&&(r=1);let i=Math.min(e,n),s=this.zeros(e,n);for(let o=0;o<i;o++)s.set(o,o,r);return s}static diag(e,n,r){let i=e.length;n===void 0&&(n=i),r===void 0&&(r=n);let s=Math.min(i,n,r),o=this.zeros(n,r);for(let a=0;a<s;a++)o.set(a,a,e[a]);return o}static min(e,n){e=this.checkMatrix(e),n=this.checkMatrix(n);let r=e.rows,i=e.columns,s=new an(r,i);for(let o=0;o<r;o++)for(let a=0;a<i;a++)s.set(o,a,Math.min(e.get(o,a),n.get(o,a)));return s}static max(e,n){e=this.checkMatrix(e),n=this.checkMatrix(n);let r=e.rows,i=e.columns,s=new this(r,i);for(let o=0;o<r;o++)for(let a=0;a<i;a++)s.set(o,a,Math.max(e.get(o,a),n.get(o,a)));return s}static checkMatrix(e){return Tn.isMatrix(e)?e:new an(e)}static isMatrix(e){return e!=null&&e.klass==="Matrix"}get size(){return this.rows*this.columns}apply(e){if(typeof e!="function")throw new TypeError("callback must be a function");for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)e.call(this,n,r);return this}to1DArray(){let e=[];for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)e.push(this.get(n,r));return e}to2DArray(){let e=[];for(let n=0;n<this.rows;n++){e.push([]);for(let r=0;r<this.columns;r++)e[n].push(this.get(n,r))}return e}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let e=0;e<this.rows;e++)for(let n=0;n<=e;n++)if(this.get(e,n)!==this.get(n,e))return!1;return!0}return!1}isEchelonForm(){let e=0,n=0,r=-1,i=!0,s=!1;for(;e<this.rows&&i;){for(n=0,s=!1;n<this.columns&&s===!1;)this.get(e,n)===0?n++:this.get(e,n)===1&&n>r?(s=!0,r=n):(i=!1,s=!0);e++}return i}isReducedEchelonForm(){let e=0,n=0,r=-1,i=!0,s=!1;for(;e<this.rows&&i;){for(n=0,s=!1;n<this.columns&&s===!1;)this.get(e,n)===0?n++:this.get(e,n)===1&&n>r?(s=!0,r=n):(i=!1,s=!0);for(let o=n+1;o<this.rows;o++)this.get(e,o)!==0&&(i=!1);e++}return i}echelonForm(){let e=this.clone(),n=0,r=0;for(;n<e.rows&&r<e.columns;){let i=n;for(let s=n;s<e.rows;s++)e.get(s,r)>e.get(i,r)&&(i=s);if(e.get(i,r)===0)r++;else{e.swapRows(n,i);let s=e.get(n,r);for(let o=r;o<e.columns;o++)e.set(n,o,e.get(n,o)/s);for(let o=n+1;o<e.rows;o++){let a=e.get(o,r)/e.get(n,r);e.set(o,r,0);for(let l=r+1;l<e.columns;l++)e.set(o,l,e.get(o,l)-e.get(n,l)*a)}n++,r++}}return e}reducedEchelonForm(){let e=this.echelonForm(),n=e.columns,r=e.rows,i=r-1;for(;i>=0;)if(e.maxRow(i)===0)i--;else{let s=0,o=!1;for(;s<r&&o===!1;)e.get(i,s)===1?o=!0:s++;for(let a=0;a<i;a++){let l=e.get(a,s);for(let c=s;c<n;c++){let u=e.get(a,c)-l*e.get(i,c);e.set(a,c,u)}}i--}return e}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{rows:n=1,columns:r=1}=e;if(!Number.isInteger(n)||n<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new TypeError("columns must be a positive integer");let i=new an(this.rows*n,this.columns*r);for(let s=0;s<n;s++)for(let o=0;o<r;o++)i.setSubMatrix(this,this.rows*s,this.columns*o);return i}fill(e){for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.set(n,r,e);return this}neg(){return this.mulS(-1)}getRow(e){fl(this,e);let n=[];for(let r=0;r<this.columns;r++)n.push(this.get(e,r));return n}getRowVector(e){return an.rowVector(this.getRow(e))}setRow(e,n){fl(this,e),n=Ag(this,n);for(let r=0;r<this.columns;r++)this.set(e,r,n[r]);return this}swapRows(e,n){fl(this,e),fl(this,n);for(let r=0;r<this.columns;r++){let i=this.get(e,r);this.set(e,r,this.get(n,r)),this.set(n,r,i)}return this}getColumn(e){dl(this,e);let n=[];for(let r=0;r<this.rows;r++)n.push(this.get(r,e));return n}getColumnVector(e){return an.columnVector(this.getColumn(e))}setColumn(e,n){dl(this,e),n=Mg(this,n);for(let r=0;r<this.rows;r++)this.set(r,e,n[r]);return this}swapColumns(e,n){dl(this,e),dl(this,n);for(let r=0;r<this.rows;r++){let i=this.get(r,e);this.set(r,e,this.get(r,n)),this.set(r,n,i)}return this}addRowVector(e){e=Ag(this,e);for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.set(n,r,this.get(n,r)+e[r]);return this}subRowVector(e){e=Ag(this,e);for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.set(n,r,this.get(n,r)-e[r]);return this}mulRowVector(e){e=Ag(this,e);for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.set(n,r,this.get(n,r)*e[r]);return this}divRowVector(e){e=Ag(this,e);for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.set(n,r,this.get(n,r)/e[r]);return this}addColumnVector(e){e=Mg(this,e);for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.set(n,r,this.get(n,r)+e[n]);return this}subColumnVector(e){e=Mg(this,e);for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.set(n,r,this.get(n,r)-e[n]);return this}mulColumnVector(e){e=Mg(this,e);for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.set(n,r,this.get(n,r)*e[n]);return this}divColumnVector(e){e=Mg(this,e);for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.set(n,r,this.get(n,r)/e[n]);return this}mulRow(e,n){fl(this,e);for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*n);return this}mulColumn(e,n){dl(this,e);for(let r=0;r<this.rows;r++)this.set(r,e,this.get(r,e)*n);return this}max(){if(this.isEmpty())return NaN;let e=this.get(0,0);for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.get(n,r)>e&&(e=this.get(n,r));return e}maxIndex(){Ig(this);let e=this.get(0,0),n=[0,0];for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.get(r,i)>e&&(e=this.get(r,i),n[0]=r,n[1]=i);return n}min(){if(this.isEmpty())return NaN;let e=this.get(0,0);for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.get(n,r)<e&&(e=this.get(n,r));return e}minIndex(){Ig(this);let e=this.get(0,0),n=[0,0];for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.get(r,i)<e&&(e=this.get(r,i),n[0]=r,n[1]=i);return n}maxRow(e){if(fl(this,e),this.isEmpty())return NaN;let n=this.get(e,0);for(let r=1;r<this.columns;r++)this.get(e,r)>n&&(n=this.get(e,r));return n}maxRowIndex(e){fl(this,e),Ig(this);let n=this.get(e,0),r=[e,0];for(let i=1;i<this.columns;i++)this.get(e,i)>n&&(n=this.get(e,i),r[1]=i);return r}minRow(e){if(fl(this,e),this.isEmpty())return NaN;let n=this.get(e,0);for(let r=1;r<this.columns;r++)this.get(e,r)<n&&(n=this.get(e,r));return n}minRowIndex(e){fl(this,e),Ig(this);let n=this.get(e,0),r=[e,0];for(let i=1;i<this.columns;i++)this.get(e,i)<n&&(n=this.get(e,i),r[1]=i);return r}maxColumn(e){if(dl(this,e),this.isEmpty())return NaN;let n=this.get(0,e);for(let r=1;r<this.rows;r++)this.get(r,e)>n&&(n=this.get(r,e));return n}maxColumnIndex(e){dl(this,e),Ig(this);let n=this.get(0,e),r=[0,e];for(let i=1;i<this.rows;i++)this.get(i,e)>n&&(n=this.get(i,e),r[0]=i);return r}minColumn(e){if(dl(this,e),this.isEmpty())return NaN;let n=this.get(0,e);for(let r=1;r<this.rows;r++)this.get(r,e)<n&&(n=this.get(r,e));return n}minColumnIndex(e){dl(this,e),Ig(this);let n=this.get(0,e),r=[0,e];for(let i=1;i<this.rows;i++)this.get(i,e)<n&&(n=this.get(i,e),r[0]=i);return r}diag(){let e=Math.min(this.rows,this.columns),n=[];for(let r=0;r<e;r++)n.push(this.get(r,r));return n}norm(e="frobenius"){let n=0;if(e==="max")return this.max();if(e==="frobenius"){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)n=n+this.get(r,i)*this.get(r,i);return Math.sqrt(n)}else throw new RangeError(`unknown norm type: ${e}`)}cumulativeSum(){let e=0;for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)e+=this.get(n,r),this.set(n,r,e);return this}dot(e){Tn.isMatrix(e)&&(e=e.to1DArray());let n=this.to1DArray();if(n.length!==e.length)throw new RangeError("vectors do not have the same size");let r=0;for(let i=0;i<n.length;i++)r+=n[i]*e[i];return r}mmul(e){e=an.checkMatrix(e);let n=this.rows,r=this.columns,i=e.columns,s=new an(n,i),o=new Float64Array(r);for(let a=0;a<i;a++){for(let l=0;l<r;l++)o[l]=e.get(l,a);for(let l=0;l<n;l++){let c=0;for(let u=0;u<r;u++)c+=this.get(l,u)*o[u];s.set(l,a,c)}}return s}strassen2x2(e){e=an.checkMatrix(e);let n=new an(2,2);const r=this.get(0,0),i=e.get(0,0),s=this.get(0,1),o=e.get(0,1),a=this.get(1,0),l=e.get(1,0),c=this.get(1,1),u=e.get(1,1),h=(r+c)*(i+u),f=(a+c)*i,d=r*(o-u),p=c*(l-i),m=(r+s)*u,v=(a-r)*(i+o),y=(s-c)*(l+u),w=h+p-m+y,x=d+m,_=f+p,S=h-f+d+v;return n.set(0,0,w),n.set(0,1,x),n.set(1,0,_),n.set(1,1,S),n}strassen3x3(e){e=an.checkMatrix(e);let n=new an(3,3);const r=this.get(0,0),i=this.get(0,1),s=this.get(0,2),o=this.get(1,0),a=this.get(1,1),l=this.get(1,2),c=this.get(2,0),u=this.get(2,1),h=this.get(2,2),f=e.get(0,0),d=e.get(0,1),p=e.get(0,2),m=e.get(1,0),v=e.get(1,1),y=e.get(1,2),w=e.get(2,0),x=e.get(2,1),_=e.get(2,2),S=(r+i+s-o-a-u-h)*v,T=(r-o)*(-d+v),E=a*(-f+d+m-v-y-w+_),k=(-r+o+a)*(f-d+v),A=(o+a)*(-f+d),M=r*f,D=(-r+c+u)*(f-p+y),P=(-r+c)*(p-y),N=(c+u)*(-f+p),R=(r+i+s-a-l-c-u)*y,F=u*(-f+p+m-v-y-w+x),O=(-s+u+h)*(v+w-x),K=(s-h)*(v-x),J=s*w,re=(u+h)*(-w+x),ae=(-s+a+l)*(y+w-_),pe=(s-l)*(y-_),ke=(a+l)*(-w+_),Te=i*m,Ne=l*x,we=o*p,me=c*d,He=h*_,Fe=M+J+Te,je=S+k+A+M+O+J+re,Ve=M+D+N+R+J+ae+ke,Se=T+E+k+M+J+ae+pe,nt=T+k+A+M+Ne,Ct=J+ae+pe+ke+we,pt=M+D+P+F+O+K+J,Ht=O+K+J+re+me,Mt=M+D+P+N+He;return n.set(0,0,Fe),n.set(0,1,je),n.set(0,2,Ve),n.set(1,0,Se),n.set(1,1,nt),n.set(1,2,Ct),n.set(2,0,pt),n.set(2,1,Ht),n.set(2,2,Mt),n}mmulStrassen(e){e=an.checkMatrix(e);let n=this.clone(),r=n.rows,i=n.columns,s=e.rows,o=e.columns;i!==s&&console.warn(`Multiplying ${r} x ${i} and ${s} x ${o} matrix: dimensions do not match.`);function a(h,f,d){let p=h.rows,m=h.columns;if(p===f&&m===d)return h;{let v=Tn.zeros(f,d);return v=v.setSubMatrix(h,0,0),v}}let l=Math.max(r,s),c=Math.max(i,o);n=a(n,l,c),e=a(e,l,c);function u(h,f,d,p){if(d<=512||p<=512)return h.mmul(f);d%2==1&&p%2==1?(h=a(h,d+1,p+1),f=a(f,d+1,p+1)):d%2==1?(h=a(h,d+1,p),f=a(f,d+1,p)):p%2==1&&(h=a(h,d,p+1),f=a(f,d,p+1));let m=parseInt(h.rows/2,10),v=parseInt(h.columns/2,10),y=h.subMatrix(0,m-1,0,v-1),w=f.subMatrix(0,m-1,0,v-1),x=h.subMatrix(0,m-1,v,h.columns-1),_=f.subMatrix(0,m-1,v,f.columns-1),S=h.subMatrix(m,h.rows-1,0,v-1),T=f.subMatrix(m,f.rows-1,0,v-1),E=h.subMatrix(m,h.rows-1,v,h.columns-1),k=f.subMatrix(m,f.rows-1,v,f.columns-1),A=u(Tn.add(y,E),Tn.add(w,k),m,v),M=u(Tn.add(S,E),w,m,v),D=u(y,Tn.sub(_,k),m,v),P=u(E,Tn.sub(T,w),m,v),N=u(Tn.add(y,x),k,m,v),R=u(Tn.sub(S,y),Tn.add(w,_),m,v),F=u(Tn.sub(x,E),Tn.add(T,k),m,v),O=Tn.add(A,P);O.sub(N),O.add(F);let K=Tn.add(D,N),J=Tn.add(M,P),re=Tn.sub(A,M);re.add(D),re.add(R);let ae=Tn.zeros(2*O.rows,2*O.columns);return ae=ae.setSubMatrix(O,0,0),ae=ae.setSubMatrix(K,O.rows,0),ae=ae.setSubMatrix(J,0,O.columns),ae=ae.setSubMatrix(re,O.rows,O.columns),ae.subMatrix(0,d-1,0,p-1)}return u(n,e,l,c)}scaleRows(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:n=0,max:r=1}=e;if(!Number.isFinite(n))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(n>=r)throw new RangeError("min must be smaller than max");let i=new an(this.rows,this.columns);for(let s=0;s<this.rows;s++){const o=this.getRow(s);o.length>0&&rq(o,{min:n,max:r,output:o}),i.setRow(s,o)}return i}scaleColumns(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:n=0,max:r=1}=e;if(!Number.isFinite(n))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(n>=r)throw new RangeError("min must be smaller than max");let i=new an(this.rows,this.columns);for(let s=0;s<this.columns;s++){const o=this.getColumn(s);o.length&&rq(o,{min:n,max:r,output:o}),i.setColumn(s,o)}return i}flipRows(){const e=Math.ceil(this.columns/2);for(let n=0;n<this.rows;n++)for(let r=0;r<e;r++){let i=this.get(n,r),s=this.get(n,this.columns-1-r);this.set(n,r,s),this.set(n,this.columns-1-r,i)}return this}flipColumns(){const e=Math.ceil(this.rows/2);for(let n=0;n<this.columns;n++)for(let r=0;r<e;r++){let i=this.get(r,n),s=this.get(this.rows-1-r,n);this.set(r,n,s),this.set(this.rows-1-r,n,i)}return this}kroneckerProduct(e){e=an.checkMatrix(e);let n=this.rows,r=this.columns,i=e.rows,s=e.columns,o=new an(n*i,r*s);for(let a=0;a<n;a++)for(let l=0;l<r;l++)for(let c=0;c<i;c++)for(let u=0;u<s;u++)o.set(i*a+c,s*l+u,this.get(a,l)*e.get(c,u));return o}kroneckerSum(e){if(e=an.checkMatrix(e),!this.isSquare()||!e.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let n=this.rows,r=e.rows,i=this.kroneckerProduct(an.eye(r,r)),s=an.eye(n,n).kroneckerProduct(e);return i.add(s)}transpose(){let e=new an(this.columns,this.rows);for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)e.set(r,n,this.get(n,r));return e}sortRows(e=aq){for(let n=0;n<this.rows;n++)this.setRow(n,this.getRow(n).sort(e));return this}sortColumns(e=aq){for(let n=0;n<this.columns;n++)this.setColumn(n,this.getColumn(n).sort(e));return this}subMatrix(e,n,r,i){oq(this,e,n,r,i);let s=new an(n-e+1,i-r+1);for(let o=e;o<=n;o++)for(let a=r;a<=i;a++)s.set(o-e,a-r,this.get(o,a));return s}subMatrixRow(e,n,r){if(n===void 0&&(n=0),r===void 0&&(r=this.columns-1),n>r||n<0||n>=this.columns||r<0||r>=this.columns)throw new RangeError("Argument out of range");let i=new an(e.length,r-n+1);for(let s=0;s<e.length;s++)for(let o=n;o<=r;o++){if(e[s]<0||e[s]>=this.rows)throw new RangeError(`Row index out of range: ${e[s]}`);i.set(s,o-n,this.get(e[s],o))}return i}subMatrixColumn(e,n,r){if(n===void 0&&(n=0),r===void 0&&(r=this.rows-1),n>r||n<0||n>=this.rows||r<0||r>=this.rows)throw new RangeError("Argument out of range");let i=new an(r-n+1,e.length);for(let s=0;s<e.length;s++)for(let o=n;o<=r;o++){if(e[s]<0||e[s]>=this.columns)throw new RangeError(`Column index out of range: ${e[s]}`);i.set(o-n,s,this.get(o,e[s]))}return i}setSubMatrix(e,n,r){if(e=an.checkMatrix(e),e.isEmpty())return this;let i=n+e.rows-1,s=r+e.columns-1;oq(this,n,i,r,s);for(let o=0;o<e.rows;o++)for(let a=0;a<e.columns;a++)this.set(n+o,r+a,e.get(o,a));return this}selection(e,n){let r=fGe(this,e,n),i=new an(e.length,n.length);for(let s=0;s<r.row.length;s++){let o=r.row[s];for(let a=0;a<r.column.length;a++){let l=r.column[a];i.set(s,a,this.get(o,l))}}return i}trace(){let e=Math.min(this.rows,this.columns),n=0;for(let r=0;r<e;r++)n+=this.get(r,r);return n}clone(){let e=new an(this.rows,this.columns);for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)e.set(n,r,this.get(n,r));return e}sum(e){switch(e){case"row":return mGe(this);case"column":return gGe(this);case void 0:return vGe(this);default:throw new Error(`invalid option: ${e}`)}}product(e){switch(e){case"row":return yGe(this);case"column":return bGe(this);case void 0:return wGe(this);default:throw new Error(`invalid option: ${e}`)}}mean(e){const n=this.sum(e);switch(e){case"row":{for(let r=0;r<this.rows;r++)n[r]/=this.columns;return n}case"column":{for(let r=0;r<this.columns;r++)n[r]/=this.rows;return n}case void 0:return n/this.size;default:throw new Error(`invalid option: ${e}`)}}variance(e,n={}){if(typeof e=="object"&&(n=e,e=void 0),typeof n!="object")throw new TypeError("options must be an object");const{unbiased:r=!0,mean:i=this.mean(e)}=n;if(typeof r!="boolean")throw new TypeError("unbiased must be a boolean");switch(e){case"row":{if(!Array.isArray(i))throw new TypeError("mean must be an array");return xGe(this,r,i)}case"column":{if(!Array.isArray(i))throw new TypeError("mean must be an array");return _Ge(this,r,i)}case void 0:{if(typeof i!="number")throw new TypeError("mean must be a number");return SGe(this,r,i)}default:throw new Error(`invalid option: ${e}`)}}standardDeviation(e,n){typeof e=="object"&&(n=e,e=void 0);const r=this.variance(e,n);if(e===void 0)return Math.sqrt(r);for(let i=0;i<r.length;i++)r[i]=Math.sqrt(r[i]);return r}center(e,n={}){if(typeof e=="object"&&(n=e,e=void 0),typeof n!="object")throw new TypeError("options must be an object");const{center:r=this.mean(e)}=n;switch(e){case"row":{if(!Array.isArray(r))throw new TypeError("center must be an array");return CGe(this,r),this}case"column":{if(!Array.isArray(r))throw new TypeError("center must be an array");return TGe(this,r),this}case void 0:{if(typeof r!="number")throw new TypeError("center must be a number");return EGe(this,r),this}default:throw new Error(`invalid option: ${e}`)}}scale(e,n={}){if(typeof e=="object"&&(n=e,e=void 0),typeof n!="object")throw new TypeError("options must be an object");let r=n.scale;switch(e){case"row":{if(r===void 0)r=kGe(this);else if(!Array.isArray(r))throw new TypeError("scale must be an array");return AGe(this,r),this}case"column":{if(r===void 0)r=MGe(this);else if(!Array.isArray(r))throw new TypeError("scale must be an array");return IGe(this,r),this}case void 0:{if(r===void 0)r=NGe(this);else if(typeof r!="number")throw new TypeError("scale must be a number");return $Ge(this,r),this}default:throw new Error(`invalid option: ${e}`)}}toString(e){return sq(this,e)}}Tn.prototype.klass="Matrix";typeof Symbol!="undefined"&&(Tn.prototype[Symbol.for("nodejs.util.inspect.custom")]=lGe);function aq(t,e){return t-e}Tn.random=Tn.rand;Tn.randomInt=Tn.randInt;Tn.diagonal=Tn.diag;Tn.prototype.diagonal=Tn.prototype.diag;Tn.identity=Tn.eye;Tn.prototype.negate=Tn.prototype.neg;Tn.prototype.tensorProduct=Tn.prototype.kroneckerProduct;class an extends Tn{constructor(e,n){super();if(an.isMatrix(e))return e.clone();if(Number.isInteger(e)&&e>=0)if(this.data=[],Number.isInteger(n)&&n>=0)for(let r=0;r<e;r++)this.data.push(new Float64Array(n));else throw new TypeError("nColumns must be a positive integer");else if(Array.isArray(e)){const r=e;if(e=r.length,n=e?r[0].length:0,typeof n!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let i=0;i<e;i++){if(r[i].length!==n)throw new RangeError("Inconsistent array dimensions");this.data.push(Float64Array.from(r[i]))}}else throw new TypeError("First argument must be a positive number or an array");this.rows=e,this.columns=n}set(e,n,r){return this.data[e][n]=r,this}get(e,n){return this.data[e][n]}removeRow(e){return fl(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,n){return n===void 0&&(n=e,e=this.rows),fl(this,e,!0),n=Float64Array.from(Ag(this,n)),this.data.splice(e,0,n),this.rows+=1,this}removeColumn(e){dl(this,e);for(let n=0;n<this.rows;n++){const r=new Float64Array(this.columns-1);for(let i=0;i<e;i++)r[i]=this.data[n][i];for(let i=e+1;i<this.columns;i++)r[i-1]=this.data[n][i];this.data[n]=r}return this.columns-=1,this}addColumn(e,n){typeof n=="undefined"&&(n=e,e=this.columns),dl(this,e,!0),n=Mg(this,n);for(let r=0;r<this.rows;r++){const i=new Float64Array(this.columns+1);let s=0;for(;s<e;s++)i[s]=this.data[r][s];for(i[s++]=n[r];s<this.columns+1;s++)i[s]=this.data[r][s-1];this.data[r]=i}return this.columns+=1,this}}hGe(Tn,an);function RGe(t,e,n){return new JD(n).choice(t,{size:e})}function DGe(t,e,n,r){const i=new JD(r);var s=new Array(e);if(s[0]=Math.floor(i.random()*t.length),e>1){for(var o={dist:-1,index:-1},a=0;a<t.length;++a)n[s[0]][a]>o.dist&&(o.dist=n[s[0]][a],o.index=a);if(s[1]=o.index,e>2)for(var l=2;l<e;++l){for(var c={dist:-1,index:-1},u=0;u<t.length;++u){for(var h={dist:Number.MAX_VALUE,index:-1},f=0;f<l;++f)n[f][u]<h.dist&&s.indexOf(u)===-1&&(h={dist:n[f][u],index:u});h.dist!==Number.MAX_VALUE&&h.dist>c.dist&&(c=Object.assign({},h))}s[l]=c.index}}return s.map(d=>t[d])}function PGe(t,e,n={}){t=new an(t);const r=t.rows,i=new JD(n.seed),s=[],o=n.localTrials||2+Math.floor(Math.log(e)),a=i.randInt(r);s.push(t.getRow(a));let l=new an(1,t.rows);for(let f=0;f<t.rows;f++)l.set(0,f,MT(t.getRow(f),s[0]));let c=[lq(l.getRow(0))];const u=1/c[0][r-1];let h=an.mul(l,u);for(let f=1;f<e;f++){const d=i.choice(r,{replace:!0,size:o,probabilities:h[0]}),p=t.selection(d,FGe(t.columns)),m=OGe(p,t);let v,y,w;for(let x=0;x<o;x++){const _=an.min(l,[m.getRow(x)]),S=_.sum();(v===void 0||S<y)&&(v=d[x],y=S,w=_)}s[f]=t.getRow(v),l=w,c=[lq(l.getRow(0))],h=an.mul(l,1/c[0][r-1])}return s}function OGe(t,e){const n=new an(t.rows,e.rows);for(let r=0;r<t.rows;r++)for(let i=0;i<e.rows;i++)n.set(r,i,MT(t.getRow(r),e.getRow(i)));return n}function FGe(t){let e=[];for(let n=0;n<t;n++)e.push(n);return e}function lq(t){let e=[t[0]];for(let n=1;n<t.length;n++)e[n]=e[n-1]+t[n];return e}const DT=Symbol("distance");class QD{constructor(e,n,r,i,s){this.clusters=e,this.centroids=n,this.converged=r,this.iterations=i,this[DT]=s}nearest(e){const n=new Array(e.length),r=this.centroids.map(function(i){return i.centroid});return eq(e,r,n,this[DT])}computeInformation(e){for(var n=this.centroids.map(function(s){return{centroid:s,error:0,size:0}}),r=0;r<e.length;r++)n[this.clusters[r]].error+=this[DT](e[r],this.centroids[this.clusters[r]]),n[this.clusters[r]].size++;for(var i=0;i<this.centroids.length;i++)n[i].size?n[i].error/=n[i].size:n[i].error=null;return new QD(this.clusters,n,this.converged,this.iterations,this[DT])}}const LGe={maxIterations:100,tolerance:1e-6,withIterations:!1,initialization:"kmeans++",distanceFunction:MT};function cq(t,e,n,r,i,s){n=eq(e,t,n,i.distanceFunction);var o=XWe(t,e,n,r),a=KWe(o,t,i.distanceFunction,i.tolerance);return new QD(n,o,a,s,i.distanceFunction)}function*BGe(t,e,n,r,i){for(var s=!1,o=0,a;!s&&o<i.maxIterations;)a=cq(t,e,n,r,i,++o),yield a.computeInformation(e),s=a.converged,t=a.centroids}function zGe(t,e,n){if(n=Object.assign({},LGe,n),e<=0||e>t.length||!Number.isInteger(e))throw new Error("K should be a positive integer smaller than the number of points");var r;if(Array.isArray(n.initialization)){if(n.initialization.length!==e)throw new Error("The initial centers should have the same length as K");r=n.initialization}else switch(n.initialization){case"kmeans++":r=PGe(t,e,n);break;case"random":r=RGe(t,e,n.seed);break;case"mostDistant":r=DGe(t,e,qWe(t,n.distanceFunction),n.seed);break;default:throw new Error(`Unknown initialization method: "${n.initialization}"`)}n.maxIterations===0&&(n.maxIterations=Number.MAX_VALUE);var i=new Array(t.length);if(n.withIterations)return BGe(r,t,i,e,n);for(var s=!1,o=0,a;!s&&o<n.maxIterations;)a=cq(r,t,i,e,n,++o),s=a.converged,r=a.centroids;return a.computeInformation(t)}/**
    * @license
    * Copyright 2019 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */function VGe(t,e,n,r){return new(n||(n=Promise))(function(i,s){function o(c){try{l(r.next(c))}catch(u){s(u)}}function a(c){try{l(r.throw(c))}catch(u){s(u)}}function l(c){c.done?i(c.value):new n(function(u){u(c.value)}).then(o,a)}l((r=r.apply(t,e||[])).next())})}function UGe(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&u[0]?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){o=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){o.label=u[1];break}if(u[0]===6&&o.label<i[1]){o.label=i[1],i=u;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(u);break}i[2]&&o.ops.pop(),o.trys.pop();continue}u=e.call(t,o)}catch(h){u=[6,h],r=0}finally{n=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([l,c])}}}function WGe(t,e){return t==null&&e==null?null:t==null?e.clone():e===null?t.clone():t.concat(e,0)}function GGe(t,e){for(var n=[],r=0;r<t.length;r++)n.push({value:t[r],index:r});n.sort(function(o,a){return a.value-o.value});var i=new Float32Array(e),s=new Int32Array(e);for(r=0;r<e;r++)i[r]=n[r].value,s[r]=n[r].index;return{values:i,indices:s}}var HGe=function(){function t(){this.classDatasetMatrices={},this.classExampleCount={},this.labelToClassId={},this.nextClassId=0}return t.prototype.addExample=function(e,n){var r=this;if(this.exampleShape==null&&(this.exampleShape=e.shape),!wn(this.exampleShape,e.shape))throw new Error("Example shape provided, "+e.shape+" does not match previously provided example shapes "+this.exampleShape+".");this.clearTrainDatasetMatrix(),n in this.labelToClassId||(this.labelToClassId[n]=this.nextClassId++),de(function(){var i=r.normalizeVectorToUnitLength(e.flatten()),s=i.shape[0];if(r.classDatasetMatrices[n]==null)r.classDatasetMatrices[n]=i.as2D(1,s);else{var o=r.classDatasetMatrices[n].as2D(r.classExampleCount[n],s).concat(i.as2D(1,s),0);r.classDatasetMatrices[n].dispose(),r.classDatasetMatrices[n]=o}Tr(r.classDatasetMatrices[n]),r.classExampleCount[n]==null&&(r.classExampleCount[n]=0),r.classExampleCount[n]++})},t.prototype.similarities=function(e){var n=this;return de(function(){var r=n.normalizeVectorToUnitLength(e.flatten()),i=r.shape[0];if(n.trainDatasetMatrix==null){var s=null;for(var o in n.classDatasetMatrices)s=WGe(s,n.classDatasetMatrices[o]);n.trainDatasetMatrix=s}if(n.trainDatasetMatrix==null)return console.warn("Cannot predict without providing training examples."),null;Tr(n.trainDatasetMatrix);var a=n.getNumExamples();return n.trainDatasetMatrix.as2D(a,i).matMul(r.as2D(i,1)).as1D()})},t.prototype.predictClass=function(e,n){return n===void 0&&(n=3),VGe(this,void 0,void 0,function(){var r,i,s,o,a=this;return UGe(this,function(l){switch(l.label){case 0:if(n<1)throw new Error("Please provide a positive integer k value to predictClass.");if(this.getNumExamples()===0)throw new Error("You have not added any examples to the KNN classifier. Please add examples before calling predictClass.");return r=de(function(){return a.similarities(e).asType("float32")}),i=Math.min(n,this.getNumExamples()),o=GGe,[4,r.data()];case 1:return s=o.apply(void 0,[l.sent(),i]).indices,r.dispose(),[2,this.calculateTopClass(s,i)]}})})},t.prototype.clearClass=function(e){if(this.classDatasetMatrices[e]==null)throw new Error("Cannot clear invalid class "+e);this.classDatasetMatrices[e].dispose(),delete this.classDatasetMatrices[e],delete this.classExampleCount[e],this.clearTrainDatasetMatrix()},t.prototype.clearAllClasses=function(){for(var e in this.classDatasetMatrices)this.clearClass(e)},t.prototype.getClassExampleCount=function(){return this.classExampleCount},t.prototype.getClassifierDataset=function(){return this.classDatasetMatrices},t.prototype.getNumClasses=function(){return Object.keys(this.classExampleCount).length},t.prototype.setClassifierDataset=function(e){for(var n in this.clearTrainDatasetMatrix(),this.classDatasetMatrices=e,e)this.classExampleCount[n]=e[n].shape[0]},t.prototype.calculateTopClass=function(e,n){var r,i={};if(e==null)return{classIndex:this.labelToClassId[r],label:r,confidences:i};var s={},o=0;for(var a in this.classDatasetMatrices)o+=this.classExampleCount[a],s[a]=o;var l={};for(var a in this.classDatasetMatrices)l[a]=0;for(var c=0;c<e.length;c++){var u=e[c];for(var a in this.classDatasetMatrices)if(u<s[a]){l[a]++;break}}var h=0;for(var a in this.classDatasetMatrices){var f=l[a]/n;f>h&&(h=f,r=a),i[a]=f}return{classIndex:this.labelToClassId[r],label:r,confidences:i}},t.prototype.clearTrainDatasetMatrix=function(){this.trainDatasetMatrix!=null&&(this.trainDatasetMatrix.dispose(),this.trainDatasetMatrix=null)},t.prototype.normalizeVectorToUnitLength=function(e){return de(function(){var n=e.norm();return Tt(e,n)})},t.prototype.getNumExamples=function(){var e=0;for(var n in this.classDatasetMatrices)e+=this.classExampleCount[n];return e},t.prototype.dispose=function(){for(var e in this.clearTrainDatasetMatrix(),this.classDatasetMatrices)this.classDatasetMatrices[e].dispose()},t}();/**
    * @license
    * Copyright 2021 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */function PT(t,e,n,r){return new(n||(n=Promise))(function(i,s){function o(c){try{l(r.next(c))}catch(u){s(u)}}function a(c){try{l(r.throw(c))}catch(u){s(u)}}function l(c){c.done?i(c.value):new n(function(u){u(c.value)}).then(o,a)}l((r=r.apply(t,e||[])).next())})}function OT(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&u[0]?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){o=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){o.label=u[1];break}if(u[0]===6&&o.label<i[1]){o.label=i[1],i=u;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(u);break}i[2]&&o.ops.pop(),o.trys.pop();continue}u=e.call(t,o)}catch(h){u=[6,h],r=0}finally{n=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([l,c])}}}var jGe={0:"tench, Tinca tinca",1:"goldfish, Carassius auratus",2:"great white shark, white shark, man-eater, man-eating shark, Carcharodon carcharias",3:"tiger shark, Galeocerdo cuvieri",4:"hammerhead, hammerhead shark",5:"electric ray, crampfish, numbfish, torpedo",6:"stingray",7:"cock",8:"hen",9:"ostrich, Struthio camelus",10:"brambling, Fringilla montifringilla",11:"goldfinch, Carduelis carduelis",12:"house finch, linnet, Carpodacus mexicanus",13:"junco, snowbird",14:"indigo bunting, indigo finch, indigo bird, Passerina cyanea",15:"robin, American robin, Turdus migratorius",16:"bulbul",17:"jay",18:"magpie",19:"chickadee",20:"water ouzel, dipper",21:"kite",22:"bald eagle, American eagle, Haliaeetus leucocephalus",23:"vulture",24:"great grey owl, great gray owl, Strix nebulosa",25:"European fire salamander, Salamandra salamandra",26:"common newt, Triturus vulgaris",27:"eft",28:"spotted salamander, Ambystoma maculatum",29:"axolotl, mud puppy, Ambystoma mexicanum",30:"bullfrog, Rana catesbeiana",31:"tree frog, tree-frog",32:"tailed frog, bell toad, ribbed toad, tailed toad, Ascaphus trui",33:"loggerhead, loggerhead turtle, Caretta caretta",34:"leatherback turtle, leatherback, leathery turtle, Dermochelys coriacea",35:"mud turtle",36:"terrapin",37:"box turtle, box tortoise",38:"banded gecko",39:"common iguana, iguana, Iguana iguana",40:"American chameleon, anole, Anolis carolinensis",41:"whiptail, whiptail lizard",42:"agama",43:"frilled lizard, Chlamydosaurus kingi",44:"alligator lizard",45:"Gila monster, Heloderma suspectum",46:"green lizard, Lacerta viridis",47:"African chameleon, Chamaeleo chamaeleon",48:"Komodo dragon, Komodo lizard, dragon lizard, giant lizard, Varanus komodoensis",49:"African crocodile, Nile crocodile, Crocodylus niloticus",50:"American alligator, Alligator mississipiensis",51:"triceratops",52:"thunder snake, worm snake, Carphophis amoenus",53:"ringneck snake, ring-necked snake, ring snake",54:"hognose snake, puff adder, sand viper",55:"green snake, grass snake",56:"king snake, kingsnake",57:"garter snake, grass snake",58:"water snake",59:"vine snake",60:"night snake, Hypsiglena torquata",61:"boa constrictor, Constrictor constrictor",62:"rock python, rock snake, Python sebae",63:"Indian cobra, Naja naja",64:"green mamba",65:"sea snake",66:"horned viper, cerastes, sand viper, horned asp, Cerastes cornutus",67:"diamondback, diamondback rattlesnake, Crotalus adamanteus",68:"sidewinder, horned rattlesnake, Crotalus cerastes",69:"trilobite",70:"harvestman, daddy longlegs, Phalangium opilio",71:"scorpion",72:"black and gold garden spider, Argiope aurantia",73:"barn spider, Araneus cavaticus",74:"garden spider, Aranea diademata",75:"black widow, Latrodectus mactans",76:"tarantula",77:"wolf spider, hunting spider",78:"tick",79:"centipede",80:"black grouse",81:"ptarmigan",82:"ruffed grouse, partridge, Bonasa umbellus",83:"prairie chicken, prairie grouse, prairie fowl",84:"peacock",85:"quail",86:"partridge",87:"African grey, African gray, Psittacus erithacus",88:"macaw",89:"sulphur-crested cockatoo, Kakatoe galerita, Cacatua galerita",90:"lorikeet",91:"coucal",92:"bee eater",93:"hornbill",94:"hummingbird",95:"jacamar",96:"toucan",97:"drake",98:"red-breasted merganser, Mergus serrator",99:"goose",100:"black swan, Cygnus atratus",101:"tusker",102:"echidna, spiny anteater, anteater",103:"platypus, duckbill, duckbilled platypus, duck-billed platypus, Ornithorhynchus anatinus",104:"wallaby, brush kangaroo",105:"koala, koala bear, kangaroo bear, native bear, Phascolarctos cinereus",106:"wombat",107:"jelly fish",108:"sea anemone, anemone",109:"brain coral",110:"flatworm, platyhelminth",111:"nematode, nematode worm, roundworm",112:"conch",113:"snail",114:"slug",115:"sea slug, nudibranch",116:"chiton, coat-of-mail shell, sea cradle, polyplacophore",117:"chambered nautilus, pearly nautilus, nautilus",118:"Dungeness crab, Cancer magister",119:"rock crab, Cancer irroratus",120:"fiddler crab",121:"king crab, Alaska crab, Alaskan king crab, Alaska king crab, Paralithodes camtschatica",122:"American lobster, Northern lobster, Maine lobster, Homarus americanus",123:"spiny lobster, langouste, rock lobster, crawfish, crayfish, sea crawfish",124:"crayfish, crawfish, crawdad, crawdaddy",125:"hermit crab",126:"isopod",127:"white stork, Ciconia ciconia",128:"black stork, Ciconia nigra",129:"spoonbill",130:"flamingo",131:"little blue heron, Egretta caerulea",132:"American egret, great white heron, Egretta albus",133:"bittern",134:"crane",135:"limpkin, Aramus pictus",136:"European gallinule, Porphyrio porphyrio",137:"American coot, marsh hen, mud hen, water hen, Fulica americana",138:"bustard",139:"ruddy turnstone, Arenaria interpres",140:"red-backed sandpiper, dunlin, Erolia alpina",141:"redshank, Tringa totanus",142:"dowitcher",143:"oystercatcher, oyster catcher",144:"pelican",145:"king penguin, Aptenodytes patagonica",146:"albatross, mollymawk",147:"grey whale, gray whale, devilfish, Eschrichtius gibbosus, Eschrichtius robustus",148:"killer whale, killer, orca, grampus, sea wolf, Orcinus orca",149:"dugong, Dugong dugon",150:"sea lion",151:"Chihuahua",152:"Japanese spaniel",153:"Maltese dog, Maltese terrier, Maltese",154:"Pekinese, Pekingese, Peke",155:"Shih-Tzu",156:"Blenheim spaniel",157:"papillon",158:"toy terrier",159:"Rhodesian ridgeback",160:"Afghan hound, Afghan",161:"basset, basset hound",162:"beagle",163:"bloodhound, sleuthhound",164:"bluetick",165:"black-and-tan coonhound",166:"Walker hound, Walker foxhound",167:"English foxhound",168:"redbone",169:"borzoi, Russian wolfhound",170:"Irish wolfhound",171:"Italian greyhound",172:"whippet",173:"Ibizan hound, Ibizan Podenco",174:"Norwegian elkhound, elkhound",175:"otterhound, otter hound",176:"Saluki, gazelle hound",177:"Scottish deerhound, deerhound",178:"Weimaraner",179:"Staffordshire bullterrier, Staffordshire bull terrier",180:"American Staffordshire terrier, Staffordshire terrier, American pit bull terrier, pit bull terrier",181:"Bedlington terrier",182:"Border terrier",183:"Kerry blue terrier",184:"Irish terrier",185:"Norfolk terrier",186:"Norwich terrier",187:"Yorkshire terrier",188:"wire-haired fox terrier",189:"Lakeland terrier",190:"Sealyham terrier, Sealyham",191:"Airedale, Airedale terrier",192:"cairn, cairn terrier",193:"Australian terrier",194:"Dandie Dinmont, Dandie Dinmont terrier",195:"Boston bull, Boston terrier",196:"miniature schnauzer",197:"giant schnauzer",198:"standard schnauzer",199:"Scotch terrier, Scottish terrier, Scottie",200:"Tibetan terrier, chrysanthemum dog",201:"silky terrier, Sydney silky",202:"soft-coated wheaten terrier",203:"West Highland white terrier",204:"Lhasa, Lhasa apso",205:"flat-coated retriever",206:"curly-coated retriever",207:"golden retriever",208:"Labrador retriever",209:"Chesapeake Bay retriever",210:"German short-haired pointer",211:"vizsla, Hungarian pointer",212:"English setter",213:"Irish setter, red setter",214:"Gordon setter",215:"Brittany spaniel",216:"clumber, clumber spaniel",217:"English springer, English springer spaniel",218:"Welsh springer spaniel",219:"cocker spaniel, English cocker spaniel, cocker",220:"Sussex spaniel",221:"Irish water spaniel",222:"kuvasz",223:"schipperke",224:"groenendael",225:"malinois",226:"briard",227:"kelpie",228:"komondor",229:"Old English sheepdog, bobtail",230:"Shetland sheepdog, Shetland sheep dog, Shetland",231:"collie",232:"Border collie",233:"Bouvier des Flandres, Bouviers des Flandres",234:"Rottweiler",235:"German shepherd, German shepherd dog, German police dog, alsatian",236:"Doberman, Doberman pinscher",237:"miniature pinscher",238:"Greater Swiss Mountain dog",239:"Bernese mountain dog",240:"Appenzeller",241:"EntleBucher",242:"boxer",243:"bull mastiff",244:"Tibetan mastiff",245:"French bulldog",246:"Great Dane",247:"Saint Bernard, St Bernard",248:"Eskimo dog, husky",249:"malamute, malemute, Alaskan malamute",250:"Siberian husky",251:"dalmatian, coach dog, carriage dog",252:"affenpinscher, monkey pinscher, monkey dog",253:"basenji",254:"pug, pug-dog",255:"Leonberg",256:"Newfoundland, Newfoundland dog",257:"Great Pyrenees",258:"Samoyed, Samoyede",259:"Pomeranian",260:"chow, chow chow",261:"keeshond",262:"Brabancon griffon",263:"Pembroke, Pembroke Welsh corgi",264:"Cardigan, Cardigan Welsh corgi",265:"toy poodle",266:"miniature poodle",267:"standard poodle",268:"Mexican hairless",269:"timber wolf, grey wolf, gray wolf, Canis lupus",270:"white wolf, Arctic wolf, Canis lupus tundrarum",271:"red wolf, maned wolf, Canis rufus, Canis niger",272:"coyote, prairie wolf, brush wolf, Canis latrans",273:"dingo, warrigal, warragal, Canis dingo",274:"dhole, Cuon alpinus",275:"African hunting dog, hyena dog, Cape hunting dog, Lycaon pictus",276:"hyena, hyaena",277:"red fox, Vulpes vulpes",278:"kit fox, Vulpes macrotis",279:"Arctic fox, white fox, Alopex lagopus",280:"grey fox, gray fox, Urocyon cinereoargenteus",281:"tabby, tabby cat",282:"tiger cat",283:"Persian cat",284:"Siamese cat, Siamese",285:"Egyptian cat",286:"cougar, puma, catamount, mountain lion, painter, panther, Felis concolor",287:"lynx, catamount",288:"leopard, Panthera pardus",289:"snow leopard, ounce, Panthera uncia",290:"jaguar, panther, Panthera onca, Felis onca",291:"lion, king of beasts, Panthera leo",292:"tiger, Panthera tigris",293:"cheetah, chetah, Acinonyx jubatus",294:"brown bear, bruin, Ursus arctos",295:"American black bear, black bear, Ursus americanus, Euarctos americanus",296:"ice bear, polar bear, Ursus Maritimus, Thalarctos maritimus",297:"sloth bear, Melursus ursinus, Ursus ursinus",298:"mongoose",299:"meerkat, mierkat",300:"tiger beetle",301:"ladybug, ladybeetle, lady beetle, ladybird, ladybird beetle",302:"ground beetle, carabid beetle",303:"long-horned beetle, longicorn, longicorn beetle",304:"leaf beetle, chrysomelid",305:"dung beetle",306:"rhinoceros beetle",307:"weevil",308:"fly",309:"bee",310:"ant, emmet, pismire",311:"grasshopper, hopper",312:"cricket",313:"walking stick, walkingstick, stick insect",314:"cockroach, roach",315:"mantis, mantid",316:"cicada, cicala",317:"leafhopper",318:"lacewing, lacewing fly",319:"dragonfly, darning needle, devil's darning needle, sewing needle, snake feeder, snake doctor, mosquito hawk, skeeter hawk",320:"damselfly",321:"admiral",322:"ringlet, ringlet butterfly",323:"monarch, monarch butterfly, milkweed butterfly, Danaus plexippus",324:"cabbage butterfly",325:"sulphur butterfly, sulfur butterfly",326:"lycaenid, lycaenid butterfly",327:"starfish, sea star",328:"sea urchin",329:"sea cucumber, holothurian",330:"wood rabbit, cottontail, cottontail rabbit",331:"hare",332:"Angora, Angora rabbit",333:"hamster",334:"porcupine, hedgehog",335:"fox squirrel, eastern fox squirrel, Sciurus niger",336:"marmot",337:"beaver",338:"guinea pig, Cavia cobaya",339:"sorrel",340:"zebra",341:"hog, pig, grunter, squealer, Sus scrofa",342:"wild boar, boar, Sus scrofa",343:"warthog",344:"hippopotamus, hippo, river horse, Hippopotamus amphibius",345:"ox",346:"water buffalo, water ox, Asiatic buffalo, Bubalus bubalis",347:"bison",348:"ram, tup",349:"bighorn, bighorn sheep, cimarron, Rocky Mountain bighorn, Rocky Mountain sheep, Ovis canadensis",350:"ibex, Capra ibex",351:"hartebeest",352:"impala, Aepyceros melampus",353:"gazelle",354:"Arabian camel, dromedary, Camelus dromedarius",355:"llama",356:"weasel",357:"mink",358:"polecat, fitch, foulmart, foumart, Mustela putorius",359:"black-footed ferret, ferret, Mustela nigripes",360:"otter",361:"skunk, polecat, wood pussy",362:"badger",363:"armadillo",364:"three-toed sloth, ai, Bradypus tridactylus",365:"orangutan, orang, orangutang, Pongo pygmaeus",366:"gorilla, Gorilla gorilla",367:"chimpanzee, chimp, Pan troglodytes",368:"gibbon, Hylobates lar",369:"siamang, Hylobates syndactylus, Symphalangus syndactylus",370:"guenon, guenon monkey",371:"patas, hussar monkey, Erythrocebus patas",372:"baboon",373:"macaque",374:"langur",375:"colobus, colobus monkey",376:"proboscis monkey, Nasalis larvatus",377:"marmoset",378:"capuchin, ringtail, Cebus capucinus",379:"howler monkey, howler",380:"titi, titi monkey",381:"spider monkey, Ateles geoffroyi",382:"squirrel monkey, Saimiri sciureus",383:"Madagascar cat, ring-tailed lemur, Lemur catta",384:"indri, indris, Indri indri, Indri brevicaudatus",385:"Indian elephant, Elephas maximus",386:"African elephant, Loxodonta africana",387:"lesser panda, red panda, panda, bear cat, cat bear, Ailurus fulgens",388:"giant panda, panda, panda bear, coon bear, Ailuropoda melanoleuca",389:"barracouta, snoek",390:"eel",391:"coho, cohoe, coho salmon, blue jack, silver salmon, Oncorhynchus kisutch",392:"rock beauty, Holocanthus tricolor",393:"anemone fish",394:"sturgeon",395:"gar, garfish, garpike, billfish, Lepisosteus osseus",396:"lionfish",397:"puffer, pufferfish, blowfish, globefish",398:"abacus",399:"abaya",400:"academic gown, academic robe, judge's robe",401:"accordion, piano accordion, squeeze box",402:"acoustic guitar",403:"aircraft carrier, carrier, flattop, attack aircraft carrier",404:"airliner",405:"airship, dirigible",406:"altar",407:"ambulance",408:"amphibian, amphibious vehicle",409:"analog clock",410:"apiary, bee house",411:"apron",412:"ashcan, trash can, garbage can, wastebin, ash bin, ash-bin, ashbin, dustbin, trash barrel, trash bin",413:"assault rifle, assault gun",414:"backpack, back pack, knapsack, packsack, rucksack, haversack",415:"bakery, bakeshop, bakehouse",416:"balance beam, beam",417:"balloon",418:"ballpoint, ballpoint pen, ballpen, Biro",419:"Band Aid",420:"banjo",421:"bannister, banister, balustrade, balusters, handrail",422:"barbell",423:"barber chair",424:"barbershop",425:"barn",426:"barometer",427:"barrel, cask",428:"barrow, garden cart, lawn cart, wheelbarrow",429:"baseball",430:"basketball",431:"bassinet",432:"bassoon",433:"bathing cap, swimming cap",434:"bath towel",435:"bathtub, bathing tub, bath, tub",436:"beach wagon, station wagon, wagon, estate car, beach waggon, station waggon, waggon",437:"beacon, lighthouse, beacon light, pharos",438:"beaker",439:"bearskin, busby, shako",440:"beer bottle",441:"beer glass",442:"bell cote, bell cot",443:"bib",444:"bicycle-built-for-two, tandem bicycle, tandem",445:"bikini, two-piece",446:"binder, ring-binder",447:"binoculars, field glasses, opera glasses",448:"birdhouse",449:"boathouse",450:"bobsled, bobsleigh, bob",451:"bolo tie, bolo, bola tie, bola",452:"bonnet, poke bonnet",453:"bookcase",454:"bookshop, bookstore, bookstall",455:"bottlecap",456:"bow",457:"bow tie, bow-tie, bowtie",458:"brass, memorial tablet, plaque",459:"brassiere, bra, bandeau",460:"breakwater, groin, groyne, mole, bulwark, seawall, jetty",461:"breastplate, aegis, egis",462:"broom",463:"bucket, pail",464:"buckle",465:"bulletproof vest",466:"bullet train, bullet",467:"butcher shop, meat market",468:"cab, hack, taxi, taxicab",469:"caldron, cauldron",470:"candle, taper, wax light",471:"cannon",472:"canoe",473:"can opener, tin opener",474:"cardigan",475:"car mirror",476:"carousel, carrousel, merry-go-round, roundabout, whirligig",477:"carpenter's kit, tool kit",478:"carton",479:"car wheel",480:"cash machine, cash dispenser, automated teller machine, automatic teller machine, automated teller, automatic teller, ATM",481:"cassette",482:"cassette player",483:"castle",484:"catamaran",485:"CD player",486:"cello, violoncello",487:"cellular telephone, cellular phone, cellphone, cell, mobile phone",488:"chain",489:"chainlink fence",490:"chain mail, ring mail, mail, chain armor, chain armour, ring armor, ring armour",491:"chain saw, chainsaw",492:"chest",493:"chiffonier, commode",494:"chime, bell, gong",495:"china cabinet, china closet",496:"Christmas stocking",497:"church, church building",498:"cinema, movie theater, movie theatre, movie house, picture palace",499:"cleaver, meat cleaver, chopper",500:"cliff dwelling",501:"cloak",502:"clog, geta, patten, sabot",503:"cocktail shaker",504:"coffee mug",505:"coffeepot",506:"coil, spiral, volute, whorl, helix",507:"combination lock",508:"computer keyboard, keypad",509:"confectionery, confectionary, candy store",510:"container ship, containership, container vessel",511:"convertible",512:"corkscrew, bottle screw",513:"cornet, horn, trumpet, trump",514:"cowboy boot",515:"cowboy hat, ten-gallon hat",516:"cradle",517:"crane",518:"crash helmet",519:"crate",520:"crib, cot",521:"Crock Pot",522:"croquet ball",523:"crutch",524:"cuirass",525:"dam, dike, dyke",526:"desk",527:"desktop computer",528:"dial telephone, dial phone",529:"diaper, nappy, napkin",530:"digital clock",531:"digital watch",532:"dining table, board",533:"dishrag, dishcloth",534:"dishwasher, dish washer, dishwashing machine",535:"disk brake, disc brake",536:"dock, dockage, docking facility",537:"dogsled, dog sled, dog sleigh",538:"dome",539:"doormat, welcome mat",540:"drilling platform, offshore rig",541:"drum, membranophone, tympan",542:"drumstick",543:"dumbbell",544:"Dutch oven",545:"electric fan, blower",546:"electric guitar",547:"electric locomotive",548:"entertainment center",549:"envelope",550:"espresso maker",551:"face powder",552:"feather boa, boa",553:"file, file cabinet, filing cabinet",554:"fireboat",555:"fire engine, fire truck",556:"fire screen, fireguard",557:"flagpole, flagstaff",558:"flute, transverse flute",559:"folding chair",560:"football helmet",561:"forklift",562:"fountain",563:"fountain pen",564:"four-poster",565:"freight car",566:"French horn, horn",567:"frying pan, frypan, skillet",568:"fur coat",569:"garbage truck, dustcart",570:"gasmask, respirator, gas helmet",571:"gas pump, gasoline pump, petrol pump, island dispenser",572:"goblet",573:"go-kart",574:"golf ball",575:"golfcart, golf cart",576:"gondola",577:"gong, tam-tam",578:"gown",579:"grand piano, grand",580:"greenhouse, nursery, glasshouse",581:"grille, radiator grille",582:"grocery store, grocery, food market, market",583:"guillotine",584:"hair slide",585:"hair spray",586:"half track",587:"hammer",588:"hamper",589:"hand blower, blow dryer, blow drier, hair dryer, hair drier",590:"hand-held computer, hand-held microcomputer",591:"handkerchief, hankie, hanky, hankey",592:"hard disc, hard disk, fixed disk",593:"harmonica, mouth organ, harp, mouth harp",594:"harp",595:"harvester, reaper",596:"hatchet",597:"holster",598:"home theater, home theatre",599:"honeycomb",600:"hook, claw",601:"hoopskirt, crinoline",602:"horizontal bar, high bar",603:"horse cart, horse-cart",604:"hourglass",605:"iPod",606:"iron, smoothing iron",607:"jack-o'-lantern",608:"jean, blue jean, denim",609:"jeep, landrover",610:"jersey, T-shirt, tee shirt",611:"jigsaw puzzle",612:"jinrikisha, ricksha, rickshaw",613:"joystick",614:"kimono",615:"knee pad",616:"knot",617:"lab coat, laboratory coat",618:"ladle",619:"lampshade, lamp shade",620:"laptop, laptop computer",621:"lawn mower, mower",622:"lens cap, lens cover",623:"letter opener, paper knife, paperknife",624:"library",625:"lifeboat",626:"lighter, light, igniter, ignitor",627:"limousine, limo",628:"liner, ocean liner",629:"lipstick, lip rouge",630:"Loafer",631:"lotion",632:"loudspeaker, speaker, speaker unit, loudspeaker system, speaker system",633:"loupe, jeweler's loupe",634:"lumbermill, sawmill",635:"magnetic compass",636:"mailbag, postbag",637:"mailbox, letter box",638:"maillot",639:"maillot, tank suit",640:"manhole cover",641:"maraca",642:"marimba, xylophone",643:"mask",644:"matchstick",645:"maypole",646:"maze, labyrinth",647:"measuring cup",648:"medicine chest, medicine cabinet",649:"megalith, megalithic structure",650:"microphone, mike",651:"microwave, microwave oven",652:"military uniform",653:"milk can",654:"minibus",655:"miniskirt, mini",656:"minivan",657:"missile",658:"mitten",659:"mixing bowl",660:"mobile home, manufactured home",661:"Model T",662:"modem",663:"monastery",664:"monitor",665:"moped",666:"mortar",667:"mortarboard",668:"mosque",669:"mosquito net",670:"motor scooter, scooter",671:"mountain bike, all-terrain bike, off-roader",672:"mountain tent",673:"mouse, computer mouse",674:"mousetrap",675:"moving van",676:"muzzle",677:"nail",678:"neck brace",679:"necklace",680:"nipple",681:"notebook, notebook computer",682:"obelisk",683:"oboe, hautboy, hautbois",684:"ocarina, sweet potato",685:"odometer, hodometer, mileometer, milometer",686:"oil filter",687:"organ, pipe organ",688:"oscilloscope, scope, cathode-ray oscilloscope, CRO",689:"overskirt",690:"oxcart",691:"oxygen mask",692:"packet",693:"paddle, boat paddle",694:"paddlewheel, paddle wheel",695:"padlock",696:"paintbrush",697:"pajama, pyjama, pj's, jammies",698:"palace",699:"panpipe, pandean pipe, syrinx",700:"paper towel",701:"parachute, chute",702:"parallel bars, bars",703:"park bench",704:"parking meter",705:"passenger car, coach, carriage",706:"patio, terrace",707:"pay-phone, pay-station",708:"pedestal, plinth, footstall",709:"pencil box, pencil case",710:"pencil sharpener",711:"perfume, essence",712:"Petri dish",713:"photocopier",714:"pick, plectrum, plectron",715:"pickelhaube",716:"picket fence, paling",717:"pickup, pickup truck",718:"pier",719:"piggy bank, penny bank",720:"pill bottle",721:"pillow",722:"ping-pong ball",723:"pinwheel",724:"pirate, pirate ship",725:"pitcher, ewer",726:"plane, carpenter's plane, woodworking plane",727:"planetarium",728:"plastic bag",729:"plate rack",730:"plow, plough",731:"plunger, plumber's helper",732:"Polaroid camera, Polaroid Land camera",733:"pole",734:"police van, police wagon, paddy wagon, patrol wagon, wagon, black Maria",735:"poncho",736:"pool table, billiard table, snooker table",737:"pop bottle, soda bottle",738:"pot, flowerpot",739:"potter's wheel",740:"power drill",741:"prayer rug, prayer mat",742:"printer",743:"prison, prison house",744:"projectile, missile",745:"projector",746:"puck, hockey puck",747:"punching bag, punch bag, punching ball, punchball",748:"purse",749:"quill, quill pen",750:"quilt, comforter, comfort, puff",751:"racer, race car, racing car",752:"racket, racquet",753:"radiator",754:"radio, wireless",755:"radio telescope, radio reflector",756:"rain barrel",757:"recreational vehicle, RV, R.V.",758:"reel",759:"reflex camera",760:"refrigerator, icebox",761:"remote control, remote",762:"restaurant, eating house, eating place, eatery",763:"revolver, six-gun, six-shooter",764:"rifle",765:"rocking chair, rocker",766:"rotisserie",767:"rubber eraser, rubber, pencil eraser",768:"rugby ball",769:"rule, ruler",770:"running shoe",771:"safe",772:"safety pin",773:"saltshaker, salt shaker",774:"sandal",775:"sarong",776:"sax, saxophone",777:"scabbard",778:"scale, weighing machine",779:"school bus",780:"schooner",781:"scoreboard",782:"screen, CRT screen",783:"screw",784:"screwdriver",785:"seat belt, seatbelt",786:"sewing machine",787:"shield, buckler",788:"shoe shop, shoe-shop, shoe store",789:"shoji",790:"shopping basket",791:"shopping cart",792:"shovel",793:"shower cap",794:"shower curtain",795:"ski",796:"ski mask",797:"sleeping bag",798:"slide rule, slipstick",799:"sliding door",800:"slot, one-armed bandit",801:"snorkel",802:"snowmobile",803:"snowplow, snowplough",804:"soap dispenser",805:"soccer ball",806:"sock",807:"solar dish, solar collector, solar furnace",808:"sombrero",809:"soup bowl",810:"space bar",811:"space heater",812:"space shuttle",813:"spatula",814:"speedboat",815:"spider web, spider's web",816:"spindle",817:"sports car, sport car",818:"spotlight, spot",819:"stage",820:"steam locomotive",821:"steel arch bridge",822:"steel drum",823:"stethoscope",824:"stole",825:"stone wall",826:"stopwatch, stop watch",827:"stove",828:"strainer",829:"streetcar, tram, tramcar, trolley, trolley car",830:"stretcher",831:"studio couch, day bed",832:"stupa, tope",833:"submarine, pigboat, sub, U-boat",834:"suit, suit of clothes",835:"sundial",836:"sunglass",837:"sunglasses, dark glasses, shades",838:"sunscreen, sunblock, sun blocker",839:"suspension bridge",840:"swab, swob, mop",841:"sweatshirt",842:"swimming trunks, bathing trunks",843:"swing",844:"switch, electric switch, electrical switch",845:"syringe",846:"table lamp",847:"tank, army tank, armored combat vehicle, armoured combat vehicle",848:"tape player",849:"teapot",850:"teddy, teddy bear",851:"television, television system",852:"tennis ball",853:"thatch, thatched roof",854:"theater curtain, theatre curtain",855:"thimble",856:"thresher, thrasher, threshing machine",857:"throne",858:"tile roof",859:"toaster",860:"tobacco shop, tobacconist shop, tobacconist",861:"toilet seat",862:"torch",863:"totem pole",864:"tow truck, tow car, wrecker",865:"toyshop",866:"tractor",867:"trailer truck, tractor trailer, trucking rig, rig, articulated lorry, semi",868:"tray",869:"trench coat",870:"tricycle, trike, velocipede",871:"trimaran",872:"tripod",873:"triumphal arch",874:"trolleybus, trolley coach, trackless trolley",875:"trombone",876:"tub, vat",877:"turnstile",878:"typewriter keyboard",879:"umbrella",880:"unicycle, monocycle",881:"upright, upright piano",882:"vacuum, vacuum cleaner",883:"vase",884:"vault",885:"velvet",886:"vending machine",887:"vestment",888:"viaduct",889:"violin, fiddle",890:"volleyball",891:"waffle iron",892:"wall clock",893:"wallet, billfold, notecase, pocketbook",894:"wardrobe, closet, press",895:"warplane, military plane",896:"washbasin, handbasin, washbowl, lavabo, wash-hand basin",897:"washer, automatic washer, washing machine",898:"water bottle",899:"water jug",900:"water tower",901:"whiskey jug",902:"whistle",903:"wig",904:"window screen",905:"window shade",906:"Windsor tie",907:"wine bottle",908:"wing",909:"wok",910:"wooden spoon",911:"wool, woolen, woollen",912:"worm fence, snake fence, snake-rail fence, Virginia fence",913:"wreck",914:"yawl",915:"yurt",916:"web site, website, internet site, site",917:"comic book",918:"crossword puzzle, crossword",919:"street sign",920:"traffic light, traffic signal, stoplight",921:"book jacket, dust cover, dust jacket, dust wrapper",922:"menu",923:"plate",924:"guacamole",925:"consomme",926:"hot pot, hotpot",927:"trifle",928:"ice cream, icecream",929:"ice lolly, lolly, lollipop, popsicle",930:"French loaf",931:"bagel, beigel",932:"pretzel",933:"cheeseburger",934:"hotdog, hot dog, red hot",935:"mashed potato",936:"head cabbage",937:"broccoli",938:"cauliflower",939:"zucchini, courgette",940:"spaghetti squash",941:"acorn squash",942:"butternut squash",943:"cucumber, cuke",944:"artichoke, globe artichoke",945:"bell pepper",946:"cardoon",947:"mushroom",948:"Granny Smith",949:"strawberry",950:"orange",951:"lemon",952:"fig",953:"pineapple, ananas",954:"banana",955:"jackfruit, jak, jack",956:"custard apple",957:"pomegranate",958:"hay",959:"carbonara",960:"chocolate sauce, chocolate syrup",961:"dough",962:"meat loaf, meatloaf",963:"pizza, pizza pie",964:"potpie",965:"burrito",966:"red wine",967:"espresso",968:"cup",969:"eggnog",970:"alp",971:"bubble",972:"cliff, drop, drop-off",973:"coral reef",974:"geyser",975:"lakeside, lakeshore",976:"promontory, headland, head, foreland",977:"sandbar, sand bar",978:"seashore, coast, seacoast, sea-coast",979:"valley, vale",980:"volcano",981:"ballplayer, baseball player",982:"groom, bridegroom",983:"scuba diver",984:"rapeseed",985:"daisy",986:"yellow lady's slipper, yellow lady-slipper, Cypripedium calceolus, Cypripedium parviflorum",987:"corn",988:"acorn",989:"hip, rose hip, rosehip",990:"buckeye, horse chestnut, conker",991:"coral fungus",992:"agaric",993:"gyromitra",994:"stinkhorn, carrion fungus",995:"earthstar",996:"hen-of-the-woods, hen of the woods, Polyporus frondosus, Grifola frondosa",997:"bolete",998:"ear, spike, capitulum",999:"toilet tissue, toilet paper, bathroom tissue"},_h=224,qGe={"1.00":"module_apply_default/MobilenetV1/Logits/global_pool","2.00":"module_apply_default/MobilenetV2/Logits/AvgPool"},Ng={"1.00":{.25:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_025_224/classification/1",inputRange:[0,1]},"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_050_224/classification/1",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_075_224/classification/1",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_100_224/classification/1",inputRange:[0,1]}},"2.00":{"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_050_224/classification/2",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_075_224/classification/2",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_100_224/classification/2",inputRange:[0,1]}}};function uq(t){return t===void 0&&(t={version:1,alpha:1}),PT(this,void 0,void 0,function(){var e,n,r,i,s,o,a;return OT(this,function(l){switch(l.label){case 0:if(hV==null)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");if(r=t.version.toFixed(2),i=t.alpha?t.alpha.toFixed(2):"",s=-1,o=1,t.modelUrl==null){if(!(r in Ng))throw new Error("Invalid version of MobileNet. Valid versions are: "+Object.keys(Ng));if(!(i in Ng[r]))throw new Error("MobileNet constructed with invalid alpha "+t.alpha+". Valid multipliers for this version are: "+Object.keys(Ng[r])+".");e=Ng[r][i].inputRange,s=e[0],o=e[1]}return t.inputRange!=null&&(n=t.inputRange,s=n[0],o=n[1]),[4,(a=new XGe(r,i,t.modelUrl,s,o)).load()];case 1:return l.sent(),[2,a]}})})}var XGe=function(){function t(e,n,r,i,s){i===void 0&&(i=-1),s===void 0&&(s=1),this.version=e,this.alpha=n,this.modelUrl=r,this.inputMin=i,this.inputMax=s,this.normalizationConstant=(s-i)/255}return t.prototype.load=function(){return PT(this,void 0,void 0,function(){var e,n,r,i,s=this;return OT(this,function(o){switch(o.label){case 0:return this.modelUrl?(e=this,[4,Ff(this.modelUrl)]):[3,2];case 1:return e.model=o.sent(),[3,4];case 2:return n=Ng[this.version][this.alpha].url,r=this,[4,Ff(n,{fromTFHub:!0})];case 3:r.model=o.sent(),o.label=4;case 4:return[4,(i=de(function(){return s.model.predict(zr([1,_h,_h,3]))})).data()];case 5:return o.sent(),i.dispose(),[2]}})})},t.prototype.infer=function(e,n){var r=this;return n===void 0&&(n=!1),de(function(){e instanceof Qn||(e=rI(e));var i=Be(se(Qe(e,"float32"),r.normalizationConstant),r.inputMin),s=i;(e.shape[0]!==_h||e.shape[1]!==_h)&&(s=Po.resizeBilinear(i,[_h,_h],!0));var o,a=fe(s,[-1,_h,_h,3]);if(n){var l=qGe[r.version],c=r.model.execute(a,l);o=Wl(c,[1,2])}else{var u=r.model.predict(a);o=Cn(u,[0,1],[-1,1e3])}return o})},t.prototype.classify=function(e,n){return n===void 0&&(n=3),PT(this,void 0,void 0,function(){var r,i;return OT(this,function(s){switch(s.label){case 0:return[4,KGe(r=this.infer(e),n)];case 1:return i=s.sent(),r.dispose(),[2,i]}})})},t}();function KGe(t,e){return PT(this,void 0,void 0,function(){var n,r,i,s,o,a,l;return OT(this,function(c){switch(c.label){case 0:return[4,(n=H0(t)).data()];case 1:for(r=c.sent(),n.dispose(),i=[],l=0;l<r.length;l++)i.push({value:r[l],index:l});for(i.sort(function(u,h){return h.value-u.value}),s=new Float32Array(e),o=new Int32Array(e),l=0;l<e;l++)s[l]=i[l].value,o[l]=i[l].index;for(a=[],l=0;l<o.length;l++)a.push({className:jGe[o[l]],probability:s[l]});return[2,a]}})})}var e3={},t3={},n3={};Number.EPSILON===void 0&&(Number.EPSILON=Math.pow(2,-52));Number.isInteger===void 0&&(Number.isInteger=function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t});Math.sign===void 0&&(Math.sign=function(t){return t<0?-1:t>0?1:+t});"name"in Function.prototype||Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}});Object.assign===void 0&&(Object.assign=function(t){if(t==null)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(r!=null)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e});var hq="113",Jc={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Qc={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},fq=0,r3=1,dq=2,YGe=3,ZGe=0,JGe=1,QGe=0,i3=1,pq=2,$g=3,Rg=0,Pi=1,Cw=2,s3=1,eHe=2,o3=0,mq=1,Dg=2,eu=0,Pg=1,a3=2,l3=3,c3=4,gq=5,id=100,vq=101,yq=102,u3=103,h3=104,bq=200,wq=201,xq=202,_q=203,f3=204,d3=205,Sq=206,Cq=207,Tq=208,Eq=209,kq=210,Aq=0,Mq=1,Iq=2,FT=3,Nq=4,$q=5,Rq=6,Dq=7,Tw=0,Pq=1,Oq=2,Ew=0,LT=1,Fq=2,Lq=3,Bq=4,zq=5,BT=300,zT=301,VT=302,p3=303,UT=304,m3=305,Og=306,WT=307,kw=1e3,Ws=1001,Aw=1002,li=1003,GT=1004,tHe=1004,HT=1005,nHe=1005,Oi=1006,g3=1007,rHe=1007,Mw=1008,iHe=1008,Iw=1009,Vq=1010,Uq=1011,Nw=1012,Wq=1013,v3=1014,Fg=1015,jT=1016,Gq=1017,Hq=1018,jq=1019,$w=1020,qq=1021,Sh=1022,pl=1023,Xq=1024,Kq=1025,Yq=pl,sd=1026,Lg=1027,Zq=1028,Jq=1029,Qq=1030,e7=1031,t7=1032,n7=1033,y3=33776,b3=33777,w3=33778,x3=33779,_3=35840,S3=35841,C3=35842,T3=35843,r7=36196,i7=37808,s7=37809,o7=37810,a7=37811,l7=37812,c7=37813,u7=37814,h7=37815,f7=37816,d7=37817,p7=37818,m7=37819,g7=37820,v7=37821,y7=2200,b7=2201,w7=2202,Rw=2300,Dw=2301,qT=2302,od=2400,ad=2401,Pw=2402,x7=0,sHe=1,oHe=2,fo=3e3,XT=3001,E3=3007,KT=3002,_7=3003,k3=3004,A3=3005,M3=3006,S7=3200,C7=3201,ld=0,T7=1,aHe=0,YT=7680,lHe=7681,cHe=7682,uHe=7683,hHe=34055,fHe=34056,dHe=5386,pHe=512,mHe=513,gHe=514,vHe=515,yHe=516,bHe=517,wHe=518,E7=519,Ow=35044,cd=35048,xHe=35040,_He=35045,SHe=35049,CHe=35041,THe=35046,EHe=35050,kHe=35042;function Aa(){}Object.assign(Aa.prototype,{addEventListener:function(t,e){this._listeners===void 0&&(this._listeners={});var n=this._listeners;n[t]===void 0&&(n[t]=[]),n[t].indexOf(e)===-1&&n[t].push(e)},hasEventListener:function(t,e){if(this._listeners===void 0)return!1;var n=this._listeners;return n[t]!==void 0&&n[t].indexOf(e)!==-1},removeEventListener:function(t,e){if(this._listeners!==void 0){var n=this._listeners,r=n[t];if(r!==void 0){var i=r.indexOf(e);i!==-1&&r.splice(i,1)}}},dispatchEvent:function(t){if(this._listeners!==void 0){var e=this._listeners,n=e[t.type];if(n!==void 0){t.target=this;for(var r=n.slice(0),i=0,s=r.length;i<s;i++)r[i].call(this,t)}}}});var ns=[];for(var Fw=0;Fw<256;Fw++)ns[Fw]=(Fw<16?"0":"")+Fw.toString(16);var ln={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0,i=ns[t&255]+ns[t>>8&255]+ns[t>>16&255]+ns[t>>24&255]+"-"+ns[e&255]+ns[e>>8&255]+"-"+ns[e>>16&15|64]+ns[e>>24&255]+"-"+ns[n&63|128]+ns[n>>8&255]+"-"+ns[n>>16&255]+ns[n>>24&255]+ns[r&255]+ns[r>>8&255]+ns[r>>16&255]+ns[r>>24&255];return i.toUpperCase()},clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*(3-2*t))},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*t*(t*(t*6-15)+10))},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*ln.DEG2RAD},radToDeg:function(t){return t*ln.RAD2DEG},isPowerOfTwo:function(t){return(t&t-1)==0&&t!==0},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,r,i){var s=Math.cos,o=Math.sin,a=s(n/2),l=o(n/2),c=s((e+r)/2),u=o((e+r)/2),h=s((e-r)/2),f=o((e-r)/2),d=s((r-e)/2),p=o((r-e)/2);i==="XYX"?t.set(a*u,l*h,l*f,a*c):i==="YZY"?t.set(l*f,a*u,l*h,a*c):i==="ZXZ"?t.set(l*h,l*f,a*u,a*c):i==="XZX"?t.set(a*u,l*p,l*d,a*c):i==="YXY"?t.set(l*d,a*u,l*p,a*c):i==="ZYZ"?t.set(l*p,l*d,a*u,a*c):console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}};function $e(t,e){this.x=t||0,this.y=e||0}Object.defineProperties($e.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}});Object.assign($e.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return e!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return e!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return e===void 0&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,n){return n!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,s=this.y-t.y;return this.x=i*n-s*r+t.x,this.y=i*r+s*n+t.y,this}});function rs(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(rs.prototype,{isMatrix3:!0,set:function(t,e,n,r,i,s,o,a,l){var c=this.elements;return c[0]=t,c[1]=r,c[2]=o,c[3]=e,c[4]=i,c[5]=a,c[6]=n,c[7]=s,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return new this.constructor().fromArray(this.elements)},copy:function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],c=n[4],u=n[7],h=n[2],f=n[5],d=n[8],p=r[0],m=r[3],v=r[6],y=r[1],w=r[4],x=r[7],_=r[2],S=r[5],T=r[8];return i[0]=s*p+o*y+a*_,i[3]=s*m+o*w+a*S,i[6]=s*v+o*x+a*T,i[1]=l*p+c*y+u*_,i[4]=l*m+c*w+u*S,i[7]=l*v+c*x+u*T,i[2]=h*p+f*y+d*_,i[5]=h*m+f*w+d*S,i[8]=h*v+f*x+d*T,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*s*c-e*o*l-n*i*c+n*o*a+r*i*l-r*s*a},getInverse:function(t,e){t&&t.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var n=t.elements,r=this.elements,i=n[0],s=n[1],o=n[2],a=n[3],l=n[4],c=n[5],u=n[6],h=n[7],f=n[8],d=f*l-c*h,p=c*u-f*a,m=h*a-l*u,v=i*d+s*p+o*m;if(v===0){var y="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(e===!0)throw new Error(y);return console.warn(y),this.identity()}var w=1/v;return r[0]=d*w,r[1]=(o*h-f*s)*w,r[2]=(c*s-o*l)*w,r[3]=p*w,r[4]=(f*i-o*u)*w,r[5]=(o*a-c*i)*w,r[6]=m*w,r[7]=(s*u-h*i)*w,r[8]=(l*i-s*a)*w,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,n,r,i,s,o){var a=Math.cos(i),l=Math.sin(i);this.set(n*a,n*l,-n*(a*s+l*o)+s+t,-r*l,r*a,-r*(-l*s+a*o)+o+e,0,0,1)},scale:function(t,e){var n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this},rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=this.elements,i=r[0],s=r[3],o=r[6],a=r[1],l=r[4],c=r[7];return r[0]=e*i+n*a,r[3]=e*s+n*l,r[6]=e*o+n*c,r[1]=-n*i+e*a,r[4]=-n*s+e*l,r[7]=-n*o+e*c,this},translate:function(t,e){var n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this},equals:function(t){for(var e=this.elements,n=t.elements,r=0;r<9;r++)if(e[r]!==n[r])return!1;return!0},fromArray:function(t,e){e===void 0&&(e=0);for(var n=0;n<9;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){t===void 0&&(t=[]),e===void 0&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}});var Bg,Ch={getDataURL:function(t){var e;if(typeof HTMLCanvasElement=="undefined")return t.src;if(t instanceof HTMLCanvasElement)e=t;else{Bg===void 0&&(Bg=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Bg.width=t.width,Bg.height=t.height;var n=Bg.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Bg}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}},AHe=0;function ar(t,e,n,r,i,s,o,a,l,c){Object.defineProperty(this,"id",{value:AHe++}),this.uuid=ln.generateUUID(),this.name="",this.image=t!==void 0?t:ar.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=e!==void 0?e:ar.DEFAULT_MAPPING,this.wrapS=n!==void 0?n:Ws,this.wrapT=r!==void 0?r:Ws,this.magFilter=i!==void 0?i:Oi,this.minFilter=s!==void 0?s:Mw,this.anisotropy=l!==void 0?l:1,this.format=o!==void 0?o:pl,this.internalFormat=null,this.type=a!==void 0?a:Iw,this.offset=new $e(0,0),this.repeat=new $e(1,1),this.center=new $e(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new rs,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c!==void 0?c:fo,this.version=0,this.onUpdate=null}ar.DEFAULT_IMAGE=void 0;ar.DEFAULT_MAPPING=BT;ar.prototype=Object.assign(Object.create(Aa.prototype),{constructor:ar,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){var r=this.image;if(r.uuid===void 0&&(r.uuid=ln.generateUUID()),!e&&t.images[r.uuid]===void 0){var i;if(Array.isArray(r)){i=[];for(var s=0,o=r.length;s<o;s++)i.push(Ch.getDataURL(r[s]))}else i=Ch.getDataURL(r);t.images[r.uuid]={uuid:r.uuid,url:i}}n.image=r.uuid}return e||(t.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping!==BT)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case kw:t.x=t.x-Math.floor(t.x);break;case Ws:t.x=t.x<0?0:1;break;case Aw:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case kw:t.y=t.y-Math.floor(t.y);break;case Ws:t.y=t.y<0?0:1;break;case Aw:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}});Object.defineProperty(ar.prototype,"needsUpdate",{set:function(t){t===!0&&this.version++}});function lr(t,e,n,r){this.x=t||0,this.y=e||0,this.z=n||0,this.w=r!==void 0?r:1}Object.defineProperties(lr.prototype,{width:{get:function(){return this.z},set:function(t){this.z=t}},height:{get:function(){return this.w},set:function(t){this.w=t}}});Object.assign(lr.prototype,{isVector4:!0,set:function(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this},add:function(t,e){return e!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return e!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,n=this.y,r=this.z,i=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*r+s[12]*i,this.y=s[1]*e+s[5]*n+s[9]*r+s[13]*i,this.z=s[2]*e+s[6]*n+s[10]*r+s[14]*i,this.w=s[3]*e+s[7]*n+s[11]*r+s[15]*i,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,n,r,i,s=.01,o=.1,a=t.elements,l=a[0],c=a[4],u=a[8],h=a[1],f=a[5],d=a[9],p=a[2],m=a[6],v=a[10];if(Math.abs(c-h)<s&&Math.abs(u-p)<s&&Math.abs(d-m)<s){if(Math.abs(c+h)<o&&Math.abs(u+p)<o&&Math.abs(d+m)<o&&Math.abs(l+f+v-3)<o)return this.set(1,0,0,0),this;e=Math.PI;var y=(l+1)/2,w=(f+1)/2,x=(v+1)/2,_=(c+h)/4,S=(u+p)/4,T=(d+m)/4;return y>w&&y>x?y<s?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(y),r=_/n,i=S/n):w>x?w<s?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(w),n=_/r,i=T/r):x<s?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(x),n=S/i,r=T/i),this.set(n,r,i,e),this}var E=Math.sqrt((m-d)*(m-d)+(u-p)*(u-p)+(h-c)*(h-c));return Math.abs(E)<.001&&(E=1),this.x=(m-d)/E,this.y=(u-p)/E,this.z=(h-c)/E,this.w=Math.acos((l+f+v-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this},clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return e===void 0&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,n){return n!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}});function Ts(t,e,n){this.width=t,this.height=e,this.scissor=new lr(0,0,t,e),this.scissorTest=!1,this.viewport=new lr(0,0,t,e),n=n||{},this.texture=new ar(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:Oi,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!0,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null}Ts.prototype=Object.assign(Object.create(Aa.prototype),{constructor:Ts,isWebGLRenderTarget:!0,setSize:function(t,e){(this.width!==t||this.height!==e)&&(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});function I3(t,e,n){Ts.call(this,t,e,n),this.samples=4}I3.prototype=Object.assign(Object.create(Ts.prototype),{constructor:I3,isWebGLMultisampleRenderTarget:!0,copy:function(t){return Ts.prototype.copy.call(this,t),this.samples=t.samples,this}});function is(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._w=r!==void 0?r:1}Object.assign(is,{slerp:function(t,e,n,r){return n.copy(t).slerp(e,r)},slerpFlat:function(t,e,n,r,i,s,o){var a=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3],h=i[s+0],f=i[s+1],d=i[s+2],p=i[s+3];if(u!==p||a!==h||l!==f||c!==d){var m=1-o,v=a*h+l*f+c*d+u*p,y=v>=0?1:-1,w=1-v*v;if(w>Number.EPSILON){var x=Math.sqrt(w),_=Math.atan2(x,v*y);m=Math.sin(m*_)/x,o=Math.sin(o*_)/x}var S=o*y;if(a=a*m+h*S,l=l*m+f*S,c=c*m+d*S,u=u*m+p*S,m===1-o){var T=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=T,l*=T,c*=T,u*=T}}t[e]=a,t[e+1]=l,t[e+2]=c,t[e+3]=u}});Object.defineProperties(is.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}}});Object.assign(is.prototype,{isQuaternion:!0,set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},setFromEuler:function(t,e){if(!(t&&t.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=t._x,r=t._y,i=t._z,s=t.order,o=Math.cos,a=Math.sin,l=o(n/2),c=o(r/2),u=o(i/2),h=a(n/2),f=a(r/2),d=a(i/2);return s==="XYZ"?(this._x=h*c*u+l*f*d,this._y=l*f*u-h*c*d,this._z=l*c*d+h*f*u,this._w=l*c*u-h*f*d):s==="YXZ"?(this._x=h*c*u+l*f*d,this._y=l*f*u-h*c*d,this._z=l*c*d-h*f*u,this._w=l*c*u+h*f*d):s==="ZXY"?(this._x=h*c*u-l*f*d,this._y=l*f*u+h*c*d,this._z=l*c*d+h*f*u,this._w=l*c*u-h*f*d):s==="ZYX"?(this._x=h*c*u-l*f*d,this._y=l*f*u+h*c*d,this._z=l*c*d-h*f*u,this._w=l*c*u+h*f*d):s==="YZX"?(this._x=h*c*u+l*f*d,this._y=l*f*u+h*c*d,this._z=l*c*d-h*f*u,this._w=l*c*u-h*f*d):s==="XZY"&&(this._x=h*c*u-l*f*d,this._y=l*f*u-h*c*d,this._z=l*c*d+h*f*u,this._w=l*c*u+h*f*d),e!==!1&&this._onChangeCallback(),this},setFromAxisAngle:function(t,e){var n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this},setFromRotationMatrix:function(t){var e=t.elements,n=e[0],r=e[4],i=e[8],s=e[1],o=e[5],a=e[9],l=e[2],c=e[6],u=e[10],h=n+o+u,f;return h>0?(f=.5/Math.sqrt(h+1),this._w=.25/f,this._x=(c-a)*f,this._y=(i-l)*f,this._z=(s-r)*f):n>o&&n>u?(f=2*Math.sqrt(1+n-o-u),this._w=(c-a)/f,this._x=.25*f,this._y=(r+s)/f,this._z=(i+l)/f):o>u?(f=2*Math.sqrt(1+o-n-u),this._w=(i-l)/f,this._x=(r+s)/f,this._y=.25*f,this._z=(a+c)/f):(f=2*Math.sqrt(1+u-n-o),this._w=(s-r)/f,this._x=(i+l)/f,this._y=(a+c)/f,this._z=.25*f),this._onChangeCallback(),this},setFromUnitVectors:function(t,e){var n=1e-6,r=t.dot(e)+1;return r<n?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=r),this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(ln.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){var n=this.angleTo(t);if(n===0)return this;var r=Math.min(1,e/n);return this.slerp(t,r),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},multiply:function(t,e){return e!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var n=t._x,r=t._y,i=t._z,s=t._w,o=e._x,a=e._y,l=e._z,c=e._w;return this._x=n*c+s*o+r*l-i*a,this._y=r*c+s*a+i*o-n*l,this._z=i*c+s*l+n*a-r*o,this._w=s*c-n*o-r*a-i*l,this._onChangeCallback(),this},slerp:function(t,e){if(e===0)return this;if(e===1)return this.copy(t);var n=this._x,r=this._y,i=this._z,s=this._w,o=s*t._w+n*t._x+r*t._y+i*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;var a=1-o*o;if(a<=Number.EPSILON){var l=1-e;return this._w=l*s+e*this._w,this._x=l*n+e*this._x,this._y=l*r+e*this._y,this._z=l*i+e*this._z,this.normalize(),this._onChangeCallback(),this}var c=Math.sqrt(a),u=Math.atan2(c,o),h=Math.sin((1-e)*u)/c,f=Math.sin(e*u)/c;return this._w=s*h+this._w*f,this._x=n*h+this._x*f,this._y=r*h+this._y*f,this._z=i*h+this._z*f,this._onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return e===void 0&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}});var N3=new j,k7=new is;function j(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0}Object.assign(j.prototype,{isVector3:!0,set:function(t,e,n){return this.x=t,this.y=e,this.z=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(k7.setFromEuler(t))},applyAxisAngle:function(t,e){return this.applyQuaternion(k7.setFromAxisAngle(t,e))},applyMatrix3:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements,s=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*s,this},applyQuaternion:function(t){var e=this.x,n=this.y,r=this.z,i=t.x,s=t.y,o=t.z,a=t.w,l=a*e+s*r-o*n,c=a*n+o*e-i*r,u=a*r+i*n-s*e,h=-i*e-s*n-o*r;return this.x=l*a+h*-i+c*-o-u*-s,this.y=c*a+h*-s+u*-i-l*-o,this.z=u*a+h*-o+l*-s-c*-i,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},cross:function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var n=t.x,r=t.y,i=t.z,s=e.x,o=e.y,a=e.z;return this.x=r*a-i*o,this.y=i*s-n*a,this.z=n*o-r*s,this},projectOnVector:function(t){var e=t.lengthSq();if(e===0)return this.set(0,0,0);var n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)},projectOnPlane:function(t){return N3.copy(this).projectOnVector(t),this.sub(N3)},reflect:function(t){return this.sub(N3.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;var n=this.dot(t)/e;return Math.acos(ln.clamp(n,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,e,n){var r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,e*4)},setFromMatrix3Column:function(t,e){return this.fromArray(t.elements,e*3)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return e===void 0&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,n){return n!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}});var zg=new j,ml=new vn,MHe=new j(0,0,0),IHe=new j(1,1,1),Th=new j,ZT=new j,zo=new j;function vn(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(vn.prototype,{isMatrix4:!0,set:function(t,e,n,r,i,s,o,a,l,c,u,h,f,d,p,m){var v=this.elements;return v[0]=t,v[4]=e,v[8]=n,v[12]=r,v[1]=i,v[5]=s,v[9]=o,v[13]=a,v[2]=l,v[6]=c,v[10]=u,v[14]=h,v[3]=f,v[7]=d,v[11]=p,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return new vn().fromArray(this.elements)},copy:function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this},copyPosition:function(t){var e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this},extractBasis:function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this},extractRotation:function(t){var e=this.elements,n=t.elements,r=1/zg.setFromMatrixColumn(t,0).length(),i=1/zg.setFromMatrixColumn(t,1).length(),s=1/zg.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,n=t.x,r=t.y,i=t.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if(t.order==="XYZ"){var h=s*c,f=s*u,d=o*c,p=o*u;e[0]=a*c,e[4]=-a*u,e[8]=l,e[1]=f+d*l,e[5]=h-p*l,e[9]=-o*a,e[2]=p-h*l,e[6]=d+f*l,e[10]=s*a}else if(t.order==="YXZ"){var m=a*c,v=a*u,y=l*c,w=l*u;e[0]=m+w*o,e[4]=y*o-v,e[8]=s*l,e[1]=s*u,e[5]=s*c,e[9]=-o,e[2]=v*o-y,e[6]=w+m*o,e[10]=s*a}else if(t.order==="ZXY"){var m=a*c,v=a*u,y=l*c,w=l*u;e[0]=m-w*o,e[4]=-s*u,e[8]=y+v*o,e[1]=v+y*o,e[5]=s*c,e[9]=w-m*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if(t.order==="ZYX"){var h=s*c,f=s*u,d=o*c,p=o*u;e[0]=a*c,e[4]=d*l-f,e[8]=h*l+p,e[1]=a*u,e[5]=p*l+h,e[9]=f*l-d,e[2]=-l,e[6]=o*a,e[10]=s*a}else if(t.order==="YZX"){var x=s*a,_=s*l,S=o*a,T=o*l;e[0]=a*c,e[4]=T-x*u,e[8]=S*u+_,e[1]=u,e[5]=s*c,e[9]=-o*c,e[2]=-l*c,e[6]=_*u+S,e[10]=x-T*u}else if(t.order==="XZY"){var x=s*a,_=s*l,S=o*a,T=o*l;e[0]=a*c,e[4]=-u,e[8]=l*c,e[1]=x*u+T,e[5]=s*c,e[9]=_*u-S,e[2]=S*u-_,e[6]=o*c,e[10]=T*u+x}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(MHe,t,IHe)},lookAt:function(t,e,n){var r=this.elements;return zo.subVectors(t,e),zo.lengthSq()===0&&(zo.z=1),zo.normalize(),Th.crossVectors(n,zo),Th.lengthSq()===0&&(Math.abs(n.z)===1?zo.x+=1e-4:zo.z+=1e-4,zo.normalize(),Th.crossVectors(n,zo)),Th.normalize(),ZT.crossVectors(zo,Th),r[0]=Th.x,r[4]=ZT.x,r[8]=zo.x,r[1]=Th.y,r[5]=ZT.y,r[9]=zo.y,r[2]=Th.z,r[6]=ZT.z,r[10]=zo.z,this},multiply:function(t,e){return e!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[4],a=n[8],l=n[12],c=n[1],u=n[5],h=n[9],f=n[13],d=n[2],p=n[6],m=n[10],v=n[14],y=n[3],w=n[7],x=n[11],_=n[15],S=r[0],T=r[4],E=r[8],k=r[12],A=r[1],M=r[5],D=r[9],P=r[13],N=r[2],R=r[6],F=r[10],O=r[14],K=r[3],J=r[7],re=r[11],ae=r[15];return i[0]=s*S+o*A+a*N+l*K,i[4]=s*T+o*M+a*R+l*J,i[8]=s*E+o*D+a*F+l*re,i[12]=s*k+o*P+a*O+l*ae,i[1]=c*S+u*A+h*N+f*K,i[5]=c*T+u*M+h*R+f*J,i[9]=c*E+u*D+h*F+f*re,i[13]=c*k+u*P+h*O+f*ae,i[2]=d*S+p*A+m*N+v*K,i[6]=d*T+p*M+m*R+v*J,i[10]=d*E+p*D+m*F+v*re,i[14]=d*k+p*P+m*O+v*ae,i[3]=y*S+w*A+x*N+_*K,i[7]=y*T+w*M+x*R+_*J,i[11]=y*E+w*D+x*F+_*re,i[15]=y*k+w*P+x*O+_*ae,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},determinant:function(){var t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],s=t[1],o=t[5],a=t[9],l=t[13],c=t[2],u=t[6],h=t[10],f=t[14],d=t[3],p=t[7],m=t[11],v=t[15];return d*(+i*a*u-r*l*u-i*o*h+n*l*h+r*o*f-n*a*f)+p*(+e*a*f-e*l*h+i*s*h-r*s*f+r*l*c-i*a*c)+m*(+e*l*u-e*o*f-i*s*u+n*s*f+i*o*c-n*l*c)+v*(-r*o*c-e*a*u+e*o*h+r*s*u-n*s*h+n*a*c)},transpose:function(){var t=this.elements,e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(t,e,n){var r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this},getInverse:function(t,e){var n=this.elements,r=t.elements,i=r[0],s=r[1],o=r[2],a=r[3],l=r[4],c=r[5],u=r[6],h=r[7],f=r[8],d=r[9],p=r[10],m=r[11],v=r[12],y=r[13],w=r[14],x=r[15],_=d*w*h-y*p*h+y*u*m-c*w*m-d*u*x+c*p*x,S=v*p*h-f*w*h-v*u*m+l*w*m+f*u*x-l*p*x,T=f*y*h-v*d*h+v*c*m-l*y*m-f*c*x+l*d*x,E=v*d*u-f*y*u-v*c*p+l*y*p+f*c*w-l*d*w,k=i*_+s*S+o*T+a*E;if(k===0){var A="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(e===!0)throw new Error(A);return console.warn(A),this.identity()}var M=1/k;return n[0]=_*M,n[1]=(y*p*a-d*w*a-y*o*m+s*w*m+d*o*x-s*p*x)*M,n[2]=(c*w*a-y*u*a+y*o*h-s*w*h-c*o*x+s*u*x)*M,n[3]=(d*u*a-c*p*a-d*o*h+s*p*h+c*o*m-s*u*m)*M,n[4]=S*M,n[5]=(f*w*a-v*p*a+v*o*m-i*w*m-f*o*x+i*p*x)*M,n[6]=(v*u*a-l*w*a-v*o*h+i*w*h+l*o*x-i*u*x)*M,n[7]=(l*p*a-f*u*a+f*o*h-i*p*h-l*o*m+i*u*m)*M,n[8]=T*M,n[9]=(v*d*a-f*y*a-v*s*m+i*y*m+f*s*x-i*d*x)*M,n[10]=(l*y*a-v*c*a+v*s*h-i*y*h-l*s*x+i*c*x)*M,n[11]=(f*c*a-l*d*a-f*s*h+i*d*h+l*s*m-i*c*m)*M,n[12]=E*M,n[13]=(f*y*o-v*d*o+v*s*p-i*y*p-f*s*w+i*d*w)*M,n[14]=(v*c*o-l*y*o-v*s*u+i*y*u+l*s*w-i*c*w)*M,n[15]=(l*d*o-f*c*o+f*s*u-i*d*u-l*s*p+i*c*p)*M,this},scale:function(t){var e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))},makeTranslation:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var n=Math.cos(e),r=Math.sin(e),i=1-n,s=t.x,o=t.y,a=t.z,l=i*s,c=i*o;return this.set(l*s+n,l*o-r*a,l*a+r*o,0,l*o+r*a,c*o+n,c*a-r*s,0,l*a-r*o,c*a+r*s,i*a*a+n,0,0,0,0,1),this},makeScale:function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,n){var r=this.elements,i=e._x,s=e._y,o=e._z,a=e._w,l=i+i,c=s+s,u=o+o,h=i*l,f=i*c,d=i*u,p=s*c,m=s*u,v=o*u,y=a*l,w=a*c,x=a*u,_=n.x,S=n.y,T=n.z;return r[0]=(1-(p+v))*_,r[1]=(f+x)*_,r[2]=(d-w)*_,r[3]=0,r[4]=(f-x)*S,r[5]=(1-(h+v))*S,r[6]=(m+y)*S,r[7]=0,r[8]=(d+w)*T,r[9]=(m-y)*T,r[10]=(1-(h+p))*T,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this},decompose:function(t,e,n){var r=this.elements,i=zg.set(r[0],r[1],r[2]).length(),s=zg.set(r[4],r[5],r[6]).length(),o=zg.set(r[8],r[9],r[10]).length(),a=this.determinant();a<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],ml.copy(this);var l=1/i,c=1/s,u=1/o;return ml.elements[0]*=l,ml.elements[1]*=l,ml.elements[2]*=l,ml.elements[4]*=c,ml.elements[5]*=c,ml.elements[6]*=c,ml.elements[8]*=u,ml.elements[9]*=u,ml.elements[10]*=u,e.setFromRotationMatrix(ml),n.x=i,n.y=s,n.z=o,this},makePerspective:function(t,e,n,r,i,s){s===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,a=2*i/(e-t),l=2*i/(n-r),c=(e+t)/(e-t),u=(n+r)/(n-r),h=-(s+i)/(s-i),f=-2*s*i/(s-i);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=f,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(t,e,n,r,i,s){var o=this.elements,a=1/(e-t),l=1/(n-r),c=1/(s-i),u=(e+t)*a,h=(n+r)*l,f=(s+i)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-f,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(t){for(var e=this.elements,n=t.elements,r=0;r<16;r++)if(e[r]!==n[r])return!1;return!0},fromArray:function(t,e){e===void 0&&(e=0);for(var n=0;n<16;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){t===void 0&&(t=[]),e===void 0&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}});var A7=new vn,M7=new is;function ud(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._order=r||ud.DefaultOrder}ud.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];ud.DefaultOrder="XYZ";Object.defineProperties(ud.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}});Object.assign(ud.prototype,{isEuler:!0,set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._order=r||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,e,n){var r=ln.clamp,i=t.elements,s=i[0],o=i[4],a=i[8],l=i[1],c=i[5],u=i[9],h=i[2],f=i[6],d=i[10];return e=e||this._order,e==="XYZ"?(this._y=Math.asin(r(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(f,c),this._z=0)):e==="YXZ"?(this._x=Math.asin(-r(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0)):e==="ZXY"?(this._x=Math.asin(r(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,s))):e==="ZYX"?(this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,d),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,c))):e==="YZX"?(this._z=Math.asin(r(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,d))):e==="XZY"?(this._z=Math.asin(-r(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,d),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,n!==!1&&this._onChangeCallback(),this},setFromQuaternion:function(t,e,n){return A7.makeRotationFromQuaternion(t),this.setFromRotationMatrix(A7,e,n)},setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(t){return M7.setFromEuler(this),this.setFromQuaternion(M7,t)},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new j(this._x,this._y,this._z)},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}});function $3(){this.mask=1|0}Object.assign($3.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},enableAll:function(){this.mask=4294967295|0},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return(this.mask&t.mask)!=0}});var NHe=0,I7=new j,Vg=new is,tu=new vn,JT=new j,Lw=new j,$He=new j,RHe=new is,N7=new j(1,0,0),$7=new j(0,1,0),R7=new j(0,0,1),DHe={type:"added"},PHe={type:"removed"};function ft(){Object.defineProperty(this,"id",{value:NHe++}),this.uuid=ln.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ft.DefaultUp.clone();var t=new j,e=new ud,n=new is,r=new j(1,1,1);function i(){n.setFromEuler(e,!1)}function s(){e.setFromQuaternion(n,void 0,!1)}e._onChange(i),n._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new vn},normalMatrix:{value:new rs}}),this.matrix=new vn,this.matrixWorld=new vn,this.matrixAutoUpdate=ft.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new $3,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}ft.DefaultUp=new j(0,1,0);ft.DefaultMatrixAutoUpdate=!0;ft.prototype=Object.assign(Object.create(Aa.prototype),{constructor:ft,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return Vg.setFromAxisAngle(t,e),this.quaternion.multiply(Vg),this},rotateOnWorldAxis:function(t,e){return Vg.setFromAxisAngle(t,e),this.quaternion.premultiply(Vg),this},rotateX:function(t){return this.rotateOnAxis(N7,t)},rotateY:function(t){return this.rotateOnAxis($7,t)},rotateZ:function(t){return this.rotateOnAxis(R7,t)},translateOnAxis:function(t,e){return I7.copy(t).applyQuaternion(this.quaternion),this.position.add(I7.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(N7,t)},translateY:function(t){return this.translateOnAxis($7,t)},translateZ:function(t){return this.translateOnAxis(R7,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(tu.getInverse(this.matrixWorld))},lookAt:function(t,e,n){t.isVector3?JT.copy(t):JT.set(t,e,n);var r=this.parent;this.updateWorldMatrix(!0,!1),Lw.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?tu.lookAt(Lw,JT,this.up):tu.lookAt(JT,Lw,this.up),this.quaternion.setFromRotationMatrix(tu),r&&(tu.extractRotation(r.matrixWorld),Vg.setFromRotationMatrix(tu),this.quaternion.premultiply(Vg.inverse()))},add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(DHe)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var n=this.children.indexOf(t);return n!==-1&&(t.parent=null,this.children.splice(n,1),t.dispatchEvent(PHe)),this},attach:function(t){return this.updateWorldMatrix(!0,!1),tu.getInverse(this.matrixWorld),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),tu.multiply(t.parent.matrixWorld)),t.applyMatrix4(tu),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n],s=i.getObjectByProperty(t,e);if(s!==void 0)return s}},getWorldPosition:function(t){return t===void 0&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new j),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return t===void 0&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new is),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Lw,t,$He),t},getWorldScale:function(t){return t===void 0&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new j),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Lw,RHe,t),t},getWorldDirection:function(t){t===void 0&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new j),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverse(t)},traverseVisible:function(t){if(this.visible!==!1){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){var n=this.parent;if(t===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0)for(var r=this.children,i=0,s=r.length;i<s;i++)r[i].updateWorldMatrix(!1,!0)},toJSON:function(t){var e=t===void 0||typeof t=="string",n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON());function i(v,y){return v[y.uuid]===void 0&&(v[y.uuid]=y.toJSON(t)),y.uuid}if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);var s=this.geometry.parameters;if(s!==void 0&&s.shapes!==void 0){var o=s.shapes;if(Array.isArray(o))for(var a=0,l=o.length;a<l;a++){var c=o[a];i(t.shapes,c)}else i(t.shapes,o)}}if(this.material!==void 0)if(Array.isArray(this.material)){for(var u=[],a=0,l=this.material.length;a<l;a++)u.push(i(t.materials,this.material[a]));r.material=u}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(var a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(t).object)}if(e){var h=m(t.geometries),f=m(t.materials),d=m(t.textures),p=m(t.images),o=m(t.shapes);h.length>0&&(n.geometries=h),f.length>0&&(n.materials=f),d.length>0&&(n.textures=d),p.length>0&&(n.images=p),o.length>0&&(n.shapes=o)}return n.object=r,n;function m(v){var y=[];for(var w in v){var x=v[w];delete x.metadata,y.push(x)}return y}},clone:function(t){return new this.constructor().copy(this,t)},copy:function(t,e){if(e===void 0&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(var n=0;n<t.children.length;n++){var r=t.children[n];this.add(r.clone())}return this}});function nu(){ft.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}nu.prototype=Object.assign(Object.create(ft.prototype),{constructor:nu,isScene:!0,copy:function(t,e){return ft.prototype.copy.call(this,t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=ft.prototype.toJSON.call(this,t);return this.background!==null&&(e.object.background=this.background.toJSON(t)),this.environment!==null&&(e.object.environment=this.environment.toJSON(t)),this.fog!==null&&(e.object.fog=this.fog.toJSON()),e},dispose:function(){this.dispatchEvent({type:"dispose"})}});var ru=[new j,new j,new j,new j,new j,new j,new j,new j],Bw=new j,QT=new gl,Ug=new j,Wg=new j,Gg=new j,Eh=new j,kh=new j,hd=new j,zw=new j,eE=new j,tE=new j,fd=new j;function gl(t,e){this.min=t!==void 0?t:new j(1/0,1/0,1/0),this.max=e!==void 0?e:new j(-1/0,-1/0,-1/0)}Object.assign(gl.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,n=1/0,r=1/0,i=-1/0,s=-1/0,o=-1/0,a=0,l=t.length;a<l;a+=3){var c=t[a],u=t[a+1],h=t[a+2];c<e&&(e=c),u<n&&(n=u),h<r&&(r=h),c>i&&(i=c),u>s&&(s=u),h>o&&(o=h)}return this.min.set(e,n,r),this.max.set(i,s,o),this},setFromBufferAttribute:function(t){for(var e=1/0,n=1/0,r=1/0,i=-1/0,s=-1/0,o=-1/0,a=0,l=t.count;a<l;a++){var c=t.getX(a),u=t.getY(a),h=t.getZ(a);c<e&&(e=c),u<n&&(n=u),h<r&&(r=h),c>i&&(i=c),u>s&&(s=u),h>o&&(o=h)}return this.min.set(e,n,r),this.max.set(i,s,o),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){var n=Bw.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return t===void 0&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new j),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return t===void 0&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new j),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(t){t.updateWorldMatrix(!1,!1);var e=t.geometry;e!==void 0&&(e.boundingBox===null&&e.computeBoundingBox(),QT.copy(e.boundingBox),QT.applyMatrix4(t.matrixWorld),this.expandByPoint(QT.min),this.expandByPoint(QT.max));for(var n=t.children,r=0,i=n.length;r<i;r++)this.expandByObject(n[r]);return this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return e===void 0&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new j),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return this.clampPoint(t.center,Bw),Bw.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){var e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant},intersectsTriangle:function(t){if(this.isEmpty())return!1;this.getCenter(zw),eE.subVectors(this.max,zw),Ug.subVectors(t.a,zw),Wg.subVectors(t.b,zw),Gg.subVectors(t.c,zw),Eh.subVectors(Wg,Ug),kh.subVectors(Gg,Wg),hd.subVectors(Ug,Gg);var e=[0,-Eh.z,Eh.y,0,-kh.z,kh.y,0,-hd.z,hd.y,Eh.z,0,-Eh.x,kh.z,0,-kh.x,hd.z,0,-hd.x,-Eh.y,Eh.x,0,-kh.y,kh.x,0,-hd.y,hd.x,0];return!R3(e,Ug,Wg,Gg,eE)||(e=[1,0,0,0,1,0,0,0,1],!R3(e,Ug,Wg,Gg,eE))?!1:(tE.crossVectors(Eh,kh),e=[tE.x,tE.y,tE.z],R3(e,Ug,Wg,Gg,eE))},clampPoint:function(t,e){return e===void 0&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new j),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){var e=Bw.copy(t).clamp(this.min,this.max);return e.sub(t).length()},getBoundingSphere:function(t){return t===void 0&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=this.getSize(Bw).length()*.5,t},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){return this.isEmpty()?this:(ru[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),ru[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),ru[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),ru[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),ru[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),ru[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),ru[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),ru[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(ru),this)},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});function R3(t,e,n,r,i){var s,o;for(s=0,o=t.length-3;s<=o;s+=3){fd.fromArray(t,s);var a=i.x*Math.abs(fd.x)+i.y*Math.abs(fd.y)+i.z*Math.abs(fd.z),l=e.dot(fd),c=n.dot(fd),u=r.dot(fd);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}var OHe=new gl;function iu(t,e){this.center=t!==void 0?t:new j,this.radius=e!==void 0?e:0}Object.assign(iu.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(t,e){var n=this.center;e!==void 0?n.copy(e):OHe.setFromPoints(t).getCenter(n);for(var r=0,i=0,s=t.length;i<s;i++)r=Math.max(r,n.distanceToSquared(t[i]));return this.radius=Math.sqrt(r),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var n=this.center.distanceToSquared(t);return e===void 0&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new j),e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return t===void 0&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new gl),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}});var su=new j,D3=new j,nE=new j,Ah=new j,P3=new j,rE=new j,O3=new j;function dd(t,e){this.origin=t!==void 0?t:new j,this.direction=e!==void 0?e:new j(0,0,-1)}Object.assign(dd.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return e===void 0&&(console.warn("THREE.Ray: .at() target is now required"),e=new j),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(t){return this.origin.copy(this.at(t,su)),this},closestPointToPoint:function(t,e){e===void 0&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new j),e.subVectors(t,this.origin);var n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(t){var e=su.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(su.copy(this.direction).multiplyScalar(e).add(this.origin),su.distanceToSquared(t))},distanceSqToSegment:function(t,e,n,r){D3.copy(t).add(e).multiplyScalar(.5),nE.copy(e).sub(t).normalize(),Ah.copy(this.origin).sub(D3);var i=t.distanceTo(e)*.5,s=-this.direction.dot(nE),o=Ah.dot(this.direction),a=-Ah.dot(nE),l=Ah.lengthSq(),c=Math.abs(1-s*s),u,h,f,d;if(c>0)if(u=s*a-o,h=s*o-a,d=i*c,u>=0)if(h>=-d)if(h<=d){var p=1/c;u*=p,h*=p,f=u*(u+s*h+2*o)+h*(s*u+h+2*a)+l}else h=i,u=Math.max(0,-(s*h+o)),f=-u*u+h*(h+2*a)+l;else h=-i,u=Math.max(0,-(s*h+o)),f=-u*u+h*(h+2*a)+l;else h<=-d?(u=Math.max(0,-(-s*i+o)),h=u>0?-i:Math.min(Math.max(-i,-a),i),f=-u*u+h*(h+2*a)+l):h<=d?(u=0,h=Math.min(Math.max(-i,-a),i),f=h*(h+2*a)+l):(u=Math.max(0,-(s*i+o)),h=u>0?i:Math.min(Math.max(-i,-a),i),f=-u*u+h*(h+2*a)+l);else h=s>0?-i:i,u=Math.max(0,-(s*h+o)),f=-u*u+h*(h+2*a)+l;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(nE).multiplyScalar(h).add(D3),f},intersectSphere:function(t,e){su.subVectors(t.center,this.origin);var n=su.dot(this.direction),r=su.dot(su)-n*n,i=t.radius*t.radius;if(r>i)return null;var s=Math.sqrt(i-r),o=n-s,a=n+s;return o<0&&a<0?null:o<0?this.at(a,e):this.at(o,e)},intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;var n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null},intersectPlane:function(t,e){var n=this.distanceToPlane(t);return n===null?null:this.at(n,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);if(e===0)return!0;var n=t.normal.dot(this.direction);return n*e<0},intersectBox:function(t,e){var n,r,i,s,o,a,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(t.min.x-h.x)*l,r=(t.max.x-h.x)*l):(n=(t.max.x-h.x)*l,r=(t.min.x-h.x)*l),c>=0?(i=(t.min.y-h.y)*c,s=(t.max.y-h.y)*c):(i=(t.max.y-h.y)*c,s=(t.min.y-h.y)*c),n>s||i>r||((i>n||n!==n)&&(n=i),(s<r||r!==r)&&(r=s),u>=0?(o=(t.min.z-h.z)*u,a=(t.max.z-h.z)*u):(o=(t.max.z-h.z)*u,a=(t.min.z-h.z)*u),n>a||o>r)||((o>n||n!==n)&&(n=o),(a<r||r!==r)&&(r=a),r<0)?null:this.at(n>=0?n:r,e)},intersectsBox:function(t){return this.intersectBox(t,su)!==null},intersectTriangle:function(t,e,n,r,i){P3.subVectors(e,t),rE.subVectors(n,t),O3.crossVectors(P3,rE);var s=this.direction.dot(O3),o;if(s>0){if(r)return null;o=1}else if(s<0)o=-1,s=-s;else return null;Ah.subVectors(this.origin,t);var a=o*this.direction.dot(rE.crossVectors(Ah,rE));if(a<0)return null;var l=o*this.direction.dot(P3.cross(Ah));if(l<0||a+l>s)return null;var c=-o*Ah.dot(O3);return c<0?null:this.at(c/s,i)},applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}});var F3=new j,FHe=new j,LHe=new rs;function vl(t,e){this.normal=t!==void 0?t:new j(1,0,0),this.constant=e!==void 0?e:0}Object.assign(vl.prototype,{isPlane:!0,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(t,e,n){var r=F3.subVectors(n,e).cross(FHe.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return e===void 0&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new j),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(t,e){e===void 0&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new j);var n=t.delta(F3),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):void 0;var i=-(t.start.dot(this.normal)+this.constant)/r;if(!(i<0||i>1))return e.copy(n).multiplyScalar(i).add(t.start)},intersectsLine:function(t){var e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return t===void 0&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new j),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(t,e){var n=e||LHe.getNormalMatrix(t),r=this.coplanarPoint(F3).applyMatrix4(t),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this},translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}});var yl=new j,ou=new j,L3=new j,au=new j,Hg=new j,jg=new j,D7=new j,B3=new j,z3=new j,V3=new j;function qi(t,e,n){this.a=t!==void 0?t:new j,this.b=e!==void 0?e:new j,this.c=n!==void 0?n:new j}Object.assign(qi,{getNormal:function(t,e,n,r){r===void 0&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new j),r.subVectors(n,e),yl.subVectors(t,e),r.cross(yl);var i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)},getBarycoord:function(t,e,n,r,i){yl.subVectors(r,e),ou.subVectors(n,e),L3.subVectors(t,e);var s=yl.dot(yl),o=yl.dot(ou),a=yl.dot(L3),l=ou.dot(ou),c=ou.dot(L3),u=s*l-o*o;if(i===void 0&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new j),u===0)return i.set(-2,-1,-1);var h=1/u,f=(l*a-o*c)*h,d=(s*c-o*a)*h;return i.set(1-f-d,d,f)},containsPoint:function(t,e,n,r){return qi.getBarycoord(t,e,n,r,au),au.x>=0&&au.y>=0&&au.x+au.y<=1},getUV:function(t,e,n,r,i,s,o,a){return this.getBarycoord(t,e,n,r,au),a.set(0,0),a.addScaledVector(i,au.x),a.addScaledVector(s,au.y),a.addScaledVector(o,au.z),a},isFrontFacing:function(t,e,n,r){return yl.subVectors(n,e),ou.subVectors(t,e),yl.cross(ou).dot(r)<0}});Object.assign(qi.prototype,{set:function(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this},setFromPointsAndIndices:function(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){return yl.subVectors(this.c,this.b),ou.subVectors(this.a,this.b),yl.cross(ou).length()*.5},getMidpoint:function(t){return t===void 0&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new j),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return qi.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return t===void 0&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new vl),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return qi.getBarycoord(t,this.a,this.b,this.c,e)},getUV:function(t,e,n,r,i){return qi.getUV(t,this.a,this.b,this.c,e,n,r,i)},containsPoint:function(t){return qi.containsPoint(t,this.a,this.b,this.c)},isFrontFacing:function(t){return qi.isFrontFacing(this.a,this.b,this.c,t)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(t,e){e===void 0&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new j);var n=this.a,r=this.b,i=this.c,s,o;Hg.subVectors(r,n),jg.subVectors(i,n),B3.subVectors(t,n);var a=Hg.dot(B3),l=jg.dot(B3);if(a<=0&&l<=0)return e.copy(n);z3.subVectors(t,r);var c=Hg.dot(z3),u=jg.dot(z3);if(c>=0&&u<=c)return e.copy(r);var h=a*u-c*l;if(h<=0&&a>=0&&c<=0)return s=a/(a-c),e.copy(n).addScaledVector(Hg,s);V3.subVectors(t,i);var f=Hg.dot(V3),d=jg.dot(V3);if(d>=0&&f<=d)return e.copy(i);var p=f*l-a*d;if(p<=0&&l>=0&&d<=0)return o=l/(l-d),e.copy(n).addScaledVector(jg,o);var m=c*d-f*u;if(m<=0&&u-c>=0&&f-d>=0)return D7.subVectors(i,r),o=(u-c)/(u-c+(f-d)),e.copy(r).addScaledVector(D7,o);var v=1/(m+p+h);return s=p*v,o=h*v,e.copy(n).addScaledVector(Hg,s).addScaledVector(jg,o)},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}});var P7={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},bl={h:0,s:0,l:0},iE={h:0,s:0,l:0};function yt(t,e,n){return e===void 0&&n===void 0?this.set(t):this.setRGB(t,e,n)}function U3(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}function W3(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function G3(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}Object.assign(yt.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,this},setRGB:function(t,e,n){return this.r=t,this.g=e,this.b=n,this},setHSL:function(t,e,n){if(t=ln.euclideanModulo(t,1),e=ln.clamp(e,0,1),n=ln.clamp(n,0,1),e===0)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+e):n+e-n*e,i=2*n-r;this.r=U3(i,r,t+1/3),this.g=U3(i,r,t),this.b=U3(i,r,t-1/3)}return this},setStyle:function(t){function e(h){h!==void 0&&parseFloat(h)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var r,i=n[1],s=n[2];switch(i){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,e(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,e(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(s)){var o=parseFloat(r[1])/360,a=parseInt(r[2],10)/100,l=parseInt(r[3],10)/100;return e(r[5]),this.setHSL(o,a,l)}break}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(t)){var c=n[1],u=c.length;if(u===3)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(u===6)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this},setColorName:function(t){var e=P7[t];return e!==void 0?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return e===void 0&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){e===void 0&&(e=2);var n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(t){return this.r=W3(t.r),this.g=W3(t.g),this.b=W3(t.b),this},copyLinearToSRGB:function(t){return this.r=G3(t.r),this.g=G3(t.g),this.b=G3(t.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){t===void 0&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e=this.r,n=this.g,r=this.b,i=Math.max(e,n,r),s=Math.min(e,n,r),o,a,l=(s+i)/2;if(s===i)o=0,a=0;else{var c=i-s;switch(a=l<=.5?c/(i+s):c/(2-i-s),i){case e:o=(n-r)/c+(n<r?6:0);break;case n:o=(r-e)/c+2;break;case r:o=(e-n)/c+4;break}o/=6}return t.h=o,t.s=a,t.l=l,t},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(t,e,n){return this.getHSL(bl),bl.h+=t,bl.s+=e,bl.l+=n,this.setHSL(bl.h,bl.s,bl.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},lerpHSL:function(t,e){this.getHSL(bl),t.getHSL(iE);var n=ln.lerp(bl.h,iE.h,e),r=ln.lerp(bl.s,iE.s,e),i=ln.lerp(bl.l,iE.l,e);return this.setHSL(n,r,i),this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return e===void 0&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}});yt.NAMES=P7;function qg(t,e,n,r,i,s){this.a=t,this.b=e,this.c=n,this.normal=r&&r.isVector3?r:new j,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new yt,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=s!==void 0?s:0}Object.assign(qg.prototype,{clone:function(){return new this.constructor().copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,n=t.vertexNormals.length;e<n;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(var e=0,n=t.vertexColors.length;e<n;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}});var BHe=0;function jt(){Object.defineProperty(this,"id",{value:BHe++}),this.uuid=ln.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=Pg,this.side=Rg,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=o3,this.opacity=1,this.transparent=!1,this.blendSrc=f3,this.blendDst=d3,this.blendEquation=id,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=FT,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=E7,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=YT,this.stencilZFail=YT,this.stencilZPass=YT,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}jt.prototype=Object.assign(Object.create(Aa.prototype),{constructor:jt,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(t!==void 0)for(var e in t){var n=t[e];if(n===void 0){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if(e==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===s3;continue}var r=this[e];if(r===void 0){console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.");continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n}},toJSON:function(t){var e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,this.combine!==void 0&&(n.combine=this.combine),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),this.size!==void 0&&(n.size=this.size),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Pg&&(n.blending=this.blending),this.flatShading===!0&&(n.flatShading=this.flatShading),this.side!==Rg&&(n.side=this.side),this.vertexColors!==o3&&(n.vertexColors=this.vertexColors),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(n.morphTargets=!0),this.morphNormals===!0&&(n.morphNormals=!0),this.skinning===!0&&(n.skinning=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData);function r(o){var a=[];for(var l in o){var c=o[l];delete c.metadata,a.push(c)}return a}if(e){var i=r(t.textures),s=r(t.images);i.length>0&&(n.textures=i),s.length>0&&(n.images=s)}return n},clone:function(){return new this.constructor().copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexTangents=t.vertexTangents,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var e=t.clippingPlanes,n=null;if(e!==null){var r=e.length;n=new Array(r);for(var i=0;i!==r;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Object.defineProperty(jt.prototype,"needsUpdate",{set:function(t){t===!0&&this.version++}});function Ma(t){jt.call(this),this.type="MeshBasicMaterial",this.color=new yt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Tw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}Ma.prototype=Object.create(jt.prototype);Ma.prototype.constructor=Ma;Ma.prototype.isMeshBasicMaterial=!0;Ma.prototype.copy=function(t){return jt.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};var cr=new j;function qt(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=n===!0,this.usage=Ow,this.updateRange={offset:0,count:-1},this.version=0}Object.defineProperty(qt.prototype,"needsUpdate",{set:function(t){t===!0&&this.version++}});Object.assign(qt.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var s=t[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),s=new yt),e[n++]=s.r,e[n++]=s.g,e[n++]=s.b}return this},copyVector2sArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var s=t[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),s=new $e),e[n++]=s.x,e[n++]=s.y}return this},copyVector3sArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var s=t[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),s=new j),e[n++]=s.x,e[n++]=s.y,e[n++]=s.z}return this},copyVector4sArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var s=t[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),s=new lr),e[n++]=s.x,e[n++]=s.y,e[n++]=s.z,e[n++]=s.w}return this},applyMatrix3:function(t){for(var e=0,n=this.count;e<n;e++)cr.x=this.getX(e),cr.y=this.getY(e),cr.z=this.getZ(e),cr.applyMatrix3(t),this.setXYZ(e,cr.x,cr.y,cr.z);return this},applyMatrix4:function(t){for(var e=0,n=this.count;e<n;e++)cr.x=this.getX(e),cr.y=this.getY(e),cr.z=this.getZ(e),cr.applyMatrix4(t),this.setXYZ(e,cr.x,cr.y,cr.z);return this},applyNormalMatrix:function(t){for(var e=0,n=this.count;e<n;e++)cr.x=this.getX(e),cr.y=this.getY(e),cr.z=this.getZ(e),cr.applyNormalMatrix(t),this.setXYZ(e,cr.x,cr.y,cr.z);return this},transformDirection:function(t){for(var e=0,n=this.count;e<n;e++)cr.x=this.getX(e),cr.y=this.getY(e),cr.z=this.getZ(e),cr.transformDirection(t),this.setXYZ(e,cr.x,cr.y,cr.z);return this},set:function(t,e){return e===void 0&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}});function Vw(t,e,n){qt.call(this,new Int8Array(t),e,n)}Vw.prototype=Object.create(qt.prototype);Vw.prototype.constructor=Vw;function Uw(t,e,n){qt.call(this,new Uint8Array(t),e,n)}Uw.prototype=Object.create(qt.prototype);Uw.prototype.constructor=Uw;function Ww(t,e,n){qt.call(this,new Uint8ClampedArray(t),e,n)}Ww.prototype=Object.create(qt.prototype);Ww.prototype.constructor=Ww;function Gw(t,e,n){qt.call(this,new Int16Array(t),e,n)}Gw.prototype=Object.create(qt.prototype);Gw.prototype.constructor=Gw;function pd(t,e,n){qt.call(this,new Uint16Array(t),e,n)}pd.prototype=Object.create(qt.prototype);pd.prototype.constructor=pd;function Hw(t,e,n){qt.call(this,new Int32Array(t),e,n)}Hw.prototype=Object.create(qt.prototype);Hw.prototype.constructor=Hw;function md(t,e,n){qt.call(this,new Uint32Array(t),e,n)}md.prototype=Object.create(qt.prototype);md.prototype.constructor=md;function ut(t,e,n){qt.call(this,new Float32Array(t),e,n)}ut.prototype=Object.create(qt.prototype);ut.prototype.constructor=ut;function jw(t,e,n){qt.call(this,new Float64Array(t),e,n)}jw.prototype=Object.create(qt.prototype);jw.prototype.constructor=jw;function O7(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}Object.assign(O7.prototype,{computeGroups:function(t){for(var e,n=[],r=void 0,i=t.faces,s=0;s<i.length;s++){var o=i[s];o.materialIndex!==r&&(r=o.materialIndex,e!==void 0&&(e.count=s*3-e.start,n.push(e)),e={start:s*3,materialIndex:r})}e!==void 0&&(e.count=s*3-e.start,n.push(e)),this.groups=n},fromGeometry:function(t){var e=t.faces,n=t.vertices,r=t.faceVertexUvs,i=r[0]&&r[0].length>0,s=r[1]&&r[1].length>0,o=t.morphTargets,a=o.length,l;if(a>0){l=[];for(var c=0;c<a;c++)l[c]={name:o[c].name,data:[]};this.morphTargets.position=l}var u=t.morphNormals,h=u.length,f;if(h>0){f=[];for(var c=0;c<h;c++)f[c]={name:u[c].name,data:[]};this.morphTargets.normal=f}var d=t.skinIndices,p=t.skinWeights,m=d.length===n.length,v=p.length===n.length;n.length>0&&e.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(var c=0;c<e.length;c++){var y=e[c];this.vertices.push(n[y.a],n[y.b],n[y.c]);var w=y.vertexNormals;if(w.length===3)this.normals.push(w[0],w[1],w[2]);else{var x=y.normal;this.normals.push(x,x,x)}var _=y.vertexColors;if(_.length===3)this.colors.push(_[0],_[1],_[2]);else{var S=y.color;this.colors.push(S,S,S)}if(i===!0){var T=r[0][c];T!==void 0?this.uvs.push(T[0],T[1],T[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new $e,new $e,new $e))}if(s===!0){var T=r[1][c];T!==void 0?this.uvs2.push(T[0],T[1],T[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new $e,new $e,new $e))}for(var E=0;E<a;E++){var k=o[E].vertices;l[E].data.push(k[y.a],k[y.b],k[y.c])}for(var E=0;E<h;E++){var A=u[E].vertexNormals[c];f[E].data.push(A.a,A.b,A.c)}m&&this.skinIndices.push(d[y.a],d[y.b],d[y.c]),v&&this.skinWeights.push(p[y.a],p[y.b],p[y.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),this}});function F7(t){if(t.length===0)return-1/0;for(var e=t[0],n=1,r=t.length;n<r;++n)t[n]>e&&(e=t[n]);return e}var zHe=1,ic=new vn,H3=new ft,Xg=new j,Vo=new gl,qw=new gl,_i=new j;function wt(){Object.defineProperty(this,"id",{value:zHe+=2}),this.uuid=ln.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}wt.prototype=Object.assign(Object.create(Aa.prototype),{constructor:wt,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(F7(t)>65535?md:pd)(t,1):this.index=t},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,n){this.groups.push({start:t,count:e,materialIndex:n!==void 0?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix4:function(t){var e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);var n=this.attributes.normal;if(n!==void 0){var r=new rs().getNormalMatrix(t);n.applyNormalMatrix(r),n.needsUpdate=!0}var i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(t),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this},rotateX:function(t){return ic.makeRotationX(t),this.applyMatrix4(ic),this},rotateY:function(t){return ic.makeRotationY(t),this.applyMatrix4(ic),this},rotateZ:function(t){return ic.makeRotationZ(t),this.applyMatrix4(ic),this},translate:function(t,e,n){return ic.makeTranslation(t,e,n),this.applyMatrix4(ic),this},scale:function(t,e,n){return ic.makeScale(t,e,n),this.applyMatrix4(ic),this},lookAt:function(t){return H3.lookAt(t),H3.updateMatrix(),this.applyMatrix4(H3.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Xg).negate(),this.translate(Xg.x,Xg.y,Xg.z),this},setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var n=new ut(e.vertices.length*3,3),r=new ut(e.colors.length*3,3);if(this.setAttribute("position",n.copyVector3sArray(e.vertices)),this.setAttribute("color",r.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var i=new ut(e.lineDistances.length,1);this.setAttribute("lineDistance",i.copyArray(e.lineDistances))}e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new ut(e,3)),this},updateFromObject:function(t){var e=t.geometry;if(t.isMesh){var n=e.__directGeometry;if(e.elementsNeedUpdate===!0&&(n=void 0,e.elementsNeedUpdate=!1),n===void 0)return this.fromGeometry(e);n.verticesNeedUpdate=e.verticesNeedUpdate,n.normalsNeedUpdate=e.normalsNeedUpdate,n.colorsNeedUpdate=e.colorsNeedUpdate,n.uvsNeedUpdate=e.uvsNeedUpdate,n.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=n}var r;return e.verticesNeedUpdate===!0&&(r=this.attributes.position,r!==void 0&&(r.copyVector3sArray(e.vertices),r.needsUpdate=!0),e.verticesNeedUpdate=!1),e.normalsNeedUpdate===!0&&(r=this.attributes.normal,r!==void 0&&(r.copyVector3sArray(e.normals),r.needsUpdate=!0),e.normalsNeedUpdate=!1),e.colorsNeedUpdate===!0&&(r=this.attributes.color,r!==void 0&&(r.copyColorsArray(e.colors),r.needsUpdate=!0),e.colorsNeedUpdate=!1),e.uvsNeedUpdate&&(r=this.attributes.uv,r!==void 0&&(r.copyVector2sArray(e.uvs),r.needsUpdate=!0),e.uvsNeedUpdate=!1),e.lineDistancesNeedUpdate&&(r=this.attributes.lineDistance,r!==void 0&&(r.copyArray(e.lineDistances),r.needsUpdate=!0),e.lineDistancesNeedUpdate=!1),e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=new O7().fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(t.vertices.length*3);if(this.setAttribute("position",new qt(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var n=new Float32Array(t.normals.length*3);this.setAttribute("normal",new qt(n,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var r=new Float32Array(t.colors.length*3);this.setAttribute("color",new qt(r,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var i=new Float32Array(t.uvs.length*2);this.setAttribute("uv",new qt(i,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var s=new Float32Array(t.uvs2.length*2);this.setAttribute("uv2",new qt(s,2).copyVector2sArray(t.uvs2))}this.groups=t.groups;for(var o in t.morphTargets){for(var a=[],l=t.morphTargets[o],c=0,u=l.length;c<u;c++){var h=l[c],f=new ut(h.data.length*3,3);f.name=h.name,a.push(f.copyVector3sArray(h.data))}this.morphAttributes[o]=a}if(t.skinIndices.length>0){var d=new ut(t.skinIndices.length*4,4);this.setAttribute("skinIndex",d.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var p=new ut(t.skinWeights.length*4,4);this.setAttribute("skinWeight",p.copyVector4sArray(t.skinWeights))}return t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new gl);var t=this.attributes.position,e=this.morphAttributes.position;if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(var n=0,r=e.length;n<r;n++){var i=e[n];Vo.setFromBufferAttribute(i),this.morphTargetsRelative?(_i.addVectors(this.boundingBox.min,Vo.min),this.boundingBox.expandByPoint(_i),_i.addVectors(this.boundingBox.max,Vo.max),this.boundingBox.expandByPoint(_i)):(this.boundingBox.expandByPoint(Vo.min),this.boundingBox.expandByPoint(Vo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new iu);var t=this.attributes.position,e=this.morphAttributes.position;if(t){var n=this.boundingSphere.center;if(Vo.setFromBufferAttribute(t),e)for(var r=0,i=e.length;r<i;r++){var s=e[r];qw.setFromBufferAttribute(s),this.morphTargetsRelative?(_i.addVectors(Vo.min,qw.min),Vo.expandByPoint(_i),_i.addVectors(Vo.max,qw.max),Vo.expandByPoint(_i)):(Vo.expandByPoint(qw.min),Vo.expandByPoint(qw.max))}Vo.getCenter(n);for(var o=0,r=0,i=t.count;r<i;r++)_i.fromBufferAttribute(t,r),o=Math.max(o,n.distanceToSquared(_i));if(e)for(var r=0,i=e.length;r<i;r++)for(var s=e[r],a=this.morphTargetsRelative,l=0,c=s.count;l<c;l++)_i.fromBufferAttribute(s,l),a&&(Xg.fromBufferAttribute(t,l),_i.add(Xg)),o=Math.max(o,n.distanceToSquared(_i));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes;if(e.position){var n=e.position.array;if(e.normal===void 0)this.setAttribute("normal",new qt(new Float32Array(n.length),3));else for(var r=e.normal.array,i=0,s=r.length;i<s;i++)r[i]=0;var o=e.normal.array,a,l,c,u=new j,h=new j,f=new j,d=new j,p=new j;if(t)for(var m=t.array,i=0,s=t.count;i<s;i+=3)a=m[i+0]*3,l=m[i+1]*3,c=m[i+2]*3,u.fromArray(n,a),h.fromArray(n,l),f.fromArray(n,c),d.subVectors(f,h),p.subVectors(u,h),d.cross(p),o[a]+=d.x,o[a+1]+=d.y,o[a+2]+=d.z,o[l]+=d.x,o[l+1]+=d.y,o[l+2]+=d.z,o[c]+=d.x,o[c+1]+=d.y,o[c+2]+=d.z;else for(var i=0,s=n.length;i<s;i+=9)u.fromArray(n,i),h.fromArray(n,i+3),f.fromArray(n,i+6),d.subVectors(f,h),p.subVectors(u,h),d.cross(p),o[i]=d.x,o[i+1]=d.y,o[i+2]=d.z,o[i+3]=d.x,o[i+4]=d.y,o[i+5]=d.z,o[i+6]=d.x,o[i+7]=d.y,o[i+8]=d.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(!(t&&t.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);return}e===void 0&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var r in n)if(t.attributes[r]!==void 0)for(var i=n[r],s=i.array,o=t.attributes[r],a=o.array,l=o.itemSize*e,c=Math.min(a.length,s.length-l),u=0,h=l;u<c;u++,h++)s[h]=a[u];return this},normalizeNormals:function(){for(var t=this.attributes.normal,e=0,n=t.count;e<n;e++)_i.x=t.getX(e),_i.y=t.getY(e),_i.z=t.getZ(e),_i.normalize(),t.setXYZ(e,_i.x,_i.y,_i.z)},toNonIndexed:function(){function t(m,v){for(var y=m.array,w=m.itemSize,x=new y.constructor(v.length*w),_=0,S=0,T=0,E=v.length;T<E;T++){_=v[T]*w;for(var k=0;k<w;k++)x[S++]=y[_++]}return new qt(x,w)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new wt,n=this.index.array,r=this.attributes;for(var i in r){var s=r[i],o=t(s,n);e.setAttribute(i,o)}var a=this.morphAttributes;for(i in a){for(var l=[],c=a[i],u=0,h=c.length;u<h;u++){var s=c[u],o=t(s,n);l.push(o)}e.morphAttributes[i]=l}e.morphTargetsRelative=this.morphTargetsRelative;for(var f=this.groups,u=0,d=f.length;u<d;u++){var p=f[u];e.addGroup(p.start,p.count,p.materialIndex)}return e},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){var e=this.parameters;for(var n in e)e[n]!==void 0&&(t[n]=e[n]);return t}t.data={attributes:{}};var r=this.index;r!==null&&(t.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var i=this.attributes;for(var n in i){var s=i[n],o=s.toJSON();s.name!==""&&(o.name=s.name),t.data.attributes[n]=o}var a={},l=!1;for(var n in this.morphAttributes){for(var c=this.morphAttributes[n],u=[],h=0,f=c.length;h<f;h++){var s=c[h],o=s.toJSON();s.name!==""&&(o.name=s.name),u.push(o)}u.length>0&&(a[n]=u,l=!0)}l&&(t.data.morphAttributes=a,t.data.morphTargetsRelative=this.morphTargetsRelative);var d=this.groups;d.length>0&&(t.data.groups=JSON.parse(JSON.stringify(d)));var p=this.boundingSphere;return p!==null&&(t.data.boundingSphere={center:p.center.toArray(),radius:p.radius}),t},clone:function(){return new wt().copy(this)},copy:function(t){var e,n,r;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var i=t.index;i!==null&&this.setIndex(i.clone());var s=t.attributes;for(e in s){var o=s[e];this.setAttribute(e,o.clone())}var a=t.morphAttributes;for(e in a){var l=[],c=a[e];for(n=0,r=c.length;n<r;n++)l.push(c[n].clone());this.morphAttributes[e]=l}this.morphTargetsRelative=t.morphTargetsRelative;var u=t.groups;for(n=0,r=u.length;n<r;n++){var h=u[n];this.addGroup(h.start,h.count,h.materialIndex)}var f=t.boundingBox;f!==null&&(this.boundingBox=f.clone());var d=t.boundingSphere;return d!==null&&(this.boundingSphere=d.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var L7=new vn,gd=new dd,j3=new iu,vd=new j,yd=new j,bd=new j,q3=new j,X3=new j,K3=new j,sE=new j,oE=new j,aE=new j,Kg=new $e,Yg=new $e,Zg=new $e,Xw=new j,lE=new j;function Or(t,e){ft.call(this),this.type="Mesh",this.geometry=t!==void 0?t:new wt,this.material=e!==void 0?e:new Ma,this.updateMorphTargets()}Or.prototype=Object.assign(Object.create(ft.prototype),{constructor:Or,isMesh:!0,copy:function(t){return ft.prototype.copy.call(this,t),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t=this.geometry,e,n,r;if(t.isBufferGeometry){var i=t.morphAttributes,s=Object.keys(i);if(s.length>0){var o=i[s[0]];if(o!==void 0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,n=o.length;e<n;e++)r=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var a=t.morphTargets;a!==void 0&&a.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,e){var n=this.geometry,r=this.material,i=this.matrixWorld;if(r!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),j3.copy(n.boundingSphere),j3.applyMatrix4(i),t.ray.intersectsSphere(j3)!==!1&&(L7.getInverse(i),gd.copy(t.ray).applyMatrix4(L7),!(n.boundingBox!==null&&gd.intersectsBox(n.boundingBox)===!1)))){var s;if(n.isBufferGeometry){var o,a,l,c=n.index,u=n.attributes.position,h=n.morphAttributes.position,f=n.morphTargetsRelative,d=n.attributes.uv,p=n.attributes.uv2,m=n.groups,v=n.drawRange,y,w,x,_,S,T,E,k;if(c!==null)if(Array.isArray(r))for(y=0,x=m.length;y<x;y++)for(S=m[y],T=r[S.materialIndex],E=Math.max(S.start,v.start),k=Math.min(S.start+S.count,v.start+v.count),w=E,_=k;w<_;w+=3)o=c.getX(w),a=c.getX(w+1),l=c.getX(w+2),s=cE(this,T,t,gd,u,h,f,d,p,o,a,l),s&&(s.faceIndex=Math.floor(w/3),s.face.materialIndex=S.materialIndex,e.push(s));else for(E=Math.max(0,v.start),k=Math.min(c.count,v.start+v.count),y=E,x=k;y<x;y+=3)o=c.getX(y),a=c.getX(y+1),l=c.getX(y+2),s=cE(this,r,t,gd,u,h,f,d,p,o,a,l),s&&(s.faceIndex=Math.floor(y/3),e.push(s));else if(u!==void 0)if(Array.isArray(r))for(y=0,x=m.length;y<x;y++)for(S=m[y],T=r[S.materialIndex],E=Math.max(S.start,v.start),k=Math.min(S.start+S.count,v.start+v.count),w=E,_=k;w<_;w+=3)o=w,a=w+1,l=w+2,s=cE(this,T,t,gd,u,h,f,d,p,o,a,l),s&&(s.faceIndex=Math.floor(w/3),s.face.materialIndex=S.materialIndex,e.push(s));else for(E=Math.max(0,v.start),k=Math.min(u.count,v.start+v.count),y=E,x=k;y<x;y+=3)o=y,a=y+1,l=y+2,s=cE(this,r,t,gd,u,h,f,d,p,o,a,l),s&&(s.faceIndex=Math.floor(y/3),e.push(s))}else if(n.isGeometry){var A,M,D,P=Array.isArray(r),N=n.vertices,R=n.faces,F,O=n.faceVertexUvs[0];O.length>0&&(F=O);for(var K=0,J=R.length;K<J;K++){var re=R[K],ae=P?r[re.materialIndex]:r;if(ae!==void 0&&(A=N[re.a],M=N[re.b],D=N[re.c],s=B7(this,ae,t,gd,A,M,D,Xw),s)){if(F&&F[K]){var pe=F[K];Kg.copy(pe[0]),Yg.copy(pe[1]),Zg.copy(pe[2]),s.uv=qi.getUV(Xw,A,M,D,Kg,Yg,Zg,new $e)}s.face=re,s.faceIndex=K,e.push(s)}}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});function B7(t,e,n,r,i,s,o,a){var l;if(e.side===Pi?l=r.intersectTriangle(o,s,i,!0,a):l=r.intersectTriangle(i,s,o,e.side!==Cw,a),l===null)return null;lE.copy(a),lE.applyMatrix4(t.matrixWorld);var c=n.ray.origin.distanceTo(lE);return c<n.near||c>n.far?null:{distance:c,point:lE.clone(),object:t}}function cE(t,e,n,r,i,s,o,a,l,c,u,h){vd.fromBufferAttribute(i,c),yd.fromBufferAttribute(i,u),bd.fromBufferAttribute(i,h);var f=t.morphTargetInfluences;if(e.morphTargets&&s&&f){sE.set(0,0,0),oE.set(0,0,0),aE.set(0,0,0);for(var d=0,p=s.length;d<p;d++){var m=f[d],v=s[d];m!==0&&(q3.fromBufferAttribute(v,c),X3.fromBufferAttribute(v,u),K3.fromBufferAttribute(v,h),o?(sE.addScaledVector(q3,m),oE.addScaledVector(X3,m),aE.addScaledVector(K3,m)):(sE.addScaledVector(q3.sub(vd),m),oE.addScaledVector(X3.sub(yd),m),aE.addScaledVector(K3.sub(bd),m)))}vd.add(sE),yd.add(oE),bd.add(aE)}var y=B7(t,e,n,r,vd,yd,bd,Xw);if(y){a&&(Kg.fromBufferAttribute(a,c),Yg.fromBufferAttribute(a,u),Zg.fromBufferAttribute(a,h),y.uv=qi.getUV(Xw,vd,yd,bd,Kg,Yg,Zg,new $e)),l&&(Kg.fromBufferAttribute(l,c),Yg.fromBufferAttribute(l,u),Zg.fromBufferAttribute(l,h),y.uv2=qi.getUV(Xw,vd,yd,bd,Kg,Yg,Zg,new $e));var w=new qg(c,u,h);qi.getNormal(vd,yd,bd,w.normal),y.face=w}return y}var VHe=0,sc=new vn,Y3=new ft,uE=new j;function Yt(){Object.defineProperty(this,"id",{value:VHe+=2}),this.uuid=ln.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Yt.prototype=Object.assign(Object.create(Aa.prototype),{constructor:Yt,isGeometry:!0,applyMatrix4:function(t){for(var e=new rs().getNormalMatrix(t),n=0,r=this.vertices.length;n<r;n++){var i=this.vertices[n];i.applyMatrix4(t)}for(var n=0,r=this.faces.length;n<r;n++){var s=this.faces[n];s.normal.applyMatrix3(e).normalize();for(var o=0,a=s.vertexNormals.length;o<a;o++)s.vertexNormals[o].applyMatrix3(e).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(t){return sc.makeRotationX(t),this.applyMatrix4(sc),this},rotateY:function(t){return sc.makeRotationY(t),this.applyMatrix4(sc),this},rotateZ:function(t){return sc.makeRotationZ(t),this.applyMatrix4(sc),this},translate:function(t,e,n){return sc.makeTranslation(t,e,n),this.applyMatrix4(sc),this},scale:function(t,e,n){return sc.makeScale(t,e,n),this.applyMatrix4(sc),this},lookAt:function(t){return Y3.lookAt(t),Y3.updateMatrix(),this.applyMatrix4(Y3.matrix),this},fromBufferGeometry:function(t){var e=this,n=t.index!==null?t.index.array:void 0,r=t.attributes;if(r.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var i=r.position.array,s=r.normal!==void 0?r.normal.array:void 0,o=r.color!==void 0?r.color.array:void 0,a=r.uv!==void 0?r.uv.array:void 0,l=r.uv2!==void 0?r.uv2.array:void 0;l!==void 0&&(this.faceVertexUvs[1]=[]);for(var c=0;c<i.length;c+=3)e.vertices.push(new j().fromArray(i,c)),o!==void 0&&e.colors.push(new yt().fromArray(o,c));function u(y,w,x,_){var S=o===void 0?[]:[e.colors[y].clone(),e.colors[w].clone(),e.colors[x].clone()],T=s===void 0?[]:[new j().fromArray(s,y*3),new j().fromArray(s,w*3),new j().fromArray(s,x*3)],E=new qg(y,w,x,T,S,_);e.faces.push(E),a!==void 0&&e.faceVertexUvs[0].push([new $e().fromArray(a,y*2),new $e().fromArray(a,w*2),new $e().fromArray(a,x*2)]),l!==void 0&&e.faceVertexUvs[1].push([new $e().fromArray(l,y*2),new $e().fromArray(l,w*2),new $e().fromArray(l,x*2)])}var h=t.groups;if(h.length>0)for(var c=0;c<h.length;c++)for(var f=h[c],d=f.start,p=f.count,m=d,v=d+p;m<v;m+=3)n!==void 0?u(n[m],n[m+1],n[m+2],f.materialIndex):u(m,m+1,m+2,f.materialIndex);else if(n!==void 0)for(var c=0;c<n.length;c+=3)u(n[c],n[c+1],n[c+2]);else for(var c=0;c<i.length/3;c+=3)u(c,c+1,c+2);return this.computeFaceNormals(),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(uE).negate(),this.translate(uE.x,uE.y,uE.z),this},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,n=e===0?1:1/e,r=new vn;return r.set(n,0,0,-n*t.x,0,n,0,-n*t.y,0,0,n,-n*t.z,0,0,0,1),this.applyMatrix4(r),this},computeFaceNormals:function(){for(var t=new j,e=new j,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],s=this.vertices[i.a],o=this.vertices[i.b],a=this.vertices[i.c];t.subVectors(a,o),e.subVectors(s,o),t.cross(e),t.normalize(),i.normal.copy(t)}},computeVertexNormals:function(t){t===void 0&&(t=!0);var e,n,r,i,s,o;for(o=new Array(this.vertices.length),e=0,n=this.vertices.length;e<n;e++)o[e]=new j;if(t){var a,l,c,u=new j,h=new j;for(r=0,i=this.faces.length;r<i;r++)s=this.faces[r],a=this.vertices[s.a],l=this.vertices[s.b],c=this.vertices[s.c],u.subVectors(c,l),h.subVectors(a,l),u.cross(h),o[s.a].add(u),o[s.b].add(u),o[s.c].add(u)}else for(this.computeFaceNormals(),r=0,i=this.faces.length;r<i;r++)s=this.faces[r],o[s.a].add(s.normal),o[s.b].add(s.normal),o[s.c].add(s.normal);for(e=0,n=this.vertices.length;e<n;e++)o[e].normalize();for(r=0,i=this.faces.length;r<i;r++){s=this.faces[r];var f=s.vertexNormals;f.length===3?(f[0].copy(o[s.a]),f[1].copy(o[s.b]),f[2].copy(o[s.c])):(f[0]=o[s.a].clone(),f[1]=o[s.b].clone(),f[2]=o[s.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,n;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){n=this.faces[t];var r=n.vertexNormals;r.length===3?(r[0].copy(n.normal),r[1].copy(n.normal),r[2].copy(n.normal)):(r[0]=n.normal.clone(),r[1]=n.normal.clone(),r[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,n,r,i;for(n=0,r=this.faces.length;n<r;n++)for(i=this.faces[n],i.__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),t=0,e=i.vertexNormals.length;t<e;t++)i.__originalVertexNormals[t]?i.__originalVertexNormals[t].copy(i.vertexNormals[t]):i.__originalVertexNormals[t]=i.vertexNormals[t].clone();var s=new Yt;for(s.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var o=this.morphNormals[t].faceNormals,a=this.morphNormals[t].vertexNormals,c,u;for(n=0,r=this.faces.length;n<r;n++)c=new j,u={a:new j,b:new j,c:new j},o.push(c),a.push(u)}var l=this.morphNormals[t];s.vertices=this.morphTargets[t].vertices,s.computeFaceNormals(),s.computeVertexNormals();var c,u;for(n=0,r=this.faces.length;n<r;n++)i=this.faces[n],c=l.faceNormals[n],u=l.vertexNormals[n],c.copy(i.normal),u.a.copy(i.vertexNormals[0]),u.b.copy(i.vertexNormals[1]),u.c.copy(i.vertexNormals[2])}for(n=0,r=this.faces.length;n<r;n++)i=this.faces[n],i.normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new gl),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new iu),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,n){if(!(t&&t.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);return}var r,i=this.vertices.length,s=this.vertices,o=t.vertices,a=this.faces,l=t.faces,c=this.colors,u=t.colors;n===void 0&&(n=0),e!==void 0&&(r=new rs().getNormalMatrix(e));for(var h=0,f=o.length;h<f;h++){var d=o[h],p=d.clone();e!==void 0&&p.applyMatrix4(e),s.push(p)}for(var h=0,f=u.length;h<f;h++)c.push(u[h].clone());for(h=0,f=l.length;h<f;h++){var m=l[h],v,y,w,x=m.vertexNormals,_=m.vertexColors;v=new qg(m.a+i,m.b+i,m.c+i),v.normal.copy(m.normal),r!==void 0&&v.normal.applyMatrix3(r).normalize();for(var S=0,T=x.length;S<T;S++)y=x[S].clone(),r!==void 0&&y.applyMatrix3(r).normalize(),v.vertexNormals.push(y);v.color.copy(m.color);for(var S=0,T=_.length;S<T;S++)w=_[S],v.vertexColors.push(w.clone());v.materialIndex=m.materialIndex+n,a.push(v)}for(var h=0,f=t.faceVertexUvs.length;h<f;h++){var E=t.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(var S=0,T=E.length;S<T;S++){for(var k=E[S],A=[],M=0,D=k.length;M<D;M++)A.push(k[M].clone());this.faceVertexUvs[h].push(A)}}},mergeMesh:function(t){if(!(t&&t.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t);return}t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)},mergeVertices:function(){var t={},e=[],n=[],r,i,s=4,o=Math.pow(10,s),a,l,c,u,h,f;for(a=0,l=this.vertices.length;a<l;a++)r=this.vertices[a],i=Math.round(r.x*o)+"_"+Math.round(r.y*o)+"_"+Math.round(r.z*o),t[i]===void 0?(t[i]=a,e.push(this.vertices[a]),n[a]=e.length-1):n[a]=n[t[i]];var d=[];for(a=0,l=this.faces.length;a<l;a++){c=this.faces[a],c.a=n[c.a],c.b=n[c.b],c.c=n[c.c],u=[c.a,c.b,c.c];for(var p=0;p<3;p++)if(u[p]===u[(p+1)%3]){d.push(a);break}}for(a=d.length-1;a>=0;a--){var m=d[a];for(this.faces.splice(m,1),h=0,f=this.faceVertexUvs.length;h<f;h++)this.faceVertexUvs[h].splice(m,1)}var v=this.vertices.length-e.length;return this.vertices=e,v},setFromPoints:function(t){this.vertices=[];for(var e=0,n=t.length;e<n;e++){var r=t[e];this.vertices.push(new j(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,n=0;n<e;n++)t[n]._id=n;function r(c,u){return c.materialIndex-u.materialIndex}t.sort(r);var i=this.faceVertexUvs[0],s=this.faceVertexUvs[1],o,a;i&&i.length===e&&(o=[]),s&&s.length===e&&(a=[]);for(var n=0;n<e;n++){var l=t[n]._id;o&&o.push(i[l]),a&&a.push(s[l])}o&&(this.faceVertexUvs[0]=o),a&&(this.faceVertexUvs[1]=a)},toJSON:function(){var t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),this.parameters!==void 0){var e=this.parameters;for(var n in e)e[n]!==void 0&&(t[n]=e[n]);return t}for(var r=[],i=0;i<this.vertices.length;i++){var s=this.vertices[i];r.push(s.x,s.y,s.z)}for(var o=[],a=[],l={},c=[],u={},h=[],f={},i=0;i<this.faces.length;i++){var d=this.faces[i],p=!0,m=!1,v=this.faceVertexUvs[0][i]!==void 0,y=d.normal.length()>0,w=d.vertexNormals.length>0,x=d.color.r!==1||d.color.g!==1||d.color.b!==1,_=d.vertexColors.length>0,S=0;if(S=A(S,0,0),S=A(S,1,p),S=A(S,2,m),S=A(S,3,v),S=A(S,4,y),S=A(S,5,w),S=A(S,6,x),S=A(S,7,_),o.push(S),o.push(d.a,d.b,d.c),o.push(d.materialIndex),v){var T=this.faceVertexUvs[0][i];o.push(P(T[0]),P(T[1]),P(T[2]))}if(y&&o.push(M(d.normal)),w){var E=d.vertexNormals;o.push(M(E[0]),M(E[1]),M(E[2]))}if(x&&o.push(D(d.color)),_){var k=d.vertexColors;o.push(D(k[0]),D(k[1]),D(k[2]))}}function A(N,R,F){return F?N|1<<R:N&~(1<<R)}function M(N){var R=N.x.toString()+N.y.toString()+N.z.toString();return l[R]!==void 0||(l[R]=a.length/3,a.push(N.x,N.y,N.z)),l[R]}function D(N){var R=N.r.toString()+N.g.toString()+N.b.toString();return u[R]!==void 0||(u[R]=c.length,c.push(N.getHex())),u[R]}function P(N){var R=N.x.toString()+N.y.toString();return f[R]!==void 0||(f[R]=h.length/2,h.push(N.x,N.y)),f[R]}return t.data={},t.data.vertices=r,t.data.normals=a,c.length>0&&(t.data.colors=c),h.length>0&&(t.data.uvs=[h]),t.data.faces=o,t},clone:function(){return new Yt().copy(this)},copy:function(t){var e,n,r,i,s,o;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var a=t.vertices;for(e=0,n=a.length;e<n;e++)this.vertices.push(a[e].clone());var l=t.colors;for(e=0,n=l.length;e<n;e++)this.colors.push(l[e].clone());var c=t.faces;for(e=0,n=c.length;e<n;e++)this.faces.push(c[e].clone());for(e=0,n=t.faceVertexUvs.length;e<n;e++){var u=t.faceVertexUvs[e];for(this.faceVertexUvs[e]===void 0&&(this.faceVertexUvs[e]=[]),r=0,i=u.length;r<i;r++){var h=u[r],f=[];for(s=0,o=h.length;s<o;s++){var d=h[s];f.push(d.clone())}this.faceVertexUvs[e].push(f)}}var p=t.morphTargets;for(e=0,n=p.length;e<n;e++){var m={};if(m.name=p[e].name,p[e].vertices!==void 0)for(m.vertices=[],r=0,i=p[e].vertices.length;r<i;r++)m.vertices.push(p[e].vertices[r].clone());if(p[e].normals!==void 0)for(m.normals=[],r=0,i=p[e].normals.length;r<i;r++)m.normals.push(p[e].normals[r].clone());this.morphTargets.push(m)}var v=t.morphNormals;for(e=0,n=v.length;e<n;e++){var y={};if(v[e].vertexNormals!==void 0)for(y.vertexNormals=[],r=0,i=v[e].vertexNormals.length;r<i;r++){var w=v[e].vertexNormals[r],x={};x.a=w.a.clone(),x.b=w.b.clone(),x.c=w.c.clone(),y.vertexNormals.push(x)}if(v[e].faceNormals!==void 0)for(y.faceNormals=[],r=0,i=v[e].faceNormals.length;r<i;r++)y.faceNormals.push(v[e].faceNormals[r].clone());this.morphNormals.push(y)}var _=t.skinWeights;for(e=0,n=_.length;e<n;e++)this.skinWeights.push(_[e].clone());var S=t.skinIndices;for(e=0,n=S.length;e<n;e++)this.skinIndices.push(S[e].clone());var T=t.lineDistances;for(e=0,n=T.length;e<n;e++)this.lineDistances.push(T[e]);var E=t.boundingBox;E!==null&&(this.boundingBox=E.clone());var k=t.boundingSphere;return k!==null&&(this.boundingSphere=k.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class Z3 extends Yt{constructor(e,n,r,i,s,o){super();this.type="BoxGeometry",this.parameters={width:e,height:n,depth:r,widthSegments:i,heightSegments:s,depthSegments:o},this.fromBufferGeometry(new Kw(e,n,r,i,s,o)),this.mergeVertices()}}class Kw extends wt{constructor(e,n,r,i,s,o){super();this.type="BoxBufferGeometry",this.parameters={width:e,height:n,depth:r,widthSegments:i,heightSegments:s,depthSegments:o};var a=this;e=e||1,n=n||1,r=r||1,i=Math.floor(i)||1,s=Math.floor(s)||1,o=Math.floor(o)||1;var l=[],c=[],u=[],h=[],f=0,d=0;p("z","y","x",-1,-1,r,n,e,o,s,0),p("z","y","x",1,-1,r,n,-e,o,s,1),p("x","z","y",1,1,e,r,n,i,o,2),p("x","z","y",1,-1,e,r,-n,i,o,3),p("x","y","z",1,-1,e,n,r,i,s,4),p("x","y","z",-1,-1,e,n,-r,i,s,5),this.setIndex(l),this.setAttribute("position",new ut(c,3)),this.setAttribute("normal",new ut(u,3)),this.setAttribute("uv",new ut(h,2));function p(m,v,y,w,x,_,S,T,E,k,A){var M=_/E,D=S/k,P=_/2,N=S/2,R=T/2,F=E+1,O=k+1,K=0,J=0,re,ae,pe=new j;for(ae=0;ae<O;ae++){var ke=ae*D-N;for(re=0;re<F;re++){var Te=re*M-P;pe[m]=Te*w,pe[v]=ke*x,pe[y]=R,c.push(pe.x,pe.y,pe.z),pe[m]=0,pe[v]=0,pe[y]=T>0?1:-1,u.push(pe.x,pe.y,pe.z),h.push(re/E),h.push(1-ae/k),K+=1}}for(ae=0;ae<k;ae++)for(re=0;re<E;re++){var Ne=f+re+F*ae,we=f+re+F*(ae+1),me=f+(re+1)+F*(ae+1),He=f+(re+1)+F*ae;l.push(Ne,we,He),l.push(we,me,He),J+=6}a.addGroup(d,J,A),d+=J,f+=K}}}function Jg(t){var e={};for(var n in t){e[n]={};for(var r in t[n]){var i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}function Es(t){for(var e={},n=0;n<t.length;n++){var r=Jg(t[n]);for(var i in r)e[i]=r[i]}return e}var z7={clone:Jg,merge:Es},UHe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,WHe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;function Gs(t){jt.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=UHe,this.fragmentShader=WHe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,t!==void 0&&(t.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}Gs.prototype=Object.create(jt.prototype);Gs.prototype.constructor=Gs;Gs.prototype.isShaderMaterial=!0;Gs.prototype.copy=function(t){return jt.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Jg(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this};Gs.prototype.toJSON=function(t){var e=jt.prototype.toJSON.call(this,t);e.uniforms={};for(var n in this.uniforms){var r=this.uniforms[n],i=r.value;i&&i.isTexture?e.uniforms[n]={type:"t",value:i.toJSON(t).uuid}:i&&i.isColor?e.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?e.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?e.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?e.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?e.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?e.uniforms[n]={type:"m4",value:i.toArray()}:e.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;var s={};for(var o in this.extensions)this.extensions[o]===!0&&(s[o]=!0);return Object.keys(s).length>0&&(e.extensions=s),e};function oc(){ft.call(this),this.type="Camera",this.matrixWorldInverse=new vn,this.projectionMatrix=new vn,this.projectionMatrixInverse=new vn}oc.prototype=Object.assign(Object.create(ft.prototype),{constructor:oc,isCamera:!0,copy:function(t,e){return ft.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){t===void 0&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new j),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){ft.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(t,e){ft.prototype.updateWorldMatrix.call(this,t,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return new this.constructor().copy(this)}});function Si(t,e,n,r){oc.call(this),this.type="PerspectiveCamera",this.fov=t!==void 0?t:50,this.zoom=1,this.near=n!==void 0?n:.1,this.far=r!==void 0?r:2e3,this.focus=10,this.aspect=e!==void 0?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}Si.prototype=Object.assign(Object.create(oc.prototype),{constructor:Si,isPerspectiveCamera:!0,copy:function(t,e){return oc.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=ln.RAD2DEG*2*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(ln.DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/t},getEffectiveFOV:function(){return ln.RAD2DEG*2*Math.atan(Math.tan(ln.DEG2RAD*.5*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,n,r,i,s){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(ln.DEG2RAD*.5*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r,s=this.view;if(this.view!==null&&this.view.enabled){var o=s.fullWidth,a=s.fullHeight;i+=s.offsetX*r/o,e-=s.offsetY*n/a,r*=s.width/o,n*=s.height/a}var l=this.filmOffset;l!==0&&(i+=t*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){var e=ft.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});var Qg=90,ev=1;function tv(t,e,n,r){ft.call(this),this.type="CubeCamera";var i=new Si(Qg,ev,t,e);i.up.set(0,-1,0),i.lookAt(new j(1,0,0)),this.add(i);var s=new Si(Qg,ev,t,e);s.up.set(0,-1,0),s.lookAt(new j(-1,0,0)),this.add(s);var o=new Si(Qg,ev,t,e);o.up.set(0,0,1),o.lookAt(new j(0,1,0)),this.add(o);var a=new Si(Qg,ev,t,e);a.up.set(0,0,-1),a.lookAt(new j(0,-1,0)),this.add(a);var l=new Si(Qg,ev,t,e);l.up.set(0,-1,0),l.lookAt(new j(0,0,1)),this.add(l);var c=new Si(Qg,ev,t,e);c.up.set(0,-1,0),c.lookAt(new j(0,0,-1)),this.add(c),r=r||{format:Sh,magFilter:Oi,minFilter:Oi},this.renderTarget=new Mh(n,r),this.renderTarget.texture.name="CubeCamera",this.update=function(u,h){this.parent===null&&this.updateMatrixWorld();var f=u.getRenderTarget(),d=this.renderTarget,p=d.texture.generateMipmaps;d.texture.generateMipmaps=!1,u.setRenderTarget(d,0),u.render(h,i),u.setRenderTarget(d,1),u.render(h,s),u.setRenderTarget(d,2),u.render(h,o),u.setRenderTarget(d,3),u.render(h,a),u.setRenderTarget(d,4),u.render(h,l),d.texture.generateMipmaps=p,u.setRenderTarget(d,5),u.render(h,c),u.setRenderTarget(f)},this.clear=function(u,h,f,d){for(var p=u.getRenderTarget(),m=this.renderTarget,v=0;v<6;v++)u.setRenderTarget(m,v),u.clear(h,f,d);u.setRenderTarget(p)}}tv.prototype=Object.create(ft.prototype);tv.prototype.constructor=tv;function Mh(t,e,n){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=n),Ts.call(this,t,t,e)}Mh.prototype=Object.create(Ts.prototype);Mh.prototype.constructor=Mh;Mh.prototype.isWebGLCubeRenderTarget=!0;Mh.prototype.fromEquirectangularTexture=function(t,e){this.texture.type=e.type,this.texture.format=e.format,this.texture.encoding=e.encoding;var n=new nu,r={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","	vWorldDirection = transformDirection( position, modelMatrix );","	#include <begin_vertex>","	#include <project_vertex>","}"].join(`
`),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","	vec3 direction = normalize( vWorldDirection );","	vec2 sampleUV;","	sampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","	sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","	gl_FragColor = texture2D( tEquirect, sampleUV );","}"].join(`
`)},i=new Gs({type:"CubemapFromEquirect",uniforms:Jg(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:Pi,blending:eu});i.uniforms.tEquirect.value=e;var s=new Or(new Kw(5,5,5),i);n.add(s);var o=new tv(1,10,1);return o.renderTarget=this,o.renderTarget.texture.name="CubeCameraTexture",o.update(t,n),s.geometry.dispose(),s.material.dispose(),this};function wd(t,e,n,r,i,s,o,a,l,c,u,h){ar.call(this,null,s,o,a,l,c,r,i,u,h),this.image={data:t||null,width:e||1,height:n||1},this.magFilter=l!==void 0?l:li,this.minFilter=c!==void 0?c:li,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}wd.prototype=Object.create(ar.prototype);wd.prototype.constructor=wd;wd.prototype.isDataTexture=!0;var nv=new iu,hE=new j;function rv(t,e,n,r,i,s){this.planes=[t!==void 0?t:new vl,e!==void 0?e:new vl,n!==void 0?n:new vl,r!==void 0?r:new vl,i!==void 0?i:new vl,s!==void 0?s:new vl]}Object.assign(rv.prototype,{set:function(t,e,n,r,i,s){var o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(s),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){for(var e=this.planes,n=0;n<6;n++)e[n].copy(t.planes[n]);return this},setFromProjectionMatrix:function(t){var e=this.planes,n=t.elements,r=n[0],i=n[1],s=n[2],o=n[3],a=n[4],l=n[5],c=n[6],u=n[7],h=n[8],f=n[9],d=n[10],p=n[11],m=n[12],v=n[13],y=n[14],w=n[15];return e[0].setComponents(o-r,u-a,p-h,w-m).normalize(),e[1].setComponents(o+r,u+a,p+h,w+m).normalize(),e[2].setComponents(o+i,u+l,p+f,w+v).normalize(),e[3].setComponents(o-i,u-l,p-f,w-v).normalize(),e[4].setComponents(o-s,u-c,p-d,w-y).normalize(),e[5].setComponents(o+s,u+c,p+d,w+y).normalize(),this},intersectsObject:function(t){var e=t.geometry;return e.boundingSphere===null&&e.computeBoundingSphere(),nv.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(nv)},intersectsSprite:function(t){return nv.center.set(0,0,0),nv.radius=.7071067811865476,nv.applyMatrix4(t.matrixWorld),this.intersectsSphere(nv)},intersectsSphere:function(t){for(var e=this.planes,n=t.center,r=-t.radius,i=0;i<6;i++){var s=e[i].distanceToPoint(n);if(s<r)return!1}return!0},intersectsBox:function(t){for(var e=this.planes,n=0;n<6;n++){var r=e[n];if(hE.x=r.normal.x>0?t.max.x:t.min.x,hE.y=r.normal.y>0?t.max.y:t.min.y,hE.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(hE)<0)return!1}return!0},containsPoint:function(t){for(var e=this.planes,n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}});var ht={common:{diffuse:{value:new yt(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new rs},uv2Transform:{value:new rs},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new $e(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new yt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new yt(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new rs}},sprite:{diffuse:{value:new yt(15658734)},opacity:{value:1},center:{value:new $e(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new rs}}};function V7(){var t=null,e=!1,n=null;function r(i,s){e!==!1&&(n(i,s),t.requestAnimationFrame(r))}return{start:function(){e!==!0&&n!==null&&(t.requestAnimationFrame(r),e=!0)},stop:function(){e=!1},setAnimationLoop:function(i){n=i},setContext:function(i){t=i}}}function GHe(t,e){var n=e.isWebGL2,r=new WeakMap;function i(c,u){var h=c.array,f=c.usage,d=t.createBuffer();t.bindBuffer(u,d),t.bufferData(u,h,f),c.onUploadCallback();var p=5126;return h instanceof Float32Array?p=5126:h instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):h instanceof Uint16Array?p=5123:h instanceof Int16Array?p=5122:h instanceof Uint32Array?p=5125:h instanceof Int32Array?p=5124:h instanceof Int8Array?p=5120:h instanceof Uint8Array&&(p=5121),{buffer:d,type:p,bytesPerElement:h.BYTES_PER_ELEMENT,version:c.version}}function s(c,u,h){var f=u.array,d=u.updateRange;t.bindBuffer(h,c),d.count===-1?t.bufferSubData(h,0,f):(n?t.bufferSubData(h,d.offset*f.BYTES_PER_ELEMENT,f,d.offset,d.count):t.bufferSubData(h,d.offset*f.BYTES_PER_ELEMENT,f.subarray(d.offset,d.offset+d.count)),d.count=-1)}function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),r.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);var u=r.get(c);u&&(t.deleteBuffer(u.buffer),r.delete(c))}function l(c,u){c.isInterleavedBufferAttribute&&(c=c.data);var h=r.get(c);h===void 0?r.set(c,i(c,u)):h.version<c.version&&(s(h.buffer,c,u),h.version=c.version)}return{get:o,remove:a,update:l}}function Yw(t,e,n,r){Yt.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new xd(t,e,n,r)),this.mergeVertices()}Yw.prototype=Object.create(Yt.prototype);Yw.prototype.constructor=Yw;function xd(t,e,n,r){wt.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r},t=t||1,e=e||1;var i=t/2,s=e/2,o=Math.floor(n)||1,a=Math.floor(r)||1,l=o+1,c=a+1,u=t/o,h=e/a,f,d,p=[],m=[],v=[],y=[];for(d=0;d<c;d++){var w=d*h-s;for(f=0;f<l;f++){var x=f*u-i;m.push(x,-w,0),v.push(0,0,1),y.push(f/o),y.push(1-d/a)}}for(d=0;d<a;d++)for(f=0;f<o;f++){var _=f+l*d,S=f+l*(d+1),T=f+1+l*(d+1),E=f+1+l*d;p.push(_,S,E),p.push(S,T,E)}this.setIndex(p),this.setAttribute("position",new ut(m,3)),this.setAttribute("normal",new ut(v,3)),this.setAttribute("uv",new ut(y,2))}xd.prototype=Object.create(wt.prototype);xd.prototype.constructor=xd;var HHe=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,jHe=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,qHe=`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,XHe=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,KHe=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,YHe="vec3 transformed = vec3( position );",ZHe=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,JHe=`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {
	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE  = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS  = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha  = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,QHe=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 );
		fDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,e5e=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;
	}
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;
		}
		if ( clipped ) discard;
	#endif
#endif`,t5e=`#if NUM_CLIPPING_PLANES > 0
	#if ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )
		varying vec3 vViewPosition;
	#endif
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,n5e=`#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )
	varying vec3 vViewPosition;
#endif`,r5e=`#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )
	vViewPosition = - mvPosition.xyz;
#endif`,i5e=`#ifdef USE_COLOR
	diffuseColor.rgb *= vColor;
#endif`,s5e=`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,o5e=`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,a5e=`#ifdef USE_COLOR
	vColor.xyz = color.xyz;
#endif`,l5e=`#define PI 3.14159265359
#define PI2 6.28318530718
#define PI_HALF 1.5707963267949
#define RECIPROCAL_PI 0.31830988618
#define RECIPROCAL_PI2 0.15915494
#define LOG2 1.442695
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
  return m[ 2 ][ 3 ] == - 1.0;
}`,c5e=`#ifdef ENVMAP_TYPE_CUBE_UV
#define cubeUV_maxMipLevel 8.0
#define cubeUV_minMipLevel 4.0
#define cubeUV_maxTileSize 256.0
#define cubeUV_minTileSize 16.0
float getFace(vec3 direction) {
    vec3 absDirection = abs(direction);
    float face = -1.0;
    if (absDirection.x > absDirection.z) {
      if (absDirection.x > absDirection.y)
        face = direction.x > 0.0 ? 0.0 : 3.0;
      else
        face = direction.y > 0.0 ? 1.0 : 4.0;
    } else {
      if (absDirection.z > absDirection.y)
        face = direction.z > 0.0 ? 2.0 : 5.0;
      else
        face = direction.y > 0.0 ? 1.0 : 4.0;
    }
    return face;
}
vec2 getUV(vec3 direction, float face) {
    vec2 uv;
    if (face == 0.0) {
      uv = vec2(-direction.z, direction.y) / abs(direction.x);
    } else if (face == 1.0) {
      uv = vec2(direction.x, -direction.z) / abs(direction.y);
    } else if (face == 2.0) {
      uv = direction.xy / abs(direction.z);
    } else if (face == 3.0) {
      uv = vec2(direction.z, direction.y) / abs(direction.x);
    } else if (face == 4.0) {
      uv = direction.xz / abs(direction.y);
    } else {
      uv = vec2(-direction.x, direction.y) / abs(direction.z);
    }
    return 0.5 * (uv + 1.0);
}
vec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
  float face = getFace(direction);
  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
  mipInt = max(mipInt, cubeUV_minMipLevel);
  float faceSize = exp2(mipInt);
  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
  vec2 uv = getUV(direction, face) * (faceSize - 1.0);
  vec2 f = fract(uv);
  uv += 0.5 - f;
  if (face > 2.0) {
    uv.y += faceSize;
    face -= 3.0;
  }
  uv.x += face * faceSize;
  if(mipInt < cubeUV_maxMipLevel){
    uv.y += 2.0 * cubeUV_maxTileSize;
  }
  uv.y += filterInt * 2.0 * cubeUV_minTileSize;
  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
  uv *= texelSize;
  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.x += texelSize;
  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.y += texelSize;
  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.x -= texelSize;
  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  vec3 tm = mix(tl, tr, f.x);
  vec3 bm = mix(bl, br, f.x);
  return mix(tm, bm, f.y);
}
#define r0 1.0
#define v0 0.339
#define m0 -2.0
#define r1 0.8
#define v1 0.276
#define m1 -1.0
#define r4 0.4
#define v4 0.046
#define m4 2.0
#define r5 0.305
#define v5 0.016
#define m5 3.0
#define r6 0.21
#define v6 0.0038
#define m6 4.0
float roughnessToMip(float roughness) {
  float mip = 0.0;
  if (roughness >= r1) {
    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
  } else if (roughness >= r4) {
    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
  } else if (roughness >= r5) {
    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
  } else if (roughness >= r6) {
    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
  } else {
    mip = -2.0 * log2(1.16 * roughness);  }
  return mip;
}
vec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {
  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);
  float mipF = fract(mip);
  float mipInt = floor(mip);
  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);
  if (mipF == 0.0) {
    return vec4(color0, 1.0);
  } else {
    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);
    return vec4(mix(color0, color1, mipF), 1.0);
  }
}
#endif`,u5e=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	transformedNormal = mat3( instanceMatrix ) * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,h5e=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,f5e=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,d5e=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,p5e=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,m5e="gl_FragColor = linearToOutputTexel( gl_FragColor );",g5e=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value )  {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,v5e=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		}  else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#elif defined( ENVMAP_TYPE_EQUIREC )
		vec2 sampleUV;
		reflectVec = normalize( reflectVec );
		sampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
		sampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;
		vec4 envColor = texture2D( envMap, sampleUV );
	#elif defined( ENVMAP_TYPE_SPHERE )
		reflectVec = normalize( reflectVec );
		vec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );
		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,y5e=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,b5e=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,w5e=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,x5e=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) { 
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,_5e=`#ifdef USE_FOG
	fogDepth = -mvPosition.z;
#endif`,S5e=`#ifdef USE_FOG
	varying float fogDepth;
#endif`,C5e=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,T5e=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,E5e=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,k5e=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,A5e=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,M5e=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
#endif`,I5e=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
		float shadowCameraNear;
		float shadowCameraFar;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,N5e=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
		  vec3 reflectVec = reflect( -viewDir, normal );
		  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
		  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#elif defined( ENVMAP_TYPE_EQUIREC )
			vec2 sampleUV;
			sampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
			sampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );
			#else
				vec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_SPHERE )
			vec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );
			#else
				vec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,$5e=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,R5e=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3	diffuseColor;
	vec3	specularColor;
	float	specularShininess;
	float	specularStrength;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,D5e=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,P5e=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3	diffuseColor;
	vec3	specularColor;
	float	specularShininess;
	float	specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,O5e=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#endif
#ifdef CLEARCOAT
	material.clearcoat = saturate( clearcoat );	material.clearcoatRoughness = max( clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,F5e=`struct PhysicalMaterial {
	vec3	diffuseColor;
	float	specularRoughness;
	vec3	specularColor;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,L5e=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		directLight.color *= all( bvec3( pointLight.shadow, directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		directLight.color *= all( bvec3( spotLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directLight.color *= all( bvec3( directionalLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,B5e=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,z5e=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,V5e=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,U5e=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,W5e=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,G5e=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,H5e=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,j5e=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,q5e=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,X5e=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,K5e=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Y5e=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Z5e=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,J5e=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
	uniform float morphTargetInfluences[ 8 ];
	#else
	uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,Q5e=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
	transformed += morphTarget4 * morphTargetInfluences[ 4 ];
	transformed += morphTarget5 * morphTargetInfluences[ 5 ];
	transformed += morphTarget6 * morphTargetInfluences[ 6 ];
	transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,e6e=`#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
			bitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,t6e=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );
#endif`,n6e=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		float scale = sign( st1.t * st0.s - st0.t * st1.s );
		vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );
		vec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );
		vec3 N = normalize( surf_norm );
		mat3 tsn = mat3( S, T, N );
		mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		return normalize( tsn * mapN );
	}
#endif`,r6e=`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,i6e=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );
	#endif
#endif`,s6e=`#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,o6e=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,a6e=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,l6e=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,c6e=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,u6e=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,h6e=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,f6e=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,d6e=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,p6e=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,m6e=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;
	}
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;
	}
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;
	}
	#endif
#endif`,g6e=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLight directionalLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLights[ i ];
		shadow *= all( bvec2( directionalLight.shadow, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLight spotLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLights[ i ];
		shadow *= all( bvec2( spotLight.shadow, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLight pointLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLights[ i ];
		shadow *= all( bvec2( pointLight.shadow, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#endif
	#endif
	return shadow;
}`,v6e=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,y6e=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,b6e=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,w6e=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,x6e=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,_6e=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,S6e=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,C6e=`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
uniform float toneMappingWhitePoint;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );
}`,T6e=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,E6e=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,k6e=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,A6e=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,M6e=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,I6e=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,N6e=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,$6e=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,R6e=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,D6e=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,P6e=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,O6e=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( gl_FragCoord.z );
	#endif
}`,F6e=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
}`,L6e=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,B6e=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,z6e=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV;
	sampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,V6e=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,U6e=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,W6e=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	vLineDistance = scale * lineDistance;
	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,G6e=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,H6e=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,j6e=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	reflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,q6e=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,X6e=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,K6e=`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Y6e=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Z6e=`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,J6e=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Q6e=`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,e8e=`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
	#define TRANSPARENCY
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef TRANSPARENCY
	uniform float transparency;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_normalmap_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#ifdef TRANSPARENCY
		diffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );
	#endif
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,t8e=`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,n8e=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,r8e=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,i8e=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,s8e=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,o8e=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,a8e=`#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,l8e=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,c8e=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,_n={alphamap_fragment:HHe,alphamap_pars_fragment:jHe,alphatest_fragment:qHe,aomap_fragment:XHe,aomap_pars_fragment:KHe,begin_vertex:YHe,beginnormal_vertex:ZHe,bsdfs:JHe,bumpmap_pars_fragment:QHe,clipping_planes_fragment:e5e,clipping_planes_pars_fragment:t5e,clipping_planes_pars_vertex:n5e,clipping_planes_vertex:r5e,color_fragment:i5e,color_pars_fragment:s5e,color_pars_vertex:o5e,color_vertex:a5e,common:l5e,cube_uv_reflection_fragment:c5e,defaultnormal_vertex:u5e,displacementmap_pars_vertex:h5e,displacementmap_vertex:f5e,emissivemap_fragment:d5e,emissivemap_pars_fragment:p5e,encodings_fragment:m5e,encodings_pars_fragment:g5e,envmap_fragment:v5e,envmap_common_pars_fragment:y5e,envmap_pars_fragment:b5e,envmap_pars_vertex:w5e,envmap_physical_pars_fragment:N5e,envmap_vertex:x5e,fog_vertex:_5e,fog_pars_vertex:S5e,fog_fragment:C5e,fog_pars_fragment:T5e,gradientmap_pars_fragment:E5e,lightmap_fragment:k5e,lightmap_pars_fragment:A5e,lights_lambert_vertex:M5e,lights_pars_begin:I5e,lights_toon_fragment:$5e,lights_toon_pars_fragment:R5e,lights_phong_fragment:D5e,lights_phong_pars_fragment:P5e,lights_physical_fragment:O5e,lights_physical_pars_fragment:F5e,lights_fragment_begin:L5e,lights_fragment_maps:B5e,lights_fragment_end:z5e,logdepthbuf_fragment:V5e,logdepthbuf_pars_fragment:U5e,logdepthbuf_pars_vertex:W5e,logdepthbuf_vertex:G5e,map_fragment:H5e,map_pars_fragment:j5e,map_particle_fragment:q5e,map_particle_pars_fragment:X5e,metalnessmap_fragment:K5e,metalnessmap_pars_fragment:Y5e,morphnormal_vertex:Z5e,morphtarget_pars_vertex:J5e,morphtarget_vertex:Q5e,normal_fragment_begin:e6e,normal_fragment_maps:t6e,normalmap_pars_fragment:n6e,clearcoat_normal_fragment_begin:r6e,clearcoat_normal_fragment_maps:i6e,clearcoat_normalmap_pars_fragment:s6e,packing:o6e,premultiplied_alpha_fragment:a6e,project_vertex:l6e,dithering_fragment:c6e,dithering_pars_fragment:u6e,roughnessmap_fragment:h6e,roughnessmap_pars_fragment:f6e,shadowmap_pars_fragment:d6e,shadowmap_pars_vertex:p6e,shadowmap_vertex:m6e,shadowmask_pars_fragment:g6e,skinbase_vertex:v6e,skinning_pars_vertex:y6e,skinning_vertex:b6e,skinnormal_vertex:w6e,specularmap_fragment:x6e,specularmap_pars_fragment:_6e,tonemapping_fragment:S6e,tonemapping_pars_fragment:C6e,uv_pars_fragment:T6e,uv_pars_vertex:E6e,uv_vertex:k6e,uv2_pars_fragment:A6e,uv2_pars_vertex:M6e,uv2_vertex:I6e,worldpos_vertex:N6e,background_frag:$6e,background_vert:R6e,cube_frag:D6e,cube_vert:P6e,depth_frag:O6e,depth_vert:F6e,distanceRGBA_frag:L6e,distanceRGBA_vert:B6e,equirect_frag:z6e,equirect_vert:V6e,linedashed_frag:U6e,linedashed_vert:W6e,meshbasic_frag:G6e,meshbasic_vert:H6e,meshlambert_frag:j6e,meshlambert_vert:q6e,meshmatcap_frag:X6e,meshmatcap_vert:K6e,meshtoon_frag:Y6e,meshtoon_vert:Z6e,meshphong_frag:J6e,meshphong_vert:Q6e,meshphysical_frag:e8e,meshphysical_vert:t8e,normal_frag:n8e,normal_vert:r8e,points_frag:i8e,points_vert:s8e,shadow_frag:o8e,shadow_vert:a8e,sprite_frag:l8e,sprite_vert:c8e},ac={basic:{uniforms:Es([ht.common,ht.specularmap,ht.envmap,ht.aomap,ht.lightmap,ht.fog]),vertexShader:_n.meshbasic_vert,fragmentShader:_n.meshbasic_frag},lambert:{uniforms:Es([ht.common,ht.specularmap,ht.envmap,ht.aomap,ht.lightmap,ht.emissivemap,ht.fog,ht.lights,{emissive:{value:new yt(0)}}]),vertexShader:_n.meshlambert_vert,fragmentShader:_n.meshlambert_frag},phong:{uniforms:Es([ht.common,ht.specularmap,ht.envmap,ht.aomap,ht.lightmap,ht.emissivemap,ht.bumpmap,ht.normalmap,ht.displacementmap,ht.fog,ht.lights,{emissive:{value:new yt(0)},specular:{value:new yt(1118481)},shininess:{value:30}}]),vertexShader:_n.meshphong_vert,fragmentShader:_n.meshphong_frag},standard:{uniforms:Es([ht.common,ht.envmap,ht.aomap,ht.lightmap,ht.emissivemap,ht.bumpmap,ht.normalmap,ht.displacementmap,ht.roughnessmap,ht.metalnessmap,ht.fog,ht.lights,{emissive:{value:new yt(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:_n.meshphysical_vert,fragmentShader:_n.meshphysical_frag},toon:{uniforms:Es([ht.common,ht.specularmap,ht.aomap,ht.lightmap,ht.emissivemap,ht.bumpmap,ht.normalmap,ht.displacementmap,ht.gradientmap,ht.fog,ht.lights,{emissive:{value:new yt(0)},specular:{value:new yt(1118481)},shininess:{value:30}}]),vertexShader:_n.meshtoon_vert,fragmentShader:_n.meshtoon_frag},matcap:{uniforms:Es([ht.common,ht.bumpmap,ht.normalmap,ht.displacementmap,ht.fog,{matcap:{value:null}}]),vertexShader:_n.meshmatcap_vert,fragmentShader:_n.meshmatcap_frag},points:{uniforms:Es([ht.points,ht.fog]),vertexShader:_n.points_vert,fragmentShader:_n.points_frag},dashed:{uniforms:Es([ht.common,ht.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:_n.linedashed_vert,fragmentShader:_n.linedashed_frag},depth:{uniforms:Es([ht.common,ht.displacementmap]),vertexShader:_n.depth_vert,fragmentShader:_n.depth_frag},normal:{uniforms:Es([ht.common,ht.bumpmap,ht.normalmap,ht.displacementmap,{opacity:{value:1}}]),vertexShader:_n.normal_vert,fragmentShader:_n.normal_frag},sprite:{uniforms:Es([ht.sprite,ht.fog]),vertexShader:_n.sprite_vert,fragmentShader:_n.sprite_frag},background:{uniforms:{uvTransform:{value:new rs},t2D:{value:null}},vertexShader:_n.background_vert,fragmentShader:_n.background_frag},cube:{uniforms:Es([ht.envmap,{opacity:{value:1}}]),vertexShader:_n.cube_vert,fragmentShader:_n.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:_n.equirect_vert,fragmentShader:_n.equirect_frag},distanceRGBA:{uniforms:Es([ht.common,ht.displacementmap,{referencePosition:{value:new j},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:_n.distanceRGBA_vert,fragmentShader:_n.distanceRGBA_frag},shadow:{uniforms:Es([ht.lights,ht.fog,{color:{value:new yt(0)},opacity:{value:1}}]),vertexShader:_n.shadow_vert,fragmentShader:_n.shadow_frag}};ac.physical={uniforms:Es([ac.standard.uniforms,{transparency:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:0},sheen:{value:new yt(0)},clearcoatNormalScale:{value:new $e(1,1)},clearcoatNormalMap:{value:null}}]),vertexShader:_n.meshphysical_vert,fragmentShader:_n.meshphysical_frag};function u8e(t,e,n,r){var i=new yt(0),s=0,o,a,l=null,c=0,u=null;function h(d,p,m,v){var y=p.background,w=t.xr,x=w.getSession&&w.getSession();if(x&&x.environmentBlendMode==="additive"&&(y=null),y===null?f(i,s):y&&y.isColor&&(f(y,1),v=!0),(t.autoClear||v)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),y&&(y.isCubeTexture||y.isWebGLCubeRenderTarget||y.mapping===Og)){a===void 0&&(a=new Or(new Kw(1,1,1),new Gs({type:"BackgroundCubeMaterial",uniforms:Jg(ac.cube.uniforms),vertexShader:ac.cube.vertexShader,fragmentShader:ac.cube.fragmentShader,side:Pi,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(S,T,E){this.matrixWorld.copyPosition(E.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(a));var _=y.isWebGLCubeRenderTarget?y.texture:y;a.material.uniforms.envMap.value=_,a.material.uniforms.flipEnvMap.value=_.isCubeTexture?-1:1,(l!==y||c!==_.version||u!==t.toneMapping)&&(a.material.needsUpdate=!0,l=y,c=_.version,u=t.toneMapping),d.unshift(a,a.geometry,a.material,0,0,null)}else y&&y.isTexture&&(o===void 0&&(o=new Or(new xd(2,2),new Gs({type:"BackgroundMaterial",uniforms:Jg(ac.background.uniforms),vertexShader:ac.background.vertexShader,fragmentShader:ac.background.fragmentShader,side:Rg,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(o)),o.material.uniforms.t2D.value=y,y.matrixAutoUpdate===!0&&y.updateMatrix(),o.material.uniforms.uvTransform.value.copy(y.matrix),(l!==y||c!==y.version||u!==t.toneMapping)&&(o.material.needsUpdate=!0,l=y,c=y.version,u=t.toneMapping),d.unshift(o,o.geometry,o.material,0,0,null))}function f(d,p){e.buffers.color.setClear(d.r,d.g,d.b,p,r)}return{getClearColor:function(){return i},setClearColor:function(d,p){i.set(d),s=p!==void 0?p:1,f(i,s)},getClearAlpha:function(){return s},setClearAlpha:function(d){s=d,f(i,s)},render:h}}function h8e(t,e,n,r){var i=r.isWebGL2,s;function o(c){s=c}function a(c,u){t.drawArrays(s,c,u),n.update(u,s)}function l(c,u,h,f){if(f!==0){var d,p;if(i)d=t,p="drawArraysInstanced";else if(d=e.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[p](s,u,h,f),n.update(h,s,f)}}this.setMode=o,this.render=a,this.renderInstances=l}function f8e(t,e,n){var r;function i(){if(r!==void 0)return r;var T=e.get("EXT_texture_filter_anisotropic");return T!==null?r=t.getParameter(T.MAX_TEXTURE_MAX_ANISOTROPY_EXT):r=0,r}function s(T){if(T==="highp"){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";T="mediump"}return T==="mediump"&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var o=typeof WebGL2RenderingContext!="undefined"&&t instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&t instanceof WebGL2ComputeRenderingContext,a=n.precision!==void 0?n.precision:"highp",l=s(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);var c=n.logarithmicDepthBuffer===!0,u=t.getParameter(34930),h=t.getParameter(35660),f=t.getParameter(3379),d=t.getParameter(34076),p=t.getParameter(34921),m=t.getParameter(36347),v=t.getParameter(36348),y=t.getParameter(36349),w=h>0,x=o||!!e.get("OES_texture_float"),_=w&&x,S=o?t.getParameter(36183):0;return{isWebGL2:o,getMaxAnisotropy:i,getMaxPrecision:s,precision:a,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:f,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:m,maxVaryings:v,maxFragmentUniforms:y,vertexTextures:w,floatFragmentTextures:x,floatVertexTextures:_,maxSamples:S}}function d8e(){var t=this,e=null,n=0,r=!1,i=!1,s=new vl,o=new rs,a={value:null,needsUpdate:!1};this.uniform=a,this.numPlanes=0,this.numIntersection=0,this.init=function(u,h,f){var d=u.length!==0||h||n!==0||r;return r=h,e=c(u,f,0),n=u.length,d},this.beginShadows=function(){i=!0,c(null)},this.endShadows=function(){i=!1,l()},this.setState=function(u,h,f,d,p,m){if(!r||u===null||u.length===0||i&&!f)i?c(null):l();else{var v=i?0:n,y=v*4,w=p.clippingState||null;a.value=w,w=c(u,d,y,m);for(var x=0;x!==y;++x)w[x]=e[x];p.clippingState=w,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=v}};function l(){a.value!==e&&(a.value=e,a.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function c(u,h,f,d){var p=u!==null?u.length:0,m=null;if(p!==0){if(m=a.value,d!==!0||m===null){var v=f+p*4,y=h.matrixWorldInverse;o.getNormalMatrix(y),(m===null||m.length<v)&&(m=new Float32Array(v));for(var w=0,x=f;w!==p;++w,x+=4)s.copy(u[w]).applyMatrix4(y,o),s.normal.toArray(m,x),m[x+3]=s.constant}a.value=m,a.needsUpdate=!0}return t.numPlanes=p,m}}function p8e(t){var e={};return{get:function(n){if(e[n]!==void 0)return e[n];var r;switch(n){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(n)}return r===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),e[n]=r,r}}}function m8e(t,e,n){var r=new WeakMap,i=new WeakMap;function s(u){var h=u.target,f=r.get(h);f.index!==null&&e.remove(f.index);for(var d in f.attributes)e.remove(f.attributes[d]);h.removeEventListener("dispose",s),r.delete(h);var p=i.get(f);p&&(e.remove(p),i.delete(f)),n.memory.geometries--}function o(u,h){var f=r.get(h);return f||(h.addEventListener("dispose",s),h.isBufferGeometry?f=h:h.isGeometry&&(h._bufferGeometry===void 0&&(h._bufferGeometry=new wt().setFromObject(u)),f=h._bufferGeometry),r.set(h,f),n.memory.geometries++,f)}function a(u){var h=u.index,f=u.attributes;h!==null&&e.update(h,34963);for(var d in f)e.update(f[d],34962);var p=u.morphAttributes;for(var d in p)for(var m=p[d],v=0,y=m.length;v<y;v++)e.update(m[v],34962)}function l(u){var h=[],f=u.index,d=u.attributes.position,p=0;if(f!==null){var m=f.array;p=f.version;for(var v=0,y=m.length;v<y;v+=3){var w=m[v+0],x=m[v+1],_=m[v+2];h.push(w,x,x,_,_,w)}}else{var m=d.array;p=d.version;for(var v=0,y=m.length/3-1;v<y;v+=3){var w=v+0,x=v+1,_=v+2;h.push(w,x,x,_,_,w)}}var S=new(F7(h)>65535?md:pd)(h,1);S.version=p,e.update(S,34963);var T=i.get(u);T&&e.remove(T),i.set(u,S)}function c(u){var h=i.get(u);if(h){var f=u.index;f!==null&&h.version<f.version&&l(u)}else l(u);return i.get(u)}return{get:o,update:a,getWireframeAttribute:c}}function g8e(t,e,n,r){var i=r.isWebGL2,s;function o(f){s=f}var a,l;function c(f){a=f.type,l=f.bytesPerElement}function u(f,d){t.drawElements(s,d,a,f*l),n.update(d,s)}function h(f,d,p,m){if(m!==0){var v,y;if(i)v=t,y="drawElementsInstanced";else if(v=e.get("ANGLE_instanced_arrays"),y="drawElementsInstancedANGLE",v===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}v[y](s,p,a,d*l,m),n.update(p,s,m)}}this.setMode=o,this.setIndex=c,this.render=u,this.renderInstances=h}function v8e(t){var e={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,o,a){switch(a=a||1,n.calls++,o){case 4:n.triangles+=a*(s/3);break;case 1:n.lines+=a*(s/2);break;case 3:n.lines+=a*(s-1);break;case 2:n.lines+=a*s;break;case 0:n.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function i(){n.frame++,n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:e,render:n,programs:null,autoReset:!0,reset:i,update:r}}function y8e(t,e){return Math.abs(e[1])-Math.abs(t[1])}function b8e(t){var e={},n=new Float32Array(8);function r(i,s,o,a){var l=i.morphTargetInfluences,c=l===void 0?0:l.length,u=e[s.id];if(u===void 0){u=[];for(var h=0;h<c;h++)u[h]=[h,0];e[s.id]=u}for(var f=o.morphTargets&&s.morphAttributes.position,d=o.morphNormals&&s.morphAttributes.normal,h=0;h<c;h++){var p=u[h];p[1]!==0&&(f&&s.deleteAttribute("morphTarget"+h),d&&s.deleteAttribute("morphNormal"+h))}for(var h=0;h<c;h++){var p=u[h];p[0]=h,p[1]=l[h]}u.sort(y8e);for(var m=0,h=0;h<8;h++){var p=u[h];if(p){var v=p[0],y=p[1];if(y){f&&s.setAttribute("morphTarget"+h,f[v]),d&&s.setAttribute("morphNormal"+h,d[v]),n[h]=y,m+=y;continue}}n[h]=0}var w=s.morphTargetsRelative?1:1-m;a.getUniforms().setValue(t,"morphTargetBaseInfluence",w),a.getUniforms().setValue(t,"morphTargetInfluences",n)}return{update:r}}function w8e(t,e,n,r){var i={};function s(a){var l=r.render.frame,c=a.geometry,u=e.get(a,c);return i[u.id]!==l&&(c.isGeometry&&u.updateFromObject(a),e.update(u),i[u.id]=l),a.isInstancedMesh&&n.update(a.instanceMatrix,34962),u}function o(){i={}}return{update:s,dispose:o}}function lu(t,e,n,r,i,s,o,a,l,c){t=t!==void 0?t:[],e=e!==void 0?e:zT,o=o!==void 0?o:Sh,ar.call(this,t,e,n,r,i,s,o,a,l,c),this.flipY=!1}lu.prototype=Object.create(ar.prototype);lu.prototype.constructor=lu;lu.prototype.isCubeTexture=!0;Object.defineProperty(lu.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}});function iv(t,e,n,r){ar.call(this,null),this.image={data:t||null,width:e||1,height:n||1,depth:r||1},this.magFilter=li,this.minFilter=li,this.wrapR=Ws,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}iv.prototype=Object.create(ar.prototype);iv.prototype.constructor=iv;iv.prototype.isDataTexture2DArray=!0;function sv(t,e,n,r){ar.call(this,null),this.image={data:t||null,width:e||1,height:n||1,depth:r||1},this.magFilter=li,this.minFilter=li,this.wrapR=Ws,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}sv.prototype=Object.create(ar.prototype);sv.prototype.constructor=sv;sv.prototype.isDataTexture3D=!0;var U7=new ar,x8e=new iv,_8e=new sv,W7=new lu,G7=[],H7=[],j7=new Float32Array(16),q7=new Float32Array(9),X7=new Float32Array(4);function ov(t,e,n){var r=t[0];if(r<=0||r>0)return t;var i=e*n,s=G7[i];if(s===void 0&&(s=new Float32Array(i),G7[i]=s),e!==0){r.toArray(s,0);for(var o=1,a=0;o!==e;++o)a+=n,t[o].toArray(s,a)}return s}function Ia(t,e){if(t.length!==e.length)return!1;for(var n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function Uo(t,e){for(var n=0,r=e.length;n<r;n++)t[n]=e[n]}function K7(t,e){var n=H7[e];n===void 0&&(n=new Int32Array(e),H7[e]=n);for(var r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function S8e(t,e){var n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function C8e(t,e){var n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Ia(n,e))return;t.uniform2fv(this.addr,e),Uo(n,e)}}function T8e(t,e){var n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(e.r!==void 0)(n[0]!==e.r||n[1]!==e.g||n[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Ia(n,e))return;t.uniform3fv(this.addr,e),Uo(n,e)}}function E8e(t,e){var n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Ia(n,e))return;t.uniform4fv(this.addr,e),Uo(n,e)}}function k8e(t,e){var n=this.cache,r=e.elements;if(r===void 0){if(Ia(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Uo(n,e)}else{if(Ia(n,r))return;X7.set(r),t.uniformMatrix2fv(this.addr,!1,X7),Uo(n,r)}}function A8e(t,e){var n=this.cache,r=e.elements;if(r===void 0){if(Ia(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Uo(n,e)}else{if(Ia(n,r))return;q7.set(r),t.uniformMatrix3fv(this.addr,!1,q7),Uo(n,r)}}function M8e(t,e){var n=this.cache,r=e.elements;if(r===void 0){if(Ia(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Uo(n,e)}else{if(Ia(n,r))return;j7.set(r),t.uniformMatrix4fv(this.addr,!1,j7),Uo(n,r)}}function I8e(t,e,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(e||U7,i)}function N8e(t,e,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(e||x8e,i)}function $8e(t,e,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(e||_8e,i)}function R8e(t,e,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(e||W7,i)}function D8e(t,e){var n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function P8e(t,e){var n=this.cache;Ia(n,e)||(t.uniform2iv(this.addr,e),Uo(n,e))}function O8e(t,e){var n=this.cache;Ia(n,e)||(t.uniform3iv(this.addr,e),Uo(n,e))}function F8e(t,e){var n=this.cache;Ia(n,e)||(t.uniform4iv(this.addr,e),Uo(n,e))}function L8e(t,e){var n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function B8e(t){switch(t){case 5126:return S8e;case 35664:return C8e;case 35665:return T8e;case 35666:return E8e;case 35674:return k8e;case 35675:return A8e;case 35676:return M8e;case 5124:case 35670:return D8e;case 35667:case 35671:return P8e;case 35668:case 35672:return O8e;case 35669:case 35673:return F8e;case 5125:return L8e;case 35678:case 36198:case 36298:case 36306:case 35682:return I8e;case 35679:case 36299:case 36307:return $8e;case 35680:case 36300:case 36308:case 36293:return R8e;case 36289:case 36303:case 36311:case 36292:return N8e}}function z8e(t,e){t.uniform1fv(this.addr,e)}function V8e(t,e){t.uniform1iv(this.addr,e)}function U8e(t,e){t.uniform2iv(this.addr,e)}function W8e(t,e){t.uniform3iv(this.addr,e)}function G8e(t,e){t.uniform4iv(this.addr,e)}function H8e(t,e){var n=ov(e,this.size,2);t.uniform2fv(this.addr,n)}function j8e(t,e){var n=ov(e,this.size,3);t.uniform3fv(this.addr,n)}function q8e(t,e){var n=ov(e,this.size,4);t.uniform4fv(this.addr,n)}function X8e(t,e){var n=ov(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function K8e(t,e){var n=ov(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function Y8e(t,e){var n=ov(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function Z8e(t,e,n){var r=e.length,i=K7(n,r);t.uniform1iv(this.addr,i);for(var s=0;s!==r;++s)n.safeSetTexture2D(e[s]||U7,i[s])}function J8e(t,e,n){var r=e.length,i=K7(n,r);t.uniform1iv(this.addr,i);for(var s=0;s!==r;++s)n.safeSetTextureCube(e[s]||W7,i[s])}function Q8e(t){switch(t){case 5126:return z8e;case 35664:return H8e;case 35665:return j8e;case 35666:return q8e;case 35674:return X8e;case 35675:return K8e;case 35676:return Y8e;case 5124:case 35670:return V8e;case 35667:case 35671:return U8e;case 35668:case 35672:return W8e;case 35669:case 35673:return G8e;case 35678:case 36198:case 36298:case 36306:case 35682:return Z8e;case 35680:case 36300:case 36308:case 36293:return J8e}}function eje(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=B8e(e.type)}function Y7(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=Q8e(e.type)}Y7.prototype.updateCache=function(t){var e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),Uo(e,t)};function Z7(t){this.id=t,this.seq=[],this.map={}}Z7.prototype.setValue=function(t,e,n){for(var r=this.seq,i=0,s=r.length;i!==s;++i){var o=r[i];o.setValue(t,e[o.id],n)}};var J3=/([\w\d_]+)(\])?(\[|\.)?/g;function J7(t,e){t.seq.push(e),t.map[e.id]=e}function tje(t,e,n){var r=t.name,i=r.length;for(J3.lastIndex=0;;){var s=J3.exec(r),o=J3.lastIndex,a=s[1],l=s[2]==="]",c=s[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===i){J7(n,c===void 0?new eje(a,t,e):new Y7(a,t,e));break}else{var u=n.map,h=u[a];h===void 0&&(h=new Z7(a),J7(n,h)),n=h}}}function Ih(t,e){this.seq=[],this.map={};for(var n=t.getProgramParameter(e,35718),r=0;r<n;++r){var i=t.getActiveUniform(e,r),s=t.getUniformLocation(e,i.name);tje(i,s,this)}}Ih.prototype.setValue=function(t,e,n,r){var i=this.map[e];i!==void 0&&i.setValue(t,n,r)};Ih.prototype.setOptional=function(t,e,n){var r=e[n];r!==void 0&&this.setValue(t,n,r)};Ih.upload=function(t,e,n,r){for(var i=0,s=e.length;i!==s;++i){var o=e[i],a=n[o.id];a.needsUpdate!==!1&&o.setValue(t,a.value,r)}};Ih.seqWithValue=function(t,e){for(var n=[],r=0,i=t.length;r!==i;++r){var s=t[r];s.id in e&&n.push(s)}return n};function Q7(t,e,n){var r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}var nje=0;function rje(t){for(var e=t.split(`
`),n=0;n<e.length;n++)e[n]=n+1+": "+e[n];return e.join(`
`)}function eX(t){switch(t){case fo:return["Linear","( value )"];case XT:return["sRGB","( value )"];case KT:return["RGBE","( value )"];case k3:return["RGBM","( value, 7.0 )"];case A3:return["RGBM","( value, 16.0 )"];case M3:return["RGBD","( value, 256.0 )"];case E3:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case _7:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+t)}}function tX(t,e,n){var r=t.getShaderParameter(e,35713),i=t.getShaderInfoLog(e).trim();if(r&&i==="")return"";var s=t.getShaderSource(e);return"THREE.WebGLShader: gl.getShaderInfoLog() "+n+`
`+i+rje(s)}function Zw(t,e){var n=eX(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function ije(t,e){var n=eX(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function sje(t,e){var n;switch(e){case LT:n="Linear";break;case Fq:n="Reinhard";break;case Lq:n="Uncharted2";break;case Bq:n="OptimizedCineon";break;case zq:n="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function oje(t){var e=[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||t.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""];return e.filter(Jw).join(`
`)}function aje(t){var e=[];for(var n in t){var r=t[n];r!==!1&&e.push("#define "+n+" "+r)}return e.join(`
`)}function lje(t,e){for(var n={},r=t.getProgramParameter(e,35721),i=0;i<r;i++){var s=t.getActiveAttrib(e,i),o=s.name;n[o]=t.getAttribLocation(e,o)}return n}function Jw(t){return t!==""}function nX(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function rX(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var cje=/^[ \t]*#include +<([\w\d./]+)>/gm;function Q3(t){return t.replace(cje,uje)}function uje(t,e){var n=_n[e];if(n===void 0)throw new Error("Can not resolve #include <"+e+">");return Q3(n)}var hje=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function iX(t){return t.replace(hje,fje)}function fje(t,e,n,r){for(var i="",s=parseInt(e);s<parseInt(n);s++)i+=r.replace(/\[ i \]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function sX(t){var e="precision "+t.precision+` float;
precision `+t.precision+" int;";return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function dje(t){var e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===i3?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===pq?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===$g&&(e="SHADOWMAP_TYPE_VSM"),e}function pje(t){var e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case zT:case VT:e="ENVMAP_TYPE_CUBE";break;case Og:case WT:e="ENVMAP_TYPE_CUBE_UV";break;case p3:case UT:e="ENVMAP_TYPE_EQUIREC";break;case m3:e="ENVMAP_TYPE_SPHERE";break}return e}function mje(t){var e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case VT:case UT:e="ENVMAP_MODE_REFRACTION";break}return e}function gje(t){var e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case Tw:e="ENVMAP_BLENDING_MULTIPLY";break;case Pq:e="ENVMAP_BLENDING_MIX";break;case Oq:e="ENVMAP_BLENDING_ADD";break}return e}function vje(t,e,n){var r=t.getContext(),i=n.defines,s=n.vertexShader,o=n.fragmentShader,a=dje(n),l=pje(n),c=mje(n),u=gje(n),h=t.gammaFactor>0?t.gammaFactor:1,f=n.isWebGL2?"":oje(n),d=aje(i),p=r.createProgram(),m,v,y=n.numMultiviewViews;if(n.isRawShaderMaterial?(m=[d].filter(Jw).join(`
`),m.length>0&&(m+=`
`),v=[f,d].filter(Jw).join(`
`),v.length>0&&(v+=`
`)):(m=[sX(n),"#define SHADER_NAME "+n.shaderName,d,n.instancing?"#define USE_INSTANCING":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+h,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+a:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Jw).join(`
`),v=[f,sX(n),"#define SHADER_NAME "+n.shaderName,d,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+h,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+a:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Ew?"#define TONE_MAPPING":"",n.toneMapping!==Ew?_n.tonemapping_pars_fragment:"",n.toneMapping!==Ew?sje("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.outputEncoding||n.mapEncoding||n.matcapEncoding||n.envMapEncoding||n.emissiveMapEncoding||n.lightMapEncoding?_n.encodings_pars_fragment:"",n.mapEncoding?Zw("mapTexelToLinear",n.mapEncoding):"",n.matcapEncoding?Zw("matcapTexelToLinear",n.matcapEncoding):"",n.envMapEncoding?Zw("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMapEncoding?Zw("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMapEncoding?Zw("lightMapTexelToLinear",n.lightMapEncoding):"",n.outputEncoding?ije("linearToOutputTexel",n.outputEncoding):"",n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(Jw).join(`
`)),s=Q3(s),s=nX(s,n),s=rX(s,n),o=Q3(o),o=nX(o,n),o=rX(o,n),s=iX(s),o=iX(o),n.isWebGL2&&!n.isRawShaderMaterial){var w=!1,x=/^\s*#version\s+300\s+es\s*\n/;n.isShaderMaterial&&s.match(x)!==null&&o.match(x)!==null&&(w=!0,s=s.replace(x,""),o=o.replace(x,"")),m=[`#version 300 es
`,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,v=[`#version 300 es
`,"#define varying in",w?"":"out highp vec4 pc_fragColor;",w?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v,y>0&&(m=m.replace(`#version 300 es
`,[`#version 300 es
`,"#extension GL_OVR_multiview2 : require","layout(num_views = "+y+") in;","#define VIEW_ID gl_ViewID_OVR"].join(`
`)),m=m.replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join(`
`),["uniform mat4 modelViewMatrices["+y+"];","uniform mat4 projectionMatrices["+y+"];","uniform mat4 viewMatrices["+y+"];","uniform mat3 normalMatrices["+y+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join(`
`)),v=v.replace(`#version 300 es
`,[`#version 300 es
`,"#extension GL_OVR_multiview2 : require","#define VIEW_ID gl_ViewID_OVR"].join(`
`)),v=v.replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+y+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join(`
`)))}var _=m+s,S=v+o,T=Q7(r,35633,_),E=Q7(r,35632,S);if(r.attachShader(p,T),r.attachShader(p,E),n.index0AttributeName!==void 0?r.bindAttribLocation(p,0,n.index0AttributeName):n.morphTargets===!0&&r.bindAttribLocation(p,0,"position"),r.linkProgram(p),t.debug.checkShaderErrors){var k=r.getProgramInfoLog(p).trim(),A=r.getShaderInfoLog(T).trim(),M=r.getShaderInfoLog(E).trim(),D=!0,P=!0;if(r.getProgramParameter(p,35714)===!1){D=!1;var N=tX(r,T,"vertex"),R=tX(r,E,"fragment");console.error("THREE.WebGLProgram: shader error: ",r.getError(),"35715",r.getProgramParameter(p,35715),"gl.getProgramInfoLog",k,N,R)}else k!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",k):(A===""||M==="")&&(P=!1);P&&(this.diagnostics={runnable:D,programLog:k,vertexShader:{log:A,prefix:m},fragmentShader:{log:M,prefix:v}})}r.deleteShader(T),r.deleteShader(E);var F;this.getUniforms=function(){return F===void 0&&(F=new Ih(r,p)),F};var O;return this.getAttributes=function(){return O===void 0&&(O=lje(r,p)),O},this.destroy=function(){r.deleteProgram(p),this.program=void 0},this.name=n.shaderName,this.id=nje++,this.cacheKey=e,this.usedTimes=1,this.program=p,this.vertexShader=T,this.fragmentShader=E,this.numMultiviewViews=y,this}function yje(t,e,n){var r=[],i=n.isWebGL2,s=n.logarithmicDepthBuffer,o=n.floatVertexTextures,a=n.precision,l=n.maxVertexUniforms,c=n.vertexTextures,u={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},h=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","numMultiviewViews","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function f(m,v){var y;if(v){var w=ac[v];y={name:m.type,uniforms:z7.clone(w.uniforms),vertexShader:w.vertexShader,fragmentShader:w.fragmentShader}}else y={name:m.type,uniforms:m.uniforms,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader};return y}function d(m){var v=m.skeleton,y=v.bones;if(o)return 1024;var w=l,x=Math.floor((w-20)/4),_=Math.min(x,y.length);return _<y.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+y.length+" bones. This GPU supports "+_+"."),0):_}function p(m){var v;return m?m.isTexture?v=m.encoding:m.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),v=m.texture.encoding):v=fo,v}this.getParameters=function(m,v,y,w,x,_,S){var T=w.fog,E=m.isMeshStandardMaterial?w.environment:null,k=m.envMap||E,A=u[m.type],M=S.isSkinnedMesh?d(S):0;m.precision!==null&&(a=n.getMaxPrecision(m.precision),a!==m.precision&&console.warn("THREE.WebGLProgram.getParameters:",m.precision,"not supported, using",a,"instead."));var D=f(m,A);m.onBeforeCompile(D,t);var P=t.getRenderTarget(),N=P&&P.isWebGLMultiviewRenderTarget?P.numViews:0,R={isWebGL2:i,shaderID:A,shaderName:D.name,uniforms:D.uniforms,vertexShader:D.vertexShader,fragmentShader:D.fragmentShader,defines:m.defines,isRawShaderMaterial:m.isRawShaderMaterial,isShaderMaterial:m.isShaderMaterial,precision:a,instancing:S.isInstancedMesh===!0,supportsVertexTextures:c,numMultiviewViews:N,outputEncoding:P!==null?p(P.texture):t.outputEncoding,map:!!m.map,mapEncoding:p(m.map),matcap:!!m.matcap,matcapEncoding:p(m.matcap),envMap:!!k,envMapMode:k&&k.mapping,envMapEncoding:p(k),envMapCubeUV:!!k&&(k.mapping===Og||k.mapping===WT),lightMap:!!m.lightMap,lightMapEncoding:p(m.lightMap),aoMap:!!m.aoMap,emissiveMap:!!m.emissiveMap,emissiveMapEncoding:p(m.emissiveMap),bumpMap:!!m.bumpMap,normalMap:!!m.normalMap,objectSpaceNormalMap:m.normalMapType===T7,tangentSpaceNormalMap:m.normalMapType===ld,clearcoatNormalMap:!!m.clearcoatNormalMap,displacementMap:!!m.displacementMap,roughnessMap:!!m.roughnessMap,metalnessMap:!!m.metalnessMap,specularMap:!!m.specularMap,alphaMap:!!m.alphaMap,gradientMap:!!m.gradientMap,sheen:!!m.sheen,combine:m.combine,vertexTangents:m.normalMap&&m.vertexTangents,vertexColors:m.vertexColors,vertexUvs:!!m.map||!!m.bumpMap||!!m.normalMap||!!m.specularMap||!!m.alphaMap||!!m.emissiveMap||!!m.roughnessMap||!!m.metalnessMap||!!m.clearcoatNormalMap||!!m.displacementMap,uvsVertexOnly:!(!!m.map||!!m.bumpMap||!!m.normalMap||!!m.specularMap||!!m.alphaMap||!!m.emissiveMap||!!m.roughnessMap||!!m.metalnessMap||!!m.clearcoatNormalMap)&&!!m.displacementMap,fog:!!T,useFog:m.fog,fogExp2:T&&T.isFogExp2,flatShading:m.flatShading,sizeAttenuation:m.sizeAttenuation,logarithmicDepthBuffer:s,skinning:m.skinning&&M>0,maxBones:M,useVertexTexture:o,morphTargets:m.morphTargets,morphNormals:m.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:v.directional.length,numPointLights:v.point.length,numSpotLights:v.spot.length,numRectAreaLights:v.rectArea.length,numHemiLights:v.hemi.length,numDirLightShadows:v.directionalShadowMap.length,numPointLightShadows:v.pointShadowMap.length,numSpotLightShadows:v.spotShadowMap.length,numClippingPlanes:x,numClipIntersection:_,dithering:m.dithering,shadowMapEnabled:t.shadowMap.enabled&&y.length>0,shadowMapType:t.shadowMap.type,toneMapping:m.toneMapped?t.toneMapping:Ew,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:m.premultipliedAlpha,alphaTest:m.alphaTest,doubleSided:m.side===Cw,flipSided:m.side===Pi,depthPacking:m.depthPacking!==void 0?m.depthPacking:!1,index0AttributeName:m.index0AttributeName,extensionDerivatives:m.extensions&&m.extensions.derivatives,extensionFragDepth:m.extensions&&m.extensions.frawbuffers,extensionDrawbuffers:m.extensions&&m.extensions.drawbuffers,extensionShaderTextureLOD:m.extensions&&m.extensions.shaderTextureLOD,rendererExtensionFragDepth:i||e.get("EXT_frag_depth")!==null,rendererExtensionDrawBuffers:i||e.get("WEBGL_draw_buffers")!==null,rendererExtensionShaderTextureLod:i||e.get("EXT_shader_texture_lod")!==null,onBeforeCompile:m.onBeforeCompile};return R},this.getProgramCacheKey=function(m){var v=[];if(m.shaderID?v.push(m.shaderID):(v.push(m.fragmentShader),v.push(m.vertexShader)),m.defines!==void 0)for(var y in m.defines)v.push(y),v.push(m.defines[y]);if(m.isRawShaderMaterial===void 0){for(var w=0;w<h.length;w++)v.push(m[h[w]]);v.push(t.outputEncoding),v.push(t.gammaFactor)}return v.push(m.onBeforeCompile.toString()),v.join()},this.acquireProgram=function(m,v){for(var y,w=0,x=r.length;w<x;w++){var _=r[w];if(_.cacheKey===v){y=_,++y.usedTimes;break}}return y===void 0&&(y=new vje(t,v,m),r.push(y)),y},this.releaseProgram=function(m){if(--m.usedTimes==0){var v=r.indexOf(m);r[v]=r[r.length-1],r.pop(),m.destroy()}},this.programs=r}function bje(){var t=new WeakMap;function e(s){var o=t.get(s);return o===void 0&&(o={},t.set(s,o)),o}function n(s){t.delete(s)}function r(s,o,a){t.get(s)[o]=a}function i(){t=new WeakMap}return{get:e,remove:n,update:r,dispose:i}}function wje(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function xje(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function oX(){var t=[],e=0,n=[],r=[],i={id:-1};function s(){e=0,n.length=0,r.length=0}function o(u,h,f,d,p,m){var v=t[e];return v===void 0?(v={id:u.id,object:u,geometry:h,material:f,program:f.program||i,groupOrder:d,renderOrder:u.renderOrder,z:p,group:m},t[e]=v):(v.id=u.id,v.object=u,v.geometry=h,v.material=f,v.program=f.program||i,v.groupOrder=d,v.renderOrder=u.renderOrder,v.z=p,v.group=m),e++,v}function a(u,h,f,d,p,m){var v=o(u,h,f,d,p,m);(f.transparent===!0?r:n).push(v)}function l(u,h,f,d,p,m){var v=o(u,h,f,d,p,m);(f.transparent===!0?r:n).unshift(v)}function c(u,h){n.length>1&&n.sort(u||wje),r.length>1&&r.sort(h||xje)}return{opaque:n,transparent:r,init:s,push:a,unshift:l,sort:c}}function _je(){var t=new WeakMap;function e(i){var s=i.target;s.removeEventListener("dispose",e),t.delete(s)}function n(i,s){var o=t.get(i),a;return o===void 0?(a=new oX,t.set(i,new WeakMap),t.get(i).set(s,a),i.addEventListener("dispose",e)):(a=o.get(s),a===void 0&&(a=new oX,o.set(s,a))),a}function r(){t=new WeakMap}return{get:n,dispose:r}}function Sje(){var t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];var n;switch(e.type){case"DirectionalLight":n={direction:new j,color:new yt,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new $e};break;case"SpotLight":n={position:new j,direction:new j,color:new yt,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new $e};break;case"PointLight":n={position:new j,color:new yt,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new $e,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":n={direction:new j,skyColor:new yt,groundColor:new yt};break;case"RectAreaLight":n={color:new yt,position:new j,halfWidth:new j,halfHeight:new j};break}return t[e.id]=n,n}}}var Cje=0;function Tje(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function Eje(){for(var t=new Sje,e={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},n=0;n<9;n++)e.probe.push(new j);var r=new j,i=new vn,s=new vn;function o(a,l,c){for(var u=0,h=0,f=0,d=0;d<9;d++)e.probe[d].set(0,0,0);var p=0,m=0,v=0,y=0,w=0,x=0,_=0,S=0,T=c.matrixWorldInverse;a.sort(Tje);for(var d=0,E=a.length;d<E;d++){var k=a[d],A=k.color,M=k.intensity,D=k.distance,P=k.shadow&&k.shadow.map?k.shadow.map.texture:null;if(k.isAmbientLight)u+=A.r*M,h+=A.g*M,f+=A.b*M;else if(k.isLightProbe)for(var N=0;N<9;N++)e.probe[N].addScaledVector(k.sh.coefficients[N],M);else if(k.isDirectionalLight){var R=t.get(k);if(R.color.copy(k.color).multiplyScalar(k.intensity),R.direction.setFromMatrixPosition(k.matrixWorld),r.setFromMatrixPosition(k.target.matrixWorld),R.direction.sub(r),R.direction.transformDirection(T),R.shadow=k.castShadow,k.castShadow){var F=k.shadow;R.shadowBias=F.bias,R.shadowRadius=F.radius,R.shadowMapSize=F.mapSize,e.directionalShadowMap[p]=P,e.directionalShadowMatrix[p]=k.shadow.matrix,x++}e.directional[p]=R,p++}else if(k.isSpotLight){var R=t.get(k);if(R.position.setFromMatrixPosition(k.matrixWorld),R.position.applyMatrix4(T),R.color.copy(A).multiplyScalar(M),R.distance=D,R.direction.setFromMatrixPosition(k.matrixWorld),r.setFromMatrixPosition(k.target.matrixWorld),R.direction.sub(r),R.direction.transformDirection(T),R.coneCos=Math.cos(k.angle),R.penumbraCos=Math.cos(k.angle*(1-k.penumbra)),R.decay=k.decay,R.shadow=k.castShadow,k.castShadow){var F=k.shadow;R.shadowBias=F.bias,R.shadowRadius=F.radius,R.shadowMapSize=F.mapSize,e.spotShadowMap[v]=P,e.spotShadowMatrix[v]=k.shadow.matrix,S++}e.spot[v]=R,v++}else if(k.isRectAreaLight){var R=t.get(k);R.color.copy(A).multiplyScalar(M),R.position.setFromMatrixPosition(k.matrixWorld),R.position.applyMatrix4(T),s.identity(),i.copy(k.matrixWorld),i.premultiply(T),s.extractRotation(i),R.halfWidth.set(k.width*.5,0,0),R.halfHeight.set(0,k.height*.5,0),R.halfWidth.applyMatrix4(s),R.halfHeight.applyMatrix4(s),e.rectArea[y]=R,y++}else if(k.isPointLight){var R=t.get(k);if(R.position.setFromMatrixPosition(k.matrixWorld),R.position.applyMatrix4(T),R.color.copy(k.color).multiplyScalar(k.intensity),R.distance=k.distance,R.decay=k.decay,R.shadow=k.castShadow,k.castShadow){var F=k.shadow;R.shadowBias=F.bias,R.shadowRadius=F.radius,R.shadowMapSize=F.mapSize,R.shadowCameraNear=F.camera.near,R.shadowCameraFar=F.camera.far,e.pointShadowMap[m]=P,e.pointShadowMatrix[m]=k.shadow.matrix,_++}e.point[m]=R,m++}else if(k.isHemisphereLight){var R=t.get(k);R.direction.setFromMatrixPosition(k.matrixWorld),R.direction.transformDirection(T),R.direction.normalize(),R.skyColor.copy(k.color).multiplyScalar(M),R.groundColor.copy(k.groundColor).multiplyScalar(M),e.hemi[w]=R,w++}}e.ambient[0]=u,e.ambient[1]=h,e.ambient[2]=f;var O=e.hash;(O.directionalLength!==p||O.pointLength!==m||O.spotLength!==v||O.rectAreaLength!==y||O.hemiLength!==w||O.numDirectionalShadows!==x||O.numPointShadows!==_||O.numSpotShadows!==S)&&(e.directional.length=p,e.spot.length=v,e.rectArea.length=y,e.point.length=m,e.hemi.length=w,e.directionalShadowMap.length=x,e.pointShadowMap.length=_,e.spotShadowMap.length=S,e.directionalShadowMatrix.length=x,e.pointShadowMatrix.length=_,e.spotShadowMatrix.length=S,O.directionalLength=p,O.pointLength=m,O.spotLength=v,O.rectAreaLength=y,O.hemiLength=w,O.numDirectionalShadows=x,O.numPointShadows=_,O.numSpotShadows=S,e.version=Cje++)}return{setup:o,state:e}}function aX(){var t=new Eje,e=[],n=[];function r(){e.length=0,n.length=0}function i(l){e.push(l)}function s(l){n.push(l)}function o(l){t.setup(e,n,l)}var a={lightsArray:e,shadowsArray:n,lights:t};return{init:r,state:a,setupLights:o,pushLight:i,pushShadow:s}}function kje(){var t=new WeakMap;function e(i){var s=i.target;s.removeEventListener("dispose",e),t.delete(s)}function n(i,s){var o;return t.has(i)===!1?(o=new aX,t.set(i,new WeakMap),t.get(i).set(s,o),i.addEventListener("dispose",e)):t.get(i).has(s)===!1?(o=new aX,t.get(i).set(s,o)):o=t.get(i).get(s),o}function r(){t=new WeakMap}return{get:n,dispose:r}}function Nh(t){jt.call(this),this.type="MeshDepthMaterial",this.depthPacking=S7,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}Nh.prototype=Object.create(jt.prototype);Nh.prototype.constructor=Nh;Nh.prototype.isMeshDepthMaterial=!0;Nh.prototype.copy=function(t){return jt.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this};function $h(t){jt.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new j,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}$h.prototype=Object.create(jt.prototype);$h.prototype.constructor=$h;$h.prototype.isMeshDistanceMaterial=!0;$h.prototype.copy=function(t){return jt.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this};var Aje=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
  float mean = 0.0;
  float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );
  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
    #ifdef HORIZONAL_PASS
      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
      mean += distribution.x;
      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
    #else
      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );
      mean += depth;
      squared_mean += depth * depth;
    #endif
  }
  mean = mean * HALF_SAMPLE_RATE;
  squared_mean = squared_mean * HALF_SAMPLE_RATE;
  float std_dev = sqrt( squared_mean - mean * mean );
  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`,Mje=`void main() {
	gl_Position = vec4( position, 1.0 );
}`;function lX(t,e,n){var r=new rv,i=new $e,s=new $e,o=new lr,a=[],l=[],c={},u={0:Pi,1:Rg,2:Cw},h=new Gs({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new $e},radius:{value:4}},vertexShader:Mje,fragmentShader:Aje}),f=h.clone();f.defines.HORIZONAL_PASS=1;var d=new wt;d.setAttribute("position",new qt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var p=new Or(d,h),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=i3,this.render=function(S,T,E){if(m.enabled!==!1&&!(m.autoUpdate===!1&&m.needsUpdate===!1)&&S.length!==0){var k=t.getRenderTarget(),A=t.getActiveCubeFace(),M=t.getActiveMipmapLevel(),D=t.state;D.setBlending(eu),D.buffers.color.setClear(1,1,1,1),D.buffers.depth.setTest(!0),D.setScissorTest(!1);for(var P=0,N=S.length;P<N;P++){var R=S[P],F=R.shadow;if(F===void 0){console.warn("THREE.WebGLShadowMap:",R,"has no shadow.");continue}i.copy(F.mapSize);var O=F.getFrameExtents();if(i.multiply(O),s.copy(F.mapSize),(i.x>n||i.y>n)&&(console.warn("THREE.WebGLShadowMap:",R,"has shadow exceeding max texture size, reducing"),i.x>n&&(s.x=Math.floor(n/O.x),i.x=s.x*O.x,F.mapSize.x=s.x),i.y>n&&(s.y=Math.floor(n/O.y),i.y=s.y*O.y,F.mapSize.y=s.y)),F.map===null&&!F.isPointLightShadow&&this.type===$g){var K={minFilter:Oi,magFilter:Oi,format:pl};F.map=new Ts(i.x,i.y,K),F.map.texture.name=R.name+".shadowMap",F.mapPass=new Ts(i.x,i.y,K),F.camera.updateProjectionMatrix()}if(F.map===null){var K={minFilter:li,magFilter:li,format:pl};F.map=new Ts(i.x,i.y,K),F.map.texture.name=R.name+".shadowMap",F.camera.updateProjectionMatrix()}t.setRenderTarget(F.map),t.clear();for(var J=F.getViewportCount(),re=0;re<J;re++){var ae=F.getViewport(re);o.set(s.x*ae.x,s.y*ae.y,s.x*ae.z,s.y*ae.w),D.viewport(o),F.updateMatrices(R,re),r=F.getFrustum(),_(T,E,F.camera,R,this.type)}!F.isPointLightShadow&&this.type===$g&&v(F,E)}m.needsUpdate=!1,t.setRenderTarget(k,A,M)}};function v(S,T){var E=e.update(p);h.uniforms.shadow_pass.value=S.map.texture,h.uniforms.resolution.value=S.mapSize,h.uniforms.radius.value=S.radius,t.setRenderTarget(S.mapPass),t.clear(),t.renderBufferDirect(T,null,E,h,p,null),f.uniforms.shadow_pass.value=S.mapPass.texture,f.uniforms.resolution.value=S.mapSize,f.uniforms.radius.value=S.radius,t.setRenderTarget(S.map),t.clear(),t.renderBufferDirect(T,null,E,f,p,null)}function y(S,T,E){var k=S<<0|T<<1|E<<2,A=a[k];return A===void 0&&(A=new Nh({depthPacking:C7,morphTargets:S,skinning:T}),a[k]=A),A}function w(S,T,E){var k=S<<0|T<<1|E<<2,A=l[k];return A===void 0&&(A=new $h({morphTargets:S,skinning:T}),l[k]=A),A}function x(S,T,E,k,A,M){var D=S.geometry,P=null,N=y,R=S.customDepthMaterial;if(E.isPointLight===!0&&(N=w,R=S.customDistanceMaterial),R===void 0){var F=!1;T.morphTargets===!0&&(D.isBufferGeometry===!0?F=D.morphAttributes&&D.morphAttributes.position&&D.morphAttributes.position.length>0:D.isGeometry===!0&&(F=D.morphTargets&&D.morphTargets.length>0));var O=!1;S.isSkinnedMesh===!0&&(T.skinning===!0?O=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",S));var K=S.isInstancedMesh===!0;P=N(F,O,K)}else P=R;if(t.localClippingEnabled&&T.clipShadows===!0&&T.clippingPlanes.length!==0){var J=P.uuid,re=T.uuid,ae=c[J];ae===void 0&&(ae={},c[J]=ae);var pe=ae[re];pe===void 0&&(pe=P.clone(),ae[re]=pe),P=pe}return P.visible=T.visible,P.wireframe=T.wireframe,M===$g?P.side=T.shadowSide!==null?T.shadowSide:T.side:P.side=T.shadowSide!==null?T.shadowSide:u[T.side],P.clipShadows=T.clipShadows,P.clippingPlanes=T.clippingPlanes,P.clipIntersection=T.clipIntersection,P.wireframeLinewidth=T.wireframeLinewidth,P.linewidth=T.linewidth,E.isPointLight===!0&&P.isMeshDistanceMaterial===!0&&(P.referencePosition.setFromMatrixPosition(E.matrixWorld),P.nearDistance=k,P.farDistance=A),P}function _(S,T,E,k,A){if(S.visible!==!1){var M=S.layers.test(T.layers);if(M&&(S.isMesh||S.isLine||S.isPoints)&&(S.castShadow||S.receiveShadow&&A===$g)&&(!S.frustumCulled||r.intersectsObject(S))){S.modelViewMatrix.multiplyMatrices(E.matrixWorldInverse,S.matrixWorld);var D=e.update(S),P=S.material;if(Array.isArray(P))for(var N=D.groups,R=0,F=N.length;R<F;R++){var O=N[R],K=P[O.materialIndex];if(K&&K.visible){var J=x(S,K,k,E.near,E.far,A);t.renderBufferDirect(E,null,D,J,S,O)}}else if(P.visible){var J=x(S,P,k,E.near,E.far,A);t.renderBufferDirect(E,null,D,J,S,null)}}for(var re=S.children,ae=0,pe=re.length;ae<pe;ae++)_(re[ae],T,E,k,A)}}}function Ije(t,e,n){var r=n.isWebGL2;function i(){var ce=!1,qe=new lr,bt=null,Ot=new lr(0,0,0,0);return{setMask:function(gt){bt!==gt&&!ce&&(t.colorMask(gt,gt,gt,gt),bt=gt)},setLocked:function(gt){ce=gt},setClear:function(gt,dn,Kn,ur,go){go===!0&&(gt*=ur,dn*=ur,Kn*=ur),qe.set(gt,dn,Kn,ur),Ot.equals(qe)===!1&&(t.clearColor(gt,dn,Kn,ur),Ot.copy(qe))},reset:function(){ce=!1,bt=null,Ot.set(-1,0,0,0)}}}function s(){var ce=!1,qe=null,bt=null,Ot=null;return{setTest:function(gt){gt?Fe(2929):je(2929)},setMask:function(gt){qe!==gt&&!ce&&(t.depthMask(gt),qe=gt)},setFunc:function(gt){if(bt!==gt){if(gt)switch(gt){case Aq:t.depthFunc(512);break;case Mq:t.depthFunc(519);break;case Iq:t.depthFunc(513);break;case FT:t.depthFunc(515);break;case Nq:t.depthFunc(514);break;case $q:t.depthFunc(518);break;case Rq:t.depthFunc(516);break;case Dq:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);bt=gt}},setLocked:function(gt){ce=gt},setClear:function(gt){Ot!==gt&&(t.clearDepth(gt),Ot=gt)},reset:function(){ce=!1,qe=null,bt=null,Ot=null}}}function o(){var ce=!1,qe=null,bt=null,Ot=null,gt=null,dn=null,Kn=null,ur=null,go=null;return{setTest:function(Yn){ce||(Yn?Fe(2960):je(2960))},setMask:function(Yn){qe!==Yn&&!ce&&(t.stencilMask(Yn),qe=Yn)},setFunc:function(Yn,Ds,Li){(bt!==Yn||Ot!==Ds||gt!==Li)&&(t.stencilFunc(Yn,Ds,Li),bt=Yn,Ot=Ds,gt=Li)},setOp:function(Yn,Ds,Li){(dn!==Yn||Kn!==Ds||ur!==Li)&&(t.stencilOp(Yn,Ds,Li),dn=Yn,Kn=Ds,ur=Li)},setLocked:function(Yn){ce=Yn},setClear:function(Yn){go!==Yn&&(t.clearStencil(Yn),go=Yn)},reset:function(){ce=!1,qe=null,bt=null,Ot=null,gt=null,dn=null,Kn=null,ur=null,go=null}}}var a=new i,l=new s,c=new o,u=t.getParameter(34921),h=new Uint8Array(u),f=new Uint8Array(u),d=new Uint8Array(u),p={},m=null,v=null,y=null,w=null,x=null,_=null,S=null,T=null,E=null,k=!1,A=null,M=null,D=null,P=null,N=null,R=t.getParameter(35661),F=!1,O=0,K=t.getParameter(7938);K.indexOf("WebGL")!==-1?(O=parseFloat(/^WebGL\ ([0-9])/.exec(K)[1]),F=O>=1):K.indexOf("OpenGL ES")!==-1&&(O=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(K)[1]),F=O>=2);var J=null,re={},ae=new lr,pe=new lr;function ke(ce,qe,bt){var Ot=new Uint8Array(4),gt=t.createTexture();t.bindTexture(ce,gt),t.texParameteri(ce,10241,9728),t.texParameteri(ce,10240,9728);for(var dn=0;dn<bt;dn++)t.texImage2D(qe+dn,0,6408,1,1,0,6408,5121,Ot);return gt}var Te={};Te[3553]=ke(3553,3553,1),Te[34067]=ke(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),Fe(2929),l.setFunc(FT),Mt(!1),q(r3),Fe(2884),pt(eu);function Ne(){for(var ce=0,qe=h.length;ce<qe;ce++)h[ce]=0}function we(ce){me(ce,0)}function me(ce,qe){if(h[ce]=1,f[ce]===0&&(t.enableVertexAttribArray(ce),f[ce]=1),d[ce]!==qe){var bt=r?t:e.get("ANGLE_instanced_arrays");bt[r?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](ce,qe),d[ce]=qe}}function He(){for(var ce=0,qe=f.length;ce!==qe;++ce)f[ce]!==h[ce]&&(t.disableVertexAttribArray(ce),f[ce]=0)}function Fe(ce){p[ce]!==!0&&(t.enable(ce),p[ce]=!0)}function je(ce){p[ce]!==!1&&(t.disable(ce),p[ce]=!1)}function Ve(ce){return m!==ce?(t.useProgram(ce),m=ce,!0):!1}var Se={[id]:32774,[vq]:32778,[yq]:32779};if(r)Se[u3]=32775,Se[h3]=32776;else{var nt=e.get("EXT_blend_minmax");nt!==null&&(Se[u3]=nt.MIN_EXT,Se[h3]=nt.MAX_EXT)}var Ct={[bq]:0,[wq]:1,[xq]:768,[f3]:770,[kq]:776,[Tq]:774,[Sq]:772,[_q]:769,[d3]:771,[Eq]:775,[Cq]:773};function pt(ce,qe,bt,Ot,gt,dn,Kn,ur){if(ce===eu){v&&(je(3042),v=!1);return}if(v||(Fe(3042),v=!0),ce!==gq){if(ce!==y||ur!==k){if((w!==id||S!==id)&&(t.blendEquation(32774),w=id,S=id),ur)switch(ce){case Pg:t.blendFuncSeparate(1,771,1,771);break;case a3:t.blendFunc(1,1);break;case l3:t.blendFuncSeparate(0,0,769,771);break;case c3:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",ce);break}else switch(ce){case Pg:t.blendFuncSeparate(770,771,1,771);break;case a3:t.blendFunc(770,1);break;case l3:t.blendFunc(0,769);break;case c3:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",ce);break}x=null,_=null,T=null,E=null,y=ce,k=ur}return}gt=gt||qe,dn=dn||bt,Kn=Kn||Ot,(qe!==w||gt!==S)&&(t.blendEquationSeparate(Se[qe],Se[gt]),w=qe,S=gt),(bt!==x||Ot!==_||dn!==T||Kn!==E)&&(t.blendFuncSeparate(Ct[bt],Ct[Ot],Ct[dn],Ct[Kn]),x=bt,_=Ot,T=dn,E=Kn),y=ce,k=null}function Ht(ce,qe){ce.side===Cw?je(2884):Fe(2884);var bt=ce.side===Pi;qe&&(bt=!bt),Mt(bt),ce.blending===Pg&&ce.transparent===!1?pt(eu):pt(ce.blending,ce.blendEquation,ce.blendSrc,ce.blendDst,ce.blendEquationAlpha,ce.blendSrcAlpha,ce.blendDstAlpha,ce.premultipliedAlpha),l.setFunc(ce.depthFunc),l.setTest(ce.depthTest),l.setMask(ce.depthWrite),a.setMask(ce.colorWrite);var Ot=ce.stencilWrite;c.setTest(Ot),Ot&&(c.setMask(ce.stencilWriteMask),c.setFunc(ce.stencilFunc,ce.stencilRef,ce.stencilFuncMask),c.setOp(ce.stencilFail,ce.stencilZFail,ce.stencilZPass)),Xe(ce.polygonOffset,ce.polygonOffsetFactor,ce.polygonOffsetUnits)}function Mt(ce){A!==ce&&(ce?t.frontFace(2304):t.frontFace(2305),A=ce)}function q(ce){ce!==fq?(Fe(2884),ce!==M&&(ce===r3?t.cullFace(1029):ce===dq?t.cullFace(1028):t.cullFace(1032))):je(2884),M=ce}function Y(ce){ce!==D&&(F&&t.lineWidth(ce),D=ce)}function Xe(ce,qe,bt){ce?(Fe(32823),(P!==qe||N!==bt)&&(t.polygonOffset(qe,bt),P=qe,N=bt)):je(32823)}function Re(ce){ce?Fe(3089):je(3089)}function Et(ce){ce===void 0&&(ce=33984+R-1),J!==ce&&(t.activeTexture(ce),J=ce)}function st(ce,qe){J===null&&Et();var bt=re[J];bt===void 0&&(bt={type:void 0,texture:void 0},re[J]=bt),(bt.type!==ce||bt.texture!==qe)&&(t.bindTexture(ce,qe||Te[ce]),bt.type=ce,bt.texture=qe)}function ee(){var ce=re[J];ce!==void 0&&ce.type!==void 0&&(t.bindTexture(ce.type,null),ce.type=void 0,ce.texture=void 0)}function We(){try{t.compressedTexImage2D.apply(t,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function ot(){try{t.texImage2D.apply(t,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function rt(){try{t.texImage3D.apply(t,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function Ke(ce){ae.equals(ce)===!1&&(t.scissor(ce.x,ce.y,ce.z,ce.w),ae.copy(ce))}function lt(ce){pe.equals(ce)===!1&&(t.viewport(ce.x,ce.y,ce.z,ce.w),pe.copy(ce))}function it(){for(var ce=0;ce<f.length;ce++)f[ce]===1&&(t.disableVertexAttribArray(ce),f[ce]=0);p={},J=null,re={},m=null,y=null,A=null,M=null,a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},initAttributes:Ne,enableAttribute:we,enableAttributeAndDivisor:me,disableUnusedAttributes:He,enable:Fe,disable:je,useProgram:Ve,setBlending:pt,setMaterial:Ht,setFlipSided:Mt,setCullFace:q,setLineWidth:Y,setPolygonOffset:Xe,setScissorTest:Re,activeTexture:Et,bindTexture:st,unbindTexture:ee,compressedTexImage2D:We,texImage2D:ot,texImage3D:rt,scissor:Ke,viewport:lt,reset:it}}function Nje(t,e,n,r,i,s,o){var a=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,u=i.maxTextureSize,h=i.maxSamples,f=new WeakMap,d,p=!1;try{p=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function m(q,Y){return p?new OffscreenCanvas(q,Y):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function v(q,Y,Xe,Re){var Et=1;if((q.width>Re||q.height>Re)&&(Et=Re/Math.max(q.width,q.height)),Et<1||Y===!0)if(typeof HTMLImageElement!="undefined"&&q instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&q instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&q instanceof ImageBitmap){var st=Y?ln.floorPowerOfTwo:Math.floor,ee=st(Et*q.width),We=st(Et*q.height);d===void 0&&(d=m(ee,We));var ot=Xe?m(ee,We):d;ot.width=ee,ot.height=We;var rt=ot.getContext("2d");return rt.drawImage(q,0,0,ee,We),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+q.width+"x"+q.height+") to ("+ee+"x"+We+")."),ot}else return"data"in q&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+q.width+"x"+q.height+")."),q;return q}function y(q){return ln.isPowerOfTwo(q.width)&&ln.isPowerOfTwo(q.height)}function w(q){return a?!1:q.wrapS!==Ws||q.wrapT!==Ws||q.minFilter!==li&&q.minFilter!==Oi}function x(q,Y){return q.generateMipmaps&&Y&&q.minFilter!==li&&q.minFilter!==Oi}function _(q,Y,Xe,Re){t.generateMipmap(q);var Et=r.get(Y);Et.__maxMipLevel=Math.log(Math.max(Xe,Re))*Math.LOG2E}function S(q,Y,Xe){if(a===!1)return Y;if(q!==null){if(t[q]!==void 0)return t[q];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+q+"'")}var Re=Y;return Y===6403&&(Xe===5126&&(Re=33326),Xe===5131&&(Re=33325),Xe===5121&&(Re=33321)),Y===6407&&(Xe===5126&&(Re=34837),Xe===5131&&(Re=34843),Xe===5121&&(Re=32849)),Y===6408&&(Xe===5126&&(Re=34836),Xe===5131&&(Re=34842),Xe===5121&&(Re=32856)),Re===33325||Re===33326||Re===34842||Re===34836?e.get("EXT_color_buffer_float"):(Re===34843||Re===34837)&&console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),Re}function T(q){return q===li||q===GT||q===HT?9728:9729}function E(q){var Y=q.target;Y.removeEventListener("dispose",E),A(Y),Y.isVideoTexture&&f.delete(Y),o.memory.textures--}function k(q){var Y=q.target;Y.removeEventListener("dispose",k),M(Y),o.memory.textures--}function A(q){var Y=r.get(q);Y.__webglInit!==void 0&&(t.deleteTexture(Y.__webglTexture),r.remove(q))}function M(q){var Y=r.get(q),Xe=r.get(q.texture);if(!!q){if(Xe.__webglTexture!==void 0&&t.deleteTexture(Xe.__webglTexture),q.depthTexture&&q.depthTexture.dispose(),q.isWebGLCubeRenderTarget)for(var Re=0;Re<6;Re++)t.deleteFramebuffer(Y.__webglFramebuffer[Re]),Y.__webglDepthbuffer&&t.deleteRenderbuffer(Y.__webglDepthbuffer[Re]);else t.deleteFramebuffer(Y.__webglFramebuffer),Y.__webglDepthbuffer&&t.deleteRenderbuffer(Y.__webglDepthbuffer);if(q.isWebGLMultiviewRenderTarget){t.deleteTexture(Y.__webglColorTexture),t.deleteTexture(Y.__webglDepthStencilTexture),o.memory.textures-=2;for(var Re=0,Et=Y.__webglViewFramebuffers.length;Re<Et;Re++)t.deleteFramebuffer(Y.__webglViewFramebuffers[Re])}r.remove(q.texture),r.remove(q)}}var D=0;function P(){D=0}function N(){var q=D;return q>=l&&console.warn("THREE.WebGLTextures: Trying to use "+q+" texture units while this GPU supports only "+l),D+=1,q}function R(q,Y){var Xe=r.get(q);if(q.isVideoTexture&&nt(q),q.version>0&&Xe.__version!==q.version){var Re=q.image;if(Re===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(Re.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Te(Xe,q,Y);return}}n.activeTexture(33984+Y),n.bindTexture(3553,Xe.__webglTexture)}function F(q,Y){var Xe=r.get(q);if(q.version>0&&Xe.__version!==q.version){Te(Xe,q,Y);return}n.activeTexture(33984+Y),n.bindTexture(35866,Xe.__webglTexture)}function O(q,Y){var Xe=r.get(q);if(q.version>0&&Xe.__version!==q.version){Te(Xe,q,Y);return}n.activeTexture(33984+Y),n.bindTexture(32879,Xe.__webglTexture)}function K(q,Y){if(q.image.length===6){var Xe=r.get(q);if(q.version>0&&Xe.__version!==q.version){ke(Xe,q),n.activeTexture(33984+Y),n.bindTexture(34067,Xe.__webglTexture),t.pixelStorei(37440,q.flipY);for(var Re=q&&(q.isCompressedTexture||q.image[0].isCompressedTexture),Et=q.image[0]&&q.image[0].isDataTexture,st=[],ee=0;ee<6;ee++)!Re&&!Et?st[ee]=v(q.image[ee],!1,!0,c):st[ee]=Et?q.image[ee].image:q.image[ee];var We=st[0],ot=y(We)||a,rt=s.convert(q.format),Ke=s.convert(q.type),lt=S(q.internalFormat,rt,Ke);pe(34067,q,ot);var it;if(Re){for(var ee=0;ee<6;ee++){it=st[ee].mipmaps;for(var ce=0;ce<it.length;ce++){var qe=it[ce];q.format!==pl&&q.format!==Sh?rt!==null?n.compressedTexImage2D(34069+ee,ce,lt,qe.width,qe.height,0,qe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+ee,ce,lt,qe.width,qe.height,0,rt,Ke,qe.data)}}Xe.__maxMipLevel=it.length-1}else{it=q.mipmaps;for(var ee=0;ee<6;ee++)if(Et){n.texImage2D(34069+ee,0,lt,st[ee].width,st[ee].height,0,rt,Ke,st[ee].data);for(var ce=0;ce<it.length;ce++){var qe=it[ce],bt=qe.image[ee].image;n.texImage2D(34069+ee,ce+1,lt,bt.width,bt.height,0,rt,Ke,bt.data)}}else{n.texImage2D(34069+ee,0,lt,rt,Ke,st[ee]);for(var ce=0;ce<it.length;ce++){var qe=it[ce];n.texImage2D(34069+ee,ce+1,lt,rt,Ke,qe.image[ee])}}Xe.__maxMipLevel=it.length}x(q,ot)&&_(34067,q,We.width,We.height),Xe.__version=q.version,q.onUpdate&&q.onUpdate(q)}else n.activeTexture(33984+Y),n.bindTexture(34067,Xe.__webglTexture)}}function J(q,Y){n.activeTexture(33984+Y),n.bindTexture(34067,r.get(q).__webglTexture)}var re={[kw]:10497,[Ws]:33071,[Aw]:33648},ae={[li]:9728,[GT]:9984,[HT]:9986,[Oi]:9729,[g3]:9985,[Mw]:9987};function pe(q,Y,Xe){Xe?(t.texParameteri(q,10242,re[Y.wrapS]),t.texParameteri(q,10243,re[Y.wrapT]),(q===32879||q===35866)&&t.texParameteri(q,32882,re[Y.wrapR]),t.texParameteri(q,10240,ae[Y.magFilter]),t.texParameteri(q,10241,ae[Y.minFilter])):(t.texParameteri(q,10242,33071),t.texParameteri(q,10243,33071),(q===32879||q===35866)&&t.texParameteri(q,32882,33071),(Y.wrapS!==Ws||Y.wrapT!==Ws)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(q,10240,T(Y.magFilter)),t.texParameteri(q,10241,T(Y.minFilter)),Y.minFilter!==li&&Y.minFilter!==Oi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var Re=e.get("EXT_texture_filter_anisotropic");if(Re){if(Y.type===Fg&&e.get("OES_texture_float_linear")===null||Y.type===jT&&(a||e.get("OES_texture_half_float_linear"))===null)return;(Y.anisotropy>1||r.get(Y).__currentAnisotropy)&&(t.texParameterf(q,Re.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Y.anisotropy,i.getMaxAnisotropy())),r.get(Y).__currentAnisotropy=Y.anisotropy)}}function ke(q,Y){q.__webglInit===void 0&&(q.__webglInit=!0,Y.addEventListener("dispose",E),q.__webglTexture=t.createTexture(),o.memory.textures++)}function Te(q,Y,Xe){var Re=3553;Y.isDataTexture2DArray&&(Re=35866),Y.isDataTexture3D&&(Re=32879),ke(q,Y),n.activeTexture(33984+Xe),n.bindTexture(Re,q.__webglTexture),t.pixelStorei(37440,Y.flipY),t.pixelStorei(37441,Y.premultiplyAlpha),t.pixelStorei(3317,Y.unpackAlignment);var Et=w(Y)&&y(Y.image)===!1,st=v(Y.image,Et,!1,u),ee=y(st)||a,We=s.convert(Y.format),ot=s.convert(Y.type),rt=S(Y.internalFormat,We,ot);pe(Re,Y,ee);var Ke,lt=Y.mipmaps;if(Y.isDepthTexture){if(rt=6402,Y.type===Fg){if(a===!1)throw new Error("Float Depth Texture only supported in WebGL2.0");rt=36012}else a&&(rt=33189);Y.format===sd&&rt===6402&&Y.type!==Nw&&Y.type!==v3&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Y.type=Nw,ot=s.convert(Y.type)),Y.format===Lg&&(rt=34041,Y.type!==$w&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Y.type=$w,ot=s.convert(Y.type))),n.texImage2D(3553,0,rt,st.width,st.height,0,We,ot,null)}else if(Y.isDataTexture)if(lt.length>0&&ee){for(var it=0,ce=lt.length;it<ce;it++)Ke=lt[it],n.texImage2D(3553,it,rt,Ke.width,Ke.height,0,We,ot,Ke.data);Y.generateMipmaps=!1,q.__maxMipLevel=lt.length-1}else n.texImage2D(3553,0,rt,st.width,st.height,0,We,ot,st.data),q.__maxMipLevel=0;else if(Y.isCompressedTexture){for(var it=0,ce=lt.length;it<ce;it++)Ke=lt[it],Y.format!==pl&&Y.format!==Sh?We!==null?n.compressedTexImage2D(3553,it,rt,Ke.width,Ke.height,0,Ke.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,it,rt,Ke.width,Ke.height,0,We,ot,Ke.data);q.__maxMipLevel=lt.length-1}else if(Y.isDataTexture2DArray)n.texImage3D(35866,0,rt,st.width,st.height,st.depth,0,We,ot,st.data),q.__maxMipLevel=0;else if(Y.isDataTexture3D)n.texImage3D(32879,0,rt,st.width,st.height,st.depth,0,We,ot,st.data),q.__maxMipLevel=0;else if(lt.length>0&&ee){for(var it=0,ce=lt.length;it<ce;it++)Ke=lt[it],n.texImage2D(3553,it,rt,We,ot,Ke);Y.generateMipmaps=!1,q.__maxMipLevel=lt.length-1}else n.texImage2D(3553,0,rt,We,ot,st),q.__maxMipLevel=0;x(Y,ee)&&_(Re,Y,st.width,st.height),q.__version=Y.version,Y.onUpdate&&Y.onUpdate(Y)}function Ne(q,Y,Xe,Re){var Et=s.convert(Y.texture.format),st=s.convert(Y.texture.type),ee=S(Y.texture.internalFormat,Et,st);n.texImage2D(Re,0,ee,Y.width,Y.height,0,Et,st,null),t.bindFramebuffer(36160,q),t.framebufferTexture2D(36160,Xe,Re,r.get(Y.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function we(q,Y,Xe){if(t.bindRenderbuffer(36161,q),Y.depthBuffer&&!Y.stencilBuffer){if(Xe){var Re=Se(Y);t.renderbufferStorageMultisample(36161,Re,33189,Y.width,Y.height)}else t.renderbufferStorage(36161,33189,Y.width,Y.height);t.framebufferRenderbuffer(36160,36096,36161,q)}else if(Y.depthBuffer&&Y.stencilBuffer){if(Xe){var Re=Se(Y);t.renderbufferStorageMultisample(36161,Re,35056,Y.width,Y.height)}else t.renderbufferStorage(36161,34041,Y.width,Y.height);t.framebufferRenderbuffer(36160,33306,36161,q)}else{var Et=s.convert(Y.texture.format),st=s.convert(Y.texture.type),ee=S(Y.texture.internalFormat,Et,st);if(Xe){var Re=Se(Y);t.renderbufferStorageMultisample(36161,Re,ee,Y.width,Y.height)}else t.renderbufferStorage(36161,ee,Y.width,Y.height)}t.bindRenderbuffer(36161,null)}function me(q,Y){var Xe=Y&&Y.isWebGLCubeRenderTarget;if(Xe)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,q),!(Y.depthTexture&&Y.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(Y.depthTexture).__webglTexture||Y.depthTexture.image.width!==Y.width||Y.depthTexture.image.height!==Y.height)&&(Y.depthTexture.image.width=Y.width,Y.depthTexture.image.height=Y.height,Y.depthTexture.needsUpdate=!0),R(Y.depthTexture,0);var Re=r.get(Y.depthTexture).__webglTexture;if(Y.depthTexture.format===sd)t.framebufferTexture2D(36160,36096,3553,Re,0);else if(Y.depthTexture.format===Lg)t.framebufferTexture2D(36160,33306,3553,Re,0);else throw new Error("Unknown depthTexture format")}function He(q){var Y=r.get(q),Xe=q.isWebGLCubeRenderTarget===!0;if(q.depthTexture){if(Xe)throw new Error("target.depthTexture not supported in Cube render targets");me(Y.__webglFramebuffer,q)}else if(Xe){Y.__webglDepthbuffer=[];for(var Re=0;Re<6;Re++)t.bindFramebuffer(36160,Y.__webglFramebuffer[Re]),Y.__webglDepthbuffer[Re]=t.createRenderbuffer(),we(Y.__webglDepthbuffer[Re],q)}else t.bindFramebuffer(36160,Y.__webglFramebuffer),Y.__webglDepthbuffer=t.createRenderbuffer(),we(Y.__webglDepthbuffer,q);t.bindFramebuffer(36160,null)}function Fe(q){var Y=r.get(q),Xe=r.get(q.texture);q.addEventListener("dispose",k),Xe.__webglTexture=t.createTexture(),o.memory.textures++;var Re=q.isWebGLCubeRenderTarget===!0,Et=q.isWebGLMultisampleRenderTarget===!0,st=q.isWebGLMultiviewRenderTarget===!0,ee=y(q)||a;if(Re){Y.__webglFramebuffer=[];for(var We=0;We<6;We++)Y.__webglFramebuffer[We]=t.createFramebuffer()}else if(Y.__webglFramebuffer=t.createFramebuffer(),Et)if(a){Y.__webglMultisampledFramebuffer=t.createFramebuffer(),Y.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,Y.__webglColorRenderbuffer);var ot=s.convert(q.texture.format),rt=s.convert(q.texture.type),Ke=S(q.texture.internalFormat,ot,rt),lt=Se(q);t.renderbufferStorageMultisample(36161,lt,Ke,q.width,q.height),t.bindFramebuffer(36160,Y.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,Y.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),q.depthBuffer&&(Y.__webglDepthRenderbuffer=t.createRenderbuffer(),we(Y.__webglDepthRenderbuffer,q,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");else if(st){var it=q.width,ce=q.height,qe=q.numViews;t.bindFramebuffer(36160,Y.__webglFramebuffer);var bt=e.get("OVR_multiview2");o.memory.textures+=2;var Ot=t.createTexture();t.bindTexture(35866,Ot),t.texParameteri(35866,10240,9728),t.texParameteri(35866,10241,9728),t.texImage3D(35866,0,32856,it,ce,qe,0,6408,5121,null),bt.framebufferTextureMultiviewOVR(36160,36064,Ot,0,0,qe);var gt=t.createTexture();t.bindTexture(35866,gt),t.texParameteri(35866,10240,9728),t.texParameteri(35866,10241,9728),t.texImage3D(35866,0,35056,it,ce,qe,0,34041,34042,null),bt.framebufferTextureMultiviewOVR(36160,33306,gt,0,0,qe);for(var dn=new Array(qe),We=0;We<qe;++We)dn[We]=t.createFramebuffer(),t.bindFramebuffer(36160,dn[We]),t.framebufferTextureLayer(36160,36064,Ot,0,We);Y.__webglColorTexture=Ot,Y.__webglDepthStencilTexture=gt,Y.__webglViewFramebuffers=dn,t.bindFramebuffer(36160,null),t.bindTexture(35866,null)}if(Re){n.bindTexture(34067,Xe.__webglTexture),pe(34067,q.texture,ee);for(var We=0;We<6;We++)Ne(Y.__webglFramebuffer[We],q,36064,34069+We);x(q.texture,ee)&&_(34067,q.texture,q.width,q.height),n.bindTexture(34067,null)}else st||(n.bindTexture(3553,Xe.__webglTexture),pe(3553,q.texture,ee),Ne(Y.__webglFramebuffer,q,36064,3553),x(q.texture,ee)&&_(3553,q.texture,q.width,q.height),n.bindTexture(3553,null));q.depthBuffer&&He(q)}function je(q){var Y=q.texture,Xe=y(q)||a;if(x(Y,Xe)){var Re=q.isWebGLCubeRenderTarget?34067:3553,Et=r.get(Y).__webglTexture;n.bindTexture(Re,Et),_(Re,Y,q.width,q.height),n.bindTexture(Re,null)}}function Ve(q){if(q.isWebGLMultisampleRenderTarget)if(a){var Y=r.get(q);t.bindFramebuffer(36008,Y.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,Y.__webglFramebuffer);var Xe=q.width,Re=q.height,Et=16384;q.depthBuffer&&(Et|=256),q.stencilBuffer&&(Et|=1024),t.blitFramebuffer(0,0,Xe,Re,0,0,Xe,Re,Et,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function Se(q){return a&&q.isWebGLMultisampleRenderTarget?Math.min(h,q.samples):0}function nt(q){var Y=o.render.frame;f.get(q)!==Y&&(f.set(q,Y),q.update())}var Ct=!1,pt=!1;function Ht(q,Y){q&&q.isWebGLRenderTarget&&(Ct===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),Ct=!0),q=q.texture),R(q,Y)}function Mt(q,Y){q&&q.isWebGLCubeRenderTarget&&(pt===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),pt=!0),q=q.texture),q&&q.isCubeTexture||Array.isArray(q.image)&&q.image.length===6?K(q,Y):J(q,Y)}this.allocateTextureUnit=N,this.resetTextureUnits=P,this.setTexture2D=R,this.setTexture2DArray=F,this.setTexture3D=O,this.setTextureCube=K,this.setTextureCubeDynamic=J,this.setupRenderTarget=Fe,this.updateRenderTargetMipmap=je,this.updateMultisampleRenderTarget=Ve,this.safeSetTexture2D=Ht,this.safeSetTextureCube=Mt}function cX(t,e,n){var r=n.isWebGL2;function i(s){var o;if(s===Iw)return 5121;if(s===Gq)return 32819;if(s===Hq)return 32820;if(s===jq)return 33635;if(s===Vq)return 5120;if(s===Uq)return 5122;if(s===Nw)return 5123;if(s===Wq)return 5124;if(s===v3)return 5125;if(s===Fg)return 5126;if(s===jT)return r?5131:(o=e.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(s===qq)return 6406;if(s===Sh)return 6407;if(s===pl)return 6408;if(s===Xq)return 6409;if(s===Kq)return 6410;if(s===sd)return 6402;if(s===Lg)return 34041;if(s===Zq)return 6403;if(s===Jq)return 36244;if(s===Qq)return 33319;if(s===e7)return 33320;if(s===t7)return 36248;if(s===n7)return 36249;if(s===y3||s===b3||s===w3||s===x3)if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===y3)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===b3)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===w3)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===x3)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===_3||s===S3||s===C3||s===T3)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===_3)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===S3)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===C3)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===T3)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===r7)return o=e.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===i7||s===s7||s===o7||s===a7||s===l7||s===c7||s===u7||s===h7||s===f7||s===d7||s===p7||s===m7||s===g7||s===v7)return o=e.get("WEBGL_compressed_texture_astc"),o!==null?s:null;if(s===$w)return r?34042:(o=e.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:i}}function eP(t,e,n,r){Ts.call(this,t,e,r),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=n}eP.prototype=Object.assign(Object.create(Ts.prototype),{constructor:eP,isWebGLMultiviewRenderTarget:!0,copy:function(t){return Ts.prototype.copy.call(this,t),this.numViews=t.numViews,this},setNumViews:function(t){return this.numViews!==t&&(this.numViews=t,this.dispose()),this}});function $je(t,e){var n=2,r=t.extensions,i=t.properties,s,o,a,l,c,u,h,f=0;function d(){if(h===void 0){var E=r.get("OVR_multiview2");if(h=E!==null&&e.getContextAttributes().antialias===!1,h){f=e.getParameter(E.MAX_VIEWS_OVR),s=new eP(0,0,n),u=new $e,l=[],a=[],c=[];for(var k=0;k<f;k++)l[k]=new vn,a[k]=new rs}}return h}function p(E){return E.isArrayCamera?E.cameras:(c[0]=E,c)}function m(E,k){for(var A=p(E),M=0;M<A.length;M++)l[M].copy(A[M].projectionMatrix);k.setValue(e,"projectionMatrices",l)}function v(E,k){for(var A=p(E),M=0;M<A.length;M++)l[M].copy(A[M].matrixWorldInverse);k.setValue(e,"viewMatrices",l)}function y(E,k,A){for(var M=p(k),D=0;D<M.length;D++)l[D].multiplyMatrices(M[D].matrixWorldInverse,E.matrixWorld),a[D].getNormalMatrix(l[D]);A.setValue(e,"modelViewMatrices",l),A.setValue(e,"normalMatrices",a)}function w(E){if(E.isArrayCamera===void 0)return!0;var k=E.cameras;if(k.length>f)return!1;for(var A=1,M=k.length;A<M;A++)if(k[0].viewport.z!==k[A].viewport.z||k[0].viewport.w!==k[A].viewport.w)return!1;return!0}function x(E){if(o?u.set(o.width,o.height):t.getDrawingBufferSize(u),E.isArrayCamera){var k=E.cameras[0].viewport;s.setSize(k.z,k.w),s.setNumViews(E.cameras.length)}else s.setSize(u.x,u.y),s.setNumViews(n)}function _(E){w(E)!==!1&&(o=t.getRenderTarget(),x(E),t.setRenderTarget(s))}function S(E){s===t.getRenderTarget()&&(t.setRenderTarget(o),T(E))}function T(E){var k=s,A=k.numViews,M=i.get(k).__webglViewFramebuffers,D=k.width,P=k.height;if(E.isArrayCamera)for(var N=0;N<A;N++){var R=E.cameras[N].viewport,F=R.x,O=R.y,K=F+R.z,J=O+R.w;e.bindFramebuffer(36008,M[N]),e.blitFramebuffer(0,0,D,P,F,O,K,J,16384,9728)}else e.bindFramebuffer(36008,M[0]),e.blitFramebuffer(0,0,D,P,0,0,u.x,u.y,16384,9728)}this.isAvailable=d,this.attachCamera=_,this.detachCamera=S,this.updateCameraProjectionMatricesUniform=m,this.updateCameraViewMatricesUniform=v,this.updateObjectMatricesUniforms=y}function fE(t){Si.call(this),this.cameras=t||[]}fE.prototype=Object.assign(Object.create(Si.prototype),{constructor:fE,isArrayCamera:!0});function av(){ft.call(this),this.type="Group"}av.prototype=Object.assign(Object.create(ft.prototype),{constructor:av,isGroup:!0});function uX(t,e){var n=this,r=null,i=null,s="local-floor",o=null,a=[],l=new Map,c=new Si;c.layers.enable(1),c.viewport=new lr;var u=new Si;u.layers.enable(2),u.viewport=new lr;var h=new fE([c,u]);h.layers.enable(1),h.layers.enable(2);var f=null,d=null;this.enabled=!1,this.isPresenting=!1,this.getController=function(A){var M=a[A];return M===void 0&&(M={},a[A]=M),M.targetRay===void 0&&(M.targetRay=new av,M.targetRay.matrixAutoUpdate=!1,M.targetRay.visible=!1),M.targetRay},this.getControllerGrip=function(A){var M=a[A];return M===void 0&&(M={},a[A]=M),M.grip===void 0&&(M.grip=new av,M.grip.matrixAutoUpdate=!1,M.grip.visible=!1),M.grip};function p(A){var M=l.get(A.inputSource);M&&(M.targetRay&&M.targetRay.dispatchEvent({type:A.type}),M.grip&&M.grip.dispatchEvent({type:A.type}))}function m(){l.forEach(function(A,M){A.targetRay&&(A.targetRay.dispatchEvent({type:"disconnected",data:M}),A.targetRay.visible=!1),A.grip&&(A.grip.dispatchEvent({type:"disconnected",data:M}),A.grip.visible=!1)}),l.clear(),t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),k.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function v(A){i=A,k.setContext(r),k.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}this.setFramebufferScaleFactor=function(){},this.setReferenceSpaceType=function(A){s=A},this.getReferenceSpace=function(){return i},this.getSession=function(){return r},this.setSession=function(A){if(r=A,r!==null){r.addEventListener("select",p),r.addEventListener("selectstart",p),r.addEventListener("selectend",p),r.addEventListener("squeeze",p),r.addEventListener("squeezestart",p),r.addEventListener("squeezeend",p),r.addEventListener("end",m);var M=e.getContextAttributes(),D={antialias:M.antialias,alpha:M.alpha,depth:M.depth,stencil:M.stencil},P=new XRWebGLLayer(r,e,D);r.updateRenderState({baseLayer:P}),r.requestReferenceSpace(s).then(v),r.addEventListener("inputsourceschange",y)}};function y(A){for(var M=r.inputSources,D=0;D<a.length;D++)l.set(M[D],a[D]);for(var D=0;D<A.removed.length;D++){var P=A.removed[D],N=l.get(P);N&&(N.targetRay&&N.targetRay.dispatchEvent({type:"disconnected",data:P}),N.grip&&N.grip.dispatchEvent({type:"disconnected",data:P}),l.delete(P))}for(var D=0;D<A.added.length;D++){var P=A.added[D],N=l.get(P);N&&(N.targetRay&&N.targetRay.dispatchEvent({type:"connected",data:P}),N.grip&&N.grip.dispatchEvent({type:"connected",data:P}))}}var w=new j,x=new j;function _(A,M,D){w.setFromMatrixPosition(M.matrixWorld),x.setFromMatrixPosition(D.matrixWorld);var P=w.distanceTo(x),N=M.projectionMatrix.elements,R=D.projectionMatrix.elements,F=N[14]/(N[10]-1),O=N[14]/(N[10]+1),K=(N[9]+1)/N[5],J=(N[9]-1)/N[5],re=(N[8]-1)/N[0],ae=(R[8]+1)/R[0],pe=F*re,ke=F*ae,Te=P/(-re+ae),Ne=Te*-re;M.matrixWorld.decompose(A.position,A.quaternion,A.scale),A.translateX(Ne),A.translateZ(Te),A.matrixWorld.compose(A.position,A.quaternion,A.scale),A.matrixWorldInverse.getInverse(A.matrixWorld);var we=F+Te,me=O+Te,He=pe-Ne,Fe=ke+(P-Ne),je=K*O/me*we,Ve=J*O/me*we;A.projectionMatrix.makePerspective(He,Fe,je,Ve,we,me)}function S(A,M){M===null?A.matrixWorld.copy(A.matrix):A.matrixWorld.multiplyMatrices(M.matrixWorld,A.matrix),A.matrixWorldInverse.getInverse(A.matrixWorld)}this.getCamera=function(A){h.near=u.near=c.near=A.near,h.far=u.far=c.far=A.far,(f!==h.near||d!==h.far)&&(r.updateRenderState({depthNear:h.near,depthFar:h.far}),f=h.near,d=h.far);var M=A.parent,D=h.cameras;S(h,M);for(var P=0;P<D.length;P++)S(D[P],M);A.matrixWorld.copy(h.matrixWorld);for(var N=A.children,P=0,R=N.length;P<R;P++)N[P].updateMatrixWorld(!0);return _(h,c,u),h};var T=null;function E(A,M){if(o=M.getViewerPose(i),o!==null){var D=o.views,P=r.renderState.baseLayer;t.setFramebuffer(P.framebuffer);for(var N=0;N<D.length;N++){var R=D[N],F=P.getViewport(R),O=h.cameras[N];O.matrix.fromArray(R.transform.matrix),O.projectionMatrix.fromArray(R.projectionMatrix),O.viewport.set(F.x,F.y,F.width,F.height),N===0&&h.matrix.copy(O.matrix)}}for(var K=r.inputSources,N=0;N<a.length;N++){var J=a[N],re=K[N],ae=null,pe=null;re&&(J.targetRay&&(ae=M.getPose(re.targetRaySpace,i),ae!==null&&(J.targetRay.matrix.fromArray(ae.transform.matrix),J.targetRay.matrix.decompose(J.targetRay.position,J.targetRay.rotation,J.targetRay.scale))),J.grip&&re.gripSpace&&(pe=M.getPose(re.gripSpace,i),pe!==null&&(J.grip.matrix.fromArray(pe.transform.matrix),J.grip.matrix.decompose(J.grip.position,J.grip.rotation,J.grip.scale)))),J.targetRay&&(J.targetRay.visible=ae!==null),J.grip&&(J.grip.visible=pe!==null)}T&&T(A,M)}var k=new V7;k.setAnimationLoop(E),this.setAnimationLoop=function(A){T=A},this.dispose=function(){}}Object.assign(uX.prototype,Aa.prototype);function tP(t){t=t||{};var e=t.canvas!==void 0?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=t.context!==void 0?t.context:null,r=t.alpha!==void 0?t.alpha:!1,i=t.depth!==void 0?t.depth:!0,s=t.stencil!==void 0?t.stencil:!0,o=t.antialias!==void 0?t.antialias:!1,a=t.premultipliedAlpha!==void 0?t.premultipliedAlpha:!0,l=t.preserveDrawingBuffer!==void 0?t.preserveDrawingBuffer:!1,c=t.powerPreference!==void 0?t.powerPreference:"default",u=t.failIfMajorPerformanceCaveat!==void 0?t.failIfMajorPerformanceCaveat:!1,h=null,f=null;this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=fo,this.physicallyCorrectLights=!1,this.toneMapping=LT,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var d=this,p=!1,m=null,v=0,y=0,w=null,x=null,_=-1,S={geometry:null,program:null,wireframe:!1},T=null,E=null,k=new lr,A=new lr,M=null,D=e.width,P=e.height,N=1,R=null,F=null,O=new lr(0,0,D,P),K=new lr(0,0,D,P),J=!1,re=new rv,ae=new d8e,pe=!1,ke=!1,Te=new vn,Ne=new j;function we(){return w===null?N:1}var me;try{var He={alpha:r,depth:i,stencil:s,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u,xrCompatible:!0};if(e.addEventListener("webglcontextlost",it,!1),e.addEventListener("webglcontextrestored",ce,!1),me=n||e.getContext("webgl",He)||e.getContext("experimental-webgl",He),me===null)throw e.getContext("webgl")!==null?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");me.getShaderPrecisionFormat===void 0&&(me.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(B){throw console.error("THREE.WebGLRenderer: "+B.message),B}var Fe,je,Ve,Se,nt,Ct,pt,Ht,Mt,q,Y,Xe,Re,Et,st,ee,We;function ot(){Fe=new p8e(me),je=new f8e(me,Fe,t),je.isWebGL2===!1&&(Fe.get("WEBGL_depth_texture"),Fe.get("OES_texture_float"),Fe.get("OES_texture_half_float"),Fe.get("OES_texture_half_float_linear"),Fe.get("OES_standard_derivatives"),Fe.get("OES_element_index_uint"),Fe.get("ANGLE_instanced_arrays")),Fe.get("OES_texture_float_linear"),We=new cX(me,Fe,je),Ve=new Ije(me,Fe,je),Ve.scissor(A.copy(K).multiplyScalar(N).floor()),Ve.viewport(k.copy(O).multiplyScalar(N).floor()),Se=new v8e(me),nt=new bje,Ct=new Nje(me,Fe,Ve,nt,je,We,Se),pt=new GHe(me,je),Ht=new m8e(me,pt,Se),Mt=new w8e(me,Ht,pt,Se),Et=new b8e(me),q=new yje(d,Fe,je),Y=new _je,Xe=new kje,Re=new u8e(d,Ve,Mt,a),st=new h8e(me,Fe,Se,je),ee=new g8e(me,Fe,Se,je),Se.programs=q.programs,d.capabilities=je,d.extensions=Fe,d.properties=nt,d.renderLists=Y,d.state=Ve,d.info=Se}ot();var rt=new uX(d,me);this.xr=rt;var Ke=new $je(d,me),lt=new lX(d,Mt,je.maxTextureSize);this.shadowMap=lt,this.getContext=function(){return me},this.getContextAttributes=function(){return me.getContextAttributes()},this.forceContextLoss=function(){var B=Fe.get("WEBGL_lose_context");B&&B.loseContext()},this.forceContextRestore=function(){var B=Fe.get("WEBGL_lose_context");B&&B.restoreContext()},this.getPixelRatio=function(){return N},this.setPixelRatio=function(B){B!==void 0&&(N=B,this.setSize(D,P,!1))},this.getSize=function(B){return B===void 0&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),B=new $e),B.set(D,P)},this.setSize=function(B,W,he){if(rt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}D=B,P=W,e.width=Math.floor(B*N),e.height=Math.floor(W*N),he!==!1&&(e.style.width=B+"px",e.style.height=W+"px"),this.setViewport(0,0,B,W)},this.getDrawingBufferSize=function(B){return B===void 0&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),B=new $e),B.set(D*N,P*N).floor()},this.setDrawingBufferSize=function(B,W,he){D=B,P=W,N=he,e.width=Math.floor(B*he),e.height=Math.floor(W*he),this.setViewport(0,0,B,W)},this.getCurrentViewport=function(B){return B===void 0&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),B=new lr),B.copy(k)},this.getViewport=function(B){return B.copy(O)},this.setViewport=function(B,W,he,Me){B.isVector4?O.set(B.x,B.y,B.z,B.w):O.set(B,W,he,Me),Ve.viewport(k.copy(O).multiplyScalar(N).floor())},this.getScissor=function(B){return B.copy(K)},this.setScissor=function(B,W,he,Me){B.isVector4?K.set(B.x,B.y,B.z,B.w):K.set(B,W,he,Me),Ve.scissor(A.copy(K).multiplyScalar(N).floor())},this.getScissorTest=function(){return J},this.setScissorTest=function(B){Ve.setScissorTest(J=B)},this.setOpaqueSort=function(B){R=B},this.setTransparentSort=function(B){F=B},this.getClearColor=function(){return Re.getClearColor()},this.setClearColor=function(){Re.setClearColor.apply(Re,arguments)},this.getClearAlpha=function(){return Re.getClearAlpha()},this.setClearAlpha=function(){Re.setClearAlpha.apply(Re,arguments)},this.clear=function(B,W,he){var Me=0;(B===void 0||B)&&(Me|=16384),(W===void 0||W)&&(Me|=256),(he===void 0||he)&&(Me|=1024),me.clear(Me)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",it,!1),e.removeEventListener("webglcontextrestored",ce,!1),Y.dispose(),Xe.dispose(),nt.dispose(),Mt.dispose(),rt.dispose(),Yn.stop()};function it(B){B.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),p=!0}function ce(){console.log("THREE.WebGLRenderer: Context Restored."),p=!1,ot()}function qe(B){var W=B.target;W.removeEventListener("dispose",qe),bt(W)}function bt(B){Ot(B),nt.remove(B)}function Ot(B){var W=nt.get(B).program;B.program=void 0,W!==void 0&&q.releaseProgram(W)}function gt(B,W){B.render(function(he){d.renderBufferImmediate(he,W)})}this.renderBufferImmediate=function(B,W){Ve.initAttributes();var he=nt.get(B);B.hasPositions&&!he.position&&(he.position=me.createBuffer()),B.hasNormals&&!he.normal&&(he.normal=me.createBuffer()),B.hasUvs&&!he.uv&&(he.uv=me.createBuffer()),B.hasColors&&!he.color&&(he.color=me.createBuffer());var Me=W.getAttributes();B.hasPositions&&(me.bindBuffer(34962,he.position),me.bufferData(34962,B.positionArray,35048),Ve.enableAttribute(Me.position),me.vertexAttribPointer(Me.position,3,5126,!1,0,0)),B.hasNormals&&(me.bindBuffer(34962,he.normal),me.bufferData(34962,B.normalArray,35048),Ve.enableAttribute(Me.normal),me.vertexAttribPointer(Me.normal,3,5126,!1,0,0)),B.hasUvs&&(me.bindBuffer(34962,he.uv),me.bufferData(34962,B.uvArray,35048),Ve.enableAttribute(Me.uv),me.vertexAttribPointer(Me.uv,2,5126,!1,0,0)),B.hasColors&&(me.bindBuffer(34962,he.color),me.bufferData(34962,B.colorArray,35048),Ve.enableAttribute(Me.color),me.vertexAttribPointer(Me.color,3,5126,!1,0,0)),Ve.disableUnusedAttributes(),me.drawArrays(4,0,B.count),B.count=0};var dn=new nu;this.renderBufferDirect=function(B,W,he,Me,Ye,Ft){W===null&&(W=dn);var kt=Ye.isMesh&&Ye.matrixWorld.determinant()<0,cn=tp(B,W,Me,Ye);Ve.setMaterial(Me,kt);var Jt=!1;(S.geometry!==he.id||S.program!==cn.id||S.wireframe!==(Me.wireframe===!0))&&(S.geometry=he.id,S.program=cn.id,S.wireframe=Me.wireframe===!0,Jt=!0),(Me.morphTargets||Me.morphNormals)&&(Et.update(Ye,he,Me,cn),Jt=!0);var Zt=he.index,Zn=he.attributes.position;if(Zt===null){if(Zn===void 0||Zn.count===0)return}else if(Zt.count===0)return;var Gn=1;Me.wireframe===!0&&(Zt=Ht.getWireframeAttribute(he),Gn=2);var kn,It=st;Zt!==null&&(kn=pt.get(Zt),It=ee,It.setIndex(kn)),Jt&&(Kn(Ye,he,Me,cn),Zt!==null&&me.bindBuffer(34963,kn.buffer));var Lt=Zt!==null?Zt.count:Zn.count,yo=he.drawRange.start*Gn,Qr=he.drawRange.count*Gn,Eu=Ft!==null?Ft.start*Gn:0,Ps=Ft!==null?Ft.count*Gn:1/0,Yi=Math.max(yo,Eu),rp=Math.min(Lt,yo+Qr,Eu+Ps)-1,qh=Math.max(0,rp-Yi+1);if(qh!==0){if(Ye.isMesh)Me.wireframe===!0?(Ve.setLineWidth(Me.wireframeLinewidth*we()),It.setMode(1)):It.setMode(4);else if(Ye.isLine){var ip=Me.linewidth;ip===void 0&&(ip=1),Ve.setLineWidth(ip*we()),Ye.isLineSegments?It.setMode(1):Ye.isLineLoop?It.setMode(2):It.setMode(3)}else Ye.isPoints?It.setMode(0):Ye.isSprite&&It.setMode(4);Ye.isInstancedMesh?It.renderInstances(he,Yi,qh,Ye.count):he.isInstancedBufferGeometry?It.renderInstances(he,Yi,qh,he.maxInstancedCount):It.render(Yi,qh)}};function Kn(B,W,he,Me){if(!(je.isWebGL2===!1&&(B.isInstancedMesh||W.isInstancedBufferGeometry)&&Fe.get("ANGLE_instanced_arrays")===null)){Ve.initAttributes();var Ye=W.attributes,Ft=Me.getAttributes(),kt=he.defaultAttributeValues;for(var cn in Ft){var Jt=Ft[cn];if(Jt>=0){var Zt=Ye[cn];if(Zt!==void 0){var Zn=Zt.normalized,Gn=Zt.itemSize,kn=pt.get(Zt);if(kn===void 0)continue;var It=kn.buffer,Lt=kn.type,yo=kn.bytesPerElement;if(Zt.isInterleavedBufferAttribute){var Qr=Zt.data,Eu=Qr.stride,Ps=Zt.offset;Qr&&Qr.isInstancedInterleavedBuffer?(Ve.enableAttributeAndDivisor(Jt,Qr.meshPerAttribute),W.maxInstancedCount===void 0&&(W.maxInstancedCount=Qr.meshPerAttribute*Qr.count)):Ve.enableAttribute(Jt),me.bindBuffer(34962,It),me.vertexAttribPointer(Jt,Gn,Lt,Zn,Eu*yo,Ps*yo)}else Zt.isInstancedBufferAttribute?(Ve.enableAttributeAndDivisor(Jt,Zt.meshPerAttribute),W.maxInstancedCount===void 0&&(W.maxInstancedCount=Zt.meshPerAttribute*Zt.count)):Ve.enableAttribute(Jt),me.bindBuffer(34962,It),me.vertexAttribPointer(Jt,Gn,Lt,Zn,0,0)}else if(cn==="instanceMatrix"){var kn=pt.get(B.instanceMatrix);if(kn===void 0)continue;var It=kn.buffer,Lt=kn.type;Ve.enableAttributeAndDivisor(Jt+0,1),Ve.enableAttributeAndDivisor(Jt+1,1),Ve.enableAttributeAndDivisor(Jt+2,1),Ve.enableAttributeAndDivisor(Jt+3,1),me.bindBuffer(34962,It),me.vertexAttribPointer(Jt+0,4,Lt,!1,64,0),me.vertexAttribPointer(Jt+1,4,Lt,!1,64,16),me.vertexAttribPointer(Jt+2,4,Lt,!1,64,32),me.vertexAttribPointer(Jt+3,4,Lt,!1,64,48)}else if(kt!==void 0){var Yi=kt[cn];if(Yi!==void 0)switch(Yi.length){case 2:me.vertexAttrib2fv(Jt,Yi);break;case 3:me.vertexAttrib3fv(Jt,Yi);break;case 4:me.vertexAttrib4fv(Jt,Yi);break;default:me.vertexAttrib1fv(Jt,Yi)}}}}Ve.disableUnusedAttributes()}}this.compile=function(B,W){f=Xe.get(B,W),f.init(),B.traverse(function(Me){Me.isLight&&(f.pushLight(Me),Me.castShadow&&f.pushShadow(Me))}),f.setupLights(W);var he={};B.traverse(function(Me){if(Me.material)if(Array.isArray(Me.material))for(var Ye=0;Ye<Me.material.length;Ye++)Me.material[Ye].uuid in he||(vo(Me.material[Ye],B,Me),he[Me.material[Ye].uuid]=!0);else Me.material.uuid in he||(vo(Me.material,B,Me),he[Me.material.uuid]=!0)})};var ur=null;function go(B){rt.isPresenting||ur&&ur(B)}var Yn=new V7;Yn.setAnimationLoop(go),typeof window!="undefined"&&Yn.setContext(window),this.setAnimationLoop=function(B){ur=B,rt.setAnimationLoop(B),Yn.start()},this.render=function(B,W){var he,Me;if(arguments[2]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),he=arguments[2]),arguments[3]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),Me=arguments[3]),!(W&&W.isCamera)){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(!p){S.geometry=null,S.program=null,S.wireframe=!1,_=-1,T=null,B.autoUpdate===!0&&B.updateMatrixWorld(),W.parent===null&&W.updateMatrixWorld(),rt.enabled&&rt.isPresenting&&(W=rt.getCamera(W)),f=Xe.get(B,W),f.init(),B.onBeforeRender(d,B,W,he||w),Te.multiplyMatrices(W.projectionMatrix,W.matrixWorldInverse),re.setFromProjectionMatrix(Te),ke=this.localClippingEnabled,pe=ae.init(this.clippingPlanes,ke,W),h=Y.get(B,W),h.init(),Ds(B,W,0,d.sortObjects),d.sortObjects===!0&&h.sort(R,F),pe&&ae.beginShadows();var Ye=f.state.shadowsArray;lt.render(Ye,B,W),f.setupLights(W),pe&&ae.endShadows(),this.info.autoReset&&this.info.reset(),he!==void 0&&this.setRenderTarget(he),rt.enabled&&Ke.isAvailable()&&Ke.attachCamera(W),Re.render(h,B,W,Me);var Ft=h.opaque,kt=h.transparent;if(B.overrideMaterial){var cn=B.overrideMaterial;Ft.length&&Li(Ft,B,W,cn),kt.length&&Li(kt,B,W,cn)}else Ft.length&&Li(Ft,B,W),kt.length&&Li(kt,B,W);B.onAfterRender(d,B,W),w!==null&&(Ct.updateRenderTargetMipmap(w),Ct.updateMultisampleRenderTarget(w)),Ve.buffers.depth.setTest(!0),Ve.buffers.depth.setMask(!0),Ve.buffers.color.setMask(!0),Ve.setPolygonOffset(!1),rt.enabled&&Ke.isAvailable()&&Ke.detachCamera(W),h=null,f=null}};function Ds(B,W,he,Me){if(B.visible!==!1){var Ye=B.layers.test(W.layers);if(Ye){if(B.isGroup)he=B.renderOrder;else if(B.isLOD)B.autoUpdate===!0&&B.update(W);else if(B.isLight)f.pushLight(B),B.castShadow&&f.pushShadow(B);else if(B.isSprite){if(!B.frustumCulled||re.intersectsSprite(B)){Me&&Ne.setFromMatrixPosition(B.matrixWorld).applyMatrix4(Te);var Ft=Mt.update(B),kt=B.material;kt.visible&&h.push(B,Ft,kt,he,Ne.z,null)}}else if(B.isImmediateRenderObject)Me&&Ne.setFromMatrixPosition(B.matrixWorld).applyMatrix4(Te),h.push(B,null,B.material,he,Ne.z,null);else if((B.isMesh||B.isLine||B.isPoints)&&(B.isSkinnedMesh&&B.skeleton.frame!==Se.render.frame&&(B.skeleton.update(),B.skeleton.frame=Se.render.frame),!B.frustumCulled||re.intersectsObject(B))){Me&&Ne.setFromMatrixPosition(B.matrixWorld).applyMatrix4(Te);var Ft=Mt.update(B),kt=B.material;if(Array.isArray(kt))for(var cn=Ft.groups,Jt=0,Zt=cn.length;Jt<Zt;Jt++){var Zn=cn[Jt],Gn=kt[Zn.materialIndex];Gn&&Gn.visible&&h.push(B,Ft,Gn,he,Ne.z,Zn)}else kt.visible&&h.push(B,Ft,kt,he,Ne.z,null)}}for(var kn=B.children,Jt=0,Zt=kn.length;Jt<Zt;Jt++)Ds(kn[Jt],W,he,Me)}}function Li(B,W,he,Me){for(var Ye=0,Ft=B.length;Ye<Ft;Ye++){var kt=B[Ye],cn=kt.object,Jt=kt.geometry,Zt=Me===void 0?kt.material:Me,Zn=kt.group;if(he.isArrayCamera)if(E=he,rt.enabled&&Ke.isAvailable())wc(cn,W,he,Jt,Zt,Zn);else for(var Gn=he.cameras,kn=0,It=Gn.length;kn<It;kn++){var Lt=Gn[kn];cn.layers.test(Lt.layers)&&(Ve.viewport(k.copy(Lt.viewport)),f.setupLights(Lt),wc(cn,W,Lt,Jt,Zt,Zn))}else E=null,wc(cn,W,he,Jt,Zt,Zn)}}function wc(B,W,he,Me,Ye,Ft){if(B.onBeforeRender(d,W,he,Me,Ye,Ft),f=Xe.get(W,E||he),B.modelViewMatrix.multiplyMatrices(he.matrixWorldInverse,B.matrixWorld),B.normalMatrix.getNormalMatrix(B.modelViewMatrix),B.isImmediateRenderObject){var kt=tp(he,W,Ye,B);Ve.setMaterial(Ye),S.geometry=null,S.program=null,S.wireframe=!1,gt(B,kt)}else d.renderBufferDirect(he,W,Me,Ye,B,Ft);B.onAfterRender(d,W,he,Me,Ye,Ft),f=Xe.get(W,E||he)}function vo(B,W,he){var Me=nt.get(B),Ye=f.state.lights,Ft=f.state.shadowsArray,kt=Ye.state.version,cn=q.getParameters(B,Ye.state,Ft,W,ae.numPlanes,ae.numIntersection,he),Jt=q.getProgramCacheKey(cn),Zt=Me.program,Zn=!0;if(Zt===void 0)B.addEventListener("dispose",qe);else if(Zt.cacheKey!==Jt)Ot(B);else if(Me.lightsStateVersion!==kt)Me.lightsStateVersion=kt,Zn=!1;else{if(cn.shaderID!==void 0)return;Zn=!1}Zn&&(Zt=q.acquireProgram(cn,Jt),Me.program=Zt,Me.uniforms=cn.uniforms,Me.environment=B.isMeshStandardMaterial?W.environment:null,Me.outputEncoding=d.outputEncoding,B.program=Zt);var Gn=Zt.getAttributes();if(B.morphTargets){B.numSupportedMorphTargets=0;for(var kn=0;kn<d.maxMorphTargets;kn++)Gn["morphTarget"+kn]>=0&&B.numSupportedMorphTargets++}if(B.morphNormals){B.numSupportedMorphNormals=0;for(var kn=0;kn<d.maxMorphNormals;kn++)Gn["morphNormal"+kn]>=0&&B.numSupportedMorphNormals++}var It=Me.uniforms;(!B.isShaderMaterial&&!B.isRawShaderMaterial||B.clipping===!0)&&(Me.numClippingPlanes=ae.numPlanes,Me.numIntersection=ae.numIntersection,It.clippingPlanes=ae.uniform),Me.fog=W.fog,Me.needsLights=nA(B),Me.lightsStateVersion=kt,Me.needsLights&&(It.ambientLightColor.value=Ye.state.ambient,It.lightProbe.value=Ye.state.probe,It.directionalLights.value=Ye.state.directional,It.spotLights.value=Ye.state.spot,It.rectAreaLights.value=Ye.state.rectArea,It.pointLights.value=Ye.state.point,It.hemisphereLights.value=Ye.state.hemi,It.directionalShadowMap.value=Ye.state.directionalShadowMap,It.directionalShadowMatrix.value=Ye.state.directionalShadowMatrix,It.spotShadowMap.value=Ye.state.spotShadowMap,It.spotShadowMatrix.value=Ye.state.spotShadowMatrix,It.pointShadowMap.value=Ye.state.pointShadowMap,It.pointShadowMatrix.value=Ye.state.pointShadowMatrix);var Lt=Me.program.getUniforms(),yo=Ih.seqWithValue(Lt.seq,It);Me.uniformsList=yo}function tp(B,W,he,Me){Ct.resetTextureUnits();var Ye=W.fog,Ft=he.isMeshStandardMaterial?W.environment:null,kt=nt.get(he),cn=f.state.lights;if(pe&&(ke||B!==T)){var Jt=B===T&&he.id===_;ae.setState(he.clippingPlanes,he.clipIntersection,he.clipShadows,B,kt,Jt)}he.version===kt.__version?(kt.program===void 0||he.fog&&kt.fog!==Ye||kt.environment!==Ft||kt.needsLights&&kt.lightsStateVersion!==cn.state.version||kt.numClippingPlanes!==void 0&&(kt.numClippingPlanes!==ae.numPlanes||kt.numIntersection!==ae.numIntersection)||kt.outputEncoding!==d.outputEncoding)&&vo(he,W,Me):(vo(he,W,Me),kt.__version=he.version);var Zt=!1,Zn=!1,Gn=!1,kn=kt.program,It=kn.getUniforms(),Lt=kt.uniforms;if(Ve.useProgram(kn.program)&&(Zt=!0,Zn=!0,Gn=!0),he.id!==_&&(_=he.id,Zn=!0),Zt||T!==B){if(kn.numMultiviewViews>0?Ke.updateCameraProjectionMatricesUniform(B,It):It.setValue(me,"projectionMatrix",B.projectionMatrix),je.logarithmicDepthBuffer&&It.setValue(me,"logDepthBufFC",2/(Math.log(B.far+1)/Math.LN2)),T!==B&&(T=B,Zn=!0,Gn=!0),he.isShaderMaterial||he.isMeshPhongMaterial||he.isMeshToonMaterial||he.isMeshStandardMaterial||he.envMap){var yo=It.map.cameraPosition;yo!==void 0&&yo.setValue(me,Ne.setFromMatrixPosition(B.matrixWorld))}(he.isMeshPhongMaterial||he.isMeshToonMaterial||he.isMeshLambertMaterial||he.isMeshBasicMaterial||he.isMeshStandardMaterial||he.isShaderMaterial)&&It.setValue(me,"isOrthographic",B.isOrthographicCamera===!0),(he.isMeshPhongMaterial||he.isMeshToonMaterial||he.isMeshLambertMaterial||he.isMeshBasicMaterial||he.isMeshStandardMaterial||he.isShaderMaterial||he.skinning)&&(kn.numMultiviewViews>0?Ke.updateCameraViewMatricesUniform(B,It):It.setValue(me,"viewMatrix",B.matrixWorldInverse))}if(he.skinning){It.setOptional(me,Me,"bindMatrix"),It.setOptional(me,Me,"bindMatrixInverse");var Qr=Me.skeleton;if(Qr){var Eu=Qr.bones;if(je.floatVertexTextures){if(Qr.boneTexture===void 0){var Ps=Math.sqrt(Eu.length*4);Ps=ln.ceilPowerOfTwo(Ps),Ps=Math.max(Ps,4);var Yi=new Float32Array(Ps*Ps*4);Yi.set(Qr.boneMatrices);var rp=new wd(Yi,Ps,Ps,pl,Fg);Qr.boneMatrices=Yi,Qr.boneTexture=rp,Qr.boneTextureSize=Ps}It.setValue(me,"boneTexture",Qr.boneTexture,Ct),It.setValue(me,"boneTextureSize",Qr.boneTextureSize)}else It.setOptional(me,Qr,"boneMatrices")}}return(Zn||kt.receiveShadow!==Me.receiveShadow)&&(kt.receiveShadow=Me.receiveShadow,It.setValue(me,"receiveShadow",Me.receiveShadow)),Zn&&(It.setValue(me,"toneMappingExposure",d.toneMappingExposure),It.setValue(me,"toneMappingWhitePoint",d.toneMappingWhitePoint),kt.needsLights&&tA(Lt,Gn),Ye&&he.fog&&Xk(Lt,Ye),he.isMeshBasicMaterial?qs(Lt,he):he.isMeshLambertMaterial?(qs(Lt,he),oy(Lt,he)):he.isMeshToonMaterial?(qs(Lt,he),ay(Lt,he)):he.isMeshPhongMaterial?(qs(Lt,he),Kk(Lt,he)):he.isMeshStandardMaterial?(qs(Lt,he,Ft),he.isMeshPhysicalMaterial?Yk(Lt,he,Ft):d1(Lt,he,Ft)):he.isMeshMatcapMaterial?(qs(Lt,he),Zk(Lt,he)):he.isMeshDepthMaterial?(qs(Lt,he),Jk(Lt,he)):he.isMeshDistanceMaterial?(qs(Lt,he),Qk(Lt,he)):he.isMeshNormalMaterial?(qs(Lt,he),eA(Lt,he)):he.isLineBasicMaterial?(np(Lt,he),he.isLineDashedMaterial&&xc(Lt,he)):he.isPointsMaterial?jk(Lt,he):he.isSpriteMaterial?qk(Lt,he):he.isShadowMaterial&&(Lt.color.value.copy(he.color),Lt.opacity.value=he.opacity),Lt.ltc_1!==void 0&&(Lt.ltc_1.value=ht.LTC_1),Lt.ltc_2!==void 0&&(Lt.ltc_2.value=ht.LTC_2),Ih.upload(me,kt.uniformsList,Lt,Ct),he.isShaderMaterial&&(he.uniformsNeedUpdate=!1)),he.isShaderMaterial&&he.uniformsNeedUpdate===!0&&(Ih.upload(me,kt.uniformsList,Lt,Ct),he.uniformsNeedUpdate=!1),he.isSpriteMaterial&&It.setValue(me,"center",Me.center),kn.numMultiviewViews>0?Ke.updateObjectMatricesUniforms(Me,B,It):(It.setValue(me,"modelViewMatrix",Me.modelViewMatrix),It.setValue(me,"normalMatrix",Me.normalMatrix)),It.setValue(me,"modelMatrix",Me.matrixWorld),kn}function qs(B,W,he){B.opacity.value=W.opacity,W.color&&B.diffuse.value.copy(W.color),W.emissive&&B.emissive.value.copy(W.emissive).multiplyScalar(W.emissiveIntensity),W.map&&(B.map.value=W.map),W.alphaMap&&(B.alphaMap.value=W.alphaMap),W.specularMap&&(B.specularMap.value=W.specularMap);var Me=W.envMap||he;Me&&(B.envMap.value=Me,B.flipEnvMap.value=Me.isCubeTexture?-1:1,B.reflectivity.value=W.reflectivity,B.refractionRatio.value=W.refractionRatio,B.maxMipLevel.value=nt.get(Me).__maxMipLevel),W.lightMap&&(B.lightMap.value=W.lightMap,B.lightMapIntensity.value=W.lightMapIntensity),W.aoMap&&(B.aoMap.value=W.aoMap,B.aoMapIntensity.value=W.aoMapIntensity);var Ye;W.map?Ye=W.map:W.specularMap?Ye=W.specularMap:W.displacementMap?Ye=W.displacementMap:W.normalMap?Ye=W.normalMap:W.bumpMap?Ye=W.bumpMap:W.roughnessMap?Ye=W.roughnessMap:W.metalnessMap?Ye=W.metalnessMap:W.alphaMap?Ye=W.alphaMap:W.emissiveMap&&(Ye=W.emissiveMap),Ye!==void 0&&(Ye.isWebGLRenderTarget&&(Ye=Ye.texture),Ye.matrixAutoUpdate===!0&&Ye.updateMatrix(),B.uvTransform.value.copy(Ye.matrix));var Ft;W.aoMap?Ft=W.aoMap:W.lightMap&&(Ft=W.lightMap),Ft!==void 0&&(Ft.isWebGLRenderTarget&&(Ft=Ft.texture),Ft.matrixAutoUpdate===!0&&Ft.updateMatrix(),B.uv2Transform.value.copy(Ft.matrix))}function np(B,W){B.diffuse.value.copy(W.color),B.opacity.value=W.opacity}function xc(B,W){B.dashSize.value=W.dashSize,B.totalSize.value=W.dashSize+W.gapSize,B.scale.value=W.scale}function jk(B,W){B.diffuse.value.copy(W.color),B.opacity.value=W.opacity,B.size.value=W.size*N,B.scale.value=P*.5,W.map&&(B.map.value=W.map),W.alphaMap&&(B.alphaMap.value=W.alphaMap);var he;W.map?he=W.map:W.alphaMap&&(he=W.alphaMap),he!==void 0&&(he.matrixAutoUpdate===!0&&he.updateMatrix(),B.uvTransform.value.copy(he.matrix))}function qk(B,W){B.diffuse.value.copy(W.color),B.opacity.value=W.opacity,B.rotation.value=W.rotation,W.map&&(B.map.value=W.map),W.alphaMap&&(B.alphaMap.value=W.alphaMap);var he;W.map?he=W.map:W.alphaMap&&(he=W.alphaMap),he!==void 0&&(he.matrixAutoUpdate===!0&&he.updateMatrix(),B.uvTransform.value.copy(he.matrix))}function Xk(B,W){B.fogColor.value.copy(W.color),W.isFog?(B.fogNear.value=W.near,B.fogFar.value=W.far):W.isFogExp2&&(B.fogDensity.value=W.density)}function oy(B,W){W.emissiveMap&&(B.emissiveMap.value=W.emissiveMap)}function Kk(B,W){B.specular.value.copy(W.specular),B.shininess.value=Math.max(W.shininess,1e-4),W.emissiveMap&&(B.emissiveMap.value=W.emissiveMap),W.bumpMap&&(B.bumpMap.value=W.bumpMap,B.bumpScale.value=W.bumpScale,W.side===Pi&&(B.bumpScale.value*=-1)),W.normalMap&&(B.normalMap.value=W.normalMap,B.normalScale.value.copy(W.normalScale),W.side===Pi&&B.normalScale.value.negate()),W.displacementMap&&(B.displacementMap.value=W.displacementMap,B.displacementScale.value=W.displacementScale,B.displacementBias.value=W.displacementBias)}function ay(B,W){B.specular.value.copy(W.specular),B.shininess.value=Math.max(W.shininess,1e-4),W.gradientMap&&(B.gradientMap.value=W.gradientMap),W.emissiveMap&&(B.emissiveMap.value=W.emissiveMap),W.bumpMap&&(B.bumpMap.value=W.bumpMap,B.bumpScale.value=W.bumpScale,W.side===Pi&&(B.bumpScale.value*=-1)),W.normalMap&&(B.normalMap.value=W.normalMap,B.normalScale.value.copy(W.normalScale),W.side===Pi&&B.normalScale.value.negate()),W.displacementMap&&(B.displacementMap.value=W.displacementMap,B.displacementScale.value=W.displacementScale,B.displacementBias.value=W.displacementBias)}function d1(B,W,he){B.roughness.value=W.roughness,B.metalness.value=W.metalness,W.roughnessMap&&(B.roughnessMap.value=W.roughnessMap),W.metalnessMap&&(B.metalnessMap.value=W.metalnessMap),W.emissiveMap&&(B.emissiveMap.value=W.emissiveMap),W.bumpMap&&(B.bumpMap.value=W.bumpMap,B.bumpScale.value=W.bumpScale,W.side===Pi&&(B.bumpScale.value*=-1)),W.normalMap&&(B.normalMap.value=W.normalMap,B.normalScale.value.copy(W.normalScale),W.side===Pi&&B.normalScale.value.negate()),W.displacementMap&&(B.displacementMap.value=W.displacementMap,B.displacementScale.value=W.displacementScale,B.displacementBias.value=W.displacementBias),(W.envMap||he)&&(B.envMapIntensity.value=W.envMapIntensity)}function Yk(B,W,he){d1(B,W,he),B.reflectivity.value=W.reflectivity,B.clearcoat.value=W.clearcoat,B.clearcoatRoughness.value=W.clearcoatRoughness,W.sheen&&B.sheen.value.copy(W.sheen),W.clearcoatNormalMap&&(B.clearcoatNormalScale.value.copy(W.clearcoatNormalScale),B.clearcoatNormalMap.value=W.clearcoatNormalMap,W.side===Pi&&B.clearcoatNormalScale.value.negate()),B.transparency.value=W.transparency}function Zk(B,W){W.matcap&&(B.matcap.value=W.matcap),W.bumpMap&&(B.bumpMap.value=W.bumpMap,B.bumpScale.value=W.bumpScale,W.side===Pi&&(B.bumpScale.value*=-1)),W.normalMap&&(B.normalMap.value=W.normalMap,B.normalScale.value.copy(W.normalScale),W.side===Pi&&B.normalScale.value.negate()),W.displacementMap&&(B.displacementMap.value=W.displacementMap,B.displacementScale.value=W.displacementScale,B.displacementBias.value=W.displacementBias)}function Jk(B,W){W.displacementMap&&(B.displacementMap.value=W.displacementMap,B.displacementScale.value=W.displacementScale,B.displacementBias.value=W.displacementBias)}function Qk(B,W){W.displacementMap&&(B.displacementMap.value=W.displacementMap,B.displacementScale.value=W.displacementScale,B.displacementBias.value=W.displacementBias),B.referencePosition.value.copy(W.referencePosition),B.nearDistance.value=W.nearDistance,B.farDistance.value=W.farDistance}function eA(B,W){W.bumpMap&&(B.bumpMap.value=W.bumpMap,B.bumpScale.value=W.bumpScale,W.side===Pi&&(B.bumpScale.value*=-1)),W.normalMap&&(B.normalMap.value=W.normalMap,B.normalScale.value.copy(W.normalScale),W.side===Pi&&B.normalScale.value.negate()),W.displacementMap&&(B.displacementMap.value=W.displacementMap,B.displacementScale.value=W.displacementScale,B.displacementBias.value=W.displacementBias)}function tA(B,W){B.ambientLightColor.needsUpdate=W,B.lightProbe.needsUpdate=W,B.directionalLights.needsUpdate=W,B.pointLights.needsUpdate=W,B.spotLights.needsUpdate=W,B.rectAreaLights.needsUpdate=W,B.hemisphereLights.needsUpdate=W}function nA(B){return B.isMeshLambertMaterial||B.isMeshToonMaterial||B.isMeshPhongMaterial||B.isMeshStandardMaterial||B.isShadowMaterial||B.isShaderMaterial&&B.lights===!0}this.setFramebuffer=function(B){m!==B&&w===null&&me.bindFramebuffer(36160,B),m=B},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return w},this.setRenderTarget=function(B,W,he){w=B,v=W,y=he,B&&nt.get(B).__webglFramebuffer===void 0&&Ct.setupRenderTarget(B);var Me=m,Ye=!1;if(B){var Ft=nt.get(B).__webglFramebuffer;B.isWebGLCubeRenderTarget?(Me=Ft[W||0],Ye=!0):B.isWebGLMultisampleRenderTarget?Me=nt.get(B).__webglMultisampledFramebuffer:Me=Ft,k.copy(B.viewport),A.copy(B.scissor),M=B.scissorTest}else k.copy(O).multiplyScalar(N).floor(),A.copy(K).multiplyScalar(N).floor(),M=J;if(x!==Me&&(me.bindFramebuffer(36160,Me),x=Me),Ve.viewport(k),Ve.scissor(A),Ve.setScissorTest(M),Ye){var kt=nt.get(B.texture);me.framebufferTexture2D(36160,36064,34069+(W||0),kt.__webglTexture,he||0)}},this.readRenderTargetPixels=function(B,W,he,Me,Ye,Ft,kt){if(!(B&&B.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}var cn=nt.get(B).__webglFramebuffer;if(B.isWebGLCubeRenderTarget&&kt!==void 0&&(cn=cn[kt]),cn){var Jt=!1;cn!==x&&(me.bindFramebuffer(36160,cn),Jt=!0);try{var Zt=B.texture,Zn=Zt.format,Gn=Zt.type;if(Zn!==pl&&We.convert(Zn)!==me.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(Gn!==Iw&&We.convert(Gn)!==me.getParameter(35738)&&!(Gn===Fg&&(je.isWebGL2||Fe.get("OES_texture_float")||Fe.get("WEBGL_color_buffer_float")))&&!(Gn===jT&&(je.isWebGL2?Fe.get("EXT_color_buffer_float"):Fe.get("EXT_color_buffer_half_float")))){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}me.checkFramebufferStatus(36160)===36053?W>=0&&W<=B.width-Me&&he>=0&&he<=B.height-Ye&&me.readPixels(W,he,Me,Ye,We.convert(Zn),We.convert(Gn),Ft):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{Jt&&me.bindFramebuffer(36160,x)}}},this.copyFramebufferToTexture=function(B,W,he){he===void 0&&(he=0);var Me=Math.pow(2,-he),Ye=Math.floor(W.image.width*Me),Ft=Math.floor(W.image.height*Me),kt=We.convert(W.format);Ct.setTexture2D(W,0),me.copyTexImage2D(3553,he,kt,B.x,B.y,Ye,Ft,0),Ve.unbindTexture()},this.copyTextureToTexture=function(B,W,he,Me){var Ye=W.image.width,Ft=W.image.height,kt=We.convert(he.format),cn=We.convert(he.type);Ct.setTexture2D(he,0),W.isDataTexture?me.texSubImage2D(3553,Me||0,B.x,B.y,Ye,Ft,kt,cn,W.image.data):me.texSubImage2D(3553,Me||0,B.x,B.y,kt,cn,W.image),Ve.unbindTexture()},this.initTexture=function(B){Ct.setTexture2D(B,0),Ve.unbindTexture()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function dE(t,e){this.name="",this.color=new yt(t),this.density=e!==void 0?e:25e-5}Object.assign(dE.prototype,{isFogExp2:!0,clone:function(){return new dE(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}});function pE(t,e,n){this.name="",this.color=new yt(t),this.near=e!==void 0?e:1,this.far=n!==void 0?n:1e3}Object.assign(pE.prototype,{isFog:!0,clone:function(){return new pE(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}});function cu(t,e){this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=Ow,this.updateRange={offset:0,count:-1},this.version=0}Object.defineProperty(cu.prototype,"needsUpdate",{set:function(t){t===!0&&this.version++}});Object.assign(cu.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.stride,n*=e.stride;for(var r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this},set:function(t,e){return e===void 0&&(e=0),this.array.set(t,e),this},clone:function(){return new this.constructor().copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}});var _d=new j;function Qw(t,e,n,r){this.data=t,this.itemSize=e,this.offset=n,this.normalized=r===!0}Object.defineProperties(Qw.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}});Object.assign(Qw.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(var e=0,n=this.data.count;e<n;e++)_d.x=this.getX(e),_d.y=this.getY(e),_d.z=this.getZ(e),_d.applyMatrix4(t),this.setXYZ(e,_d.x,_d.y,_d.z);return this},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this}});function Rh(t){jt.call(this),this.type="SpriteMaterial",this.color=new yt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}Rh.prototype=Object.create(jt.prototype);Rh.prototype.constructor=Rh;Rh.prototype.isSpriteMaterial=!0;Rh.prototype.copy=function(t){return jt.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};var lv,ex=new j,cv=new j,uv=new j,hv=new $e,tx=new $e,hX=new vn,mE=new j,nx=new j,gE=new j,fX=new $e,nP=new $e,dX=new $e;function rx(t){if(ft.call(this),this.type="Sprite",lv===void 0){lv=new wt;var e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new cu(e,5);lv.setIndex([0,1,2,0,2,3]),lv.setAttribute("position",new Qw(n,3,0,!1)),lv.setAttribute("uv",new Qw(n,2,3,!1))}this.geometry=lv,this.material=t!==void 0?t:new Rh,this.center=new $e(.5,.5)}rx.prototype=Object.assign(Object.create(ft.prototype),{constructor:rx,isSprite:!0,raycast:function(t,e){t.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),cv.setFromMatrixScale(this.matrixWorld),hX.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),uv.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&cv.multiplyScalar(-uv.z);var n=this.material.rotation,r,i;n!==0&&(i=Math.cos(n),r=Math.sin(n));var s=this.center;vE(mE.set(-.5,-.5,0),uv,s,cv,r,i),vE(nx.set(.5,-.5,0),uv,s,cv,r,i),vE(gE.set(.5,.5,0),uv,s,cv,r,i),fX.set(0,0),nP.set(1,0),dX.set(1,1);var o=t.ray.intersectTriangle(mE,nx,gE,!1,ex);if(!(o===null&&(vE(nx.set(-.5,.5,0),uv,s,cv,r,i),nP.set(0,1),o=t.ray.intersectTriangle(mE,gE,nx,!1,ex),o===null))){var a=t.ray.origin.distanceTo(ex);a<t.near||a>t.far||e.push({distance:a,point:ex.clone(),uv:qi.getUV(ex,mE,nx,gE,fX,nP,dX,new $e),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(t){return ft.prototype.copy.call(this,t),t.center!==void 0&&this.center.copy(t.center),this}});function vE(t,e,n,r,i,s){hv.subVectors(t,n).addScalar(.5).multiply(r),i!==void 0?(tx.x=s*hv.x-i*hv.y,tx.y=i*hv.x+s*hv.y):tx.copy(hv),t.copy(e),t.x+=tx.x,t.y+=tx.y,t.applyMatrix4(hX)}var yE=new j,pX=new j;function ix(){ft.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}ix.prototype=Object.assign(Object.create(ft.prototype),{constructor:ix,isLOD:!0,copy:function(t){ft.prototype.copy.call(this,t,!1);for(var e=t.levels,n=0,r=e.length;n<r;n++){var i=e[n];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t,e){e===void 0&&(e=0),e=Math.abs(e);for(var n=this.levels,r=0;r<n.length&&!(e<n[r].distance);r++);return n.splice(r,0,{distance:e,object:t}),this.add(t),this},getObjectForDistance:function(t){var e=this.levels;if(e.length>0){for(var n=1,r=e.length;n<r&&!(t<e[n].distance);n++);return e[n-1].object}return null},raycast:function(t,e){var n=this.levels;if(n.length>0){yE.setFromMatrixPosition(this.matrixWorld);var r=t.ray.origin.distanceTo(yE);this.getObjectForDistance(r).raycast(t,e)}},update:function(t){var e=this.levels;if(e.length>1){yE.setFromMatrixPosition(t.matrixWorld),pX.setFromMatrixPosition(this.matrixWorld);var n=yE.distanceTo(pX);e[0].object.visible=!0;for(var r=1,i=e.length;r<i&&n>=e[r].distance;r++)e[r-1].object.visible=!1,e[r].object.visible=!0;for(;r<i;r++)e[r].object.visible=!1}},toJSON:function(t){var e=ft.prototype.toJSON.call(this,t);this.autoUpdate===!1&&(e.object.autoUpdate=!1),e.object.levels=[];for(var n=this.levels,r=0,i=n.length;r<i;r++){var s=n[r];e.object.levels.push({object:s.object.uuid,distance:s.distance})}return e}});function sx(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Or.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new vn,this.bindMatrixInverse=new vn}sx.prototype=Object.assign(Object.create(Or.prototype),{constructor:sx,isSkinnedMesh:!0,bind:function(t,e){this.skeleton=t,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var t=new lr,e=this.geometry.attributes.skinWeight,n=0,r=e.count;n<r;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);var i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){Or.prototype.updateMatrixWorld.call(this,t),this.bindMode==="attached"?this.bindMatrixInverse.getInverse(this.matrixWorld):this.bindMode==="detached"?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var mX=new vn,Rje=new vn;function bE(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(this.bones.length*16),this.frame=-1,e===void 0)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new vn)}}Object.assign(bE.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var n=new vn;this.bones[t]&&n.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(n)}},pose:function(){var t,e,n;for(e=0,n=this.bones.length;e<n;e++)t=this.bones[e],t&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,n=this.bones.length;e<n;e++)t=this.bones[e],t&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){for(var t=this.bones,e=this.boneInverses,n=this.boneMatrices,r=this.boneTexture,i=0,s=t.length;i<s;i++){var o=t[i]?t[i].matrixWorld:Rje;mX.multiplyMatrices(o,e[i]),mX.toArray(n,i*16)}r!==void 0&&(r.needsUpdate=!0)},clone:function(){return new bE(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,n=this.bones.length;e<n;e++){var r=this.bones[e];if(r.name===t)return r}}});function rP(){ft.call(this),this.type="Bone"}rP.prototype=Object.assign(Object.create(ft.prototype),{constructor:rP,isBone:!0});var gX=new vn,vX=new vn,fv=[],ox=new Or;function wE(t,e,n){Or.call(this,t,e),this.instanceMatrix=new qt(new Float32Array(n*16),16),this.count=n,this.frustumCulled=!1}wE.prototype=Object.assign(Object.create(Or.prototype),{constructor:wE,isInstancedMesh:!0,getMatrixAt:function(t,e){e.fromArray(this.instanceMatrix.array,t*16)},raycast:function(t,e){var n=this.matrixWorld,r=this.count;if(ox.geometry=this.geometry,ox.material=this.material,ox.material!==void 0)for(var i=0;i<r;i++)this.getMatrixAt(i,gX),vX.multiplyMatrices(n,gX),ox.matrixWorld=vX,ox.raycast(t,fv),fv.length>0&&(fv[0].instanceId=i,fv[0].object=this,e.push(fv[0]),fv.length=0)},setMatrixAt:function(t,e){e.toArray(this.instanceMatrix.array,t*16)},updateMorphTargets:function(){}});function Fr(t){jt.call(this),this.type="LineBasicMaterial",this.color=new yt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}Fr.prototype=Object.create(jt.prototype);Fr.prototype.constructor=Fr;Fr.prototype.isLineBasicMaterial=!0;Fr.prototype.copy=function(t){return jt.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this};var yX=new j,bX=new j,wX=new vn,xE=new dd,_E=new iu;function Wo(t,e,n){n===1&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),ft.call(this),this.type="Line",this.geometry=t!==void 0?t:new wt,this.material=e!==void 0?e:new Fr}Wo.prototype=Object.assign(Object.create(ft.prototype),{constructor:Wo,isLine:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(t.index===null){for(var e=t.attributes.position,n=[0],r=1,i=e.count;r<i;r++)yX.fromBufferAttribute(e,r-1),bX.fromBufferAttribute(e,r),n[r]=n[r-1],n[r]+=yX.distanceTo(bX);t.setAttribute("lineDistance",new ut(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){var s=t.vertices,n=t.lineDistances;n[0]=0;for(var r=1,i=s.length;r<i;r++)n[r]=n[r-1],n[r]+=s[r-1].distanceTo(s[r])}return this},raycast:function(t,e){var n=t.linePrecision,r=this.geometry,i=this.matrixWorld;if(r.boundingSphere===null&&r.computeBoundingSphere(),_E.copy(r.boundingSphere),_E.applyMatrix4(i),_E.radius+=n,t.ray.intersectsSphere(_E)!==!1){wX.getInverse(i),xE.copy(t.ray).applyMatrix4(wX);var s=n/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,a=new j,l=new j,c=new j,u=new j,h=this&&this.isLineSegments?2:1;if(r.isBufferGeometry){var f=r.index,d=r.attributes,p=d.position.array;if(f!==null)for(var m=f.array,v=0,y=m.length-1;v<y;v+=h){var w=m[v],x=m[v+1];a.fromArray(p,w*3),l.fromArray(p,x*3);var _=xE.distanceSqToSegment(a,l,u,c);if(!(_>o)){u.applyMatrix4(this.matrixWorld);var S=t.ray.origin.distanceTo(u);S<t.near||S>t.far||e.push({distance:S,point:c.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else for(var v=0,y=p.length/3-1;v<y;v+=h){a.fromArray(p,3*v),l.fromArray(p,3*v+3);var _=xE.distanceSqToSegment(a,l,u,c);if(!(_>o)){u.applyMatrix4(this.matrixWorld);var S=t.ray.origin.distanceTo(u);S<t.near||S>t.far||e.push({distance:S,point:c.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}else if(r.isGeometry)for(var T=r.vertices,E=T.length,v=0;v<E-1;v+=h){var _=xE.distanceSqToSegment(T[v],T[v+1],u,c);if(!(_>o)){u.applyMatrix4(this.matrixWorld);var S=t.ray.origin.distanceTo(u);S<t.near||S>t.far||e.push({distance:S,point:c.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var SE=new j,CE=new j;function Vr(t,e){Wo.call(this,t,e),this.type="LineSegments"}Vr.prototype=Object.assign(Object.create(Wo.prototype),{constructor:Vr,isLineSegments:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(t.index===null){for(var e=t.attributes.position,n=[],r=0,i=e.count;r<i;r+=2)SE.fromBufferAttribute(e,r),CE.fromBufferAttribute(e,r+1),n[r]=r===0?0:n[r-1],n[r+1]=n[r]+SE.distanceTo(CE);t.setAttribute("lineDistance",new ut(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry)for(var s=t.vertices,n=t.lineDistances,r=0,i=s.length;r<i;r+=2)SE.copy(s[r]),CE.copy(s[r+1]),n[r]=r===0?0:n[r-1],n[r+1]=n[r]+SE.distanceTo(CE);return this}});function TE(t,e){Wo.call(this,t,e),this.type="LineLoop"}TE.prototype=Object.assign(Object.create(Wo.prototype),{constructor:TE,isLineLoop:!0});function wl(t){jt.call(this),this.type="PointsMaterial",this.color=new yt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}wl.prototype=Object.create(jt.prototype);wl.prototype.constructor=wl;wl.prototype.isPointsMaterial=!0;wl.prototype.copy=function(t){return jt.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};var xX=new vn,iP=new dd,EE=new iu,kE=new j;function dv(t,e){ft.call(this),this.type="Points",this.geometry=t!==void 0?t:new wt,this.material=e!==void 0?e:new wl,this.updateMorphTargets()}dv.prototype=Object.assign(Object.create(ft.prototype),{constructor:dv,isPoints:!0,raycast:function(t,e){var n=this.geometry,r=this.matrixWorld,i=t.params.Points.threshold;if(n.boundingSphere===null&&n.computeBoundingSphere(),EE.copy(n.boundingSphere),EE.applyMatrix4(r),EE.radius+=i,t.ray.intersectsSphere(EE)!==!1){xX.getInverse(r),iP.copy(t.ray).applyMatrix4(xX);var s=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s;if(n.isBufferGeometry){var a=n.index,l=n.attributes,c=l.position.array;if(a!==null)for(var u=a.array,h=0,f=u.length;h<f;h++){var d=u[h];kE.fromArray(c,d*3),sP(kE,d,o,r,t,e,this)}else for(var h=0,p=c.length/3;h<p;h++)kE.fromArray(c,h*3),sP(kE,h,o,r,t,e,this)}else for(var m=n.vertices,h=0,p=m.length;h<p;h++)sP(m[h],h,o,r,t,e,this)}},updateMorphTargets:function(){var t=this.geometry,e,n,r;if(t.isBufferGeometry){var i=t.morphAttributes,s=Object.keys(i);if(s.length>0){var o=i[s[0]];if(o!==void 0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,n=o.length;e<n;e++)r=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var a=t.morphTargets;a!==void 0&&a.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});function sP(t,e,n,r,i,s,o){var a=iP.distanceSqToPoint(t);if(a<n){var l=new j;iP.closestPointToPoint(t,l),l.applyMatrix4(r);var c=i.ray.origin.distanceTo(l);if(c<i.near||c>i.far)return;s.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}function oP(t,e,n,r,i,s,o,a,l){ar.call(this,t,e,n,r,i,s,o,a,l),this.format=o!==void 0?o:Sh,this.minFilter=s!==void 0?s:Oi,this.magFilter=i!==void 0?i:Oi,this.generateMipmaps=!1}oP.prototype=Object.assign(Object.create(ar.prototype),{constructor:oP,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});function pv(t,e,n,r,i,s,o,a,l,c,u,h){ar.call(this,null,s,o,a,l,c,r,i,u,h),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}pv.prototype=Object.create(ar.prototype);pv.prototype.constructor=pv;pv.prototype.isCompressedTexture=!0;function ax(t,e,n,r,i,s,o,a,l){ar.call(this,t,e,n,r,i,s,o,a,l),this.needsUpdate=!0}ax.prototype=Object.create(ar.prototype);ax.prototype.constructor=ax;ax.prototype.isCanvasTexture=!0;function lx(t,e,n,r,i,s,o,a,l,c){if(c=c!==void 0?c:sd,c!==sd&&c!==Lg)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&c===sd&&(n=Nw),n===void 0&&c===Lg&&(n=$w),ar.call(this,null,r,i,s,o,a,c,n,l),this.image={width:t,height:e},this.magFilter=o!==void 0?o:li,this.minFilter=a!==void 0?a:li,this.flipY=!1,this.generateMipmaps=!1}lx.prototype=Object.create(ar.prototype);lx.prototype.constructor=lx;lx.prototype.isDepthTexture=!0;function mv(t){wt.call(this),this.type="WireframeGeometry";var e=[],n,r,i,s,o,a=[0,0],l={},c,u,h,f,d=["a","b","c"],p;if(t&&t.isGeometry){var m=t.faces;for(n=0,i=m.length;n<i;n++){var v=m[n];for(r=0;r<3;r++)u=v[d[r]],h=v[d[(r+1)%3]],a[0]=Math.min(u,h),a[1]=Math.max(u,h),f=a[0]+","+a[1],l[f]===void 0&&(l[f]={index1:a[0],index2:a[1]})}for(f in l)c=l[f],p=t.vertices[c.index1],e.push(p.x,p.y,p.z),p=t.vertices[c.index2],e.push(p.x,p.y,p.z)}else if(t&&t.isBufferGeometry){var y,w,x,_,S,T,E,k;if(p=new j,t.index!==null){for(y=t.attributes.position,w=t.index,x=t.groups,x.length===0&&(x=[{start:0,count:w.count,materialIndex:0}]),s=0,o=x.length;s<o;++s)for(_=x[s],S=_.start,T=_.count,n=S,i=S+T;n<i;n+=3)for(r=0;r<3;r++)u=w.getX(n+r),h=w.getX(n+(r+1)%3),a[0]=Math.min(u,h),a[1]=Math.max(u,h),f=a[0]+","+a[1],l[f]===void 0&&(l[f]={index1:a[0],index2:a[1]});for(f in l)c=l[f],p.fromBufferAttribute(y,c.index1),e.push(p.x,p.y,p.z),p.fromBufferAttribute(y,c.index2),e.push(p.x,p.y,p.z)}else for(y=t.attributes.position,n=0,i=y.count/3;n<i;n++)for(r=0;r<3;r++)E=3*n+r,p.fromBufferAttribute(y,E),e.push(p.x,p.y,p.z),k=3*n+(r+1)%3,p.fromBufferAttribute(y,k),e.push(p.x,p.y,p.z)}this.setAttribute("position",new ut(e,3))}mv.prototype=Object.create(wt.prototype);mv.prototype.constructor=mv;function cx(t,e,n){Yt.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:n},this.fromBufferGeometry(new gv(t,e,n)),this.mergeVertices()}cx.prototype=Object.create(Yt.prototype);cx.prototype.constructor=cx;function gv(t,e,n){wt.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:n};var r=[],i=[],s=[],o=[],a=1e-5,l=new j,c=new j,u=new j,h=new j,f=new j,d,p;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var m=e+1;for(d=0;d<=n;d++){var v=d/n;for(p=0;p<=e;p++){var y=p/e;t(y,v,c),i.push(c.x,c.y,c.z),y-a>=0?(t(y-a,v,u),h.subVectors(c,u)):(t(y+a,v,u),h.subVectors(u,c)),v-a>=0?(t(y,v-a,u),f.subVectors(c,u)):(t(y,v+a,u),f.subVectors(u,c)),l.crossVectors(h,f).normalize(),s.push(l.x,l.y,l.z),o.push(y,v)}}for(d=0;d<n;d++)for(p=0;p<e;p++){var w=d*m+p,x=d*m+p+1,_=(d+1)*m+p+1,S=(d+1)*m+p;r.push(w,x,S),r.push(x,_,S)}this.setIndex(r),this.setAttribute("position",new ut(i,3)),this.setAttribute("normal",new ut(s,3)),this.setAttribute("uv",new ut(o,2))}gv.prototype=Object.create(wt.prototype);gv.prototype.constructor=gv;function ux(t,e,n,r){Yt.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:r},this.fromBufferGeometry(new po(t,e,n,r)),this.mergeVertices()}ux.prototype=Object.create(Yt.prototype);ux.prototype.constructor=ux;function po(t,e,n,r){wt.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:r},n=n||1,r=r||0;var i=[],s=[];o(r),l(n),c(),this.setAttribute("position",new ut(i,3)),this.setAttribute("normal",new ut(i.slice(),3)),this.setAttribute("uv",new ut(s,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function o(y){for(var w=new j,x=new j,_=new j,S=0;S<e.length;S+=3)f(e[S+0],w),f(e[S+1],x),f(e[S+2],_),a(w,x,_,y)}function a(y,w,x,_){var S=Math.pow(2,_),T=[],E,k;for(E=0;E<=S;E++){T[E]=[];var A=y.clone().lerp(x,E/S),M=w.clone().lerp(x,E/S),D=S-E;for(k=0;k<=D;k++)k===0&&E===S?T[E][k]=A:T[E][k]=A.clone().lerp(M,k/D)}for(E=0;E<S;E++)for(k=0;k<2*(S-E)-1;k++){var P=Math.floor(k/2);k%2==0?(h(T[E][P+1]),h(T[E+1][P]),h(T[E][P])):(h(T[E][P+1]),h(T[E+1][P+1]),h(T[E+1][P]))}}function l(y){for(var w=new j,x=0;x<i.length;x+=3)w.x=i[x+0],w.y=i[x+1],w.z=i[x+2],w.normalize().multiplyScalar(y),i[x+0]=w.x,i[x+1]=w.y,i[x+2]=w.z}function c(){for(var y=new j,w=0;w<i.length;w+=3){y.x=i[w+0],y.y=i[w+1],y.z=i[w+2];var x=m(y)/2/Math.PI+.5,_=v(y)/Math.PI+.5;s.push(x,1-_)}d(),u()}function u(){for(var y=0;y<s.length;y+=6){var w=s[y+0],x=s[y+2],_=s[y+4],S=Math.max(w,x,_),T=Math.min(w,x,_);S>.9&&T<.1&&(w<.2&&(s[y+0]+=1),x<.2&&(s[y+2]+=1),_<.2&&(s[y+4]+=1))}}function h(y){i.push(y.x,y.y,y.z)}function f(y,w){var x=y*3;w.x=t[x+0],w.y=t[x+1],w.z=t[x+2]}function d(){for(var y=new j,w=new j,x=new j,_=new j,S=new $e,T=new $e,E=new $e,k=0,A=0;k<i.length;k+=9,A+=6){y.set(i[k+0],i[k+1],i[k+2]),w.set(i[k+3],i[k+4],i[k+5]),x.set(i[k+6],i[k+7],i[k+8]),S.set(s[A+0],s[A+1]),T.set(s[A+2],s[A+3]),E.set(s[A+4],s[A+5]),_.copy(y).add(w).add(x).divideScalar(3);var M=m(_);p(S,A+0,y,M),p(T,A+2,w,M),p(E,A+4,x,M)}}function p(y,w,x,_){_<0&&y.x===1&&(s[w]=y.x-1),x.x===0&&x.z===0&&(s[w]=_/2/Math.PI+.5)}function m(y){return Math.atan2(y.z,-y.x)}function v(y){return Math.atan2(-y.y,Math.sqrt(y.x*y.x+y.z*y.z))}}po.prototype=Object.create(wt.prototype);po.prototype.constructor=po;function hx(t,e){Yt.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new vv(t,e)),this.mergeVertices()}hx.prototype=Object.create(Yt.prototype);hx.prototype.constructor=hx;function vv(t,e){var n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];po.call(this,n,r,t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}vv.prototype=Object.create(po.prototype);vv.prototype.constructor=vv;function fx(t,e){Yt.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Sd(t,e)),this.mergeVertices()}fx.prototype=Object.create(Yt.prototype);fx.prototype.constructor=fx;function Sd(t,e){var n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];po.call(this,n,r,t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}Sd.prototype=Object.create(po.prototype);Sd.prototype.constructor=Sd;function dx(t,e){Yt.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new yv(t,e)),this.mergeVertices()}dx.prototype=Object.create(Yt.prototype);dx.prototype.constructor=dx;function yv(t,e){var n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],i=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];po.call(this,r,i,t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}yv.prototype=Object.create(po.prototype);yv.prototype.constructor=yv;function px(t,e){Yt.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new bv(t,e)),this.mergeVertices()}px.prototype=Object.create(Yt.prototype);px.prototype.constructor=px;function bv(t,e){var n=(1+Math.sqrt(5))/2,r=1/n,i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];po.call(this,i,s,t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}bv.prototype=Object.create(po.prototype);bv.prototype.constructor=bv;function mx(t,e,n,r,i,s){Yt.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:i},s!==void 0&&console.warn("THREE.TubeGeometry: taper has been removed.");var o=new Cd(t,e,n,r,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals,this.fromBufferGeometry(o),this.mergeVertices()}mx.prototype=Object.create(Yt.prototype);mx.prototype.constructor=mx;function Cd(t,e,n,r,i){wt.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:i},e=e||64,n=n||1,r=r||8,i=i||!1;var s=t.computeFrenetFrames(e,i);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;var o=new j,a=new j,l=new $e,c=new j,u,h,f=[],d=[],p=[],m=[];v(),this.setIndex(m),this.setAttribute("position",new ut(f,3)),this.setAttribute("normal",new ut(d,3)),this.setAttribute("uv",new ut(p,2));function v(){for(u=0;u<e;u++)y(u);y(i===!1?e:0),x(),w()}function y(_){c=t.getPointAt(_/e,c);var S=s.normals[_],T=s.binormals[_];for(h=0;h<=r;h++){var E=h/r*Math.PI*2,k=Math.sin(E),A=-Math.cos(E);a.x=A*S.x+k*T.x,a.y=A*S.y+k*T.y,a.z=A*S.z+k*T.z,a.normalize(),d.push(a.x,a.y,a.z),o.x=c.x+n*a.x,o.y=c.y+n*a.y,o.z=c.z+n*a.z,f.push(o.x,o.y,o.z)}}function w(){for(h=1;h<=e;h++)for(u=1;u<=r;u++){var _=(r+1)*(h-1)+(u-1),S=(r+1)*h+(u-1),T=(r+1)*h+u,E=(r+1)*(h-1)+u;m.push(_,S,E),m.push(S,T,E)}}function x(){for(u=0;u<=e;u++)for(h=0;h<=r;h++)l.x=u/e,l.y=h/r,p.push(l.x,l.y)}}Cd.prototype=Object.create(wt.prototype);Cd.prototype.constructor=Cd;Cd.prototype.toJSON=function(){var t=wt.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t};function gx(t,e,n,r,i,s,o){Yt.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:i,q:s},o!==void 0&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new wv(t,e,n,r,i,s)),this.mergeVertices()}gx.prototype=Object.create(Yt.prototype);gx.prototype.constructor=gx;function wv(t,e,n,r,i,s){wt.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:i,q:s},t=t||1,e=e||.4,n=Math.floor(n)||64,r=Math.floor(r)||8,i=i||2,s=s||3;var o=[],a=[],l=[],c=[],u,h,f=new j,d=new j,p=new j,m=new j,v=new j,y=new j,w=new j;for(u=0;u<=n;++u){var x=u/n*i*Math.PI*2;for(D(x,i,s,t,p),D(x+.01,i,s,t,m),y.subVectors(m,p),w.addVectors(m,p),v.crossVectors(y,w),w.crossVectors(v,y),v.normalize(),w.normalize(),h=0;h<=r;++h){var _=h/r*Math.PI*2,S=-e*Math.cos(_),T=e*Math.sin(_);f.x=p.x+(S*w.x+T*v.x),f.y=p.y+(S*w.y+T*v.y),f.z=p.z+(S*w.z+T*v.z),a.push(f.x,f.y,f.z),d.subVectors(f,p).normalize(),l.push(d.x,d.y,d.z),c.push(u/n),c.push(h/r)}}for(h=1;h<=n;h++)for(u=1;u<=r;u++){var E=(r+1)*(h-1)+(u-1),k=(r+1)*h+(u-1),A=(r+1)*h+u,M=(r+1)*(h-1)+u;o.push(E,k,M),o.push(k,A,M)}this.setIndex(o),this.setAttribute("position",new ut(a,3)),this.setAttribute("normal",new ut(l,3)),this.setAttribute("uv",new ut(c,2));function D(P,N,R,F,O){var K=Math.cos(P),J=Math.sin(P),re=R/N*P,ae=Math.cos(re);O.x=F*(2+ae)*.5*K,O.y=F*(2+ae)*J*.5,O.z=F*Math.sin(re)*.5}}wv.prototype=Object.create(wt.prototype);wv.prototype.constructor=wv;function vx(t,e,n,r,i){Yt.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:i},this.fromBufferGeometry(new xv(t,e,n,r,i)),this.mergeVertices()}vx.prototype=Object.create(Yt.prototype);vx.prototype.constructor=vx;function xv(t,e,n,r,i){wt.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:i},t=t||1,e=e||.4,n=Math.floor(n)||8,r=Math.floor(r)||6,i=i||Math.PI*2;var s=[],o=[],a=[],l=[],c=new j,u=new j,h=new j,f,d;for(f=0;f<=n;f++)for(d=0;d<=r;d++){var p=d/r*i,m=f/n*Math.PI*2;u.x=(t+e*Math.cos(m))*Math.cos(p),u.y=(t+e*Math.cos(m))*Math.sin(p),u.z=e*Math.sin(m),o.push(u.x,u.y,u.z),c.x=t*Math.cos(p),c.y=t*Math.sin(p),h.subVectors(u,c).normalize(),a.push(h.x,h.y,h.z),l.push(d/r),l.push(f/n)}for(f=1;f<=n;f++)for(d=1;d<=r;d++){var v=(r+1)*f+d-1,y=(r+1)*(f-1)+d-1,w=(r+1)*(f-1)+d,x=(r+1)*f+d;s.push(v,y,x),s.push(y,w,x)}this.setIndex(s),this.setAttribute("position",new ut(o,3)),this.setAttribute("normal",new ut(a,3)),this.setAttribute("uv",new ut(l,2))}xv.prototype=Object.create(wt.prototype);xv.prototype.constructor=xv;var Dje={triangulate:function(t,e,n){n=n||2;var r=e&&e.length,i=r?e[0]*n:t.length,s=_X(t,0,i,n,!0),o=[];if(!s||s.next===s.prev)return o;var a,l,c,u,h,f,d;if(r&&(s=Bje(t,e,s,n)),t.length>80*n){a=c=t[0],l=u=t[1];for(var p=n;p<i;p+=n)h=t[p],f=t[p+1],h<a&&(a=h),f<l&&(l=f),h>c&&(c=h),f>u&&(u=f);d=Math.max(c-a,u-l),d=d!==0?1/d:0}return bx(s,o,n,a,l,d),o}};function _X(t,e,n,r,i){var s,o;if(i===Kje(t,e,n,r)>0)for(s=e;s<n;s+=r)o=TX(s,t[s],t[s+1],o);else for(s=n-r;s>=e;s-=r)o=TX(s,t[s],t[s+1],o);return o&&Td(o,o.next)&&(xx(o),o=o.next),o}function yx(t,e){if(!t)return t;e||(e=t);var n=t,r;do if(r=!1,!n.steiner&&(Td(n,n.next)||ss(n.prev,n,n.next)===0)){if(xx(n),n=e=n.prev,n===n.next)break;r=!0}else n=n.next;while(r||n!==e);return e}function bx(t,e,n,r,i,s,o){if(!!t){!o&&s&&Wje(t,r,i,s);for(var a=t,l,c;t.prev!==t.next;){if(l=t.prev,c=t.next,s?Oje(t,r,i,s):Pje(t)){e.push(l.i/n),e.push(t.i/n),e.push(c.i/n),xx(t),t=c.next,a=c.next;continue}if(t=c,t===a){o?o===1?(t=Fje(t,e,n),bx(t,e,n,r,i,s,2)):o===2&&Lje(t,e,n,r,i,s):bx(yx(t),e,n,r,i,s,1);break}}}}function Pje(t){var e=t.prev,n=t,r=t.next;if(ss(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(_v(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&ss(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Oje(t,e,n,r){var i=t.prev,s=t,o=t.next;if(ss(i,s,o)>=0)return!1;for(var a=i.x<s.x?i.x<o.x?i.x:o.x:s.x<o.x?s.x:o.x,l=i.y<s.y?i.y<o.y?i.y:o.y:s.y<o.y?s.y:o.y,c=i.x>s.x?i.x>o.x?i.x:o.x:s.x>o.x?s.x:o.x,u=i.y>s.y?i.y>o.y?i.y:o.y:s.y>o.y?s.y:o.y,h=aP(a,l,e,n,r),f=aP(c,u,e,n,r),d=t.prevZ,p=t.nextZ;d&&d.z>=h&&p&&p.z<=f;){if(d!==t.prev&&d!==t.next&&_v(i.x,i.y,s.x,s.y,o.x,o.y,d.x,d.y)&&ss(d.prev,d,d.next)>=0||(d=d.prevZ,p!==t.prev&&p!==t.next&&_v(i.x,i.y,s.x,s.y,o.x,o.y,p.x,p.y)&&ss(p.prev,p,p.next)>=0))return!1;p=p.nextZ}for(;d&&d.z>=h;){if(d!==t.prev&&d!==t.next&&_v(i.x,i.y,s.x,s.y,o.x,o.y,d.x,d.y)&&ss(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;p&&p.z<=f;){if(p!==t.prev&&p!==t.next&&_v(i.x,i.y,s.x,s.y,o.x,o.y,p.x,p.y)&&ss(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Fje(t,e,n){var r=t;do{var i=r.prev,s=r.next.next;!Td(i,s)&&SX(i,r,r.next,s)&&wx(i,s)&&wx(s,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(s.i/n),xx(r),xx(r.next),r=t=s),r=r.next}while(r!==t);return r}function Lje(t,e,n,r,i,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&jje(o,a)){var l=CX(o,a);o=yx(o,o.next),l=yx(l,l.next),bx(o,e,n,r,i,s),bx(l,e,n,r,i,s);return}a=a.next}o=o.next}while(o!==t)}function Bje(t,e,n,r){var i=[],s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*r,l=s<o-1?e[s+1]*r:t.length,c=_X(t,a,l,r,!1),c===c.next&&(c.steiner=!0),i.push(Hje(c));for(i.sort(zje),s=0;s<i.length;s++)Vje(i[s],n),n=yx(n,n.next);return n}function zje(t,e){return t.x-e.x}function Vje(t,e){if(e=Uje(t,e),e){var n=CX(e,t);yx(n,n.next)}}function Uje(t,e){var n=e,r=t.x,i=t.y,s=-1/0,o;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var a=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>s){if(s=a,a===r){if(i===n.y)return n;if(i===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!o)return null;if(r===s)return o.prev;var l=o,c=o.x,u=o.y,h=1/0,f;for(n=o.next;n!==l;)r>=n.x&&n.x>=c&&r!==n.x&&_v(i<u?r:s,i,c,u,i<u?s:r,i,n.x,n.y)&&(f=Math.abs(i-n.y)/(r-n.x),(f<h||f===h&&n.x>o.x)&&wx(n,t)&&(o=n,h=f)),n=n.next;return o}function Wje(t,e,n,r){var i=t;do i.z===null&&(i.z=aP(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,Gje(i)}function Gje(t){var e,n,r,i,s,o,a,l,c=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,r=n,a=0,e=0;e<c&&(a++,r=r.nextZ,!!r);e++);for(l=c;a>0||l>0&&r;)a!==0&&(l===0||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;n=r}s.nextZ=null,c*=2}while(o>1);return t}function aP(t,e,n,r,i){return t=32767*(t-n)*i,e=32767*(e-r)*i,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function Hje(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function _v(t,e,n,r,i,s,o,a){return(i-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(r-a)-(n-o)*(e-a)>=0&&(n-o)*(s-a)-(i-o)*(r-a)>=0}function jje(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!qje(t,e)&&wx(t,e)&&wx(e,t)&&Xje(t,e)}function ss(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Td(t,e){return t.x===e.x&&t.y===e.y}function SX(t,e,n,r){return Td(t,n)&&Td(e,r)||Td(t,r)&&Td(n,e)?!0:ss(t,e,n)>0!=ss(t,e,r)>0&&ss(n,r,t)>0!=ss(n,r,e)>0}function qje(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&SX(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function wx(t,e){return ss(t.prev,t,t.next)<0?ss(t,e,t.next)>=0&&ss(t,t.prev,e)>=0:ss(t,e,t.prev)<0||ss(t,t.next,e)<0}function Xje(t,e){var n=t,r=!1,i=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==t);return r}function CX(t,e){var n=new lP(t.i,t.x,t.y),r=new lP(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function TX(t,e,n,r){var i=new lP(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function xx(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function lP(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Kje(t,e,n,r){for(var i=0,s=e,o=n-r;s<n;s+=r)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}var uu={area:function(t){for(var e=t.length,n=0,r=e-1,i=0;i<e;r=i++)n+=t[r].x*t[i].y-t[i].x*t[r].y;return n*.5},isClockWise:function(t){return uu.area(t)<0},triangulateShape:function(t,e){var n=[],r=[],i=[];EX(t),kX(n,t);var s=t.length;e.forEach(EX);for(var o=0;o<e.length;o++)r.push(s),s+=e[o].length,kX(n,e[o]);for(var a=Dje.triangulate(n,r),o=0;o<a.length;o+=3)i.push(a.slice(o,o+3));return i}};function EX(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function kX(t,e){for(var n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}function Ed(t,e){Yt.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new lc(t,e)),this.mergeVertices()}Ed.prototype=Object.create(Yt.prototype);Ed.prototype.constructor=Ed;Ed.prototype.toJSON=function(){var t=Yt.prototype.toJSON.call(this),e=this.parameters.shapes,n=this.parameters.options;return AX(e,n,t)};function lc(t,e){wt.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];for(var n=this,r=[],i=[],s=0,o=t.length;s<o;s++){var a=t[s];l(a)}this.setAttribute("position",new ut(r,3)),this.setAttribute("uv",new ut(i,2)),this.computeVertexNormals();function l(c){var u=[],h=e.curveSegments!==void 0?e.curveSegments:12,f=e.steps!==void 0?e.steps:1,d=e.depth!==void 0?e.depth:100,p=e.bevelEnabled!==void 0?e.bevelEnabled:!0,m=e.bevelThickness!==void 0?e.bevelThickness:6,v=e.bevelSize!==void 0?e.bevelSize:m-2,y=e.bevelOffset!==void 0?e.bevelOffset:0,w=e.bevelSegments!==void 0?e.bevelSegments:3,x=e.extrudePath,_=e.UVGenerator!==void 0?e.UVGenerator:Yje;e.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),d=e.amount);var S,T=!1,E,k,A,M;x&&(S=x.getSpacedPoints(f),T=!0,p=!1,E=x.computeFrenetFrames(f,!1),k=new j,A=new j,M=new j),p||(w=0,m=0,v=0,y=0);var D,P,N,R=c.extractPoints(h),F=R.shape,O=R.holes,K=!uu.isClockWise(F);if(K)for(F=F.reverse(),P=0,N=O.length;P<N;P++)D=O[P],uu.isClockWise(D)&&(O[P]=D.reverse());var J=uu.triangulateShape(F,O),re=F;for(P=0,N=O.length;P<N;P++)D=O[P],F=F.concat(D);function ae(Ke,lt,it){return lt||console.error("THREE.ExtrudeGeometry: vec does not exist"),lt.clone().multiplyScalar(it).add(Ke)}var pe,ke,Te,Ne,we,me=F.length,He,Fe=J.length;function je(Ke,lt,it){var ce,qe,bt,Ot=Ke.x-lt.x,gt=Ke.y-lt.y,dn=it.x-Ke.x,Kn=it.y-Ke.y,ur=Ot*Ot+gt*gt,go=Ot*Kn-gt*dn;if(Math.abs(go)>Number.EPSILON){var Yn=Math.sqrt(ur),Ds=Math.sqrt(dn*dn+Kn*Kn),Li=lt.x-gt/Yn,wc=lt.y+Ot/Yn,vo=it.x-Kn/Ds,tp=it.y+dn/Ds,qs=((vo-Li)*Kn-(tp-wc)*dn)/(Ot*Kn-gt*dn);ce=Li+Ot*qs-Ke.x,qe=wc+gt*qs-Ke.y;var np=ce*ce+qe*qe;if(np<=2)return new $e(ce,qe);bt=Math.sqrt(np/2)}else{var xc=!1;Ot>Number.EPSILON?dn>Number.EPSILON&&(xc=!0):Ot<-Number.EPSILON?dn<-Number.EPSILON&&(xc=!0):Math.sign(gt)===Math.sign(Kn)&&(xc=!0),xc?(ce=-gt,qe=Ot,bt=Math.sqrt(ur)):(ce=Ot,qe=gt,bt=Math.sqrt(ur/2))}return new $e(ce/bt,qe/bt)}for(var Ve=[],Se=0,nt=re.length,Ct=nt-1,pt=Se+1;Se<nt;Se++,Ct++,pt++)Ct===nt&&(Ct=0),pt===nt&&(pt=0),Ve[Se]=je(re[Se],re[Ct],re[pt]);var Ht=[],Mt,q=Ve.concat();for(P=0,N=O.length;P<N;P++){for(D=O[P],Mt=[],Se=0,nt=D.length,Ct=nt-1,pt=Se+1;Se<nt;Se++,Ct++,pt++)Ct===nt&&(Ct=0),pt===nt&&(pt=0),Mt[Se]=je(D[Se],D[Ct],D[pt]);Ht.push(Mt),q=q.concat(Mt)}for(pe=0;pe<w;pe++){for(Te=pe/w,Ne=m*Math.cos(Te*Math.PI/2),ke=v*Math.sin(Te*Math.PI/2)+y,Se=0,nt=re.length;Se<nt;Se++)we=ae(re[Se],Ve[Se],ke),st(we.x,we.y,-Ne);for(P=0,N=O.length;P<N;P++)for(D=O[P],Mt=Ht[P],Se=0,nt=D.length;Se<nt;Se++)we=ae(D[Se],Mt[Se],ke),st(we.x,we.y,-Ne)}for(ke=v+y,Se=0;Se<me;Se++)we=p?ae(F[Se],q[Se],ke):F[Se],T?(A.copy(E.normals[0]).multiplyScalar(we.x),k.copy(E.binormals[0]).multiplyScalar(we.y),M.copy(S[0]).add(A).add(k),st(M.x,M.y,M.z)):st(we.x,we.y,0);var Y;for(Y=1;Y<=f;Y++)for(Se=0;Se<me;Se++)we=p?ae(F[Se],q[Se],ke):F[Se],T?(A.copy(E.normals[Y]).multiplyScalar(we.x),k.copy(E.binormals[Y]).multiplyScalar(we.y),M.copy(S[Y]).add(A).add(k),st(M.x,M.y,M.z)):st(we.x,we.y,d/f*Y);for(pe=w-1;pe>=0;pe--){for(Te=pe/w,Ne=m*Math.cos(Te*Math.PI/2),ke=v*Math.sin(Te*Math.PI/2)+y,Se=0,nt=re.length;Se<nt;Se++)we=ae(re[Se],Ve[Se],ke),st(we.x,we.y,d+Ne);for(P=0,N=O.length;P<N;P++)for(D=O[P],Mt=Ht[P],Se=0,nt=D.length;Se<nt;Se++)we=ae(D[Se],Mt[Se],ke),T?st(we.x,we.y+S[f-1].y,S[f-1].x+Ne):st(we.x,we.y,d+Ne)}Xe(),Re();function Xe(){var Ke=r.length/3;if(p){var lt=0,it=me*lt;for(Se=0;Se<Fe;Se++)He=J[Se],ee(He[2]+it,He[1]+it,He[0]+it);for(lt=f+w*2,it=me*lt,Se=0;Se<Fe;Se++)He=J[Se],ee(He[0]+it,He[1]+it,He[2]+it)}else{for(Se=0;Se<Fe;Se++)He=J[Se],ee(He[2],He[1],He[0]);for(Se=0;Se<Fe;Se++)He=J[Se],ee(He[0]+me*f,He[1]+me*f,He[2]+me*f)}n.addGroup(Ke,r.length/3-Ke,0)}function Re(){var Ke=r.length/3,lt=0;for(Et(re,lt),lt+=re.length,P=0,N=O.length;P<N;P++)D=O[P],Et(D,lt),lt+=D.length;n.addGroup(Ke,r.length/3-Ke,1)}function Et(Ke,lt){var it,ce;for(Se=Ke.length;--Se>=0;){it=Se,ce=Se-1,ce<0&&(ce=Ke.length-1);var qe=0,bt=f+w*2;for(qe=0;qe<bt;qe++){var Ot=me*qe,gt=me*(qe+1),dn=lt+it+Ot,Kn=lt+ce+Ot,ur=lt+ce+gt,go=lt+it+gt;We(dn,Kn,ur,go)}}}function st(Ke,lt,it){u.push(Ke),u.push(lt),u.push(it)}function ee(Ke,lt,it){ot(Ke),ot(lt),ot(it);var ce=r.length/3,qe=_.generateTopUV(n,r,ce-3,ce-2,ce-1);rt(qe[0]),rt(qe[1]),rt(qe[2])}function We(Ke,lt,it,ce){ot(Ke),ot(lt),ot(ce),ot(lt),ot(it),ot(ce);var qe=r.length/3,bt=_.generateSideWallUV(n,r,qe-6,qe-3,qe-2,qe-1);rt(bt[0]),rt(bt[1]),rt(bt[3]),rt(bt[1]),rt(bt[2]),rt(bt[3])}function ot(Ke){r.push(u[Ke*3+0]),r.push(u[Ke*3+1]),r.push(u[Ke*3+2])}function rt(Ke){i.push(Ke.x),i.push(Ke.y)}}}lc.prototype=Object.create(wt.prototype);lc.prototype.constructor=lc;lc.prototype.toJSON=function(){var t=wt.prototype.toJSON.call(this),e=this.parameters.shapes,n=this.parameters.options;return AX(e,n,t)};var Yje={generateTopUV:function(t,e,n,r,i){var s=e[n*3],o=e[n*3+1],a=e[r*3],l=e[r*3+1],c=e[i*3],u=e[i*3+1];return[new $e(s,o),new $e(a,l),new $e(c,u)]},generateSideWallUV:function(t,e,n,r,i,s){var o=e[n*3],a=e[n*3+1],l=e[n*3+2],c=e[r*3],u=e[r*3+1],h=e[r*3+2],f=e[i*3],d=e[i*3+1],p=e[i*3+2],m=e[s*3],v=e[s*3+1],y=e[s*3+2];return Math.abs(a-u)<.01?[new $e(o,1-l),new $e(c,1-h),new $e(f,1-p),new $e(m,1-y)]:[new $e(a,1-l),new $e(u,1-h),new $e(d,1-p),new $e(v,1-y)]}};function AX(t,e,n){if(n.shapes=[],Array.isArray(t))for(var r=0,i=t.length;r<i;r++){var s=t[r];n.shapes.push(s.uuid)}else n.shapes.push(t.uuid);return e.extrudePath!==void 0&&(n.options.extrudePath=e.extrudePath.toJSON()),n}function _x(t,e){Yt.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new Sv(t,e)),this.mergeVertices()}_x.prototype=Object.create(Yt.prototype);_x.prototype.constructor=_x;function Sv(t,e){e=e||{};var n=e.font;if(!(n&&n.isFont))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Yt;var r=n.generateShapes(t,e.size);e.depth=e.height!==void 0?e.height:50,e.bevelThickness===void 0&&(e.bevelThickness=10),e.bevelSize===void 0&&(e.bevelSize=8),e.bevelEnabled===void 0&&(e.bevelEnabled=!1),lc.call(this,r,e),this.type="TextBufferGeometry"}Sv.prototype=Object.create(lc.prototype);Sv.prototype.constructor=Sv;function Sx(t,e,n,r,i,s,o){Yt.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:s,thetaLength:o},this.fromBufferGeometry(new kd(t,e,n,r,i,s,o)),this.mergeVertices()}Sx.prototype=Object.create(Yt.prototype);Sx.prototype.constructor=Sx;function kd(t,e,n,r,i,s,o){wt.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:s,thetaLength:o},t=t||1,e=Math.max(3,Math.floor(e)||8),n=Math.max(2,Math.floor(n)||6),r=r!==void 0?r:0,i=i!==void 0?i:Math.PI*2,s=s!==void 0?s:0,o=o!==void 0?o:Math.PI;var a=Math.min(s+o,Math.PI),l,c,u=0,h=[],f=new j,d=new j,p=[],m=[],v=[],y=[];for(c=0;c<=n;c++){var w=[],x=c/n,_=0;for(c==0&&s==0?_=.5/e:c==n&&a==Math.PI&&(_=-.5/e),l=0;l<=e;l++){var S=l/e;f.x=-t*Math.cos(r+S*i)*Math.sin(s+x*o),f.y=t*Math.cos(s+x*o),f.z=t*Math.sin(r+S*i)*Math.sin(s+x*o),m.push(f.x,f.y,f.z),d.copy(f).normalize(),v.push(d.x,d.y,d.z),y.push(S+_,1-x),w.push(u++)}h.push(w)}for(c=0;c<n;c++)for(l=0;l<e;l++){var T=h[c][l+1],E=h[c][l],k=h[c+1][l],A=h[c+1][l+1];(c!==0||s>0)&&p.push(T,E,A),(c!==n-1||a<Math.PI)&&p.push(E,k,A)}this.setIndex(p),this.setAttribute("position",new ut(m,3)),this.setAttribute("normal",new ut(v,3)),this.setAttribute("uv",new ut(y,2))}kd.prototype=Object.create(wt.prototype);kd.prototype.constructor=kd;function Cx(t,e,n,r,i,s){Yt.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:s},this.fromBufferGeometry(new Cv(t,e,n,r,i,s)),this.mergeVertices()}Cx.prototype=Object.create(Yt.prototype);Cx.prototype.constructor=Cx;function Cv(t,e,n,r,i,s){wt.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:s},t=t||.5,e=e||1,i=i!==void 0?i:0,s=s!==void 0?s:Math.PI*2,n=n!==void 0?Math.max(3,n):8,r=r!==void 0?Math.max(1,r):1;var o=[],a=[],l=[],c=[],u,h=t,f=(e-t)/r,d=new j,p=new $e,m,v;for(m=0;m<=r;m++){for(v=0;v<=n;v++)u=i+v/n*s,d.x=h*Math.cos(u),d.y=h*Math.sin(u),a.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,c.push(p.x,p.y);h+=f}for(m=0;m<r;m++){var y=m*(n+1);for(v=0;v<n;v++){u=v+y;var w=u,x=u+n+1,_=u+n+2,S=u+1;o.push(w,x,S),o.push(x,_,S)}}this.setIndex(o),this.setAttribute("position",new ut(a,3)),this.setAttribute("normal",new ut(l,3)),this.setAttribute("uv",new ut(c,2))}Cv.prototype=Object.create(wt.prototype);Cv.prototype.constructor=Cv;function Tx(t,e,n,r){Yt.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:r},this.fromBufferGeometry(new Tv(t,e,n,r)),this.mergeVertices()}Tx.prototype=Object.create(Yt.prototype);Tx.prototype.constructor=Tx;function Tv(t,e,n,r){wt.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:r},e=Math.floor(e)||12,n=n||0,r=r||Math.PI*2,r=ln.clamp(r,0,Math.PI*2);var i=[],s=[],o=[],a,l=1/e,c=new j,u=new $e,h,f;for(h=0;h<=e;h++){var d=n+h*l*r,p=Math.sin(d),m=Math.cos(d);for(f=0;f<=t.length-1;f++)c.x=t[f].x*p,c.y=t[f].y,c.z=t[f].x*m,s.push(c.x,c.y,c.z),u.x=h/e,u.y=f/(t.length-1),o.push(u.x,u.y)}for(h=0;h<e;h++)for(f=0;f<t.length-1;f++){a=f+h*t.length;var v=a,y=a+t.length,w=a+t.length+1,x=a+1;i.push(v,y,x),i.push(y,w,x)}if(this.setIndex(i),this.setAttribute("position",new ut(s,3)),this.setAttribute("uv",new ut(o,2)),this.computeVertexNormals(),r===Math.PI*2){var _=this.attributes.normal.array,S=new j,T=new j,E=new j;for(a=e*t.length*3,h=0,f=0;h<t.length;h++,f+=3)S.x=_[f+0],S.y=_[f+1],S.z=_[f+2],T.x=_[a+f+0],T.y=_[a+f+1],T.z=_[a+f+2],E.addVectors(S,T).normalize(),_[f+0]=_[a+f+0]=E.x,_[f+1]=_[a+f+1]=E.y,_[f+2]=_[a+f+2]=E.z}}Tv.prototype=Object.create(wt.prototype);Tv.prototype.constructor=Tv;function Ad(t,e){Yt.call(this),this.type="ShapeGeometry",typeof e=="object"&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new Md(t,e)),this.mergeVertices()}Ad.prototype=Object.create(Yt.prototype);Ad.prototype.constructor=Ad;Ad.prototype.toJSON=function(){var t=Yt.prototype.toJSON.call(this),e=this.parameters.shapes;return MX(e,t)};function Md(t,e){wt.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var n=[],r=[],i=[],s=[],o=0,a=0;if(Array.isArray(t)===!1)c(t);else for(var l=0;l<t.length;l++)c(t[l]),this.addGroup(o,a,l),o+=a,a=0;this.setIndex(n),this.setAttribute("position",new ut(r,3)),this.setAttribute("normal",new ut(i,3)),this.setAttribute("uv",new ut(s,2));function c(u){var h,f,d,p=r.length/3,m=u.extractPoints(e),v=m.shape,y=m.holes;for(uu.isClockWise(v)===!1&&(v=v.reverse()),h=0,f=y.length;h<f;h++)d=y[h],uu.isClockWise(d)===!0&&(y[h]=d.reverse());var w=uu.triangulateShape(v,y);for(h=0,f=y.length;h<f;h++)d=y[h],v=v.concat(d);for(h=0,f=v.length;h<f;h++){var x=v[h];r.push(x.x,x.y,0),i.push(0,0,1),s.push(x.x,x.y)}for(h=0,f=w.length;h<f;h++){var _=w[h],S=_[0]+p,T=_[1]+p,E=_[2]+p;n.push(S,T,E),a+=3}}}Md.prototype=Object.create(wt.prototype);Md.prototype.constructor=Md;Md.prototype.toJSON=function(){var t=wt.prototype.toJSON.call(this),e=this.parameters.shapes;return MX(e,t)};function MX(t,e){if(e.shapes=[],Array.isArray(t))for(var n=0,r=t.length;n<r;n++){var i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}function Ev(t,e){wt.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=e!==void 0?e:1;var n=[],r=Math.cos(ln.DEG2RAD*e),i=[0,0],s={},o,a,l,c=["a","b","c"],u;t.isBufferGeometry?(u=new Yt,u.fromBufferGeometry(t)):u=t.clone(),u.mergeVertices(),u.computeFaceNormals();for(var h=u.vertices,f=u.faces,d=0,p=f.length;d<p;d++)for(var m=f[d],v=0;v<3;v++)o=m[c[v]],a=m[c[(v+1)%3]],i[0]=Math.min(o,a),i[1]=Math.max(o,a),l=i[0]+","+i[1],s[l]===void 0?s[l]={index1:i[0],index2:i[1],face1:d,face2:void 0}:s[l].face2=d;for(l in s){var y=s[l];if(y.face2===void 0||f[y.face1].normal.dot(f[y.face2].normal)<=r){var w=h[y.index1];n.push(w.x,w.y,w.z),w=h[y.index2],n.push(w.x,w.y,w.z)}}this.setAttribute("position",new ut(n,3))}Ev.prototype=Object.create(wt.prototype);Ev.prototype.constructor=Ev;function Id(t,e,n,r,i,s,o,a){Yt.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:s,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new hu(t,e,n,r,i,s,o,a)),this.mergeVertices()}Id.prototype=Object.create(Yt.prototype);Id.prototype.constructor=Id;function hu(t,e,n,r,i,s,o,a){wt.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:s,thetaStart:o,thetaLength:a};var l=this;t=t!==void 0?t:1,e=e!==void 0?e:1,n=n||1,r=Math.floor(r)||8,i=Math.floor(i)||1,s=s!==void 0?s:!1,o=o!==void 0?o:0,a=a!==void 0?a:Math.PI*2;var c=[],u=[],h=[],f=[],d=0,p=[],m=n/2,v=0;y(),s===!1&&(t>0&&w(!0),e>0&&w(!1)),this.setIndex(c),this.setAttribute("position",new ut(u,3)),this.setAttribute("normal",new ut(h,3)),this.setAttribute("uv",new ut(f,2));function y(){var x,_,S=new j,T=new j,E=0,k=(e-t)/n;for(_=0;_<=i;_++){var A=[],M=_/i,D=M*(e-t)+t;for(x=0;x<=r;x++){var P=x/r,N=P*a+o,R=Math.sin(N),F=Math.cos(N);T.x=D*R,T.y=-M*n+m,T.z=D*F,u.push(T.x,T.y,T.z),S.set(R,k,F).normalize(),h.push(S.x,S.y,S.z),f.push(P,1-M),A.push(d++)}p.push(A)}for(x=0;x<r;x++)for(_=0;_<i;_++){var O=p[_][x],K=p[_+1][x],J=p[_+1][x+1],re=p[_][x+1];c.push(O,K,re),c.push(K,J,re),E+=6}l.addGroup(v,E,0),v+=E}function w(x){var _,S,T,E=new $e,k=new j,A=0,M=x===!0?t:e,D=x===!0?1:-1;for(S=d,_=1;_<=r;_++)u.push(0,m*D,0),h.push(0,D,0),f.push(.5,.5),d++;for(T=d,_=0;_<=r;_++){var P=_/r,N=P*a+o,R=Math.cos(N),F=Math.sin(N);k.x=M*F,k.y=m*D,k.z=M*R,u.push(k.x,k.y,k.z),h.push(0,D,0),E.x=R*.5+.5,E.y=F*.5*D+.5,f.push(E.x,E.y),d++}for(_=0;_<r;_++){var O=S+_,K=T+_;x===!0?c.push(K,K+1,O):c.push(K+1,K,O),A+=3}l.addGroup(v,A,x===!0?1:2),v+=A}}hu.prototype=Object.create(wt.prototype);hu.prototype.constructor=hu;function Ex(t,e,n,r,i,s,o){Id.call(this,0,t,e,n,r,i,s,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:s,thetaLength:o}}Ex.prototype=Object.create(Id.prototype);Ex.prototype.constructor=Ex;function kx(t,e,n,r,i,s,o){hu.call(this,0,t,e,n,r,i,s,o),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:s,thetaLength:o}}kx.prototype=Object.create(hu.prototype);kx.prototype.constructor=kx;function Ax(t,e,n,r){Yt.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},this.fromBufferGeometry(new kv(t,e,n,r)),this.mergeVertices()}Ax.prototype=Object.create(Yt.prototype);Ax.prototype.constructor=Ax;function kv(t,e,n,r){wt.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},t=t||1,e=e!==void 0?Math.max(3,e):8,n=n!==void 0?n:0,r=r!==void 0?r:Math.PI*2;var i=[],s=[],o=[],a=[],l,c,u=new j,h=new $e;for(s.push(0,0,0),o.push(0,0,1),a.push(.5,.5),c=0,l=3;c<=e;c++,l+=3){var f=n+c/e*r;u.x=t*Math.cos(f),u.y=t*Math.sin(f),s.push(u.x,u.y,u.z),o.push(0,0,1),h.x=(s[l]/t+1)/2,h.y=(s[l+1]/t+1)/2,a.push(h.x,h.y)}for(l=1;l<=e;l++)i.push(l,l+1,0);this.setIndex(i),this.setAttribute("position",new ut(s,3)),this.setAttribute("normal",new ut(o,3)),this.setAttribute("uv",new ut(a,2))}kv.prototype=Object.create(wt.prototype);kv.prototype.constructor=kv;var Hs=Object.freeze({__proto__:null,WireframeGeometry:mv,ParametricGeometry:cx,ParametricBufferGeometry:gv,TetrahedronGeometry:hx,TetrahedronBufferGeometry:vv,OctahedronGeometry:fx,OctahedronBufferGeometry:Sd,IcosahedronGeometry:dx,IcosahedronBufferGeometry:yv,DodecahedronGeometry:px,DodecahedronBufferGeometry:bv,PolyhedronGeometry:ux,PolyhedronBufferGeometry:po,TubeGeometry:mx,TubeBufferGeometry:Cd,TorusKnotGeometry:gx,TorusKnotBufferGeometry:wv,TorusGeometry:vx,TorusBufferGeometry:xv,TextGeometry:_x,TextBufferGeometry:Sv,SphereGeometry:Sx,SphereBufferGeometry:kd,RingGeometry:Cx,RingBufferGeometry:Cv,PlaneGeometry:Yw,PlaneBufferGeometry:xd,LatheGeometry:Tx,LatheBufferGeometry:Tv,ShapeGeometry:Ad,ShapeBufferGeometry:Md,ExtrudeGeometry:Ed,ExtrudeBufferGeometry:lc,EdgesGeometry:Ev,ConeGeometry:Ex,ConeBufferGeometry:kx,CylinderGeometry:Id,CylinderBufferGeometry:hu,CircleGeometry:Ax,CircleBufferGeometry:kv,BoxGeometry:Z3,BoxBufferGeometry:Kw});function Nd(t){jt.call(this),this.type="ShadowMaterial",this.color=new yt(0),this.transparent=!0,this.setValues(t)}Nd.prototype=Object.create(jt.prototype);Nd.prototype.constructor=Nd;Nd.prototype.isShadowMaterial=!0;Nd.prototype.copy=function(t){return jt.prototype.copy.call(this,t),this.color.copy(t.color),this};function fu(t){Gs.call(this,t),this.type="RawShaderMaterial"}fu.prototype=Object.create(Gs.prototype);fu.prototype.constructor=fu;fu.prototype.isRawShaderMaterial=!0;function cc(t){jt.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new yt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new yt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ld,this.normalScale=new $e(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}cc.prototype=Object.create(jt.prototype);cc.prototype.constructor=cc;cc.prototype.isMeshStandardMaterial=!0;cc.prototype.copy=function(t){return jt.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this};function $d(t){cc.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.sheen=null,this.clearcoatNormalScale=new $e(1,1),this.clearcoatNormalMap=null,this.transparency=0,this.setValues(t)}$d.prototype=Object.create(cc.prototype);$d.prototype.constructor=$d;$d.prototype.isMeshPhysicalMaterial=!0;$d.prototype.copy=function(t){return cc.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.reflectivity=t.reflectivity,this.clearcoat=t.clearcoat,this.clearcoatRoughness=t.clearcoatRoughness,t.sheen?this.sheen=(this.sheen||new yt).copy(t.sheen):this.sheen=null,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.transparency=t.transparency,this};function Dh(t){jt.call(this),this.type="MeshPhongMaterial",this.color=new yt(16777215),this.specular=new yt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new yt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ld,this.normalScale=new $e(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Tw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}Dh.prototype=Object.create(jt.prototype);Dh.prototype.constructor=Dh;Dh.prototype.isMeshPhongMaterial=!0;Dh.prototype.copy=function(t){return jt.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this};function Rd(t){jt.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new yt(16777215),this.specular=new yt(1118481),this.shininess=30,this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new yt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ld,this.normalScale=new $e(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}Rd.prototype=Object.create(jt.prototype);Rd.prototype.constructor=Rd;Rd.prototype.isMeshToonMaterial=!0;Rd.prototype.copy=function(t){return jt.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this};function Dd(t){jt.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ld,this.normalScale=new $e(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}Dd.prototype=Object.create(jt.prototype);Dd.prototype.constructor=Dd;Dd.prototype.isMeshNormalMaterial=!0;Dd.prototype.copy=function(t){return jt.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this};function Pd(t){jt.call(this),this.type="MeshLambertMaterial",this.color=new yt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new yt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Tw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}Pd.prototype=Object.create(jt.prototype);Pd.prototype.constructor=Pd;Pd.prototype.isMeshLambertMaterial=!0;Pd.prototype.copy=function(t){return jt.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this};function Od(t){jt.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new yt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ld,this.normalScale=new $e(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}Od.prototype=Object.create(jt.prototype);Od.prototype.constructor=Od;Od.prototype.isMeshMatcapMaterial=!0;Od.prototype.copy=function(t){return jt.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this};function Fd(t){Fr.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}Fd.prototype=Object.create(Fr.prototype);Fd.prototype.constructor=Fd;Fd.prototype.isLineDashedMaterial=!0;Fd.prototype.copy=function(t){return Fr.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var Zje=Object.freeze({__proto__:null,ShadowMaterial:Nd,SpriteMaterial:Rh,RawShaderMaterial:fu,ShaderMaterial:Gs,PointsMaterial:wl,MeshPhysicalMaterial:$d,MeshStandardMaterial:cc,MeshPhongMaterial:Dh,MeshToonMaterial:Rd,MeshNormalMaterial:Dd,MeshLambertMaterial:Pd,MeshDepthMaterial:Nh,MeshDistanceMaterial:$h,MeshBasicMaterial:Ma,MeshMatcapMaterial:Od,LineDashedMaterial:Fd,LineBasicMaterial:Fr,Material:jt}),Xr={arraySlice:function(t,e,n){return Xr.isTypedArray(t)?new t.constructor(t.subarray(e,n!==void 0?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:typeof e.BYTES_PER_ELEMENT=="number"?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){function e(s,o){return t[s]-t[o]}for(var n=t.length,r=new Array(n),i=0;i!==n;++i)r[i]=i;return r.sort(e),r},sortedArray:function(t,e,n){for(var r=t.length,i=new t.constructor(r),s=0,o=0;o!==r;++s)for(var a=n[s]*e,l=0;l!==e;++l)i[o++]=t[a+l];return i},flattenJSON:function(t,e,n,r){for(var i=1,s=t[0];s!==void 0&&s[r]===void 0;)s=t[i++];if(s!==void 0){var o=s[r];if(o!==void 0)if(Array.isArray(o))do o=s[r],o!==void 0&&(e.push(s.time),n.push.apply(n,o)),s=t[i++];while(s!==void 0);else if(o.toArray!==void 0)do o=s[r],o!==void 0&&(e.push(s.time),o.toArray(n,n.length)),s=t[i++];while(s!==void 0);else do o=s[r],o!==void 0&&(e.push(s.time),n.push(o)),s=t[i++];while(s!==void 0)}},subclip:function(t,e,n,r,i){i=i||30;var s=t.clone();s.name=e;for(var o=[],a=0;a<s.tracks.length;++a){for(var l=s.tracks[a],c=l.getValueSize(),u=[],h=[],f=0;f<l.times.length;++f){var d=l.times[f]*i;if(!(d<n||d>=r)){u.push(l.times[f]);for(var p=0;p<c;++p)h.push(l.values[f*c+p])}}u.length!==0&&(l.times=Xr.convertArray(u,l.times.constructor),l.values=Xr.convertArray(h,l.values.constructor),o.push(l))}s.tracks=o;for(var m=1/0,a=0;a<s.tracks.length;++a)m>s.tracks[a].times[0]&&(m=s.tracks[a].times[0]);for(var a=0;a<s.tracks.length;++a)s.tracks[a].shift(-1*m);return s.resetDuration(),s}};function Go(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n}Object.assign(Go.prototype,{evaluate:function(t){var e=this.parameterPositions,n=this._cachedIndex,r=e[n],i=e[n-1];e:{t:{var s;n:{r:if(!(t<r)){for(var o=n+2;;){if(r===void 0){if(t<i)break r;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,i)}if(n===o)break;if(i=r,r=e[++n],t<r)break t}s=e.length;break n}if(!(t>=i)){var a=e[1];t<a&&(n=2,i=a);for(var o=n-2;;){if(i===void 0)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(n===o)break;if(r=i,i=e[--n-1],t>=i)break t}s=n,n=0;break n}break e}for(;n<s;){var l=n+s>>>1;t<e[l]?s=l:n=l+1}if(r=e[n],i=e[n-1],i===void 0)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(r===void 0)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,i,t)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r,s=0;s!==r;++s)e[s]=n[i+s];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}});//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(Go.prototype,{beforeStart_:Go.prototype.copySampleValue_,afterEnd_:Go.prototype.copySampleValue_});function AE(t,e,n,r){Go.call(this,t,e,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}AE.prototype=Object.assign(Object.create(Go.prototype),{constructor:AE,DefaultSettings_:{endingStart:od,endingEnd:od},intervalChanged_:function(t,e,n){var r=this.parameterPositions,i=t-2,s=t+1,o=r[i],a=r[s];if(o===void 0)switch(this.getSettings_().endingStart){case ad:i=t,o=2*e-n;break;case Pw:i=r.length-2,o=e+r[i]-r[i+1];break;default:i=t,o=n}if(a===void 0)switch(this.getSettings_().endingEnd){case ad:s=t,a=2*n-e;break;case Pw:s=1,a=n+r[1]-r[0];break;default:s=t-1,a=e}var l=(n-e)*.5,c=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(a-n),this._offsetPrev=i*c,this._offsetNext=s*c},interpolate_:function(t,e,n,r){for(var i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,f=this._weightNext,d=(n-e)/(r-e),p=d*d,m=p*d,v=-h*m+2*h*p-h*d,y=(1+h)*m+(-1.5-2*h)*p+(-.5+h)*d+1,w=(-1-f)*m+(1.5+f)*p+.5*d,x=f*m-f*p,_=0;_!==o;++_)i[_]=v*s[c+_]+y*s[l+_]+w*s[a+_]+x*s[u+_];return i}});function Mx(t,e,n,r){Go.call(this,t,e,n,r)}Mx.prototype=Object.assign(Object.create(Go.prototype),{constructor:Mx,interpolate_:function(t,e,n,r){for(var i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=(n-e)/(r-e),u=1-c,h=0;h!==o;++h)i[h]=s[l+h]*u+s[a+h]*c;return i}});function ME(t,e,n,r){Go.call(this,t,e,n,r)}ME.prototype=Object.assign(Object.create(Go.prototype),{constructor:ME,interpolate_:function(t){return this.copySampleValue_(t-1)}});function os(t,e,n,r){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Xr.convertArray(e,this.TimeBufferType),this.values=Xr.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}Object.assign(os,{toJSON:function(t){var e=t.constructor,n;if(e.toJSON!==void 0)n=e.toJSON(t);else{n={name:t.name,times:Xr.convertArray(t.times,Array),values:Xr.convertArray(t.values,Array)};var r=t.getInterpolation();r!==t.DefaultInterpolation&&(n.interpolation=r)}return n.type=t.ValueTypeName,n}});Object.assign(os.prototype,{constructor:os,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Dw,InterpolantFactoryMethodDiscrete:function(t){return new ME(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new Mx(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new AE(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case Rw:e=this.InterpolantFactoryMethodDiscrete;break;case Dw:e=this.InterpolantFactoryMethodLinear;break;case qT:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Rw;case this.InterpolantFactoryMethodLinear:return Dw;case this.InterpolantFactoryMethodSmooth:return qT}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(t!==0)for(var e=this.times,n=0,r=e.length;n!==r;++n)e[n]+=t;return this},scale:function(t){if(t!==1)for(var e=this.times,n=0,r=e.length;n!==r;++n)e[n]*=t;return this},trim:function(t,e){for(var n=this.times,r=n.length,i=0,s=r-1;i!==r&&n[i]<t;)++i;for(;s!==-1&&n[s]>e;)--s;if(++s,i!==0||s!==r){i>=s&&(s=Math.max(s,1),i=s-1);var o=this.getValueSize();this.times=Xr.arraySlice(n,i,s),this.values=Xr.arraySlice(this.values,i*o,s*o)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var n=this.times,r=this.values,i=n.length;i===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var s=null,o=0;o!==i;o++){var a=n[o];if(typeof a=="number"&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,a),t=!1;break}if(s!==null&&s>a){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,a,s),t=!1;break}s=a}if(r!==void 0&&Xr.isTypedArray(r))for(var o=0,l=r.length;o!==l;++o){var c=r[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c),t=!1;break}}return t},optimize:function(){for(var t=Xr.arraySlice(this.times),e=Xr.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===qT,i=1,s=t.length-1,o=1;o<s;++o){var a=!1,l=t[o],c=t[o+1];if(l!==c&&(o!==1||l!==l[0]))if(r)a=!0;else for(var u=o*n,h=u-n,f=u+n,d=0;d!==n;++d){var p=e[u+d];if(p!==e[h+d]||p!==e[f+d]){a=!0;break}}if(a){if(o!==i){t[i]=t[o];for(var m=o*n,v=i*n,d=0;d!==n;++d)e[v+d]=e[m+d]}++i}}if(s>0){t[i]=t[s];for(var m=s*n,v=i*n,d=0;d!==n;++d)e[v+d]=e[m+d];++i}return i!==t.length?(this.times=Xr.arraySlice(t,0,i),this.values=Xr.arraySlice(e,0,i*n)):(this.times=t,this.values=e),this},clone:function(){var t=Xr.arraySlice(this.times,0),e=Xr.arraySlice(this.values,0),n=this.constructor,r=new n(this.name,t,e);return r.createInterpolant=this.createInterpolant,r}});function IE(t,e,n){os.call(this,t,e,n)}IE.prototype=Object.assign(Object.create(os.prototype),{constructor:IE,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Rw,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function NE(t,e,n,r){os.call(this,t,e,n,r)}NE.prototype=Object.assign(Object.create(os.prototype),{constructor:NE,ValueTypeName:"color"});function Av(t,e,n,r){os.call(this,t,e,n,r)}Av.prototype=Object.assign(Object.create(os.prototype),{constructor:Av,ValueTypeName:"number"});function $E(t,e,n,r){Go.call(this,t,e,n,r)}$E.prototype=Object.assign(Object.create(Go.prototype),{constructor:$E,interpolate_:function(t,e,n,r){for(var i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=(n-e)/(r-e),c=a+o;a!==c;a+=4)is.slerpFlat(i,0,s,a-o,s,a,l);return i}});function Ix(t,e,n,r){os.call(this,t,e,n,r)}Ix.prototype=Object.assign(Object.create(os.prototype),{constructor:Ix,ValueTypeName:"quaternion",DefaultInterpolation:Dw,InterpolantFactoryMethodLinear:function(t){return new $E(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0});function RE(t,e,n,r){os.call(this,t,e,n,r)}RE.prototype=Object.assign(Object.create(os.prototype),{constructor:RE,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Rw,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function Mv(t,e,n,r){os.call(this,t,e,n,r)}Mv.prototype=Object.assign(Object.create(os.prototype),{constructor:Mv,ValueTypeName:"vector"});function Na(t,e,n){this.name=t,this.tracks=n,this.duration=e!==void 0?e:-1,this.uuid=ln.generateUUID(),this.duration<0&&this.resetDuration()}function Jje(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Av;case"vector":case"vector2":case"vector3":case"vector4":return Mv;case"color":return NE;case"quaternion":return Ix;case"bool":case"boolean":return IE;case"string":return RE}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function Qje(t){if(t.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=Jje(t.type);if(t.times===void 0){var n=[],r=[];Xr.flattenJSON(t.keys,n,r,"value"),t.times=n,t.values=r}return e.parse!==void 0?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}Object.assign(Na,{parse:function(t){for(var e=[],n=t.tracks,r=1/(t.fps||1),i=0,s=n.length;i!==s;++i)e.push(Qje(n[i]).scale(r));return new Na(t.name,t.duration,e)},toJSON:function(t){for(var e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid},i=0,s=n.length;i!==s;++i)e.push(os.toJSON(n[i]));return r},CreateFromMorphTargetSequence:function(t,e,n,r){for(var i=e.length,s=[],o=0;o<i;o++){var a=[],l=[];a.push((o+i-1)%i,o,(o+1)%i),l.push(0,1,0);var c=Xr.getKeyframeOrder(a);a=Xr.sortedArray(a,1,c),l=Xr.sortedArray(l,1,c),!r&&a[0]===0&&(a.push(i),l.push(l[0])),s.push(new Av(".morphTargetInfluences["+e[o].name+"]",a,l).scale(1/n))}return new Na(t,-1,s)},findByName:function(t,e){var n=t;if(!Array.isArray(t)){var r=t;n=r.geometry&&r.geometry.animations||r.animations}for(var i=0;i<n.length;i++)if(n[i].name===e)return n[i];return null},CreateClipsFromMorphTargetSequences:function(t,e,n){for(var r={},i=/^([\w-]*?)([\d]+)$/,s=0,o=t.length;s<o;s++){var a=t[s],l=a.name.match(i);if(l&&l.length>1){var c=l[1],u=r[c];u||(r[c]=u=[]),u.push(a)}}var h=[];for(var c in r)h.push(Na.CreateFromMorphTargetSequence(c,r[c],e,n));return h},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(x,_,S,T,E){if(S.length!==0){var k=[],A=[];Xr.flattenJSON(S,k,A,T),k.length!==0&&E.push(new x(_,k,A))}},r=[],i=t.name||"default",s=t.length||-1,o=t.fps||30,a=t.hierarchy||[],l=0;l<a.length;l++){var c=a[l].keys;if(!(!c||c.length===0))if(c[0].morphTargets){for(var u={},h=0;h<c.length;h++)if(c[h].morphTargets)for(var f=0;f<c[h].morphTargets.length;f++)u[c[h].morphTargets[f]]=-1;for(var d in u){for(var p=[],m=[],f=0;f!==c[h].morphTargets.length;++f){var v=c[h];p.push(v.time),m.push(v.morphTarget===d?1:0)}r.push(new Av(".morphTargetInfluence["+d+"]",p,m))}s=u.length*(o||1)}else{var y=".bones["+e[l].name+"]";n(Mv,y+".position",c,"pos",r),n(Ix,y+".quaternion",c,"rot",r),n(Mv,y+".scale",c,"scl",r)}}if(r.length===0)return null;var w=new Na(i,s,r);return w}});Object.assign(Na.prototype,{resetDuration:function(){for(var t=this.tracks,e=0,n=0,r=t.length;n!==r;++n){var i=this.tracks[n];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new Na(this.name,this.duration,t)}});var Ld={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function cP(t,e,n){var r=this,i=!1,s=0,o=0,a=void 0,l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(c){o++,i===!1&&r.onStart!==void 0&&r.onStart(c,s,o),i=!0},this.itemEnd=function(c){s++,r.onProgress!==void 0&&r.onProgress(c,s,o),s===o&&(i=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(c){r.onError!==void 0&&r.onError(c)},this.resolveURL=function(c){return a?a(c):c},this.setURLModifier=function(c){return a=c,this},this.addHandler=function(c,u){return l.push(c,u),this},this.removeHandler=function(c){var u=l.indexOf(c);return u!==-1&&l.splice(u,2),this},this.getHandler=function(c){for(var u=0,h=l.length;u<h;u+=2){var f=l[u],d=l[u+1];if(f.global&&(f.lastIndex=0),f.test(c))return d}return null}}var IX=new cP;function Xn(t){this.manager=t!==void 0?t:IX,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(Xn.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this}});var xl={};function $a(t){Xn.call(this,t)}$a.prototype=Object.assign(Object.create(Xn.prototype),{constructor:$a,load:function(t,e,n,r){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,s=Ld.get(t);if(s!==void 0)return i.manager.itemStart(t),setTimeout(function(){e&&e(s),i.manager.itemEnd(t)},0),s;if(xl[t]!==void 0){xl[t].push({onLoad:e,onProgress:n,onError:r});return}var o=/^data:(.*?)(;base64)?,(.*)$/,a=t.match(o);if(a){var l=a[1],c=!!a[2],u=a[3];u=decodeURIComponent(u),c&&(u=atob(u));try{var h,f=(this.responseType||"").toLowerCase();switch(f){case"arraybuffer":case"blob":for(var d=new Uint8Array(u.length),p=0;p<u.length;p++)d[p]=u.charCodeAt(p);f==="blob"?h=new Blob([d.buffer],{type:l}):h=d.buffer;break;case"document":var m=new DOMParser;h=m.parseFromString(u,l);break;case"json":h=JSON.parse(u);break;default:h=u;break}setTimeout(function(){e&&e(h),i.manager.itemEnd(t)},0)}catch(w){setTimeout(function(){r&&r(w),i.manager.itemError(t),i.manager.itemEnd(t)},0)}}else{xl[t]=[],xl[t].push({onLoad:e,onProgress:n,onError:r});var v=new XMLHttpRequest;v.open("GET",t,!0),v.addEventListener("load",function(w){var x=this.response,_=xl[t];if(delete xl[t],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Ld.add(t,x);for(var S=0,T=_.length;S<T;S++){var E=_[S];E.onLoad&&E.onLoad(x)}i.manager.itemEnd(t)}else{for(var S=0,T=_.length;S<T;S++){var E=_[S];E.onError&&E.onError(w)}i.manager.itemError(t),i.manager.itemEnd(t)}},!1),v.addEventListener("progress",function(w){for(var x=xl[t],_=0,S=x.length;_<S;_++){var T=x[_];T.onProgress&&T.onProgress(w)}},!1),v.addEventListener("error",function(w){var x=xl[t];delete xl[t];for(var _=0,S=x.length;_<S;_++){var T=x[_];T.onError&&T.onError(w)}i.manager.itemError(t),i.manager.itemEnd(t)},!1),v.addEventListener("abort",function(w){var x=xl[t];delete xl[t];for(var _=0,S=x.length;_<S;_++){var T=x[_];T.onError&&T.onError(w)}i.manager.itemError(t),i.manager.itemEnd(t)},!1),this.responseType!==void 0&&(v.responseType=this.responseType),this.withCredentials!==void 0&&(v.withCredentials=this.withCredentials),v.overrideMimeType&&v.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(var y in this.requestHeader)v.setRequestHeader(y,this.requestHeader[y]);v.send(null)}return i.manager.itemStart(t),v},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});function uP(t){Xn.call(this,t)}uP.prototype=Object.assign(Object.create(Xn.prototype),{constructor:uP,load:function(t,e,n,r){var i=this,s=new $a(i.manager);s.setPath(i.path),s.load(t,function(o){e(i.parse(JSON.parse(o)))},n,r)},parse:function(t){for(var e=[],n=0;n<t.length;n++){var r=Na.parse(t[n]);e.push(r)}return e}});function hP(t){Xn.call(this,t)}hP.prototype=Object.assign(Object.create(Xn.prototype),{constructor:hP,load:function(t,e,n,r){var i=this,s=[],o=new pv;o.image=s;var a=new $a(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer");function l(f){a.load(t[f],function(d){var p=i.parse(d,!0);s[f]={width:p.width,height:p.height,format:p.format,mipmaps:p.mipmaps},c+=1,c===6&&(p.mipmapCount===1&&(o.minFilter=Oi),o.format=p.format,o.needsUpdate=!0,e&&e(o))},n,r)}if(Array.isArray(t))for(var c=0,u=0,h=t.length;u<h;++u)l(u);else a.load(t,function(f){var d=i.parse(f,!0);if(d.isCubemap)for(var p=d.mipmaps.length/d.mipmapCount,m=0;m<p;m++){s[m]={mipmaps:[]};for(var v=0;v<d.mipmapCount;v++)s[m].mipmaps.push(d.mipmaps[m*d.mipmapCount+v]),s[m].format=d.format,s[m].width=d.width,s[m].height=d.height}else o.image.width=d.width,o.image.height=d.height,o.mipmaps=d.mipmaps;d.mipmapCount===1&&(o.minFilter=Oi),o.format=d.format,o.needsUpdate=!0,e&&e(o)},n,r);return o}});function DE(t){Xn.call(this,t)}DE.prototype=Object.assign(Object.create(Xn.prototype),{constructor:DE,load:function(t,e,n,r){var i=this,s=new wd,o=new $a(this.manager);return o.setResponseType("arraybuffer"),o.setPath(this.path),o.load(t,function(a){var l=i.parse(a);!l||(l.image!==void 0?s.image=l.image:l.data!==void 0&&(s.image.width=l.width,s.image.height=l.height,s.image.data=l.data),s.wrapS=l.wrapS!==void 0?l.wrapS:Ws,s.wrapT=l.wrapT!==void 0?l.wrapT:Ws,s.magFilter=l.magFilter!==void 0?l.magFilter:Oi,s.minFilter=l.minFilter!==void 0?l.minFilter:Oi,s.anisotropy=l.anisotropy!==void 0?l.anisotropy:1,l.format!==void 0&&(s.format=l.format),l.type!==void 0&&(s.type=l.type),l.mipmaps!==void 0&&(s.mipmaps=l.mipmaps,s.minFilter=Mw),l.mipmapCount===1&&(s.minFilter=Oi),s.needsUpdate=!0,e&&e(s,l))},n,r),s}});function Iv(t){Xn.call(this,t)}Iv.prototype=Object.assign(Object.create(Xn.prototype),{constructor:Iv,load:function(t,e,n,r){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,s=Ld.get(t);if(s!==void 0)return i.manager.itemStart(t),setTimeout(function(){e&&e(s),i.manager.itemEnd(t)},0),s;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1),Ld.add(t,this),e&&e(this),i.manager.itemEnd(t)}function l(c){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1),r&&r(c),i.manager.itemError(t),i.manager.itemEnd(t)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),t.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(t),o.src=t,o}});function PE(t){Xn.call(this,t)}PE.prototype=Object.assign(Object.create(Xn.prototype),{constructor:PE,load:function(t,e,n,r){var i=new lu,s=new Iv(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);var o=0;function a(c){s.load(t[c],function(u){i.images[c]=u,o++,o===6&&(i.needsUpdate=!0,e&&e(i))},void 0,r)}for(var l=0;l<t.length;++l)a(l);return i}});function OE(t){Xn.call(this,t)}OE.prototype=Object.assign(Object.create(Xn.prototype),{constructor:OE,load:function(t,e,n,r){var i=new ar,s=new Iv(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,function(o){i.image=o;var a=t.search(/\.jpe?g($|\?)/i)>0||t.search(/^data\:image\/jpeg/)===0;i.format=a?Sh:pl,i.needsUpdate=!0,e!==void 0&&e(i)},n,r),i}});function Pt(){this.type="Curve",this.arcLengthDivisions=200}Object.assign(Pt.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){var n=this.getUtoTmapping(t);return this.getPoint(n,e)},getPoints:function(t){t===void 0&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return e},getSpacedPoints:function(t){t===void 0&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(t===void 0&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e=[],n,r=this.getPoint(0),i,s=0;for(e.push(0),i=1;i<=t;i++)n=this.getPoint(i/t),s+=n.distanceTo(r),e.push(s),r=n;return this.cacheArcLengths=e,e},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var n=this.getLengths(),r=0,i=n.length,s;e?s=e:s=t*n[i-1];for(var o=0,a=i-1,l;o<=a;)if(r=Math.floor(o+(a-o)/2),l=n[r]-s,l<0)o=r+1;else if(l>0)a=r-1;else{a=r;break}if(r=a,n[r]===s)return r/(i-1);var c=n[r],u=n[r+1],h=u-c,f=(s-c)/h,d=(r+f)/(i-1);return d},getTangent:function(t){var e=1e-4,n=t-e,r=t+e;n<0&&(n=0),r>1&&(r=1);var i=this.getPoint(n),s=this.getPoint(r),o=s.clone().sub(i);return o.normalize()},getTangentAt:function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},computeFrenetFrames:function(t,e){var n=new j,r=[],i=[],s=[],o=new j,a=new vn,l,c,u;for(l=0;l<=t;l++)c=l/t,r[l]=this.getTangentAt(c),r[l].normalize();i[0]=new j,s[0]=new j;var h=Number.MAX_VALUE,f=Math.abs(r[0].x),d=Math.abs(r[0].y),p=Math.abs(r[0].z);for(f<=h&&(h=f,n.set(1,0,0)),d<=h&&(h=d,n.set(0,1,0)),p<=h&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],o),s[0].crossVectors(r[0],i[0]),l=1;l<=t;l++)i[l]=i[l-1].clone(),s[l]=s[l-1].clone(),o.crossVectors(r[l-1],r[l]),o.length()>Number.EPSILON&&(o.normalize(),u=Math.acos(ln.clamp(r[l-1].dot(r[l]),-1,1)),i[l].applyMatrix4(a.makeRotationAxis(o,u))),s[l].crossVectors(r[l],i[l]);if(e===!0)for(u=Math.acos(ln.clamp(i[0].dot(i[t]),-1,1)),u/=t,r[0].dot(o.crossVectors(i[0],i[t]))>0&&(u=-u),l=1;l<=t;l++)i[l].applyMatrix4(a.makeRotationAxis(r[l],u*l)),s[l].crossVectors(r[l],i[l]);return{tangents:r,normals:i,binormals:s}},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}});function Ho(t,e,n,r,i,s,o,a){Pt.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=s||2*Math.PI,this.aClockwise=o||!1,this.aRotation=a||0}Ho.prototype=Object.create(Pt.prototype);Ho.prototype.constructor=Ho;Ho.prototype.isEllipseCurve=!0;Ho.prototype.getPoint=function(t,e){for(var n=e||new $e,r=Math.PI*2,i=this.aEndAngle-this.aStartAngle,s=Math.abs(i)<Number.EPSILON;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(s?i=0:i=r),this.aClockwise===!0&&!s&&(i===r?i=-r:i=i-r);var o=this.aStartAngle+t*i,a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){var c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=a-this.aX,f=l-this.aY;a=h*c-f*u+this.aX,l=h*u+f*c+this.aY}return n.set(a,l)};Ho.prototype.copy=function(t){return Pt.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this};Ho.prototype.toJSON=function(){var t=Pt.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t};Ho.prototype.fromJSON=function(t){return Pt.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this};function Nv(t,e,n,r,i,s){Ho.call(this,t,e,n,n,r,i,s),this.type="ArcCurve"}Nv.prototype=Object.create(Ho.prototype);Nv.prototype.constructor=Nv;Nv.prototype.isArcCurve=!0;function fP(){var t=0,e=0,n=0,r=0;function i(s,o,a,l){t=s,e=a,n=-3*s+3*o-2*a-l,r=2*s-2*o+a+l}return{initCatmullRom:function(s,o,a,l,c){i(o,a,c*(a-s),c*(l-o))},initNonuniformCatmullRom:function(s,o,a,l,c,u,h){var f=(o-s)/c-(a-s)/(c+u)+(a-o)/u,d=(a-o)/u-(l-o)/(u+h)+(l-a)/h;f*=u,d*=u,i(o,a,f,d)},calc:function(s){var o=s*s,a=o*s;return t+e*s+n*o+r*a}}}var FE=new j,dP=new fP,pP=new fP,mP=new fP;function ks(t,e,n,r){Pt.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=n||"centripetal",this.tension=r||.5}ks.prototype=Object.create(Pt.prototype);ks.prototype.constructor=ks;ks.prototype.isCatmullRomCurve3=!0;ks.prototype.getPoint=function(t,e){var n=e||new j,r=this.points,i=r.length,s=(i-(this.closed?0:1))*t,o=Math.floor(s),a=s-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/i)+1)*i:a===0&&o===i-1&&(o=i-2,a=1);var l,c,u,h;if(this.closed||o>0?l=r[(o-1)%i]:(FE.subVectors(r[0],r[1]).add(r[0]),l=FE),c=r[o%i],u=r[(o+1)%i],this.closed||o+2<i?h=r[(o+2)%i]:(FE.subVectors(r[i-1],r[i-2]).add(r[i-1]),h=FE),this.curveType==="centripetal"||this.curveType==="chordal"){var f=this.curveType==="chordal"?.5:.25,d=Math.pow(l.distanceToSquared(c),f),p=Math.pow(c.distanceToSquared(u),f),m=Math.pow(u.distanceToSquared(h),f);p<1e-4&&(p=1),d<1e-4&&(d=p),m<1e-4&&(m=p),dP.initNonuniformCatmullRom(l.x,c.x,u.x,h.x,d,p,m),pP.initNonuniformCatmullRom(l.y,c.y,u.y,h.y,d,p,m),mP.initNonuniformCatmullRom(l.z,c.z,u.z,h.z,d,p,m)}else this.curveType==="catmullrom"&&(dP.initCatmullRom(l.x,c.x,u.x,h.x,this.tension),pP.initCatmullRom(l.y,c.y,u.y,h.y,this.tension),mP.initCatmullRom(l.z,c.z,u.z,h.z,this.tension));return n.set(dP.calc(a),pP.calc(a),mP.calc(a)),n};ks.prototype.copy=function(t){Pt.prototype.copy.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var r=t.points[e];this.points.push(r.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this};ks.prototype.toJSON=function(){var t=Pt.prototype.toJSON.call(this);t.points=[];for(var e=0,n=this.points.length;e<n;e++){var r=this.points[e];t.points.push(r.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t};ks.prototype.fromJSON=function(t){Pt.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var r=t.points[e];this.points.push(new j().fromArray(r))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this};function NX(t,e,n,r,i){var s=(r-e)*.5,o=(i-n)*.5,a=t*t,l=t*a;return(2*n-2*r+s+o)*l+(-3*n+3*r-2*s-o)*a+s*t+n}function e9e(t,e){var n=1-t;return n*n*e}function t9e(t,e){return 2*(1-t)*t*e}function n9e(t,e){return t*t*e}function Nx(t,e,n,r){return e9e(t,e)+t9e(t,n)+n9e(t,r)}function r9e(t,e){var n=1-t;return n*n*n*e}function i9e(t,e){var n=1-t;return 3*n*n*t*e}function s9e(t,e){return 3*(1-t)*t*t*e}function o9e(t,e){return t*t*t*e}function $x(t,e,n,r,i){return r9e(t,e)+i9e(t,n)+s9e(t,r)+o9e(t,i)}function _l(t,e,n,r){Pt.call(this),this.type="CubicBezierCurve",this.v0=t||new $e,this.v1=e||new $e,this.v2=n||new $e,this.v3=r||new $e}_l.prototype=Object.create(Pt.prototype);_l.prototype.constructor=_l;_l.prototype.isCubicBezierCurve=!0;_l.prototype.getPoint=function(t,e){var n=e||new $e,r=this.v0,i=this.v1,s=this.v2,o=this.v3;return n.set($x(t,r.x,i.x,s.x,o.x),$x(t,r.y,i.y,s.y,o.y)),n};_l.prototype.copy=function(t){return Pt.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this};_l.prototype.toJSON=function(){var t=Pt.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t};_l.prototype.fromJSON=function(t){return Pt.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this};function uc(t,e,n,r){Pt.call(this),this.type="CubicBezierCurve3",this.v0=t||new j,this.v1=e||new j,this.v2=n||new j,this.v3=r||new j}uc.prototype=Object.create(Pt.prototype);uc.prototype.constructor=uc;uc.prototype.isCubicBezierCurve3=!0;uc.prototype.getPoint=function(t,e){var n=e||new j,r=this.v0,i=this.v1,s=this.v2,o=this.v3;return n.set($x(t,r.x,i.x,s.x,o.x),$x(t,r.y,i.y,s.y,o.y),$x(t,r.z,i.z,s.z,o.z)),n};uc.prototype.copy=function(t){return Pt.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this};uc.prototype.toJSON=function(){var t=Pt.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t};uc.prototype.fromJSON=function(t){return Pt.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this};function mo(t,e){Pt.call(this),this.type="LineCurve",this.v1=t||new $e,this.v2=e||new $e}mo.prototype=Object.create(Pt.prototype);mo.prototype.constructor=mo;mo.prototype.isLineCurve=!0;mo.prototype.getPoint=function(t,e){var n=e||new $e;return t===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n};mo.prototype.getPointAt=function(t,e){return this.getPoint(t,e)};mo.prototype.getTangent=function(){var t=this.v2.clone().sub(this.v1);return t.normalize()};mo.prototype.copy=function(t){return Pt.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this};mo.prototype.toJSON=function(){var t=Pt.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t};mo.prototype.fromJSON=function(t){return Pt.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this};function Sl(t,e){Pt.call(this),this.type="LineCurve3",this.v1=t||new j,this.v2=e||new j}Sl.prototype=Object.create(Pt.prototype);Sl.prototype.constructor=Sl;Sl.prototype.isLineCurve3=!0;Sl.prototype.getPoint=function(t,e){var n=e||new j;return t===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n};Sl.prototype.getPointAt=function(t,e){return this.getPoint(t,e)};Sl.prototype.copy=function(t){return Pt.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this};Sl.prototype.toJSON=function(){var t=Pt.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t};Sl.prototype.fromJSON=function(t){return Pt.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this};function Cl(t,e,n){Pt.call(this),this.type="QuadraticBezierCurve",this.v0=t||new $e,this.v1=e||new $e,this.v2=n||new $e}Cl.prototype=Object.create(Pt.prototype);Cl.prototype.constructor=Cl;Cl.prototype.isQuadraticBezierCurve=!0;Cl.prototype.getPoint=function(t,e){var n=e||new $e,r=this.v0,i=this.v1,s=this.v2;return n.set(Nx(t,r.x,i.x,s.x),Nx(t,r.y,i.y,s.y)),n};Cl.prototype.copy=function(t){return Pt.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this};Cl.prototype.toJSON=function(){var t=Pt.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t};Cl.prototype.fromJSON=function(t){return Pt.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this};function hc(t,e,n){Pt.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new j,this.v1=e||new j,this.v2=n||new j}hc.prototype=Object.create(Pt.prototype);hc.prototype.constructor=hc;hc.prototype.isQuadraticBezierCurve3=!0;hc.prototype.getPoint=function(t,e){var n=e||new j,r=this.v0,i=this.v1,s=this.v2;return n.set(Nx(t,r.x,i.x,s.x),Nx(t,r.y,i.y,s.y),Nx(t,r.z,i.z,s.z)),n};hc.prototype.copy=function(t){return Pt.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this};hc.prototype.toJSON=function(){var t=Pt.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t};hc.prototype.fromJSON=function(t){return Pt.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this};function Tl(t){Pt.call(this),this.type="SplineCurve",this.points=t||[]}Tl.prototype=Object.create(Pt.prototype);Tl.prototype.constructor=Tl;Tl.prototype.isSplineCurve=!0;Tl.prototype.getPoint=function(t,e){var n=e||new $e,r=this.points,i=(r.length-1)*t,s=Math.floor(i),o=i-s,a=r[s===0?s:s-1],l=r[s],c=r[s>r.length-2?r.length-1:s+1],u=r[s>r.length-3?r.length-1:s+2];return n.set(NX(o,a.x,l.x,c.x,u.x),NX(o,a.y,l.y,c.y,u.y)),n};Tl.prototype.copy=function(t){Pt.prototype.copy.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var r=t.points[e];this.points.push(r.clone())}return this};Tl.prototype.toJSON=function(){var t=Pt.prototype.toJSON.call(this);t.points=[];for(var e=0,n=this.points.length;e<n;e++){var r=this.points[e];t.points.push(r.toArray())}return t};Tl.prototype.fromJSON=function(t){Pt.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var r=t.points[e];this.points.push(new $e().fromArray(r))}return this};var gP=Object.freeze({__proto__:null,ArcCurve:Nv,CatmullRomCurve3:ks,CubicBezierCurve:_l,CubicBezierCurve3:uc,EllipseCurve:Ho,LineCurve:mo,LineCurve3:Sl,QuadraticBezierCurve:Cl,QuadraticBezierCurve3:hc,SplineCurve:Tl});function du(){Pt.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}du.prototype=Object.assign(Object.create(Pt.prototype),{constructor:du,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new mo(e,t))},getPoint:function(t){for(var e=t*this.getLength(),n=this.getCurveLengths(),r=0;r<n.length;){if(n[r]>=e){var i=n[r]-e,s=this.curves[r],o=s.getLength(),a=o===0?0:1-i/o;return s.getPointAt(a)}r++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,n=0,r=this.curves.length;n<r;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){t===void 0&&(t=40);for(var e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e=[],n,r=0,i=this.curves;r<i.length;r++)for(var s=i[r],o=s&&s.isEllipseCurve?t*2:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?t*s.points.length:t,a=s.getPoints(o),l=0;l<a.length;l++){var c=a[l];n&&n.equals(c)||(e.push(c),n=c)}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e},copy:function(t){Pt.prototype.copy.call(this,t),this.curves=[];for(var e=0,n=t.curves.length;e<n;e++){var r=t.curves[e];this.curves.push(r.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){var t=Pt.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var e=0,n=this.curves.length;e<n;e++){var r=this.curves[e];t.curves.push(r.toJSON())}return t},fromJSON:function(t){Pt.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var e=0,n=t.curves.length;e<n;e++){var r=t.curves[e];this.curves.push(new gP[r.type]().fromJSON(r))}return this}});function El(t){du.call(this),this.type="Path",this.currentPoint=new $e,t&&this.setFromPoints(t)}El.prototype=Object.assign(Object.create(du.prototype),{constructor:El,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this},moveTo:function(t,e){return this.currentPoint.set(t,e),this},lineTo:function(t,e){var n=new mo(this.currentPoint.clone(),new $e(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this},quadraticCurveTo:function(t,e,n,r){var i=new Cl(this.currentPoint.clone(),new $e(t,e),new $e(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this},bezierCurveTo:function(t,e,n,r,i,s){var o=new _l(this.currentPoint.clone(),new $e(t,e),new $e(n,r),new $e(i,s));return this.curves.push(o),this.currentPoint.set(i,s),this},splineThru:function(t){var e=[this.currentPoint.clone()].concat(t),n=new Tl(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,e,n,r,i,s){var o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+o,e+a,n,r,i,s),this},absarc:function(t,e,n,r,i,s){return this.absellipse(t,e,n,n,r,i,s),this},ellipse:function(t,e,n,r,i,s,o,a){var l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,n,r,i,s,o,a),this},absellipse:function(t,e,n,r,i,s,o,a){var l=new Ho(t,e,n,r,i,s,o,a);if(this.curves.length>0){var c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var u=l.getPoint(1);return this.currentPoint.copy(u),this},copy:function(t){return du.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=du.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return du.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}});function Ph(t){El.call(this,t),this.uuid=ln.generateUUID(),this.type="Shape",this.holes=[]}Ph.prototype=Object.assign(Object.create(El.prototype),{constructor:Ph,getPointsHoles:function(t){for(var e=[],n=0,r=this.holes.length;n<r;n++)e[n]=this.holes[n].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){El.prototype.copy.call(this,t),this.holes=[];for(var e=0,n=t.holes.length;e<n;e++){var r=t.holes[e];this.holes.push(r.clone())}return this},toJSON:function(){var t=El.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var e=0,n=this.holes.length;e<n;e++){var r=this.holes[e];t.holes.push(r.toJSON())}return t},fromJSON:function(t){El.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var e=0,n=t.holes.length;e<n;e++){var r=t.holes[e];this.holes.push(new El().fromJSON(r))}return this}});function xr(t,e){ft.call(this),this.type="Light",this.color=new yt(t),this.intensity=e!==void 0?e:1,this.receiveShadow=void 0}xr.prototype=Object.assign(Object.create(ft.prototype),{constructor:xr,isLight:!0,copy:function(t){return ft.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var e=ft.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}});function LE(t,e,n){xr.call(this,t,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(ft.DefaultUp),this.updateMatrix(),this.groundColor=new yt(e)}LE.prototype=Object.assign(Object.create(xr.prototype),{constructor:LE,isHemisphereLight:!0,copy:function(t){return xr.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}});function fc(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new $e(512,512),this.map=null,this.mapPass=null,this.matrix=new vn,this._frustum=new rv,this._frameExtents=new $e(1,1),this._viewportCount=1,this._viewports=[new lr(0,0,1,1)]}Object.assign(fc.prototype,{_projScreenMatrix:new vn,_lightPositionWorld:new j,_lookTarget:new j,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){var e=this.camera,n=this.matrix,r=this._projScreenMatrix,i=this._lookTarget,s=this._lightPositionWorld;s.setFromMatrixPosition(t.matrixWorld),e.position.copy(s),i.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(i),e.updateMatrixWorld(),r.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var t={};return this.bias!==0&&(t.bias=this.bias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}});function BE(){fc.call(this,new Si(50,1,.5,500))}BE.prototype=Object.assign(Object.create(fc.prototype),{constructor:BE,isSpotLightShadow:!0,updateMatrices:function(t){var e=this.camera,n=ln.RAD2DEG*2*t.angle,r=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;(n!==e.fov||r!==e.aspect||i!==e.far)&&(e.fov=n,e.aspect=r,e.far=i,e.updateProjectionMatrix()),fc.prototype.updateMatrices.call(this,t)}});function zE(t,e,n,r,i,s){xr.call(this,t,e),this.type="SpotLight",this.position.copy(ft.DefaultUp),this.updateMatrix(),this.target=new ft,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(o){this.intensity=o/Math.PI}}),this.distance=n!==void 0?n:0,this.angle=r!==void 0?r:Math.PI/3,this.penumbra=i!==void 0?i:0,this.decay=s!==void 0?s:1,this.shadow=new BE}zE.prototype=Object.assign(Object.create(xr.prototype),{constructor:zE,isSpotLight:!0,copy:function(t){return xr.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}});function vP(){fc.call(this,new Si(90,1,.5,500)),this._frameExtents=new $e(4,2),this._viewportCount=6,this._viewports=[new lr(2,1,1,1),new lr(0,1,1,1),new lr(3,1,1,1),new lr(1,1,1,1),new lr(3,0,1,1),new lr(1,0,1,1)],this._cubeDirections=[new j(1,0,0),new j(-1,0,0),new j(0,0,1),new j(0,0,-1),new j(0,1,0),new j(0,-1,0)],this._cubeUps=[new j(0,1,0),new j(0,1,0),new j(0,1,0),new j(0,1,0),new j(0,0,1),new j(0,0,-1)]}vP.prototype=Object.assign(Object.create(fc.prototype),{constructor:vP,isPointLightShadow:!0,updateMatrices:function(t,e){e===void 0&&(e=0);var n=this.camera,r=this.matrix,i=this._lightPositionWorld,s=this._lookTarget,o=this._projScreenMatrix;i.setFromMatrixPosition(t.matrixWorld),n.position.copy(i),s.copy(n.position),s.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(s),n.updateMatrixWorld(),r.makeTranslation(-i.x,-i.y,-i.z),o.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(o)}});function VE(t,e,n,r){xr.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return this.intensity*4*Math.PI},set:function(i){this.intensity=i/(4*Math.PI)}}),this.distance=n!==void 0?n:0,this.decay=r!==void 0?r:1,this.shadow=new vP}VE.prototype=Object.assign(Object.create(xr.prototype),{constructor:VE,isPointLight:!0,copy:function(t){return xr.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}});function $v(t,e,n,r,i,s){oc.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t!==void 0?t:-1,this.right=e!==void 0?e:1,this.top=n!==void 0?n:1,this.bottom=r!==void 0?r:-1,this.near=i!==void 0?i:.1,this.far=s!==void 0?s:2e3,this.updateProjectionMatrix()}$v.prototype=Object.assign(Object.create(oc.prototype),{constructor:$v,isOrthographicCamera:!0,copy:function(t,e){return oc.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this},setViewOffset:function(t,e,n,r,i,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-t,s=n+t,o=r+e,a=r-e;if(this.view!==null&&this.view.enabled){var l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=l*this.view.offsetX,s=i+l*this.view.width,o-=c*this.view.offsetY,a=o-c*this.view.height}this.projectionMatrix.makeOrthographic(i,s,o,a,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){var e=ft.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}});function UE(){fc.call(this,new $v(-5,5,5,-5,.5,500))}UE.prototype=Object.assign(Object.create(fc.prototype),{constructor:UE,isDirectionalLightShadow:!0,updateMatrices:function(t){fc.prototype.updateMatrices.call(this,t)}});function WE(t,e){xr.call(this,t,e),this.type="DirectionalLight",this.position.copy(ft.DefaultUp),this.updateMatrix(),this.target=new ft,this.shadow=new UE}WE.prototype=Object.assign(Object.create(xr.prototype),{constructor:WE,isDirectionalLight:!0,copy:function(t){return xr.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}});function GE(t,e){xr.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}GE.prototype=Object.assign(Object.create(xr.prototype),{constructor:GE,isAmbientLight:!0});function HE(t,e,n,r){xr.call(this,t,e),this.type="RectAreaLight",this.width=n!==void 0?n:10,this.height=r!==void 0?r:10}HE.prototype=Object.assign(Object.create(xr.prototype),{constructor:HE,isRectAreaLight:!0,copy:function(t){return xr.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){var e=xr.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}});function jE(t){Xn.call(this,t),this.textures={}}jE.prototype=Object.assign(Object.create(Xn.prototype),{constructor:jE,load:function(t,e,n,r){var i=this,s=new $a(i.manager);s.setPath(i.path),s.load(t,function(o){e(i.parse(JSON.parse(o)))},n,r)},parse:function(t){var e=this.textures;function n(l){return e[l]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",l),e[l]}var r=new Zje[t.type];if(t.uuid!==void 0&&(r.uuid=t.uuid),t.name!==void 0&&(r.name=t.name),t.color!==void 0&&r.color.setHex(t.color),t.roughness!==void 0&&(r.roughness=t.roughness),t.metalness!==void 0&&(r.metalness=t.metalness),t.sheen!==void 0&&(r.sheen=new yt().setHex(t.sheen)),t.emissive!==void 0&&r.emissive.setHex(t.emissive),t.specular!==void 0&&r.specular.setHex(t.specular),t.shininess!==void 0&&(r.shininess=t.shininess),t.clearcoat!==void 0&&(r.clearcoat=t.clearcoat),t.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=t.clearcoatRoughness),t.vertexColors!==void 0&&(r.vertexColors=t.vertexColors),t.fog!==void 0&&(r.fog=t.fog),t.flatShading!==void 0&&(r.flatShading=t.flatShading),t.blending!==void 0&&(r.blending=t.blending),t.combine!==void 0&&(r.combine=t.combine),t.side!==void 0&&(r.side=t.side),t.opacity!==void 0&&(r.opacity=t.opacity),t.transparent!==void 0&&(r.transparent=t.transparent),t.alphaTest!==void 0&&(r.alphaTest=t.alphaTest),t.depthTest!==void 0&&(r.depthTest=t.depthTest),t.depthWrite!==void 0&&(r.depthWrite=t.depthWrite),t.colorWrite!==void 0&&(r.colorWrite=t.colorWrite),t.stencilWrite!==void 0&&(r.stencilWrite=t.stencilWrite),t.stencilWriteMask!==void 0&&(r.stencilWriteMask=t.stencilWriteMask),t.stencilFunc!==void 0&&(r.stencilFunc=t.stencilFunc),t.stencilRef!==void 0&&(r.stencilRef=t.stencilRef),t.stencilFuncMask!==void 0&&(r.stencilFuncMask=t.stencilFuncMask),t.stencilFail!==void 0&&(r.stencilFail=t.stencilFail),t.stencilZFail!==void 0&&(r.stencilZFail=t.stencilZFail),t.stencilZPass!==void 0&&(r.stencilZPass=t.stencilZPass),t.wireframe!==void 0&&(r.wireframe=t.wireframe),t.wireframeLinewidth!==void 0&&(r.wireframeLinewidth=t.wireframeLinewidth),t.wireframeLinecap!==void 0&&(r.wireframeLinecap=t.wireframeLinecap),t.wireframeLinejoin!==void 0&&(r.wireframeLinejoin=t.wireframeLinejoin),t.rotation!==void 0&&(r.rotation=t.rotation),t.linewidth!==1&&(r.linewidth=t.linewidth),t.dashSize!==void 0&&(r.dashSize=t.dashSize),t.gapSize!==void 0&&(r.gapSize=t.gapSize),t.scale!==void 0&&(r.scale=t.scale),t.polygonOffset!==void 0&&(r.polygonOffset=t.polygonOffset),t.polygonOffsetFactor!==void 0&&(r.polygonOffsetFactor=t.polygonOffsetFactor),t.polygonOffsetUnits!==void 0&&(r.polygonOffsetUnits=t.polygonOffsetUnits),t.skinning!==void 0&&(r.skinning=t.skinning),t.morphTargets!==void 0&&(r.morphTargets=t.morphTargets),t.morphNormals!==void 0&&(r.morphNormals=t.morphNormals),t.dithering!==void 0&&(r.dithering=t.dithering),t.visible!==void 0&&(r.visible=t.visible),t.toneMapped!==void 0&&(r.toneMapped=t.toneMapped),t.userData!==void 0&&(r.userData=t.userData),t.uniforms!==void 0)for(var i in t.uniforms){var s=t.uniforms[i];switch(r.uniforms[i]={},s.type){case"t":r.uniforms[i].value=n(s.value);break;case"c":r.uniforms[i].value=new yt().setHex(s.value);break;case"v2":r.uniforms[i].value=new $e().fromArray(s.value);break;case"v3":r.uniforms[i].value=new j().fromArray(s.value);break;case"v4":r.uniforms[i].value=new lr().fromArray(s.value);break;case"m3":r.uniforms[i].value=new rs().fromArray(s.value);case"m4":r.uniforms[i].value=new vn().fromArray(s.value);break;default:r.uniforms[i].value=s.value}}if(t.defines!==void 0&&(r.defines=t.defines),t.vertexShader!==void 0&&(r.vertexShader=t.vertexShader),t.fragmentShader!==void 0&&(r.fragmentShader=t.fragmentShader),t.extensions!==void 0)for(var o in t.extensions)r.extensions[o]=t.extensions[o];if(t.shading!==void 0&&(r.flatShading=t.shading===1),t.size!==void 0&&(r.size=t.size),t.sizeAttenuation!==void 0&&(r.sizeAttenuation=t.sizeAttenuation),t.map!==void 0&&(r.map=n(t.map)),t.matcap!==void 0&&(r.matcap=n(t.matcap)),t.alphaMap!==void 0&&(r.alphaMap=n(t.alphaMap),r.transparent=!0),t.bumpMap!==void 0&&(r.bumpMap=n(t.bumpMap)),t.bumpScale!==void 0&&(r.bumpScale=t.bumpScale),t.normalMap!==void 0&&(r.normalMap=n(t.normalMap)),t.normalMapType!==void 0&&(r.normalMapType=t.normalMapType),t.normalScale!==void 0){var a=t.normalScale;Array.isArray(a)===!1&&(a=[a,a]),r.normalScale=new $e().fromArray(a)}return t.displacementMap!==void 0&&(r.displacementMap=n(t.displacementMap)),t.displacementScale!==void 0&&(r.displacementScale=t.displacementScale),t.displacementBias!==void 0&&(r.displacementBias=t.displacementBias),t.roughnessMap!==void 0&&(r.roughnessMap=n(t.roughnessMap)),t.metalnessMap!==void 0&&(r.metalnessMap=n(t.metalnessMap)),t.emissiveMap!==void 0&&(r.emissiveMap=n(t.emissiveMap)),t.emissiveIntensity!==void 0&&(r.emissiveIntensity=t.emissiveIntensity),t.specularMap!==void 0&&(r.specularMap=n(t.specularMap)),t.envMap!==void 0&&(r.envMap=n(t.envMap)),t.envMapIntensity!==void 0&&(r.envMapIntensity=t.envMapIntensity),t.reflectivity!==void 0&&(r.reflectivity=t.reflectivity),t.refractionRatio!==void 0&&(r.refractionRatio=t.refractionRatio),t.lightMap!==void 0&&(r.lightMap=n(t.lightMap)),t.lightMapIntensity!==void 0&&(r.lightMapIntensity=t.lightMapIntensity),t.aoMap!==void 0&&(r.aoMap=n(t.aoMap)),t.aoMapIntensity!==void 0&&(r.aoMapIntensity=t.aoMapIntensity),t.gradientMap!==void 0&&(r.gradientMap=n(t.gradientMap)),t.clearcoatNormalMap!==void 0&&(r.clearcoatNormalMap=n(t.clearcoatNormalMap)),t.clearcoatNormalScale!==void 0&&(r.clearcoatNormalScale=new $e().fromArray(t.clearcoatNormalScale)),r},setTextures:function(t){return this.textures=t,this}});var yP={decodeText:function(t){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(t);for(var e="",n=0,r=t.length;n<r;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch{return e}},extractUrlBase:function(t){var e=t.lastIndexOf("/");return e===-1?"./":t.substr(0,e+1)}};function qE(){wt.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}qE.prototype=Object.assign(Object.create(wt.prototype),{constructor:qE,isInstancedBufferGeometry:!0,copy:function(t){return wt.prototype.copy.call(this,t),this.maxInstancedCount=t.maxInstancedCount,this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var t=wt.prototype.toJSON.call(this);return t.maxInstancedCount=this.maxInstancedCount,t.isInstancedBufferGeometry=!0,t}});function XE(t,e,n,r){typeof n=="number"&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),qt.call(this,t,e,n),this.meshPerAttribute=r||1}XE.prototype=Object.assign(Object.create(qt.prototype),{constructor:XE,isInstancedBufferAttribute:!0,copy:function(t){return qt.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){var t=qt.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}});function KE(t){Xn.call(this,t)}KE.prototype=Object.assign(Object.create(Xn.prototype),{constructor:KE,load:function(t,e,n,r){var i=this,s=new $a(i.manager);s.setPath(i.path),s.load(t,function(o){e(i.parse(JSON.parse(o)))},n,r)},parse:function(t){var e=t.isInstancedBufferGeometry?new qE:new wt,n=t.data.index;if(n!==void 0){var r=new bP[n.type](n.array);e.setIndex(new qt(r,1))}var i=t.data.attributes;for(var s in i){var o=i[s],r=new bP[o.type](o.array),a=o.isInstancedBufferAttribute?XE:qt,l=new a(r,o.itemSize,o.normalized);o.name!==void 0&&(l.name=o.name),e.setAttribute(s,l)}var c=t.data.morphAttributes;if(c)for(var s in c){for(var u=c[s],h=[],f=0,d=u.length;f<d;f++){var o=u[f],r=new bP[o.type](o.array),l=new qt(r,o.itemSize,o.normalized);o.name!==void 0&&(l.name=o.name),h.push(l)}e.morphAttributes[s]=h}var p=t.data.morphTargetsRelative;p&&(e.morphTargetsRelative=!0);var m=t.data.groups||t.data.drawcalls||t.data.offsets;if(m!==void 0)for(var f=0,v=m.length;f!==v;++f){var y=m[f];e.addGroup(y.start,y.count,y.materialIndex)}var w=t.data.boundingSphere;if(w!==void 0){var x=new j;w.center!==void 0&&x.fromArray(w.center),e.boundingSphere=new iu(x,w.radius)}return t.name&&(e.name=t.name),t.userData&&(e.userData=t.userData),e}});var bP={Int8Array,Uint8Array,Uint8ClampedArray:typeof Uint8ClampedArray!="undefined"?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function YE(t){Xn.call(this,t)}YE.prototype=Object.assign(Object.create(Xn.prototype),{constructor:YE,load:function(t,e,n,r){var i=this,s=this.path===""?yP.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||s;var o=new $a(i.manager);o.setPath(this.path),o.load(t,function(a){var l=null;try{l=JSON.parse(a)}catch(u){r!==void 0&&r(u),console.error("THREE:ObjectLoader: Can't parse "+t+".",u.message);return}var c=l.metadata;if(c===void 0||c.type===void 0||c.type.toLowerCase()==="geometry"){console.error("THREE.ObjectLoader: Can't load "+t);return}i.parse(l,e)},n,r)},parse:function(t,e){var n=this.parseShape(t.shapes),r=this.parseGeometries(t.geometries,n),i=this.parseImages(t.images,function(){e!==void 0&&e(a)}),s=this.parseTextures(t.textures,i),o=this.parseMaterials(t.materials,s),a=this.parseObject(t.object,r,o);return t.animations&&(a.animations=this.parseAnimations(t.animations)),(t.images===void 0||t.images.length===0)&&e!==void 0&&e(a),a},parseShape:function(t){var e={};if(t!==void 0)for(var n=0,r=t.length;n<r;n++){var i=new Ph().fromJSON(t[n]);e[i.uuid]=i}return e},parseGeometries:function(t,e){var n={};if(t!==void 0)for(var r=new KE,i=0,s=t.length;i<s;i++){var o,a=t[i];switch(a.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new Hs[a.type](a.width,a.height,a.widthSegments,a.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":o=new Hs[a.type](a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new Hs[a.type](a.radius,a.segments,a.thetaStart,a.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new Hs[a.type](a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new Hs[a.type](a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new Hs[a.type](a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new Hs[a.type](a.radius,a.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new Hs[a.type](a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new Hs[a.type](a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new Hs[a.type](a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q);break;case"TubeGeometry":case"TubeBufferGeometry":o=new Hs[a.type](new gP[a.path.type]().fromJSON(a.path),a.tubularSegments,a.radius,a.radialSegments,a.closed);break;case"LatheGeometry":case"LatheBufferGeometry":o=new Hs[a.type](a.points,a.segments,a.phiStart,a.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new Hs[a.type](a.vertices,a.indices,a.radius,a.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var l=[],c=0,u=a.shapes.length;c<u;c++){var h=e[a.shapes[c]];l.push(h)}o=new Hs[a.type](l,a.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(var l=[],c=0,u=a.shapes.length;c<u;c++){var h=e[a.shapes[c]];l.push(h)}var f=a.options.extrudePath;f!==void 0&&(a.options.extrudePath=new gP[f.type]().fromJSON(f)),o=new Hs[a.type](l,a.options);break;case"BufferGeometry":case"InstancedBufferGeometry":o=r.parse(a);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE){var d=new THREE.LegacyJSONLoader;o=d.parse(a,this.resourcePath).geometry}else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+a.type+'"');continue}o.uuid=a.uuid,a.name!==void 0&&(o.name=a.name),o.isBufferGeometry===!0&&a.userData!==void 0&&(o.userData=a.userData),n[a.uuid]=o}return n},parseMaterials:function(t,e){var n={},r={};if(t!==void 0){var i=new jE;i.setTextures(e);for(var s=0,o=t.length;s<o;s++){var a=t[s];if(a.type==="MultiMaterial"){for(var l=[],c=0;c<a.materials.length;c++){var u=a.materials[c];n[u.uuid]===void 0&&(n[u.uuid]=i.parse(u)),l.push(n[u.uuid])}r[a.uuid]=l}else n[a.uuid]===void 0&&(n[a.uuid]=i.parse(a)),r[a.uuid]=n[a.uuid]}}return r},parseAnimations:function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n],i=Na.parse(r);r.uuid!==void 0&&(i.uuid=r.uuid),e.push(i)}return e},parseImages:function(t,e){var n=this,r={};function i(m){return n.manager.itemStart(m),o.load(m,function(){n.manager.itemEnd(m)},void 0,function(){n.manager.itemError(m),n.manager.itemEnd(m)})}if(t!==void 0&&t.length>0){var s=new cP(e),o=new Iv(s);o.setCrossOrigin(this.crossOrigin);for(var a=0,l=t.length;a<l;a++){var c=t[a],u=c.url;if(Array.isArray(u)){r[c.uuid]=[];for(var h=0,f=u.length;h<f;h++){var d=u[h],p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(d)?d:n.resourcePath+d;r[c.uuid].push(i(p))}}else{var p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c.url)?c.url:n.resourcePath+c.url;r[c.uuid]=i(p)}}}return r},parseTextures:function(t,e){function n(l,c){return typeof l=="number"?l:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",l),c[l])}var r={};if(t!==void 0)for(var i=0,s=t.length;i<s;i++){var o=t[i];o.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),e[o.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",o.image);var a;Array.isArray(e[o.image])?a=new lu(e[o.image]):a=new ar(e[o.image]),a.needsUpdate=!0,a.uuid=o.uuid,o.name!==void 0&&(a.name=o.name),o.mapping!==void 0&&(a.mapping=n(o.mapping,a9e)),o.offset!==void 0&&a.offset.fromArray(o.offset),o.repeat!==void 0&&a.repeat.fromArray(o.repeat),o.center!==void 0&&a.center.fromArray(o.center),o.rotation!==void 0&&(a.rotation=o.rotation),o.wrap!==void 0&&(a.wrapS=n(o.wrap[0],$X),a.wrapT=n(o.wrap[1],$X)),o.format!==void 0&&(a.format=o.format),o.type!==void 0&&(a.type=o.type),o.encoding!==void 0&&(a.encoding=o.encoding),o.minFilter!==void 0&&(a.minFilter=n(o.minFilter,RX)),o.magFilter!==void 0&&(a.magFilter=n(o.magFilter,RX)),o.anisotropy!==void 0&&(a.anisotropy=o.anisotropy),o.flipY!==void 0&&(a.flipY=o.flipY),o.premultiplyAlpha!==void 0&&(a.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(a.unpackAlignment=o.unpackAlignment),r[o.uuid]=a}return r},parseObject:function(t,e,n){var r;function i(v){return e[v]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",v),e[v]}function s(v){if(v!==void 0){if(Array.isArray(v)){for(var y=[],w=0,x=v.length;w<x;w++){var _=v[w];n[_]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",_),y.push(n[_])}return y}return n[v]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",v),n[v]}}switch(t.type){case"Scene":r=new nu,t.background!==void 0&&Number.isInteger(t.background)&&(r.background=new yt(t.background)),t.fog!==void 0&&(t.fog.type==="Fog"?r.fog=new pE(t.fog.color,t.fog.near,t.fog.far):t.fog.type==="FogExp2"&&(r.fog=new dE(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":r=new Si(t.fov,t.aspect,t.near,t.far),t.focus!==void 0&&(r.focus=t.focus),t.zoom!==void 0&&(r.zoom=t.zoom),t.filmGauge!==void 0&&(r.filmGauge=t.filmGauge),t.filmOffset!==void 0&&(r.filmOffset=t.filmOffset),t.view!==void 0&&(r.view=Object.assign({},t.view));break;case"OrthographicCamera":r=new $v(t.left,t.right,t.top,t.bottom,t.near,t.far),t.zoom!==void 0&&(r.zoom=t.zoom),t.view!==void 0&&(r.view=Object.assign({},t.view));break;case"AmbientLight":r=new GE(t.color,t.intensity);break;case"DirectionalLight":r=new WE(t.color,t.intensity);break;case"PointLight":r=new VE(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":r=new HE(t.color,t.intensity,t.width,t.height);break;case"SpotLight":r=new zE(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":r=new LE(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var o=i(t.geometry),a=s(t.material);o.bones&&o.bones.length>0?r=new sx(o,a):r=new Or(o,a);break;case"InstancedMesh":var o=i(t.geometry),a=s(t.material),l=t.count,c=t.instanceMatrix;r=new wE(o,a,l),r.instanceMatrix=new qt(new Float32Array(c.array),16);break;case"LOD":r=new ix;break;case"Line":r=new Wo(i(t.geometry),s(t.material),t.mode);break;case"LineLoop":r=new TE(i(t.geometry),s(t.material));break;case"LineSegments":r=new Vr(i(t.geometry),s(t.material));break;case"PointCloud":case"Points":r=new dv(i(t.geometry),s(t.material));break;case"Sprite":r=new rx(s(t.material));break;case"Group":r=new av;break;default:r=new ft}if(r.uuid=t.uuid,t.name!==void 0&&(r.name=t.name),t.matrix!==void 0?(r.matrix.fromArray(t.matrix),t.matrixAutoUpdate!==void 0&&(r.matrixAutoUpdate=t.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(t.position!==void 0&&r.position.fromArray(t.position),t.rotation!==void 0&&r.rotation.fromArray(t.rotation),t.quaternion!==void 0&&r.quaternion.fromArray(t.quaternion),t.scale!==void 0&&r.scale.fromArray(t.scale)),t.castShadow!==void 0&&(r.castShadow=t.castShadow),t.receiveShadow!==void 0&&(r.receiveShadow=t.receiveShadow),t.shadow&&(t.shadow.bias!==void 0&&(r.shadow.bias=t.shadow.bias),t.shadow.radius!==void 0&&(r.shadow.radius=t.shadow.radius),t.shadow.mapSize!==void 0&&r.shadow.mapSize.fromArray(t.shadow.mapSize),t.shadow.camera!==void 0&&(r.shadow.camera=this.parseObject(t.shadow.camera))),t.visible!==void 0&&(r.visible=t.visible),t.frustumCulled!==void 0&&(r.frustumCulled=t.frustumCulled),t.renderOrder!==void 0&&(r.renderOrder=t.renderOrder),t.userData!==void 0&&(r.userData=t.userData),t.layers!==void 0&&(r.layers.mask=t.layers),t.children!==void 0)for(var u=t.children,h=0;h<u.length;h++)r.add(this.parseObject(u[h],e,n));if(t.type==="LOD"){t.autoUpdate!==void 0&&(r.autoUpdate=t.autoUpdate);for(var f=t.levels,d=0;d<f.length;d++){var p=f[d],m=r.getObjectByProperty("uuid",p.object);m!==void 0&&r.addLevel(m,p.distance)}}return r}});var a9e={UVMapping:BT,CubeReflectionMapping:zT,CubeRefractionMapping:VT,EquirectangularReflectionMapping:p3,EquirectangularRefractionMapping:UT,SphericalReflectionMapping:m3,CubeUVReflectionMapping:Og,CubeUVRefractionMapping:WT},$X={RepeatWrapping:kw,ClampToEdgeWrapping:Ws,MirroredRepeatWrapping:Aw},RX={NearestFilter:li,NearestMipmapNearestFilter:GT,NearestMipmapLinearFilter:HT,LinearFilter:Oi,LinearMipmapNearestFilter:g3,LinearMipmapLinearFilter:Mw};function wP(t){typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Xn.call(this,t),this.options=void 0}wP.prototype=Object.assign(Object.create(Xn.prototype),{constructor:wP,setOptions:function(e){return this.options=e,this},load:function(t,e,n,r){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,s=Ld.get(t);if(s!==void 0)return i.manager.itemStart(t),setTimeout(function(){e&&e(s),i.manager.itemEnd(t)},0),s;fetch(t).then(function(o){return o.blob()}).then(function(o){return i.options===void 0?createImageBitmap(o):createImageBitmap(o,i.options)}).then(function(o){Ld.add(t,o),e&&e(o),i.manager.itemEnd(t)}).catch(function(o){r&&r(o),i.manager.itemError(t),i.manager.itemEnd(t)}),i.manager.itemStart(t)}});function xP(){this.type="ShapePath",this.color=new yt,this.subPaths=[],this.currentPath=null}Object.assign(xP.prototype,{moveTo:function(t,e){return this.currentPath=new El,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},lineTo:function(t,e){return this.currentPath.lineTo(t,e),this},quadraticCurveTo:function(t,e,n,r){return this.currentPath.quadraticCurveTo(t,e,n,r),this},bezierCurveTo:function(t,e,n,r,i,s){return this.currentPath.bezierCurveTo(t,e,n,r,i,s),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,e){function n(F){for(var O=[],K=0,J=F.length;K<J;K++){var re=F[K],ae=new Ph;ae.curves=re.curves,O.push(ae)}return O}function r(F,O){for(var K=O.length,J=!1,re=K-1,ae=0;ae<K;re=ae++){var pe=O[re],ke=O[ae],Te=ke.x-pe.x,Ne=ke.y-pe.y;if(Math.abs(Ne)>Number.EPSILON){if(Ne<0&&(pe=O[ae],Te=-Te,ke=O[re],Ne=-Ne),F.y<pe.y||F.y>ke.y)continue;if(F.y===pe.y){if(F.x===pe.x)return!0}else{var we=Ne*(F.x-pe.x)-Te*(F.y-pe.y);if(we===0)return!0;if(we<0)continue;J=!J}}else{if(F.y!==pe.y)continue;if(ke.x<=F.x&&F.x<=pe.x||pe.x<=F.x&&F.x<=ke.x)return!0}}return J}var i=uu.isClockWise,s=this.subPaths;if(s.length===0)return[];if(e===!0)return n(s);var o,a,l,c=[];if(s.length===1)return a=s[0],l=new Ph,l.curves=a.curves,c.push(l),c;var u=!i(s[0].getPoints());u=t?!u:u;var h=[],f=[],d=[],p=0,m;f[p]=void 0,d[p]=[];for(var v=0,y=s.length;v<y;v++)a=s[v],m=a.getPoints(),o=i(m),o=t?!o:o,o?(!u&&f[p]&&p++,f[p]={s:new Ph,p:m},f[p].s.curves=a.curves,u&&p++,d[p]=[]):d[p].push({h:a,p:m[0]});if(!f[0])return n(s);if(f.length>1){for(var w=!1,x=[],_=0,S=f.length;_<S;_++)h[_]=[];for(var _=0,S=f.length;_<S;_++)for(var T=d[_],E=0;E<T.length;E++){for(var k=T[E],A=!0,M=0;M<f.length;M++)r(k.p,f[M].p)&&(_!==M&&x.push({froms:_,tos:M,hole:E}),A?(A=!1,h[M].push(k)):w=!0);A&&h[_].push(k)}x.length>0&&(w||(d=h))}for(var D,v=0,P=f.length;v<P;v++){l=f[v].s,c.push(l),D=d[v];for(var N=0,R=D.length;N<R;N++)l.holes.push(D[N].h)}return c}});function _P(t){this.type="Font",this.data=t}Object.assign(_P.prototype,{isFont:!0,generateShapes:function(t,e){e===void 0&&(e=100);for(var n=[],r=l9e(t,e,this.data),i=0,s=r.length;i<s;i++)Array.prototype.push.apply(n,r[i].toShapes());return n}});function l9e(t,e,n){for(var r=Array.from?Array.from(t):String(t).split(""),i=e/n.resolution,s=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,o=[],a=0,l=0,c=0;c<r.length;c++){var u=r[c];if(u===`
`)a=0,l-=s;else{var h=c9e(u,i,a,l,n);a+=h.offsetX,o.push(h.path)}}return o}function c9e(t,e,n,r,i){var s=i.glyphs[t]||i.glyphs["?"];if(!s){console.error('THREE.Font: character "'+t+'" does not exists in font family '+i.familyName+".");return}var o=new xP,a,l,c,u,h,f,d,p;if(s.o)for(var m=s._cachedOutline||(s._cachedOutline=s.o.split(" ")),v=0,y=m.length;v<y;){var w=m[v++];switch(w){case"m":a=m[v++]*e+n,l=m[v++]*e+r,o.moveTo(a,l);break;case"l":a=m[v++]*e+n,l=m[v++]*e+r,o.lineTo(a,l);break;case"q":c=m[v++]*e+n,u=m[v++]*e+r,h=m[v++]*e+n,f=m[v++]*e+r,o.quadraticCurveTo(h,f,c,u);break;case"b":c=m[v++]*e+n,u=m[v++]*e+r,h=m[v++]*e+n,f=m[v++]*e+r,d=m[v++]*e+n,p=m[v++]*e+r,o.bezierCurveTo(h,f,d,p,c,u);break}}return{offsetX:s.ha*e,path:o}}function SP(t){Xn.call(this,t)}SP.prototype=Object.assign(Object.create(Xn.prototype),{constructor:SP,load:function(t,e,n,r){var i=this,s=new $a(this.manager);s.setPath(this.path),s.load(t,function(o){var a;try{a=JSON.parse(o)}catch{console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),a=JSON.parse(o.substring(65,o.length-2))}var l=i.parse(a);e&&e(l)},n,r)},parse:function(t){return new _P(t)}});var ZE,CP={getContext:function(){return ZE===void 0&&(ZE=new(window.AudioContext||window.webkitAudioContext)),ZE},setContext:function(t){ZE=t}};function JE(t){Xn.call(this,t)}JE.prototype=Object.assign(Object.create(Xn.prototype),{constructor:JE,load:function(t,e,n,r){var i=new $a(this.manager);i.setResponseType("arraybuffer"),i.setPath(this.path),i.load(t,function(s){var o=s.slice(0),a=CP.getContext();a.decodeAudioData(o,function(l){e(l)})},n,r)}});function QE(){this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new j)}Object.assign(QE.prototype,{isSphericalHarmonics3:!0,set:function(t){for(var e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this},zero:function(){for(var t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this},getAt:function(t,e){var n=t.x,r=t.y,i=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScale(s[1],.488603*r),e.addScale(s[2],.488603*i),e.addScale(s[3],.488603*n),e.addScale(s[4],1.092548*(n*r)),e.addScale(s[5],1.092548*(r*i)),e.addScale(s[6],.315392*(3*i*i-1)),e.addScale(s[7],1.092548*(n*i)),e.addScale(s[8],.546274*(n*n-r*r)),e},getIrradianceAt:function(t,e){var n=t.x,r=t.y,i=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScale(s[1],2*.511664*r),e.addScale(s[2],2*.511664*i),e.addScale(s[3],2*.511664*n),e.addScale(s[4],2*.429043*n*r),e.addScale(s[5],2*.429043*r*i),e.addScale(s[6],.743125*i*i-.247708),e.addScale(s[7],2*.429043*n*i),e.addScale(s[8],.429043*(n*n-r*r)),e},add:function(t){for(var e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this},scale:function(t){for(var e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this},lerp:function(t,e){for(var n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this},equals:function(t){for(var e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0},copy:function(t){return this.set(t.coefficients)},clone:function(){return new this.constructor().copy(this)},fromArray:function(t,e){e===void 0&&(e=0);for(var n=this.coefficients,r=0;r<9;r++)n[r].fromArray(t,e+r*3);return this},toArray:function(t,e){t===void 0&&(t=[]),e===void 0&&(e=0);for(var n=this.coefficients,r=0;r<9;r++)n[r].toArray(t,e+r*3);return t}});Object.assign(QE,{getBasisAt:function(t,e){var n=t.x,r=t.y,i=t.z;e[0]=.282095,e[1]=.488603*r,e[2]=.488603*i,e[3]=.488603*n,e[4]=1.092548*n*r,e[5]=1.092548*r*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*n*i,e[8]=.546274*(n*n-r*r)}});function kl(t,e){xr.call(this,void 0,e),this.sh=t!==void 0?t:new QE}kl.prototype=Object.assign(Object.create(xr.prototype),{constructor:kl,isLightProbe:!0,copy:function(t){return xr.prototype.copy.call(this,t),this.sh.copy(t.sh),this.intensity=t.intensity,this},toJSON:function(t){var e=xr.prototype.toJSON.call(this,t);return e}});function TP(t,e,n){kl.call(this,void 0,n);var r=new yt().set(t),i=new yt().set(e),s=new j(r.r,r.g,r.b),o=new j(i.r,i.g,i.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(o).multiplyScalar(a),this.sh.coefficients[1].copy(s).sub(o).multiplyScalar(l)}TP.prototype=Object.assign(Object.create(kl.prototype),{constructor:TP,isHemisphereLightProbe:!0,copy:function(t){return kl.prototype.copy.call(this,t),this},toJSON:function(t){var e=kl.prototype.toJSON.call(this,t);return e}});function EP(t,e){kl.call(this,void 0,e);var n=new yt().set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}EP.prototype=Object.assign(Object.create(kl.prototype),{constructor:EP,isAmbientLightProbe:!0,copy:function(t){return kl.prototype.copy.call(this,t),this},toJSON:function(t){var e=kl.prototype.toJSON.call(this,t);return e}});var DX=new vn,PX=new vn;function OX(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Si,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Si,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(OX.prototype,{update:function(t){var e=this._cache,n=e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep;if(n){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;var r=t.projectionMatrix.clone(),i=e.eyeSep/2,s=i*e.near/e.focus,o=e.near*Math.tan(ln.DEG2RAD*e.fov*.5)/e.zoom,a,l;PX.elements[12]=-i,DX.elements[12]=i,a=-o*e.aspect+s,l=o*e.aspect+s,r.elements[0]=2*e.near/(l-a),r.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(r),a=-o*e.aspect-s,l=o*e.aspect-s,r.elements[0]=2*e.near/(l-a),r.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(r)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(PX),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(DX)}});function kP(t){this.autoStart=t!==void 0?t:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(kP.prototype,{start:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=(typeof performance=="undefined"?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}});var Bd=new j,FX=new is,u9e=new j,zd=new j;function AP(){ft.call(this),this.type="AudioListener",this.context=CP.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new kP}AP.prototype=Object.assign(Object.create(ft.prototype),{constructor:AP,getInput:function(){return this.gain},removeFilter:function(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(t){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this},updateMatrixWorld:function(t){ft.prototype.updateMatrixWorld.call(this,t);var e=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Bd,FX,u9e),zd.set(0,0,-1).applyQuaternion(FX),e.positionX){var r=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(Bd.x,r),e.positionY.linearRampToValueAtTime(Bd.y,r),e.positionZ.linearRampToValueAtTime(Bd.z,r),e.forwardX.linearRampToValueAtTime(zd.x,r),e.forwardY.linearRampToValueAtTime(zd.y,r),e.forwardZ.linearRampToValueAtTime(zd.z,r),e.upX.linearRampToValueAtTime(n.x,r),e.upY.linearRampToValueAtTime(n.y,r),e.upZ.linearRampToValueAtTime(n.z,r)}else e.setPosition(Bd.x,Bd.y,Bd.z),e.setOrientation(zd.x,zd.y,zd.z,n.x,n.y,n.z)}});function Rv(t){ft.call(this),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._pausedAt=0,this.filters=[]}Rv.prototype=Object.assign(Object.create(ft.prototype),{constructor:Rv,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setMediaElementSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this},setMediaStreamSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(t){if(t===void 0&&(t=0),this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+t;var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._pausedAt+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()},pause:function(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._pausedAt=(this.context.currentTime-this._startedAt)*this.playbackRate,this.source.stop(),this.source.onended=null,this.isPlaying=!1),this},stop:function(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._pausedAt=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),this.isPlaying===!0?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},setDetune:function(t){if(this.detune=t,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=t,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=t,this.isPlaying===!0&&(this.source.loop=this.loop),this},setLoopStart:function(t){return this.loopStart=t,this},setLoopEnd:function(t){return this.loopEnd=t,this},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}});var Vd=new j,LX=new is,h9e=new j,Ud=new j;function MP(t){Rv.call(this,t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}MP.prototype=Object.assign(Object.create(Rv.prototype),{constructor:MP,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){return this.panner.refDistance=t,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){return this.panner.rolloffFactor=t,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){return this.panner.distanceModel=t,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){return this.panner.maxDistance=t,this},setDirectionalCone:function(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(t){if(ft.prototype.updateMatrixWorld.call(this,t),!(this.hasPlaybackControl===!0&&this.isPlaying===!1)){this.matrixWorld.decompose(Vd,LX,h9e),Ud.set(0,0,1).applyQuaternion(LX);var e=this.panner;if(e.positionX){var n=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(Vd.x,n),e.positionY.linearRampToValueAtTime(Vd.y,n),e.positionZ.linearRampToValueAtTime(Vd.z,n),e.orientationX.linearRampToValueAtTime(Ud.x,n),e.orientationY.linearRampToValueAtTime(Ud.y,n),e.orientationZ.linearRampToValueAtTime(Ud.z,n)}else e.setPosition(Vd.x,Vd.y,Vd.z),e.setOrientation(Ud.x,Ud.y,Ud.z)}}});function IP(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e!==void 0?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}Object.assign(IP.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),n=0;n<e.length;n++)t+=e[n];return t/e.length}});function NP(t,e,n){this.binding=t,this.valueSize=n;var r=Float64Array,i;switch(e){case"quaternion":i=this._slerp;break;case"string":case"bool":r=Array,i=this._select;break;default:i=this._lerp}this.buffer=new r(n*4),this._mixBufferRegion=i,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Object.assign(NP.prototype,{accumulate:function(t,e){var n=this.buffer,r=this.valueSize,i=t*r+r,s=this.cumulativeWeight;if(s===0){for(var o=0;o!==r;++o)n[i+o]=n[o];s=e}else{s+=e;var a=e/s;this._mixBufferRegion(n,i,0,a,r)}this.cumulativeWeight=s},apply:function(t){var e=this.valueSize,n=this.buffer,r=t*e+e,i=this.cumulativeWeight,s=this.binding;if(this.cumulativeWeight=0,i<1){var o=e*3;this._mixBufferRegion(n,r,o,1-i,e)}for(var a=e,l=e+e;a!==l;++a)if(n[a]!==n[a+e]){s.setValue(n,r);break}},saveOriginalState:function(){var t=this.binding,e=this.buffer,n=this.valueSize,r=n*3;t.getValue(e,r);for(var i=n,s=r;i!==s;++i)e[i]=e[r+i%n];this.cumulativeWeight=0},restoreOriginalState:function(){var t=this.valueSize*3;this.binding.setValue(this.buffer,t)},_select:function(t,e,n,r,i){if(r>=.5)for(var s=0;s!==i;++s)t[e+s]=t[n+s]},_slerp:function(t,e,n,r){is.slerpFlat(t,e,t,e,t,n,r)},_lerp:function(t,e,n,r,i){for(var s=1-r,o=0;o!==i;++o){var a=e+o;t[a]=t[a]*s+t[n+o]*r}}});var $P="\\[\\]\\.:\\/",f9e=new RegExp("["+$P+"]","g"),RP="[^"+$P+"]",d9e="[^"+$P.replace("\\.","")+"]",p9e=/((?:WC+[\/:])*)/.source.replace("WC",RP),m9e=/(WCOD+)?/.source.replace("WCOD",d9e),g9e=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",RP),v9e=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",RP),y9e=new RegExp("^"+p9e+m9e+g9e+v9e+"$"),b9e=["material","materials","bones"];function BX(t,e,n){var r=n||As.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}Object.assign(BX.prototype,{getValue:function(t,e){this.bind();var n=this._targetGroup.nCachedObjects_,r=this._bindings[n];r!==void 0&&r.getValue(t,e)},setValue:function(t,e){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}});function As(t,e,n){this.path=e,this.parsedPath=n||As.parseTrackName(e),this.node=As.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}Object.assign(As,{Composite:BX,create:function(t,e,n){return t&&t.isAnimationObjectGroup?new As.Composite(t,e,n):new As(t,e,n)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(f9e,"")},parseTrackName:function(t){var e=y9e.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){var i=n.nodeName.substring(r+1);b9e.indexOf(i)!==-1&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=i)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n},findNode:function(t,e){if(!e||e===""||e==="root"||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){var n=t.skeleton.getBoneByName(e);if(n!==void 0)return n}if(t.children){var r=function(s){for(var o=0;o<s.length;o++){var a=s[o];if(a.name===e||a.uuid===e)return a;var l=r(a.children);if(l)return l}return null},i=r(t.children);if(i)return i}return null}});Object.assign(As.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,n){e[n]=this.node[this.propertyName]},function(e,n){for(var r=this.resolvedProperty,i=0,s=r.length;i!==s;++i)e[n++]=r[i]},function(e,n){e[n]=this.resolvedProperty[this.propertyIndex]},function(e,n){this.resolvedProperty.toArray(e,n)}],SetterByBindingTypeAndVersioning:[[function(e,n){this.targetObject[this.propertyName]=e[n]},function(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.needsUpdate=!0},function(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,n){for(var r=this.resolvedProperty,i=0,s=r.length;i!==s;++i)r[i]=e[n++]},function(e,n){for(var r=this.resolvedProperty,i=0,s=r.length;i!==s;++i)r[i]=e[n++];this.targetObject.needsUpdate=!0},function(e,n){for(var r=this.resolvedProperty,i=0,s=r.length;i!==s;++i)r[i]=e[n++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,n){this.resolvedProperty[this.propertyIndex]=e[n]},function(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.needsUpdate=!0},function(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,n){this.resolvedProperty.fromArray(e,n)},function(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.needsUpdate=!0},function(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,n){this.bind(),this.getValue(e,n)},setValue:function(e,n){this.bind(),this.setValue(e,n)},bind:function(){var t=this.node,e=this.parsedPath,n=e.objectName,r=e.propertyName,i=e.propertyIndex;if(t||(t=As.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(n){var s=e.objectIndex;switch(n){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(var o=0;o<t.length;o++)if(t[o].name===s){s=o;break}break;default:if(t[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[n]}if(s!==void 0){if(t[s]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[s]}}var a=t[r];if(a===void 0){var l=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+r+" but it wasn't found.",t);return}var c=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?c=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(c=this.Versioning.MatrixWorldNeedsUpdate);var u=this.BindingType.Direct;if(i!==void 0){if(r==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}for(var o=0;o<this.node.geometry.morphAttributes.position.length;o++)if(t.geometry.morphAttributes.position[o].name===i){i=o;break}}else{if(!t.geometry.morphTargets){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);return}for(var o=0;o<this.node.geometry.morphTargets.length;o++)if(t.geometry.morphTargets[o].name===i){i=o;break}}}u=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=i}else a.fromArray!==void 0&&a.toArray!==void 0?(u=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(u=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][c]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}});//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(As.prototype,{_getValue_unbound:As.prototype.getValue,_setValue_unbound:As.prototype.setValue});function zX(){this.uuid=ln.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}Object.assign(zX.prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=this._objects,e=t.length,n=this.nCachedObjects_,r=this._indicesByUUID,i=this._paths,s=this._parsedPaths,o=this._bindings,a=o.length,l=void 0,c=0,u=arguments.length;c!==u;++c){var h=arguments[c],f=h.uuid,d=r[f];if(d===void 0){d=e++,r[f]=d,t.push(h);for(var p=0,m=a;p!==m;++p)o[p].push(new As(h,i[p],s[p]))}else if(d<n){l=t[d];var v=--n,y=t[v];r[y.uuid]=d,t[d]=y,r[f]=v,t[v]=h;for(var p=0,m=a;p!==m;++p){var w=o[p],x=w[v],_=w[d];w[d]=x,_===void 0&&(_=new As(h,i[p],s[p])),w[v]=_}}else t[d]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(){for(var t=this._objects,e=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,i=r.length,s=0,o=arguments.length;s!==o;++s){var a=arguments[s],l=a.uuid,c=n[l];if(c!==void 0&&c>=e){var u=e++,h=t[u];n[h.uuid]=c,t[c]=h,n[l]=u,t[u]=a;for(var f=0,d=i;f!==d;++f){var p=r[f],m=p[u],v=p[c];p[c]=m,p[u]=v}}}this.nCachedObjects_=e},uncache:function(){for(var t=this._objects,e=t.length,n=this.nCachedObjects_,r=this._indicesByUUID,i=this._bindings,s=i.length,o=0,a=arguments.length;o!==a;++o){var l=arguments[o],c=l.uuid,u=r[c];if(u!==void 0)if(delete r[c],u<n){var h=--n,f=t[h],d=--e,p=t[d];r[f.uuid]=u,t[u]=f,r[p.uuid]=h,t[h]=p,t.pop();for(var m=0,v=s;m!==v;++m){var y=i[m],w=y[h],x=y[d];y[u]=w,y[h]=x,y.pop()}}else{var d=--e,p=t[d];r[p.uuid]=u,t[u]=p,t.pop();for(var m=0,v=s;m!==v;++m){var y=i[m];y[u]=y[d],y.pop()}}}this.nCachedObjects_=n},subscribe_:function(t,e){var n=this._bindingsIndicesByPath,r=n[t],i=this._bindings;if(r!==void 0)return i[r];var s=this._paths,o=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,u=new Array(l);r=i.length,n[t]=r,s.push(t),o.push(e),i.push(u);for(var h=c,f=a.length;h!==f;++h){var d=a[h];u[h]=new As(d,t,e)}return u},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,n=e[t];if(n!==void 0){var r=this._paths,i=this._parsedPaths,s=this._bindings,o=s.length-1,a=s[o],l=t[o];e[l]=n,s[n]=a,s.pop(),i[n]=i[o],i.pop(),r[n]=r[o],r.pop()}}});function VX(t,e,n){this._mixer=t,this._clip=e,this._localRoot=n||null;for(var r=e.tracks,i=r.length,s=new Array(i),o={endingStart:od,endingEnd:od},a=0;a!==i;++a){var l=r[a].createInterpolant(null);s[a]=l,l.settings=o}this._interpolantSettings=o,this._interpolants=s,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=b7,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}Object.assign(VX.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){var r=this._clip.duration,i=t._clip.duration,s=i/r,o=r/i;t.warp(1,s,e),this.warp(o,1,e)}return this},crossFadeTo:function(t,e,n){return t.crossFadeFrom(this,e,n)},stopFading:function(){var t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,n){var r=this._mixer,i=r.time,s=this._timeScaleInterpolant,o=this.timeScale;s===null&&(s=r._lendControlInterpolant(),this._timeScaleInterpolant=s);var a=s.parameterPositions,l=s.sampleValues;return a[0]=i,a[1]=i+n,l[0]=t/o,l[1]=e/o,this},stopWarping:function(){var t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,n,r){if(!this.enabled){this._updateWeight(t);return}var i=this._startTime;if(i!==null){var s=(t-i)*n;if(s<0||n===0)return;this._startTime=null,e=n*s}e*=this._updateTimeScale(t);var o=this._updateTime(e),a=this._updateWeight(t);if(a>0)for(var l=this._interpolants,c=this._propertyBindings,u=0,h=l.length;u!==h;++u)l[u].evaluate(o),c[u].accumulate(r,a)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var n=this._weightInterpolant;if(n!==null){var r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var n=this._timeScaleInterpolant;if(n!==null){var r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopWarping(),e===0?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e},_updateTime:function(t){var e=this.time+t,n=this._clip.duration,r=this.loop,i=this._loopCount,s=r===w7;if(t===0)return i===-1?e:s&&(i&1)==1?n-e:e;if(r===y7){i===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(e>=n)e=n;else if(e<0)e=0;else{this.time=e;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(i===-1&&(t>=0?(i=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),e>=n||e<0){var o=Math.floor(e/n);e-=n*o,i+=Math.abs(o);var a=this.repetitions-i;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=t>0?n:0,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(a===1){var l=t<0;this._setEndings(l,!l,s)}else this._setEndings(!1,!1,s);this._loopCount=i,this.time=e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=e;if(s&&(i&1)==1)return n-e}return e},_setEndings:function(t,e,n){var r=this._interpolantSettings;n?(r.endingStart=ad,r.endingEnd=ad):(t?r.endingStart=this.zeroSlopeAtStart?ad:od:r.endingStart=Pw,e?r.endingEnd=this.zeroSlopeAtEnd?ad:od:r.endingEnd=Pw)},_scheduleFading:function(t,e,n){var r=this._mixer,i=r.time,s=this._weightInterpolant;s===null&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);var o=s.parameterPositions,a=s.sampleValues;return o[0]=i,a[0]=e,o[1]=i+t,a[1]=n,this}});function DP(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}DP.prototype=Object.assign(Object.create(Aa.prototype),{constructor:DP,_bindAction:function(t,e){var n=t._localRoot||this._root,r=t._clip.tracks,i=r.length,s=t._propertyBindings,o=t._interpolants,a=n.uuid,l=this._bindingsByRootAndName,c=l[a];c===void 0&&(c={},l[a]=c);for(var u=0;u!==i;++u){var h=r[u],f=h.name,d=c[f];if(d!==void 0)s[u]=d;else{if(d=s[u],d!==void 0){d._cacheIndex===null&&(++d.referenceCount,this._addInactiveBinding(d,a,f));continue}var p=e&&e._propertyBindings[u].binding.parsedPath;d=new NP(As.create(n,f,p),h.ValueTypeName,h.getValueSize()),++d.referenceCount,this._addInactiveBinding(d,a,f),s[u]=d}o[u].resultBuffer=d.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){var e=(t._localRoot||this._root).uuid,n=t._clip.uuid,r=this._actionsByClip[n];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,n,e)}for(var i=t._propertyBindings,s=0,o=i.length;s!==o;++s){var a=i[s];a.useCount++==0&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,n=0,r=e.length;n!==r;++n){var i=e[n];--i.useCount==0&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return e!==null&&e<this._nActiveActions},_addInactiveAction:function(t,e,n){var r=this._actions,i=this._actionsByClip,s=i[e];if(s===void 0)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=s;else{var o=s.knownActions;t._byClipCacheIndex=o.length,o.push(t)}t._cacheIndex=r.length,r.push(t),s.actionByRoot[n]=t},_removeInactiveAction:function(t){var e=this._actions,n=e[e.length-1],r=t._cacheIndex;n._cacheIndex=r,e[r]=n,e.pop(),t._cacheIndex=null;var i=t._clip.uuid,s=this._actionsByClip,o=s[i],a=o.knownActions,l=a[a.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),t._byClipCacheIndex=null;var u=o.actionByRoot,h=(t._localRoot||this._root).uuid;delete u[h],a.length===0&&delete s[i],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,n=0,r=e.length;n!==r;++n){var i=e[n];--i.referenceCount==0&&this._removeInactiveBinding(i)}},_lendAction:function(t){var e=this._actions,n=t._cacheIndex,r=this._nActiveActions++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_takeBackAction:function(t){var e=this._actions,n=t._cacheIndex,r=--this._nActiveActions,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_addInactiveBinding:function(t,e,n){var r=this._bindingsByRootAndName,i=r[e],s=this._bindings;i===void 0&&(i={},r[e]=i),i[n]=t,t._cacheIndex=s.length,s.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,n=t.binding,r=n.rootNode.uuid,i=n.path,s=this._bindingsByRootAndName,o=s[r],a=e[e.length-1],l=t._cacheIndex;a._cacheIndex=l,e[l]=a,e.pop(),delete o[i],Object.keys(o).length===0&&delete s[r]},_lendBinding:function(t){var e=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_takeBackBinding:function(t){var e=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,n=t[e];return n===void 0&&(n=new Mx(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=e,t[e]=n),n},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,i=e[r];t.__cacheIndex=r,e[r]=t,i.__cacheIndex=n,e[n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e){var n=e||this._root,r=n.uuid,i=typeof t=="string"?Na.findByName(n,t):t,s=i!==null?i.uuid:t,o=this._actionsByClip[s],a=null;if(o!==void 0){var l=o.actionByRoot[r];if(l!==void 0)return l;a=o.knownActions[0],i===null&&(i=a._clip)}if(i===null)return null;var c=new VX(this,i,e);return this._bindAction(c,a),this._addInactiveAction(c,s,r),c},existingAction:function(t,e){var n=e||this._root,r=n.uuid,i=typeof t=="string"?Na.findByName(n,t):t,s=i?i.uuid:t,o=this._actionsByClip[s];return o!==void 0&&o.actionByRoot[r]||null},stopAllAction:function(){var t=this._actions,e=this._nActiveActions,n=this._bindings,r=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==e;++i)t[i].reset();for(var i=0;i!==r;++i)n[i].useCount=0;return this},update:function(t){t*=this.timeScale;for(var e=this._actions,n=this._nActiveActions,r=this.time+=t,i=Math.sign(t),s=this._accuIndex^=1,o=0;o!==n;++o){var a=e[o];a._update(r,t,i,s)}for(var l=this._bindings,c=this._nActiveBindings,o=0;o!==c;++o)l[o].apply(s);return this},setTime:function(t){this.time=0;for(var e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,n=t.uuid,r=this._actionsByClip,i=r[n];if(i!==void 0){for(var s=i.knownActions,o=0,a=s.length;o!==a;++o){var l=s[o];this._deactivateAction(l);var c=l._cacheIndex,u=e[e.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,e[c]=u,e.pop(),this._removeInactiveBindingsForAction(l)}delete r[n]}},uncacheRoot:function(t){var e=t.uuid,n=this._actionsByClip;for(var r in n){var i=n[r].actionByRoot,s=i[e];s!==void 0&&(this._deactivateAction(s),this._removeInactiveAction(s))}var o=this._bindingsByRootAndName,a=o[e];if(a!==void 0)for(var l in a){var c=a[l];c.restoreOriginalState(),this._removeInactiveBinding(c)}},uncacheAction:function(t,e){var n=this.existingAction(t,e);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}});function ek(t){typeof t=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}ek.prototype.clone=function(){return new ek(this.value.clone===void 0?this.value:this.value.clone())};function PP(t,e,n){cu.call(this,t,e),this.meshPerAttribute=n||1}PP.prototype=Object.assign(Object.create(cu.prototype),{constructor:PP,isInstancedInterleavedBuffer:!0,copy:function(t){return cu.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}});function UX(t,e,n,r){this.ray=new dd(t,e),this.near=n||0,this.far=r||1/0,this.camera=null,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function WX(t,e){return t.distance-e.distance}function OP(t,e,n,r){if(t.visible!==!1&&(t.raycast(e,n),r===!0))for(var i=t.children,s=0,o=i.length;s<o;s++)OP(i[s],e,n,!0)}Object.assign(UX.prototype,{linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e,n){var r=n||[];return OP(t,this,r,e),r.sort(WX),r},intersectObjects:function(t,e,n){var r=n||[];if(Array.isArray(t)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(var i=0,s=t.length;i<s;i++)OP(t[i],this,r,e);return r.sort(WX),r}});function tk(t,e,n){return this.radius=t!==void 0?t:1,this.phi=e!==void 0?e:0,this.theta=n!==void 0?n:0,this}Object.assign(tk.prototype,{set:function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){var t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(ln.clamp(e/this.radius,-1,1))),this}});function GX(t,e,n){return this.radius=t!==void 0?t:1,this.theta=e!==void 0?e:0,this.y=n!==void 0?n:0,this}Object.assign(GX.prototype,{set:function(t,e,n){return this.radius=t,this.theta=e,this.y=n,this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this}});var HX=new $e;function FP(t,e){this.min=t!==void 0?t:new $e(1/0,1/0),this.max=e!==void 0?e:new $e(-1/0,-1/0)}Object.assign(FP.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){var n=HX.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return t===void 0&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new $e),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return t===void 0&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new $e),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return e===void 0&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new $e),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return e===void 0&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new $e),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){var e=HX.copy(t).clamp(this.min,this.max);return e.sub(t).length()},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var jX=new j,nk=new j;function LP(t,e){this.start=t!==void 0?t:new j,this.end=e!==void 0?e:new j}Object.assign(LP.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return t===void 0&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new j),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return t===void 0&&(console.warn("THREE.Line3: .delta() target is now required"),t=new j),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return e===void 0&&(console.warn("THREE.Line3: .at() target is now required"),e=new j),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(t,e){jX.subVectors(t,this.start),nk.subVectors(this.end,this.start);var n=nk.dot(nk),r=nk.dot(jX),i=r/n;return e&&(i=ln.clamp(i,0,1)),i},closestPointToPoint:function(t,e,n){var r=this.closestPointToPointParameter(t,e);return n===void 0&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new j),this.delta(n).multiplyScalar(r).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}});function Rx(t){ft.call(this),this.material=t,this.render=function(){}}Rx.prototype=Object.create(ft.prototype);Rx.prototype.constructor=Rx;Rx.prototype.isImmediateRenderObject=!0;var qX=new j;function Dv(t,e){ft.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;for(var n=new wt,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,s=1,o=32;i<o;i++,s++){var a=i/o*Math.PI*2,l=s/o*Math.PI*2;r.push(Math.cos(a),Math.sin(a),1,Math.cos(l),Math.sin(l),1)}n.setAttribute("position",new ut(r,3));var c=new Fr({fog:!1});this.cone=new Vr(n,c),this.add(this.cone),this.update()}Dv.prototype=Object.create(ft.prototype);Dv.prototype.constructor=Dv;Dv.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()};Dv.prototype.update=function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),qX.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(qX),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var Oh=new j,rk=new vn,BP=new vn;function XX(t){var e=[];t&&t.isBone&&e.push(t);for(var n=0;n<t.children.length;n++)e.push.apply(e,XX(t.children[n]));return e}function Pv(t){for(var e=XX(t),n=new wt,r=[],i=[],s=new yt(0,0,1),o=new yt(0,1,0),a=0;a<e.length;a++){var l=e[a];l.parent&&l.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(s.r,s.g,s.b),i.push(o.r,o.g,o.b))}n.setAttribute("position",new ut(r,3)),n.setAttribute("color",new ut(i,3));var c=new Fr({vertexColors:Dg,depthTest:!1,depthWrite:!1,transparent:!0});Vr.call(this,n,c),this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}Pv.prototype=Object.create(Vr.prototype);Pv.prototype.constructor=Pv;Pv.prototype.updateMatrixWorld=function(t){var e=this.bones,n=this.geometry,r=n.getAttribute("position");BP.getInverse(this.root.matrixWorld);for(var i=0,s=0;i<e.length;i++){var o=e[i];o.parent&&o.parent.isBone&&(rk.multiplyMatrices(BP,o.matrixWorld),Oh.setFromMatrixPosition(rk),r.setXYZ(s,Oh.x,Oh.y,Oh.z),rk.multiplyMatrices(BP,o.parent.matrixWorld),Oh.setFromMatrixPosition(rk),r.setXYZ(s+1,Oh.x,Oh.y,Oh.z),s+=2)}n.getAttribute("position").needsUpdate=!0,ft.prototype.updateMatrixWorld.call(this,t)};function Ov(t,e,n){this.light=t,this.light.updateMatrixWorld(),this.color=n;var r=new kd(e,4,2),i=new Ma({wireframe:!0,fog:!1});Or.call(this,r,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}Ov.prototype=Object.create(Or.prototype);Ov.prototype.constructor=Ov;Ov.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()};Ov.prototype.update=function(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)};var w9e=new j,KX=new yt,YX=new yt;function Fv(t,e,n){ft.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;var r=new Sd(e);r.rotateY(Math.PI*.5),this.material=new Ma({wireframe:!0,fog:!1}),this.color===void 0&&(this.material.vertexColors=Dg);var i=r.getAttribute("position"),s=new Float32Array(i.count*3);r.setAttribute("color",new qt(s,3)),this.add(new Or(r,this.material)),this.update()}Fv.prototype=Object.create(ft.prototype);Fv.prototype.constructor=Fv;Fv.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()};Fv.prototype.update=function(){var t=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{var e=t.geometry.getAttribute("color");KX.copy(this.light.color),YX.copy(this.light.groundColor);for(var n=0,r=e.count;n<r;n++){var i=n<r/2?KX:YX;e.setXYZ(n,i.r,i.g,i.b)}e.needsUpdate=!0}t.lookAt(w9e.setFromMatrixPosition(this.light.matrixWorld).negate())};function ik(t,e,n,r){t=t||10,e=e||10,n=new yt(n!==void 0?n:4473924),r=new yt(r!==void 0?r:8947848);for(var i=e/2,s=t/e,o=t/2,a=[],l=[],c=0,u=0,h=-o;c<=e;c++,h+=s){a.push(-o,0,h,o,0,h),a.push(h,0,-o,h,0,o);var f=c===i?n:r;f.toArray(l,u),u+=3,f.toArray(l,u),u+=3,f.toArray(l,u),u+=3,f.toArray(l,u),u+=3}var d=new wt;d.setAttribute("position",new ut(a,3)),d.setAttribute("color",new ut(l,3));var p=new Fr({vertexColors:Dg});Vr.call(this,d,p)}ik.prototype=Object.assign(Object.create(Vr.prototype),{constructor:ik,copy:function(t){return Vr.prototype.copy.call(this,t),this.geometry.copy(t.geometry),this.material.copy(t.material),this},clone:function(){return new this.constructor().copy(this)}});function sk(t,e,n,r,i,s){t=t||10,e=e||16,n=n||8,r=r||64,i=new yt(i!==void 0?i:4473924),s=new yt(s!==void 0?s:8947848);var o=[],a=[],l,c,u,h,f,d,p;for(h=0;h<=e;h++)u=h/e*(Math.PI*2),l=Math.sin(u)*t,c=Math.cos(u)*t,o.push(0,0,0),o.push(l,0,c),p=h&1?i:s,a.push(p.r,p.g,p.b),a.push(p.r,p.g,p.b);for(h=0;h<=n;h++)for(p=h&1?i:s,d=t-t/n*h,f=0;f<r;f++)u=f/r*(Math.PI*2),l=Math.sin(u)*d,c=Math.cos(u)*d,o.push(l,0,c),a.push(p.r,p.g,p.b),u=(f+1)/r*(Math.PI*2),l=Math.sin(u)*d,c=Math.cos(u)*d,o.push(l,0,c),a.push(p.r,p.g,p.b);var m=new wt;m.setAttribute("position",new ut(o,3)),m.setAttribute("color",new ut(a,3));var v=new Fr({vertexColors:Dg});Vr.call(this,m,v)}sk.prototype=Object.create(Vr.prototype);sk.prototype.constructor=sk;var ZX=new j,ok=new j,JX=new j;function Lv(t,e,n){ft.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,e===void 0&&(e=1);var r=new wt;r.setAttribute("position",new ut([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var i=new Fr({fog:!1});this.lightPlane=new Wo(r,i),this.add(this.lightPlane),r=new wt,r.setAttribute("position",new ut([0,0,0,0,0,1],3)),this.targetLine=new Wo(r,i),this.add(this.targetLine),this.update()}Lv.prototype=Object.create(ft.prototype);Lv.prototype.constructor=Lv;Lv.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()};Lv.prototype.update=function(){ZX.setFromMatrixPosition(this.light.matrixWorld),ok.setFromMatrixPosition(this.light.target.matrixWorld),JX.subVectors(ok,ZX),this.lightPlane.lookAt(ok),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(ok),this.targetLine.scale.z=JX.length()};var ak=new j,Kr=new oc;function Dx(t){var e=new wt,n=new Fr({color:16777215,vertexColors:mq}),r=[],i=[],s={},o=new yt(16755200),a=new yt(16711680),l=new yt(43775),c=new yt(16777215),u=new yt(3355443);h("n1","n2",o),h("n2","n4",o),h("n4","n3",o),h("n3","n1",o),h("f1","f2",o),h("f2","f4",o),h("f4","f3",o),h("f3","f1",o),h("n1","f1",o),h("n2","f2",o),h("n3","f3",o),h("n4","f4",o),h("p","n1",a),h("p","n2",a),h("p","n3",a),h("p","n4",a),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",c),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u);function h(d,p,m){f(d,m),f(p,m)}function f(d,p){r.push(0,0,0),i.push(p.r,p.g,p.b),s[d]===void 0&&(s[d]=[]),s[d].push(r.length/3-1)}e.setAttribute("position",new ut(r,3)),e.setAttribute("color",new ut(i,3)),Vr.call(this,e,n),this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}Dx.prototype=Object.create(Vr.prototype);Dx.prototype.constructor=Dx;Dx.prototype.update=function(){var t=this.geometry,e=this.pointMap,n=1,r=1;Kr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ci("c",e,t,Kr,0,0,-1),ci("t",e,t,Kr,0,0,1),ci("n1",e,t,Kr,-n,-r,-1),ci("n2",e,t,Kr,n,-r,-1),ci("n3",e,t,Kr,-n,r,-1),ci("n4",e,t,Kr,n,r,-1),ci("f1",e,t,Kr,-n,-r,1),ci("f2",e,t,Kr,n,-r,1),ci("f3",e,t,Kr,-n,r,1),ci("f4",e,t,Kr,n,r,1),ci("u1",e,t,Kr,n*.7,r*1.1,-1),ci("u2",e,t,Kr,-n*.7,r*1.1,-1),ci("u3",e,t,Kr,0,r*2,-1),ci("cf1",e,t,Kr,-n,0,1),ci("cf2",e,t,Kr,n,0,1),ci("cf3",e,t,Kr,0,-r,1),ci("cf4",e,t,Kr,0,r,1),ci("cn1",e,t,Kr,-n,0,-1),ci("cn2",e,t,Kr,n,0,-1),ci("cn3",e,t,Kr,0,-r,-1),ci("cn4",e,t,Kr,0,r,-1),t.getAttribute("position").needsUpdate=!0};function ci(t,e,n,r,i,s,o){ak.set(i,s,o).unproject(r);var a=e[t];if(a!==void 0)for(var l=n.getAttribute("position"),c=0,u=a.length;c<u;c++)l.setXYZ(a[c],ak.x,ak.y,ak.z)}var lk=new gl;function pu(t,e){this.object=t,e===void 0&&(e=16776960);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(8*3),i=new wt;i.setIndex(new qt(n,1)),i.setAttribute("position",new qt(r,3)),Vr.call(this,i,new Fr({color:e})),this.matrixAutoUpdate=!1,this.update()}pu.prototype=Object.create(Vr.prototype);pu.prototype.constructor=pu;pu.prototype.update=function(t){if(t!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&lk.setFromObject(this.object),!lk.isEmpty()){var e=lk.min,n=lk.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=e.x,i[4]=n.y,i[5]=n.z,i[6]=e.x,i[7]=e.y,i[8]=n.z,i[9]=n.x,i[10]=e.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=e.z,i[15]=e.x,i[16]=n.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=n.x,i[22]=e.y,i[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}};pu.prototype.setFromObject=function(t){return this.object=t,this.update(),this};pu.prototype.copy=function(t){return Vr.prototype.copy.call(this,t),this.object=t.object,this};pu.prototype.clone=function(){return new this.constructor().copy(this)};function Px(t,e){this.type="Box3Helper",this.box=t,e=e||16776960;var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],i=new wt;i.setIndex(new qt(n,1)),i.setAttribute("position",new ut(r,3)),Vr.call(this,i,new Fr({color:e})),this.geometry.computeBoundingSphere()}Px.prototype=Object.create(Vr.prototype);Px.prototype.constructor=Px;Px.prototype.updateMatrixWorld=function(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),ft.prototype.updateMatrixWorld.call(this,t))};function Ox(t,e,n){this.type="PlaneHelper",this.plane=t,this.size=e===void 0?1:e;var r=n!==void 0?n:16776960,i=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],s=new wt;s.setAttribute("position",new ut(i,3)),s.computeBoundingSphere(),Wo.call(this,s,new Fr({color:r}));var o=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],a=new wt;a.setAttribute("position",new ut(o,3)),a.computeBoundingSphere(),this.add(new Or(a,new Ma({color:r,opacity:.2,transparent:!0,depthWrite:!1})))}Ox.prototype=Object.create(Wo.prototype);Ox.prototype.constructor=Ox;Ox.prototype.updateMatrixWorld=function(t){var e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?Pi:Rg,this.lookAt(this.plane.normal),ft.prototype.updateMatrixWorld.call(this,t)};var QX=new j,ck,zP;function mu(t,e,n,r,i,s){ft.call(this),t===void 0&&(t=new j(0,0,1)),e===void 0&&(e=new j(0,0,0)),n===void 0&&(n=1),r===void 0&&(r=16776960),i===void 0&&(i=.2*n),s===void 0&&(s=.2*i),ck===void 0&&(ck=new wt,ck.setAttribute("position",new ut([0,0,0,0,1,0],3)),zP=new hu(0,.5,1,5,1),zP.translate(0,-.5,0)),this.position.copy(e),this.line=new Wo(ck,new Fr({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Or(zP,new Ma({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,i,s)}mu.prototype=Object.create(ft.prototype);mu.prototype.constructor=mu;mu.prototype.setDirection=function(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{QX.set(t.z,0,-t.x).normalize();var e=Math.acos(t.y);this.quaternion.setFromAxisAngle(QX,e)}};mu.prototype.setLength=function(t,e,n){e===void 0&&(e=.2*t),n===void 0&&(n=.2*e),this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()};mu.prototype.setColor=function(t){this.line.material.color.set(t),this.cone.material.color.set(t)};mu.prototype.copy=function(t){return ft.prototype.copy.call(this,t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this};mu.prototype.clone=function(){return new this.constructor().copy(this)};function Fx(t){t=t||1;var e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new wt;r.setAttribute("position",new ut(e,3)),r.setAttribute("color",new ut(n,3));var i=new Fr({vertexColors:Dg});Vr.call(this,r,i)}Fx.prototype=Object.create(Vr.prototype);Fx.prototype.constructor=Fx;var Bv=4,Fh=8,dc=Math.pow(2,Fh),eK=[.125,.215,.35,.446,.526,.582],tK=Fh-Bv+1+eK.length,zv=20,pc={[fo]:0,[XT]:1,[KT]:2,[k3]:3,[A3]:4,[M3]:5,[E3]:6},VP=new $v,uk=C9e(zv),Lh=null,Bh=null,{_lodPlanes:Lx,_sizeLods:nK,_sigmas:hk}=x9e(),fk=null,pr=null,UP=null,Wd=(1+Math.sqrt(5))/2,Vv=1/Wd,rK=[new j(1,1,1),new j(-1,1,1),new j(1,1,-1),new j(-1,1,-1),new j(0,Wd,Vv),new j(0,Wd,-Vv),new j(Vv,0,Wd),new j(-Vv,0,Wd),new j(Wd,Vv,0),new j(-Wd,Vv,0)];function WP(t){pr=t,GP(uk)}WP.prototype={constructor:WP,fromScene:function(t,e=0,n=.1,r=100){UP=pr.getRenderTarget();var i=iK();return _9e(t,n,r,i),e>0&&lK(i,0,0,e),aK(i),sK(i),i},fromEquirectangular:function(t){return t.magFilter=li,t.minFilter=li,t.generateMipmaps=!1,this.fromCubemap(t)},fromCubemap:function(t){UP=pr.getRenderTarget();var e=iK(t);return S9e(t,e),aK(e),sK(e),e},compileCubemapShader:function(){Bh==null&&(Bh=hK(),GP(Bh))},compileEquirectangularShader:function(){Lh==null&&(Lh=uK(),GP(Lh))},dispose:function(){uk.dispose(),Bh!=null&&Bh.dispose(),Lh!=null&&Lh.dispose();for(var t=0;t<Lx.length;t++)Lx[t].dispose()}};function x9e(){for(var t=[],e=[],n=[],r=Fh,i=0;i<tK;i++){var s=Math.pow(2,r);e.push(s);var o=1/s;i>Fh-Bv?o=eK[i-Fh+Bv-1]:i==0&&(o=0),n.push(o);for(var a=1/(s-1),l=-a/2,c=1+a/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],h=6,f=6,d=3,p=2,m=1,v=new Float32Array(d*f*h),y=new Float32Array(p*f*h),w=new Float32Array(m*f*h),x=0;x<h;x++){var _=x%3*2/3-1,S=x>2?0:-1,T=[_,S,0,_+2/3,S,0,_+2/3,S+1,0,_,S,0,_+2/3,S+1,0,_,S+1,0];v.set(T,d*f*x),y.set(u,p*f*x);var E=[x,x,x,x,x,x];w.set(E,m*f*x)}var k=new wt;k.setAttribute("position",new qt(v,d)),k.setAttribute("uv",new qt(y,p)),k.setAttribute("faceIndex",new qt(w,m)),t.push(k),r>Bv&&r--}return{_lodPlanes:t,_sizeLods:e,_sigmas:n}}function iK(t){var e={magFilter:li,minFilter:li,generateMipmaps:!1,type:t?t.type:Iw,format:t?t.format:Yq,encoding:t?t.encoding:KT,depthBuffer:!1,stencilBuffer:!1},n=oK(e);return n.depthBuffer=!t,fk=oK(e),n}function sK(t){fk.dispose(),pr.setRenderTarget(UP),t.scissorTest=!1,t.setSize(t.width,t.height)}function _9e(t,e,n,r){var i=90,s=1,o=new Si(i,s,e,n),a=[1,1,1,1,-1,1],l=[1,1,-1,-1,-1,1],c=pr.outputEncoding,u=pr.toneMapping,h=pr.toneMappingExposure,f=pr.getClearColor(),d=pr.getClearAlpha();pr.toneMapping=LT,pr.toneMappingExposure=1,pr.outputEncoding=fo,t.scale.z*=-1;var p=t.background;if(p&&p.isColor){p.convertSRGBToLinear();var m=Math.max(p.r,p.g,p.b),v=Math.min(Math.max(Math.ceil(Math.log2(m)),-128),127);p=p.multiplyScalar(Math.pow(2,-v));var y=(v+128)/255;pr.setClearColor(p,y),t.background=null}for(var w=0;w<6;w++){var x=w%3;x==0?(o.up.set(0,a[w],0),o.lookAt(l[w],0,0)):x==1?(o.up.set(0,0,a[w]),o.lookAt(0,l[w],0)):(o.up.set(0,a[w],0),o.lookAt(0,0,l[w])),HP(r,x*dc,w>2?dc:0,dc,dc),pr.setRenderTarget(r),pr.render(t,o)}pr.toneMapping=u,pr.toneMappingExposure=h,pr.outputEncoding=c,pr.setClearColor(f,d),t.scale.z*=-1}function S9e(t,e){var n=new nu;t.isCubeTexture?Bh==null&&(Bh=hK()):Lh==null&&(Lh=uK());var r=t.isCubeTexture?Bh:Lh;n.add(new Or(Lx[0],r));var i=r.uniforms;i.envMap.value=t,t.isCubeTexture||i.texelSize.value.set(1/t.image.width,1/t.image.height),i.inputEncoding.value=pc[t.encoding],i.outputEncoding.value=pc[t.encoding],HP(e,0,0,3*dc,2*dc),pr.setRenderTarget(e),pr.render(n,VP)}function GP(t){var e=new nu;e.add(new Or(Lx[0],t)),pr.compile(e,VP)}function oK(t){var e=new Ts(3*dc,3*dc,t);return e.texture.mapping=Og,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function HP(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function aK(t){var e=pr.autoClear;pr.autoClear=!1;for(var n=1;n<tK;n++){var r=Math.sqrt(hk[n]*hk[n]-hk[n-1]*hk[n-1]),i=rK[(n-1)%rK.length];lK(t,n-1,n,r,i)}pr.autoClear=e}function lK(t,e,n,r,i){cK(t,fk,e,n,r,"latitudinal",i),cK(fk,t,n,n,r,"longitudinal",i)}function cK(t,e,n,r,i,s,o){s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");var a=3,l=new nu;l.add(new Or(Lx[r],uk));var c=uk.uniforms,u=nK[n]-1,h=isFinite(i)?Math.PI/(2*u):2*Math.PI/(2*zv-1),f=i/h,d=isFinite(i)?1+Math.floor(a*f):zv;d>zv&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${d} samples when the maximum is set to ${zv}`);for(var p=[],m=0,v=0;v<zv;++v){var x=v/f,y=Math.exp(-x*x/2);p.push(y),v==0?m+=y:v<d&&(m+=2*y)}for(var v=0;v<p.length;v++)p[v]=p[v]/m;c.envMap.value=t.texture,c.samples.value=d,c.weights.value=p,c.latitudinal.value=s==="latitudinal",o&&(c.poleAxis.value=o),c.dTheta.value=h,c.mipInt.value=Fh-n,c.inputEncoding.value=pc[t.texture.encoding],c.outputEncoding.value=pc[t.texture.encoding];var w=nK[r],x=3*Math.max(0,dc-2*w),_=(r===0?0:2*dc)+2*w*(r>Fh-Bv?r-Fh+Bv:0);HP(e,x,_,3*w,2*w),pr.setRenderTarget(e),pr.render(l,VP)}function C9e(t){var e=new Float32Array(t),n=new j(0,1,0),r=new fu({defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:pc[fo]},outputEncoding:{value:pc[fo]}},vertexShader:jP(),fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform sampler2D envMap;
uniform int samples;
uniform float weights[n];
uniform bool latitudinal;
uniform float dTheta;
uniform float mipInt;
uniform vec3 poleAxis;

${qP()}

#define ENVMAP_TYPE_CUBE_UV
#include <cube_uv_reflection_fragment>

void main() {
	gl_FragColor = vec4(0.0);
	for (int i = 0; i < n; i++) {
		if (i >= samples)
			break;
		for (int dir = -1; dir < 2; dir += 2) {
			if (i == 0 && dir == 1)
				continue;
			vec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);
			if (all(equal(axis, vec3(0.0))))
				axis = cross(vec3(0.0, 1.0, 0.0), vOutputDirection);
			axis = normalize(axis);
			float theta = dTheta * float(dir * i);
			float cosTheta = cos(theta);
			// Rodrigues' axis-angle rotation
			vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross(axis, vOutputDirection) * sin(theta)
					+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);
			gl_FragColor.rgb +=
					weights[i] * bilinearCubeUV(envMap, sampleDirection, mipInt);
		}
	}
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:eu,depthTest:!1,depthWrite:!1});return r.type="SphericalGaussianBlur",r}function uK(){var t=new $e(1,1),e=new fu({uniforms:{envMap:{value:null},texelSize:{value:t},inputEncoding:{value:pc[fo]},outputEncoding:{value:pc[fo]}},vertexShader:jP(),fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform sampler2D envMap;
uniform vec2 texelSize;

${qP()}

#define RECIPROCAL_PI 0.31830988618
#define RECIPROCAL_PI2 0.15915494

void main() {
	gl_FragColor = vec4(0.0);
	vec3 outputDirection = normalize(vOutputDirection);
	vec2 uv;
	uv.y = asin(clamp(outputDirection.y, -1.0, 1.0)) * RECIPROCAL_PI + 0.5;
	uv.x = atan(outputDirection.z, outputDirection.x) * RECIPROCAL_PI2 + 0.5;
	vec2 f = fract(uv / texelSize - 0.5);
	uv -= f * texelSize;
	vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.x += texelSize.x;
	vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.y += texelSize.y;
	vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.x -= texelSize.x;
	vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	vec3 tm = mix(tl, tr, f.x);
	vec3 bm = mix(bl, br, f.x);
	gl_FragColor.rgb = mix(tm, bm, f.y);
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:eu,depthTest:!1,depthWrite:!1});return e.type="EquirectangularToCubeUV",e}function hK(){var t=new fu({uniforms:{envMap:{value:null},inputEncoding:{value:pc[fo]},outputEncoding:{value:pc[fo]}},vertexShader:jP(),fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform samplerCube envMap;

${qP()}

void main() {
	gl_FragColor = vec4(0.0);
	gl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:eu,depthTest:!1,depthWrite:!1});return t.type="CubemapToCubeUV",t}function jP(){return`
precision mediump float;
precision mediump int;
attribute vec3 position;
attribute vec2 uv;
attribute float faceIndex;
varying vec3 vOutputDirection;
vec3 getDirection(vec2 uv, float face) {
	uv = 2.0 * uv - 1.0;
	vec3 direction = vec3(uv, 1.0);
	if (face == 0.0) {
		direction = direction.zyx;
		direction.z *= -1.0;
	} else if (face == 1.0) {
		direction = direction.xzy;
		direction.z *= -1.0;
	} else if (face == 3.0) {
		direction = direction.zyx;
		direction.x *= -1.0;
	} else if (face == 4.0) {
		direction = direction.xzy;
		direction.y *= -1.0;
	} else if (face == 5.0) {
		direction.xz *= -1.0;
	}
	return direction;
}
void main() {
	vOutputDirection = getDirection(uv, faceIndex);
	gl_Position = vec4( position, 1.0 );
}
	`}function qP(){return`
uniform int inputEncoding;
uniform int outputEncoding;

#include <encodings_pars_fragment>

vec4 inputTexelToLinear(vec4 value){
	if(inputEncoding == 0){
		return value;
	}else if(inputEncoding == 1){
		return sRGBToLinear(value);
	}else if(inputEncoding == 2){
		return RGBEToLinear(value);
	}else if(inputEncoding == 3){
		return RGBMToLinear(value, 7.0);
	}else if(inputEncoding == 4){
		return RGBMToLinear(value, 16.0);
	}else if(inputEncoding == 5){
		return RGBDToLinear(value, 256.0);
	}else{
		return GammaToLinear(value, 2.2);
	}
}

vec4 linearToOutputTexel(vec4 value){
	if(outputEncoding == 0){
		return value;
	}else if(outputEncoding == 1){
		return LinearTosRGB(value);
	}else if(outputEncoding == 2){
		return LinearToRGBE(value);
	}else if(outputEncoding == 3){
		return LinearToRGBM(value, 7.0);
	}else if(outputEncoding == 4){
		return LinearToRGBM(value, 16.0);
	}else if(outputEncoding == 5){
		return LinearToRGBD(value, 256.0);
	}else{
		return LinearToGamma(value, 2.2);
	}
}

vec4 envMapTexelToLinear(vec4 color) {
	return inputTexelToLinear(color);
}
	`}function T9e(t,e,n,r,i,s,o){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new qg(t,e,n,i,s,o)}var E9e=0,k9e=1;function A9e(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t}function M9e(t){return t===void 0&&(t=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t}function I9e(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new dv(t,e)}function N9e(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new rx(t)}function $9e(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new dv(t,e)}function R9e(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new wl(t)}function D9e(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new wl(t)}function P9e(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new wl(t)}function O9e(t,e,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new j(t,e,n)}function F9e(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new qt(t,e).setUsage(cd)}function L9e(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Vw(t,e)}function B9e(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Uw(t,e)}function z9e(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Ww(t,e)}function V9e(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Gw(t,e)}function U9e(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new pd(t,e)}function W9e(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Hw(t,e)}function G9e(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new md(t,e)}function H9e(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new ut(t,e)}function j9e(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new jw(t,e)}Pt.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Pt.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t};Object.assign(du.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var e=new Yt,n=0,r=t.length;n<r;n++){var i=t[n];e.vertices.push(new j(i.x,i.y,i.z||0))}return e}});Object.assign(El.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}});function fK(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),ks.call(this,t),this.type="catmullrom",this.closed=!0}fK.prototype=Object.create(ks.prototype);function dK(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),ks.call(this,t),this.type="catmullrom"}dK.prototype=Object.create(ks.prototype);function XP(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),ks.call(this,t),this.type="catmullrom"}XP.prototype=Object.create(ks.prototype);Object.assign(XP.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}});function q9e(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Fx(t)}function X9e(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new pu(t,e)}function K9e(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Vr(new Ev(t.geometry),new Fr({color:e!==void 0?e:16777215}))}ik.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};Pv.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};function Y9e(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Vr(new mv(t.geometry),new Fr({color:e!==void 0?e:16777215}))}Object.assign(Xn.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),yP.extractUrlBase(t)}});Xn.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};function Z9e(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new $a(t)}function J9e(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new DE(t)}Object.assign(YE.prototype,{setTexturePath:function(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}});Object.assign(FP.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}});Object.assign(gl.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}});rv.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)};LP.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)};Object.assign(ln,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),ln.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),ln.ceilPowerOfTwo(t)}});Object.assign(rs.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}});Object.assign(vn.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new j().setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,n,r,i,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,r,n,i,s)}});vl.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)};is.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)};Object.assign(dd.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}});Object.assign(qi.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}});Object.assign(qi,{barycoordFromPoint:function(t,e,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),qi.getBarycoord(t,e,n,r,i)},normal:function(t,e,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),qi.getNormal(t,e,n,r)}});Object.assign(Ph.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Ed(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Ad(this,t)}});Object.assign($e.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}});Object.assign(j.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}});Object.assign(lr.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}});Object.assign(Yt.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}});Object.assign(ft.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}});Object.defineProperties(ft.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Object.assign(Or.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}});Object.defineProperties(Or.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),x7},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});Object.defineProperties(ix.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}});Object.defineProperty(bE.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}});sx.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};Object.defineProperty(Pt.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}});Si.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(t)};Object.defineProperties(xr.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}});Object.defineProperties(qt.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===cd},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(cd)}}});Object.assign(qt.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(t===!0?cd:Ow),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}});Object.assign(wt.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(e&&e.isBufferAttribute)&&!(e&&e.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new qt(arguments[1],arguments[2]))):t==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e)},addDrawCall:function(t,e,n){n!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},applyMatrix:function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}});Object.defineProperties(wt.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});Object.defineProperties(cu.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===cd},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}});Object.assign(cu.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(t===!0?cd:Ow),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}});Object.assign(lc.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}});Object.defineProperties(ek.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}});Object.defineProperties(jt.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new yt}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===s3}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}});Object.defineProperties(Dh.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(Gs.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}});Object.assign(tP.prototype,{clearTarget:function(t,e,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,r)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}});Object.defineProperties(tP.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=t===!0?XT:fo}}});Object.defineProperties(lX.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});function Q9e(t,e,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Mh(t,n)}Object.defineProperties(Ts.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}});Object.defineProperties(Rv.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var e=this,n=new JE;return n.load(t,function(r){e.setBuffer(r)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}});IP.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()};tv.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)};var eqe={merge:function(t,e,n){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var r;e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),r=e.matrix,e=e.geometry),t.merge(e,r,n)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}};Ch.crossOrigin=void 0;Ch.loadTexture=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new OE;i.setCrossOrigin(this.crossOrigin);var s=i.load(t,n,void 0,r);return e&&(s.mapping=e),s};Ch.loadTextureCube=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new PE;i.setCrossOrigin(this.crossOrigin);var s=i.load(t,n,void 0,r);return e&&(s.mapping=e),s};Ch.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};Ch.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};function tqe(){console.error("THREE.CanvasRenderer has been removed")}function nqe(){console.error("THREE.JSONLoader has been removed.")}var rqe={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};function iqe(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")}typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:hq}}));var sqe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",ACESFilmicToneMapping:zq,AddEquation:id,AddOperation:Oq,AdditiveBlending:a3,AlphaFormat:qq,AlwaysDepth:Mq,AlwaysStencilFunc:E7,AmbientLight:GE,AmbientLightProbe:EP,AnimationClip:Na,AnimationLoader:uP,AnimationMixer:DP,AnimationObjectGroup:zX,AnimationUtils:Xr,ArcCurve:Nv,ArrayCamera:fE,ArrowHelper:mu,Audio:Rv,AudioAnalyser:IP,AudioContext:CP,AudioListener:AP,AudioLoader:JE,AxesHelper:Fx,AxisHelper:q9e,BackSide:Pi,BasicDepthPacking:S7,BasicShadowMap:QGe,BinaryTextureLoader:J9e,Bone:rP,BooleanKeyframeTrack:IE,BoundingBoxHelper:X9e,Box2:FP,Box3:gl,Box3Helper:Px,BoxBufferGeometry:Kw,BoxGeometry:Z3,BoxHelper:pu,BufferAttribute:qt,BufferGeometry:wt,BufferGeometryLoader:KE,ByteType:Vq,Cache:Ld,Camera:oc,CameraHelper:Dx,CanvasRenderer:tqe,CanvasTexture:ax,CatmullRomCurve3:ks,CineonToneMapping:Bq,CircleBufferGeometry:kv,CircleGeometry:Ax,ClampToEdgeWrapping:Ws,Clock:kP,ClosedSplineCurve3:fK,Color:yt,ColorKeyframeTrack:NE,CompressedTexture:pv,CompressedTextureLoader:hP,ConeBufferGeometry:kx,ConeGeometry:Ex,CubeCamera:tv,CubeGeometry:Z3,CubeReflectionMapping:zT,CubeRefractionMapping:VT,CubeTexture:lu,CubeTextureLoader:PE,CubeUVReflectionMapping:Og,CubeUVRefractionMapping:WT,CubicBezierCurve:_l,CubicBezierCurve3:uc,CubicInterpolant:AE,CullFaceBack:r3,CullFaceFront:dq,CullFaceFrontBack:YGe,CullFaceNone:fq,Curve:Pt,CurvePath:du,CustomBlending:gq,CylinderBufferGeometry:hu,CylinderGeometry:Id,Cylindrical:GX,DataTexture:wd,DataTexture2DArray:iv,DataTexture3D:sv,DataTextureLoader:DE,DecrementStencilOp:uHe,DecrementWrapStencilOp:fHe,DefaultLoadingManager:IX,DepthFormat:sd,DepthStencilFormat:Lg,DepthTexture:lx,DirectionalLight:WE,DirectionalLightHelper:Lv,DirectionalLightShadow:UE,DiscreteInterpolant:ME,DodecahedronBufferGeometry:bv,DodecahedronGeometry:px,DoubleSide:Cw,DstAlphaFactor:Sq,DstColorFactor:Tq,DynamicBufferAttribute:F9e,DynamicCopyUsage:EHe,DynamicDrawUsage:cd,DynamicReadUsage:SHe,EdgesGeometry:Ev,EdgesHelper:K9e,EllipseCurve:Ho,EqualDepth:Nq,EqualStencilFunc:gHe,EquirectangularReflectionMapping:p3,EquirectangularRefractionMapping:UT,Euler:ud,EventDispatcher:Aa,ExtrudeBufferGeometry:lc,ExtrudeGeometry:Ed,Face3:qg,Face4:T9e,FaceColors:mq,FileLoader:$a,FlatShading:s3,Float32Attribute:H9e,Float32BufferAttribute:ut,Float64Attribute:j9e,Float64BufferAttribute:jw,FloatType:Fg,Fog:pE,FogExp2:dE,Font:_P,FontLoader:SP,FrontFaceDirectionCCW:JGe,FrontFaceDirectionCW:ZGe,FrontSide:Rg,Frustum:rv,GammaEncoding:E3,Geometry:Yt,GeometryUtils:eqe,GreaterDepth:Rq,GreaterEqualDepth:$q,GreaterEqualStencilFunc:wHe,GreaterStencilFunc:yHe,GridHelper:ik,Group:av,HalfFloatType:jT,HemisphereLight:LE,HemisphereLightHelper:Fv,HemisphereLightProbe:TP,IcosahedronBufferGeometry:yv,IcosahedronGeometry:dx,ImageBitmapLoader:wP,ImageLoader:Iv,ImageUtils:Ch,ImmediateRenderObject:Rx,IncrementStencilOp:cHe,IncrementWrapStencilOp:hHe,InstancedBufferAttribute:XE,InstancedBufferGeometry:qE,InstancedInterleavedBuffer:PP,InstancedMesh:wE,Int16Attribute:V9e,Int16BufferAttribute:Gw,Int32Attribute:W9e,Int32BufferAttribute:Hw,Int8Attribute:L9e,Int8BufferAttribute:Vw,IntType:Wq,InterleavedBuffer:cu,InterleavedBufferAttribute:Qw,Interpolant:Go,InterpolateDiscrete:Rw,InterpolateLinear:Dw,InterpolateSmooth:qT,InvertStencilOp:dHe,JSONLoader:nqe,KeepStencilOp:YT,KeyframeTrack:os,LOD:ix,LatheBufferGeometry:Tv,LatheGeometry:Tx,Layers:$3,LensFlare:iqe,LessDepth:Iq,LessEqualDepth:FT,LessEqualStencilFunc:vHe,LessStencilFunc:mHe,Light:xr,LightProbe:kl,LightShadow:fc,Line:Wo,Line3:LP,LineBasicMaterial:Fr,LineCurve:mo,LineCurve3:Sl,LineDashedMaterial:Fd,LineLoop:TE,LinePieces:k9e,LineSegments:Vr,LineStrip:E9e,LinearEncoding:fo,LinearFilter:Oi,LinearInterpolant:Mx,LinearMipMapLinearFilter:iHe,LinearMipMapNearestFilter:rHe,LinearMipmapLinearFilter:Mw,LinearMipmapNearestFilter:g3,LinearToneMapping:LT,Loader:Xn,LoaderUtils:yP,LoadingManager:cP,LogLuvEncoding:_7,LoopOnce:y7,LoopPingPong:w7,LoopRepeat:b7,LuminanceAlphaFormat:Kq,LuminanceFormat:Xq,MOUSE:Jc,Material:jt,MaterialLoader:jE,Math:ln,MathUtils:ln,Matrix3:rs,Matrix4:vn,MaxEquation:h3,Mesh:Or,MeshBasicMaterial:Ma,MeshDepthMaterial:Nh,MeshDistanceMaterial:$h,MeshFaceMaterial:A9e,MeshLambertMaterial:Pd,MeshMatcapMaterial:Od,MeshNormalMaterial:Dd,MeshPhongMaterial:Dh,MeshPhysicalMaterial:$d,MeshStandardMaterial:cc,MeshToonMaterial:Rd,MinEquation:u3,MirroredRepeatWrapping:Aw,MixOperation:Pq,MultiMaterial:M9e,MultiplyBlending:c3,MultiplyOperation:Tw,NearestFilter:li,NearestMipMapLinearFilter:nHe,NearestMipMapNearestFilter:tHe,NearestMipmapLinearFilter:HT,NearestMipmapNearestFilter:GT,NeverDepth:Aq,NeverStencilFunc:pHe,NoBlending:eu,NoColors:o3,NoToneMapping:Ew,NormalBlending:Pg,NotEqualDepth:Dq,NotEqualStencilFunc:bHe,NumberKeyframeTrack:Av,Object3D:ft,ObjectLoader:YE,ObjectSpaceNormalMap:T7,OctahedronBufferGeometry:Sd,OctahedronGeometry:fx,OneFactor:wq,OneMinusDstAlphaFactor:Cq,OneMinusDstColorFactor:Eq,OneMinusSrcAlphaFactor:d3,OneMinusSrcColorFactor:_q,OrthographicCamera:$v,PCFShadowMap:i3,PCFSoftShadowMap:pq,PMREMGenerator:WP,ParametricBufferGeometry:gv,ParametricGeometry:cx,Particle:N9e,ParticleBasicMaterial:D9e,ParticleSystem:$9e,ParticleSystemMaterial:P9e,Path:El,PerspectiveCamera:Si,Plane:vl,PlaneBufferGeometry:xd,PlaneGeometry:Yw,PlaneHelper:Ox,PointCloud:I9e,PointCloudMaterial:R9e,PointLight:VE,PointLightHelper:Ov,Points:dv,PointsMaterial:wl,PolarGridHelper:sk,PolyhedronBufferGeometry:po,PolyhedronGeometry:ux,PositionalAudio:MP,PropertyBinding:As,PropertyMixer:NP,QuadraticBezierCurve:Cl,QuadraticBezierCurve3:hc,Quaternion:is,QuaternionKeyframeTrack:Ix,QuaternionLinearInterpolant:$E,REVISION:hq,RGBADepthPacking:C7,RGBAFormat:pl,RGBAIntegerFormat:n7,RGBA_ASTC_10x10_Format:m7,RGBA_ASTC_10x5_Format:f7,RGBA_ASTC_10x6_Format:d7,RGBA_ASTC_10x8_Format:p7,RGBA_ASTC_12x10_Format:g7,RGBA_ASTC_12x12_Format:v7,RGBA_ASTC_4x4_Format:i7,RGBA_ASTC_5x4_Format:s7,RGBA_ASTC_5x5_Format:o7,RGBA_ASTC_6x5_Format:a7,RGBA_ASTC_6x6_Format:l7,RGBA_ASTC_8x5_Format:c7,RGBA_ASTC_8x6_Format:u7,RGBA_ASTC_8x8_Format:h7,RGBA_PVRTC_2BPPV1_Format:T3,RGBA_PVRTC_4BPPV1_Format:C3,RGBA_S3TC_DXT1_Format:b3,RGBA_S3TC_DXT3_Format:w3,RGBA_S3TC_DXT5_Format:x3,RGBDEncoding:M3,RGBEEncoding:KT,RGBEFormat:Yq,RGBFormat:Sh,RGBIntegerFormat:t7,RGBM16Encoding:A3,RGBM7Encoding:k3,RGB_ETC1_Format:r7,RGB_PVRTC_2BPPV1_Format:S3,RGB_PVRTC_4BPPV1_Format:_3,RGB_S3TC_DXT1_Format:y3,RGFormat:Qq,RGIntegerFormat:e7,RawShaderMaterial:fu,Ray:dd,Raycaster:UX,RectAreaLight:HE,RedFormat:Zq,RedIntegerFormat:Jq,ReinhardToneMapping:Fq,RepeatWrapping:kw,ReplaceStencilOp:lHe,ReverseSubtractEquation:yq,RingBufferGeometry:Cv,RingGeometry:Cx,Scene:nu,SceneUtils:rqe,ShaderChunk:_n,ShaderLib:ac,ShaderMaterial:Gs,ShadowMaterial:Nd,Shape:Ph,ShapeBufferGeometry:Md,ShapeGeometry:Ad,ShapePath:xP,ShapeUtils:uu,ShortType:Uq,Skeleton:bE,SkeletonHelper:Pv,SkinnedMesh:sx,SmoothShading:eHe,Sphere:iu,SphereBufferGeometry:kd,SphereGeometry:Sx,Spherical:tk,SphericalHarmonics3:QE,SphericalReflectionMapping:m3,Spline:XP,SplineCurve:Tl,SplineCurve3:dK,SpotLight:zE,SpotLightHelper:Dv,SpotLightShadow:BE,Sprite:rx,SpriteMaterial:Rh,SrcAlphaFactor:f3,SrcAlphaSaturateFactor:kq,SrcColorFactor:xq,StaticCopyUsage:THe,StaticDrawUsage:Ow,StaticReadUsage:_He,StereoCamera:OX,StreamCopyUsage:kHe,StreamDrawUsage:xHe,StreamReadUsage:CHe,StringKeyframeTrack:RE,SubtractEquation:vq,SubtractiveBlending:l3,TOUCH:Qc,TangentSpaceNormalMap:ld,TetrahedronBufferGeometry:vv,TetrahedronGeometry:hx,TextBufferGeometry:Sv,TextGeometry:_x,Texture:ar,TextureLoader:OE,TorusBufferGeometry:xv,TorusGeometry:vx,TorusKnotBufferGeometry:wv,TorusKnotGeometry:gx,Triangle:qi,TriangleFanDrawMode:oHe,TriangleStripDrawMode:sHe,TrianglesDrawMode:x7,TubeBufferGeometry:Cd,TubeGeometry:mx,UVMapping:BT,Uint16Attribute:U9e,Uint16BufferAttribute:pd,Uint32Attribute:G9e,Uint32BufferAttribute:md,Uint8Attribute:B9e,Uint8BufferAttribute:Uw,Uint8ClampedAttribute:z9e,Uint8ClampedBufferAttribute:Ww,Uncharted2ToneMapping:Lq,Uniform:ek,UniformsLib:ht,UniformsUtils:z7,UnsignedByteType:Iw,UnsignedInt248Type:$w,UnsignedIntType:v3,UnsignedShort4444Type:Gq,UnsignedShort5551Type:Hq,UnsignedShort565Type:jq,UnsignedShortType:Nw,VSMShadowMap:$g,Vector2:$e,Vector3:j,Vector4:lr,VectorKeyframeTrack:Mv,Vertex:O9e,VertexColors:Dg,VideoTexture:oP,WebGLCubeRenderTarget:Mh,WebGLMultisampleRenderTarget:I3,WebGLRenderTarget:Ts,WebGLRenderTargetCube:Q9e,WebGLRenderer:tP,WebGLUtils:cX,WireframeGeometry:mv,WireframeHelper:Y9e,WrapAroundEnding:Pw,XHRLoader:Z9e,ZeroCurvatureEnding:od,ZeroFactor:bq,ZeroSlopeEnding:ad,ZeroStencilOp:aHe,sRGBEncoding:XT}),Gd=A0(sqe),Bx=function(t,e){e===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=e,this.enabled=!0,this.target=new j,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:Jc.ROTATE,MIDDLE:Jc.DOLLY,RIGHT:Jc.PAN},this.touches={ONE:Qc.ROTATE,TWO:Qc.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(r),n.update(),a=o.NONE},this.update=function(){var ee=new j,We=new is().setFromUnitVectors(t.up,new j(0,1,0)),ot=We.clone().inverse(),rt=new j,Ke=new is;return function(){var it=n.object.position;return ee.copy(it).sub(n.target),ee.applyQuaternion(We),c.setFromVector3(ee),n.autoRotate&&a===o.NONE&&A(E()),n.enableDamping?(c.theta+=u.theta*n.dampingFactor,c.phi+=u.phi*n.dampingFactor):(c.theta+=u.theta,c.phi+=u.phi),c.theta=Math.max(n.minAzimuthAngle,Math.min(n.maxAzimuthAngle,c.theta)),c.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,c.phi)),c.makeSafe(),c.radius*=h,c.radius=Math.max(n.minDistance,Math.min(n.maxDistance,c.radius)),n.enableDamping===!0?n.target.addScaledVector(f,n.dampingFactor):n.target.add(f),ee.setFromSpherical(c),ee.applyQuaternion(ot),it.copy(n.target).add(ee),n.object.lookAt(n.target),n.enableDamping===!0?(u.theta*=1-n.dampingFactor,u.phi*=1-n.dampingFactor,f.multiplyScalar(1-n.dampingFactor)):(u.set(0,0,0),f.set(0,0,0)),h=1,d||rt.distanceToSquared(n.object.position)>l||8*(1-Ke.dot(n.object.quaternion))>l?(n.dispatchEvent(r),rt.copy(n.object.position),Ke.copy(n.object.quaternion),d=!1,!0):!1}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",st,!1),n.domElement.removeEventListener("mousedown",pt,!1),n.domElement.removeEventListener("wheel",q,!1),n.domElement.removeEventListener("touchstart",Xe,!1),n.domElement.removeEventListener("touchend",Et,!1),n.domElement.removeEventListener("touchmove",Re,!1),document.removeEventListener("mousemove",Ht,!1),document.removeEventListener("mouseup",Mt,!1),n.domElement.removeEventListener("keydown",Y,!1)};var n=this,r={type:"change"},i={type:"start"},s={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},a=o.NONE,l=1e-6,c=new tk,u=new tk,h=1,f=new j,d=!1,p=new $e,m=new $e,v=new $e,y=new $e,w=new $e,x=new $e,_=new $e,S=new $e,T=new $e;function E(){return 2*Math.PI/60/60*n.autoRotateSpeed}function k(){return Math.pow(.95,n.zoomSpeed)}function A(ee){u.theta-=ee}function M(ee){u.phi-=ee}var D=function(){var ee=new j;return function(ot,rt){ee.setFromMatrixColumn(rt,0),ee.multiplyScalar(-ot),f.add(ee)}}(),P=function(){var ee=new j;return function(ot,rt){n.screenSpacePanning===!0?ee.setFromMatrixColumn(rt,1):(ee.setFromMatrixColumn(rt,0),ee.crossVectors(n.object.up,ee)),ee.multiplyScalar(ot),f.add(ee)}}(),N=function(){var ee=new j;return function(ot,rt){var Ke=n.domElement;if(n.object.isPerspectiveCamera){var lt=n.object.position;ee.copy(lt).sub(n.target);var it=ee.length();it*=Math.tan(n.object.fov/2*Math.PI/180),D(2*ot*it/Ke.clientHeight,n.object.matrix),P(2*rt*it/Ke.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(D(ot*(n.object.right-n.object.left)/n.object.zoom/Ke.clientWidth,n.object.matrix),P(rt*(n.object.top-n.object.bottom)/n.object.zoom/Ke.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function R(ee){n.object.isPerspectiveCamera?h/=ee:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*ee)),n.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function F(ee){n.object.isPerspectiveCamera?h*=ee:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/ee)),n.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function O(ee){p.set(ee.clientX,ee.clientY)}function K(ee){_.set(ee.clientX,ee.clientY)}function J(ee){y.set(ee.clientX,ee.clientY)}function re(ee){m.set(ee.clientX,ee.clientY),v.subVectors(m,p).multiplyScalar(n.rotateSpeed);var We=n.domElement;A(2*Math.PI*v.x/We.clientHeight),M(2*Math.PI*v.y/We.clientHeight),p.copy(m),n.update()}function ae(ee){S.set(ee.clientX,ee.clientY),T.subVectors(S,_),T.y>0?R(k()):T.y<0&&F(k()),_.copy(S),n.update()}function pe(ee){w.set(ee.clientX,ee.clientY),x.subVectors(w,y).multiplyScalar(n.panSpeed),N(x.x,x.y),y.copy(w),n.update()}function ke(ee){ee.deltaY<0?F(k()):ee.deltaY>0&&R(k()),n.update()}function Te(ee){var We=!1;switch(ee.keyCode){case n.keys.UP:N(0,n.keyPanSpeed),We=!0;break;case n.keys.BOTTOM:N(0,-n.keyPanSpeed),We=!0;break;case n.keys.LEFT:N(n.keyPanSpeed,0),We=!0;break;case n.keys.RIGHT:N(-n.keyPanSpeed,0),We=!0;break}We&&(ee.preventDefault(),n.update())}function Ne(ee){if(ee.touches.length==1)p.set(ee.touches[0].pageX,ee.touches[0].pageY);else{var We=.5*(ee.touches[0].pageX+ee.touches[1].pageX),ot=.5*(ee.touches[0].pageY+ee.touches[1].pageY);p.set(We,ot)}}function we(ee){if(ee.touches.length==1)y.set(ee.touches[0].pageX,ee.touches[0].pageY);else{var We=.5*(ee.touches[0].pageX+ee.touches[1].pageX),ot=.5*(ee.touches[0].pageY+ee.touches[1].pageY);y.set(We,ot)}}function me(ee){var We=ee.touches[0].pageX-ee.touches[1].pageX,ot=ee.touches[0].pageY-ee.touches[1].pageY,rt=Math.sqrt(We*We+ot*ot);_.set(0,rt)}function He(ee){n.enableZoom&&me(ee),n.enablePan&&we(ee)}function Fe(ee){n.enableZoom&&me(ee),n.enableRotate&&Ne(ee)}function je(ee){if(ee.touches.length==1)m.set(ee.touches[0].pageX,ee.touches[0].pageY);else{var We=.5*(ee.touches[0].pageX+ee.touches[1].pageX),ot=.5*(ee.touches[0].pageY+ee.touches[1].pageY);m.set(We,ot)}v.subVectors(m,p).multiplyScalar(n.rotateSpeed);var rt=n.domElement;A(2*Math.PI*v.x/rt.clientHeight),M(2*Math.PI*v.y/rt.clientHeight),p.copy(m)}function Ve(ee){if(ee.touches.length==1)w.set(ee.touches[0].pageX,ee.touches[0].pageY);else{var We=.5*(ee.touches[0].pageX+ee.touches[1].pageX),ot=.5*(ee.touches[0].pageY+ee.touches[1].pageY);w.set(We,ot)}x.subVectors(w,y).multiplyScalar(n.panSpeed),N(x.x,x.y),y.copy(w)}function Se(ee){var We=ee.touches[0].pageX-ee.touches[1].pageX,ot=ee.touches[0].pageY-ee.touches[1].pageY,rt=Math.sqrt(We*We+ot*ot);S.set(0,rt),T.set(0,Math.pow(S.y/_.y,n.zoomSpeed)),R(T.y),_.copy(S)}function nt(ee){n.enableZoom&&Se(ee),n.enablePan&&Ve(ee)}function Ct(ee){n.enableZoom&&Se(ee),n.enableRotate&&je(ee)}function pt(ee){if(n.enabled!==!1){ee.preventDefault(),n.domElement.focus?n.domElement.focus():window.focus();var We;switch(ee.button){case 0:We=n.mouseButtons.LEFT;break;case 1:We=n.mouseButtons.MIDDLE;break;case 2:We=n.mouseButtons.RIGHT;break;default:We=-1}switch(We){case Jc.DOLLY:if(n.enableZoom===!1)return;K(ee),a=o.DOLLY;break;case Jc.ROTATE:if(ee.ctrlKey||ee.metaKey||ee.shiftKey){if(n.enablePan===!1)return;J(ee),a=o.PAN}else{if(n.enableRotate===!1)return;O(ee),a=o.ROTATE}break;case Jc.PAN:if(ee.ctrlKey||ee.metaKey||ee.shiftKey){if(n.enableRotate===!1)return;O(ee),a=o.ROTATE}else{if(n.enablePan===!1)return;J(ee),a=o.PAN}break;default:a=o.NONE}a!==o.NONE&&(document.addEventListener("mousemove",Ht,!1),document.addEventListener("mouseup",Mt,!1),n.dispatchEvent(i))}}function Ht(ee){if(n.enabled!==!1)switch(ee.preventDefault(),a){case o.ROTATE:if(n.enableRotate===!1)return;re(ee);break;case o.DOLLY:if(n.enableZoom===!1)return;ae(ee);break;case o.PAN:if(n.enablePan===!1)return;pe(ee);break}}function Mt(ee){n.enabled!==!1&&(document.removeEventListener("mousemove",Ht,!1),document.removeEventListener("mouseup",Mt,!1),n.dispatchEvent(s),a=o.NONE)}function q(ee){n.enabled===!1||n.enableZoom===!1||a!==o.NONE&&a!==o.ROTATE||(ee.preventDefault(),ee.stopPropagation(),n.dispatchEvent(i),ke(ee),n.dispatchEvent(s))}function Y(ee){n.enabled===!1||n.enableKeys===!1||n.enablePan===!1||Te(ee)}function Xe(ee){if(n.enabled!==!1){switch(ee.preventDefault(),ee.touches.length){case 1:switch(n.touches.ONE){case Qc.ROTATE:if(n.enableRotate===!1)return;Ne(ee),a=o.TOUCH_ROTATE;break;case Qc.PAN:if(n.enablePan===!1)return;we(ee),a=o.TOUCH_PAN;break;default:a=o.NONE}break;case 2:switch(n.touches.TWO){case Qc.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;He(ee),a=o.TOUCH_DOLLY_PAN;break;case Qc.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Fe(ee),a=o.TOUCH_DOLLY_ROTATE;break;default:a=o.NONE}break;default:a=o.NONE}a!==o.NONE&&n.dispatchEvent(i)}}function Re(ee){if(n.enabled!==!1)switch(ee.preventDefault(),ee.stopPropagation(),a){case o.TOUCH_ROTATE:if(n.enableRotate===!1)return;je(ee),n.update();break;case o.TOUCH_PAN:if(n.enablePan===!1)return;Ve(ee),n.update();break;case o.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;nt(ee),n.update();break;case o.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Ct(ee),n.update();break;default:a=o.NONE}}function Et(ee){n.enabled!==!1&&(n.dispatchEvent(s),a=o.NONE)}function st(ee){n.enabled!==!1&&ee.preventDefault()}n.domElement.addEventListener("contextmenu",st,!1),n.domElement.addEventListener("mousedown",pt,!1),n.domElement.addEventListener("wheel",q,!1),n.domElement.addEventListener("touchstart",Xe,!1),n.domElement.addEventListener("touchend",Et,!1),n.domElement.addEventListener("touchmove",Re,!1),n.domElement.addEventListener("keydown",Y,!1),n.domElement.tabIndex===-1&&(n.domElement.tabIndex=0),this.update()};Bx.prototype=Object.create(Aa.prototype);Bx.prototype.constructor=Bx;var dk=function(t,e){Bx.call(this,t,e),this.mouseButtons.LEFT=Jc.PAN,this.mouseButtons.RIGHT=Jc.ROTATE,this.touches.ONE=Qc.PAN,this.touches.TWO=Qc.DOLLY_ROTATE};dk.prototype=Object.create(Aa.prototype);dk.prototype.constructor=dk;var oqe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",OrbitControls:Bx,MapControls:dk}),aqe=A0(oqe),zx={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=function(){function r(i,s,o,a,l,c,u){this.pointIndices=i,this.labelStrings=s,this.scaleFactors=o,this.useSceneOpacityFlags=a,this.defaultFontSize=l,this.fillColors=c,this.strokeColors=u}return r}();t.LabelRenderParams=e,function(r){r[r.Perspective=0]="Perspective",r[r.Orthographic=1]="Orthographic"}(t.CameraType||(t.CameraType={}));var n=function(){function r(i,s,o,a,l,c,u,h,f,d,p,m,v,y){this.camera=i,this.cameraType=s,this.cameraTarget=o,this.screenWidth=a,this.screenHeight=l,this.nearestCameraSpacePointZ=c,this.farthestCameraSpacePointZ=u,this.backgroundColor=h,this.pointColors=f,this.pointScaleFactors=d,this.labels=p,this.polylineColors=m,this.polylineOpacities=v,this.polylineWidths=y}return r}();t.RenderContext=n})(zx);var Fi={};Object.defineProperty(Fi,"__esModule",{value:!0});var Al=Gd;function lqe(t,e,n,r){var i=window.devicePixelRatio,s=new Al.Vector3().copy(r).project(t),o=[(s.x+1)/2*e*i,-((s.y-1)/2*n)*i];return o}Fi.vector3DToScreenCoords=lqe;function cqe(t,e){var n=e*3;return new Al.Vector3(t[n],t[n+1],t[n+2])}Fi.vector3FromPackedArray=cqe;function uqe(t,e,n){for(var r=1/0,i=0,s=new Al.Vector3().copy(n).sub(e),o=new Al.Vector3().copy(s).normalize(),a=t.length/3,l=0,c=new Al.Vector3,u=new Al.Vector3,h=0;h<a;h++){c.x=t[l],c.y=t[l+1],c.z=t[l+2],l+=3,u.copy(c).sub(e);var f=o.dot(u);f<0||(i=f>i?f:i,r=f<r?f:r)}return[r,i]}Fi.getNearFarPoints=uqe;function pK(t,e){return e===void 0&&(e=!0),t.needsUpdate=e,t.minFilter=Al.LinearFilter,t.generateMipmaps=!1,t.flipY=!1,t}function hqe(t){var e=new Al.Texture(t);return pK(e)}Fi.createTextureFromCanvas=hqe;function fqe(t,e){var n=new Al.Texture(t);return t.onload=function(){n.needsUpdate=!0,e()},pK(n,!1)}Fi.createTextureFromImage=fqe;function dqe(){try{var t=document.createElement("canvas"),e=t.getContext("webgl")||t.getContext("experimental-webgl");return e!=null}catch{return!1}}Fi.hasWebGLSupport=dqe;function pqe(t){for(var e=1/0,n=-1/0,r=0;r<t.length;r++){var i=t[r];i<e&&(e=i),i>n&&(n=i)}return[e,n]}Fi.extent=pqe;function mqe(t,e,n){var r=e[1]-e[0],i=n[1]-n[0],s=(t-e[0])/r;return s*i+n[0]}Fi.scaleLinear=mqe;function gqe(t,e,n){var r=Math.pow(e[1],Math.E)-Math.pow(e[0],Math.E),i=n[1]-n[0],s=(Math.pow(t,Math.E)-e[0])/r;return s*i+n[0]}Fi.scaleExponential=gqe;function vqe(t,e,n,r,i){t[e*3]=n,t[e*3+1]=r,t[e*3+2]=i}Fi.packRgbIntoUint8Array=vqe;function yqe(t){var e=new Al.Color(t);return[e.r*255|0,e.g*255|0,e.b*255|0]}Fi.styleRgbFromHexColor=yqe;var mK=function(t){return 100*t+"%"};function bqe(t,e,n,r,i,s){var o=n+(r-n)*t/e,a="hsl("+o+", "+mK(i)+", "+mK(s)+")";return new Al.Color(a)}Fi.getDefaultPointInPolylineColor=bqe;var KP={};Object.defineProperty(KP,"__esModule",{value:!0});var wqe=function(){function t(e,n,r){this.startCoordinates=[0,0],this.svgElement=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgElement.style.display="none",this.svgElement.style.height="100%",this.svgElement.style.width="100%",this.svgElement.style.position="absolute",e.insertAdjacentElement("afterbegin",this.svgElement),this.rectElement=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.rectElement.style.stroke=r.select.stroke,this.rectElement.style.strokeDasharray=r.select.strokeDashArray,this.rectElement.style.strokeWidth=""+r.select.strokeWidth,this.rectElement.style.fill=r.select.fill,this.rectElement.style.fillOpacity=""+r.select.fillOpacity,this.svgElement.appendChild(this.rectElement),this.selectionCallback=n,this.isMouseDown=!1}return t.prototype.onMouseDown=function(e,n){this.isMouseDown=!0,this.rectElement.style.display="block",this.svgElement.style.display="block",this.startCoordinates=[e,n],this.lastBoundingBox={x:this.startCoordinates[0],y:this.startCoordinates[1],width:1,height:1}},t.prototype.onMouseMove=function(e,n){!this.isMouseDown||(this.lastBoundingBox.x=Math.min(e,this.startCoordinates[0]),this.lastBoundingBox.y=Math.max(n,this.startCoordinates[1]),this.lastBoundingBox.width=Math.max(e,this.startCoordinates[0])-this.lastBoundingBox.x,this.lastBoundingBox.height=this.lastBoundingBox.y-Math.min(n,this.startCoordinates[1]),this.rectElement.setAttribute("x",""+this.lastBoundingBox.x),this.rectElement.setAttribute("y",""+(this.lastBoundingBox.y-this.lastBoundingBox.height)),this.rectElement.setAttribute("width",""+this.lastBoundingBox.width),this.rectElement.setAttribute("height",""+this.lastBoundingBox.height))},t.prototype.onMouseUp=function(){this.isMouseDown=!1,this.svgElement.style.display="none",this.rectElement.style.display="none",this.rectElement.setAttribute("width","0"),this.rectElement.setAttribute("height","0"),this.selectionCallback(this.lastBoundingBox)},t}();KP.ScatterPlotRectangleSelector=wqe;var pk=$t&&$t.__assign||function(){return pk=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},pk.apply(this,arguments)},YP=$t&&$t.__read||function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},gK=$t&&$t.__values||function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n3,"__esModule",{value:!0});var Fn=Gd,xqe=aqe,ZP=zx,_qe=Fi,Sqe=KP,vK=2,Cqe=5*vK,Tqe=.025*vK,Eqe=70,kqe=.01,Aqe=100,mk=1.2,yK=16,bK=17,Mqe=new Fn.Vector3(.45,.9,1.6),Iqe=new Fn.Vector3(0,0,0),Nqe=new Fn.Vector3(0,0,4),$qe=new Fn.Vector3(0,0,0),Rqe={mouseRotateSpeed:1,autoRotateSpeed:2,zoomSpeed:.125},Dqe=function(){function t(e,n){var r=this;this.clickCallback=function(){},this.hoverCallback=function(){},this.selectCallback=function(){},this.selectEnabled=!0,this.visualizers=new Map,this.onCameraMoveListeners=[],this.height=0,this.width=0,this.dimensions=3,this.interactionMode="PAN",this.pickingTexture=new Fn.WebGLRenderTarget(0,0),this.orbitAnimationOnNextCameraCreation=!1,this.orbitAnimationId=null,this.worldSpacePointPositions=new Float32Array(0),this.pointColors=new Float32Array(0),this.pointScaleFactors=new Float32Array(0),this.polylineColors={},this.polylineOpacities=new Float32Array(0),this.polylineWidths=new Float32Array(0),this.selecting=!1,this.nearestPoint=null,this.mouseIsDown=!1,this.isDragSequence=!1,this.lastHovered=null,this.container=e,this.styles=n.styles,this.setParameters(n),this.computeLayoutValues(),this.scene=new Fn.Scene,this.renderer=new Fn.WebGLRenderer({alpha:!0,premultipliedAlpha:!1,antialias:!1}),this.renderer.setClearColor(this.styles.backgroundColor,1),this.container.appendChild(this.renderer.domElement),this.light=new Fn.PointLight(16772287,1,0),this.scene.add(this.light),this.orbitControlParams=pk(pk({},Rqe),n.orbitControlParams),this.rectangleSelector=new Sqe.ScatterPlotRectangleSelector(this.container,function(i){r.selectBoundingBox(i)},this.styles),this.addInteractionListeners(),this.setDimensions(3),this.makeCamera(n.camera),this.resize()}return t.prototype.setParameters=function(e){e.onClick!==void 0&&(this.clickCallback=e.onClick),e.onHover!==void 0&&(this.hoverCallback=e.onHover),e.onSelect!==void 0&&(this.selectCallback=e.onSelect),e.selectEnabled!==void 0&&(this.selectEnabled=e.selectEnabled)},t.prototype.addInteractionListeners=function(){this.container.addEventListener("mousemove",this.onMouseMove.bind(this)),this.container.addEventListener("mousedown",this.onMouseDown.bind(this)),this.container.addEventListener("mouseup",this.onMouseUp.bind(this)),this.container.addEventListener("click",this.onClick.bind(this)),window.addEventListener("keydown",this.onKeyDown.bind(this),!1),window.addEventListener("keyup",this.onKeyUp.bind(this),!1)},t.prototype.addCameraControlsEventListeners=function(e){var n=this;e.addEventListener("start",function(){n.stopOrbitAnimation(),n.onCameraMoveListeners.forEach(function(r){return r(n.camera.position,e.target)})}),e.addEventListener("change",function(){n.render()}),e.addEventListener("end",function(){})},t.prototype.makeOrbitControls=function(e,n){this.orbitCameraControls!=null&&this.orbitCameraControls.dispose();var r=new xqe.OrbitControls(e,this.renderer.domElement);r.zoomSpeed=this.orbitControlParams.zoomSpeed,r.enableRotate=n,r.autoRotate=!1,r.enableKeys=!1,r.rotateSpeed=this.orbitControlParams.mouseRotateSpeed,n?(r.mouseButtons.LEFT=Fn.MOUSE.LEFT,r.mouseButtons.RIGHT=Fn.MOUSE.RIGHT):(r.mouseButtons.LEFT=Fn.MOUSE.RIGHT,r.mouseButtons.RIGHT=Fn.MOUSE.LEFT),r.reset(),this.camera=e,this.orbitCameraControls=r,this.addCameraControlsEventListeners(this.orbitCameraControls)},t.prototype.makeCamera=function(e){e===void 0&&(e={});var n=this.makeDefaultCameraDef(this.dimensions,e);this.recreateCamera(n),this.dimensions===3&&this.styles.axesVisible?this.add3dAxes():this.remove3dAxesFromScene()},t.prototype.makeCamera3D=function(e,n,r){var i;{var s=n/r;i=new Fn.PerspectiveCamera(Eqe,s,kqe,Aqe),i.position.set(e.position[0],e.position[1],e.position[2]);var o=new Fn.Vector3(e.target[0],e.target[1],e.target[2]);i.lookAt(o),i.zoom=e.zoom,i.updateProjectionMatrix()}this.camera=i,this.makeOrbitControls(i,!0)},t.prototype.makeCamera2D=function(e,n,r){var i,s=new Fn.Vector3(e.target[0],e.target[1],e.target[2]);{var o=n/r,a=-mk,l=mk,c=-mk,u=mk;o>1?(a*=o,l*=o):(u/=o,c/=o),i=new Fn.OrthographicCamera(a,l,u,c,-1e3,1e3),i.position.set(e.position[0],e.position[1],e.position[2]),i.up=new Fn.Vector3(0,0,1),i.lookAt(s),i.zoom=e.zoom,i.updateProjectionMatrix()}this.camera=i,this.makeOrbitControls(i,!1)},t.prototype.makeDefaultCameraDef=function(e,n){n===void 0&&(n={});var r=e===2,i=r?Nqe:Mqe,s=r?$qe:Iqe,o={orthographic:r,zoom:1,position:[i.x,i.y,i.z],target:[s.x,s.y,s.z]};return n.zoom&&(o.zoom=n.zoom),n.position&&(o.position=n.position),n.target&&(o.target=n.target),o},t.prototype.recreateCamera=function(e){e.orthographic?this.makeCamera2D(e,this.width,this.height):this.makeCamera3D(e,this.width,this.height),this.orbitCameraControls.minDistance=Tqe,this.orbitCameraControls.maxDistance=Cqe,this.orbitCameraControls.update(),this.orbitAnimationOnNextCameraCreation&&this.startOrbitAnimation()},t.prototype.setInteractionMode=function(e){this.interactionMode=e,e==="SELECT"?(this.selecting=!0,this.container.style.cursor="crosshair"):(this.selecting=!1,this.container.style.cursor="default")},t.prototype.onClick=function(e,n){if(n===void 0&&(n=!0),!(e&&this.selecting)){if(!this.isDragSequence&&n){var r=this.nearestPoint!=null?[this.nearestPoint]:[];this.selectCallback(r),this.clickCallback(this.nearestPoint)}this.isDragSequence=!1,this.render()}},t.prototype.onMouseDown=function(e){this.isDragSequence=!1,this.mouseIsDown=!0,this.selecting?(this.orbitCameraControls.enabled=!1,this.rectangleSelector.onMouseDown(e.offsetX,e.offsetY),this.setNearestPointToMouse(e)):!e.ctrlKey&&this.sceneIs3D()&&this.orbitCameraControls.mouseButtons.ORBIT===Fn.MOUSE.RIGHT?(this.orbitCameraControls.mouseButtons.ORBIT=Fn.MOUSE.LEFT,this.orbitCameraControls.mouseButtons.PAN=Fn.MOUSE.RIGHT):e.ctrlKey&&this.sceneIs3D()&&this.orbitCameraControls.mouseButtons.ORBIT===Fn.MOUSE.LEFT&&(this.orbitCameraControls.mouseButtons.ORBIT=Fn.MOUSE.RIGHT,this.orbitCameraControls.mouseButtons.PAN=Fn.MOUSE.LEFT)},t.prototype.onMouseUp=function(e){this.selecting&&(this.orbitCameraControls.enabled=!0,this.rectangleSelector.onMouseUp(),this.render()),this.mouseIsDown=!1},t.prototype.onMouseMove=function(e){this.isDragSequence=this.mouseIsDown,this.selecting&&this.mouseIsDown?(this.rectangleSelector.onMouseMove(e.offsetX,e.offsetY),this.render()):this.mouseIsDown||(this.setNearestPointToMouse(e),this.nearestPoint!=this.lastHovered&&(this.lastHovered=this.nearestPoint,this.hoverCallback(this.nearestPoint)))},t.prototype.onKeyDown=function(e){e.keyCode===bK&&this.sceneIs3D()&&(this.orbitCameraControls.mouseButtons.ORBIT=Fn.MOUSE.RIGHT,this.orbitCameraControls.mouseButtons.PAN=Fn.MOUSE.LEFT),e.keyCode===yK&&this.selectEnabled&&(this.selecting=!0,this.container.style.cursor="crosshair")},t.prototype.onKeyUp=function(e){e.keyCode===bK&&this.sceneIs3D()&&(this.orbitCameraControls.mouseButtons.ORBIT=Fn.MOUSE.LEFT,this.orbitCameraControls.mouseButtons.PAN=Fn.MOUSE.RIGHT),e.keyCode===yK&&this.selectEnabled&&(this.selecting=!1,this.container.style.cursor="default",this.render())},t.prototype.getPointIndicesFromBoundingBox=function(e){if(this.worldSpacePointPositions==null)return[];this.camera.updateMatrixWorld();var n=window.devicePixelRatio||1,r=Math.floor(e.x*n),i=Math.floor(e.y*n),s=Math.max(Math.floor(e.width*n),1),o=Math.max(Math.floor(e.height*n),1);if(s<=2&&o<=2)return this.getPointIndicesFromBoundingBoxPickingTexture(e);for(var a=this.renderer.domElement,l=a.width,c=a.height,u=[],h=new Fn.Vector3,f=0;f<this.worldSpacePointPositions.length;f++){var d=f*3,p=YP(this.worldSpacePointPositions.slice(d,d+3),3),m=p[0],v=p[1],y=p[2];h.x=m,h.y=v,h.z=y;var w=h.project(this.camera),x=(w.x+1)*l/2,_=-(w.y-1)*c/2;x>=r&&x<=r+s&&_<=i&&_>=i-o&&u.push(f)}return u},t.prototype.getPointIndicesFromBoundingBoxPickingTexture=function(e){if(this.worldSpacePointPositions==null)return[];var n=this.worldSpacePointPositions.length/3,r=window.devicePixelRatio||1,i=Math.floor(e.x*r),s=Math.floor(e.y*r),o=Math.max(Math.floor(e.width*r),1),a=Math.max(Math.floor(e.height*r),1),l=new Uint8Array(o*a*4);this.renderer.readRenderTargetPixels(this.pickingTexture,i,this.pickingTexture.height-s,o,a,l);for(var c=new Uint8Array(this.worldSpacePointPositions.length),u=0;u<o*a;u++){var h=l[u*4]<<16|l[u*4+1]<<8|l[u*4+2];h!==16777215&&h<n&&(c[h]=1)}for(var f=[],u=0;u<c.length;u++)c[u]===1&&f.push(u);return f},t.prototype.selectBoundingBox=function(e){var n=this.getPointIndicesFromBoundingBox(e);this.selectCallback(n)},t.prototype.setNearestPointToMouse=function(e){if(this.pickingTexture==null){this.nearestPoint=null;return}var n={x:e.offsetX,y:e.offsetY,width:1,height:1},r=this.getPointIndicesFromBoundingBoxPickingTexture(n);this.nearestPoint=r.length?r[0]:null},t.prototype.computeLayoutValues=function(){return this.width=this.container.offsetWidth,this.height=Math.max(1,this.container.offsetHeight),[this.width,this.height]},t.prototype.sceneIs3D=function(){return this.dimensions===3},t.prototype.remove3dAxesFromScene=function(){var e=this.scene.getObjectByName("axes");return e!=null&&this.scene.remove(e),e},t.prototype.add3dAxes=function(){var e=new Fn.AxesHelper;e.name="axes",this.scene.add(e)},t.prototype.setDimensions=function(e){if(e!==2&&e!==3)throw new RangeError("dimensions must be 2 or 3");this.dimensions!==e&&(this.dimensions=e,this.makeCamera())},t.prototype.getCameraPosition=function(){var e=this.camera.position;return[e.x,e.y,e.z]},t.prototype.getCameraTarget=function(){var e=this.orbitCameraControls.target;return[e.x,e.y,e.z]},t.prototype.setCameraPositionAndTarget=function(e,n){this.stopOrbitAnimation(),this.camera.position.set(e[0],e[1],e[2]),this.orbitCameraControls.target.set(n[0],n[1],n[2]),this.orbitCameraControls.update(),this.render()},t.prototype.startOrbitAnimation=function(){!this.sceneIs3D()||(this.orbitAnimationId!=null&&this.stopOrbitAnimation(),this.orbitCameraControls.autoRotate=!0,this.orbitCameraControls.autoRotateSpeed=this.orbitControlParams.autoRotateSpeed,this.updateOrbitAnimation())},t.prototype.orbitIsAnimating=function(){return this.orbitAnimationId!=null},t.prototype.updateOrbitAnimation=function(){var e=this;this.orbitCameraControls.update(),this.orbitAnimationId=requestAnimationFrame(function(){return e.updateOrbitAnimation()})},t.prototype.stopOrbitAnimation=function(){this.orbitCameraControls.autoRotate=!1,this.orbitCameraControls.rotateSpeed=this.orbitControlParams.mouseRotateSpeed,this.orbitAnimationId!=null&&(cancelAnimationFrame(this.orbitAnimationId),this.orbitAnimationId=null)},t.prototype.setActiveVisualizers=function(e){var n,r,i,s,o=new Set(e.map(function(f){return f.id}));try{for(var a=gK(this.visualizers.values()),l=a.next();!l.done;l=a.next()){var c=l.value;o.has(c.id)||(c.dispose(),this.visualizers.delete(c.id))}}catch(f){n={error:f}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}try{for(var u=gK(e),h=u.next();!h.done;h=u.next()){var c=h.value;this.visualizers.set(c.id,c),c.setScene(this.scene),c.onResize(this.width,this.height),this.worldSpacePointPositions&&c.onPointPositionsChanged(this.worldSpacePointPositions)}}catch(f){i={error:f}}finally{try{h&&!h.done&&(s=u.return)&&s.call(u)}finally{if(i)throw i.error}}},t.prototype.disposeAllVisualizers=function(){this.visualizers.forEach(function(e){return e.dispose()}),this.visualizers.clear()},t.prototype.setPointPositions=function(e){this.worldSpacePointPositions=e,this.visualizers.forEach(function(n){return n.onPointPositionsChanged(e)})},t.prototype.render=function(){{var e=this.camera.position.clone();e.x+=1,e.y+=1,this.light.position.set(e.x,e.y,e.z)}var n=this.camera instanceof Fn.PerspectiveCamera?ZP.CameraType.Perspective:ZP.CameraType.Orthographic,r=[0,0];this.worldSpacePointPositions!=null&&(r=_qe.getNearFarPoints(this.worldSpacePointPositions,this.camera.position,this.orbitCameraControls.target));var i=new ZP.RenderContext(this.camera,n,this.orbitCameraControls.target,this.width,this.height,r[0],r[1],this.styles.backgroundColor,this.pointColors,this.pointScaleFactors,this.labels,this.polylineColors,this.polylineOpacities,this.polylineWidths);this.visualizers.forEach(function(o){return o.onPickingRender(i)});{var s=this.remove3dAxesFromScene();this.renderer.setRenderTarget(this.pickingTexture),this.renderer.render(this.scene,this.camera),s!=null&&this.scene.add(s)}this.visualizers.forEach(function(o){return o.onRender(i)}),this.renderer.setRenderTarget(null),this.renderer.render(this.scene,this.camera)},t.prototype.setPointColors=function(e){this.pointColors=e},t.prototype.setPointScaleFactors=function(e){this.pointScaleFactors=e},t.prototype.setLabels=function(e){this.labels=e},t.prototype.setPolylineColors=function(e){this.polylineColors=e},t.prototype.setPolylineOpacities=function(e){this.polylineOpacities=e},t.prototype.setPolylineWidths=function(e){this.polylineWidths=e},t.prototype.resetZoom=function(){this.recreateCamera(this.makeDefaultCameraDef(this.dimensions)),this.render()},t.prototype.setDayNightMode=function(e){for(var n=this.container.querySelectorAll("canvas"),r=e?"invert(100%)":"",i=0;i<n.length;i++)n[i].style.filter=r},t.prototype.resize=function(e){e===void 0&&(e=!0);var n=YP([this.width,this.height],2),r=n[0],i=n[1],s=YP(this.computeLayoutValues(),2),o=s[0],a=s[1];if(this.dimensions===3){var l=this.camera;l.aspect=o/a,l.updateProjectionMatrix()}else{var l=this.camera,c=o/r,u=a/i,h=(l.right-l.left)*c/2,f=(l.top-l.bottom)*u/2;l.top=f,l.bottom=-f,l.left=-h,l.right=h,l.updateProjectionMatrix()}var d=window.devicePixelRatio||1;this.renderer.setPixelRatio(d),this.renderer.setSize(o,a);{var p=new Fn.Vector2;this.renderer.getSize(p);var m=this.renderer.getPixelRatio();this.pickingTexture=new Fn.WebGLRenderTarget(p.width*m,p.height*m),this.pickingTexture.texture.minFilter=Fn.LinearFilter}this.visualizers.forEach(function(v){return v.onResize(o,a)}),e&&this.render()},t.prototype.onCameraMove=function(e){this.onCameraMoveListeners.push(e)},t.prototype.clickOnPoint=function(e){this.nearestPoint=e,this.onClick(null,!1)},t}();n3.ScatterPlot=Dqe;var JP={},Pqe=$t&&$t.__read||function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s};Object.defineProperty(JP,"__esModule",{value:!0});var Oqe=Gd,QP=new Map,Fqe=/^(rgba|hsla)\((\d+),\s*(\d+%?),\s*(\d+%?)(?:,\s*(\d+(?:\.\d+)?))?\)$/;function Lqe(t){var e=Fqe.exec(t);if(e){var n=Pqe(e,6);n[0];var r=n[1],i=n[2],s=n[3],o=n[4],a=n[5],l=r.replace("a","")+"("+i+","+s+","+o+")";return{colorString:l,opacity:parseFloat(a)}}return{colorString:t,opacity:1}}function Bqe(t){if(QP.has(t))return QP.get(t);var e=Lqe(t),n=e.colorString,r=e.opacity,i=new Oqe.Color(n),s=i.r,o=i.g,a=i.b,l={r:s,g:o,b:a,opacity:r};return QP.set(t,l),l}JP.parseColor=Bqe;var gk={},zqe=$t&&$t.__values||function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(gk,"__esModule",{value:!0});var wK="Points must be an array of either 2 or 3 dimensional number arrays",Vqe=function(){function t(e,n){var r,i;n===void 0&&(n=[]),this.points=e,this.metadata=n;var s=e[0].length;if(!(s===2||s===3))throw new Error(wK);try{for(var o=zqe(e),a=o.next();!a.done;a=o.next()){var l=a.value;if(s!==l.length)throw new Error(wK)}}catch(c){r={error:c}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}this.dimensions=s}return t.prototype.setSpriteMetadata=function(e){this.spriteMetadata=e},t}();gk.Dataset=Vqe;var eO={};Object.defineProperty(eO,"__esModule",{value:!0});var Uqe=function(){var t={backgroundColor:"#ffffff",axesVisible:!0,fog:{color:"#ffffff",enabled:!0,threshold:5e3},label:{fontSize:10,scaleDefault:1,scaleLarge:2,fillColorSelected:"#000000",fillColorHover:"#000000",strokeColorSelected:"#ffffff",strokeColorHover:"#ffffff",strokeWidth:3,fillWidth:6},label3D:{fontSize:80,scale:2.2,color:"black",backgroundColor:"#ffffff",colorUnselected:"#ffffff",colorNoSelection:"#ffffff"},point:{colorUnselected:"rgba(227, 227, 227, 0.7)",colorNoSelection:"rgba(117, 117, 217, 0.7)",colorSelected:"rgba(250, 102, 102, 0.7)",colorHover:"rgba(118, 11, 79, 0.7)",scaleDefault:1,scaleSelected:1.2,scaleHover:1.2},polyline:{startHue:60,endHue:360,saturation:1,lightness:.3,defaultOpacity:.2,defaultLineWidth:2,selectedOpacity:.9,selectedLineWidth:3,deselectedOpacity:.05},select:{fill:"#dddddd",fillOpacity:.2,stroke:"#aaaaaa",strokeWidth:2,strokeDashArray:"10 5"},sprites:{minPointSize:5,imageSize:30,colorUnselected:"#ffffff",colorNoSelection:"#ffffff"}};return t};function Wqe(t){var e=Uqe();if(t===void 0)return e;for(var n in e){var r=n;typeof e[r]=="object"&&typeof t[r]=="object"?e[r]=Object.assign(e[r],t[r]):t[r]!==void 0&&(e[r]=t[r])}return e}eO.makeStyles=Wqe;var Ml={};Object.defineProperty(Ml,"__esModule",{value:!0});Ml.RGB_NUM_ELEMENTS=3;Ml.RGBA_NUM_ELEMENTS=4;Ml.XYZ_NUM_ELEMENTS=3;Ml.UV_NUM_ELEMENTS=2;Ml.INDEX_NUM_ELEMENTS=1;Ml.SCATTER_PLOT_CUBE_LENGTH=2;var tO={};Object.defineProperty(tO,"__esModule",{value:!0});var gu=Gd,xK=Fi,Xi=Ml,nO=8192,rO=256,js=2*3,Gqe=function(t,e){return`
      attribute vec2 posObj;
      attribute vec4 color;
      varying vec2 vUv;
      varying vec4 vColor;

      void main() {
        vUv = uv;
        vColor = color;

        // Rotate label to face camera.

        vec4 vRight = vec4(
          modelViewMatrix[0][0], modelViewMatrix[1][0], modelViewMatrix[2][0], 0);

        vec4 vUp = vec4(
          modelViewMatrix[0][1], modelViewMatrix[1][1], modelViewMatrix[2][1], 0);

        vec4 vAt = -vec4(
          modelViewMatrix[0][2], modelViewMatrix[1][2], modelViewMatrix[2][2], 0);

        mat4 pointToCamera = mat4(vRight, vUp, vAt, vec4(0, 0, 0, 1));

        vec2 scaledPos = posObj * `+1/t+" * "+e+`;

        vec4 posRotated = pointToCamera * vec4(scaledPos, 0, 1);
        vec4 mvPosition = modelViewMatrix * (vec4(position, 0) + posRotated);
        gl_Position = projectionMatrix * mvPosition;
      }`},Hqe=`
      uniform sampler2D texture;
      uniform bool picking;
      varying vec2 vUv;
      varying vec4 vColor;

      void main() {
        if (picking) {
          gl_FragColor = vColor;
        } else {
          vec4 fromTexture = texture2D(texture, vUv);
          gl_FragColor = vColor * fromTexture;
        }
      }`,jqe=function(){function t(e){this.styles=e,this.id="3D_LABELS",this.labelStrings=[],this.worldSpacePointPositions=new Float32Array(0),this.pickingColors=new Float32Array(0),this.renderColors=new Float32Array(0),this.uniforms={},this.totalVertexCount=0,this.labelVertexMap=[]}return t.prototype.createGlyphTexture=function(){var e=this.styles.label3D,n=e.fontSize,r=e.backgroundColor,i=e.color,s=document.createElement("canvas");s.width=nO,s.height=n;var o=s.getContext("2d");o.font="bold "+n+"px roboto",o.textBaseline="top",o.fillStyle=r,o.rect(0,0,s.width,s.height),o.fill(),o.fillStyle=i;for(var a=o.measureText(" ").width,l=new Float32Array(rO),c=new Float32Array(rO),u=0,h=0;h<rO;h++){var f=" "+String.fromCharCode(h),d=o.measureText(f).width;l[h]=d-a,c[h]=u,o.fillText(f,u-a,0),u+=d}var p=xK.createTextureFromCanvas(s);return{texture:p,lengths:l,offsets:c}},t.prototype.processLabelVerts=function(e){var n=0;this.labelVertexMap=[];for(var r=0;r<e;r++){for(var i=this.labelStrings[r],s=[],o=0;o<i.length;o++){for(var a=0;a<js;a++)s.push(n*js+a);n++}this.labelVertexMap.push(s)}this.totalVertexCount=n*js},t.prototype.createColorBuffers=function(e){var n=this;this.pickingColors=new Float32Array(this.totalVertexCount*Xi.RGB_NUM_ELEMENTS),this.renderColors=new Float32Array(this.totalVertexCount*Xi.RGB_NUM_ELEMENTS);for(var r=function(o){var a=new gu.Color(o);i.labelVertexMap[o].forEach(function(l){n.pickingColors[Xi.RGB_NUM_ELEMENTS*l]=a.r,n.pickingColors[Xi.RGB_NUM_ELEMENTS*l+1]=a.g,n.pickingColors[Xi.RGB_NUM_ELEMENTS*l+2]=a.b,n.renderColors[Xi.RGB_NUM_ELEMENTS*l]=1,n.renderColors[Xi.RGB_NUM_ELEMENTS*l+1]=1,n.renderColors[Xi.RGB_NUM_ELEMENTS*l+2]=1})},i=this,s=0;s<e;s++)r(s)},t.prototype.createLabels=function(){var e=this,n=this.styles.label3D,r=n.fontSize,i=n.scale;if(!(this.labelStrings==null||this.worldSpacePointPositions==null)){var s=this.worldSpacePointPositions.length/Xi.XYZ_NUM_ELEMENTS;if(s===this.labelStrings.length){this.glyphTexture=this.createGlyphTexture(),this.uniforms={texture:{type:"t"},picking:{type:"bool"}},this.material=new gu.ShaderMaterial({uniforms:this.uniforms,transparent:!0,vertexShader:Gqe(r,i),fragmentShader:Hqe}),this.processLabelVerts(s),this.createColorBuffers(s);var o=new Float32Array(this.totalVertexCount*Xi.XYZ_NUM_ELEMENTS);this.positions=new gu.BufferAttribute(o,Xi.XYZ_NUM_ELEMENTS);var a=new Float32Array(this.totalVertexCount*Xi.XYZ_NUM_ELEMENTS),l=new Float32Array(this.totalVertexCount*Xi.UV_NUM_ELEMENTS),c=new Float32Array(this.totalVertexCount*Xi.RGB_NUM_ELEMENTS),u=new gu.BufferAttribute(a,2),h=new gu.BufferAttribute(l,Xi.UV_NUM_ELEMENTS),f=new gu.BufferAttribute(c,Xi.RGB_NUM_ELEMENTS);this.geometry=new gu.BufferGeometry,this.geometry.setAttribute("posObj",u),this.geometry.setAttribute("position",this.positions),this.geometry.setAttribute("uv",h),this.geometry.setAttribute("color",f);for(var d=0,p=0;p<s;p++){for(var m=this.labelStrings[p],v=0,y=0;y<m.length;y++){var w=m.charCodeAt(y);v+=this.glyphTexture.lengths[w]}v/=-2;for(var y=0;y<m.length;y++){var w=m.charCodeAt(y),x=this.glyphTexture.lengths[w],_=r,S=(v+x)/_,T=v/_,E=r/_;u.setXY(d*js+0,T,0),u.setXY(d*js+1,S,0),u.setXY(d*js+2,T,E),u.setXY(d*js+3,T,E),u.setXY(d*js+4,S,0),u.setXY(d*js+5,S,E);var k=this.glyphTexture.offsets[w],A=this.glyphTexture.offsets[w]+x;k/=nO,A/=nO;var M=1,D=0;h.setXY(d*js+0,k,M),h.setXY(d*js+1,A,M),h.setXY(d*js+2,k,D),h.setXY(d*js+3,k,D),h.setXY(d*js+4,A,M),h.setXY(d*js+5,A,D),d++,v+=x}}for(var P=function(R){var F=xK.vector3FromPackedArray(N.worldSpacePointPositions,R);N.labelVertexMap[R].forEach(function(O){e.positions.setXYZ(O,F.x,F.y,F.z)})},N=this,p=0;p<s;p++)P(p);this.labelsMesh=new gu.Mesh(this.geometry,this.material),this.labelsMesh.frustumCulled=!1,this.scene.add(this.labelsMesh)}}},t.prototype.colorLabels=function(e){if(!(this.labelStrings==null||this.geometry==null||e==null)){var n=this.geometry.getAttribute("color");n.array=this.renderColors;for(var r=e.length/Xi.RGBA_NUM_ELEMENTS,i=0,s=0;s<r;++s){for(var o=new gu.Color(e[i],e[i+1],e[i+2]),a=this.labelVertexMap[s].length,l=0;l<a;++l)n.setXYZ(this.labelVertexMap[s][l],o.r,o.g,o.b);i+=Xi.RGBA_NUM_ELEMENTS}n.needsUpdate=!0}},t.prototype.setScene=function(e){this.scene=e},t.prototype.dispose=function(){this.labelsMesh&&(this.scene&&this.scene.remove(this.labelsMesh),this.labelsMesh=null),this.geometry&&(this.geometry.dispose(),this.geometry=null),this.glyphTexture!=null&&this.glyphTexture.texture!=null&&(this.glyphTexture.texture.dispose(),this.glyphTexture.texture=null)},t.prototype.onPickingRender=function(e){if(this.geometry==null){this.createLabels();return}this.material.uniforms.texture.value=this.glyphTexture.texture,this.material.uniforms.picking.value=!0;var n=this.geometry.getAttribute("color");n.array=this.pickingColors,n.needsUpdate=!0},t.prototype.onRender=function(e){if(this.geometry==null){this.createLabels();return}this.colorLabels(e.pointColors),this.material.uniforms.texture.value=this.glyphTexture.texture,this.material.uniforms.picking.value=!1;var n=this.geometry.getAttribute("color");n.array=this.renderColors,n.needsUpdate=!0},t.prototype.onPointPositionsChanged=function(e){this.worldSpacePointPositions=e,this.dispose()},t.prototype.setLabelStrings=function(e){this.labelStrings=e,this.dispose()},t.prototype.onResize=function(e,n){},t}();tO.ScatterPlotVisualizer3DLabels=jqe;var iO={};Object.defineProperty(iO,"__esModule",{value:!0});var Ms=Gd,qqe=zx,_K=Fi,jo=Ml,SK=function(t){return`
    // Index of the specific vertex (passed in as bufferAttribute), and the
    // variable that will be used to pass it to the fragment shader.
    attribute float spriteIndex;
    attribute vec4 color;
    attribute float scaleFactor;

    varying vec2 xyIndex;
    varying vec4 vColor;

    uniform bool sizeAttenuation;
    uniform float pointSize;
    uniform float spritesPerRow;
    uniform float spritesPerColumn;

    varying float fogDepth;

    void main() {
      // Pass index and color values to fragment shader.
      vColor = color;
      xyIndex = vec2(mod(spriteIndex, spritesPerRow),
                floor(spriteIndex / spritesPerColumn));

      // Transform current vertex by modelViewMatrix (model world position and
      // camera world position matrix).
      vec4 cameraSpacePos = modelViewMatrix * vec4(position, 1.0);

      // Project vertex in camera-space to screen coordinates using the camera's
      // projection matrix.
      gl_Position = projectionMatrix * cameraSpacePos;

      // Create size attenuation (if we're in 3D mode) by making the size of
      // each point inversly proportional to its distance to the camera.
      float outputPointSize = pointSize;
      if (sizeAttenuation) {
        outputPointSize = -pointSize / cameraSpacePos.z;
        fogDepth = pointSize / outputPointSize * 1.2;
      } else {  // Create size attenuation (if we're in 2D mode)
        const float PI = 3.1415926535897932384626433832795;
        const float minScale = 0.1;  // minimum scaling factor
        const float outSpeed = 2.0;  // shrink speed when zooming out
        const float outNorm = (1. - minScale) / atan(outSpeed);
        const float maxScale = 15.0;  // maximum scaling factor
        const float inSpeed = 0.02;  // enlarge speed when zooming in
        const float zoomOffset = 0.3;  // offset zoom pivot
        float zoom = projectionMatrix[0][0] + zoomOffset;  // zoom pivot
        float scale = zoom < 1. ? 1. + outNorm * atan(outSpeed * (zoom - 1.)) :
                      1. + 2. / PI * (maxScale - 1.) * atan(inSpeed * (zoom - 1.));
        outputPointSize = pointSize * scale;
      }

      gl_PointSize =
        max(outputPointSize * scaleFactor, `+t.toFixed(1)+`);
    }`},CK=`
    bool point_in_unit_circle(vec2 spriteCoord) {
      vec2 centerToP = spriteCoord - vec2(0.5, 0.5);
      return dot(centerToP, centerToP) < (0.5 * 0.5);
    }

    bool point_in_unit_equilateral_triangle(vec2 spriteCoord) {
      vec3 v0 = vec3(0, 1, 0);
      vec3 v1 = vec3(0.5, 0, 0);
      vec3 v2 = vec3(1, 1, 0);
      vec3 p = vec3(spriteCoord, 0);
      float p_in_v0_v1 = cross(v1 - v0, p - v0).z;
      float p_in_v1_v2 = cross(v2 - v1, p - v1).z;
      return (p_in_v0_v1 > 0.0) && (p_in_v1_v2 > 0.0);
    }

    bool point_in_unit_square(vec2 spriteCoord) {
      return true;
    }
  `,Xqe=`
    varying vec2 xyIndex;
    varying vec4 vColor;

    uniform sampler2D texture;
    uniform float spritesPerRow;
    uniform float spritesPerColumn;
    uniform bool isImage;

    `+Ms.ShaderChunk.common+`
    `+CK+`
    uniform vec3 fogColor;
    varying float fogDepth;
		uniform float fogNear;
    uniform float fogFar;

    void main() {
      if (isImage) {
        // Coordinates of the vertex within the entire sprite image.
        vec2 coords =
          (gl_PointCoord + xyIndex) / vec2(spritesPerRow, spritesPerColumn);
        gl_FragColor = vColor * texture2D(texture, coords);
      } else {
        bool inside = point_in_unit_circle(gl_PointCoord);
        if (!inside) {
          discard;
        }
        gl_FragColor = vColor;
      }
      float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
      gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
    }`,Kqe=`
    varying vec2 xyIndex;
    varying vec4 vColor;
    uniform bool isImage;

    `+CK+`

    varying float fogDepth;

    void main() {
      xyIndex; // Silence 'unused variable' warning.
      fogDepth; // Silence 'unused variable' warning.
      if (isImage) {
        gl_FragColor = vColor;
      } else {
        bool inside = point_in_unit_circle(gl_PointCoord);
        if (!inside) {
          discard;
        }
        gl_FragColor = vColor;
      }
    }`,Yqe=function(){function t(e,n){this.styles=e,this.id="SPRITES",this.isSpriteSheetMode=!1,this.spritesPerRow=0,this.spritesPerColumn=0,this.spriteDimensions=[0,0],this.worldSpacePointPositions=new Float32Array(0),this.pickingColors=new Float32Array(0),this.renderColors=new Float32Array(0),this.standinTextureForPoints=_K.createTextureFromCanvas(document.createElement("canvas")),n&&(this.spriteSheetParams=n,this.setSpriteSheet(n),this.isSpriteSheetMode=!0),this.renderMaterial=this.createRenderMaterial(),this.pickingMaterial=this.createPickingMaterial()}return t.prototype.createUniforms=function(){return{texture:{type:"t"},spritesPerRow:{type:"f"},spritesPerColumn:{type:"f"},fogColor:{type:"c"},fogNear:{type:"f"},fogFar:{type:"f"},isImage:{type:"bool"},sizeAttenuation:{type:"bool"},pointSize:{type:"f"}}},t.prototype.createRenderMaterial=function(){this.isSpriteSheetMode;var e=this.createUniforms();return new Ms.ShaderMaterial({uniforms:e,vertexShader:SK(this.styles.sprites.minPointSize),fragmentShader:Xqe,transparent:!0,depthFunc:Ms.LessDepth,fog:this.styles.fog.enabled,blending:Ms.NormalBlending})},t.prototype.createPickingMaterial=function(){var e=this.createUniforms();return new Ms.ShaderMaterial({uniforms:e,vertexShader:SK(this.styles.sprites.minPointSize),fragmentShader:Kqe,transparent:!0,depthTest:!0,depthWrite:!0,fog:!1,blending:Ms.NormalBlending})},t.prototype.createPointSprites=function(e,n){var r=n!=null?n.length/jo.XYZ_NUM_ELEMENTS:0,i=this.createGeometry(r);this.fog=new Ms.Fog(16777215),this.points=new Ms.Points(i,this.renderMaterial),this.points.frustumCulled=!1,this.spriteIndexBufferAttribute!=null&&this.points.geometry.setAttribute("spriteIndex",this.spriteIndexBufferAttribute),e.add(this.points)},t.prototype.calculatePointSize=function(e){var n=this.styles.sprites.imageSize;if(this.texture)return e?n:this.spriteDimensions[0];var r=this.worldSpacePointPositions!=null?this.worldSpacePointPositions.length/jo.XYZ_NUM_ELEMENTS:1,i=200,s=8,o=1.5,a=i/Math.log(r)/Math.log(s);return e?a:a/o},t.prototype.createGeometry=function(e){var n=e;this.pickingColors=new Float32Array(n*jo.RGBA_NUM_ELEMENTS);for(var r=0,i=0;i<n;i++){var s=new Ms.Color(i);this.pickingColors[r++]=s.r,this.pickingColors[r++]=s.g,this.pickingColors[r++]=s.b,this.pickingColors[r++]=1}var o=new Ms.BufferGeometry;return o.setAttribute("position",new Ms.BufferAttribute(new Float32Array([]),jo.XYZ_NUM_ELEMENTS)),o.setAttribute("color",new Ms.BufferAttribute(new Float32Array([]),jo.RGBA_NUM_ELEMENTS)),o.setAttribute("scaleFactor",new Ms.BufferAttribute(new Float32Array([]),jo.INDEX_NUM_ELEMENTS)),o.computeVertexNormals(),o},t.prototype.setFogDistances=function(e,n,r){var i=this.styles.fog,s=i.threshold,o=i.enabled;if(e&&o){var a=this.worldSpacePointPositions.length/jo.XYZ_NUM_ELEMENTS;this.fog.near=n;var l=2-Math.min(a,s)/s;this.fog.far=r*l}else this.fog.near=1/0,this.fog.far=1/0},t.prototype.dispose=function(){this.disposeGeometry(),this.disposeSpriteSheet()},t.prototype.disposeGeometry=function(){this.points!=null&&(this.scene.remove(this.points),this.points.geometry.dispose(),this.points=null,this.worldSpacePointPositions=null)},t.prototype.disposeSpriteSheet=function(){this.texture&&this.texture.dispose(),this.texture=null,this.renderMaterial=null,this.pickingMaterial=null,this.spriteSheetImage=null},t.prototype.setScene=function(e){this.scene=e},t.prototype.setSpriteSheet=function(e){var n=this,r=e.spriteDimensions,i=e.spriteIndices,s=e.onImageLoad,o=e.spritesheetImage;if(typeof o=="string"){var a=o;o=new Image,o.src=a}this.spriteSheetImage=o,this.texture=_K.createTextureFromImage(this.spriteSheetImage,function(){n.spritesPerRow=n.spriteSheetImage.width/r[0],n.spritesPerColumn=n.spriteSheetImage.height/r[1],s()}),this.spriteDimensions=r,this.spriteIndexBufferAttribute=new Ms.BufferAttribute(i,jo.INDEX_NUM_ELEMENTS),this.points!=null&&this.points.geometry.setAttribute("spriteIndex",this.spriteIndexBufferAttribute)},t.prototype.onPointPositionsChanged=function(e){this.points!=null&&this.worldSpacePointPositions.length!==e.length&&this.disposeGeometry(),this.worldSpacePointPositions=e,this.points==null&&this.createPointSprites(this.scene,e),this.spriteSheetParams&&this.setSpriteSheet(this.spriteSheetParams),this.renderMaterial=this.createRenderMaterial(),this.pickingMaterial=this.createPickingMaterial();var n=this.points.geometry.getAttribute("position");n.array=e,n.count=e.length/jo.XYZ_NUM_ELEMENTS,n.needsUpdate=!0},t.prototype.onPickingRender=function(e){var n=e.cameraType===qqe.CameraType.Perspective;this.pickingMaterial.uniforms.spritesPerRow.value=this.spritesPerRow,this.pickingMaterial.uniforms.spritesPerRow.value=this.spritesPerColumn,this.pickingMaterial.uniforms.sizeAttenuation.value=n,this.pickingMaterial.uniforms.pointSize.value=this.calculatePointSize(n),this.points.material=this.pickingMaterial;var r=this.points.geometry.getAttribute("color");r.array=this.pickingColors,r.count=this.pickingColors.length/jo.RGBA_NUM_ELEMENTS,r.needsUpdate=!0;var i=this.points.geometry.getAttribute("scaleFactor");i.array=e.pointScaleFactors,i.count=e.pointScaleFactors.length,i.count=e.pointScaleFactors.length/jo.INDEX_NUM_ELEMENTS,i.needsUpdate=!0},t.prototype.onRender=function(e){var n=e.camera instanceof Ms.PerspectiveCamera;this.setFogDistances(n,e.nearestCameraSpacePointZ,e.farthestCameraSpacePointZ),this.scene.fog=this.fog,this.scene.fog.color=new Ms.Color(e.backgroundColor),this.renderMaterial.uniforms.fogColor.value=this.scene.fog.color,this.renderMaterial.uniforms.fogNear.value=this.fog.near,this.renderMaterial.uniforms.fogFar.value=this.fog.far,this.renderMaterial.uniforms.spritesPerRow.value=this.spritesPerRow,this.renderMaterial.uniforms.spritesPerColumn.value=this.spritesPerColumn,this.renderMaterial.uniforms.isImage.value=this.texture!=null,this.renderMaterial.uniforms.texture.value=this.texture!=null?this.texture:this.standinTextureForPoints,this.renderMaterial.uniforms.sizeAttenuation.value=n,this.renderMaterial.uniforms.pointSize.value=this.calculatePointSize(n),this.points.material=this.renderMaterial;var r=this.points.geometry.getAttribute("color");this.renderColors=e.pointColors,r.array=this.renderColors,r.count=this.renderColors.length/jo.RGBA_NUM_ELEMENTS,r.needsUpdate=!0;var i=this.points.geometry.getAttribute("scaleFactor");i.array=e.pointScaleFactors,i.count=e.pointScaleFactors.length/jo.INDEX_NUM_ELEMENTS,i.needsUpdate=!0},t.prototype.onResize=function(e,n){},t}();iO.ScatterPlotVisualizerSprites=Yqe;var sO={},oO={};Object.defineProperty(oO,"__esModule",{value:!0});var Zqe=function(){function t(e,n,r){this.bound=e,this.cellWidth=n,this.cellHeight=r,this.numHorizCells=Math.ceil(this.boundWidth(e)/n),this.numVertCells=Math.ceil(this.boundHeight(e)/r),this.grid=new Array(this.numHorizCells*this.numVertCells)}return t.prototype.boundWidth=function(e){return e.hiX-e.loX},t.prototype.boundHeight=function(e){return e.hiY-e.loY},t.prototype.boundsIntersect=function(e,n){return!(e.loX>n.hiX||e.loY>n.hiY||e.hiX<n.loX||e.hiY<n.loY)},t.prototype.insert=function(e,n){if(n===void 0&&(n=!1),e.hiX<this.bound.loX||e.loX>this.bound.hiX||e.hiY<this.bound.loY||e.loY>this.bound.hiY)return!1;for(var r=this.getCellX(e.loX),i=this.getCellX(e.hiX),s=this.getCellY(e.loY),o=this.getCellY(e.hiY),a=s*this.numHorizCells+r,l=a,c=s;c<=o;c++){for(var u=r;u<=i;u++){var h=this.grid[l++];if(h){for(var f=0;f<h.length;f++)if(this.boundsIntersect(e,h[f]))return!1}}l+=this.numHorizCells-(i-r+1)}if(n)return!0;l=a;for(var c=s;c<=o;c++){for(var u=r;u<=i;u++)this.grid[l]?this.grid[l].push(e):this.grid[l]=[e],l++;l+=this.numHorizCells-(i-r+1)}return!0},t.prototype.getCellX=function(e){return Math.floor((e-this.bound.loX)/this.cellWidth)},t.prototype.getCellY=function(e){return Math.floor((e-this.bound.loY)/this.cellHeight)},t}();oO.CollisionGrid=Zqe;var Jqe=$t&&$t.__read||function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s};Object.defineProperty(sO,"__esModule",{value:!0});var Qqe=Gd,e7e=zx,t7e=oO,aO=Fi,n7e=1e4,r7e=function(){function t(e,n){this.styles=n,this.id="CANVAS_LABELS",this.worldSpacePointPositions=new Float32Array(0),this.labelsActive=!0,this.canvas=document.createElement("canvas"),e.appendChild(this.canvas),this.gc=this.canvas.getContext("2d"),this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.top="0",this.canvas.style.pointerEvents="none"}return t.prototype.removeAllLabels=function(){var e=this.canvas.width*window.devicePixelRatio,n=this.canvas.height*window.devicePixelRatio;this.gc.clearRect(0,0,e,n)},t.prototype.makeLabels=function(e){if(!(e.labels==null||e.labels.pointIndices.length===0)&&this.worldSpacePointPositions!=null){var n=e.labels,r=e.cameraType===e7e.CameraType.Perspective,i=parseInt(this.gc.font,10),s=window.devicePixelRatio,o;{var a=this.canvas.width*s,l=this.canvas.height*s,c={loX:0,hiX:a,loY:0,hiY:l};o=new t7e.CollisionGrid(c,a/25,l/50)}var u=[e.farthestCameraSpacePointZ,e.nearestCameraSpacePointZ],h=function(P){return aO.scaleExponential(P,u,[.1,1])},f=e.camera.position,d=f.clone().sub(e.cameraTarget),p=new Qqe.Vector3;this.gc.textBaseline="middle",this.gc.miterLimit=2;for(var m=2,v=4,y=Math.min(n7e,n.pointIndices.length),w=0;w<y;++w){var x=void 0;{var _=n.pointIndices[w];x=aO.vector3FromPackedArray(this.worldSpacePointPositions,_)}if(p.copy(f).sub(x),!(d.dot(p)<0)){var S=Jqe(aO.vector3DToScreenCoords(e.camera,e.screenWidth,e.screenHeight,x),2),T=S[0],E=S[1];T+=v;var k={loX:T-m,hiX:T+1+m,loY:E-i/2-m,hiY:E+i/2+m};if(o.insert(k,!0)){var A=n.labelStrings[w],M=n.defaultFontSize*n.scaleFactors[w]*s;if(this.gc.font=M+"px roboto",k.hiX+=this.gc.measureText(A).width-1,o.insert(k)){var D=1;r&&n.useSceneOpacityFlags[w]===1&&(D=h(p.length())),this.gc.fillStyle=this.styleStringFromPackedRgba(n.fillColors,w,D),this.gc.strokeStyle=this.styleStringFromPackedRgba(n.strokeColors,w,D),this.gc.lineWidth=this.styles.label.strokeWidth,this.gc.strokeText(A,T,E),this.gc.lineWidth=this.styles.label.fillWidth,this.gc.fillText(A,T,E)}}}}}},t.prototype.styleStringFromPackedRgba=function(e,n,r){var i=n*3,s=e[i],o=e[i+1],a=e[i+2];return"rgba("+s+","+o+","+a+","+r+")"},t.prototype.onResize=function(e,n){var r=window.devicePixelRatio;this.canvas.width=e*r,this.canvas.height=n*r,this.canvas.style.width=e+"px",this.canvas.style.height=n+"px"},t.prototype.dispose=function(){this.removeAllLabels()},t.prototype.onPointPositionsChanged=function(e){this.worldSpacePointPositions=e,this.removeAllLabels()},t.prototype.onRender=function(e){!this.labelsActive||(this.removeAllLabels(),this.makeLabels(e))},t.prototype.setScene=function(e){},t.prototype.onPickingRender=function(e){},t}();sO.ScatterPlotVisualizerCanvasLabels=r7e;var lO={},TK=$t&&$t.__values||function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(lO,"__esModule",{value:!0});var Uv=Gd,EK=Fi,vk=Ml,i7e=function(){function t(){this.id="POLYLINES",this.sequences=[],this.polylines=[],this.polylinePositionBuffer={},this.polylineColorBuffer={},this.pointSequenceIndices=new Map}return t.prototype.getPointSequenceIndex=function(e){return this.pointSequenceIndices.get(e)},t.prototype.updateSequenceIndices=function(){for(var e=0;e<this.sequences.length;e++)for(var n=this.sequences[e],r=0;r<n.indices.length-1;r++){var i=n.indices[r];this.pointSequenceIndices.set(i,e),this.pointSequenceIndices.set(i+1,e)}},t.prototype.createPolylines=function(){var e,n;this.updateSequenceIndices();try{for(var r=TK(this.polylines),i=r.next();!i.done;i=r.next()){var s=i.value;this.scene.remove(s),s.geometry.dispose()}}catch(c){e={error:c}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}this.polylines=[];for(var o=0;o<this.sequences.length;o++){var a=new Uv.BufferGeometry;a.addAttribute("position",this.polylinePositionBuffer[o]),a.addAttribute("color",this.polylineColorBuffer[o]);var l=new Uv.LineBasicMaterial({linewidth:1,opacity:1,transparent:!0,vertexColors:Uv.VertexColors}),s=new Uv.LineSegments(a,l);s.frustumCulled=!1,this.polylines.push(s),this.scene.add(s)}},t.prototype.dispose=function(){var e,n;try{for(var r=TK(this.polylines),i=r.next();!i.done;i=r.next()){var s=i.value;this.scene.remove(s),s.geometry.dispose()}}catch(o){e={error:o}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}this.polylines=[],this.polylinePositionBuffer={},this.polylineColorBuffer={}},t.prototype.setScene=function(e){this.scene=e},t.prototype.setSequences=function(e){this.sequences=e},t.prototype.onPointPositionsChanged=function(e){if(e==null&&this.dispose(),!(e==null||this.sequences.length===0)){for(var n=0;n<this.sequences.length;n++){var r=this.sequences[n],i=2*(r.indices.length-1),s=new Float32Array(i*vk.XYZ_NUM_ELEMENTS);this.polylinePositionBuffer[n]=new Uv.BufferAttribute(s,vk.XYZ_NUM_ELEMENTS);var o=new Float32Array(i*vk.RGBA_NUM_ELEMENTS);this.polylineColorBuffer[n]=new Uv.BufferAttribute(o,vk.RGBA_NUM_ELEMENTS)}for(var n=0;n<this.sequences.length;n++){for(var r=this.sequences[n],a=0,l=0;l<r.indices.length-1;l++){var c=r.indices[l],u=r.indices[l+1],h=EK.vector3FromPackedArray(e,c),f=EK.vector3FromPackedArray(e,u);this.polylinePositionBuffer[n].setXYZ(a,h.x,h.y,h.z),this.polylinePositionBuffer[n].setXYZ(a+1,f.x,f.y,f.z),a+=2}this.polylinePositionBuffer[n].needsUpdate=!0}this.createPolylines()}},t.prototype.onRender=function(e){for(var n=0;n<this.polylines.length;n++){var r=this.polylines[n].material;r.opacity=e.polylineOpacities[n],r.linewidth=e.polylineWidths[n],this.polylineColorBuffer[n].array=e.polylineColors[n],this.polylineColorBuffer[n].needsUpdate=!0}},t.prototype.onPickingRender=function(e){},t.prototype.onResize=function(e,n){},t}();lO.ScatterPlotVisualizerPolylines=i7e;var s7e=$t&&$t.__read||function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},cO=$t&&$t.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(s7e(arguments[e]));return t},kK=$t&&$t.__values||function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t3,"__esModule",{value:!0});var o7e=n3,Hd=JP,a7e=gk,l7e=zx,c7e=eO,Is=Fi,yk=Ml,u7e=tO,AK=iO,h7e=sO,f7e=lO,d7e=function(){function t(e,n){var r=this;n===void 0&&(n={}),this.pointColorer=null,this.sequences=[],this.renderMode="POINT",this.rotateOnStart=!0,this.selectEnabled=!0,this.showLabelsOnHover=!0,this.hoverPointIndex=null,this.selectedPointIndices=new Set,this.clickCallback=function(){},this.hoverCallback=function(){},this.selectCallback=function(){},this.cameraMoveCallback=function(){},this.onHover=function(i){r.hoverCallback(i),r.hoverPointIndex=i,r.updateScatterPlotAttributes(),r.renderScatterPlot()},this.onClick=function(i){r.clickCallback(i)},this.select=function(i){!r.selectEnabled||(r.selectedPointIndices=new Set(i),r.updateScatterPlotAttributes(),r.renderScatterPlot())},this.onSelect=function(i){!r.selectEnabled||(r.selectCallback(i),r.select(i))},this.containerElement=e,this.styles=c7e.makeStyles(n.styles),this.setParameters(n),this.scatterPlot=new o7e.ScatterPlot(e,{camera:n.camera,onClick:this.onClick,onHover:this.onHover,onSelect:this.onSelect,selectEnabled:this.selectEnabled,styles:this.styles,orbitControlParams:n.orbitControls}),this.scatterPlot.onCameraMove(this.cameraMoveCallback)}return t.prototype.setParameters=function(e){e.onClick!==void 0&&(this.clickCallback=e.onClick),e.onHover!==void 0&&(this.hoverCallback=e.onHover),e.onSelect!==void 0&&(this.selectCallback=e.onSelect),e.onCameraMove!==void 0&&(this.cameraMoveCallback=e.onCameraMove),e.pointColorer!==void 0&&(this.pointColorer=e.pointColorer),e.renderMode!==void 0&&(this.renderMode=e.renderMode),e.rotateOnStart!==void 0&&(this.rotateOnStart=e.rotateOnStart),e.selectEnabled!==void 0&&(this.selectEnabled=e.selectEnabled),e.showLabelsOnHover!==void 0&&(this.showLabelsOnHover=e.showLabelsOnHover)},t.prototype.render=function(e){this.updateDataset(e),this.setVisualizers(),this.rotateOnStart&&this.scatterPlot.startOrbitAnimation()},t.prototype.renderScatterPlot=function(){this.dataset&&this.scatterPlot.render()},t.prototype.setRenderMode=function(e){this.renderMode=e,this.setVisualizers(),this.updateScatterPlotAttributes(),this.updateScatterPlotPositions()},t.prototype.setTextRenderMode=function(){this.setRenderMode("TEXT"),this.renderScatterPlot()},t.prototype.setPointRenderMode=function(){this.setRenderMode("POINT"),this.renderScatterPlot()},t.prototype.setSpriteRenderMode=function(){this.dataset&&this.dataset.spriteMetadata&&(this.setRenderMode("SPRITE"),this.renderScatterPlot())},t.prototype.setSequences=function(e){this.sequences=e,this.updatePolylineAttributes(),this.setVisualizers(),this.renderScatterPlot()},t.prototype.setPanMode=function(){this.scatterPlot.setInteractionMode("PAN")},t.prototype.setSelectMode=function(){this.scatterPlot.setInteractionMode("SELECT")},t.prototype.setDimensions=function(e){var n=e<2||e>3,r=this.dataset&&e>this.dataset.dimensions;if(n||r)throw new RangeError("Setting invalid dimensionality");this.scatterPlot.setDimensions(e),this.renderScatterPlot()},t.prototype.setPointColorer=function(e){this.pointColorer=e,this.updateScatterPlotAttributes(),this.renderScatterPlot()},t.prototype.callPointColorer=function(e,n){return e(n,this.selectedPointIndices,this.hoverPointIndex)},t.prototype.setHoverPointIndex=function(e){this.hoverPointIndex=e,this.updateScatterPlotAttributes(),!this.scatterPlot.orbitIsAnimating()&&this.renderScatterPlot()},t.prototype.resize=function(){this.scatterPlot.resize()},t.prototype.updateDataset=function(e){this.setDataset(e),this.scatterPlot.setDimensions(e.dimensions),this.updateScatterPlotAttributes(),this.updateScatterPlotPositions(),this.renderScatterPlot()},t.prototype.isOrbiting=function(){return this.scatterPlot.orbitIsAnimating()},t.prototype.startOrbitAnimation=function(){this.scatterPlot.startOrbitAnimation()},t.prototype.stopOrbitAnimation=function(){this.scatterPlot.stopOrbitAnimation()},t.prototype.setDataset=function(e){this.dataset=e,this.labels3DVisualizer&&this.labels3DVisualizer.setLabelStrings(this.generate3DLabelsArray())},t.prototype.updateScatterPlotPositions=function(){var e=this.dataset;if(!!e){var n=this.generatePointPositionArray(e);this.scatterPlot.setPointPositions(n)}},t.prototype.updateScatterPlotAttributes=function(){var e=this.dataset;if(!!e){var n=this.generatePointColorArray(e),r=this.generatePointScaleFactorArray(e),i=this.generateVisibleLabelRenderParams();this.scatterPlot.setPointColors(n),this.scatterPlot.setPointScaleFactors(r),this.scatterPlot.setLabels(i)}},t.prototype.updatePolylineAttributes=function(){var e=this.dataset;if(!!e){var n=this.generateLineSegmentColorMap(e),r=this.generateLineSegmentOpacityArray(e),i=this.generateLineSegmentWidthArray(e);this.scatterPlot.setPolylineColors(n),this.scatterPlot.setPolylineOpacities(r),this.scatterPlot.setPolylineWidths(i)}},t.prototype.generatePointPositionArray=function(e){var n=[0,0],r=[0,0],i=[0,0];n=Is.extent(e.points.map(function(y){return y[0]})),r=Is.extent(e.points.map(function(y){return y[1]})),e.dimensions===3&&(i=Is.extent(e.points.map(function(y){return y[2]})));var s=function(y){return Math.abs(y[1]-y[0])},o=s(n),a=s(r),l=s(i),c=Math.max(o,a,l),u=yk.SCATTER_PLOT_CUBE_LENGTH/2,h=function(y,w){return[-w*(y/c),w*(y/c)]},f=h(o,u),d=h(a,u),p=h(l,u),m=new Float32Array(e.points.length*3),v=0;return e.points.forEach(function(y,w){var x=e.points[w];m[v++]=Is.scaleLinear(x[0],n,f),m[v++]=Is.scaleLinear(x[1],r,d),e.dimensions===3?m[v++]=Is.scaleLinear(x[2],i,p):m[v++]=0}),m},t.prototype.generateVisibleLabelRenderParams=function(){var e=this,n=e.hoverPointIndex,r=e.selectedPointIndices,i=e.styles,s=n!==null?1:0,o=new Uint32Array(s),a=new Float32Array(s),l=new Int8Array(s),c=new Uint8Array(s*3),u=new Uint8Array(s*3),h=[];a.fill(i.label.scaleDefault),l.fill(1);var f=0;if(n!==null){h.push(this.getLabelText(n)),o[f]=n,a[f]=i.label.scaleLarge,l[f]=0;var d=Is.styleRgbFromHexColor(i.label.fillColorHover);Is.packRgbIntoUint8Array(c,f,d[0],d[1],d[2]);var p=Is.styleRgbFromHexColor(i.label.strokeColorHover);Is.packRgbIntoUint8Array(u,f,p[0],p[1],p[1]),++f}{var d=Is.styleRgbFromHexColor(i.label.fillColorSelected),p=Is.styleRgbFromHexColor(i.label.strokeColorSelected);if(r.size===1){var m=cO(r)[0];h.push(this.getLabelText(m)),o[f]=m,a[f]=i.label.scaleLarge,l[f]=0,Is.packRgbIntoUint8Array(c,f,d[0],d[1],d[2]),Is.packRgbIntoUint8Array(u,f,p[0],p[1],p[2])}}return new l7e.LabelRenderParams(new Float32Array(o),h,a,l,i.label.fontSize,c,u)},t.prototype.generatePointScaleFactorArray=function(e){var n,r,i=this,s=i.hoverPointIndex,o=i.selectedPointIndices,a=i.styles,l=a.point,c=l.scaleDefault,u=l.scaleSelected,h=l.scaleHover,f=new Float32Array(e.points.length);f.fill(c),o.size;try{for(var d=kK(o.values()),p=d.next();!p.done;p=d.next()){var m=p.value;f[m]=u}}catch(v){n={error:v}}finally{try{p&&!p.done&&(r=d.return)&&r.call(d)}finally{if(n)throw n.error}}return s!=null&&(f[s]=h),f},t.prototype.generatePointColorArray=function(e){var n,r,i=this,s=i.hoverPointIndex,o=i.pointColorer,a=i.selectedPointIndices,l=i.styles,c=l.point,u=c.colorHover,h=c.colorNoSelection,f=c.colorSelected,d=c.colorUnselected,p=new Float32Array(e.points.length*yk.RGBA_NUM_ELEMENTS),m=d,v=h;this.renderMode==="TEXT"&&(m=this.styles.label3D.colorUnselected,v=this.styles.label3D.colorNoSelection),this.renderMode==="SPRITE"&&(m=this.styles.sprites.colorUnselected,v=this.styles.sprites.colorNoSelection);var y=e.points.length,w=this.selectedPointIndices.size;if(o)for(var x=0,_=0;_<y;++_){var S=Hd.parseColor(this.callPointColorer(o,_)||v);p[x++]=S.r,p[x++]=S.g,p[x++]=S.b,p[x++]=S.opacity}else{for(var x=0,S=w>0?Hd.parseColor(m):Hd.parseColor(v),_=0;_<y;++_)p[x++]=S.r,p[x++]=S.g,p[x++]=S.b,p[x++]=S.opacity;S=Hd.parseColor(f);try{for(var T=kK(a.values()),E=T.next();!E.done;E=T.next()){var k=E.value,A=k*yk.RGBA_NUM_ELEMENTS;p[A++]=S.r,p[A++]=S.g,p[A++]=S.b,p[A++]=S.opacity}}catch(R){n={error:R}}finally{try{E&&!E.done&&(r=T.return)&&r.call(T)}finally{if(n)throw n.error}}if(s!=null){var M=Hd.parseColor(u),D=s*yk.RGBA_NUM_ELEMENTS;p[D++]=M.r,p[D++]=M.g,p[D++]=M.b,p[D++]=M.opacity}}return p},t.prototype.generate3DLabelsArray=function(){var e=this.dataset;if(!e)return[];for(var n=[],r=e.points.length,i=0;i<r;++i)n.push(this.getLabelText(i));return n},t.prototype.generateLineSegmentColorMap=function(e){for(var n=this,r=n.pointColorer,i=n.styles,s={},o=0;o<this.sequences.length;o++){var a=this.sequences[o],l=new Float32Array(2*(a.indices.length-1)*3),c=0;if(r)for(var u=0;u<a.indices.length-1;u++){var h=Hd.parseColor(this.callPointColorer(r,a.indices[u])),f=Hd.parseColor(this.callPointColorer(r,a.indices[u+1]));l[c++]=h.r,l[c++]=h.g,l[c++]=h.b,l[c++]=f.r,l[c++]=f.g,l[c++]=f.b}else for(var u=0;u<a.indices.length-1;u++){var h=Is.getDefaultPointInPolylineColor(u,a.indices.length,i.polyline.startHue,i.polyline.endHue,i.polyline.saturation,i.polyline.lightness),f=Is.getDefaultPointInPolylineColor(u+1,a.indices.length,i.polyline.startHue,i.polyline.endHue,i.polyline.saturation,i.polyline.lightness);l[c++]=h.r,l[c++]=h.g,l[c++]=h.b,l[c++]=f.r,l[c++]=f.g,l[c++]=f.b}s[o]=l}return s},t.prototype.generateLineSegmentOpacityArray=function(e){var n=this,r=n.selectedPointIndices,i=n.styles,s=new Float32Array(this.sequences.length),o=r.size;if(o>0){s.fill(i.polyline.deselectedOpacity);var a=this.polylineVisualizer.getPointSequenceIndex(cO(r)[0]);a!==void 0&&(s[a]=i.polyline.selectedOpacity)}else s.fill(i.polyline.defaultOpacity);return s},t.prototype.generateLineSegmentWidthArray=function(e){var n=this,r=n.selectedPointIndices,i=n.styles,s=new Float32Array(this.sequences.length);s.fill(i.polyline.defaultLineWidth);var o=r.size;if(o>0){var a=this.polylineVisualizer.getPointSequenceIndex(cO(r)[0]);a!==void 0&&(s[a]=i.polyline.selectedLineWidth)}return s},t.prototype.getLabelText=function(e){var n=this.dataset;if(!n)return"";var r=n.metadata[e];return r&&r.label!=null?""+r.label:""},t.prototype.initializeCanvasLabelsVisualizer=function(){return this.canvasLabelsVisualizer||(this.canvasLabelsVisualizer=new h7e.ScatterPlotVisualizerCanvasLabels(this.containerElement,this.styles)),this.canvasLabelsVisualizer},t.prototype.initialize3DLabelsVisualizer=function(){return this.labels3DVisualizer||(this.labels3DVisualizer=new u7e.ScatterPlotVisualizer3DLabels(this.styles)),this.labels3DVisualizer.setLabelStrings(this.generate3DLabelsArray()),this.labels3DVisualizer},t.prototype.initializePointVisualizer=function(){return this.pointVisualizer||(this.pointVisualizer=new AK.ScatterPlotVisualizerSprites(this.styles)),this.pointVisualizer},t.prototype.initializeSpritesheetVisualizer=function(){var e=this,n=this.styles,r=this.dataset,i=r.spriteMetadata;if(!this.spritesheetVisualizer&&i){if(!i.spriteImage||!i.singleSpriteSize)return;var s=r.points.length,o=void 0;if(i.spriteIndices)o=new Float32Array(i.spriteIndices);else{o=new Float32Array(s);for(var a=0;a<s;++a)o[a]=a}var l=function(){return e.renderScatterPlot()},c=new AK.ScatterPlotVisualizerSprites(n,{spritesheetImage:i.spriteImage,spriteDimensions:i.singleSpriteSize,spriteIndices:o,onImageLoad:l});c.id="SPRITE_SHEET_VISUALIZER",this.spritesheetVisualizer=c}return this.spritesheetVisualizer},t.prototype.initializePolylineVisualizer=function(){return this.polylineVisualizer||(this.polylineVisualizer=new f7e.ScatterPlotVisualizerPolylines),this.polylineVisualizer.setSequences(this.sequences),this.polylineVisualizer},t.prototype.setVisualizers=function(){var e=this,n=e.dataset,r=e.renderMode,i=[];if(r==="TEXT"){var s=this.initialize3DLabelsVisualizer();i.push(s)}else if(r==="POINT"){var s=this.initializePointVisualizer();i.push(s)}else if(r==="SPRITE"&&n.spriteMetadata){var s=this.initializeSpritesheetVisualizer();s&&i.push(s)}if(this.sequences.length>0){var s=this.initializePolylineVisualizer();i.push(s)}var o=r==="POINT"||r==="SPRITE";if(o&&this.showLabelsOnHover){var s=this.initializeCanvasLabelsVisualizer();i.push(s)}this.scatterPlot.setActiveVisualizers(i)},t.Dataset=a7e.Dataset,t}();t3.ScatterGL=d7e;Object.defineProperty(e3,"__esModule",{value:!0});var p7e=t3;e3.ScatterGL=p7e.ScatterGL;var m7e=gk;e3.Dataset=m7e.Dataset;function Ge(){}const MK=t=>t;function g7e(t,e){for(const n in e)t[n]=e[n];return t}function v7e(t){return t&&typeof t=="object"&&typeof t.then=="function"}function IK(t){return t()}function NK(){return Object.create(null)}function Ra(t){t.forEach(IK)}function Vx(t){return typeof t=="function"}function Gt(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function y7e(t){return Object.keys(t).length===0}function _r(t,...e){if(t==null)return Ge;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function Ux(t){let e;return _r(t,n=>e=n)(),e}function uO(t,e,n){t.$$.on_destroy.push(_r(e,n))}function zh(t,e,n,r){if(t){const i=$K(t,e,n,r);return t[0](i)}}function $K(t,e,n,r){return t[1]&&r?g7e(n.ctx.slice(),t[1](r(e))):n.ctx}function b7e(t,e,n,r){if(t[2]&&r){const i=t[2](r(n));if(e.dirty===void 0)return i;if(typeof i=="object"){const s=[],o=Math.max(e.dirty.length,i.length);for(let a=0;a<o;a+=1)s[a]=e.dirty[a]|i[a];return s}return e.dirty|i}return e.dirty}function Vh(t,e,n,r,i,s,o){const a=b7e(e,r,i,s);if(a){const l=$K(e,n,r,o);t.p(l,a)}}function w7e(t){return t&&Vx(t.destroy)?t.destroy:Ge}const RK=typeof window!="undefined";let DK=RK?()=>window.performance.now():()=>Date.now(),hO=RK?t=>requestAnimationFrame(t):Ge;const Wv=new Set;function PK(t){Wv.forEach(e=>{e.c(t)||(Wv.delete(e),e.f())}),Wv.size!==0&&hO(PK)}function OK(t){let e;return Wv.size===0&&hO(PK),{promise:new Promise(n=>{Wv.add(e={c:t,f:n})}),abort(){Wv.delete(e)}}}let bk=!1;function x7e(){bk=!0}function _7e(){bk=!1}function S7e(t,e,n,r){for(;t<e;){const i=t+(e-t>>1);n(i)<=r?t=i+1:e=i}return t}function C7e(t){if(t.hydrate_init)return;t.hydrate_init=!0;const e=t.childNodes,n=new Int32Array(e.length+1),r=new Int32Array(e.length);n[0]=-1;let i=0;for(let l=0;l<e.length;l++){const c=e[l].claim_order,u=S7e(1,i+1,f=>e[n[f]].claim_order,c)-1;r[l]=n[u]+1;const h=u+1;n[h]=l,i=Math.max(h,i)}const s=[],o=[];let a=e.length-1;for(let l=n[i]+1;l!=0;l=r[l-1]){for(s.push(e[l-1]);a>=l;a--)o.push(e[a]);a--}for(;a>=0;a--)o.push(e[a]);s.reverse(),o.sort((l,c)=>l.claim_order-c.claim_order);for(let l=0,c=0;l<o.length;l++){for(;c<s.length&&o[l].claim_order>=s[c].claim_order;)c++;const u=c<s.length?s[c]:null;t.insertBefore(o[l],u)}}function X(t,e){bk?(C7e(t),(t.actual_end_child===void 0||t.actual_end_child!==null&&t.actual_end_child.parentElement!==t)&&(t.actual_end_child=t.firstChild),e!==t.actual_end_child?t.insertBefore(e,t.actual_end_child):t.actual_end_child=e.nextSibling):e.parentNode!==t&&t.appendChild(e)}function ie(t,e,n){bk&&!n?X(t,e):(e.parentNode!==t||e.nextSibling!=n)&&t.insertBefore(e,n||null)}function ne(t){t.parentNode.removeChild(t)}function Yr(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function oe(t){return document.createElement(t)}function Zr(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Ie(t){return document.createTextNode(t)}function Oe(){return Ie(" ")}function Ki(){return Ie("")}function Ln(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function T7e(t){return function(e){return e.preventDefault(),t.call(this,e)}}function E7e(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function H(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Gv(t,e,n){e in t?t[e]=typeof t[e]=="boolean"&&n===""?!0:n:H(t,e,n)}function k7e(t){return Array.from(t.childNodes)}function zt(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function Jr(t,e,n,r){t.style.setProperty(e,n,r?"important":"")}function FK(t,e){for(let n=0;n<t.options.length;n+=1){const r=t.options[n];if(r.__value===e){r.selected=!0;return}}}function A7e(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}let wk;function M7e(){if(wk===void 0){wk=!1;try{typeof window!="undefined"&&window.parent&&window.parent.document}catch{wk=!0}}return wk}function I7e(t,e){getComputedStyle(t).position==="static"&&(t.style.position="relative");const r=oe("iframe");r.setAttribute("style","display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: -1;"),r.setAttribute("aria-hidden","true"),r.tabIndex=-1;const i=M7e();let s;return i?(r.src="data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}<\/script>",s=Ln(window,"message",o=>{o.source===r.contentWindow&&e()})):(r.src="about:blank",r.onload=()=>{s=Ln(r.contentWindow,"resize",e)}),X(t,r),()=>{(i||s&&r.contentWindow)&&s(),ne(r)}}function dt(t,e,n){t.classList[n?"add":"remove"](e)}function LK(t,e,n=!1){const r=document.createEvent("CustomEvent");return r.initCustomEvent(t,n,!1,e),r}class N7e{constructor(e){this.e=this.n=null,this.l=e}m(e,n,r=null){this.e||(this.e=oe(n.nodeName),this.t=n,this.l?this.n=this.l:this.h(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.childNodes)}i(e){for(let n=0;n<this.n.length;n+=1)ie(this.t,this.n[n],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(ne)}}const fO=new Set;let xk=0;function $7e(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function dO(t,e,n,r,i,s,o,a=0){const l=16.666/r;let c=`{
`;for(let v=0;v<=1;v+=l){const y=e+(n-e)*s(v);c+=v*100+`%{${o(y,1-y)}}
`}const u=c+`100% {${o(n,1-n)}}
}`,h=`__svelte_${$7e(u)}_${a}`,f=t.ownerDocument;fO.add(f);const d=f.__svelte_stylesheet||(f.__svelte_stylesheet=f.head.appendChild(oe("style")).sheet),p=f.__svelte_rules||(f.__svelte_rules={});p[h]||(p[h]=!0,d.insertRule(`@keyframes ${h} ${u}`,d.cssRules.length));const m=t.style.animation||"";return t.style.animation=`${m?`${m}, `:""}${h} ${r}ms linear ${i}ms 1 both`,xk+=1,h}function BK(t,e){const n=(t.style.animation||"").split(", "),r=n.filter(e?s=>s.indexOf(e)<0:s=>s.indexOf("__svelte")===-1),i=n.length-r.length;i&&(t.style.animation=r.join(", "),xk-=i,xk||R7e())}function R7e(){hO(()=>{xk||(fO.forEach(t=>{const e=t.__svelte_stylesheet;let n=e.cssRules.length;for(;n--;)e.deleteRule(n);t.__svelte_rules={}}),fO.clear())})}function D7e(t,e,n,r){if(!e)return Ge;const i=t.getBoundingClientRect();if(e.left===i.left&&e.right===i.right&&e.top===i.top&&e.bottom===i.bottom)return Ge;const{delay:s=0,duration:o=300,easing:a=MK,start:l=DK()+s,end:c=l+o,tick:u=Ge,css:h}=n(t,{from:e,to:i},r);let f=!0,d=!1,p;function m(){h&&(p=dO(t,0,1,o,s,a,h)),s||(d=!0)}function v(){h&&BK(t,p),f=!1}return OK(y=>{if(!d&&y>=l&&(d=!0),d&&y>=c&&(u(1,0),v()),!f)return!1;if(d){const w=y-l,x=0+1*a(w/o);u(x,1-x)}return!0}),m(),u(0,1),v}function P7e(t){const e=getComputedStyle(t);if(e.position!=="absolute"&&e.position!=="fixed"){const{width:n,height:r}=e,i=t.getBoundingClientRect();t.style.position="absolute",t.style.width=n,t.style.height=r,zK(t,i)}}function zK(t,e){const n=t.getBoundingClientRect();if(e.left!==n.left||e.top!==n.top){const r=getComputedStyle(t),i=r.transform==="none"?"":r.transform;t.style.transform=`${i} translate(${e.left-n.left}px, ${e.top-n.top}px)`}}let _k;function Uh(t){_k=t}function jd(){if(!_k)throw new Error("Function called outside component initialization");return _k}function Da(t){jd().$$.on_mount.push(t)}function VK(t){jd().$$.after_update.push(t)}function Wh(t){jd().$$.on_destroy.push(t)}function Pa(){const t=jd();return(e,n)=>{const r=t.$$.callbacks[e];if(r){const i=LK(e,n);r.slice().forEach(s=>{s.call(t,i)})}}}function O7e(t,e){jd().$$.context.set(t,e)}function UK(t){return jd().$$.context.get(t)}function Sk(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}const Wx=[],Ur=[],Ck=[],pO=[],WK=Promise.resolve();let mO=!1;function GK(){mO||(mO=!0,WK.then(qd))}function Ns(){return GK(),WK}function vu(t){Ck.push(t)}function Il(t){pO.push(t)}let gO=!1;const vO=new Set;function qd(){if(!gO){gO=!0;do{for(let t=0;t<Wx.length;t+=1){const e=Wx[t];Uh(e),F7e(e.$$)}for(Uh(null),Wx.length=0;Ur.length;)Ur.pop()();for(let t=0;t<Ck.length;t+=1){const e=Ck[t];vO.has(e)||(vO.add(e),e())}Ck.length=0}while(Wx.length);for(;pO.length;)pO.pop()();mO=!1,gO=!1,vO.clear()}}function F7e(t){if(t.fragment!==null){t.update(),Ra(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(vu)}}let Gx;function L7e(){return Gx||(Gx=Promise.resolve(),Gx.then(()=>{Gx=null})),Gx}function yO(t,e,n){t.dispatchEvent(LK(`${e?"intro":"outro"}${n}`))}const Tk=new Set;let yu;function Bn(){yu={r:0,c:[],p:yu}}function zn(){yu.r||Ra(yu.c),yu=yu.p}function ve(t,e){t&&t.i&&(Tk.delete(t),t.i(e))}function be(t,e,n,r){if(t&&t.o){if(Tk.has(t))return;Tk.add(t),yu.c.push(()=>{Tk.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}}const B7e={duration:0};function Hv(t,e,n,r){let i=e(t,n),s=r?0:1,o=null,a=null,l=null;function c(){l&&BK(t,l)}function u(f,d){const p=f.b-s;return d*=Math.abs(p),{a:s,b:f.b,d:p,duration:d,start:f.start,end:f.start+d,group:f.group}}function h(f){const{delay:d=0,duration:p=300,easing:m=MK,tick:v=Ge,css:y}=i||B7e,w={start:DK()+d,b:f};f||(w.group=yu,yu.r+=1),o||a?a=w:(y&&(c(),l=dO(t,s,f,p,d,m,y)),f&&v(0,1),o=u(w,p),vu(()=>yO(t,f,"start")),OK(x=>{if(a&&x>a.start&&(o=u(a,p),a=null,yO(t,o.b,"start"),y&&(c(),l=dO(t,s,o.b,o.duration,0,m,i.css))),o){if(x>=o.end)v(s=o.b,1-s),yO(t,o.b,"end"),a||(o.b?c():--o.group.r||Ra(o.group.c)),o=null;else if(x>=o.start){const _=x-o.start;s=o.a+o.d*m(_/o.duration),v(s,1-s)}}return!!(o||a)}))}return{run(f){Vx(i)?L7e().then(()=>{i=i(),h(f)}):h(f)},end(){c(),o=a=null}}}function HK(t,e){const n=e.token={};function r(i,s,o,a){if(e.token!==n)return;e.resolved=a;let l=e.ctx;o!==void 0&&(l=l.slice(),l[o]=a);const c=i&&(e.current=i)(l);let u=!1;e.block&&(e.blocks?e.blocks.forEach((h,f)=>{f!==s&&h&&(Bn(),be(h,1,1,()=>{e.blocks[f]===h&&(e.blocks[f]=null)}),zn())}):e.block.d(1),c.c(),ve(c,1),c.m(e.mount(),e.anchor),u=!0),e.block=c,e.blocks&&(e.blocks[s]=c),u&&qd()}if(v7e(t)){const i=jd();if(t.then(s=>{Uh(i),r(e.then,1,e.value,s),Uh(null)},s=>{if(Uh(i),r(e.catch,2,e.error,s),Uh(null),!e.hasCatch)throw s}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}}function z7e(t,e,n){const r=e.slice(),{resolved:i}=t;t.current===t.then&&(r[t.value]=i),t.current===t.catch&&(r[t.error]=i),t.block.p(r,n)}const V7e=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;function U7e(t,e){be(t,1,1,()=>{e.delete(t.key)})}function W7e(t,e){t.f(),U7e(t,e)}function G7e(t,e,n,r,i,s,o,a,l,c,u,h){let f=t.length,d=s.length,p=f;const m={};for(;p--;)m[t[p].key]=p;const v=[],y=new Map,w=new Map;for(p=d;p--;){const T=h(i,s,p),E=n(T);let k=o.get(E);k?r&&k.p(T,e):(k=c(E,T),k.c()),y.set(E,v[p]=k),E in m&&w.set(E,Math.abs(p-m[E]))}const x=new Set,_=new Set;function S(T){ve(T,1),T.m(a,u),o.set(T.key,T),u=T.first,d--}for(;f&&d;){const T=v[d-1],E=t[f-1],k=T.key,A=E.key;T===E?(u=T.first,f--,d--):y.has(A)?!o.has(k)||x.has(k)?S(T):_.has(A)?f--:w.get(k)>w.get(A)?(_.add(k),S(T)):(x.add(A),f--):(l(E,o),f--)}for(;f--;){const T=t[f];y.has(T.key)||l(T,o)}for(;d;)S(v[d-1]);return v}function Nl(t,e,n){const r=t.$$.props[e];r!==void 0&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function et(t){t&&t.c()}function Ze(t,e,n,r){const{fragment:i,on_mount:s,on_destroy:o,after_update:a}=t.$$;i&&i.m(e,n),r||vu(()=>{const l=s.map(IK).filter(Vx);o?o.push(...l):Ra(l),t.$$.on_mount=[]}),a.forEach(vu)}function Je(t,e){const n=t.$$;n.fragment!==null&&(Ra(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function H7e(t,e){t.$$.dirty[0]===-1&&(Wx.push(t),GK(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Xt(t,e,n,r,i,s,o=[-1]){const a=_k;Uh(t);const l=t.$$={fragment:null,ctx:null,props:s,update:Ge,not_equal:i,bound:NK(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(a?a.$$.context:e.context||[]),callbacks:NK(),dirty:o,skip_bound:!1};let c=!1;if(l.ctx=n?n(t,e.props||{},(u,h,...f)=>{const d=f.length?f[0]:h;return l.ctx&&i(l.ctx[u],l.ctx[u]=d)&&(!l.skip_bound&&l.bound[u]&&l.bound[u](d),c&&H7e(t,u)),h}):[],l.update(),c=!0,Ra(l.before_update),l.fragment=r?r(l.ctx):!1,e.target){if(e.hydrate){x7e();const u=k7e(e.target);l.fragment&&l.fragment.l(u),u.forEach(ne)}else l.fragment&&l.fragment.c();e.intro&&ve(t.$$.fragment),Ze(t,e.target,e.anchor,e.customElement),_7e(),qd()}Uh(a)}class Kt{$destroy(){Je(this,1),this.$destroy=Ge}$on(e,n){const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!y7e(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function j7e(t){return t<.5?4*t*t*t:.5*Math.pow(2*t-2,3)+1}function jK(t){const e=t-1;return e*e*e+1}function Ek(t,{delay:e=0,duration:n=400,easing:r=j7e,amount:i=5,opacity:s=0}={}){const o=getComputedStyle(t),a=+o.opacity,l=o.filter==="none"?"":o.filter,c=a*(1-s);return{delay:e,duration:n,easing:r,css:(u,h)=>`opacity: ${a-c*h}; filter: ${l} blur(${h*i}px);`}}function qK(t,{delay:e=0,duration:n=400,easing:r=jK}={}){const i=getComputedStyle(t),s=+i.opacity,o=parseFloat(i.height),a=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),c=parseFloat(i.marginTop),u=parseFloat(i.marginBottom),h=parseFloat(i.borderTopWidth),f=parseFloat(i.borderBottomWidth);return{delay:e,duration:n,easing:r,css:d=>`overflow: hidden;opacity: ${Math.min(d*20,1)*s};height: ${d*o}px;padding-top: ${d*a}px;padding-bottom: ${d*l}px;margin-top: ${d*c}px;margin-bottom: ${d*u}px;border-top-width: ${d*h}px;border-bottom-width: ${d*f}px;`}}function q7e(t,e,n={}){const r=getComputedStyle(t),i=r.transform==="none"?"":r.transform,s=e.from.width/t.clientWidth,o=e.from.height/t.clientHeight,a=(e.from.left-e.to.left)/s,l=(e.from.top-e.to.top)/o,c=Math.sqrt(a*a+l*l),{delay:u=0,duration:h=d=>Math.sqrt(d)*120,easing:f=jK}=n;return{delay:u,duration:Vx(h)?h(c):h,easing:f,css:(d,p)=>`transform: ${i} translate(${p*a}px, ${p*l}px);`}}function XK(t,e,n){const r=t.slice();return r[5]=e[n].title,r[6]=e[n].message,r[7]=e[n].type,r[8]=e[n].id,r}function X7e(t){let e;return{c(){e=Zr("path"),H(e,"d",`M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0
                4.34 4.34a8 8 0 0 0 11.32 11.32zM9 5h2v6H9V5zm0 8h2v2H9v-2z`)},m(n,r){ie(n,e,r)},d(n){n&&ne(e)}}}function K7e(t){let e;return{c(){e=Zr("path"),H(e,"d",`M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0
                4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z`)},m(n,r){ie(n,e,r)},d(n){n&&ne(e)}}}function KK(t,e){let n,r,i,s,o,a,l,c=e[5]+"",u,h,f,d=e[6]+"",p,m,v,y,w,x,_,S,T,E,k=Ge,A,M,D;function P(O,K){if(O[7]==="default")return K7e;if(O[7]==="danger")return X7e}let N=P(e),R=N&&N(e);function F(){return e[3](e[8])}return{key:t,first:null,c(){n=oe("div"),r=oe("div"),i=oe("div"),s=Zr("svg"),R&&R.c(),o=Oe(),a=oe("div"),l=oe("p"),u=Ie(c),h=Oe(),f=oe("p"),p=Ie(d),m=Oe(),v=oe("div"),y=Zr("svg"),w=Zr("title"),x=Ie("Close"),_=Zr("path"),S=Oe(),H(s,"class","notification-svg mr-4 svelte-1dn5fx6"),H(s,"xmlns","http://www.w3.org/2000/svg"),H(s,"viewBox","0 0 20 20"),dt(s,"default",e[7]==="default"),dt(s,"danger",e[7]==="danger"),H(i,"class","py-1"),H(l,"class","my-1 font-bold"),H(f,"class","my-1 text-sm"),H(_,"d",`M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1
              1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10
              8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0
              1.698z`),H(y,"class","notification-svg ml-4 cursor-pointer svelte-1dn5fx6"),H(y,"role","button"),H(y,"xmlns","http://www.w3.org/2000/svg"),H(y,"viewBox","0 0 20 20"),dt(y,"default",e[7]==="default"),dt(y,"danger",e[7]==="danger"),H(r,"class","flex items-start"),H(n,"class","notification-card svelte-1dn5fx6"),H(n,"role","alert"),dt(n,"default",e[7]==="default"),dt(n,"danger",e[7]==="danger"),this.first=n},m(O,K){ie(O,n,K),X(n,r),X(r,i),X(i,s),R&&R.m(s,null),X(r,o),X(r,a),X(a,l),X(l,u),X(a,h),X(a,f),X(f,p),X(r,m),X(r,v),X(v,y),X(y,w),X(w,x),X(y,_),X(n,S),A=!0,M||(D=Ln(y,"click",F),M=!0)},p(O,K){e=O,N!==(N=P(e))&&(R&&R.d(1),R=N&&N(e),R&&(R.c(),R.m(s,null))),K&1&&dt(s,"default",e[7]==="default"),K&1&&dt(s,"danger",e[7]==="danger"),(!A||K&1)&&c!==(c=e[5]+"")&&zt(u,c),(!A||K&1)&&d!==(d=e[6]+"")&&zt(p,d),K&1&&dt(y,"default",e[7]==="default"),K&1&&dt(y,"danger",e[7]==="danger"),K&1&&dt(n,"default",e[7]==="default"),K&1&&dt(n,"danger",e[7]==="danger")},r(){E=n.getBoundingClientRect()},f(){P7e(n),k(),zK(n,E)},a(){k(),k=D7e(n,E,q7e,{})},i(O){A||(vu(()=>{T||(T=Hv(n,Ek,{amount:10},!0)),T.run(1)}),A=!0)},o(O){T||(T=Hv(n,Ek,{amount:10},!1)),T.run(0),A=!1},d(O){O&&ne(n),R&&R.d(),O&&T&&T.end(),M=!1,D()}}}function Y7e(t){let e,n=[],r=new Map,i,s=t[0].slice(0,10);const o=a=>a[8];for(let a=0;a<s.length;a+=1){let l=XK(t,s,a),c=o(l);r.set(c,n[a]=KK(c,l))}return{c(){e=oe("div");for(let a=0;a<n.length;a+=1)n[a].c();H(e,"class","marcelle notification-container svelte-1dn5fx6")},m(a,l){ie(a,e,l);for(let c=0;c<n.length;c+=1)n[c].m(e,null);i=!0},p(a,[l]){if(l&3){s=a[0].slice(0,10),Bn();for(let c=0;c<n.length;c+=1)n[c].r();n=G7e(n,l,o,1,a,s,r,e,W7e,KK,null,XK);for(let c=0;c<n.length;c+=1)n[c].a();zn()}},i(a){if(!i){for(let l=0;l<s.length;l+=1)ve(n[l]);i=!0}},o(a){for(let l=0;l<n.length;l+=1)be(n[l]);i=!1},d(a){a&&ne(e);for(let l=0;l<n.length;l+=1)n[l].d()}}}function Z7e(t,e,n){let{notifications:r=[]}=e;function i(l){n(0,r=r.filter(c=>c.id!==l))}let s=1;function o({title:l,message:c,type:u="default",duration:h=3e3}){const f={id:s,title:l,message:c,type:u};s+=1,n(0,r=[...r,f]),h>0&&setTimeout(()=>{i(f.id)},h)}const a=l=>i(l);return t.$$set=l=>{"notifications"in l&&n(0,r=l.notifications)},[r,i,o,a]}class J7e extends Kt{constructor(e){super();Xt(this,e,Z7e,Y7e,Gt,{notifications:0,add:2})}get add(){return this.$$.ctx[2]}}let Hx,kk;function Ak({title:t,message:e,duration:n=3e3,type:r="default"}){Hx||(Hx=document.createElement("div"),Hx.id="notification-container",document.body.appendChild(Hx),kk=new J7e({target:Hx})),kk==null||kk.add({title:t,message:e,duration:n,type:r})}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function sn(t,e,n,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,n,s):o(e,n))||s);return i>3&&s&&Object.defineProperty(e,n,s),s}function Ee(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)}function yn(t,e,n,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n}function mc(){}var jx,qx,Xd,Mk;function Q7e(t){}const YK=AAe();function eXe(t){return t&&typeof t=="object"&&t.run!==void 0}function ZK(t){return t.id!==void 0&&t.run!==void 0}class Ue{constructor(e,n=!1){this.id=Ue.nextId++,this.subscribers=[],this.value=void 0,this.ready=!1,jx.set(this,!1),qx.set(this,void 0),Xd.set(this,!1),Mk.set(this,void 0),yn(this,qx,n,"f");const[r,i]=EG(),[s,o]=EG();this.stopStream=r,this.set=l=>{this.value=l,s(l)};let a;eXe(e)?a=e:(a=th(()=>this.value,e$(e)),this.value=e,yn(this,jx,!0,"f")),this.stream=nNe(_G(this.runListeners.bind(this),TG(i,SG(a,o))))}run(e,n){return this.stream.run(e,n)}runListeners(e){this.value=e,yn(this,jx,!0,"f");for(const n of this.subscribers)n(e)}subscribe(e=Q7e,n=mc){Ee(this,qx,"f")&&Ee(this,Xd,"f")&&Ee(this,jx,"f")&&e(this.value);const r=i=>{n(),e(i)};return this.subscribers.push(r),Ee(this,Xd,"f")||this.start(),()=>{const i=this.subscribers.indexOf(r);i!==-1&&this.subscribers.splice(i,1)}}async start(){return Ee(this,Xd,"f")||(Ue.numActive++,JAe(this.stream,YK).then(()=>{Ue.numActive--}),yn(this,Xd,!0,"f"),yn(this,Mk,new Promise((e,n)=>{PC({run:()=>{this.ready=!0,e()},error(r){n(r)},dispose(){}},YK)}),"f")),Ee(this,Mk,"f")}stop(){this.stopStream(void 0),yn(this,Xd,!1,"f")}hold(){return yn(this,qx,!0,"f"),this}thru(e){return new Ue(e(this))}startWith(e){return new Ue(xG(e,this))}continueWith(e){return new Ue(hNe(e,this))}map(e){return new Ue(th(e,this))}constant(e){return new Ue(lNe(e,this))}tap(e){return new Ue(_G(e,this))}ap(e){return new Ue(cNe(e,this))}scan(e,n){return new Ue(aNe(e,n,this))}loop(e,n){return new Ue(oNe(e,n,this))}withItems(e){return new Ue(yNe(e,this))}zipItems(e,n){return new Ue(vNe(e,n,this))}switchLatest(){return new Ue(SIe(this))}join(){return new Ue(oG(this))}chain(e){return new Ue(uNe(e,this))}concatMap(e){return new Ue(fNe(e,this))}mergeConcurrently(e){return new Ue(dNe(e,this))}mergeMapConcurrently(e,n){return new Ue(pNe(e,n,this))}merge(e){return new Ue(SG(e,this))}combine(e,n){return new Ue(mNe(e,n,this))}zip(e,n){return new Ue(bNe(e,n,this))}resample(e){return new Ue(CG(this,e))}sample(e){return new Ue(CG(e,this))}snapshot(e,n){return new Ue(gNe(e,n,this))}filter(e){return new Ue(wNe(e,this))}skipRepeats(){return new Ue(AIe(this))}skipRepeatsWith(e){return new Ue(xNe(e,this))}slice(e,n){return new Ue(CNe(e,n,this))}take(e){return new Ue(_Ne(e,this))}skip(e){return new Ue(SNe(e,this))}takeWhile(e){return new Ue(TNe(e,this))}skipWhile(e){return new Ue(ENe(e,this))}skipAfter(e){return new Ue(kNe(e,this))}until(e){return new Ue(TG(e,this))}since(e){return new Ue(ANe(e,this))}during(e){return new Ue(MNe(e,this))}delay(e){return new Ue(INe(e,this))}withLocalTime(e){return new Ue(sNe(e,this))}throttle(e){return new Ue(NNe(e,this))}debounce(e){return new Ue($Ne(e,this))}awaitPromises(){return new Ue(vG(this))}recoverWith(e){return new Ue(RNe(e,this))}static empty(){return new Ue(Ni())}static never(){return new Ue(db())}static now(e){return new Ue(e$(e))}static at(e,n){return new Ue(QW(e,n))}static periodic(e){return new Ue(YAe(e))}static throwError(e){return new Ue(JIe(e))}}jx=new WeakMap,qx=new WeakMap,Xd=new WeakMap,Mk=new WeakMap;Ue.nextId=0;Ue.numActive=0;var Oa;(function(t){t[t.Debug=0]="Debug",t[t.Info=1]="Info",t[t.Warning=2]="Warning",t[t.Error=3]="Error"})(Oa||(Oa={}));const Xx=new Ue(db()),as={log(...t){console.log(...t),Xx.set([Oa.Info,t.map(e=>e.toString()).join(" ")])},debug(...t){Xx.set([Oa.Debug,t.map(e=>e.toString()).join(" ")])},info(...t){this.log(...t)},warning(...t){Xx.set([Oa.Warning,t.map(e=>e.toString()).join(" ")])},error(...t){console.error(...t),Xx.set([Oa.Error,t.map(e=>e.toString()).join(" ")])}};function tXe(){return Xx}function En(t,e,n){const r=n.value;return n.value=function(...s){try{return r.apply(this,s)}catch(o){return as.error(o),Ak({title:o.name,message:o.message,type:"danger"}),o}},n}const Kx=t=>function(n,r,i){const s=i.value;return i.value=function(...a){if(!this[t])throw new Error(`Property ${t} was not found or is falsy on the instance when calling ${r}`);return s.apply(this,a)},i};class jv extends Error{constructor(e){super(e);this.name="Training Error"}}function Fa(t,{duration:e=3e3}={}){as.error(`${t.name}: ${t.message}`,t),Ak({title:t.name,message:t.message,type:"danger",duration:e})}function JK(t,e){return async function*(){let n=0;for await(const r of t())e(r,n++)&&(yield await r)}}function bO(t,e){return async function*(){let n=0;for await(const r of t())yield await e(r,n++)}}function nXe(t,e){if(e<0)throw Error("Negative count is not supported, use await and sync iterator instead.");return async function*(){yield*JK(t,(n,r)=>r>=e)()}}function rXe(t,e){if(e<0)throw Error("Negative count is not supported, use await and sync iterator instead.");return async function*(){let n=e;for await(const r of t()){if(n--==0)return;yield await r}}}function wO(t,e){return async function*(){yield*await t(),yield*await e}}async function iXe(t,e){let n=0;for await(const r of t())e(r,n++)}async function sXe(t){const e=[];for await(const n of t())e.push(n);return e}function oXe(t,e){return async function*(){const n=e()[Symbol.asyncIterator]();for await(const r of t()){const i=await n.next();if(i.done)return;yield[r,i.value]}}}async function aXe(t,e,n){let[r,i]=[-1,n];for await(const s of t())i=++r==0&&n===void 0?s:e(i,s,r);if(n===void 0&&r===-1)throw new Error("Sequence contains no elements.");return i}function lXe(t){return typeof t[Symbol.iterator]=="function"}function cXe(t){return typeof t[Symbol.asyncIterator]=="function"}class qo{constructor(e){this.source=e}[Symbol.asyncIterator](){return this.source()[Symbol.asyncIterator]()}entries(){return new qo(bO(this.source,(e,n)=>[n,e]))}keys(){return new qo(bO(this.source,(e,n)=>n))}values(){return new qo(this.source)}forEach(e){return iXe(this.source,e)}concat(e){return lXe(e)?new qo(wO(this.source,async function*(n){yield*n}(e))):cXe(e)?new qo(wO(this.source,e)):new qo(wO(this.source,async function*(n){yield n}(e)))}reduce(e,n){return aXe(this.source,e,n)}filter(e){return new qo(JK(this.source,e))}take(e){return new qo(rXe(this.source,e))}skip(e){return new qo(nXe(this.source,e))}map(e){return new qo(bO(this.source,e))}zip(e){return new qo(oXe(this.source,e))}toArray(){return sXe(this.source)}}window.onerror=t=>{typeof t=="string"&&Ak({title:"An error occurred",message:t,type:"danger"})};window.addEventListener("unhandledrejection",t=>{Ak({title:"An error occurred",message:t.reason,type:"danger"})});let uXe=0;class $s{constructor(){this.id=`component-${String(uXe++).padStart(3,"0")}`,this.$$={streams:[],app:void 0}}destroy(){var e;(e=this.$$.app)===null||e===void 0||e.$destroy(),this.$$.app=void 0}start(){this.$$.streams=Object.entries(this).filter(([e,n])=>e[0]==="$"&&ZK(n)).map(([,e])=>(e.start(),e))}stop(){for(const e of this.$$.streams)e.stop()}dispose(){this.destroy(),this.stop()}}let xO=~~(Math.random()*16777215);const _O=parseInt((Math.random()*16777215).toString(),10);function hXe(){const t=~~(Date.now()/1e3),e=Math.floor(Math.random()*1e5);xO=(xO+1)%16777215;const n=xO,r=new Uint8Array(12);return r[3]=t&255,r[2]=t>>8&255,r[1]=t>>16&255,r[0]=t>>24&255,r[6]=_O&255,r[5]=_O>>8&255,r[4]=_O>>16&255,r[8]=e&255,r[7]=e>>8&255,r[11]=n&255,r[10]=n>>8&255,r[9]=n>>16&255,r.reduce((i,s)=>i+`0${s.toString(16)}`.slice(-2),"")}const Kd=document.createElement("canvas"),qv=Kd.getContext("2d"),Yx=new Image;function QK(t){return new Promise((e,n)=>{t?(Yx.addEventListener("load",()=>{Kd.width=Yx.width,Kd.height=Yx.height,qv==null||qv.drawImage(Yx,0,0,Kd.width,Kd.height),e(qv==null?void 0:qv.getImageData(0,0,Kd.width,Kd.height))},!1),Yx.src=t):n()})}function fXe(t){const{data:e,service:n}=t;return t.data=Bt({[n.id]:hXe()},e),t}function Yd(t){const{result:e,params:n}=t;if(e){if(e._id)e.id=e._id,delete e._id;else if(e.total&&Array.isArray(e.data))for(const[r,i]of e.data.entries())i._id&&(e.data[r].id=e.data[r]._id,delete e.data[r]._id)}else n&&n.query&&(n.query.id&&(t.params.query._id=t.params.query.id,delete t.params.query.id),n.query.$select&&n.query.$select.includes("id")&&!n.query.$select.includes("_id")&&t.params.query.$select.push("_id"));return t}function dXe(t){return t.data||(t.data={}),t.data.createdAt=new Date,t.data.updatedAt=t.data.createdAt,t}function eY(t){return!t.data||!t.data.createdAt||(t.data.updatedAt=new Date),t}function tY(t,e){return n=>{const{data:r}=n;return n.data=Bt({[t]:e},r),n}}function gc(t,e){return n=>(n.params=n.params||{},n.params.query=n.params.query||{},n.params.query[t]=e,n)}const Ik=document.createElement("canvas"),pXe=Ik.getContext("2d");async function nY(t){const{data:e}=t;for(const[n,r]of Object.entries(e))if(r instanceof ImageData){const i=r.width,s=r.height;Ik.width=i,Ik.height=s,pXe.putImageData(r,0,0),t.data[n]=Ik.toDataURL("image/jpeg")}return t}async function Nk(t){if(!t.result)return t;const{result:e}=t,n=r=>r&&typeof r=="string"&&r.slice(0,22)==="data:image/jpeg;base64";if(e._id)for(const[r,i]of Object.entries(e).filter(([s])=>s!=="thumbnail"))n(i)&&(e[r]=await QK(i));else if(e.total&&Array.isArray(e.data))for(const[r,i]of e.data.entries())for(const[s,o]of Object.entries(i).filter(([a])=>a!=="thumbnail"))n(o)&&(e.data[r][s]=await QK(o));return t}async function mXe(t){var e,n;if(!((n=(e=t.params)===null||e===void 0?void 0:e.query)===null||n===void 0?void 0:n.$distinct)||t.type!=="before"||t.method!=="find")return t;const l=t.params.query,{$distinct:r}=l,i=ja(l,["$distinct"]);i.$select=[r],i.$limit=0;const{total:s}=await await t.service.find({query:i});i.$limit=s;const{data:o}=await t.service.find({query:i}),a=Array.from(new Set(o.map(c=>c[r])));return t.result=a,t}function gXe(t){let e,n,r,i,s,o,a,l;const c=t[3].default,u=zh(c,t,t[2],null);return{c(){e=oe("div"),n=oe("div"),r=oe("div"),i=Oe(),s=oe("div"),u&&u.c(),H(r,"class","absolute inset-0 bg-gray-500 opacity-50"),H(n,"class","overlay svelte-7gyrim"),H(s,"class","modal svelte-7gyrim"),H(e,"class","modal-container svelte-7gyrim")},m(h,f){ie(h,e,f),X(e,n),X(n,r),X(e,i),X(e,s),u&&u.m(s,null),o=!0,a||(l=Ln(r,"click",t[0]),a=!0)},p(h,[f]){u&&u.p&&(!o||f&4)&&Vh(u,c,h,h[2],o?f:-1,null,null)},i(h){o||(ve(u,h),o=!0)},o(h){be(u,h),o=!1},d(h){h&&ne(e),u&&u.d(h),a=!1,l()}}}function vXe(t,e,n){let{$$slots:r={},$$scope:i}=e;const s=Pa();function o(){s("quit")}function a(){o()}return t.$$set=l=>{"$$scope"in l&&n(2,i=l.$$scope)},[a,o,i,r]}class rY extends Kt{constructor(e){super();Xt(this,e,vXe,gXe,Gt,{quit:1})}get quit(){return this.$$.ctx[1]}}function yXe(t){let e;return{c(){e=Ie("Register")},m(n,r){ie(n,e,r)},d(n){n&&ne(e)}}}function bXe(t){let e;return{c(){e=Ie("Log In")},m(n,r){ie(n,e,r)},d(n){n&&ne(e)}}}function iY(t){let e,n,r,i,s,o,a,l,c;return{c(){e=oe("div"),n=oe("span"),n.innerHTML='<i class="fas fa-bell"></i>',r=Oe(),i=oe("span"),s=oe("b"),s.textContent="Login Error",o=Oe(),a=Ie(t[1]),l=Oe(),c=oe("button"),c.innerHTML="<span>\xD7</span>",H(n,"class","text-xl inline-block mr-5 align-middle"),H(s,"class","capitalize"),H(i,"class","inline-block align-middle mr-8"),H(c,"class","absolute bg-transparent text-2xl font-semibold leading-none right-0 top-0 mt-4 mr-6 outline-none focus:outline-none"),H(e,"class","text-white px-6 py-4 border-0 rounded relative mb-4 bg-red-500")},m(u,h){ie(u,e,h),X(e,n),X(e,r),X(e,i),X(i,s),X(i,o),X(i,a),X(e,l),X(e,c)},p(u,h){h&2&&zt(a,u[1])},d(u){u&&ne(e)}}}function wXe(t){let e;return{c(){e=Ie("Register")},m(n,r){ie(n,e,r)},d(n){n&&ne(e)}}}function xXe(t){let e;return{c(){e=Ie("Log In")},m(n,r){ie(n,e,r)},d(n){n&&ne(e)}}}function _Xe(t){let e,n,r,i;return{c(){e=Ie(`Already have an account?
        `),n=oe("button"),n.textContent="Log In",H(n,"class","text-blue-500")},m(s,o){ie(s,e,o),ie(s,n,o),r||(i=Ln(n,"click",t[2]),r=!0)},p:Ge,d(s){s&&ne(e),s&&ne(n),r=!1,i()}}}function SXe(t){let e,n,r,i;return{c(){e=Ie(`Don't have an account?
        `),n=oe("button"),n.textContent="Register Here",H(n,"class","text-blue-500")},m(s,o){ie(s,e,o),ie(s,n,o),r||(i=Ln(n,"click",t[2]),r=!0)},p:Ge,d(s){s&&ne(e),s&&ne(n),r=!1,i()}}}function CXe(t){let e,n,r,i,s,o,a,l,c,u,h,f,d,p,m,v,y,w;function x(N,R){return N[0]==="login"?bXe:yXe}let _=x(t),S=_(t),T=t[1]&&iY(t);function E(N,R){return N[0]==="login"?xXe:wXe}let k=E(t),A=k(t);function M(N,R){return N[0]==="login"?SXe:_Xe}let D=M(t),P=D(t);return{c(){e=oe("div"),n=oe("div"),r=oe("h2"),S.c(),i=Oe(),s=oe("p"),s.textContent="This Marcelle application requires authentication.",o=Oe(),T&&T.c(),a=Oe(),l=oe("form"),c=oe("div"),c.innerHTML=`<label class="block uppercase text-gray-700 text-xs font-bold mb-2" for="grid-password">Email</label> 
        <input type="email" name="email" class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4
        text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-purple-500" placeholder="Email" style="transition: all 0.15s ease 0s;"/>`,u=Oe(),h=oe("div"),h.innerHTML=`<label class="block uppercase text-gray-700 text-xs font-bold mb-2" for="grid-password">Password</label> 
        <input type="password" name="password" class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4
        text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-purple-500" placeholder="Password" style="transition: all 0.15s ease 0s;"/>`,f=Oe(),d=oe("div"),p=oe("button"),A.c(),m=Oe(),v=oe("p"),P.c(),H(r,"class","text-xl"),H(s,"class","text-gray-600"),H(n,"class","p-4 text-center"),H(c,"class","relative w-full mb-3"),H(h,"class","relative w-full mb-3"),H(p,"class","bg-gray-900 text-white active:bg-gray-700 text-sm font-bold uppercase px-6 py-3 rounded shadow hover:shadow-lg outline-none focus:outline-none mr-1 mb-1 w-full"),H(p,"type","submit"),Jr(p,"transition","all 0.15s ease 0s"),H(d,"class","text-center mt-6"),H(v,"class","my-4"),H(e,"class","p-12")},m(N,R){ie(N,e,R),X(e,n),X(n,r),S.m(r,null),X(n,i),X(n,s),X(e,o),T&&T.m(e,null),X(e,a),X(e,l),X(l,c),X(l,u),X(l,h),X(l,f),X(l,d),X(d,p),A.m(p,null),X(e,m),X(e,v),P.m(v,null),y||(w=Ln(l,"submit",T7e(t[7])),y=!0)},p(N,R){_!==(_=x(N))&&(S.d(1),S=_(N),S&&(S.c(),S.m(r,null))),N[1]?T?T.p(N,R):(T=iY(N),T.c(),T.m(e,a)):T&&(T.d(1),T=null),k!==(k=E(N))&&(A.d(1),A=k(N),A&&(A.c(),A.m(p,null))),D===(D=M(N))&&P?P.p(N,R):(P.d(1),P=D(N),P&&(P.c(),P.m(v,null)))},d(N){N&&ne(e),S.d(),T&&T.d(),A.d(),P.d(),y=!1,w()}}}function TXe(t){let e,n;return e=new rY({props:{$$slots:{default:[CXe]},$$scope:{ctx:t}}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,[i]){const s={};i&515&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function EXe(t,e,n){const r=Pa();let{dataStore:i}=e,{mode:s="login"}=e,o;function a(){n(0,s=s==="login"?"register":"login")}function l(f){r("terminate",f)}async function c(f){const d=new FormData(f.target);try{await i.login(d.get("email"),d.get("password")),l(!0)}catch(p){n(1,o=p)}}async function u(f){const d=new FormData(f.target);try{await i.signup(d.get("email"),d.get("password")),l(!0)}catch{l(!1)}}const h=f=>s==="login"?c(f):u(f);return t.$$set=f=>{"dataStore"in f&&n(5,i=f.dataStore),"mode"in f&&n(0,s=f.mode)},[s,o,a,c,u,i,l,h]}class kXe extends Kt{constructor(e){super();Xt(this,e,EXe,TXe,Gt,{dataStore:5,mode:0,terminate:6})}get terminate(){return this.$$.ctx[6]}}var $k,Zx,Jx,Qx;function AXe(t){try{new URL(t)}catch{return!1}return!0}var La;(function(t){t[t.Memory=0]="Memory",t[t.LocalStorage=1]="LocalStorage",t[t.Remote=2]="Remote"})(La||(La={}));class sY{constructor(e="memory"){if(this.requiresAuth=!1,this.$services=new Ue([],!0),$k.set(this,void 0),Zx.set(this,void 0),Jx.set(this,void 0),Qx.set(this,mc),this.feathers=pDe(),this.location=e,AXe(e)){this.backend=La.Remote;const n=_Re(e,{transports:["websocket"],reconnectionAttempts:3});this.feathers.configure(_De(n,{timeout:5e3})),yn(this,$k,new Promise(r=>{this.feathers.io.on("init",({auth:i})=>{this.requiresAuth=i,i&&this.feathers.configure(HRe()),r()})}),"f")}else if(e==="localStorage"){this.backend=La.LocalStorage;const n=r=>GDe({storage:window.localStorage,name:r,id:"_id",multi:!0,paginate:{default:100,max:200}});yn(this,Qx,r=>{this.feathers.use(`/${r}`,n(r))},"f")}else if(e==="memory")this.backend=La.Memory,yn(this,Qx,n=>{this.feathers.use(`/${n}`,UDe({id:"_id",paginate:{default:100,max:200}}))},"f");else throw new Error(`Cannot process backend location '${e}'`);this.setupAppHooks()}async connect(){return this.backend!==La.Remote?{email:null}:(Ee(this,Zx,"f")||(as.log(`Connecting to backend ${this.location}...`),yn(this,Zx,new Promise((e,n)=>{this.feathers.io.on("connect",()=>{as.log(`Connected to backend ${this.location}!`),e()}),this.feathers.io.on("reconnect_failed",()=>{const r=new Error(`Cannot reach backend at location ${this.location}. Is the server running?
          If using locally, run 'npm run backend'`);r.name="DataStore connection error",n(),Fa(r,{duration:0})})}),"f")),await Ee(this,$k,"f"),await Ee(this,Zx,"f"),this.requiresAuth&&await this.authenticate(),this.requiresAuth?this.user:{email:null})}async authenticate(){return this.requiresAuth?(Ee(this,Jx,"f")||yn(this,Jx,new Promise((e,n)=>{this.feathers.reAuthenticate().then(({user:r})=>{this.user=r,as.log(`Authenticated as ${r.email}`),e()}).catch(()=>{const r=new kXe({target:document.body,props:{dataStore:this}});r.$on("terminate",i=>{r.$destroy(),i?e():n()})})}),"f"),await Ee(this,Jx,"f"),this.user):{email:null}}async login(e,n){const r=await this.feathers.authenticate({strategy:"local",email:e,password:n});return this.user=r.user,this.user}async signup(e,n){try{return await this.feathers.service("users").create({email:e,password:n}),await this.login(e,n),this.user}catch(r){return as.error("An error occurred during signup",r),{email:null}}}async logout(){await this.feathers.logout(),document.location.reload()}service(e){return Object.keys(this.feathers.services).includes(e)||(Ee(this,Qx,"f").call(this,e),this.$services.set(Object.keys(this.feathers.services))),this.feathers.service(e)}setupAppHooks(){const e=this.backend!==La.Remote?[fXe]:[],n=this.backend!==La.Remote?[mXe]:[];this.feathers.hooks({before:{find:[...n,Yd],create:[...e,dXe],update:[eY],patch:[eY]},after:{find:[Yd],get:[Yd],create:[Yd],update:[Yd],patch:[Yd],remove:[Yd]}})}}$k=new WeakMap,Zx=new WeakMap,Jx=new WeakMap,Qx=new WeakMap;function MXe(t){return new sY(t)}class Xv extends qo{constructor(e,n={}){super(async function*(){const r=Bt({query:{},skip:0,take:-1},n),i=r.take;let s=0,o=[];const a=ni(Bt({},r.query),{$skip:r.skip,$limit:10});for(;;)try{if(i>0&&s>=i)return;if(s++,o.length>0)yield o.shift();else{const l=await e.find({query:a});if(a.$skip=l.skip+l.limit,o=l.data,o.length>0)yield o.shift();else return}}catch(l){throw l.message=`Error thrown while iterating through a service: ${l.message}`,l}});this.service=e,this.params=Bt({query:{},skip:0,take:-1},n)}skip(e){return new Xv(this.service,ni(Bt({},this.params),{skip:e}))}take(e){return new Xv(this.service,ni(Bt({},this.params),{take:e}))}select(e){const n=oR.exports.cloneDeep(this.params);return n.query.$select=e,new Xv(this.service,n)}query(e){return new Xv(this.service,ni(Bt({},this.params),{query:e}))}}function IXe(t){return new Xv(t)}async function Kv(t,e,n){const r=document.createElement("a");r.style.display="none",document.body.appendChild(r);const i=new Blob([t],{type:n});r.href=URL.createObjectURL(i),r.download=e,r.click()}async function SO(t){return new Promise((e,n)=>{const r=new FileReader;r.onload=()=>{const i=JSON.parse(r.result);e(i)},r.onerror=i=>{n(i)},r.readAsText(t)})}function e1(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[\s_]+/g,"-").toLowerCase()}var t1;class NXe extends $s{constructor(e,n=MXe()){super();this.title="dataset",this.isDataset=!0,t1.set(this,void 0),this.$count=new Ue(0,!0),this.$changes=new Ue([]),this.name=e,this.title=`dataset (${e})`,yn(this,t1,n,"f"),this.start(),this.ready=new Promise((r,i)=>{Ee(this,t1,"f").connect().then(()=>this.setup()).then(r).catch(()=>{as.log(`[dataset:${e}] dataStore connection failed`),i()})})}async setup(){const e=e1(`instances-${this.name}`);this.instanceService=Ee(this,t1,"f").service(e),this.instanceService.hooks({before:{create:[tY("datasetName",this.name),nY],find:[gc("datasetName",this.name)],get:[gc("datasetName",this.name)],update:[gc("datasetName",this.name)],patch:[gc("datasetName",this.name)],remove:[gc("datasetName",this.name)]},after:{find:[Nk],get:[Nk]}});const{total:n}=await this.instanceService.find({$limit:0});this.$count.set(n),this.$changes.set([{level:"dataset",type:"created"}]),this.watchChanges()}watchChanges(){this.instanceService.on("created",n=>{this.$count.set(this.$count.value+1),this.$changes.set([{level:"instance",type:"created",data:n}])});const e=n=>{const r=ni(Bt({},n),{id:n.id||n._id});this.$changes.set([{level:"instance",type:"updated",data:r}])};this.instanceService.on("updated",e),this.instanceService.on("patched",e),this.instanceService.on("removed",n=>{this.$count.set(this.$count.value-1);const r=ni(Bt({},n),{id:n.id||n._id});this.$changes.set([{level:"instance",type:"removed",data:r}])})}items(){return IXe(this.instanceService)}async find(e){return this.instanceService.find(e)}async get(e,n){return this.instanceService.get(e,n)}async create(e,n){return this.instanceService.create(e,n)}async update(e,n,r){return this.instanceService.update(e,n,r)}async patch(e,n,r){return this.instanceService.patch(e,n,r)}async remove(e,n){return this.instanceService.remove(e,n)}async clear(){await this.remove(null,{query:{}})}async distinct(e){return this.instanceService.find({query:{$distinct:e}})}async download(){const e=await this.instanceService.find(),n={marcelleMeta:{type:"dataset"},instances:e.data},r=new Date(Date.now()),i=`${this.title}-${r.toISOString()}.json`;await Kv(JSON.stringify(n),i,"text/plain")}async upload(e){const n=e.filter(s=>s.type==="application/json").map(s=>SO(s)),i=(await Promise.all(n)).map(s=>s.instances.map(o=>{const c=o,{id:a}=c,l=ja(c,["id"]);return this.create(l).catch(u=>{Fa(u)})}));await Promise.all(i)}mount(){}}t1=new WeakMap;function att(t,e){return new NXe(t,e)}function Zd(t){return typeof t=="object"&&t!==null&&t.isDataset}class bu extends $s{constructor({dataStore:e}={}){super();this.ready=!1,this.$training=new Ue({status:"idle"},!0),this.dataStore=e,this.$training.start(),this.$training.subscribe(({status:n})=>{(n==="success"||n==="loaded")&&(this.ready=!0)})}get service(){var e;return(e=this.dataStore)===null||e===void 0?void 0:e.service(this.serviceName)}sync(e){return this.syncModelName=e,this.dataStore.connect().then(()=>{this.setupSync()}),this}async setupSync(){if(!this.service)return;const{data:e}=await this.service.find({query:{name:this.syncModelName,$select:["id"],$limit:1,$sort:{updatedAt:-1}}});let n=null;e.length===1&&(n=e[0].id,this.load(n));let r=!1;this.$training.subscribe(({status:s,data:o})=>{(s==="success"||s==="loaded"&&(o==null?void 0:o.source)!=="datastore")&&(r=!0,this.save(this.syncModelName,{},n).then(a=>{n=a}))});const i=s=>{(s._id===n||!n&&s.name===this.syncModelName)&&(n=s._id,r||this.load(n),r=!1)};this.service.on("created",i),this.service.on("updated",i),this.service.on("patched",i)}async saveToDatastore(e,n=null){if(!this.service||!e)return null;let r=n;n?await this.service.update(n,e):r=(await this.service.create(e)).id;const i=this.syncModelName||e1(this.title);return as.info(`Model ${i} was saved to data store at location ${this.dataStore.location}`),r}async loadFromDatastore(e){if(!this.service||!e)return null;let n;try{n=await this.service.get(e)}catch{const{data:i}=await this.service.find({query:{name:e,$limit:1,$sort:{updatedAt:-1}}});i.length===1&&(n=i[0])}if(n){const r=n.name;as.info(`Model ${r} was loaded from data store at location ${this.dataStore.location}`)}return n}mount(){}}sn([Kx("dataStore")],bu.prototype,"sync",null);sn([Kx("dataStore")],bu.prototype,"saveToDatastore",null);sn([Kx("dataStore")],bu.prototype,"loadFromDatastore",null);function oY(t){if(!t.modelTopology.model_config||!t.modelTopology.model_config.config||!t.modelTopology.model_config.config.layers||t.modelTopology.model_config.config.layers.length>0&&!t.modelTopology.model_config.config.layers[0].class_name)return t;try{let e=!1;for(const[n,r]of t.modelTopology.model_config.config.layers.entries())if(r.class_name==="SeparableConv2D"){const i=["kernel_constraint","kernel_initializer","kernel_regularizer"];for(const s of i)Object.keys(t.modelTopology.model_config.config.layers[n].config).includes(s)&&(e=!0),delete t.modelTopology.model_config.config.layers[n].config[s]}e&&as.warning("TFJS Model loading: experimentally removing Kernel attributes from SeparableConv2D layers")}catch(e){as.warning("TFJS Model loading: An error occurred whil experimentally removing Kernel attributes from SeparableConv2D layers",e)}return t}function CO(...t){const e=bS(...t),n=e.load.bind(e);return e.load=async function(){const i=await n();return oY(i)},e}function aY(...t){const e=oz(...t),n=e.load.bind(e);return e.load=async function(){const i=await n();return oY(i)},e}class Yv extends bu{constructor(){super(...arguments);this.serviceName="tfjs-models"}async warmup(){const e=this.model.inputs[0].shape.map(r=>r&&r>0?r:1),n=this.model.predict(de(()=>zr(e)));await n.data(),n.dispose()}async save(e,n,r=null){if(!this.model)return null;let i;if(this.dataStore.backend===La.LocalStorage)await this.model.save(`indexeddb://${e}`),i=[["main",`indexeddb://${e}`]];else if(this.dataStore.backend===La.Remote){const o={};if(this.dataStore.requiresAuth){const a=await this.dataStore.feathers.authentication.getAccessToken(),l=new Headers({Authorization:`Bearer ${a}`});o.requestInit={headers:l}}i=await this.model.save(CO(`${this.dataStore.location}/tfjs-models/upload`,o)).then(a=>a.responses[0].json())}const s={name:e,files:i,format:"tfjs",metadata:Bt(Bt({tfjsModelFormat:this.model instanceof fh?"layers-model":"graph-model"},this.labels&&{labels:this.labels}),n)};return this.saveToDatastore(s,r)}async load(e){if(!e)return null;this.$training.set({status:"loading"});try{const n=await this.loadFromDatastore(e);this.loadFn=n.metadata.tfjsModelFormat==="graph-model"?Ff:Gb;let r;if(this.dataStore.backend===La.LocalStorage)r=await this.loadFn(n.files[0][1]);else if(this.dataStore.backend===La.Remote){const i={};if(this.dataStore.requiresAuth){const s=await this.dataStore.feathers.authentication.getAccessToken(),o=new Headers({Authorization:`Bearer ${s}`});i.requestInit={headers:o}}r=await this.loadFn(CO(`${this.dataStore.location}/tfjs-models/${n.id}/model.json`,i))}return r&&(this.model=r,await this.warmup()),n.metadata&&n.metadata.labels?this.labels=n.metadata.labels:this.labels=void 0,this.$training.set({status:"loaded",data:{source:"datastore",url:this.dataStore.location}}),n}catch(n){throw console.log("[tfjs-model] Loading error",n),this.$training.set({status:"error"}),n}}async download(e){const n=this.syncModelName||e1(this.title),r=Bt(Bt({type:"tfjs-model",tfjsModelFormat:this.model instanceof fh?"layers-model":"graph-model",name:n},this.labels&&{labels:this.labels}),e),i=new Date(Date.now());await this.model.save(hz(async s=>{const o={modelTopology:s.modelTopology,weightsManifest:[{paths:[`./${n}.weights.bin`],weights:s.weightSpecs}],marcelle:r};return await Kv(s.weightData,`${n}.weights.bin`,"application/octet-stream"),await Kv(JSON.stringify(o),`${n}.json`,"text/plain"),{modelArtifactsInfo:{dateSaved:i,modelTopologyType:"JSON"}}}))}async upload(...e){this.$training.set({status:"loading"});try{const n=e.filter(o=>o.name.includes(".json")),r=e.filter(o=>o.name.includes(".bin")),{marcelle:i}=await new Promise((o,a)=>{const l=new FileReader;l.onload=()=>{const c=JSON.parse(l.result);o(c)},l.onerror=c=>a(new Error(`The provided files are not a valid marcelle model ${c}`)),l.readAsText(n[0])});if(this.loadFn=i.tfjsModelFormat==="graph-model"?Ff:Gb,n.length===1&&e.length){const o=await this.loadFn(aY([n[0],...r]));return o&&(this.model=o,await this.warmup()),i&&i.labels?this.labels=i.labels:this.labels=null,this.$training.set({status:"loaded",data:{source:"file"}}),{name:i.name,format:"tfjs",files:[],metadata:i}}const s=new Error("The provided files are not compatible with this model");throw s.name="File upload error",s}catch(n){throw this.$training.set({status:"error"}),n}}}sn([En],Yv.prototype,"warmup",null);sn([Kx("dataStore")],Yv.prototype,"save",null);sn([Kx("dataStore")],Yv.prototype,"load",null);sn([En],Yv.prototype,"upload",null);function $Xe(t){let e;return{c(){e=oe("span"),e.innerHTML='<span class="spinner svelte-1ldi0mo"><span class="dot1 svelte-1ldi0mo"></span>  <span class="dot2 svelte-1ldi0mo"></span></span>',H(e,"class","spinner-container svelte-1ldi0mo")},m(n,r){ie(n,e,r)},p:Ge,i:Ge,o:Ge,d(n){n&&ne(e)}}}class TO extends Kt{constructor(e){super();Xt(this,e,null,$Xe,Gt,{})}}function lY(t){let e,n;return e=new TO({}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function RXe(t){let e,n,r,i,s,o,a=t[1]&&lY();const l=t[3].default,c=zh(l,t,t[2],null);return{c(){e=oe("div"),n=oe("span"),r=Ie(t[0]),i=Oe(),a&&a.c(),s=Oe(),c&&c.c(),H(n,"class","card-title"),H(e,"class","card-container svelte-xnhseh")},m(u,h){ie(u,e,h),X(e,n),X(n,r),X(e,i),a&&a.m(e,null),X(e,s),c&&c.m(e,null),o=!0},p(u,[h]){(!o||h&1)&&zt(r,u[0]),u[1]?a?h&2&&ve(a,1):(a=lY(),a.c(),ve(a,1),a.m(e,s)):a&&(Bn(),be(a,1,1,()=>{a=null}),zn()),c&&c.p&&(!o||h&4)&&Vh(c,l,u,u[2],o?h:-1,null,null)},i(u){o||(ve(a),ve(c,u),o=!0)},o(u){be(a),be(c,u),o=!1},d(u){u&&ne(e),a&&a.d(),c&&c.d(u)}}}function DXe(t,e,n){let{$$slots:r={},$$scope:i}=e,{title:s}=e,{loading:o=!1}=e;return t.$$set=a=>{"title"in a&&n(0,s=a.title),"loading"in a&&n(1,o=a.loading),"$$scope"in a&&n(2,i=a.$$scope)},[s,o,i,r]}class Rs extends Kt{constructor(e){super();Xt(this,e,DXe,RXe,Gt,{title:0,loading:1})}}var n1;class PXe extends $s{constructor({name:e,dataStore:n}){super();this.title="batch prediction",n1.set(this,void 0),this.$predictions=new Ue([],!0),this.title=e,yn(this,n1,n||new sY,"f"),this.$count=new Ue(th(r=>r.length,this.$predictions),!0),this.start(),Ee(this,n1,"f").connect().then(()=>{this.setup()}).catch(()=>{as.log("[BatchPrediction] data store connection failed")})}async setup(){const e=`predictions-${this.title}`;this.predictionService=Ee(this,n1,"f").service(e),this.predictionService.hooks({before:{create:[tY("predictionName",this.title),nY].filter(i=>!!i),find:[gc("predictionName",this.title)],get:[gc("predictionName",this.title)],update:[gc("predictionName",this.title)],patch:[gc("predictionName",this.title)],remove:[gc("predictionName",this.title)]},after:{find:[Nk].filter(i=>!!i),get:[Nk].filter(i=>!!i)}});const n=await this.predictionService.find({query:{$select:["id","label"]}}),{data:r}=n;this.$predictions.set(r.map(i=>i.id))}async predict(e,n){const r=Zd(n)?n.items():n,i=[];for await(const{id:s,x:o,y:a}of r){const l=await e.predict(o),{id:c}=await this.predictionService.create(ni(Bt({},l),{instanceId:s,trueLabel:a}),{query:{$select:["id"]}});i.push(c),this.$predictions.set(i)}}async clear(){const e=await this.predictionService.find({query:{$select:["id"]}}),{data:n}=e;await Promise.all(n.map(({id:r})=>this.predictionService.remove(r))),this.$predictions.set([])}mount(){}async download(){const e=await this.predictionService.find(),n={marcelleMeta:{type:"predictions"},predictions:e.data},r=new Date(Date.now()),i=`${this.title}-${r.toISOString()}.json`;await Kv(JSON.stringify(n),i,"text/plain")}async upload(e){const n=await Promise.all(e.filter(i=>i.type==="application/json").map(i=>SO(i))),r=await Promise.all(n.map(i=>Promise.all(i.predictions.map(s=>{const l=s,{id:o}=l,a=ja(l,["id"]);return this.predictionService.create(a,{query:{$select:["id"]}}).catch(c=>{Fa(c)})}))));this.$predictions.set(r.flat().map(i=>i.id))}}n1=new WeakMap;function ltt(t){return new PXe(t)}function OXe(t){let e,n,r,i,s;const o=t[9].default,a=zh(o,t,t[8],null);return{c(){e=Oe(),n=oe("button"),a&&a.c(),H(n,"class","marcelle svelte-dwhdpb"),n.disabled=t[2],dt(n,"outline",t[1]==="outline"),dt(n,"filled",t[1]==="filled"),dt(n,"light",t[1]==="light"),dt(n,"success",t[3]==="success"),dt(n,"warning",t[3]==="warning"),dt(n,"danger",t[3]==="danger"),dt(n,"size-small",t[4]==="small"),dt(n,"size-large",t[4]==="large"),dt(n,"round",t[5])},m(l,c){ie(l,e,c),ie(l,n,c),a&&a.m(n,null),r=!0,i||(s=[Ln(document.body,"mouseup",function(){Vx(t[0]&&t[7])&&(t[0]&&t[7]).apply(this,arguments)}),Ln(n,"click",t[10]),Ln(n,"mousedown",t[6])],i=!0)},p(l,[c]){t=l,a&&a.p&&(!r||c&256)&&Vh(a,o,t,t[8],r?c:-1,null,null),(!r||c&4)&&(n.disabled=t[2]),c&2&&dt(n,"outline",t[1]==="outline"),c&2&&dt(n,"filled",t[1]==="filled"),c&2&&dt(n,"light",t[1]==="light"),c&8&&dt(n,"success",t[3]==="success"),c&8&&dt(n,"warning",t[3]==="warning"),c&8&&dt(n,"danger",t[3]==="danger"),c&16&&dt(n,"size-small",t[4]==="small"),c&16&&dt(n,"size-large",t[4]==="large"),c&32&&dt(n,"round",t[5])},i(l){r||(ve(a,l),r=!0)},o(l){be(a,l),r=!1},d(l){l&&ne(e),l&&ne(n),a&&a.d(l),i=!1,Ra(s)}}}function FXe(t,e,n){let{$$slots:r={},$$scope:i}=e,{variant:s="outline"}=e,{disabled:o=!1}=e,{type:a="default"}=e,{size:l="medium"}=e,{round:c=!1}=e,{pressed:u=!1}=e;const h=Pa();function f(){n(0,u=!0),h("pressed",u)}function d(){n(0,u=!1),h("pressed",u)}function p(m){Sk.call(this,t,m)}return t.$$set=m=>{"variant"in m&&n(1,s=m.variant),"disabled"in m&&n(2,o=m.disabled),"type"in m&&n(3,a=m.type),"size"in m&&n(4,l=m.size),"round"in m&&n(5,c=m.round),"pressed"in m&&n(0,u=m.pressed),"$$scope"in m&&n(8,i=m.$$scope)},[u,s,o,a,l,c,f,d,i,r,p]}class ui extends Kt{constructor(e){super();Xt(this,e,FXe,OXe,Gt,{variant:1,disabled:2,type:3,size:4,round:5,pressed:0})}}function LXe(t){let e;return{c(){e=Ie(t[10])},m(n,r){ie(n,e,r)},p(n,r){r&1024&&zt(e,n[10])},d(n){n&&ne(e)}}}function BXe(t){let e,n,r,i;function s(a){t[11](a)}let o={disabled:t[7],type:t[8],$$slots:{default:[LXe]},$$scope:{ctx:t}};return t[9]!==void 0&&(o.pressed=t[9]),n=new ui({props:o}),Ur.push(()=>Nl(n,"pressed",s)),n.$on("click",t[12]),{c(){e=oe("div"),et(n.$$.fragment)},m(a,l){ie(a,e,l),Ze(n,e,null),i=!0},p(a,l){const c={};l&128&&(c.disabled=a[7]),l&256&&(c.type=a[8]),l&9216&&(c.$$scope={dirty:l,ctx:a}),!r&&l&512&&(r=!0,c.pressed=a[9],Il(()=>r=!1)),n.$set(c)},i(a){i||(ve(n.$$.fragment,a),i=!0)},o(a){be(n.$$.fragment,a),i=!1},d(a){a&&ne(e),Je(n)}}}function zXe(t){let e,n;return e=new Rs({props:{title:t[0],loading:t[6],$$slots:{default:[BXe]},$$scope:{ctx:t}}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,[i]){const s={};i&1&&(s.title=r[0]),i&64&&(s.loading=r[6]),i&10112&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function VXe(t,e,n){let r,i=Ge,s=()=>(i(),i=_r(S,M=>n(6,r=M)),S),o,a=Ge,l=()=>(a(),a=_r(T,M=>n(7,o=M)),T),c,u=Ge,h=()=>(u(),u=_r(E,M=>n(8,c=M)),E),f,d=Ge,p=()=>(d(),d=_r(_,M=>n(9,f=M)),_),m,v=Ge,y=()=>(v(),v=_r(x,M=>n(10,m=M)),x);t.$$.on_destroy.push(()=>i()),t.$$.on_destroy.push(()=>a()),t.$$.on_destroy.push(()=>u()),t.$$.on_destroy.push(()=>d()),t.$$.on_destroy.push(()=>v());let{title:w}=e,{text:x}=e;y();let{pressed:_}=e;p();let{loading:S}=e;s();let{disabled:T}=e;l();let{type:E}=e;h();function k(M){f=M,_.set(f)}function A(M){Sk.call(this,t,M)}return t.$$set=M=>{"title"in M&&n(0,w=M.title),"text"in M&&y(n(1,x=M.text)),"pressed"in M&&p(n(2,_=M.pressed)),"loading"in M&&s(n(3,S=M.loading)),"disabled"in M&&l(n(4,T=M.disabled)),"type"in M&&h(n(5,E=M.type))},[w,x,_,S,T,E,r,o,c,f,m,k,A]}class UXe extends Kt{constructor(e){super();Xt(this,e,VXe,zXe,Gt,{title:0,text:1,pressed:2,loading:3,disabled:4,type:5})}}class WXe extends $s{constructor(e="click me"){super();this.title="button",this.$click=new Ue(db()),this.$pressed=new Ue(!1,!0),this.$loading=new Ue(!1,!0),this.$disabled=new Ue(!1,!0),this.$type=new Ue("default",!0),this.$text=new Ue(e,!0),this.start(),this.$loading.skip(1).subscribe(n=>{this.$disabled.set(n)})}mount(e){const n=e||document.querySelector(`#${this.id}`);!n||(this.destroy(),this.$$.app=new UXe({target:n,props:{title:this.title,text:this.$text,pressed:this.$pressed,loading:this.$loading,disabled:this.$disabled,type:this.$type}}),this.$$.app.$on("click",this.$click.set))}}function ctt(t){return new WXe(t)}function GXe(t){let e,n;return{c(){e=Ie("COCO-SSD loaded with base "),n=Ie(t[2])},m(r,i){ie(r,e,i),ie(r,n,i)},p(r,i){i&4&&zt(n,r[2])},d(r){r&&ne(e),r&&ne(n)}}}function HXe(t){let e;return{c(){e=Ie("\xA0")},m(n,r){ie(n,e,r)},p:Ge,d(n){n&&ne(e)}}}function jXe(t){let e;function n(s,o){return s[3]?HXe:GXe}let r=n(t),i=r(t);return{c(){e=oe("p"),i.c(),H(e,"class","p-2 text-sm text-gray-600")},m(s,o){ie(s,e,o),i.m(e,null)},p(s,o){r===(r=n(s))&&i?i.p(s,o):(i.d(1),i=r(s),i&&(i.c(),i.m(e,null)))},d(s){s&&ne(e),i.d()}}}function qXe(t){let e,n;return e=new Rs({props:{title:t[0],loading:t[3],$$slots:{default:[jXe]},$$scope:{ctx:t}}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,[i]){const s={};i&1&&(s.title=r[0]),i&8&&(s.loading=r[3]),i&28&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function XXe(t,e,n){let r,i=Ge,s=()=>(i(),i=_r(a,c=>n(3,r=c)),a);t.$$.on_destroy.push(()=>i());let{title:o}=e,{loading:a}=e;s();let{base:l}=e;return t.$$set=c=>{"title"in c&&n(0,o=c.title),"loading"in c&&s(n(1,a=c.loading)),"base"in c&&n(2,l=c.base)},[o,a,l,r]}class KXe extends Kt{constructor(e){super();Xt(this,e,XXe,qXe,Gt,{title:0,loading:1,base:2})}}var Jd,Gh;class Zv extends bu{constructor({base:e="lite_mobilenet_v2"}={}){super();this.title="COCO-SSD Object Detection",this.parameters={},this.serviceName="undefined",Jd.set(this,void 0),Gh.set(this,void 0),this.$loading=new Ue(!0,!0),yn(this,Gh,e,"f"),this.setup()}async setup(){const e=await ZM(),n=Object.keys(e).filter(r=>r.includes("cocossd"));try{yn(this,Jd,await U2.exports.load({base:Ee(this,Gh,"f"),modelUrl:`indexeddb://cocossd-${Ee(this,Gh,"f")}`}),"f")}catch{n.length>0&&await JM(n[0]),yn(this,Jd,await U2.exports.load({base:Ee(this,Gh,"f")}),"f"),await Ee(this,Jd,"f").model.save(`indexeddb://cocossd-${Ee(this,Gh,"f")}`)}as.info("COCO-SSD loaded with base `lite_mobilenet_v2`"),this.$loading.set(!1),this.start()}train(){throw new jv("Model `CocoSsd` cannot be trained")}async predict(e){if(!Ee(this,Jd,"f"))throw new Error("Model is not loaded");return{outputs:(await Ee(this,Jd,"f").detect(e)).map(i=>({bbox:i.bbox,class:i.class,confidence:i.score}))}}mount(e){const n=e||document.querySelector(`#${this.id}`);!n||(this.destroy(),this.$$.app=new KXe({target:n,props:{title:this.title,loading:this.$loading,base:Ee(this,Gh,"f")}}))}save(){throw new Error("CocoSsd does not support saving")}load(){throw new Error("CocoSsd does not support loading")}download(){throw new Error("CocoSsd does not support downloading")}upload(){throw new Error("CocoSsd does not support uploading")}}Jd=new WeakMap,Gh=new WeakMap;sn([En],Zv.prototype,"train",null);sn([En],Zv.prototype,"predict",null);sn([En],Zv.prototype,"save",null);sn([En],Zv.prototype,"load",null);sn([En],Zv.prototype,"download",null);sn([En],Zv.prototype,"upload",null);function EO(t){return t&&typeof t=="object"&&!Array.isArray(t)}function Jv(t,...e){if(!e.length)return t;const n=e.shift(),r=Bt({},t);if(EO(t)&&EO(n))for(const i in n)EO(n[i])?(r[i]||Object.assign(r,{[i]:{}}),r[i]=Jv(r[i],n[i])):Object.assign(r,{[i]:n[i]});return Jv(r,...e)}function YXe(t){let e,n;return{c(){e=oe("div"),n=oe("canvas"),H(e,"class","w-full h-96")},m(r,i){ie(r,e,i),X(e,n),t[6](n)},p:Ge,d(r){r&&ne(e),t[6](null)}}}function ZXe(t){let e,n;return e=new Rs({props:{title:t[0],$$slots:{default:[YXe]},$$scope:{ctx:t}}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,[i]){const s={};i&1&&(s.title=r[0]),i&32770&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function JXe(t,e,n){let{title:r}=e,{preset:i}=e,{options:s}=e,{datasets:o}=e;Eg.register(bT,oT,aT,vw,Tg,oUe,cUe,wh,lw,WD,GD,AD,wT,lT,cT,yw,xT,uT,bw,jD,I9,O9);const a=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 206, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(255, 159, 64)"],l={data:{},options:{maintainAspectRatio:!1,animation:{duration:200},borderWidth:4}};function c(w){return{borderColor:a[w%6],backgroundColor:a[w%6],fill:!1,lineTension:.2}}function u(w,x,_){const S={labels:[]};let T=0;return S.datasets=w.map(({dataStream:E,label:k,options:A},M)=>{T=Math.max(T,E.value?E.value.length:0),M===0&&(S.labels=A.labels||[],!A.labels&&E.value&&E.value.length>0&&(typeof E.value[0]=="number"?S.labels=Array.from(Array(E.value.length),(P,N)=>N.toString()):S.labels=E.value.map(P=>P.x.toString())));let D=ni(Bt(Bt(Bt({},c(M)),x),A),{label:k,data:E.value||[]});return(["bar","bar-fast"].includes(A.type)||["bar","bar-fast"].includes(_.type)&&!A.type)&&w.length===1&&(D.borderColor=a,D.backgroundColor=a),D}),S}let h,f=[],d;function p(){let w=Jv(l,i.global);w=Jv(w,{data:u(o,i.datasets,w),options:s}),s.xlabel&&(w=Jv(w,{options:{scales:{x:{title:{display:!0,text:s.xlabel}}}}})),s.ylabel&&(w=Jv(w,{options:{scales:{y:{title:{display:!0,text:s.ylabel}}}}})),f=o.map(({dataStream:_,options:S},T)=>_.subscribe(E=>{E&&h&&(!S.labels&&T===0&&E.length>0&&(typeof E[0]=="number"?w.data.labels=Array.from(Array(E.length),(k,A)=>A.toString()):w.data.labels=E.map(k=>k.x.toString())),w.data.datasets[T].data=E,h.update())}));const x=d.getContext("2d");h=new Eg(x,w)}function m(){for(const w of f)w();h==null||h.destroy()}Da(async()=>{await Ns(),await Ns(),p()});let v=o.length;Wh(m);function y(w){Ur[w?"unshift":"push"](()=>{d=w,n(1,d)})}return t.$$set=w=>{"title"in w&&n(0,r=w.title),"preset"in w&&n(2,i=w.preset),"options"in w&&n(3,s=w.options),"datasets"in w&&n(4,o=w.datasets)},t.$$.update=()=>{t.$$.dirty&48&&o.length!==v&&(m(),p(),n(5,v=o.length))},[r,d,i,s,o,v,y]}class QXe extends Kt{constructor(e){super();Xt(this,e,JXe,ZXe,Gt,{title:0,preset:2,options:3,datasets:4})}}var Rk,Dk,Xo;const cY={line:{global:{type:"line",options:{animation:{duration:200},scales:{x:{ticks:{sampleSize:11}}}}},datasets:{fill:!1,lineTension:.2}},"line-fast":{global:{type:"line",options:{elements:{point:{radius:0}},animation:!1,tooltips:!1,spanGaps:!0,scales:{x:{ticks:{sampleSize:11}}}}},datasets:{fill:!1,lineTension:0}},bar:{global:{type:"bar",options:{animation:{duration:200},scales:{y:{beginAtZero:!0}}}}},"bar-fast":{global:{type:"bar",options:{animation:!1,scales:{y:{beginAtZero:!0}}}}},scatter:{global:{type:"scatter",options:{scales:{x:{type:"linear",position:"bottom"}}}}}};class eKe extends $s{constructor({preset:e="line",options:n={}}={}){super();this.title="generic chart",Rk.set(this,void 0),Dk.set(this,void 0),Xo.set(this,[]),Object.keys(cY).includes(e)||Fa(new Error(`Preset ${e} is not recognized`)),yn(this,Rk,e,"f"),yn(this,Dk,cY[e],"f"),this.options=n,this.start()}addSeries(e,n,r={}){if(ZK(e))if(Ee(this,Rk,"f")==="line-fast"){const i=e.throttle(100);i.value=e.value,Ee(this,Xo,"f").push({dataStream:i,label:n,options:r})}else Ee(this,Xo,"f").push({dataStream:e,label:n,options:r});else e.toArray().then(i=>{const s=new Ue(i,!0);Ee(this,Xo,"f").push({dataStream:s,label:n,options:r}),this.updateView()})}setColors(e){Ee(this,Xo,"f")[0].label="clusters",Ee(this,Xo,"f")[0].options.backgroundColor=e.value,Ee(this,Xo,"f")[0].options.color=e.value}removeSeries(e){const n=Ee(this,Xo,"f").map(r=>r.dataStream).indexOf(e);n>-1&&Ee(this,Xo,"f").splice(n,1)}clear(){yn(this,Xo,[],"f"),this.updateView()}updateView(){this.$$.app&&this.$$.app.$set({datasets:Ee(this,Xo,"f")})}mount(e){const n=e||document.querySelector(`#${this.id}`);!n||(this.destroy(),this.$$.app=new QXe({target:n,props:{title:this.title,preset:Ee(this,Dk,"f"),options:this.options,datasets:Ee(this,Xo,"f")}}))}}Rk=new WeakMap,Dk=new WeakMap,Xo=new WeakMap;function uY(t){return new eKe(t)}function hY(t){let e,n;return{c(){e=new N7e,n=Ki(),e.a=n},m(r,i){e.m(t[2],r,i),ie(r,n,i)},p(r,i){i&4&&e.p(r[2])},d(r){r&&ne(n),r&&e.d()}}}function tKe(t){let e,n=t[2]&&hY(t);return{c(){e=oe("div"),n&&n.c(),H(e,"class","flex-grow")},m(r,i){ie(r,e,i),n&&n.m(e,null)},p(r,i){r[2]?n?n.p(r,i):(n=hY(r),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},d(r){r&&ne(e),n&&n.d()}}}function nKe(t){let e,n;return e=new Rs({props:{title:t[0],$$slots:{default:[tKe]},$$scope:{ctx:t}}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,[i]){const s={};i&1&&(s.title=r[0]),i&12&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function rKe(t,e,n){let r,i=Ge,s=()=>(i(),i=_r(a,l=>n(2,r=l)),a);t.$$.on_destroy.push(()=>i());let{title:o}=e,{text:a}=e;return s(),t.$$set=l=>{"title"in l&&n(0,o=l.title),"text"in l&&s(n(1,a=l.text))},[o,a,r]}class iKe extends Kt{constructor(e){super();Xt(this,e,rKe,nKe,Gt,{title:0,text:1})}get title(){return this.$$.ctx[0]}set title(e){this.$set({title:e}),qd()}get text(){return this.$$.ctx[1]}set text(e){this.$set({text:e}),qd()}}class sKe extends $s{constructor(e="click me"){super();this.title="text",this.$value=new Ue(e,!0),this.start()}mount(e){const n=e||document.querySelector(`#${this.id}`);!n||(this.destroy(),this.$$.app=new iKe({target:n,props:{title:this.title,text:this.$value}}))}}function oKe(t){return new sKe(t)}var wu,vc;class aKe extends $s{constructor(e){super();this.title="confidence plot",wu.set(this,void 0),vc.set(this,void 0),this.$confidenceStream=new Ue(th(({confidences:n})=>Object.entries(n).map(([r,i])=>({x:r,y:i})),e)),yn(this,wu,uY({preset:"bar-fast",options:{xlabel:"Label",ylabel:"Confidence",scales:{y:{suggestedMax:1}}}}),"f"),Ee(this,wu,"f").addSeries(this.$confidenceStream,"Confidences"),Ee(this,wu,"f").title="",yn(this,vc,oKe("Waiting for predictions..."),"f"),Ee(this,vc,"f").title=this.title,Ee(this,vc,"f").$value=new Ue(xG("Waiting for predictions...")(th(({label:n,trueLabel:r})=>{let i=`<h2>Predicted Label: <code>${n}</code></h2>`;return r!==void 0&&(i+=`<p>True Label: ${r} (${n===r?"Correct":"Incorrect"})</p>`),i},e)),!0),this.start()}mount(e){const n=e||document.querySelector(`#${this.id}`);if(!n)return;const r=document.createElement("div");r.id=`${n.id}-${Ee(this,vc,"f").id}`;const i=document.createElement("div");i.id=`${n.id}-${Ee(this,wu,"f").id}`,n.appendChild(r),n.appendChild(i),Ee(this,vc,"f").title=this.title,Ee(this,vc,"f").mount(r),Ee(this,wu,"f").mount(i),this.destroy=()=>{r.parentElement.removeChild(r),i.parentElement.removeChild(i),Ee(this,vc,"f").destroy(),Ee(this,wu,"f").destroy()}}destroy(){Ee(this,vc,"f").destroy(),Ee(this,wu,"f").destroy()}}wu=new WeakMap,vc=new WeakMap;function utt(t){return new aKe(t)}function lKe(t){let e;return{c(){e=oe("p"),e.textContent="Waiting for predictions...",H(e,"class","m-2")},m(n,r){ie(n,e,r)},p:Ge,d(n){n&&ne(e)}}}function cKe(t){let e,n,r=t[2].toFixed(2)+"",i,s,o,a,l,c;return{c(){e=oe("p"),n=Ie("Global Accuracy: "),i=Ie(r),s=Oe(),o=oe("div"),a=oe("canvas"),H(e,"class","m-2"),H(o,"class","confusion-container svelte-1d2i0ke")},m(u,h){ie(u,e,h),X(e,n),X(e,i),ie(u,s,h),ie(u,o,h),X(o,a),l||(c=w7e(t[3].call(null,a)),l=!0)},p(u,h){h&4&&r!==(r=u[2].toFixed(2)+"")&&zt(i,r)},d(u){u&&ne(e),u&&ne(s),u&&ne(o),l=!1,c()}}}function uKe(t){let e;function n(s,o){return s[2]!==void 0?cKe:lKe}let r=n(t),i=r(t);return{c(){i.c(),e=Ki()},m(s,o){i.m(s,o),ie(s,e,o)},p(s,o){r===(r=n(s))&&i?i.p(s,o):(i.d(1),i=r(s),i&&(i.c(),i.m(e.parentNode,e)))},d(s){i.d(s),s&&ne(e)}}}function hKe(t){let e,n;return e=new Rs({props:{title:t[0],$$slots:{default:[uKe]},$$scope:{ctx:t}}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,[i]){const s={};i&1&&(s.title=r[0]),i&2052&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function fKe(t,e,n){let r,i=Ge,s=()=>(i(),i=_r(a,v=>n(2,r=v)),a);t.$$.on_destroy.push(()=>i());let{title:o}=e,{accuracy:a}=e;s();let{confusion:l}=e,{labels:c}=e;Eg.register(vw,I9,O9,XD,xw);let u=1,h=1;const f={type:"matrix",data:{datasets:[{label:"Confusion Matrix",data:[],backgroundColor(v){return v.dataset.data.length>0?`rgba(54, 162, 235, ${v.dataset.data[v.dataIndex].v/u})`:"rgba(54, 162, 235, 0)"},width(v){const y=v.chart.chartArea;return y?(y.right-y.left)/h-2:0},height(v){const y=v.chart.chartArea;return y?(y.bottom-y.top)/h-2:0}}]},options:{aspectRatio:1,legend:{display:!1},tooltips:{callbacks:{title(){return""},label(v){const y=v.dataset.data[v.dataIndex];return["true label: "+y.y,"predicted label: "+y.x,"count: "+y.v]}}},scales:{x:{type:"category",labels:[],ticks:{display:!0},gridLines:{display:!1},scaleLabel:{display:!0,labelString:"Predicted Label"}},y:{type:"category",labels:[],offset:!0,reverse:!0,ticks:{display:!0},gridLines:{display:!1},scaleLabel:{display:!0,labelString:"True Label"}}}}};let d,p=[];function m(v){const y=v.getContext("2d");d=new Eg(y,f),p.push(c.subscribe(w=>{h=w.length,f.options.scales.x.labels=w,f.options.scales.y.labels=w,d.update()})),p.push(l.subscribe(w=>{u=w.reduce((x,{v:_})=>Math.max(x,_),0),f.data.datasets[0].data=w,d.update()}))}return Wh(()=>{for(const v of p)v()}),t.$$set=v=>{"title"in v&&n(0,o=v.title),"accuracy"in v&&s(n(1,a=v.accuracy)),"confusion"in v&&n(4,l=v.confusion),"labels"in v&&n(5,c=v.labels)},[o,a,r,m,l,c]}class dKe extends Kt{constructor(e){super();Xt(this,e,fKe,hKe,Gt,{title:0,accuracy:1,confusion:4,labels:5})}}var r1;class pKe extends $s{constructor(e){super();this.title="confusion matrix",r1.set(this,void 0),this.$labels=new Ue([],!0),yn(this,r1,e,"f");const n=new Ue(vG(th(async r=>Promise.all(r.map(i=>Ee(this,r1,"f").predictionService.get(i))),Ee(this,r1,"f").$predictions)));this.$confusion=new Ue(th(r=>{const i=r.map(u=>u.label),s=r.map(u=>u.trueLabel),o=Array.from(new Set(i.concat(s)));ww(o,this.$labels.value)||this.$labels.set(o);const a=o.length,l=o.reduce((u,h,f)=>ni(Bt({},u),{[h]:f}),{}),c=Array.from(Array(a**2),()=>0);for(let u=0;u<i.length;u+=1)c[l[i[u]]*a+l[s[u]]]+=1;return c.map((u,h)=>({x:o[Math.floor(h/a)],y:o[h%a],v:u}))},n),!0),this.$accuracy=new Ue(th(r=>{if(r.length!==0)return r.reduce((i,{label:s,trueLabel:o})=>i+(s===o?1:0),0)/r.length},n),!0),this.start()}mount(e){const n=e||document.querySelector(`#${this.id}`);!n||(this.destroy(),this.$$.app=new dKe({target:n,props:{title:this.title,confusion:this.$confusion,accuracy:this.$accuracy,labels:this.$labels}}))}}r1=new WeakMap;function htt(t){return new pKe(t)}function fY(t,e,n){const r=t.slice();return r[7]=e[n],r}function mKe(t){let e,n;return{c(){e=Zr("svg"),n=Zr("path"),H(n,"d","M10 12a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm0-6a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm0 12a2 2 0 1 1 0-4 2 2 0 0 1 0 4z"),H(e,"class","fill-current inline-block h-5 w-5"),H(e,"xmlns","http://www.w3.org/2000/svg"),H(e,"viewBox","0 0 20 20")},m(r,i){ie(r,e,i),X(e,n)},d(r){r&&ne(e)}}}function dY(t){let e,n,r,i,s,o=t[0],a=[];for(let l=0;l<o.length;l+=1)a[l]=pY(fY(t,o,l));return{c(){e=oe("div"),n=oe("div"),r=oe("div");for(let l=0;l<a.length;l+=1)a[l].c();H(r,"class","py-1"),H(r,"role","menu"),H(r,"aria-orientation","vertical"),H(r,"aria-labelledby","options-menu"),H(n,"class","origin-top-right absolute right-0 mt-1 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none"),H(e,"class","origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg z-50"),dt(e,"hidden",!1)},m(l,c){ie(l,e,c),X(e,n),X(n,r);for(let u=0;u<a.length;u+=1)a[u].m(r,null);s=!0},p(l,c){if(c&9){o=l[0];let u;for(u=0;u<o.length;u+=1){const h=fY(l,o,u);a[u]?a[u].p(h,c):(a[u]=pY(h),a[u].c(),a[u].m(r,null))}for(;u<a.length;u+=1)a[u].d(1);a.length=o.length}},i(l){s||(vu(()=>{i||(i=Hv(e,qK,{duration:100},!0)),i.run(1)}),s=!0)},o(l){i||(i=Hv(e,qK,{duration:100},!1)),i.run(0),s=!1},d(l){l&&ne(e),Yr(a,l),l&&i&&i.end()}}}function pY(t){let e,n=t[7].text+"",r,i,s,o;function a(){return t[5](t[7])}return{c(){e=oe("button"),r=Ie(n),i=Oe(),H(e,"class",`text-sm py-2 px-4 font-normal block w-full whitespace-no-wrap bg-transparent
          text-gray-800 hover:bg-gray-100 border-0 cursor-pointer`)},m(l,c){ie(l,e,c),X(e,r),X(e,i),s||(o=Ln(e,"click",a),s=!0)},p(l,c){t=l,c&1&&n!==(n=t[7].text+"")&&zt(r,n)},d(l){l&&ne(e),s=!1,o()}}}function gKe(t){let e,n,r,i,s,o,a;r=new ui({props:{size:"small",round:!0,$$slots:{default:[mKe]},$$scope:{ctx:t}}}),r.$on("click",t[2]);let l=t[1]&&dY(t);return{c(){e=Oe(),n=oe("div"),et(r.$$.fragment),i=Oe(),l&&l.c(),H(n,"class","relative")},m(c,u){ie(c,e,u),ie(c,n,u),Ze(r,n,null),X(n,i),l&&l.m(n,null),s=!0,o||(a=Ln(document.body,"click",t[4]),o=!0)},p(c,[u]){const h={};u&1024&&(h.$$scope={dirty:u,ctx:c}),r.$set(h),c[1]?l?(l.p(c,u),u&2&&ve(l,1)):(l=dY(c),l.c(),ve(l,1),l.m(n,null)):l&&(Bn(),be(l,1,1,()=>{l=null}),zn())},i(c){s||(ve(r.$$.fragment,c),ve(l),s=!0)},o(c){be(r.$$.fragment,c),be(l),s=!1},d(c){c&&ne(e),c&&ne(n),Je(r),l&&l.d(),o=!1,a()}}}function vKe(t,e,n){let{actions:r=[]}=e;const i=Pa();let s=!1;function o(u){u.stopPropagation(),s?n(1,s=!1):n(1,s=!0)}function a(u){i("select",u)}const l=()=>{n(1,s=!1)},c=u=>a(u.code);return t.$$set=u=>{"actions"in u&&n(0,r=u.actions)},[r,s,o,a,l,c]}class yKe extends Kt{constructor(e){super();Xt(this,e,vKe,gKe,Gt,{actions:0})}}const{window:mY}=V7e;function gY(t,e,n){const r=t.slice();return r[22]=e[n][0],r[23]=e[n][1],r}function vY(t,e,n){const r=t.slice();return r[26]=e[n].id,r[27]=e[n].thumbnail,r}function yY(t){let e,n,r,i,s;function o(f,d){return f[5]>0?wKe:bKe}let a=o(t),l=a(t),c=Object.entries(t[4]),u=[];for(let f=0;f<c.length;f+=1)u[f]=wY(gY(t,c,f));const h=f=>be(u[f],1,1,()=>{u[f]=null});return{c(){l.c(),e=Oe(),n=oe("div");for(let f=0;f<u.length;f+=1)u[f].c();H(n,"class","flex flex-wrap")},m(f,d){l.m(f,d),ie(f,e,d),ie(f,n,d);for(let p=0;p<u.length;p+=1)u[p].m(n,null);r=!0,i||(s=Ln(n,"click",t[14]),i=!0)},p(f,d){if(a===(a=o(f))&&l?l.p(f,d):(l.d(1),l=a(f),l&&(l.c(),l.m(e.parentNode,e))),d&1616){c=Object.entries(f[4]);let p;for(p=0;p<c.length;p+=1){const m=gY(f,c,p);u[p]?(u[p].p(m,d),ve(u[p],1)):(u[p]=wY(m),u[p].c(),ve(u[p],1),u[p].m(n,null))}for(Bn(),p=c.length;p<u.length;p+=1)h(p);zn()}},i(f){if(!r){for(let d=0;d<c.length;d+=1)ve(u[d]);r=!0}},o(f){u=u.filter(Boolean);for(let d=0;d<u.length;d+=1)be(u[d]);r=!1},d(f){l.d(f),f&&ne(e),f&&ne(n),Yr(u,f),i=!1,s()}}}function bKe(t){let e;return{c(){e=oe("p"),e.textContent="This dataset is empty.",H(e,"class","ml-3 mt-2")},m(n,r){ie(n,e,r)},p:Ge,d(n){n&&ne(e)}}}function wKe(t){let e,n,r,i,s=(t[5]>1?"s":"")+"",o,a;return{c(){e=oe("p"),n=Ie("This dataset contains "),r=Ie(t[5]),i=Ie(" instance"),o=Ie(s),a=Ie("."),H(e,"class","ml-3 mt-2")},m(l,c){ie(l,e,c),X(e,n),X(e,r),X(e,i),X(e,o),X(e,a)},p(l,c){c&32&&zt(r,l[5]),c&32&&s!==(s=(l[5]>1?"s":"")+"")&&zt(o,s)},d(l){l&&ne(e)}}}function bY(t){let e,n,r,i;function s(){return t[13](t[26])}return{c(){e=oe("img"),e.src!==(n=t[27])&&H(e,"src",n),H(e,"alt","thumbnail"),H(e,"class","m-1 svelte-294f8b"),dt(e,"selected",t[6].includes(t[26]))},m(o,a){ie(o,e,a),r||(i=Ln(e,"click",E7e(s)),r=!0)},p(o,a){t=o,a&16&&e.src!==(n=t[27])&&H(e,"src",n),a&80&&dt(e,"selected",t[6].includes(t[26]))},d(o){o&&ne(e),r=!1,i()}}}function wY(t){let e,n,r,i=t[22]+"",s,o,a,l,c,u,h;function f(...m){return t[12](t[22],...m)}a=new yKe({props:{actions:[{code:"edit",text:"Edit class label"},{code:"delete",text:"Delete class"}].concat(t[6].length>0?[{code:"deleteInstances",text:`Delete selected instance${t[6].length>1?"s":""}`},{code:"relabelInstances",text:`Relabel selected instance${t[6].length>1?"s":""}`}]:[])}}),a.$on("select",f);let d=t[23],p=[];for(let m=0;m<d.length;m+=1)p[m]=bY(vY(t,d,m));return{c(){e=oe("div"),n=oe("div"),r=oe("span"),s=Ie(i),o=Oe(),et(a.$$.fragment),l=Oe(),c=oe("div");for(let m=0;m<p.length;m+=1)p[m].c();u=Oe(),H(r,"class","browser-class-title svelte-294f8b"),H(n,"class","browser-class-header svelte-294f8b"),H(c,"class","browser-class-body svelte-294f8b"),H(e,"class","browser-class svelte-294f8b")},m(m,v){ie(m,e,v),X(e,n),X(n,r),X(r,s),X(n,o),Ze(a,n,null),X(e,l),X(e,c);for(let y=0;y<p.length;y+=1)p[y].m(c,null);X(e,u),h=!0},p(m,v){t=m,(!h||v&16)&&i!==(i=t[22]+"")&&zt(s,i);const y={};if(v&64&&(y.actions=[{code:"edit",text:"Edit class label"},{code:"delete",text:"Delete class"}].concat(t[6].length>0?[{code:"deleteInstances",text:`Delete selected instance${t[6].length>1?"s":""}`},{code:"relabelInstances",text:`Relabel selected instance${t[6].length>1?"s":""}`}]:[])),a.$set(y),v&592){d=t[23];let w;for(w=0;w<d.length;w+=1){const x=vY(t,d,w);p[w]?p[w].p(x,v):(p[w]=bY(x),p[w].c(),p[w].m(c,null))}for(;w<p.length;w+=1)p[w].d(1);p.length=d.length}},i(m){h||(ve(a.$$.fragment,m),h=!0)},o(m){be(a.$$.fragment,m),h=!1},d(m){m&&ne(e),Je(a),Yr(p,m)}}}function xKe(t){let e,n,r=t[4]&&yY(t);return{c(){r&&r.c(),e=Ki()},m(i,s){r&&r.m(i,s),ie(i,e,s),n=!0},p(i,s){i[4]?r?(r.p(i,s),s&16&&ve(r,1)):(r=yY(i),r.c(),ve(r,1),r.m(e.parentNode,e)):r&&(Bn(),be(r,1,1,()=>{r=null}),zn())},i(i){n||(ve(r),n=!0)},o(i){be(r),n=!1},d(i){r&&r.d(i),i&&ne(e)}}}function _Ke(t){let e,n,r,i;return e=new Rs({props:{title:t[0],loading:t[3],$$slots:{default:[xKe]},$$scope:{ctx:t}}}),{c(){et(e.$$.fragment)},m(s,o){Ze(e,s,o),n=!0,r||(i=[Ln(mY,"keydown",t[7]),Ln(mY,"keyup",t[8])],r=!0)},p(s,[o]){const a={};o&1&&(a.title=s[0]),o&8&&(a.loading=s[3]),o&1073741936&&(a.$$scope={dirty:o,ctx:s}),e.$set(a)},i(s){n||(ve(e.$$.fragment,s),n=!0)},o(s){be(e.$$.fragment,s),n=!1},d(s){Je(e,s),r=!1,Ra(i)}}}function SKe(t,e,n){let r,i=Ge,s=()=>(i(),i=_r(u,N=>n(5,r=N)),u),o,a=Ge,l=()=>(a(),a=_r(f,N=>n(6,o=N)),f);t.$$.on_destroy.push(()=>i()),t.$$.on_destroy.push(()=>a());let{title:c}=e,{count:u}=e;s();let{dataset:h}=e,{selected:f}=e;l();let d=!1,p={};async function m(){if(!d){n(3,d=!0),n(4,p={}),await h.ready;for await(const N of h.items().select(["id","y","thumbnail"]))n(4,p[N.y]=(p[N.y]||[]).concat([N]),p);n(3,d=!1)}}function v(N){for(const[R,F]of Object.entries(p))if(F.map(O=>O.id).includes(N))return R;return null}async function y(){let N=Promise.resolve();for(const R of f.value)N=N.then(()=>h.remove(R));await N,f.set([])}async function w(N){let R=Promise.resolve();for(const F of f.value)R=R.then(()=>h.patch(F,{y:N}));await R,f.set([])}let x=!1,_=!1;function S(N){["Meta","Control"].includes(N.key)?x=!0:N.key==="Shift"?_=!0:(N.key==="Delete"||N.key==="Backspace"&&x)&&y()}function T(N){["Meta","Control"].includes(N.key)?x=!1:N.key==="Shift"&&(_=!1)}let E=null;function k(N){if(x){if(!N)return;f.value.includes(N)?f.set(f.value.filter(R=>R!==N)):f.set(f.value.concat([N]))}else if(_){if(!E||!N)return;const R=v(E),F=v(N);if(R!==F)return;const O=p[R].map(re=>re.id),K=O.indexOf(E),J=O.indexOf(N);f.set(K<J?O.slice(K,J+1):O.slice(J,K+1))}else f.set(N?[N]:[]),E=N}function A(N,R){let F;switch(R){case"edit":F=window.prompt("Enter the new label",N),F&&h.patch(null,{y:F},{query:{y:N}});break;case"delete":h.remove(null,{query:{y:N}});break;case"deleteInstances":y();break;case"relabelInstances":F=window.prompt("Enter the new label",N),F&&w(F);break;default:alert(`Class ${N}: ${R}`);break}}Da(()=>{m(),h.$changes.subscribe(async N=>{for(const{level:R,type:F,data:O}of N)if(R==="dataset")F==="created"&&m();else if(R==="instance")if(F==="created")n(4,p[O.y]=(p[O.y]||[]).concat([{id:O.id,y:O.y,thumbnail:O.thumbnail}]),p);else if(F==="updated"){const K=v(O.id);n(4,p[K]=p[K].filter(({id:J})=>J!==O.id),p),p[K].length===0&&(delete p[K],n(4,p)),n(4,p[O.y]=(p[O.y]||[]).concat([{id:O.id,y:O.y,thumbnail:O.thumbnail}]),p)}else F==="removed"&&(n(4,p[O.y]=p[O.y].filter(({id:K})=>K!==O.id),p),p[O.y].length===0&&(delete p[O.y],n(4,p)))})});const M=(N,R)=>A(N,R.detail),D=N=>k(N),P=()=>k();return t.$$set=N=>{"title"in N&&n(0,c=N.title),"count"in N&&s(n(1,u=N.count)),"dataset"in N&&n(11,h=N.dataset),"selected"in N&&l(n(2,f=N.selected))},[c,u,f,d,p,r,o,S,T,k,A,h,M,D,P]}class CKe extends Kt{constructor(e){super();Xt(this,e,SKe,_Ke,Gt,{title:0,count:1,dataset:11,selected:2})}}var i1;class TKe extends $s{constructor(e){super();this.title="dataset browser",i1.set(this,void 0),this.$selected=new Ue([],!0),yn(this,i1,e,"f"),this.start()}mount(e){const n=e||document.querySelector(`#${this.id}`);!n||(this.destroy(),this.$$.app=new CKe({target:n,props:{title:this.title,count:Ee(this,i1,"f").$count,dataset:Ee(this,i1,"f"),selected:this.$selected}}))}}i1=new WeakMap;function ftt(t){return new TKe(t)}const Qv=[];function s1(t,e=Ge){let n;const r=[];function i(a){if(Gt(t,a)&&(t=a,n)){const l=!Qv.length;for(let c=0;c<r.length;c+=1){const u=r[c];u[1](),Qv.push(u,t)}if(l){for(let c=0;c<Qv.length;c+=2)Qv[c][0](Qv[c+1]);Qv.length=0}}}function s(a){i(a(t))}function o(a,l=Ge){const c=[a,l];return r.push(c),r.length===1&&(n=e(i)||Ge),a(t),()=>{const u=r.indexOf(c);u!==-1&&r.splice(u,1),r.length===0&&(n(),n=null)}}return{set:i,update:s,subscribe:o}}const xY={itemsPerPage:10};class _Y{constructor(e=xY){this.data=s1([]),this.total=s1(0),this.error=s1(null),this.options=Bt(Bt({},xY),e)}paginate(e){this.options.itemsPerPage=e,this.update()}async get(e){const n=Ux(this.data);return e>=0&&e<n.length?n[e]:null}}class EKe extends _Y{constructor(s){var o=s,{service:e,columns:n,transform:r}=o,i=ja(o,["service","columns","transform"]);super(i);this.service=e,this.transform=r||{},this.query={$sort:{updatedAt:-1},$limit:this.options.itemsPerPage},n&&(this.query.$select=n.map(a=>a.name).concat(["id"])),this.update(),this.service.on("created",this.update.bind(this)),this.service.on("patched",this.update.bind(this)),this.service.on("updated",this.update.bind(this)),this.service.on("removed",this.update.bind(this))}paginate(e){super.paginate(e),this.query.$limit=this.options.itemsPerPage,this.update()}async update(){try{const e=await this.service.find({query:this.query}),n=e.data.map((r,i)=>{const s=Object.entries(this.transform).map(([o,a])=>{try{return{[o]:a(r,i)}}catch{return{[o]:"transform error"}}}).reduce((o,a)=>Bt(Bt({},o),a),{});return Bt(Bt({},r),s)});this.data.set(n),this.total.set(e.total),this.error.set(null)}catch(e){this.data.set([]),this.total.set(0),this.error.set(e)}}async page(e){this.query.$skip=(e-1)*this.query.$limit,this.update()}async sort(e){const{col:n,ascending:r}=e;n?this.query.$sort={[n]:r?1:-1}:delete this.query.$sort,this.update()}async delete(e){const n=Ux(this.data)[e];return await this.service.remove(n.id),this.update(),n}}function kKe(t){let e;return{c(){e=Ie(t[1])},m(n,r){ie(n,e,r)},p(n,r){r&2&&zt(e,n[1])},i:Ge,o:Ge,d(n){n&&ne(e)}}}function AKe(t){let e=t[1].toPrecision(2)+"",n;return{c(){n=Ie(e)},m(r,i){ie(r,n,i)},p(r,i){i&2&&e!==(e=r[1].toPrecision(2)+"")&&zt(n,e)},i:Ge,o:Ge,d(r){r&&ne(n)}}}function MKe(t){let e,n=kO(t[1]).join(", ")+"",r,i;return{c(){e=Ie("Array("),r=Ie(n),i=Ie(")")},m(s,o){ie(s,e,o),ie(s,r,o),ie(s,i,o)},p(s,o){o&2&&n!==(n=kO(s[1]).join(", ")+"")&&zt(r,n)},i:Ge,o:Ge,d(s){s&&ne(e),s&&ne(r),s&&ne(i)}}}function IKe(t){let e=t[3](t[1])+"",n;return{c(){n=Ie(e)},m(r,i){ie(r,n,i)},p(r,i){i&2&&e!==(e=r[3](r[1])+"")&&zt(n,e)},i:Ge,o:Ge,d(r){r&&ne(n)}}}function NKe(t){let e;const n=t[4].default,r=zh(n,t,t[7],null);return{c(){r&&r.c()},m(i,s){r&&r.m(i,s),e=!0},p(i,s){r&&r.p&&(!e||s&128)&&Vh(r,n,i,i[7],e?s:-1,null,null)},i(i){e||(ve(r,i),e=!0)},o(i){be(r,i),e=!1},d(i){r&&r.d(i)}}}function $Ke(t){let e,n;return e=new ui({props:{size:"small",$$slots:{default:[PKe]},$$scope:{ctx:t}}}),e.$on("click",t[6]),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,i){const s={};i&130&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function RKe(t){let e,n=t[1].text+"",r,i,s;return{c(){e=oe("sl-button"),r=Ie(n),Gv(e,"type","text"),Gv(e,"size","small")},m(o,a){ie(o,e,a),X(e,r),i||(s=Ln(e,"click",t[5]),i=!0)},p(o,a){a&2&&n!==(n=o[1].text+"")&&zt(r,n)},i:Ge,o:Ge,d(o){o&&ne(e),i=!1,s()}}}function DKe(t){let e,n;return{c(){e=oe("img"),H(e,"alt","thumbnail"),e.src!==(n=t[1])&&H(e,"src",n),H(e,"width","30"),H(e,"height","30"),H(e,"class","rounded-md")},m(r,i){ie(r,e,i)},p(r,i){i&2&&e.src!==(n=r[1])&&H(e,"src",n)},i:Ge,o:Ge,d(r){r&&ne(e)}}}function PKe(t){let e;return{c(){e=Ie(t[1])},m(n,r){ie(n,e,r)},p(n,r){r&2&&zt(e,n[1])},d(n){n&&ne(e)}}}function OKe(t){let e,n,r,i;const s=[DKe,RKe,$Ke,NKe,IKe,MKe,AKe,kKe],o=[];function a(l,c){return l[0]==="image"?0:l[0]==="link"?1:l[0]==="action"?2:l[0]==="slot"?3:l[0]==="date"?4:l[0]==="array"?5:typeof l[1]=="number"?6:7}return n=a(t),r=o[n]=s[n](t),{c(){e=oe("td"),r.c(),H(e,"class","svelte-fe0rg4")},m(l,c){ie(l,e,c),o[n].m(e,null),i=!0},p(l,[c]){let u=n;n=a(l),n===u?o[n].p(l,c):(Bn(),be(o[u],1,1,()=>{o[u]=null}),zn(),r=o[n],r?r.p(l,c):(r=o[n]=s[n](l),r.c()),ve(r,1),r.m(e,null))},i(l){i||(ve(r),i=!0)},o(l){be(r),i=!1},d(l){l&&ne(e),o[n].d()}}}function kO(t){return Array.isArray(t)?t.length>0&&Array.isArray(t[0])?[t.length,...kO(t[0])]:[t.length]:[]}function FKe(t,e,n){let{$$slots:r={},$$scope:i}=e,{type:s="generic"}=e,{value:o=null}=e;const a=Pa();function l(h){try{return VWe(Date.parse(h),{includeSeconds:!0,addSuffix:!0})}catch(f){return console.log("Date Parsing Error",h,f),h}}const c=()=>{console.log("GOTO:",o.href)},u=()=>a("action",o);return t.$$set=h=>{"type"in h&&n(0,s=h.type),"value"in h&&n(1,o=h.value),"$$scope"in h&&n(7,i=h.$$scope)},[s,o,a,l,r,c,u,i]}class SY extends Kt{constructor(e){super();Xt(this,e,FKe,OKe,Gt,{type:0,value:1})}}function CY(t){let e,n,r,i;const s=[BKe,LKe],o=[];function a(l,c){return l[2]?0:1}return e=a(t),n=o[e]=s[e](t),{c(){n.c(),r=Ki()},m(l,c){o[e].m(l,c),ie(l,r,c),i=!0},p(l,c){let u=e;e=a(l),e===u?o[e].p(l,c):(Bn(),be(o[u],1,1,()=>{o[u]=null}),zn(),n=o[e],n?n.p(l,c):(n=o[e]=s[e](l),n.c()),ve(n,1),n.m(r.parentNode,r))},i(l){i||(ve(n),i=!0)},o(l){be(n),i=!1},d(l){o[e].d(l),l&&ne(r)}}}function LKe(t){let e,n;return e=new ui({props:{round:!0,size:"small",$$slots:{default:[zKe]},$$scope:{ctx:t}}}),e.$on("click",t[3]),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,i){const s={};i&64&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function BKe(t){let e,n;return e=new ui({props:{round:!0,size:"small",$$slots:{default:[VKe]},$$scope:{ctx:t}}}),e.$on("click",t[3]),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,i){const s={};i&64&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function zKe(t){let e,n;return{c(){e=Zr("svg"),n=Zr("path"),H(n,"stroke-linecap","round"),H(n,"stroke-linejoin","round"),H(n,"stroke-width","2"),H(n,"d","M16 17l-4 4m0 0l-4-4m4 4V3"),H(e,"xmlns","http://www.w3.org/2000/svg"),H(e,"class","h-6 w-6"),H(e,"fill","none"),H(e,"viewBox","0 0 24 24"),H(e,"stroke","currentColor")},m(r,i){ie(r,e,i),X(e,n)},d(r){r&&ne(e)}}}function VKe(t){let e,n;return{c(){e=Zr("svg"),n=Zr("path"),H(n,"stroke-linecap","round"),H(n,"stroke-linejoin","round"),H(n,"stroke-width","2"),H(n,"d","M8 7l4-4m0 0l4 4m-4-4v18"),H(e,"xmlns","http://www.w3.org/2000/svg"),H(e,"class","h-6 w-6"),H(e,"fill","none"),H(e,"viewBox","0 0 24 24"),H(e,"stroke","currentColor")},m(r,i){ie(r,e,i),X(e,n)},d(r){r&&ne(e)}}}function UKe(t){let e,n,r,i,s,o,a=t[1]&&CY(t);return{c(){e=oe("th"),n=oe("span"),r=oe("span"),i=Ie(t[0]),s=Oe(),a&&a.c(),Jr(r,"margin-top","0.5rem"),Jr(r,"margin-bottom","0.5rem"),Jr(n,"display","flex"),Jr(n,"justify-content","space-between"),Jr(n,"align-items","center"),H(e,"class","svelte-vc6860")},m(l,c){ie(l,e,c),X(e,n),X(n,r),X(r,i),X(n,s),a&&a.m(n,null),o=!0},p(l,[c]){(!o||c&1)&&zt(i,l[0]),l[1]?a?(a.p(l,c),c&2&&ve(a,1)):(a=CY(l),a.c(),ve(a,1),a.m(n,null)):a&&(Bn(),be(a,1,1,()=>{a=null}),zn())},i(l){o||(ve(a),o=!0)},o(l){be(a),o=!1},d(l){l&&ne(e),a&&a.d()}}}function WKe(t,e,n){let{name:r="name"}=e,{sortable:i=!1}=e,{sorting:s={col:"",ascending:!0}}=e;const o=Pa();let a=!0;function l(){n(2,a=!a),o("sort",{col:r,ascending:a})}return t.$$set=c=>{"name"in c&&n(0,r=c.name),"sortable"in c&&n(1,i=c.sortable),"sorting"in c&&n(4,s=c.sorting)},t.$$.update=()=>{t.$$.dirty&17&&s.col===r&&n(2,a=s.ascending)},[r,i,a,l,s]}class GKe extends Kt{constructor(e){super();Xt(this,e,WKe,UKe,Gt,{name:0,sortable:1,sorting:4})}}function TY(t,e,n){const r=t.slice();return r[7]=e[n],r}function EY(t){let e,n;return{c(){e=oe("option"),n=Ie(t[2]),e.__value="",e.value=e.__value,e.disabled=!0,H(e,"class","svelte-n2q85f")},m(r,i){ie(r,e,i),X(e,n)},p(r,i){i&4&&zt(n,r[2])},d(r){r&&ne(e)}}}function kY(t){let e,n=t[7]+"",r,i;return{c(){e=oe("option"),r=Ie(n),e.__value=i=t[7],e.value=e.__value,H(e,"class","svelte-n2q85f")},m(s,o){ie(s,e,o),X(e,r)},p(s,o){o&2&&n!==(n=s[7]+"")&&zt(r,n),o&2&&i!==(i=s[7])&&(e.__value=i,e.value=e.__value)},d(s){s&&ne(e)}}}function HKe(t){let e,n,r,i,s,o,a,l=t[2]&&EY(t),c=t[1],u=[];for(let h=0;h<c.length;h+=1)u[h]=kY(TY(t,c,h));return{c(){e=oe("div"),n=oe("select"),l&&l.c(),r=Ki();for(let h=0;h<u.length;h+=1)u[h].c();i=Oe(),s=oe("div"),s.innerHTML='<svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"></path></svg>',H(n,"class","svelte-n2q85f"),t[0]===void 0&&vu(()=>t[5].call(n)),dt(n,"small",t[3]==="small"),H(s,"class","pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700"),H(e,"class","select-container svelte-n2q85f")},m(h,f){ie(h,e,f),X(e,n),l&&l.m(n,null),X(n,r);for(let d=0;d<u.length;d+=1)u[d].m(n,null);FK(n,t[0]),X(e,i),X(e,s),o||(a=[Ln(n,"change",t[5]),Ln(n,"change",t[6])],o=!0)},p(h,[f]){if(h[2]?l?l.p(h,f):(l=EY(h),l.c(),l.m(n,r)):l&&(l.d(1),l=null),f&2){c=h[1];let d;for(d=0;d<c.length;d+=1){const p=TY(h,c,d);u[d]?u[d].p(p,f):(u[d]=kY(p),u[d].c(),u[d].m(n,null))}for(;d<u.length;d+=1)u[d].d(1);u.length=c.length}f&3&&FK(n,h[0]),f&8&&dt(n,"small",h[3]==="small")},i:Ge,o:Ge,d(h){h&&ne(e),l&&l.d(),Yr(u,h),o=!1,Ra(a)}}}function jKe(t,e,n){let{options:r}=e,{value:i=""}=e,{placeholder:s="Select an Option"}=e,{size:o="normal"}=e;const a=Pa();function l(){i=A7e(this),n(0,i),n(1,r)}const c=u=>a("change",u.currentTarget.value);return t.$$set=u=>{"options"in u&&n(1,r=u.options),"value"in u&&n(0,i=u.value),"placeholder"in u&&n(2,s=u.placeholder),"size"in u&&n(3,o=u.size)},[i,r,s,o,a,l,c]}class AY extends Kt{constructor(e){super();Xt(this,e,jKe,HKe,Gt,{options:1,value:0,placeholder:2,size:3})}}function MY(t,e,n){const r=t.slice();return r[10]=e[n].name,r[11]=e[n].multiple,r[12]=e[n].confirm,r}function qKe(t){let e=t[10]+"",n;return{c(){n=Ie(e)},m(r,i){ie(r,n,i)},p(r,i){i&2&&e!==(e=r[10]+"")&&zt(n,e)},d(r){r&&ne(n)}}}function IY(t){let e,n;function r(){return t[7](t[10],t[12])}return e=new ui({props:{size:"small",disabled:t[11]===!1&&t[0].length>1,type:t[10]==="delete"?"danger":"default",$$slots:{default:[qKe]},$$scope:{ctx:t}}}),e.$on("click",r),{c(){et(e.$$.fragment)},m(i,s){Ze(e,i,s),n=!0},p(i,s){t=i;const o={};s&3&&(o.disabled=t[11]===!1&&t[0].length>1),s&2&&(o.type=t[10]==="delete"?"danger":"default"),s&32770&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(i){n||(ve(e.$$.fragment,i),n=!0)},o(i){be(e.$$.fragment,i),n=!1},d(i){Je(e,i)}}}function NY(t){let e,n;return e=new rY({props:{$$slots:{default:[YKe]},$$scope:{ctx:t}}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,i){const s={};i&32780&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function XKe(t){let e;return{c(){e=Ie("Cancel")},m(n,r){ie(n,e,r)},d(n){n&&ne(e)}}}function KKe(t){let e;return{c(){e=Ie("Confirm")},m(n,r){ie(n,e,r)},d(n){n&&ne(e)}}}function YKe(t){let e,n,r,i,s,o,a,l,c,u,h,f,d;return l=new ui({props:{type:"danger",$$slots:{default:[XKe]},$$scope:{ctx:t}}}),l.$on("click",t[8]),f=new ui({props:{variant:"filled",$$slots:{default:[KKe]},$$scope:{ctx:t}}}),f.$on("click",t[4]),{c(){e=oe("div"),n=oe("p"),r=Ie("Do you want to "),i=Ie(t[2]),s=Ie(" the selected items?"),o=Oe(),a=oe("div"),et(l.$$.fragment),c=Oe(),u=oe("span"),h=Oe(),et(f.$$.fragment),H(u,"class","w-2"),H(a,"class","w-full flex justify-end"),H(e,"class","p-8")},m(p,m){ie(p,e,m),X(e,n),X(n,r),X(n,i),X(n,s),X(e,o),X(e,a),Ze(l,a,null),X(a,c),X(a,u),X(a,h),Ze(f,a,null),d=!0},p(p,m){(!d||m&4)&&zt(i,p[2]);const v={};m&32768&&(v.$$scope={dirty:m,ctx:p}),l.$set(v);const y={};m&32768&&(y.$$scope={dirty:m,ctx:p}),f.$set(y)},i(p){d||(ve(l.$$.fragment,p),ve(f.$$.fragment,p),d=!0)},o(p){be(l.$$.fragment,p),be(f.$$.fragment,p),d=!1},d(p){p&&ne(e),Je(l),Je(f)}}}function ZKe(t){let e,n,r,i,s=t[1],o=[];for(let c=0;c<s.length;c+=1)o[c]=IY(MY(t,s,c));const a=c=>be(o[c],1,1,()=>{o[c]=null});let l=t[3]&&NY(t);return{c(){e=oe("div");for(let c=0;c<o.length;c+=1)o[c].c();n=Oe(),l&&l.c(),r=Ki(),H(e,"class","actions")},m(c,u){ie(c,e,u);for(let h=0;h<o.length;h+=1)o[h].m(e,null);ie(c,n,u),l&&l.m(c,u),ie(c,r,u),i=!0},p(c,[u]){if(u&35){s=c[1];let h;for(h=0;h<s.length;h+=1){const f=MY(c,s,h);o[h]?(o[h].p(f,u),ve(o[h],1)):(o[h]=IY(f),o[h].c(),ve(o[h],1),o[h].m(e,null))}for(Bn(),h=s.length;h<o.length;h+=1)a(h);zn()}c[3]?l?(l.p(c,u),u&8&&ve(l,1)):(l=NY(c),l.c(),ve(l,1),l.m(r.parentNode,r)):l&&(Bn(),be(l,1,1,()=>{l=null}),zn())},i(c){if(!i){for(let u=0;u<s.length;u+=1)ve(o[u]);ve(l),i=!0}},o(c){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)be(o[u]);be(l),i=!1},d(c){c&&ne(e),Yr(o,c),c&&ne(n),l&&l.d(c),c&&ne(r)}}}function JKe(t,e,n){let{provider:r}=e,{actions:i}=e,{selected:s}=e;const o=Pa();let a="",l=!1;async function c(){if(a==="delete")for(const d of s)await r.delete(d);else o("action",[a,s]);n(3,l=!1),n(0,s=[]),o("selected",s)}function u(d,p){n(2,a=d),!(!a||s.length===0)&&(p?n(3,l=!0):c())}const h=(d,p)=>u(d,p),f=()=>{n(3,l=!1)};return t.$$set=d=>{"provider"in d&&n(6,r=d.provider),"actions"in d&&n(1,i=d.actions),"selected"in d&&n(0,s=d.selected)},[s,i,a,l,c,u,r,h,f]}class QKe extends Kt{constructor(e){super();Xt(this,e,JKe,ZKe,Gt,{provider:6,actions:1,selected:0})}}function $Y(t){let e,n,r;function i(o){t[11](o)}let s={provider:t[1],actions:t[2]};return t[0]!==void 0&&(s.selected=t[0]),e=new QKe({props:s}),Ur.push(()=>Nl(e,"selected",i)),e.$on("selected",t[12]),e.$on("action",t[13]),{c(){et(e.$$.fragment)},m(o,a){Ze(e,o,a),r=!0},p(o,a){const l={};a&2&&(l.provider=o[1]),a&4&&(l.actions=o[2]),!n&&a&1&&(n=!0,l.selected=o[0],Il(()=>n=!1)),e.$set(l)},i(o){r||(ve(e.$$.fragment,o),r=!0)},o(o){be(e.$$.fragment,o),r=!1},d(o){Je(e,o)}}}function eYe(t){let e,n;return{c(){e=Zr("svg"),n=Zr("path"),H(n,"stroke-linecap","round"),H(n,"stroke-linejoin","round"),H(n,"stroke-width","2"),H(n,"d","M15 19l-7-7 7-7"),H(e,"xmlns","http://www.w3.org/2000/svg"),H(e,"class","h-3 w-3"),H(e,"fill","none"),H(e,"viewBox","0 0 24 24"),H(e,"stroke","currentColor")},m(r,i){ie(r,e,i),X(e,n)},d(r){r&&ne(e)}}}function tYe(t){let e,n;return{c(){e=Zr("svg"),n=Zr("path"),H(n,"stroke-linecap","round"),H(n,"stroke-linejoin","round"),H(n,"stroke-width","2"),H(n,"d","M9 5l7 7-7 7"),H(e,"xmlns","http://www.w3.org/2000/svg"),H(e,"class","h-3 w-3"),H(e,"fill","none"),H(e,"viewBox","0 0 24 24"),H(e,"stroke","currentColor")},m(r,i){ie(r,e,i),X(e,n)},d(r){r&&ne(e)}}}function nYe(t){let e,n,r,i,s,o,a,l,c,u,h,f,d,p,m,v,y,w,x,_,S,T,E,k,A,M=t[2].length>0&&t[0].length>0&&$Y(t);return l=new AY({props:{size:"small",options:["10","20","50","all"],value:t[5].toString()}}),l.$on("change",t[14]),y=new ui({props:{round:!0,disabled:t[3]===1,$$slots:{default:[eYe]},$$scope:{ctx:t}}}),y.$on("click",t[15]),T=new ui({props:{round:!0,disabled:t[3]===t[6],$$slots:{default:[tYe]},$$scope:{ctx:t}}}),T.$on("click",t[17]),{c(){e=oe("div"),n=oe("div"),M&&M.c(),r=Oe(),i=oe("div"),s=oe("div"),o=Ie(`Items per page:
      `),a=oe("div"),et(l.$$.fragment),c=Oe(),u=oe("div"),h=Ie(t[7]),f=Ie("-"),d=Ie(t[8]),p=Ie(" of "),m=Ie(t[4]),v=Oe(),et(y.$$.fragment),w=Oe(),x=oe("input"),S=Oe(),et(T.$$.fragment),H(n,"class","actions"),H(a,"class","w-12 ml-2"),H(s,"class","flex items-center mx-4"),H(u,"class","mx-3"),H(x,"class","marcelle w-8 rounded mr-1 mb-1 bg-white text-gray-600 border border-solid border-gray-300 text-center focus:outline-none focus:ring-blue-400 focus:ring-2 focus:ring-opacity-50 active:ring-blue-400 active:ring-4 active:ring-opacity-50"),x.value=_=t[3].toString(),H(i,"class","flex items-center"),H(e,"class","table-footer svelte-1fzvvm0")},m(D,P){ie(D,e,P),X(e,n),M&&M.m(n,null),X(e,r),X(e,i),X(i,s),X(s,o),X(s,a),Ze(l,a,null),X(i,c),X(i,u),X(u,h),X(u,f),X(u,d),X(u,p),X(u,m),X(i,v),Ze(y,i,null),X(i,w),X(i,x),X(i,S),Ze(T,i,null),E=!0,k||(A=Ln(x,"blur",t[16]),k=!0)},p(D,[P]){D[2].length>0&&D[0].length>0?M?(M.p(D,P),P&5&&ve(M,1)):(M=$Y(D),M.c(),ve(M,1),M.m(n,null)):M&&(Bn(),be(M,1,1,()=>{M=null}),zn());const N={};P&32&&(N.value=D[5].toString()),l.$set(N),(!E||P&128)&&zt(h,D[7]),(!E||P&256)&&zt(d,D[8]),(!E||P&16)&&zt(m,D[4]);const R={};P&8&&(R.disabled=D[3]===1),P&262144&&(R.$$scope={dirty:P,ctx:D}),y.$set(R),(!E||P&8&&_!==(_=D[3].toString())&&x.value!==_)&&(x.value=_);const F={};P&72&&(F.disabled=D[3]===D[6]),P&262144&&(F.$$scope={dirty:P,ctx:D}),T.$set(F)},i(D){E||(ve(M),ve(l.$$.fragment,D),ve(y.$$.fragment,D),ve(T.$$.fragment,D),E=!0)},o(D){be(M),be(l.$$.fragment,D),be(y.$$.fragment,D),be(T.$$.fragment,D),E=!1},d(D){D&&ne(e),M&&M.d(),Je(l),Je(y),Je(T),k=!1,A()}}}function rYe(t,e,n){let r,{provider:i}=e,{actions:s}=e,{selected:o}=e,a=1,l=1,c=0,u=0,h=0,f=mc;function d(S){n(3,a=S),i.page(S)}function p(S){o=S,n(0,o)}function m(S){Sk.call(this,t,S)}function v(S){Sk.call(this,t,S)}const y=({detail:S})=>{const T=S==="all"?h:parseInt(S);i.paginate(T),n(5,r=T)},w=()=>{d(a-1)},x=S=>{let T=parseInt(S.currentTarget.value);isNaN(T)||d(Math.max(1,Math.min(l,T)))},_=()=>{d(a+1)};return t.$$set=S=>{"provider"in S&&n(1,i=S.provider),"actions"in S&&n(2,s=S.actions),"selected"in S&&n(0,o=S.selected)},t.$$.update=()=>{t.$$.dirty&2&&n(5,r=i.options.itemsPerPage),t.$$.dirty&1082&&(f(),n(10,f=i.total.subscribe(S=>{S===void 0||S===0?(n(6,l=1),n(7,c=0),n(8,u=0),n(4,h=0)):(n(6,l=Math.ceil(h/r)),n(7,c=(a-1)*r+1),n(8,u=Math.min(h||0,a*r)),n(4,h=S))})))},[o,i,s,a,h,r,l,c,u,d,f,p,m,v,y,w,x,_]}class iYe extends Kt{constructor(e){super();Xt(this,e,rYe,nYe,Gt,{provider:1,actions:2,selected:0})}}function RY(t,e,n){const r=t.slice();return r[22]=e[n],r[24]=n,r}function DY(t,e,n){const r=t.slice();return r[25]=e[n].type,r[26]=e[n].name,r}function PY(t,e,n){const r=t.slice();return r[26]=e[n].name,r[29]=e[n].sortable,r}function OY(t){let e,n,r,i,s,o,a,l;return{c(){e=oe("div"),n=oe("sl-alert"),r=oe("sl-icon"),i=Oe(),s=oe("strong"),s.textContent="Table Data Error",o=oe("br"),a=Oe(),l=Ie(t[9]),Gv(r,"slot","icon"),Gv(r,"name","check2-circle"),Gv(n,"type","danger"),Gv(n,"open",""),H(e,"class","service-error")},m(c,u){ie(c,e,u),X(e,n),X(n,r),X(n,i),X(n,s),X(n,o),X(n,a),X(n,l)},p(c,u){u[0]&512&&zt(l,c[9])},d(c){c&&ne(e)}}}function FY(t){let e,n=!t[4]&&LY(t);return{c(){e=oe("th"),n&&n.c(),H(e,"class","svelte-945jt4")},m(r,i){ie(r,e,i),n&&n.m(e,null)},p(r,i){r[4]?n&&(n.d(1),n=null):n?n.p(r,i):(n=LY(r),n.c(),n.m(e,null))},d(r){r&&ne(e),n&&n.d()}}}function LY(t){let e,n,r,i;return{c(){e=oe("input"),H(e,"type","checkbox"),e.checked=n=t[6].length>0&&t[6].length===t[10].length},m(s,o){ie(s,e,o),r||(i=Ln(e,"click",t[12]),r=!0)},p(s,o){o[0]&1088&&n!==(n=s[6].length>0&&s[6].length===s[10].length)&&(e.checked=n)},d(s){s&&ne(e),r=!1,i()}}}function BY(t){let e,n;return e=new GKe({props:{name:t[26],sortable:t[29],sorting:t[7]}}),e.$on("sort",t[11]),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,i){const s={};i[0]&1&&(s.name=r[26]),i[0]&1&&(s.sortable=r[29]),i[0]&128&&(s.sorting=r[7]),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function zY(t){let e,n;return e=new SY({props:{type:"slot",$$slots:{default:[sYe]},$$scope:{ctx:t}}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,i){const s={};i[0]&64|i[1]&2&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function sYe(t){let e,n,r,i;function s(...o){return t[16](t[24],...o)}return{c(){e=oe("input"),H(e,"type","checkbox"),e.checked=n=t[6].includes(t[24])},m(o,a){ie(o,e,a),r||(i=Ln(e,"click",s),r=!0)},p(o,a){t=o,a[0]&64&&n!==(n=t[6].includes(t[24]))&&(e.checked=n)},d(o){o&&ne(e),r=!1,i()}}}function VY(t){let e,n;function r(...i){return t[17](t[24],...i)}return e=new SY({props:{type:t[25],value:t[22][t[26]]}}),e.$on("action",r),{c(){et(e.$$.fragment)},m(i,s){Ze(e,i,s),n=!0},p(i,s){t=i;const o={};s[0]&1&&(o.type=t[25]),s[0]&1025&&(o.value=t[22][t[26]]),e.$set(o)},i(i){n||(ve(e.$$.fragment,i),n=!0)},o(i){be(e.$$.fragment,i),n=!1},d(i){Je(e,i)}}}function UY(t){let e,n,r,i,s=t[3]&&zY(t),o=t[0],a=[];for(let c=0;c<o.length;c+=1)a[c]=VY(DY(t,o,c));const l=c=>be(a[c],1,1,()=>{a[c]=null});return{c(){e=oe("tr"),s&&s.c(),n=Oe();for(let c=0;c<a.length;c+=1)a[c].c();r=Oe(),H(e,"class","svelte-945jt4")},m(c,u){ie(c,e,u),s&&s.m(e,null),X(e,n);for(let h=0;h<a.length;h+=1)a[h].m(e,null);X(e,r),i=!0},p(c,u){if(c[3]?s?(s.p(c,u),u[0]&8&&ve(s,1)):(s=zY(c),s.c(),ve(s,1),s.m(e,n)):s&&(Bn(),be(s,1,1,()=>{s=null}),zn()),u[0]&17409){o=c[0];let h;for(h=0;h<o.length;h+=1){const f=DY(c,o,h);a[h]?(a[h].p(f,u),ve(a[h],1)):(a[h]=VY(f),a[h].c(),ve(a[h],1),a[h].m(e,r))}for(Bn(),h=o.length;h<a.length;h+=1)l(h);zn()}},i(c){if(!i){ve(s);for(let u=0;u<o.length;u+=1)ve(a[u]);i=!0}},o(c){be(s),a=a.filter(Boolean);for(let u=0;u<a.length;u+=1)be(a[u]);i=!1},d(c){c&&ne(e),s&&s.d(),Yr(a,c)}}}function oYe(t){let e,n,r,i,s,o,a,l,c,u,h,f,d=t[9]&&OY(t),p=t[3]&&FY(t),m=t[0],v=[];for(let E=0;E<m.length;E+=1)v[E]=BY(PY(t,m,E));const y=E=>be(v[E],1,1,()=>{v[E]=null});let w=t[10],x=[];for(let E=0;E<w.length;E+=1)x[E]=UY(RY(t,w,E));const _=E=>be(x[E],1,1,()=>{x[E]=null});function S(E){t[18](E)}let T={provider:t[1],actions:t[2]};return t[6]!==void 0&&(T.selected=t[6]),u=new iYe({props:T}),Ur.push(()=>Nl(u,"selected",S)),u.$on("action",t[19]),{c(){d&&d.c(),e=Oe(),n=oe("div"),r=oe("table"),i=oe("thead"),s=oe("tr"),p&&p.c(),o=Oe();for(let E=0;E<v.length;E+=1)v[E].c();a=Oe(),l=oe("tbody");for(let E=0;E<x.length;E+=1)x[E].c();c=Oe(),et(u.$$.fragment),H(s,"class","svelte-945jt4"),H(i,"class","svelte-945jt4"),H(l,"class","svelte-945jt4"),H(r,"class","svelte-945jt4"),H(n,"class","marcelle table-container svelte-945jt4")},m(E,k){d&&d.m(E,k),ie(E,e,k),ie(E,n,k),X(n,r),X(r,i),X(i,s),p&&p.m(s,null),X(s,o);for(let A=0;A<v.length;A+=1)v[A].m(s,null);X(r,a),X(r,l);for(let A=0;A<x.length;A+=1)x[A].m(l,null);X(n,c),Ze(u,n,null),f=!0},p(E,k){if(E[9]?d?d.p(E,k):(d=OY(E),d.c(),d.m(e.parentNode,e)):d&&(d.d(1),d=null),E[3]?p?p.p(E,k):(p=FY(E),p.c(),p.m(s,o)):p&&(p.d(1),p=null),k[0]&2177){m=E[0];let M;for(M=0;M<m.length;M+=1){const D=PY(E,m,M);v[M]?(v[M].p(D,k),ve(v[M],1)):(v[M]=BY(D),v[M].c(),ve(v[M],1),v[M].m(s,null))}for(Bn(),M=m.length;M<v.length;M+=1)y(M);zn()}if(k[0]&25673){w=E[10];let M;for(M=0;M<w.length;M+=1){const D=RY(E,w,M);x[M]?(x[M].p(D,k),ve(x[M],1)):(x[M]=UY(D),x[M].c(),ve(x[M],1),x[M].m(l,null))}for(Bn(),M=w.length;M<x.length;M+=1)_(M);zn()}const A={};k[0]&2&&(A.provider=E[1]),k[0]&4&&(A.actions=E[2]),!h&&k[0]&64&&(h=!0,A.selected=E[6],Il(()=>h=!1)),u.$set(A)},i(E){if(!f){for(let k=0;k<m.length;k+=1)ve(v[k]);for(let k=0;k<w.length;k+=1)ve(x[k]);ve(u.$$.fragment,E),f=!0}},o(E){v=v.filter(Boolean);for(let k=0;k<v.length;k+=1)be(v[k]);x=x.filter(Boolean);for(let k=0;k<x.length;k+=1)be(x[k]);be(u.$$.fragment,E),f=!1},d(E){d&&d.d(E),E&&ne(e),E&&ne(n),p&&p.d(),Yr(v,E),Yr(x,E),Je(u)}}}function aYe(t,e,n){let r,i,s,o=Ge,a=()=>(o(),o=_r(i,N=>n(9,s=N)),i),l,c=Ge,u=()=>(c(),c=_r(r,N=>n(10,l=N)),r);t.$$.on_destroy.push(()=>o()),t.$$.on_destroy.push(()=>c());let{columns:h}=e,{provider:f}=e,{actions:d=[]}=e,{selectable:p=!0}=e,{singleSelection:m=!1}=e,{selection:v=[]}=e,y=[];const w=Pa();let x={col:"",ascending:!0};function _({detail:N}){n(7,x=N),f.sort(N)}async function S(){n(15,v=await Promise.all(y.map(f.get.bind(f)))),w("selection",v)}function T(){y.length===Ux(r).length?n(6,y=[]):n(6,y=Ux(r).map((N,R)=>R)),S()}function E(N,R){m?(n(6,y=R.currentTarget.checked?[N]:[]),S()):R.currentTarget.checked?y.includes(N)||(n(6,y=y.concat([N])),S()):(n(6,y=y.filter(F=>F!==N)),S())}async function k([N,R]){const F=Array.isArray(R)?await Promise.all(R.map(f.get.bind(f))):await f.get(R);w(N,F)}const A=(N,R)=>E(N,R),M=(N,{detail:R})=>{k([R,N])};function D(N){y=N,n(6,y),n(15,v),n(5,r),n(1,f)}const P=({detail:N})=>k(N);return t.$$set=N=>{"columns"in N&&n(0,h=N.columns),"provider"in N&&n(1,f=N.provider),"actions"in N&&n(2,d=N.actions),"selectable"in N&&n(3,p=N.selectable),"singleSelection"in N&&n(4,m=N.singleSelection),"selection"in N&&n(15,v=N.selection)},t.$$.update=()=>{t.$$.dirty[0]&2&&u(n(5,r=f.data)),t.$$.dirty[0]&2&&a(n(8,i=f.error)),t.$$.dirty[0]&32800&&n(6,y=v.map(N=>Ux(r).indexOf(N)))},[h,f,d,p,m,r,y,x,i,s,l,_,T,E,k,v,A,M,D,P]}class WY extends Kt{constructor(e){super();Xt(this,e,aYe,oYe,Gt,{columns:0,provider:1,actions:2,selectable:3,singleSelection:4,selection:15},[-1,-1])}}function lYe(t){let e;return{c(){e=oe("canvas"),H(e,"class","w-full max-w-full")},m(n,r){ie(n,e,r),t[3](e)},p:Ge,d(n){n&&ne(e),t[3](null)}}}function cYe(t){let e,n;return e=new Rs({props:{title:t[0],$$slots:{default:[lYe]},$$scope:{ctx:t}}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,[i]){const s={};i&1&&(s.title=r[0]),i&34&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function uYe(t,e,n){let{title:r}=e,{imageStream:i}=e,s,o=mc;Da(async()=>{await Ns(),await Ns();const l=s.getContext("2d");o=i.subscribe(c=>{if(!(Array.isArray(c)&&c.length===0)){if(c instanceof ImageData)n(1,s.width=c.width,s),n(1,s.height=c.height,s),l.putImageData(c,0,0);else if(Array.isArray(c))throw new Error("This component does not yet support multiple images")}})}),Wh(()=>{o()});function a(l){Ur[l?"unshift":"push"](()=>{s=l,n(1,s)})}return t.$$set=l=>{"title"in l&&n(0,r=l.title),"imageStream"in l&&n(2,i=l.imageStream)},[r,s,i,a]}class hYe extends Kt{constructor(e){super();Xt(this,e,uYe,cYe,Gt,{title:0,imageStream:2})}get title(){return this.$$.ctx[0]}set title(e){this.$set({title:e}),qd()}get imageStream(){return this.$$.ctx[2]}set imageStream(e){this.$set({imageStream:e}),qd()}}var Pk;class fYe extends $s{constructor(e){super();this.title="image display",Pk.set(this,void 0),yn(this,Pk,e,"f")}mount(e){const n=e||document.querySelector(`#${this.id}`);!n||(this.destroy(),this.$$.app=new hYe({target:n,props:{title:this.title,imageStream:Ee(this,Pk,"f")}}))}}Pk=new WeakMap;function dtt(t){return new fYe(t)}function dYe(t,e){return t.map((n,r)=>Math.abs(n-e[r])**2).reduce((n,r)=>n+r)**(1/2)}class AO extends bu{constructor(r={}){var i=r,{k:e=3}=i,n=ja(i,["k"]);super(n);this.title="k-means clustering",this.serviceName="kmeans-clusering-models",this.parameters={k:new Ue(e,!0)},this.$centers=new Ue([],!1),this.$clusters=new Ue([],!1),this.dataset=[],this.start()}async train(e){this.$training.set({status:"start",epochs:1});const n=Zd(e)?e.items():e;for await(const{x:i}of n)this.dataset.push(i[0]);const r=zGe(this.dataset,this.parameters.k.value);this.$centers.set(r.centroids.map(i=>i.centroid)),this.$clusters.set(r.clusters),this.$training.set({status:"success"})}async predict(e){let n=0,r=1e3;const i={};let s=0;for(let o=0;o<this.$centers.value.length;o++){const a=dYe(this.$centers.value[o],e[0]);a<r&&(r=a,n=o),i[`${o}`]=Math.exp(a),s+=Math.exp(a)}if(Object.entries(i).forEach(([o])=>{i[o]/=s}),this.$centers.value.length===0){const o=new Error("KMeans is not trained");o.name="[KMeans] Prediction Error",Fa(o)}return{cluster:n,confidences:i}}async batchPredict(e){const n=[],r=Zd(e)?e.items():e;for await(const{x:s}of r)n.push(s);const i=[];for(let s=0;s<n.length;s++)this.predict(n[s]).then(o=>i.push(o));if(this.$centers.value.length===0){const s=new Error("KMeans is not trained");s.name="[KMeans] Prediction Error",Fa(s)}return i}async save(e,n,r=null){const i=await this.write(n);return i.name=e,this.saveToDatastore(i,r)}async load(e){const n=await this.loadFromDatastore(e);return await this.read(n),n}async download(e){const n=await this.write(e);Kv(JSON.stringify(n),`${n.name}.json`,"text/plain")}async upload(...e){const n=e.filter(i=>i.name.includes(".json")),r=await new Promise((i,s)=>{const o=new FileReader;o.onload=()=>{const a=JSON.parse(o.result);i(a)},o.onerror=s,o.readAsText(n[0])});return await this.read(r),r}async write(e={}){return{name:this.syncModelName||e1(this.title),files:[],format:"ml-kmeans",metadata:Bt({clusters:this.$clusters.value,centers:this.$centers.value},e)}}async read(e){const n=e.metadata.data;if(!n)return;const r={};Object.entries(n).forEach(([i,s])=>{r[i]=s}),this.$clusters.set(e.metadata.labels),this.$training.set({status:"loaded"})}}sn([En],AO.prototype,"train",null);sn([En],AO.prototype,"predict",null);sn([En],AO.prototype,"batchPredict",null);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pYe=1e-7,mYe=1e-4;class gYe{refCount(e){return Ba("refCount")}incRef(e){return Ba("incRef")}timerAvailable(){return!0}time(e){return Ba("time")}read(e){return Ba("read")}readSync(e){return Ba("readSync")}numDataIds(){return Ba("numDataIds")}disposeData(e,n){return Ba("disposeData")}write(e,n,r){return Ba("write")}move(e,n,r,i,s){return Ba("move")}memory(){return Ba("memory")}floatPrecision(){return Ba("floatPrecision")}epsilon(){return this.floatPrecision()===32?pYe:mYe}dispose(){return Ba("dispose")}}function Ba(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ci(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function Ok(t,e=[],n=!1){if(e==null&&(e=[]),Array.isArray(t)||yc(t)&&!n)for(let r=0;r<t.length;++r)Ok(t[r],e,n);else e.push(t);return e}function ey(t){if(t.length===0)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function GY(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function vYe(t){return t%1==0}function Fk(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function yYe(t,e){const n=e.length;return t=t==null?e.map((r,i)=>i):[].concat(t),Ci(t.every(r=>r>=-n&&r<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`),Ci(t.every(r=>vYe(r)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(r=>r<0?n+r:r)}function bYe(t,e){for(let n=0;n<t.length;n++){const r=t[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function wYe(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function yc(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}function HY(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function xYe(t){if(t==null)return 0;let e=0;return t.forEach(n=>e+=n.length),e}function MO(t){return typeof t=="string"||t instanceof String}function _Ye(t){return typeof t=="boolean"}function SYe(t){return typeof t=="number"}function IO(t){return Array.isArray(t)?IO(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":SYe(t)?"float32":MO(t)?"string":_Ye(t)?"bool":"float32"}function jY(t){return!!(t&&t.constructor&&t.call&&t.apply)}function qY(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function XY(t,e,n,r=!1){const i=new Array;if(e.length===1){const s=e[0]*(r?2:1);for(let o=0;o<s;o++)i[o]=n[t+o]}else{const s=e[0],o=e.slice(1),a=o.reduce((l,c)=>l*c)*(r?2:1);for(let l=0;l<s;l++)i[l]=XY(t+l*a,o,n,r)}return i}function KY(t,e,n=!1){if(t.length===0)return e[0];const r=t.reduce((i,s)=>i*s)*(n?2:1);if(r===0)return[];if(r!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return XY(0,t,e,n)}function CYe(t,e){const n=YY(t,e);for(let r=0;r<n.length;r++)n[r]=1;return n}function YY(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function TYe(t){t.forEach(e=>{Ci(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function ZY(t){return t&&t.then&&typeof t.then=="function"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qd(...t){Hh().getBool("IS_TEST")||Hh().getBool("PROD")||console.warn(...t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JY="tfjsflags";class EYe{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=kYe,this.populateURLFlags()}setPlatform(e,n){this.platform!=null&&Qd(`Platform ${this.platformName} has already been set. Overwriting the platform with ${n}.`),this.platformName=e,this.platform=n}registerFlag(e,n,r){if(this.flagRegistry[e]={evaluationFn:n,setHook:r},this.urlFlags[e]!=null){const i=this.urlFlags[e];Qd(`Setting feature override from URL ${e}: ${i}.`),this.set(e,i)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const n=this.evaluateFlag(e);if(ZY(n))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=n,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,n){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global=="undefined"||typeof this.global.location=="undefined"||typeof this.global.location.search=="undefined")return;const e=this.getQueryParams(this.global.location.search);JY in e&&e[JY].split(",").forEach(r=>{const[i,s]=r.split(":");this.urlFlags[i]=MYe(i,s)})}}function kYe(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...r)=>(AYe(e,r[0],r[1]),r.join("="))),e}function AYe(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function MYe(t,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if(`${+e}`===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${t}.`)}function Hh(){return QY}let QY=null;function IYe(t){QY=t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let NO;function eZ(){if(NO==null){let t;if(typeof window!="undefined")t=window;else if(typeof global!="undefined")t=global;else if(typeof process!="undefined")t=process;else if(typeof self!="undefined")t=self;else throw new Error("Could not find a global object");NO=t}return NO}function NYe(){const t=eZ();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function $O(t,e){const n=NYe();if(n.has(t))return n.get(t);{const r=e();return n.set(t,r),n.get(t)}}const $Ye="Abs",RYe="Add",DYe="ArgMax",PYe="BatchMatMul",tZ="Cast",OYe="ComplexAbs",FYe="Concat",LYe="ExpandDims",BYe="GatherV2",nZ="Identity",zYe="Max",VYe="Min",UYe="Multiply",WYe="Pow",GYe="Reshape",HYe="Sqrt",jYe="Sum";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rZ=$O("kernelRegistry",()=>new Map),qYe=$O("gradRegistry",()=>new Map);function iZ(t,e){const n=XYe(t,e);return rZ.get(n)}function sZ(t){return qYe.get(t)}function oZ(t){const e=rZ.entries(),n=[];for(;;){const{done:r,value:i}=e.next();if(r)break;const[s,o]=i,[a]=s.split("_");a===t&&n.push(o)}return n}function XYe(t,e){return`${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KYe(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function aZ(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Ok(t)),Hh().getBool("DEBUG")&&bYe(t,e),KYe(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){const n=new Uint8Array(t.length);for(let r=0;r<n.length;++r)Math.round(t[r])!==0&&(n[r]=1);return n}else throw new Error(`Unknown data type ${e}`)}function Lk(){return Hh().platform.now()}function YYe(t,e="utf-8"){return e=e||"utf-8",Hh().platform.encode(t,e)}function lZ(t,e="utf-8"){return e=e||"utf-8",Hh().platform.decode(t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZYe{constructor(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new QYe)}profileKernel(e,n,r){let i;const s=()=>{i=r()};let o;const a=Lk();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(s);else{s();for(const c of i)c.dataSync();o=Promise.resolve({kernelMs:Lk()-a})}if(Hh().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<i.length;c++){const u=i[c];u.data().then(h=>{JYe(h,u.dtype,e)})}return{kernelName:e,outputs:i,inputs:n,timeMs:o.then(c=>c.kernelMs),extraInfo:o.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:n,outputs:r,timeMs:i,inputs:s,extraInfo:o}=e;r.forEach(a=>{Promise.all([a.data(),i,o]).then(l=>{this.logger.logKernelProfile(n,a,l[0],l[1],s,l[2])})})}}function JYe(t,e,n){if(e!=="float32")return!1;for(let r=0;r<t.length;r++){const i=t[r];if(isNaN(i)||!isFinite(i))return console.warn(`Found ${i} in the result of '${n}'`),!0}return!1}class QYe{logKernelProfile(e,n,r,i,s,o){const a=typeof i=="number"?Fk(`${i}ms`,9):i.error,l=Fk(e,25),c=n.rank,u=n.size,h=Fk(n.shape.toString(),14);let f="";for(const d in s){const p=s[d];if(p!=null){const m=p.shape||n.shape,v=m.length;f+=`${d}: ${v}D ${v>0?m:""} `}}console.log(`%c${l}	%c${a}	%c${c}D ${h}	%c${u}	%c${f}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eZe(t,e,n){const r={},i={};for(let l=0;l<e.length;l++)r[e[l].id]=!0;for(let l=0;l<t.length;l++){const c=t[l],u=c.inputs;for(const h in u){const f=u[h];let d=!1;for(let p=0;p<e.length;p++)if(r[f.id]){c.outputs.forEach(m=>r[m.id]=!0),d=!0,i[c.id]=!0;break}if(d)break}}const s={};s[n.id]=!0;const o={};for(let l=t.length-1;l>=0;l--){const c=t[l],u=c.inputs;for(let h=0;h<c.outputs.length;h++)if(s[c.outputs[h].id]){for(const f in u)s[u[f].id]=!0,o[c.id]=!0;break}}const a=[];for(let l=0;l<t.length;l++){const c=t[l];if(i[c.id]&&o[c.id]){const u={};for(const f in c.inputs){const d=c.inputs[f];r[d.id]&&(u[f]=d)}const h=Object.assign({},c);h.inputs=u,h.outputs=c.outputs,a.push(h)}}return a}function tZe(t,e,n,r){for(let i=e.length-1;i>=0;i--){const s=e[i],o=[];if(s.outputs.forEach(l=>{const c=t[l.id];c!=null?o.push(c):o.push(null)}),s.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);const a=s.gradient(o);for(const l in s.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const c=n(()=>a[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);const u=s.inputs[l];if(!GY(c.shape,u.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${u.shape}'`);if(t[u.id]==null)t[u.id]=c;else{const h=t[u.id];t[u.id]=r(h,c),h.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cZ=20,o1=3,RO=7;function nZe(t,e,n,r){const i=qY(e),s=rZe(t,e,n,i),o=e.length,a=Bk(t,e,n,i,s),l=["Tensor"];return r&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(c=>"    "+c).join(`
`)),l.join(`
`)}function rZe(t,e,n,r){const i=ey(e),s=r[r.length-1],o=new Array(s).fill(0),a=e.length,l=n==="complex64"?l1(t):t;if(a>1)for(let c=0;c<i/s;c++){const u=c*s;for(let h=0;h<s;h++)o[h]=Math.max(o[h],a1(l[u+h],0,n).length)}return o}function a1(t,e,n){let r;return Array.isArray(t)?r=`${parseFloat(t[0].toFixed(RO))} + ${parseFloat(t[1].toFixed(RO))}j`:MO(t)?r=`'${t}'`:n==="bool"?r=uZ(t):r=parseFloat(t.toFixed(RO)).toString(),Fk(r,e)}function uZ(t){return t===0?"false":"true"}function Bk(t,e,n,r,i,s=!0){const o=n==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(n==="complex64"){const m=l1(t);return[a1(m[0],0,n)]}return n==="bool"?[uZ(t[0])]:[t[0].toString()]}if(l===1){if(a>cZ){const v=o1*o;let y=Array.from(t.slice(0,v)),w=Array.from(t.slice((a-o1)*o,a*o));return n==="complex64"&&(y=l1(y),w=l1(w)),["["+y.map((x,_)=>a1(x,i[_],n)).join(", ")+", ..., "+w.map((x,_)=>a1(x,i[a-o1+_],n)).join(", ")+"]"]}const m=n==="complex64"?l1(t):Array.from(t);return["["+m.map((v,y)=>a1(v,i[y],n)).join(", ")+"]"]}const c=e.slice(1),u=r.slice(1),h=r[0]*o,f=[];if(a>cZ){for(let m=0;m<o1;m++){const v=m*h,y=v+h;f.push(...Bk(t.slice(v,y),c,n,u,i,!1))}f.push("...");for(let m=a-o1;m<a;m++){const v=m*h,y=v+h;f.push(...Bk(t.slice(v,y),c,n,u,i,m===a-1))}}else for(let m=0;m<a;m++){const v=m*h,y=v+h;f.push(...Bk(t.slice(v,y),c,n,u,i,m===a-1))}const d=l===2?",":"";f[0]="["+f[0]+d;for(let m=1;m<f.length-1;m++)f[m]=" "+f[m]+d;let p=`,
`;for(let m=2;m<l;m++)p+=`
`;return f[f.length-1]=" "+f[f.length-1]+"]"+(s?"":p),f}function l1(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let xu=null,c1=null;function iZe(t){xu=t}class Ko{constructor(e,n,r,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=ey(e),this.strides=qY(e),this.dataId=r,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return c1.buffer(this.shape,this.dtype,e)}bufferSync(){return c1.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return KY(this.shape,e,this.dtype==="complex64")}arraySync(){return KY(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=xu().read(this.dataId);if(this.dtype==="string"){const n=await e;try{return n.map(r=>lZ(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataSync(){this.throwIfDisposed();const e=xu().readSync(this.dataId);if(this.dtype==="string")try{return e.map(n=>lZ(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await xu().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(xu().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return c1.print(this,e)}clone(){return this.throwIfDisposed(),c1.clone(this)}toString(e=!1){const n=this.dataSync();return nZe(n,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),c1.cast(this,e)}variable(e=!0,n,r){return this.throwIfDisposed(),xu().makeVariable(this,e,n,r)}}Object.defineProperty(Ko,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function za(){return $O("Tensor",()=>Ko)}za();class DO extends Ko{constructor(e,n,r,i){super(e.shape,e.dtype,e.dataId,i);this.trainable=n,this.name=r}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!GY(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);xu().disposeTensor(this),this.dataId=e.dataId,xu().incRef(this,null)}dispose(){xu().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(DO,Symbol.hasInstance,{value:t=>t instanceof Ko&&t.assign!=null&&t.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var hZ;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})(hZ||(hZ={}));var PO;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(PO||(PO={}));var OO;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})(OO||(OO={}));var FO;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(FO||(FO={}));var LO;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(LO||(LO={}));const sZe={float32:FO,int32:PO,bool:OO,complex64:LO};function oZe(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return sZe[t][e]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BO(t,e){if(t.dtype===e.dtype)return[t,e];const n=oZe(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function aZe(t){const e=[],n=new Set;return fZ(t,e,n),e}function fZ(t,e,n){if(t==null)return;if(t instanceof Ko){e.push(t);return}if(!lZe(t))return;const r=t;for(const i in r){const s=r[i];n.has(s)||(n.add(s),fZ(s,e,n))}}function lZe(t){return Array.isArray(t)||typeof t=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zO(t){return t.kernelName!=null}class dZ{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class ty{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new dZ}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const r=e[n];if(await this.initializeBackend(r).success){await this.setBackend(r);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:n}=this.initializeBackend(e);if(n)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,n,r=1){return e in this.registryFactory?(Qd(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:n,priority:r},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:n,asyncInit:r}=this.initializeBackend(e);if(!(r?await n:n))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new ZYe(this.backendInstance),!0}setupRegisteredKernels(){oZ(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){oZ(e).forEach(r=>{r.disposeFunc!=null&&r.disposeFunc(this.registry[e])})}initializeBackend(e){const n=this.registryFactory[e];if(n==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const r=n.factory();if(r&&!(r instanceof gYe)&&typeof r.then=="function"){const i=++this.pendingBackendInitId,s=r.then(o=>i<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(i<this.pendingBackendInitId||(this.pendingBackendInit=null,Qd(`Initialization of backend ${e} failed`),Qd(o.stack||o.message)),!1));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}else return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(r){return Qd(`Initialization of backend ${e} failed`),Qd(r.stack||r.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,n)=>this.registryFactory[n].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const r=e[n],{success:i,asyncInit:s}=this.initializeBackend(r);if(s||i)return{name:r,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,n){const r=this.state.tensorInfo.get(n),i=r.backend,s=this.readSync(n),o=i.refCount(n);i.disposeData(n,!0),r.backend=e,e.move(n,s,r.shape,r.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,n){let r=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}let i;return this.scopedRun(()=>this.startScope(r),()=>this.endScope(i),()=>(i=n(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i))}scopedRun(e,n,r){e();try{const i=r();return n(),i}catch(i){throw n(),i}}nextTensorId(){return ty.nextTensorId++}nextVariableId(){return ty.nextVariableId++}clone(e){const n=Sr.runKernel(nZ,{x:e}),r={x:e},i=o=>({x:()=>{const a="float32",l={x:o},c={dtype:a};return Sr.runKernel(tZ,l,c)}}),s=[];return this.addTapeNode(this.state.activeScope.name,r,[n],i,s,{}),n}runKernel(e,n,r){if(this.backendName==null&&this.backend,!(iZ(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:n,attrs:r})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,n,r){const i=this.backend.numDataIds();let s=0;r.forEach(l=>{s+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=i-n-s-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let n,r=[];const i=this.isTapeOn(),s=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const c=zO(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(zO(e)){const{kernelName:p,inputs:m,attrs:v}=e;this.backendName==null&&this.backend;const y=iZ(p,this.backendName);Ci(y!=null,()=>`Cannot find registered kernel '${p}' for backend '${this.backendName}'`),a=()=>{const w=this.backend.numDataIds();l=y.kernelFunc({inputs:m,attrs:v,backend:this.backend});const x=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(p,w,x);const _=x.map(S=>{if(S.rank!=null)return S;const{dataId:T,shape:E,dtype:k}=S;return this.makeTensorFromDataId(T,E,k)});if(i){const S=this.getTensorsForGradient(p,m,_);r=this.saveTensorsForBackwardMode(S)}return _}}else{const{forwardFunc:p}=e,m=v=>{!i||(r=v.map(y=>this.keep(this.clone(y))))};a=()=>{const v=this.backend.numDataIds();l=this.tidy(()=>p(this.backend,m));const y=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,v,y),y}}const{inputs:u,attrs:h}=e,f=zO(e)?null:e.backwardsFunc;let d;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(d=this.profiler.profileKernel(c,u,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(d),n=d.outputs)}),i&&this.addTapeNode(c,u,n,f,r,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(u).map(p=>u[p]!=null?u[p].shape:null),outputShapes:n.map(p=>p.shape),kernelTimeMs:d.timeMs,extraInfo:d.extraInfo}),Array.isArray(l)?n:n[0]}saveTensorsForBackwardMode(e){return e.map(r=>this.keep(this.clone(r)))}getTensorsForGradient(e,n,r){const i=sZ(e);if(i!=null){const s=i.inputsToSave||[],o=i.outputsToSave||[];let a;i.saveAllInputs?(Ci(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(c=>n[c])):a=s.map(c=>n[c]);const l=r.filter((c,u)=>o[u]);return a.concat(l)}return[]}makeTensor(e,n,r,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",i=i||this.backend;let s=e;r==="string"&&MO(e[0])&&(s=e.map(l=>YYe(l)));const o=i.write(s,n,r),a=new Ko(n,r,o,this.nextTensorId());if(this.trackTensor(a,i),r==="string"){const l=this.state.tensorInfo.get(o),c=xYe(s);this.state.numBytes+=c-l.bytes,l.bytes=c}return a}makeTensorFromDataId(e,n,r,i){r=r||"float32";const s=new Ko(n,r,e,this.nextTensorId());return this.trackTensor(s,i),s}makeVariable(e,n=!0,r,i){r=r||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.cast(i));const s=new DO(e,n,r,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(e,n){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*HY(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof DO||this.track(e)}incRef(e,n){this.trackTensor(e,n),this.backend.incRef(e.dataId)}removeDataId(e,n){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===n&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const n=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const r=e.size*HY(e.dtype);this.state.numBytes-=r}n.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,n.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const n=this.state.registeredVariables[e];this.disposeVariable(n)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const n=this.state.numBytes,r=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(i=>i.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r;for(const i of this.state.activeProfile.kernels)i.kernelTimeMs=await i.kernelTimeMs,i.extraInfo=await i.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,n,r,i,s,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:r,saved:s},l=sZ(e);l!=null&&(i=l.gradFunc),i!=null&&(a.gradient=c=>(c=c.map((u,h)=>{if(u==null){const f=r[h],d=YY(f.size,f.dtype);return this.makeTensor(d,f.shape,f.dtype)}return u}),i(c.length>1?c:c[0],s,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(e){const n=aZe(e),r=new Set(n.map(s=>s.id));for(let s=0;s<this.state.activeScope.track.length;s++){const o=this.state.activeScope.track[s];!o.kept&&!r.has(o.id)&&o.dispose()}const i=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(s=>{!s.kept&&s.scopeId===i.id&&this.track(s)})}gradients(e,n,r,i=!1){if(Ci(n.length>0,()=>"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${r.dtype}'`);const s=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));Ci(s instanceof Ko,()=>"The result y returned by f() must be a tensor.");const o=eZe(this.state.activeTape,n,s);if(!i&&o.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[s.id]=r==null?cZe(s.shape):r,tZe(a,o,c=>this.tidy(c),hZe);const l=n.map(c=>a[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(const u of c.saved)u.dispose()}),this.state.activeTape=null),{value:s,grads:l}})}customGrad(e){return Ci(jY(e),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{Ci(n.every(a=>a instanceof Ko),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let r;const i={};n.forEach((a,l)=>{i[l]=a});const s=(a,l)=>(r=e(...n,l),Ci(r.value instanceof Ko,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),Ci(jY(r.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r.value),o=(a,l)=>{const c=r.gradFunc(a,l),u=Array.isArray(c)?c:[c];Ci(u.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),Ci(u.every(f=>f instanceof Ko),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const h={};return u.forEach((f,d)=>{h[d]=()=>f}),h};return this.runKernelFunc({forwardFunc:s,backwardsFunc:o,inputs:i})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}async time(e){const n=Lk(),r=await this.backend.time(e);return r.wallMs=Lk()-n,r}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new dZ;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}ty.nextTensorId=0;ty.nextVariableId=0;function cZe(t){const e=CYe(ey(t),"float32");return Sr.makeTensor(e,t,"float32")}function uZe(){const t=eZ();if(t._tfengine==null){const e=new EYe(t);t._tfengine=new ty(e)}return IYe(t._tfengine.ENV),iZe(()=>t._tfengine),t._tfengine}const Sr=uZe();function hZe(t,e){const n={a:t,b:e};return Sr.runKernel(RYe,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fZe(t,e){let n=t;if(yc(t))return e==="string"?[]:[t.length];if(!Array.isArray(t))return[];const r=[];for(;Array.isArray(n)||yc(n)&&e!=="string";)r.push(n.length),n=n[0];return Array.isArray(t)&&Hh().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&pZ(t,r,[]),r}function pZ(t,e,n){if(n=n||[],!Array.isArray(t)&&!yc(t)){Ci(e.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}Ci(e.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`),Ci(t.length===e[0],()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);const r=e.slice(1);for(let i=0;i<t.length;++i)pZ(t[i],r,n.concat(i))}function mZ(t,e,n,r){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${n}' passed to '${r}' must be ${t} tensor, but got ${e} tensor`)}}function hi(t,e,n,r="numeric"){if(t instanceof Ko)return mZ(r,t.dtype,e,n),t;let i=IO(t);if(i!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),mZ(r,i,e,n),t==null||!yc(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){const l=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${l}'`)}const s=fZe(t,i);!yc(t)&&!Array.isArray(t)&&(t=[t]);const a=i!=="string"?aZ(t,i):Ok(t,[],!0);return Sr.makeTensor(a,s,i)}function dZe(t,e,n,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((s,o)=>hi(s,`${e}[${o}]`,n,r))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pZe="__op";function ls(t){const e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+pZe;const i=(...s)=>{Sr.startScope(n);try{const o=r(...s);return ZY(o)&&console.error("Cannot return a Promise inside of tidy."),Sr.endScope(o),o}catch(o){throw Sr.endScope(null),o}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mZe(t,e){const r={x:hi(t,"x","reshape","string_or_numeric")},i={shape:e};return Sr.runKernel(GYe,r,i)}const u1=ls({reshape_:mZe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */za().prototype.flatten=function(){return this.throwIfDisposed(),u1(this,[this.size])};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gZe(t){const e=hi(t,"x","abs");if(e.dtype==="complex64"){const n={x:e};return Sr.runKernel(OYe,n)}else{const n={x:e};return Sr.runKernel($Ye,n)}}const jh=ls({abs_:gZe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vZe(t,e=0){const r={x:hi(t,"x","argMax")},i={axis:e};return Sr.runKernel(DYe,r,i)}const yZe=ls({argMax_:vZe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bZe(t,e){const n=hi(t,"x","cast");if(!wYe(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const r={x:n},i={dtype:e};return Sr.runKernel(tZ,r,i)}const gZ=ls({cast_:bZe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wZe(t){const n={x:hi(t,"x","clone","string_or_numeric")};return Sr.runKernel(nZ,n)}const xZe=ls({clone_:wZe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ze(t,e=0){Ci(t.length>=1,()=>"Pass at least one tensor to concat");const n=dZe(t,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(s=>{if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${s.dtype}. `)}),n.length===1)return xZe(n[0]);const r=n,i={axis:e};return Sr.runKernel(FYe,r,i)}const SZe=ls({concat_:_Ze});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CZe(t,e,n=!1,r=!1){let i=hi(t,"a","matMul"),s=hi(e,"b","matMul");[i,s]=BO(i,s);const o={a:i,b:s},a={transposeA:n,transposeB:r};return Sr.runKernel(PYe,o,a)}const TZe=ls({matMul_:CZe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EZe(t,e){let n=hi(t,"a","mul"),r=hi(e,"b","mul");[n,r]=BO(n,r);const i={a:n,b:r};return Sr.runKernel(UYe,i)}const kZe=ls({mul_:EZe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AZe(t,e=0){const n=hi(t,"x","expandDims","string_or_numeric");Ci(e<=n.rank,()=>"Axis must be <= rank of the tensor");const r={input:n},i={dim:e};return Sr.runKernel(LYe,r,i)}const MZe=ls({expandDims_:AZe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IZe(t,e,n=0,r=0){const i=hi(t,"x","gather"),s=hi(e,"indices","gather","int32"),o={x:i,indices:s},a={axis:n,batchDims:r};return Sr.runKernel(BYe,o,a)}const NZe=ls({gather_:IZe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Ze(t,e=null,n=!1){const i={x:hi(t,"x","max")},s={reductionIndices:e,keepDims:n};return Sr.runKernel(zYe,i,s)}const VO=ls({max_:$Ze});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RZe(t,e=null,n=!1){let r=hi(t,"x","sum");r.dtype==="bool"&&(r=gZ(r,"int32"));const i={x:r},s={axis:e,keepDims:n};return Sr.runKernel(jYe,i,s)}const ny=ls({sum_:RZe});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DZe(t,e,n){const r=t.length+e.length,i=[];let s=0,o=0;for(let a=0;a<r;a++)n.indexOf(a)===-1?i.push(t[s++]):i.push(e[o++]);return i}function PZe(t,e){const n=e.map(r=>1);return DZe(t,n,e)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OZe(t,e=null,n=!1){const i={x:hi(t,"x","min")},s={axis:e,keepDims:n};return Sr.runKernel(VYe,i,s)}const vZ=ls({min_:OZe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FZe(t){const e=hi(t,"x","square"),n={};return Sr.runKernel("Square",{x:e},n)}const LZe=ls({square_:FZe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BZe(t,e){let n=hi(t,"base","pow"),r=hi(e,"exp","pow");[n,r]=BO(n,r);const i={a:n,b:r};return Sr.runKernel(WYe,i)}const zZe=ls({pow_:BZe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VZe(t,e,n,r){if(r==null&&(r=IO(t)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!yc(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){TYe(e);const i=ey(e),s=ey(n);Ci(i===s,()=>`Based on the provided shape, [${e}], the tensor should have ${i} values but has ${s}`);for(let o=0;o<n.length;++o){const a=n[o],l=o===n.length-1?a!==ey(e.slice(o)):!0;Ci(n[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `)}}return!yc(t)&&!Array.isArray(t)&&(t=[t]),e=e||n,t=r!=="string"?aZ(t,r):Ok(t,[],!0),Sr.makeTensor(t,e,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UZe(t,e){if((yc(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&yc(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return VZe(t,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WZe(t){const n={x:hi(t,"x","sqrt","float32")};return Sr.runKernel(HYe,n)}const yZ=ls({sqrt_:WZe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GZe(t,e="euclidean",n=null,r=!1){t=hi(t,"x","norm");const i=bZ(t,e,n);let s=i.shape;if(r){const o=yYe(n,t.shape);s=PZe(i.shape,o)}return u1(i,s)}function bZ(t,e,n=null){if(t.rank===0)return jh(t);if(t.rank!==1&&n===null)return bZ(u1(t,[-1]),e,n);if(t.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(e===1)return ny(jh(t),n);if(e===1/0)return VO(jh(t),n);if(e===-1/0)return vZ(jh(t),n);if(e==="euclidean"||e===2)return yZ(ny(zZe(jh(t),UZe(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&n.length===2){if(e===1)return VO(ny(jh(t),n[0]),n[1]-1);if(e===1/0)return VO(ny(jh(t),n[1]),n[0]);if(e===-1/0)return vZ(ny(jh(t),n[1]),n[0]);if(e==="fro"||e==="euclidean")return yZ(ny(LZe(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const HZe=ls({norm_:GZe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */za().prototype.norm=function(t,e,n){return this.throwIfDisposed(),HZe(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */za().prototype.matMul=function(t,e,n){return this.throwIfDisposed(),TZe(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */za().prototype.as1D=function(){return this.throwIfDisposed(),u1(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */za().prototype.as2D=function(t,e){return this.throwIfDisposed(),u1(this,[t,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */za().prototype.asType=function(t){return this.throwIfDisposed(),gZ(this,t)};class UO extends bu{constructor(r={}){var i=r,{k:e=3}=i,n=ja(i,["k"]);super(n);this.title="KNN classifier",this.serviceName="knn-classifier-models",this.classifier=new HGe,this.parameters={k:new Ue(e,!0)}}async train(e){this.labels=Zd(e)?await e.distinct("y"):this.labels=Array.from(new Set(await e.map(({y:r})=>r).toArray()));const n=Zd(e)?e.items():e;if(this.labels.length<1)throw this.$training.set({status:"error"}),new Error("Cannot train a kNN with no classes");this.$training.set({status:"start",epochs:1}),setTimeout(async()=>{this.classifier.clearAllClasses();for await(const{x:r,y:i}of n)this.classifier.addExample(to(r),i);this.$training.set({status:"success"})},100)}async predict(e){if(!this.classifier||!this.labels||this.labels.length<1)return{label:void 0,confidences:{}};const{label:n,confidences:r}=await this.classifier.predictClass(to(e),this.parameters.k.value);return{label:n,confidences:r}}clear(){delete this.classifier}async save(e,n,r=null){const i=await this.write(n);return i.name=e,this.saveToDatastore(i,r)}async load(e){const n=await this.loadFromDatastore(e);return await this.read(n),n}async download(e){const n=await this.write(e);Kv(JSON.stringify(n),`${n.name}.json`,"text/plain")}async upload(...e){const n=e.filter(i=>i.name.includes(".json")),r=await new Promise((i,s)=>{const o=new FileReader;o.onload=()=>{const a=JSON.parse(o.result);i(a)},o.onerror=s,o.readAsText(n[0])});return await this.read(r),r}async write(e={}){if(!this.classifier)return null;const n=this.classifier.getClassifierDataset(),r={};for(const s of Object.keys(n)){const o=n[s].arraySync();r[s]=o}return{name:this.syncModelName||e1(this.title),files:[],format:"knn-classifier",metadata:Bt({labels:this.labels,data:r},e)}}async read(e){const n=e.metadata.data;if(!n)return;const r={};for(const[i,s]of Object.entries(n))r[i]=oo(s);this.labels=e.metadata.labels,this.classifier.setClassifierDataset(r),this.$training.set({status:"loaded"})}}sn([En],UO.prototype,"train",null);sn([En],UO.prototype,"predict",null);function ptt(t){return new UO(t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */za().prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof Ko&&(t=[t]),SZe([this,...t],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */za().prototype.gather=function(t,e){return this.throwIfDisposed(),NZe(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */za().prototype.argMax=function(t){return this.throwIfDisposed(),yZe(this,t)};function jZe(t){const e=t.slice();for(let n=e.length-1;n>0;n--){const r=Math.floor(Math.random()*n),i=e[n];e[n]=e[r],e[r]=i}return e}async function qZe(t,e,n){const r=n.reduce((s,o)=>ni(Bt({},s),{[o]:[]}),{});for await(const{x:s,y:o}of t)r[o].push(s);let i;return de(()=>{i={training_x:oo([],[0,1]),training_y:oo([],[0,n.length]),validation_x:oo([],[0,1]),validation_y:oo([],[0,n.length])};for(const s of n){const o=r[s],a=o.length,l=jZe(o),c=Math.floor(e*a),u=l.slice(0,c),h=l.slice(c,a),f=Array(n.length).fill(0);f[n.indexOf(s)]=1;for(const d of u)i.training_x.shape[1]===0&&(i.training_x.shape[1]=d[0].length),i.training_x=i.training_x.concat(oo(d)),i.training_y=i.training_y.concat(oo([f]));for(const d of h)i.validation_x.shape[1]===0&&(i.validation_x.shape[1]=d[0].length),i.validation_x=i.validation_x.concat(oo(d)),i.validation_y=i.validation_y.concat(oo([f]))}Tr(i.training_x),Tr(i.training_y),Tr(i.validation_x),Tr(i.validation_y)}),i}class XZe extends Yv{constructor(s={}){var o=s,{layers:e=[64,32],epochs:n=20,batchSize:r=8}=o,i=ja(o,["layers","epochs","batchSize"]);super(i);this.title="MLPClassifier",this.loadFn=Gb,this.parameters={layers:new Ue(e,!0),epochs:new Ue(n,!0),batchSize:new Ue(r,!0)}}async train(e){this.labels=Zd(e)?await e.distinct("y"):this.labels=Array.from(new Set(await e.map(({y:r})=>r).toArray()));const n=Zd(e)?e.items():e;if(this.$training.set({status:"start",epochs:this.parameters.epochs.value}),this.labels.length===0){Fa(new jv("This dataset is empty or is missing labels")),this.$training.set({status:"error"});return}setTimeout(async()=>{const r=await qZe(n,.75,this.labels);this.buildModel(r.training_x.shape[1],r.training_y.shape[1]),this.fit(r)},100)}async predict(e){return this.model?de(()=>{const n=this.model.predict(to(e)),r=this.labels[n.gather(0).argMax().arraySync()],s=n.arraySync()[0].reduce((o,a,l)=>ni(Bt({},o),{[this.labels[l]]:a}),{});return{label:r,confidences:s}}):{label:void 0,confidences:{}}}clear(){delete this.model}buildModel(e,n){as.debug("[MLP] Building a model with layers:",this.parameters.layers),this.model=KLe();for(const[i,s]of this.parameters.layers.value.entries()){const o={units:s,activation:"relu"};i===0&&(o.inputDim=e),this.model.add(P8(o))}this.model.add(P8({units:n,activation:"softmax"}));const r=Yu.adam();this.model.compile({optimizer:r,loss:"categoricalCrossentropy",metrics:["accuracy"]})}fit(e,n=-1){const r=n>0?n:this.parameters.epochs.value;this.model.fit(e.training_x,e.training_y,{batchSize:this.parameters.batchSize.value,validationData:[e.validation_x,e.validation_y],epochs:r,shuffle:!0,callbacks:{onEpochEnd:(i,s)=>{this.$training.set({status:"epoch",epoch:i,epochs:this.parameters.epochs.value,data:{accuracy:s.acc,loss:s.loss,accuracyVal:s.val_acc,lossVal:s.val_loss}})}}}).then(i=>{as.debug("[MLP] Training has ended with results:",i),this.$training.set({status:"success",data:{accuracy:i.history.acc,loss:i.history.loss,accuracyVal:i.history.val_acc,lossVal:i.history.val_loss}})}).catch(i=>{throw this.$training.set({status:"error",data:i}),new jv(i.message)}).finally(()=>{e.training_x.dispose(),e.training_y.dispose(),e.validation_x.dispose(),e.validation_y.dispose()})}}sn([En],XZe.prototype,"train",null);function KZe(t){let e,n,r,i,s;return{c(){e=Ie("Using Mobilenet v"),n=Ie(t[2]),r=Ie(" with alpha = "),i=Ie(t[3]),s=Ie(".")},m(o,a){ie(o,e,a),ie(o,n,a),ie(o,r,a),ie(o,i,a),ie(o,s,a)},p(o,a){a&4&&zt(n,o[2]),a&8&&zt(i,o[3])},d(o){o&&ne(e),o&&ne(n),o&&ne(r),o&&ne(i),o&&ne(s)}}}function YZe(t){let e;return{c(){e=Ie("\xA0")},m(n,r){ie(n,e,r)},p:Ge,d(n){n&&ne(e)}}}function ZZe(t){let e;function n(s,o){return s[4]?YZe:KZe}let r=n(t),i=r(t);return{c(){e=oe("p"),i.c(),H(e,"class","p-2 text-sm text-gray-600")},m(s,o){ie(s,e,o),i.m(e,null)},p(s,o){r===(r=n(s))&&i?i.p(s,o):(i.d(1),i=r(s),i&&(i.c(),i.m(e,null)))},d(s){s&&ne(e),i.d()}}}function JZe(t){let e,n;return e=new Rs({props:{title:t[0],loading:t[4],$$slots:{default:[ZZe]},$$scope:{ctx:t}}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,[i]){const s={};i&1&&(s.title=r[0]),i&16&&(s.loading=r[4]),i&60&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function QZe(t,e,n){let r,i=Ge,s=()=>(i(),i=_r(a,u=>n(4,r=u)),a);t.$$.on_destroy.push(()=>i());let{title:o}=e,{loading:a}=e;s();let{version:l}=e,{alpha:c}=e;return t.$$set=u=>{"title"in u&&n(0,o=u.title),"loading"in u&&s(n(1,a=u.loading)),"version"in u&&n(2,l=u.version),"alpha"in u&&n(3,c=u.alpha)},[o,a,l,c,r]}class eJe extends Kt{constructor(e){super();Xt(this,e,QZe,JZe,Gt,{title:0,loading:1,version:2,alpha:3})}}var _u;class ry extends bu{constructor({version:e=1,alpha:n=1}={}){super();if(this.title="mobileNet",this.parameters={},this.serviceName="undefined",_u.set(this,void 0),this.$loading=new Ue(!0,!0),![1,2].includes(e))throw new Error("Mobilenet version must be 1 or 2");if(![.25,.5,.75,1].includes(n))throw new Error("Mobilenet alpha must be 0.25 | 0.50 | 0.75 | 1.0");this.version=e,this.alpha=n,this.setup()}async setup(){const e=await ZM(),n=Object.keys(e).filter(r=>r.includes("mobileNet"));try{yn(this,_u,await uq({modelUrl:`indexeddb://mobilenet-v${this.version}-${this.alpha}`,version:this.version,alpha:this.alpha}),"f")}catch{n.length>0&&await JM(n[0]),yn(this,_u,await uq({version:this.version,alpha:this.alpha}),"f"),await Ee(this,_u,"f").model.save(`indexeddb://mobilenet-v${this.version}-${this.alpha}`)}return as.info(`MobileNet v${this.version} loaded with alpha = ${this.alpha}`),this.$loading.set(!1),this.start(),this}async process(e){return Ee(this,_u,"f")?de(()=>Ee(this,_u,"f").infer(e,!0).arraySync()):[]}async predict(e){if(!Ee(this,_u,"f"))throw new Error("Mobilenet is not loaded");const n=await Ee(this,_u,"f").classify(e,5);return{label:n[0].className,confidences:n.reduce((r,i)=>ni(Bt({},r),{[i.className]:i.probability}),{})}}mount(e){const n=e||document.querySelector(`#${this.id}`);!n||(this.destroy(),this.$$.app=new eJe({target:n,props:{title:this.title,loading:this.$loading,version:this.version,alpha:this.alpha}}))}train(){throw new jv("Model `MobileNet` cannot be trained")}save(){throw new Error("MobileNet does not support saving")}load(){throw new Error("MobileNet does not support loading")}download(){throw new Error("MobileNet does not support downloading")}upload(){throw new Error("MobileNet does not support uploading")}}_u=new WeakMap;sn([En],ry.prototype,"train",null);sn([En],ry.prototype,"save",null);sn([En],ry.prototype,"load",null);sn([En],ry.prototype,"download",null);sn([En],ry.prototype,"upload",null);function mtt(t){return new ry(t)}function tJe(t){let e,n,r,i,s,o,a,l,c,u;return{c(){e=oe("div"),n=oe("button"),r=Ie("-"),i=Oe(),s=oe("input"),o=Oe(),a=oe("button"),l=Ie("+"),n.disabled=t[1],H(n,"class","left svelte-1jnqeni"),H(s,"type","number"),H(s,"inputmode","decimal"),s.value=t[0],s.disabled=t[1],Jr(s,"width","80px"),H(s,"class","svelte-1jnqeni"),a.disabled=t[1],H(a,"class","right svelte-1jnqeni"),H(e,"class","flex")},m(h,f){ie(h,e,f),X(e,n),X(n,r),X(e,i),X(e,s),X(e,o),X(e,a),X(a,l),c||(u=[Ln(n,"click",t[3]),Ln(s,"change",t[2]),Ln(a,"click",t[4])],c=!0)},p(h,[f]){f&2&&(n.disabled=h[1]),f&1&&(s.value=h[0]),f&2&&(s.disabled=h[1]),f&2&&(a.disabled=h[1])},i:Ge,o:Ge,d(h){h&&ne(e),c=!1,Ra(u)}}}function nJe(t,e,n){let{disabled:r=!1}=e,{value:i}=e;function s(l){const c=l.target,u=parseFloat(c.value);Number.isNaN(u)?c.value=i.toString():n(0,i=u)}const o=()=>{n(0,i-=1)},a=()=>{n(0,i+=1)};return t.$$set=l=>{"disabled"in l&&n(1,r=l.disabled),"value"in l&&n(0,i=l.value)},[i,r,s,o,a]}class rJe extends Kt{constructor(e){super();Xt(this,e,nJe,tJe,Gt,{disabled:1,value:0})}}function wZ(t,e,n){const r=t.slice();return r[12]=e[n],r[14]=n,r}function xZ(t){let e,n,r,i,s,o,a,l,c,u=t[0],h=[];for(let f=0;f<u.length;f+=1)h[f]=_Z(wZ(t,u,f));return{c(){e=oe("div");for(let f=0;f<h.length;f+=1)h[f].c();n=Oe(),r=oe("button"),i=Ie("-"),s=Oe(),o=oe("button"),a=Ie("+"),r.disabled=t[1],H(r,"class","left svelte-1jnqeni"),o.disabled=t[1],H(o,"class","right svelte-1jnqeni"),Jr(o,"border-left","none"),H(e,"class","flex items-center")},m(f,d){ie(f,e,d);for(let p=0;p<h.length;p+=1)h[p].m(e,null);X(e,n),X(e,r),X(r,i),X(e,s),X(e,o),X(o,a),l||(c=[Ln(r,"click",t[10]),Ln(o,"click",t[11])],l=!0)},p(f,d){if(d&31){u=f[0];let p;for(p=0;p<u.length;p+=1){const m=wZ(f,u,p);h[p]?h[p].p(m,d):(h[p]=_Z(m),h[p].c(),h[p].m(e,n))}for(;p<h.length;p+=1)h[p].d(1);h.length=u.length}d&2&&(r.disabled=f[1]),d&2&&(o.disabled=f[1])},d(f){f&&ne(e),Yr(h,f),l=!1,Ra(c)}}}function _Z(t){let e,n,r,i,s,o,a,l,c,u,h;function f(){return t[7](t[14])}function d(...m){return t[8](t[14],...m)}function p(){return t[9](t[14])}return{c(){e=oe("div"),n=oe("button"),r=Ie("-"),i=Oe(),s=oe("input"),a=Oe(),l=oe("button"),c=Ie("+"),n.disabled=t[1],H(n,"class","left svelte-1jnqeni"),H(s,"type","number"),H(s,"inputmode","decimal"),s.value=o=t[12],s.disabled=t[1],Jr(s,"width","80px"),H(s,"class","svelte-1jnqeni"),l.disabled=t[1],H(l,"class","right svelte-1jnqeni"),H(e,"class","flex mr-2")},m(m,v){ie(m,e,v),X(e,n),X(n,r),X(e,i),X(e,s),X(e,a),X(e,l),X(l,c),u||(h=[Ln(n,"click",f),Ln(s,"change",d),Ln(l,"click",p)],u=!0)},p(m,v){t=m,v&2&&(n.disabled=t[1]),v&1&&o!==(o=t[12])&&(s.value=o),v&2&&(s.disabled=t[1]),v&2&&(l.disabled=t[1])},d(m){m&&ne(e),u=!1,Ra(h)}}}function iJe(t){let e=t[0]&&Array.isArray(t[0]),n,r=e&&xZ(t);return{c(){r&&r.c(),n=Ki()},m(i,s){r&&r.m(i,s),ie(i,n,s)},p(i,[s]){s&1&&(e=i[0]&&Array.isArray(i[0])),e?r?r.p(i,s):(r=xZ(i),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},i:Ge,o:Ge,d(i){r&&r.d(i),i&&ne(n)}}}function sJe(t,e,n){let{disabled:r=!1}=e,{value:i}=e;function s(m,v){const y=m.target,w=parseFloat(y.value);Number.isNaN(w)?y.value=i[v].toString():n(0,i[v]=w,i)}function o(m){const v=i.slice();v[m]-=1,n(0,i=v)}function a(m){const v=i.slice();v[m]+=1,n(0,i=v)}function l(){const m=i.slice();m.push(m.length?m[m.length-1]:0),n(0,i=m)}function c(){n(0,i=i.slice(0,i.length-1))}const u=m=>o(m),h=(m,v)=>s(v,m),f=m=>a(m),d=()=>c(),p=()=>l();return t.$$set=m=>{"disabled"in m&&n(1,r=m.disabled),"value"in m&&n(0,i=m.value)},[i,r,s,o,a,l,c,u,h,f,d,p]}class oJe extends Kt{constructor(e){super();Xt(this,e,sJe,iJe,Gt,{disabled:1,value:0})}}function aJe(t){let e,n,r;return{c(){e=oe("input"),H(e,"class","marcelle svelte-gfzaco"),e.disabled=t[2],H(e,"type",t[3]),H(e,"placeholder",t[1]),e.value=t[0]},m(i,s){ie(i,e,s),n||(r=Ln(e,"input",t[4]),n=!0)},p(i,[s]){s&4&&(e.disabled=i[2]),s&8&&H(e,"type",i[3]),s&2&&H(e,"placeholder",i[1]),s&1&&e.value!==i[0]&&(e.value=i[0])},i:Ge,o:Ge,d(i){i&&ne(e),n=!1,r()}}}function lJe(t,e,n){let{placeholder:r=""}=e,{disabled:i=!1}=e,{type:s="text"}=e,{value:o=null}=e;function a(l){n(0,o=l.currentTarget.value)}return t.$$set=l=>{"placeholder"in l&&n(1,r=l.placeholder),"disabled"in l&&n(2,i=l.disabled),"type"in l&&n(3,s=l.type),"value"in l&&n(0,o=l.value)},[o,r,i,s,a]}class SZ extends Kt{constructor(e){super();Xt(this,e,lJe,aJe,Gt,{placeholder:1,disabled:2,type:3,value:0})}}function cJe(t){let e,n,r,i,s,o,a,l,c;return{c(){e=oe("label"),n=oe("input"),r=Oe(),i=oe("span"),i.innerHTML=`<span class="track svelte-1j117k6"></span> 
    <span class="thumb svelte-1j117k6"></span>`,s=Oe(),o=oe("span"),a=Ie(t[1]),H(n,"type","checkbox"),H(n,"class","sr-only"),n.disabled=t[2],H(i,"class","switch svelte-1j117k6"),H(o,"class","ml-2 cursor-pointer"),H(e,"class","marcelle")},m(u,h){ie(u,e,h),X(e,n),n.checked=t[0],X(e,r),X(e,i),X(e,s),X(e,o),X(o,a),l||(c=Ln(n,"change",t[3]),l=!0)},p(u,[h]){h&4&&(n.disabled=u[2]),h&1&&(n.checked=u[0]),h&2&&zt(a,u[1])},i:Ge,o:Ge,d(u){u&&ne(e),l=!1,c()}}}function uJe(t,e,n){let{text:r=""}=e,{checked:i=!1}=e,{disabled:s=!1}=e;function o(){i=this.checked,n(0,i)}return t.$$set=a=>{"text"in a&&n(1,r=a.text),"checked"in a&&n(0,i=a.checked),"disabled"in a&&n(2,s=a.disabled)},[i,r,s,o]}class CZ extends Kt{constructor(e){super();Xt(this,e,uJe,cJe,Gt,{text:1,checked:0,disabled:2})}}function hJe(t){let e,n,r;function i(o){t[7](o)}let s={type:"text"};return t[2]!==void 0&&(s.value=t[2]),e=new SZ({props:s}),Ur.push(()=>Nl(e,"value",i)),{c(){et(e.$$.fragment)},m(o,a){Ze(e,o,a),r=!0},p(o,a){const l={};!n&&a&4&&(n=!0,l.value=o[2],Il(()=>n=!1)),e.$set(l)},i(o){r||(ve(e.$$.fragment,o),r=!0)},o(o){be(e.$$.fragment,o),r=!1},d(o){Je(e,o)}}}function fJe(t){let e,n,r;function i(o){t[6](o)}let s={};return t[2]!==void 0&&(s.value=t[2]),e=new oJe({props:s}),Ur.push(()=>Nl(e,"value",i)),{c(){et(e.$$.fragment)},m(o,a){Ze(e,o,a),r=!0},p(o,a){const l={};!n&&a&4&&(n=!0,l.value=o[2],Il(()=>n=!1)),e.$set(l)},i(o){r||(ve(e.$$.fragment,o),r=!0)},o(o){be(e.$$.fragment,o),r=!1},d(o){Je(e,o)}}}function dJe(t){let e,n,r;function i(o){t[5](o)}let s={};return t[2]!==void 0&&(s.value=t[2]),e=new rJe({props:s}),Ur.push(()=>Nl(e,"value",i)),{c(){et(e.$$.fragment)},m(o,a){Ze(e,o,a),r=!0},p(o,a){const l={};!n&&a&4&&(n=!0,l.value=o[2],Il(()=>n=!1)),e.$set(l)},i(o){r||(ve(e.$$.fragment,o),r=!0)},o(o){be(e.$$.fragment,o),r=!1},d(o){Je(e,o)}}}function pJe(t){let e,n,r;function i(o){t[4](o)}let s={};return t[2]!==void 0&&(s.checked=t[2]),e=new CZ({props:s}),Ur.push(()=>Nl(e,"checked",i)),{c(){et(e.$$.fragment)},m(o,a){Ze(e,o,a),r=!0},p(o,a){const l={};!n&&a&4&&(n=!0,l.checked=o[2],Il(()=>n=!1)),e.$set(l)},i(o){r||(ve(e.$$.fragment,o),r=!0)},o(o){be(e.$$.fragment,o),r=!1},d(o){Je(e,o)}}}function mJe(t){let e,n,r;function i(o){t[3](o)}let s={options:t[1].options};return t[2]!==void 0&&(s.value=t[2]),e=new AY({props:s}),Ur.push(()=>Nl(e,"value",i)),{c(){et(e.$$.fragment)},m(o,a){Ze(e,o,a),r=!0},p(o,a){const l={};a&2&&(l.options=o[1].options),!n&&a&4&&(n=!0,l.value=o[2],Il(()=>n=!1)),e.$set(l)},i(o){r||(ve(e.$$.fragment,o),r=!0)},o(o){be(e.$$.fragment,o),r=!1},d(o){Je(e,o)}}}function gJe(t){let e,n,r,i,s,o;const a=[mJe,pJe,dJe,fJe,hJe],l=[];function c(u,h){return h&2&&(n=!!(u[1].type==="menu"&&Array.isArray(u[1].options)&&u[1].options.length>0)),n?0:u[1].type==="boolean"||u[1].type==="auto"&&typeof u[0].value=="boolean"?1:u[1].type==="number"||u[1].type==="auto"&&typeof u[0].value=="number"?2:(h&3&&(r=!!(u[1].type==="number array"||u[1].type==="auto"&&Array.isArray(u[0].value)&&u[0].value.length&&typeof u[0].value[0]=="number")),r?3:4)}return i=c(t,-1),s=l[i]=a[i](t),{c(){e=oe("div"),s.c(),Jr(e,"flex-grow","1")},m(u,h){ie(u,e,h),l[i].m(e,null),o=!0},p(u,[h]){let f=i;i=c(u,h),i===f?l[i].p(u,h):(Bn(),be(l[f],1,1,()=>{l[f]=null}),zn(),s=l[i],s?s.p(u,h):(s=l[i]=a[i](u),s.c()),ve(s,1),s.m(e,null))},i(u){o||(ve(s),o=!0)},o(u){be(s),o=!1},d(u){u&&ne(e),l[i].d()}}}function vJe(t,e,n){let r,i=Ge,s=()=>(i(),i=_r(o,d=>n(2,r=d)),o);t.$$.on_destroy.push(()=>i());let{stream:o}=e;s();let{spec:a}=e;function l(d){r=d,o.set(r)}function c(d){r=d,o.set(r)}function u(d){r=d,o.set(r)}function h(d){r=d,o.set(r)}function f(d){r=d,o.set(r)}return t.$$set=d=>{"stream"in d&&s(n(0,o=d.stream)),"spec"in d&&n(1,a=d.spec)},[o,a,r,l,c,u,h,f]}class TZ extends Kt{constructor(e){super();Xt(this,e,vJe,gJe,Gt,{stream:0,spec:1})}}function EZ(t,e,n){const r=t.slice();return r[4]=e[n][0],r[5]=e[n][1],r}function yJe(t){let e,n;return e=new TZ({props:{stream:t[5],spec:{type:"auto"}}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,i){const s={};i&2&&(s.stream=r[5]),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function bJe(t){let e,n;return e=new TZ({props:{stream:t[5],spec:t[2][t[4]]}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,i){const s={};i&2&&(s.stream=r[5]),i&6&&(s.spec=r[2][r[4]]),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function kZ(t){let e,n,r=t[4]+"",i,s,o,a,l,c;const u=[bJe,yJe],h=[];function f(d,p){return d[4]in d[2]?0:1}return o=f(t),a=h[o]=u[o](t),{c(){e=oe("div"),n=oe("p"),i=Ie(r),s=Oe(),a.c(),l=Oe(),H(n,"class","w-32 my-2"),H(e,"class","flex my-1 items-center")},m(d,p){ie(d,e,p),X(e,n),X(n,i),X(e,s),h[o].m(e,null),X(e,l),c=!0},p(d,p){(!c||p&2)&&r!==(r=d[4]+"")&&zt(i,r);let m=o;o=f(d),o===m?h[o].p(d,p):(Bn(),be(h[m],1,1,()=>{h[m]=null}),zn(),a=h[o],a?a.p(d,p):(a=h[o]=u[o](d),a.c()),ve(a,1),a.m(e,l))},i(d){c||(ve(a),c=!0)},o(d){be(a),c=!1},d(d){d&&ne(e),h[o].d()}}}function wJe(t){let e,n,r=Object.entries(t[1]),i=[];for(let o=0;o<r.length;o+=1)i[o]=kZ(EZ(t,r,o));const s=o=>be(i[o],1,1,()=>{i[o]=null});return{c(){e=oe("div");for(let o=0;o<i.length;o+=1)i[o].c();H(e,"class","m-2")},m(o,a){ie(o,e,a);for(let l=0;l<i.length;l+=1)i[l].m(e,null);n=!0},p(o,a){if(a&6){r=Object.entries(o[1]);let l;for(l=0;l<r.length;l+=1){const c=EZ(o,r,l);i[l]?(i[l].p(c,a),ve(i[l],1)):(i[l]=kZ(c),i[l].c(),ve(i[l],1),i[l].m(e,null))}for(Bn(),l=r.length;l<i.length;l+=1)s(l);zn()}},i(o){if(!n){for(let a=0;a<r.length;a+=1)ve(i[a]);n=!0}},o(o){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)be(i[a]);n=!1},d(o){o&&ne(e),Yr(i,o)}}}function xJe(t){let e,n;return e=new Rs({props:{title:t[0],$$slots:{default:[wJe]},$$scope:{ctx:t}}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,[i]){const s={};i&1&&(s.title=r[0]),i&262&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function _Je(t,e,n){let{title:r}=e,{parameters:i}=e,{config:s={}}=e,o=[];return t.$$set=a=>{"title"in a&&n(0,r=a.title),"parameters"in a&&n(1,i=a.parameters),"config"in a&&n(2,s=a.config)},t.$$.update=()=>{if(t.$$.dirty&10){for(const a of o)a();n(3,o=Object.values(i).map(a=>a.subscribe()))}},[r,i,s,o]}class SJe extends Kt{constructor(e){super();Xt(this,e,_Je,xJe,Gt,{title:0,parameters:1,config:2})}}var zk;class CJe extends $s{constructor(e,n={}){super();this.title="modelParameters",zk.set(this,void 0),yn(this,zk,e,"f"),this.config=n}mount(e){const n=e||document.querySelector(`#${this.id}`);!n||(this.destroy(),this.$$.app=new SJe({target:n,props:{title:this.title,parameters:Ee(this,zk,"f").parameters,config:this.config}}))}}zk=new WeakMap;function gtt(t,e={}){if(!t.parameters)throw new Error("The argument is not a valid component with parameters");return new CJe(t,e)}function TJe(t){let e;return{c(){e=oe("p"),e.textContent="No model loaded"},m(n,r){ie(n,e,r)},p:Ge,d(n){n&&ne(e)}}}function EJe(t){let e,n,r,i;return{c(){e=oe("p"),n=Ie("Model Loaded from "),r=Ie(t[2]),i=Ie(".")},m(s,o){ie(s,e,o),X(e,n),X(e,r),X(e,i)},p(s,o){o&4&&zt(r,s[2])},d(s){s&&ne(e)}}}function kJe(t){let e;return{c(){e=oe("p"),e.textContent="Loading Model..."},m(n,r){ie(n,e,r)},p:Ge,d(n){n&&ne(e)}}}function AJe(t){let e;function n(s,o){return s[3]==="loading"?kJe:s[3]==="loaded"?EJe:TJe}let r=n(t),i=r(t);return{c(){e=oe("div"),i.c(),H(e,"class","p-2 text-sm text-gray-600")},m(s,o){ie(s,e,o),i.m(e,null)},p(s,o){r===(r=n(s))&&i?i.p(s,o):(i.d(1),i=r(s),i&&(i.c(),i.m(e,null)))},d(s){s&&ne(e),i.d()}}}function MJe(t){let e,n;return e=new Rs({props:{title:t[0],loading:t[3]==="loading",$$slots:{default:[AJe]},$$scope:{ctx:t}}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,[i]){const s={};i&1&&(s.title=r[0]),i&8&&(s.loading=r[3]==="loading"),i&268&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function IJe(t,e,n){let r,i,s,o=Ge,a=()=>(o(),o=_r(f,d=>n(7,s=d)),f);t.$$.on_destroy.push(()=>o());var l,c,u;let{title:h}=e,{training:f}=e;return a(),t.$$set=d=>{"title"in d&&n(0,h=d.title),"training"in d&&a(n(1,f=d.training))},t.$$.update=()=>{t.$$.dirty&128&&n(3,r=s.status),t.$$.dirty&240&&n(2,i=(n(4,l=s.data)===null||l===void 0?void 0:l.source)?s.data.source==="datastore"?`datastore at ${n(5,c=s.data)===null||c===void 0?void 0:c.url}`:s.data.source==="url"?`url ${n(6,u=s.data)===null||u===void 0?void 0:u.url}`:"files":"unknown source")},[h,f,i,r,l,c,u,s]}class NJe extends Kt{constructor(e){super();Xt(this,e,IJe,MJe,Gt,{title:0,training:1})}}var Su;function AZ(t,e){return t===e}function MZ(t,e){return t===e}class $l extends bu{constructor(s){var o=s,{inputType:e,taskType:n,inputShape:r}=o,i=ja(o,["inputType","taskType","inputShape"]);super(i);this.title="onnx model",this.parameters={},this.serviceName="onnx-models",this.$loading=new Ue(!1,!0),this.$ready=new Ue(!1,!0),this.modelName="",this.lockLoading=Promise.resolve(),Su.set(this,void 0),this.inputType=e,this.taskType=n,this.inputShape=r,this.start()}train(){throw new jv("Model `OnnxModel` cannot be trained")}async predict(e){if(!Ee(this,Su,"f")||!this.$ready.value)throw new Error("Model is not loaded");const n=this.preprocess(e),r=await Ee(this,Su,"f").run({[Ee(this,Su,"f").inputNames[0]]:n});return await this.postprocess(r)}async loadFromUrl(e){this.$training.set({status:"loading"}),this.$ready.set(!1),this.$loading.set(!0);try{await this.loadModel(e,e),this.$training.set({status:"loaded",data:{source:"url",url:e}}),this.$loading.set(!1),this.$ready.set(!0)}catch(n){throw this.$training.set({status:"error"}),this.$loading.set(!1),n}}async loadFromFile(e){if(!!e){this.$training.set({status:"loading"}),this.$ready.set(!1),this.$loading.set(!0);try{const n=await new Promise((r,i)=>{const s=new FileReader;s.onload=function(){const a=this.result;r(a)},s.onerror=function(){i()},s.readAsArrayBuffer(e)});await this.loadModel(n,e.name),this.$training.set({status:"loaded",data:{source:"file"}}),this.$loading.set(!1),this.$ready.set(!0)}catch(n){throw this.$training.set({status:"error"}),this.$loading.set(!1),n}}}async loadModel(e,n){this.ready=!1,this.lockLoading=this.lockLoading.then(()=>ort.InferenceSession.create(e)).then(r=>{yn(this,Su,r,"f")}),await this.lockLoading,this.modelName=n;try{await this.warmup()}catch(r){console.log("ONNX Model warmup failed",r)}this.ready=!0}preprocess(e){if(AZ(this.inputType,"image"))return this.preprocessImage(e);if(AZ(this.inputType,"generic")){const n=e.flat().flat().flat().flat().flat();return new ort.Tensor("float32",Float32Array.from(n),this.inputShape)}throw new Error("Invalid input data type")}preprocessImage(e){throw new Error("ONNX for Images: Not yet implemented")}async postprocess(e){if(MZ(this.taskType,"classification")){const n=this.labels?i=>this.labels[i]:i=>i.toString(),r=Array.from(e.probabilities.data).reduce((i,s,o)=>ni(Bt({},i),{[n(o)]:s}),{});return{label:n(e.label.data[0]),confidences:r}}if(MZ(this.taskType,"generic")){const n={};for(const r of Ee(this,Su,"f").outputNames)n[r]=Array.from(e[r].data);return n}throw new Error("Invalid output data type")}async warmup(){const e=Float32Array.from(Array(this.inputShape.reduce((r,i)=>r*i,1)),()=>Math.random()),n=new ort.Tensor("float32",e,this.inputShape);await Ee(this,Su,"f").run({[Ee(this,Su,"f").inputNames[0]]:n})}mount(e){const n=e||document.querySelector(`#${this.id}`);!n||(this.destroy(),this.$$.app=new NJe({target:n,props:{title:this.title,training:this.$training}}))}save(){throw new Error("OnnxModel does not support saving")}load(){throw new Error("OnnxModel does not support loading")}download(){throw new Error("OnnxModel does not support downloading")}upload(){throw new Error("OnnxModel does not support uploading")}}Su=new WeakMap;sn([En],$l.prototype,"train",null);sn([En],$l.prototype,"predict",null);sn([En],$l.prototype,"loadFromUrl",null);sn([En],$l.prototype,"loadFromFile",null);sn([En],$l.prototype,"loadModel",null);sn([En],$l.prototype,"preprocess",null);sn([En],$l.prototype,"postprocess",null);sn([En],$l.prototype,"save",null);sn([En],$l.prototype,"load",null);sn([En],$l.prototype,"download",null);sn([En],$l.prototype,"upload",null);function $Je(t){let e,n,r,i,s;function o(l){t[5](l)}let a={type:"text",placeholder:"Enter a label..",disabled:t[4]};return t[3]!==void 0&&(a.value=t[3]),r=new SZ({props:a}),Ur.push(()=>Nl(r,"value",o)),{c(){e=oe("div"),n=oe("div"),et(r.$$.fragment),H(n,"class","md:flex md:items-center mb-2"),H(e,"class","w-full max-w-sm")},m(l,c){ie(l,e,c),X(e,n),Ze(r,n,null),s=!0},p(l,c){const u={};c&16&&(u.disabled=l[4]),!i&&c&8&&(i=!0,u.value=l[3],Il(()=>i=!1)),r.$set(u)},i(l){s||(ve(r.$$.fragment,l),s=!0)},o(l){be(r.$$.fragment,l),s=!1},d(l){l&&ne(e),Je(r)}}}function RJe(t){let e,n;return e=new Rs({props:{title:t[0],$$slots:{default:[$Je]},$$scope:{ctx:t}}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,[i]){const s={};i&1&&(s.title=r[0]),i&88&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function DJe(t,e,n){let r,i=Ge,s=()=>(i(),i=_r(u,d=>n(3,r=d)),u),o,a=Ge,l=()=>(a(),a=_r(h,d=>n(4,o=d)),h);t.$$.on_destroy.push(()=>i()),t.$$.on_destroy.push(()=>a());let{title:c}=e,{value:u}=e;s();let{disabled:h}=e;l();function f(d){r=d,u.set(r)}return t.$$set=d=>{"title"in d&&n(0,c=d.title),"value"in d&&s(n(1,u=d.value)),"disabled"in d&&l(n(2,h=d.disabled))},[c,u,h,r,o,f]}class PJe extends Kt{constructor(e){super();Xt(this,e,DJe,RJe,Gt,{title:0,value:1,disabled:2})}}class OJe extends $s{constructor(e){super();this.title="text input",this.$value=new Ue("",!0),this.$disabled=new Ue(!1,!0),e!==void 0&&this.$value.set(e),this.start()}mount(e){const n=e||document.querySelector(`#${this.id}`);!n||(this.destroy(),this.$$.app=new PJe({target:n,props:{title:this.title,value:this.$value,disabled:this.$disabled}}))}}function vtt(t){return new OJe(t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */za().prototype.mul=function(t){return this.throwIfDisposed(),kZe(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */za().prototype.expandDims=function(t){return this.throwIfDisposed(),MZe(this,t)};function FJe(t){let e;return{c(){e=oe("p"),e.textContent="No model loaded"},m(n,r){ie(n,e,r)},p:Ge,d(n){n&&ne(e)}}}function LJe(t){let e,n,r,i;return{c(){e=oe("p"),n=Ie("Model Loaded from "),r=Ie(t[2]),i=Ie(".")},m(s,o){ie(s,e,o),X(e,n),X(e,r),X(e,i)},p(s,o){o&4&&zt(r,s[2])},d(s){s&&ne(e)}}}function BJe(t){let e;return{c(){e=oe("p"),e.textContent="Loading Model..."},m(n,r){ie(n,e,r)},p:Ge,d(n){n&&ne(e)}}}function zJe(t){let e;function n(s,o){return s[3]==="loading"?BJe:s[3]==="loaded"?LJe:FJe}let r=n(t),i=r(t);return{c(){e=oe("div"),i.c(),H(e,"class","p-2 text-sm text-gray-600")},m(s,o){ie(s,e,o),i.m(e,null)},p(s,o){r===(r=n(s))&&i?i.p(s,o):(i.d(1),i=r(s),i&&(i.c(),i.m(e,null)))},d(s){s&&ne(e),i.d()}}}function VJe(t){let e,n;return e=new Rs({props:{title:t[0],loading:t[3]==="loading",$$slots:{default:[zJe]},$$scope:{ctx:t}}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,[i]){const s={};i&1&&(s.title=r[0]),i&8&&(s.loading=r[3]==="loading"),i&268&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function UJe(t,e,n){let r,i,s,o=Ge,a=()=>(o(),o=_r(f,d=>n(7,s=d)),f);t.$$.on_destroy.push(()=>o());var l,c,u;let{title:h}=e,{training:f}=e;return a(),t.$$set=d=>{"title"in d&&n(0,h=d.title),"training"in d&&a(n(1,f=d.training))},t.$$.update=()=>{t.$$.dirty&128&&n(3,r=s.status),t.$$.dirty&240&&n(2,i=(n(4,l=s.data)===null||l===void 0?void 0:l.source)?s.data.source==="datastore"?`datastore at ${n(5,c=s.data)===null||c===void 0?void 0:c.url}`:s.data.source==="url"?`url ${n(6,u=s.data)===null||u===void 0?void 0:u.url}`:"files":"unknown source")},[h,f,i,r,l,c,u,s]}class WJe extends Kt{constructor(e){super();Xt(this,e,UJe,VJe,Gt,{title:0,training:1})}}function IZ(t,e){return t===e}function WO(t,e){return t===e}class ep extends Yv{constructor(s){var o=s,{inputType:e,taskType:n,segmentationOptions:r={applyArgmax:!1,output:"image"}}=o,i=ja(o,["inputType","taskType","segmentationOptions"]);super(i);this.title="tfjs model",this.parameters={},this.segmentationOptions=Bt({applyArgmax:!1,output:"image"},r),this.inputType=e,this.taskType=n,this.$training.subscribe(({status:a})=>{a==="loaded"&&(this.inputShape=this.model.inputs[0].shape.map(l=>l&&l>0?l:1))})}train(){throw new jv("Model `TfModel` cannot be trained")}async predict(e){if(!this.model||this.$training.value.status!=="loaded")throw new Error("Model is not loaded");const n=de(()=>{const i=this.preprocess(e);return this.model.predict(i.expandDims(0)).gather(0)}),r=await this.postprocess(n);return n.dispose(),r}preprocess(e){if(IZ(this.inputType,"image"))return this.preprocessImage(e);if(IZ(this.inputType,"generic"))return to(e);throw new Error("Invalid input data type")}preprocessImage(e){return Po.resizeBilinear(rI(e),[this.inputShape[1],this.inputShape[2]])}async postprocess(e){if(WO(this.taskType,"classification")){const n=this.labels?s=>this.labels[s]:s=>s.toString(),r=de(()=>e.argMax().dataSync()[0]),i=e.arraySync().reduce((s,o,a)=>ni(Bt({},s),{[n(a)]:o}),{});return{label:n(r),confidences:i}}if(WO(this.taskType,"segmentation")){const[n,r]=e.shape,i=this.segmentationOptions.applyArgmax?de(()=>e.argMax(-1).mul(.5)):e,s=this.segmentationOptions.output==="image"?new ImageData(await pz(i),n,r):await i.array();return this.segmentationOptions.applyArgmax&&i.dispose(),s}if(WO(this.taskType,"generic"))return e.array();throw new Error("Invalid output data type")}async loadFromFiles(e){this.$training.set({status:"loading"});try{const n=e.filter(i=>i.name.includes(".json")),r=e.filter(i=>i.name.includes(".bin"));if(n.length!==1){const i=new Error("The provided files are not compatible with this model");throw i.name="File upload error",i}if(this.$training.set({status:"loading"}),e.length){const i=await SO(n[0]);this.loadFn=i.format==="graph-model"?Ff:Gb,this.model=await this.loadFn(aY([n[0],...r])),await this.warmup(),await this.save(this.id),this.$training.set({status:"loaded",data:{source:"file"}})}}catch(n){throw this.$training.set({status:"error"}),n}}async loadFromUrl(e){this.$training.set({status:"loading"});try{const n=await fetch(e).then(r=>r.json());this.loadFn=n.format==="graph-model"?Ff:Gb,this.model=await this.loadFn(CO(e)),await this.warmup(),this.$training.set({status:"loaded",data:{source:"url",url:e}})}catch(n){throw console.log("[tf-model] Loading error",n),this.$training.set({status:"error"}),n}}mount(e){const n=e||document.querySelector(`#${this.id}`);!n||(this.destroy(),this.$$.app=new WJe({target:n,props:{title:this.title,training:this.$training}}))}}sn([En],ep.prototype,"train",null);sn([En],ep.prototype,"predict",null);sn([En],ep.prototype,"preprocess",null);sn([En],ep.prototype,"preprocessImage",null);sn([En],ep.prototype,"postprocess",null);sn([En],ep.prototype,"loadFromFiles",null);sn([En],ep.prototype,"loadFromUrl",null);const GJe=t=>function(n,r,i){const s=i.value;return i.value=function(...a){const l=this[t].then(()=>s.apply(this,a));return this[t]=l,l},i};function HJe(t){let e,n;const r=t[1].default,i=zh(r,t,t[0],null);return{c(){e=oe("div"),i&&i.c(),H(e,"class","tabs")},m(s,o){ie(s,e,o),i&&i.m(e,null),n=!0},p(s,[o]){i&&i.p&&(!n||o&1)&&Vh(i,r,s,s[0],n?o:-1,null,null)},i(s){n||(ve(i,s),n=!0)},o(s){be(i,s),n=!1},d(s){s&&ne(e),i&&i.d(s)}}}const GO={};function jJe(t,e,n){let{$$slots:r={},$$scope:i}=e;const s=[],o=[],a=s1(null),l=s1(null);return O7e(GO,{registerTab:c=>{s.push(c),a.update(u=>u||c),Wh(()=>{const u=s.indexOf(c);s.splice(u,1),a.update(h=>h===c?s[u]||s[s.length-1]:h)})},registerPanel:c=>{o.push(c),l.update(u=>u||c),Wh(()=>{const u=o.indexOf(c);o.splice(u,1),l.update(h=>h===c?o[u]||o[o.length-1]:h)})},selectTab:c=>{const u=s.indexOf(c);a.set(c),l.set(o[u])},selectedTab:a,selectedPanel:l}),t.$$set=c=>{"$$scope"in c&&n(0,i=c.$$scope)},[i,r]}class qJe extends Kt{constructor(e){super();Xt(this,e,jJe,HJe,Gt,{})}}function XJe(t){let e,n,r,i;const s=t[5].default,o=zh(s,t,t[4],null);return{c(){e=oe("div"),o&&o.c(),H(e,"class","text-sm font-semibold text-gray-600 cursor-pointer mx-4 p-2 hover:text-gray-800 svelte-hnkfx4"),H(e,"role","tab"),dt(e,"selected",t[0]===t[1])},m(a,l){ie(a,e,l),o&&o.m(e,null),n=!0,r||(i=Ln(e,"click",t[6]),r=!0)},p(a,[l]){o&&o.p&&(!n||l&16)&&Vh(o,s,a,a[4],n?l:-1,null,null),l&3&&dt(e,"selected",a[0]===a[1])},i(a){n||(ve(o,a),n=!0)},o(a){be(o,a),n=!1},d(a){a&&ne(e),o&&o.d(a),r=!1,i()}}}function KJe(t,e,n){let r,{$$slots:i={},$$scope:s}=e;const o={},{registerTab:a,selectTab:l,selectedTab:c}=UK(GO);uO(t,c,h=>n(0,r=h)),a(o);const u=()=>l(o);return t.$$set=h=>{"$$scope"in h&&n(4,s=h.$$scope)},[r,o,l,c,s,i,u]}class Vk extends Kt{constructor(e){super();Xt(this,e,KJe,XJe,Gt,{})}}function YJe(t){let e,n;const r=t[1].default,i=zh(r,t,t[0],null);return{c(){e=oe("div"),i&&i.c(),H(e,"class","flex border-solid border-0 border-b border-gray-200 mb-2")},m(s,o){ie(s,e,o),i&&i.m(e,null),n=!0},p(s,[o]){i&&i.p&&(!n||o&1)&&Vh(i,r,s,s[0],n?o:-1,null,null)},i(s){n||(ve(i,s),n=!0)},o(s){be(i,s),n=!1},d(s){s&&ne(e),i&&i.d(s)}}}function ZJe(t,e,n){let{$$slots:r={},$$scope:i}=e;return t.$$set=s=>{"$$scope"in s&&n(0,i=s.$$scope)},[i,r]}class JJe extends Kt{constructor(e){super();Xt(this,e,ZJe,YJe,Gt,{})}}function NZ(t){let e;const n=t[4].default,r=zh(n,t,t[3],null);return{c(){r&&r.c()},m(i,s){r&&r.m(i,s),e=!0},p(i,s){r&&r.p&&(!e||s&8)&&Vh(r,n,i,i[3],e?s:-1,null,null)},i(i){e||(ve(r,i),e=!0)},o(i){be(r,i),e=!1},d(i){r&&r.d(i)}}}function QJe(t){let e,n,r=t[0]===t[1]&&NZ(t);return{c(){r&&r.c(),e=Ki()},m(i,s){r&&r.m(i,s),ie(i,e,s),n=!0},p(i,[s]){i[0]===i[1]?r?(r.p(i,s),s&1&&ve(r,1)):(r=NZ(i),r.c(),ve(r,1),r.m(e.parentNode,e)):r&&(Bn(),be(r,1,1,()=>{r=null}),zn())},i(i){n||(ve(r),n=!0)},o(i){be(r),n=!1},d(i){r&&r.d(i),i&&ne(e)}}}function eQe(t,e,n){let r,{$$slots:i={},$$scope:s}=e;const o={},{registerPanel:a,selectedPanel:l}=UK(GO);return uO(t,l,c=>n(0,r=c)),a(o),t.$$set=c=>{"$$scope"in c&&n(3,s=c.$$scope)},[r,o,l,s,i]}class Uk extends Kt{constructor(e){super();Xt(this,e,eQe,QJe,Gt,{})}}class tQe extends _Y{constructor(r){var i=r,{data:e}=i,n=ja(i,["data"]);super(n);this.currentPage=1,this.rawData=e,this.total.set(e.length),this.data.set(this.rawData.slice(0,this.options.itemsPerPage))}async update(){this.page(this.currentPage)}async page(e){this.data.set(this.rawData.slice((e-1)*this.options.itemsPerPage,Math.min(e*this.options.itemsPerPage,this.rawData.length))),this.currentPage=e}async sort(e){this.rawData.sort((n,r)=>n[e.col]>r[e.col]?e.ascending?1:-1:n[e.col]<r[e.col]?e.ascending?-1:1:0),this.page(this.currentPage)}async delete(e){return this.rawData.splice(e,1),this.page(this.currentPage),null}}function nQe(t){let e;return{c(){e=oe("div"),e.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7l4-4m0 0l4 4m-4-4v18"></path></svg> 
    <p>Select one or several runs to display information</p>`,H(e,"class","empty svelte-yj1ygt")},m(n,r){ie(n,e,r)},p:Ge,i:Ge,o:Ge,d(n){n&&ne(e)}}}function rQe(t){let e,n;return e=new WY({props:{columns:[{name:"field"},...t[2]],provider:t[1],selectable:!1}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,i){const s={};i&4&&(s.columns=[{name:"field"},...r[2]]),i&2&&(s.provider=r[1]),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function iQe(t){let e,n,r,i;const s=[rQe,nQe],o=[];function a(l,c){return l[0].length>0?0:1}return e=a(t),n=o[e]=s[e](t),{c(){n.c(),r=Ki()},m(l,c){o[e].m(l,c),ie(l,r,c),i=!0},p(l,[c]){let u=e;e=a(l),e===u?o[e].p(l,c):(Bn(),be(o[u],1,1,()=>{o[u]=null}),zn(),n=o[e],n?n.p(l,c):(n=o[e]=s[e](l),n.c()),ve(n,1),n.m(r.parentNode,r))},i(l){i||(ve(n),i=!0)},o(l){be(n),i=!1},d(l){o[e].d(l),l&&ne(r)}}}function sQe(t,e,n){let r,i,s,o,{runs:a}=e;return t.$$set=l=>{"runs"in l&&n(0,a=l.runs)},t.$$.update=()=>{t.$$.dirty&1&&n(2,r=a.map((l,c)=>({name:`Run ${c+1}`}))),t.$$.dirty&1&&n(4,i=a.length>0?Object.keys(a[0]).filter(l=>l!=="logs"):[]),t.$$.dirty&17&&n(3,s=i.map(l=>a.map((c,u)=>({[`Run ${u+1}`]:c[l]})).reduce((c,u)=>Bt(Bt({},c),u),{field:l}))),t.$$.dirty&8&&n(1,o=new tQe({data:s}))},[a,o,r,s,i]}class $Z extends Kt{constructor(e){super();Xt(this,e,sQe,iQe,Gt,{runs:0})}}function RZ(t,e,n){const r=t.slice();return r[5]=e[n],r[6]=e,r[7]=n,r}function DZ(t){let e,n=t[7];const r=()=>t[3](e,n),i=()=>t[3](null,n);return{c(){e=oe("div"),H(e,"class","card inner-card xl:flex-1 svelte-xksli7")},m(s,o){ie(s,e,o),r()},p(s,o){t=s,n!==t[7]&&(i(),n=t[7],r())},d(s){s&&ne(e),i()}}}function oQe(t){let e,n=Object.values(t[0]),r=[];for(let i=0;i<n.length;i+=1)r[i]=DZ(RZ(t,n,i));return{c(){e=oe("div");for(let i=0;i<r.length;i+=1)r[i].c();H(e,"class","grid grid-cols-1 gap-1")},m(i,s){ie(i,e,s);for(let o=0;o<r.length;o+=1)r[o].m(e,null);t[4](e)},p(i,[s]){if(s&5){n=Object.values(i[0]);let o;for(o=0;o<n.length;o+=1){const a=RZ(i,n,o);r[o]?r[o].p(a,s):(r[o]=DZ(a),r[o].c(),r[o].m(e,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=n.length}},i:Ge,o:Ge,d(i){i&&ne(e),Yr(r,i),t[4](null)}}}function aQe(t,e,n){let{charts:r}=e,i,s=[];Da(async()=>{await Ns(),await Ns(),Object.keys(r).length>1&&i.clientWidth>700&&n(1,i.style.gridTemplateColumns="repeat(2, minmax(0, 1fr))",i);for(const[l,c]of Object.values(r).entries())c.mount(s[l])}),Wh(()=>{for(const l of Object.values(r))l.destroy()});function o(l,c){Ur[l?"unshift":"push"](()=>{s[c]=l,n(2,s)})}function a(l){Ur[l?"unshift":"push"](()=>{i=l,n(1,i)})}return t.$$set=l=>{"charts"in l&&n(0,r=l.charts)},[r,i,s,o,a]}class lQe extends Kt{constructor(e){super();Xt(this,e,aQe,oQe,Gt,{charts:0})}}class cQe extends $s{constructor(e,n={loss:["loss","lossVal"],accuracy:["accuracy","accuracyVal"]}){super();if(this.model=e,this.title="training plot",this.charts={},!e){const o=new Error("[training plot] No model was provided");o.name="Component Compatibility Error",Fa(o)}if(!e.$training){const o=new Error("[training plot] The provided model is incompatible with the training plot component, missing `$training` stream");o.name="Component Compatibility Error",Fa(o)}let r=n;typeof n=="string"&&(r=[n]),Array.isArray(r)&&(r=r.reduce((o,a)=>ni(Bt({},o),{[a]:a}),{}));const i={};for(const[o,a]of Object.entries(r)){const l=Array.isArray(a)?a:[a];this.charts[o]=uY({preset:"line-fast",options:{xlabel:"Epoch",ylabel:o}});for(const c of l)Object.keys(i).includes(c)||(i[c]=new Ue([],!0)),this.charts[o].addSeries(i[c],c);this.charts[o].title=o}function s(){for(const o of Object.values(i))o.set([])}e.$training.subscribe(o=>{if(o.status==="start")s();else if(o.data)for(const[a,l]of Object.entries(o.data)){if(!Object.keys(i).includes(a))return;Array.isArray(l)?i[a].set(l):i[a].set(i[a].value.concat([l]))}}),this.start()}mount(e){const n=e||document.querySelector(`#${this.id}`);!n||(this.destroy(),this.$$.app=new lQe({target:n,props:{charts:this.charts}}))}}function uQe(t,e){return new cQe(t,e)}function hQe(t){let e;return{c(){e=oe("div"),e.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7l4-4m0 0l4 4m-4-4v18"></path></svg> 
    <p>Select one or several runs to display information</p>`,H(e,"class","empty svelte-yj1ygt")},m(n,r){ie(n,e,r)},p:Ge,d(n){n&&ne(e)}}}function fQe(t){let e;return{c(){e=oe("div")},m(n,r){ie(n,e,r),t[7](e)},p:Ge,d(n){n&&ne(e),t[7](null)}}}function dQe(t){let e;function n(s,o){return s[0].length>0?fQe:hQe}let r=n(t),i=r(t);return{c(){i.c(),e=Ki()},m(s,o){i.m(s,o),ie(s,e,o)},p(s,[o]){r===(r=n(s))&&i?i.p(s,o):(i.d(1),i=r(s),i&&(i.c(),i.m(e.parentNode,e)))},i:Ge,o:Ge,d(s){i.d(s),s&&ne(e)}}}function pQe(t,e,n){let r,i,{names:s}=e,{logs:o}=e,a,l,c;Wh(()=>{c&&c.destroy()});function u(h){Ur[h?"unshift":"push"](()=>{a=h,n(1,a)})}return t.$$set=h=>{"names"in h&&n(2,s=h.names),"logs"in h&&n(0,o=h.logs)},t.$$.update=()=>{t.$$.dirty&9&&(n(3,l=Array.from(new Set(o.map(Object.keys).flat()))),l.sort()),t.$$.dirty&5&&n(6,r=o.map((h,f)=>Object.entries(h).reduce((d,[p,m])=>ni(Bt({},d),{[`${p} (${s[f]})`]:m}),{})).reduce((h,f)=>Bt(Bt({},h),f),{})),t.$$.dirty&72&&n(5,i=l.reduce((h,f)=>ni(Bt({},h),{[f]:Object.keys(r).filter(d=>d.startsWith(`${f} (`))}),{})),t.$$.dirty&114&&(c&&c.destroy(),n(4,c=uQe({$training:new Ue({status:"success",data:r},!0)},i)),c.mount(a))},[o,a,s,l,c,i,r,u]}class mQe extends Kt{constructor(e){super();Xt(this,e,pQe,dQe,Gt,{names:2,logs:0})}}function PZ(t,e,n){const r=t.slice();return r[13]=e[n],r[15]=n,r}function gQe(t){let e;return{c(){e=Ie("Graphs")},m(n,r){ie(n,e,r)},d(n){n&&ne(e)}}}function vQe(t){let e;return{c(){e=Ie("Metadata")},m(n,r){ie(n,e,r)},d(n){n&&ne(e)}}}function yQe(t){let e;return{c(){e=Ie("Parameters")},m(n,r){ie(n,e,r)},d(n){n&&ne(e)}}}function bQe(t){let e;return{c(){e=Ie("Model Summary")},m(n,r){ie(n,e,r)},d(n){n&&ne(e)}}}function wQe(t){let e,n,r,i,s,o,a,l;return e=new Vk({props:{$$slots:{default:[gQe]},$$scope:{ctx:t}}}),r=new Vk({props:{$$slots:{default:[vQe]},$$scope:{ctx:t}}}),s=new Vk({props:{$$slots:{default:[yQe]},$$scope:{ctx:t}}}),a=new Vk({props:{$$slots:{default:[bQe]},$$scope:{ctx:t}}}),{c(){et(e.$$.fragment),n=Oe(),et(r.$$.fragment),i=Oe(),et(s.$$.fragment),o=Oe(),et(a.$$.fragment)},m(c,u){Ze(e,c,u),ie(c,n,u),Ze(r,c,u),ie(c,i,u),Ze(s,c,u),ie(c,o,u),Ze(a,c,u),l=!0},p(c,u){const h={};u&65536&&(h.$$scope={dirty:u,ctx:c}),e.$set(h);const f={};u&65536&&(f.$$scope={dirty:u,ctx:c}),r.$set(f);const d={};u&65536&&(d.$$scope={dirty:u,ctx:c}),s.$set(d);const p={};u&65536&&(p.$$scope={dirty:u,ctx:c}),a.$set(p)},i(c){l||(ve(e.$$.fragment,c),ve(r.$$.fragment,c),ve(s.$$.fragment,c),ve(a.$$.fragment,c),l=!0)},o(c){be(e.$$.fragment,c),be(r.$$.fragment,c),be(s.$$.fragment,c),be(a.$$.fragment,c),l=!1},d(c){Je(e,c),c&&ne(n),Je(r,c),c&&ne(i),Je(s,c),c&&ne(o),Je(a,c)}}}function xQe(t){let e,n;return e=new mQe({props:{logs:t[4].map(LZ),names:t[4].map(BZ)}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,i){const s={};i&16&&(s.logs=r[4].map(LZ)),i&16&&(s.names=r[4].map(BZ)),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function _Qe(t){let e,n;return e=new $Z({props:{runs:t[4]}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,i){const s={};i&16&&(s.runs=r[4]),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function SQe(t){let e,n;return e=new $Z({props:{runs:t[4].map(zZ)}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,i){const s={};i&16&&(s.runs=r[4].map(zZ)),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function OZ(t){let e,n,r,i=t[15]+1+"",s,o,a,l,c=t[13]+"",u,h,f;return{c(){e=oe("div"),n=oe("h2"),r=Ie("Model "),s=Ie(i),o=Oe(),a=oe("div"),l=oe("pre"),u=Ie(c),h=oe("br"),f=Oe(),H(a,"class","summary svelte-y4izzs")},m(d,p){ie(d,e,p),X(e,n),X(n,r),X(n,s),X(e,o),X(e,a),X(a,l),X(l,u),X(l,h),X(e,f)},p(d,p){p&16&&c!==(c=d[13]+"")&&zt(u,c)},d(d){d&&ne(e)}}}function CQe(t){let e,n=t[4].map(VZ),r=[];for(let i=0;i<n.length;i+=1)r[i]=OZ(PZ(t,n,i));return{c(){e=oe("div");for(let i=0;i<r.length;i+=1)r[i].c();H(e,"class","summaries svelte-y4izzs")},m(i,s){ie(i,e,s);for(let o=0;o<r.length;o+=1)r[o].m(e,null)},p(i,s){if(s&16){n=i[4].map(VZ);let o;for(o=0;o<n.length;o+=1){const a=PZ(i,n,o);r[o]?r[o].p(a,s):(r[o]=OZ(a),r[o].c(),r[o].m(e,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=n.length}},d(i){i&&ne(e),Yr(r,i)}}}function TQe(t){let e,n,r,i,s,o,a,l,c,u;return e=new JJe({props:{$$slots:{default:[wQe]},$$scope:{ctx:t}}}),r=new Uk({props:{$$slots:{default:[xQe]},$$scope:{ctx:t}}}),s=new Uk({props:{$$slots:{default:[_Qe]},$$scope:{ctx:t}}}),a=new Uk({props:{$$slots:{default:[SQe]},$$scope:{ctx:t}}}),c=new Uk({props:{$$slots:{default:[CQe]},$$scope:{ctx:t}}}),{c(){et(e.$$.fragment),n=Oe(),et(r.$$.fragment),i=Oe(),et(s.$$.fragment),o=Oe(),et(a.$$.fragment),l=Oe(),et(c.$$.fragment)},m(h,f){Ze(e,h,f),ie(h,n,f),Ze(r,h,f),ie(h,i,f),Ze(s,h,f),ie(h,o,f),Ze(a,h,f),ie(h,l,f),Ze(c,h,f),u=!0},p(h,f){const d={};f&65536&&(d.$$scope={dirty:f,ctx:h}),e.$set(d);const p={};f&65552&&(p.$$scope={dirty:f,ctx:h}),r.$set(p);const m={};f&65552&&(m.$$scope={dirty:f,ctx:h}),s.$set(m);const v={};f&65552&&(v.$$scope={dirty:f,ctx:h}),a.$set(v);const y={};f&65552&&(y.$$scope={dirty:f,ctx:h}),c.$set(y)},i(h){u||(ve(e.$$.fragment,h),ve(r.$$.fragment,h),ve(s.$$.fragment,h),ve(a.$$.fragment,h),ve(c.$$.fragment,h),u=!0)},o(h){be(e.$$.fragment,h),be(r.$$.fragment,h),be(s.$$.fragment,h),be(a.$$.fragment,h),be(c.$$.fragment,h),u=!1},d(h){Je(e,h),h&&ne(n),Je(r,h),h&&ne(i),Je(s,h),h&&ne(o),Je(a,h),h&&ne(l),Je(c,h)}}}function EQe(t){let e,n,r,i,s,o,a;function l(u){t[10](u)}let c={columns:t[7],provider:t[6],actions:[...t[1].map(FZ),{name:"delete",confirm:!0}]};return t[4]!==void 0&&(c.selection=t[4]),e=new WY({props:c}),Ur.push(()=>Nl(e,"selection",l)),t[11](e),e.$on("select",t[12]),o=new qJe({props:{$$slots:{default:[TQe]},$$scope:{ctx:t}}}),{c(){et(e.$$.fragment),r=Oe(),i=oe("br"),s=Oe(),et(o.$$.fragment)},m(u,h){Ze(e,u,h),ie(u,r,h),ie(u,i,h),ie(u,s,h),Ze(o,u,h),a=!0},p(u,h){const f={};h&2&&(f.actions=[...u[1].map(FZ),{name:"delete",confirm:!0}]),!n&&h&16&&(n=!0,f.selection=u[4],Il(()=>n=!1)),e.$set(f);const d={};h&65552&&(d.$$scope={dirty:h,ctx:u}),o.$set(d)},i(u){a||(ve(e.$$.fragment,u),ve(o.$$.fragment,u),a=!0)},o(u){be(e.$$.fragment,u),be(o.$$.fragment,u),a=!1},d(u){t[11](null),Je(e,u),u&&ne(r),u&&ne(i),u&&ne(s),Je(o,u)}}}function kQe(t){let e,n;return e=new Rs({props:{title:t[0],$$slots:{default:[EQe]},$$scope:{ctx:t}}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,[i]){const s={};i&1&&(s.title=r[0]),i&65562&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}const FZ=t=>typeof t=="string"?{name:t}:t,LZ=t=>t.logs,BZ=t=>t.name,zZ=t=>t.params,VZ=t=>{var e;return((e=t.model)==null?void 0:e.summary)||"No summary available"};function AQe(t,e,n){let r,i=Ge,s=()=>(i(),i=_r(u,w=>n(4,r=w)),u);t.$$.on_destroy.push(()=>i());let{title:o}=e,{service:a}=e,{metrics:l}=e,{actions:c}=e,{selection:u}=e;s();const h=Pa(),f=new EKe({service:a,transform:Bt(Bt({},l.reduce((w,x)=>ni(Bt({},w),{[x]:_=>x in _.logs?_.logs[x][_.logs[x].length-1]:"metrics not found"}),{})),c.reduce((w,x)=>ni(Bt({},w),{[typeof x=="string"?x:x.name]:()=>typeof x=="string"?x:x.name}),{}))});f.data.subscribe(()=>{u.set([])});const d=[{name:"name",sortable:!0},{name:"start",sortable:!0,type:"date"},...l.map(w=>({name:w})),{name:"epochs"},{name:"status"},...c.map(w=>({name:typeof w=="string"?w:w.name,type:"action"}))];let p;Da(async()=>{await Ns(),await Ns();for(const w of c){const x=typeof w=="string"?w:w.name;p.$on(x,({detail:_})=>{h(x,_)})}});function m(w){r=w,u.set(r)}function v(w){Ur[w?"unshift":"push"](()=>{p=w,n(3,p)})}const y=({detail:w})=>h("load",w);return t.$$set=w=>{"title"in w&&n(0,o=w.title),"service"in w&&n(8,a=w.service),"metrics"in w&&n(9,l=w.metrics),"actions"in w&&n(1,c=w.actions),"selection"in w&&s(n(2,u=w.selection))},[o,c,u,p,r,h,f,d,a,l,m,v,y]}class MQe extends Kt{constructor(e){super();Xt(this,e,AQe,kQe,Gt,{title:0,service:8,metrics:9,actions:1,selection:2})}}function IQe(t,e){const n=Bt({},t);for(const[r,i]of Object.entries(e))n[r]=(n[r]||[]).concat([i]);return n}const NQe={metrics:["accuracy","accuracyVal","loss","lossVal"],actions:[]};class $Qe extends $s{constructor(e,n={}){super();this.dataStore=e,this.title="Training History",this.$selection=new Ue([],!0),this.$actions=new Ue(null).skip(1),this.ready=Promise.resolve(),this.stopTracking=mc,this.lock=Promise.resolve(),this.options=Bt(Bt({},NQe),n),this.lock=this.lock.then(mc),this.start(),this.ready=this.ready.then(()=>this.dataStore.connect()).then(()=>{this.runService=this.dataStore.service("runs")}).catch(()=>{as.log("[dataset] dataStore connection failed")})}track(e,n="anonymous"){return this.ready.then(()=>(this.stopTracking(),this.model=e,this.modelName=n,this.runService.find({query:{basename:n,$sort:{createdAt:-1},$select:["name"],$limit:1}}))).then(({data:r})=>r.length>0?parseInt(r[0].name.split(`${n}-`)[1])+1:1).then(r=>{this.nextIndex=r,this.crtRun=null,this.stopTracking=this.model?this.model.$training.subscribe(this.trackTrainingStream.bind(this)):mc}),this}async trackTrainingStream(e){if(e.status==="start")this.crtRun=await this.runService.create({name:`${this.modelName}-${this.nextIndex++}`,basename:this.modelName,start:new Date(Date.now()).toISOString(),source:"js",status:e.status,epochs:e.epochs,params:Object.entries(this.model.parameters).map(([n,r])=>({[n]:r.value})).reduce((n,r)=>Bt(Bt({},n),r),{}),logs:{}});else if(e.status==="epoch")this.runService.patch(this.crtRun.id,{status:e.status,epoch:e.epoch,logs:IQe(this.crtRun.logs,e.data)});else if(e.status==="success"){const n=await this.model.save(this.modelName,{});this.runService.patch(this.crtRun.id,{status:e.status,epoch:e.epoch,logs:e.data,checkpoints:(this.crtRun.checkpoints||[]).concat([{id:n,name:`${this.crtRun.name}@final`,service:this.model.serviceName}])})}else e.status==="error"&&this.runService.patch(this.crtRun.id,{status:e.status})}mount(e){const n=e||document.querySelector(`#${this.id}`);!n||(this.destroy(),this.ready.then(()=>{this.$$.app=new MQe({target:n,props:{title:this.title,service:this.runService,metrics:this.options.metrics,actions:this.options.actions,selection:this.$selection}});for(const r of this.options.actions){const i=typeof r=="string"?r:r.name;this.$$.app.$on(i,({detail:s})=>{this.$actions.set({name:i,data:s})})}}))}}sn([GJe("lock")],$Qe.prototype,"trackTrainingStream",null);function RQe(t){let e,n,r,i,s,o,a,l,c,u,h,f,d,p;return{c(){e=oe("div"),n=oe("div"),r=oe("div"),i=oe("span"),s=Ie(`Status:
          `),o=Ie(t[1]),a=Oe(),l=oe("div"),c=oe("span"),u=Ie(t[2]),h=Ie("%"),f=Oe(),d=oe("div"),p=oe("div"),H(i,"class",`text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-blue-600
          bg-blue-200 svelte-1pbpkbh`),dt(i,"gray",t[1]==="idle"),dt(i,"green",t[1]==="success"||t[1]==="loaded"),dt(i,"red",t[1]==="error"),H(c,"class","text-xs font-semibold inline-block text-blue-600 svelte-1pbpkbh"),dt(c,"tgray",t[1]==="idle"),dt(c,"tgreen",t[1]==="success"||t[1]==="loaded"),dt(c,"tred",t[1]==="error"),H(l,"class","text-right"),H(n,"class","flex mb-2 items-center justify-between"),Jr(p,"width",t[2]+"%"),H(p,"class",`shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center
        bg-blue-500 svelte-1pbpkbh`),dt(p,"xgray",t[1]==="idle"),dt(p,"xgreen",t[1]==="success"||t[1]==="loaded"),dt(p,"xred",t[1]==="error"),H(d,"class","overflow-hidden h-2 mb-4 text-xs flex rounded bg-blue-200 svelte-1pbpkbh"),dt(d,"gray",t[1]==="idle"),dt(d,"green",t[1]==="success"||t[1]==="loaded"),dt(d,"red",t[1]==="error"),H(e,"class","relative pt-6 w-full"),Jr(e,"min-width","250px")},m(m,v){ie(m,e,v),X(e,n),X(n,r),X(r,i),X(i,s),X(i,o),X(n,a),X(n,l),X(l,c),X(c,u),X(c,h),X(e,f),X(e,d),X(d,p)},p(m,v){v&2&&zt(o,m[1]),v&2&&dt(i,"gray",m[1]==="idle"),v&2&&dt(i,"green",m[1]==="success"||m[1]==="loaded"),v&2&&dt(i,"red",m[1]==="error"),v&4&&zt(u,m[2]),v&2&&dt(c,"tgray",m[1]==="idle"),v&2&&dt(c,"tgreen",m[1]==="success"||m[1]==="loaded"),v&2&&dt(c,"tred",m[1]==="error"),v&4&&Jr(p,"width",m[2]+"%"),v&2&&dt(p,"xgray",m[1]==="idle"),v&2&&dt(p,"xgreen",m[1]==="success"||m[1]==="loaded"),v&2&&dt(p,"xred",m[1]==="error"),v&2&&dt(d,"gray",m[1]==="idle"),v&2&&dt(d,"green",m[1]==="success"||m[1]==="loaded"),v&2&&dt(d,"red",m[1]==="error")},d(m){m&&ne(e)}}}function DQe(t){let e,n;return e=new Rs({props:{title:t[0],$$slots:{default:[RQe]},$$scope:{ctx:t}}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,[i]){const s={};i&1&&(s.title=r[0]),i&22&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function PQe(t,e,n){let{title:r}=e,{training:i}=e,s="idle",o=0;return Da(()=>{i.subscribe(a=>{n(1,s=a.status),s==="start"||s==="error"?n(2,o=0):s==="success"?n(2,o=100):n(2,o=Math.floor(100*(a.epoch+1)/a.epochs))})}),t.$$set=a=>{"title"in a&&n(0,r=a.title),"training"in a&&n(3,i=a.training)},[r,s,o,i]}class OQe extends Kt{constructor(e){super();Xt(this,e,PQe,DQe,Gt,{title:0,training:3})}}var Wk;class FQe extends $s{constructor(e){super();this.title="training progress",Wk.set(this,void 0),yn(this,Wk,e,"f")}mount(e){const n=e||document.querySelector(`#${this.id}`);!n||(this.destroy(),this.$$.app=new OQe({target:n,props:{title:this.title,training:Ee(this,Wk,"f").$training}}))}}Wk=new WeakMap;function ytt(t){if(!t.$training)throw new Error("The argument is not a valid MLP");return new FQe(t)}function UZ(t){let e,n;return e=new TO({}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function LQe(t){let e,n,r,i,s,o,a,l,c,u,h;function f(m){t[10](m)}let d={text:"activate video"};t[7]!==void 0&&(d.checked=t[7]),i=new CZ({props:d}),Ur.push(()=>Nl(i,"checked",f));let p=t[7]&&!t[8]&&UZ();return{c(){e=oe("div"),n=oe("div"),r=oe("div"),et(i.$$.fragment),o=Oe(),a=oe("div"),p&&p.c(),l=Oe(),c=oe("video"),Jr(n,"margin-left","10px"),H(c,"id","webcam-video"),H(c,"class","max-w-none svelte-1tk8qy9"),Jr(c,"width",t[1]>t[2]?`${t[6]}px`:"auto"),Jr(c,"height",t[1]>t[2]?"auto":`${t[6]*t[2]/t[1]}px`),c.autoplay=!0,c.muted=!0,c.playsInline=!0,H(a,"class","webcam-container svelte-1tk8qy9"),Jr(a,"flex-direction",t[1]>t[2]?"column":"row"),Jr(a,"height",t[6]*t[2]/t[1]+"px"),vu(()=>t[12].call(a)),H(e,"class","webcam svelte-1tk8qy9")},m(m,v){ie(m,e,v),X(e,n),X(n,r),Ze(i,r,null),X(e,o),X(e,a),p&&p.m(a,null),X(a,l),X(a,c),t[11](c),u=I7e(a,t[12].bind(a)),h=!0},p(m,v){const y={};!s&&v&128&&(s=!0,y.checked=m[7],Il(()=>s=!1)),i.$set(y),m[7]&&!m[8]?p?v&384&&ve(p,1):(p=UZ(),p.c(),ve(p,1),p.m(a,l)):p&&(Bn(),be(p,1,1,()=>{p=null}),zn()),(!h||v&70)&&Jr(c,"width",m[1]>m[2]?`${m[6]}px`:"auto"),(!h||v&70)&&Jr(c,"height",m[1]>m[2]?"auto":`${m[6]*m[2]/m[1]}px`),(!h||v&6)&&Jr(a,"flex-direction",m[1]>m[2]?"column":"row"),(!h||v&70)&&Jr(a,"height",m[6]*m[2]/m[1]+"px")},i(m){h||(ve(i.$$.fragment,m),ve(p),h=!0)},o(m){be(i.$$.fragment,m),be(p),h=!1},d(m){m&&ne(e),Je(i),p&&p.d(),t[11](null),u()}}}function BQe(t){let e,n;return e=new Rs({props:{title:t[0],$$slots:{default:[LQe]},$$scope:{ctx:t}}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,[i]){const s={};i&1&&(s.title=r[0]),i&16870&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function zQe(t,e,n){let r,i=Ge,s=()=>(i(),i=_r(f,S=>n(7,r=S)),f),o,a=Ge,l=()=>(a(),a=_r(p,S=>n(8,o=S)),p);t.$$.on_destroy.push(()=>i()),t.$$.on_destroy.push(()=>a());let{title:c}=e,{width:u}=e,{height:h}=e,{active:f}=e;s();let{mediaStream:d}=e,{ready:p}=e;l();let m,v,y=mc;Da(async()=>{await Ns(),await Ns(),y=d.subscribe(S=>{S&&n(5,m.srcObject=S,m)})}),Wh(()=>{y()});function w(S){r=S,f.set(r)}function x(S){Ur[S?"unshift":"push"](()=>{m=S,n(5,m)})}function _(){v=this.clientWidth,n(6,v)}return t.$$set=S=>{"title"in S&&n(0,c=S.title),"width"in S&&n(1,u=S.width),"height"in S&&n(2,h=S.height),"active"in S&&s(n(3,f=S.active)),"mediaStream"in S&&n(9,d=S.mediaStream),"ready"in S&&l(n(4,p=S.ready))},[c,u,h,f,p,m,v,r,o,d,w,x,_]}class VQe extends Kt{constructor(e){super();Xt(this,e,zQe,BQe,Gt,{title:0,width:1,height:2,active:3,mediaStream:9,ready:4})}}var Yo,Va,Cu,Tu,bc,Gk,Hk,h1,Zo,f1,iy,sy;function UQe(t,e){let n=new Date().getTime(),r=!1,i;function s(){if(r)return;new Date().getTime()-n>=e&&(t(),n=new Date().getTime()),i=window.requestAnimationFrame(s)}return i=window.requestAnimationFrame(s),function(){window.cancelAnimationFrame(i),r=!0}}class WQe extends $s{constructor({width:e=224,height:n=224,period:r=50}={}){super();this.title="webcam",this.$active=new Ue(!1,!0),this.$ready=new Ue(!1,!0),this.$mediastream=new Ue(void 0,!0),this.$images=new Ue(db()),this.$thumbnails=new Ue(db()),Yo.set(this,void 0),Va.set(this,void 0),Cu.set(this,void 0),Tu.set(this,void 0),bc.set(this,document.createElement("video")),Gk.set(this,80),Hk.set(this,mc),h1.set(this,mc),Zo.set(this,void 0),f1.set(this,void 0),iy.set(this,void 0),sy.set(this,void 0),yn(this,Yo,e,"f"),yn(this,Va,n,"f"),this.period=r,this.setupCapture(),this.start(),Ee(this,bc,"f").autoplay=!0,yn(this,Hk,this.$active.subscribe(i=>{Ee(this,h1,"f").call(this),i?(this.loadCameras(),yn(this,h1,UQe(this.process.bind(this),this.period),"f")):this.stopCamera()}),"f")}getWidth(){return Ee(this,Yo,"f")}mount(e){const n=e||document.querySelector(`#${this.id}`);!n||(this.destroy(),this.$$.app=new VQe({target:n,props:{title:this.title,width:Ee(this,Yo,"f"),height:Ee(this,Va,"f"),active:this.$active,mediaStream:this.$mediastream,ready:this.$ready}}))}stop(){if(super.stop(),Ee(this,h1,"f").call(this),Ee(this,Hk,"f").call(this),this.$mediastream.value)for(const e of this.$mediastream.value.getTracks())e.stop()}setupCapture(){yn(this,Zo,document.createElement("canvas"),"f"),Ee(this,Zo,"f").width=Ee(this,Gk,"f"),Ee(this,Zo,"f").height=Ee(this,Gk,"f")*Ee(this,Va,"f")/Ee(this,Yo,"f"),yn(this,f1,Ee(this,Zo,"f").getContext("2d"),"f"),yn(this,iy,document.createElement("canvas"),"f"),Ee(this,iy,"f").width=Ee(this,Yo,"f"),Ee(this,iy,"f").height=Ee(this,Va,"f"),yn(this,sy,Ee(this,iy,"f").getContext("2d"),"f")}async loadCameras(){try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});yn(this,Cu,e.getVideoTracks()[0].getSettings().width,"f"),yn(this,Tu,e.getVideoTracks()[0].getSettings().height,"f"),this.loadSrcStream(e)}catch{Fa(new Error("Webcam not supported"))}}loadSrcStream(e){this.$mediastream.set(e),Ee(this,bc,"f").srcObject=e,Ee(this,bc,"f").onloadedmetadata=()=>{this.$ready.set(!0)}}stopCamera(){if(this.$mediastream.value){const e=this.$mediastream.value.getTracks();for(const n of e)n.stop(),Ee(this,bc,"f").srcObject=null;this.$ready.set(!1)}}process(){!this.$ready.value||(this.$thumbnails.set(this.captureThumbnail()),this.$images.set(this.captureImage()))}captureThumbnail(){if(!this.$ready.value)return null;const e=Ee(this,Va,"f")/Ee(this,Tu,"f"),n=Ee(this,Yo,"f")/Ee(this,Cu,"f");if(e>n){const r=Ee(this,Zo,"f").height*Ee(this,Cu,"f")/Ee(this,Tu,"f");Ee(this,f1,"f").drawImage(Ee(this,bc,"f"),Ee(this,Zo,"f").width/2-r/2,0,r,Ee(this,Zo,"f").height)}else{const r=Ee(this,Zo,"f").width*Ee(this,Tu,"f")/Ee(this,Cu,"f");Ee(this,f1,"f").drawImage(Ee(this,bc,"f"),0,Ee(this,Zo,"f").height/2-r/2,Ee(this,Zo,"f").width,r)}return Ee(this,Zo,"f").toDataURL("image/jpeg")}captureImage(){if(!this.$ready.value)return null;const e=Ee(this,Va,"f")/Ee(this,Tu,"f"),n=Ee(this,Yo,"f")/Ee(this,Cu,"f");if(e>n){const r=Ee(this,Va,"f")*Ee(this,Cu,"f")/Ee(this,Tu,"f");Ee(this,sy,"f").drawImage(Ee(this,bc,"f"),Ee(this,Yo,"f")/2-r/2,0,r,Ee(this,Va,"f"))}else{const r=Ee(this,Yo,"f")*Ee(this,Tu,"f")/Ee(this,Cu,"f");Ee(this,sy,"f").drawImage(Ee(this,bc,"f"),0,Ee(this,Va,"f")/2-r/2,Ee(this,Yo,"f"),r)}return Ee(this,sy,"f").getImageData(0,0,Ee(this,Yo,"f"),Ee(this,Va,"f"))}}Yo=new WeakMap,Va=new WeakMap,Cu=new WeakMap,Tu=new WeakMap,bc=new WeakMap,Gk=new WeakMap,Hk=new WeakMap,h1=new WeakMap,Zo=new WeakMap,f1=new WeakMap,iy=new WeakMap,sy=new WeakMap;function btt(t){return new WQe(t)}function WZ(t){return typeof t=="string"}function GZ(t){return Array.isArray(t)}class GQe{constructor(e,n=!0){this.name=e,this.showSidebar=n,this.components=[],this.componentsLeft=[]}use(...e){return this.components=this.components.concat(e),this}sidebar(...e){return this.componentsLeft=this.componentsLeft.concat(e),this}mount(){for(const e of this.components)if(GZ(e))for(const n of e)n.mount();else WZ(e)||e.mount();for(const e of this.componentsLeft)e.mount()}destroy(){for(const e of this.components)if(GZ(e))for(const n of e)n.destroy();else WZ(e)||e.destroy();for(const e of this.componentsLeft)e.destroy()}}function HQe(t,e,n,r){return t instanceof RegExp?t:(t instanceof Array&&(t=`(${t.join("|")})`),t=t.concat(r?"":"/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,(i,s,o,a,l,c)=>(e.push({name:a,optional:!!c}),s=s||"",`${c?"":s}(?:${c?s:""}${o||""}${l||o&&"([^/.]+?)"||"([^/]+?)"})${c||""}`)).replace(/([/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)"),new RegExp(`^${t}$`,n?"":"i"))}class jQe{constructor(e,n){this.path=e,this.name=n,this.keys=[],this.fns=[],this.params={},this.regex=HQe(this.path,this.keys,!1,!1)}addHandler(e){this.fns.push(e)}removeHandler(e){this.fns=this.fns.filter(n=>e===n)}run(e){for(const n of this.fns)n.apply(this,e)}match(e,n){const r=this.regex.exec(e);if(!r)return!1;for(let i=1,s=r.length;i<s;i++){const o=this.keys[i-1],a=typeof r[i]=="string"?decodeURIComponent(r[i]):r[i];o&&(this.params[o.name]=a),n.push(a)}return!0}}function qQe(t,e){const n=[];return e.match(t,n)?(e.run(n),!0):!1}class XQe{constructor(){this.map={},this.routes=[],this.addListener()}route(e,n){const r=e.split(" "),i=r.length===2?r[0]:null;e=r.length===2?r[1]:r[0],Object.keys(this.map).includes(e)||(this.map[e]=new jQe(e,i),this.routes.push(this.map[e])),this.map[e].addHandler(n),this.reload()}addListener(){window.addEventListener("hashchange",this.reload.bind(this),!1)}removeListener(){window.removeEventListener("hashchange",this.reload.bind(this))}reload(){const e=window.location.hash.substring(1);for(let n=0;n<this.routes.length;n++){const r=this.routes[n];if(qQe(e,r))return}}navigate(e,{silent:n=!1}={}){n&&this.removeListener(),setTimeout(()=>{window.location.hash=e,n&&setTimeout(()=>{this.addListener()},1)},1)}}function HZ(t,e,n){const r=t.slice();return r[1]=e[n],r}function jZ(t,e,n){const r=t.slice();return r[4]=e[n].id,r}function qZ(t,e,n){const r=t.slice();return r[4]=e[n].id,r}function XZ(t){let e,n,r=t[0].showSidebar&&KZ(t),i=t[0].components,s=[];for(let o=0;o<i.length;o+=1)s[o]=JZ(HZ(t,i,o));return{c(){r&&r.c(),e=Oe(),n=oe("div");for(let o=0;o<s.length;o+=1)s[o].c();H(n,"class","right svelte-wc8mn0"),dt(n,"fullw",!t[0].showSidebar)},m(o,a){r&&r.m(o,a),ie(o,e,a),ie(o,n,a);for(let l=0;l<s.length;l+=1)s[l].m(n,null)},p(o,a){if(o[0].showSidebar?r?r.p(o,a):(r=KZ(o),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),a&1){i=o[0].components;let l;for(l=0;l<i.length;l+=1){const c=HZ(o,i,l);s[l]?s[l].p(c,a):(s[l]=JZ(c),s[l].c(),s[l].m(n,null))}for(;l<s.length;l+=1)s[l].d(1);s.length=i.length}a&1&&dt(n,"fullw",!o[0].showSidebar)},d(o){r&&r.d(o),o&&ne(e),o&&ne(n),Yr(s,o)}}}function KZ(t){let e,n=t[0].componentsLeft,r=[];for(let i=0;i<n.length;i+=1)r[i]=YZ(qZ(t,n,i));return{c(){e=oe("div");for(let i=0;i<r.length;i+=1)r[i].c();H(e,"class","left svelte-wc8mn0")},m(i,s){ie(i,e,s);for(let o=0;o<r.length;o+=1)r[o].m(e,null)},p(i,s){if(s&1){n=i[0].componentsLeft;let o;for(o=0;o<n.length;o+=1){const a=qZ(i,n,o);r[o]?r[o].p(a,s):(r[o]=YZ(a),r[o].c(),r[o].m(e,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=n.length}},d(i){i&&ne(e),Yr(r,i)}}}function YZ(t){let e,n;return{c(){e=oe("div"),H(e,"id",n=t[4]),H(e,"class","card")},m(r,i){ie(r,e,i)},p(r,i){i&1&&n!==(n=r[4])&&H(e,"id",n)},d(r){r&&ne(e)}}}function KQe(t){let e,n;return{c(){e=oe("div"),H(e,"id",n=t[1].id),H(e,"class","card")},m(r,i){ie(r,e,i)},p(r,i){i&1&&n!==(n=r[1].id)&&H(e,"id",n)},d(r){r&&ne(e)}}}function YQe(t){let e,n=t[1]+"",r;return{c(){e=oe("h2"),r=Ie(n),H(e,"class","svelte-wc8mn0")},m(i,s){ie(i,e,s),X(e,r)},p(i,s){s&1&&n!==(n=i[1]+"")&&zt(r,n)},d(i){i&&ne(e)}}}function ZQe(t){let e,n,r=t[1],i=[];for(let s=0;s<r.length;s+=1)i[s]=ZZ(jZ(t,r,s));return{c(){e=oe("div");for(let s=0;s<i.length;s+=1)i[s].c();n=Oe(),H(e,"class","flex flex-row flex-wrap items-stretch")},m(s,o){ie(s,e,o);for(let a=0;a<i.length;a+=1)i[a].m(e,null);X(e,n)},p(s,o){if(o&1){r=s[1];let a;for(a=0;a<r.length;a+=1){const l=jZ(s,r,a);i[a]?i[a].p(l,o):(i[a]=ZZ(l),i[a].c(),i[a].m(e,n))}for(;a<i.length;a+=1)i[a].d(1);i.length=r.length}},d(s){s&&ne(e),Yr(i,s)}}}function ZZ(t){let e,n;return{c(){e=oe("div"),H(e,"id",n=t[4]),H(e,"class","card flex-none xl:flex-1 w-full xl:w-auto")},m(r,i){ie(r,e,i)},p(r,i){i&1&&n!==(n=r[4])&&H(e,"id",n)},d(r){r&&ne(e)}}}function JZ(t){let e,n;function r(o,a){return(e==null||a&1)&&(e=!!Array.isArray(o[1])),e?ZQe:typeof o[1]=="string"?YQe:KQe}let i=r(t,-1),s=i(t);return{c(){s.c(),n=Ki()},m(o,a){s.m(o,a),ie(o,n,a)},p(o,a){i===(i=r(o,a))&&s?s.p(o,a):(s.d(1),s=i(o),s&&(s.c(),s.m(n.parentNode,n)))},d(o){s.d(o),o&&ne(n)}}}function JQe(t){let e,n=t[0]&&XZ(t);return{c(){n&&n.c(),e=Ki()},m(r,i){n&&n.m(r,i),ie(r,e,i)},p(r,[i]){r[0]?n?n.p(r,i):(n=XZ(r),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:Ge,o:Ge,d(r){n&&n.d(r),r&&ne(e)}}}function QQe(t,e,n){let{dashboard:r}=e;return VK(()=>{r.mount()}),t.$$set=i=>{"dashboard"in i&&n(0,r=i.dashboard)},[r]}class eet extends Kt{constructor(e){super();Xt(this,e,QQe,JQe,Gt,{dashboard:0})}}function tet(t){let e;return{c(){e=Ie("This dataset is empty")},m(n,r){ie(n,e,r)},p:Ge,d(n){n&&ne(e)}}}function net(t){let e,n,r,i=(t[3]?"s":"")+"",s,o;return{c(){e=Ie("This dataset contains "),n=Ie(t[3]),r=Ie(" instance"),s=Ie(i),o=Ie(".")},m(a,l){ie(a,e,l),ie(a,n,l),ie(a,r,l),ie(a,s,l),ie(a,o,l)},p(a,l){l&8&&zt(n,a[3]),l&8&&i!==(i=(a[3]?"s":"")+"")&&zt(s,i)},d(a){a&&ne(e),a&&ne(n),a&&ne(r),a&&ne(s),a&&ne(o)}}}function QZ(t){let e,n,r,i;return e=new ui({props:{$$slots:{default:[ret]},$$scope:{ctx:t}}}),e.$on("click",t[4]),{c(){et(e.$$.fragment),n=Oe(),r=oe("span"),H(r,"class","w-1")},m(s,o){Ze(e,s,o),ie(s,n,o),ie(s,r,o),i=!0},p(s,o){const a={};o&256&&(a.$$scope={dirty:o,ctx:s}),e.$set(a)},i(s){i||(ve(e.$$.fragment,s),i=!0)},o(s){be(e.$$.fragment,s),i=!1},d(s){Je(e,s),s&&ne(n),s&&ne(r)}}}function ret(t){let e;return{c(){e=Ie("Download Dataset")},m(n,r){ie(n,e,r)},d(n){n&&ne(e)}}}function iet(t){let e;return{c(){e=Ie("Upload Dataset")},m(n,r){ie(n,e,r)},d(n){n&&ne(e)}}}function set(t){let e;return{c(){e=Ie("Clear Dataset")},m(n,r){ie(n,e,r)},d(n){n&&ne(e)}}}function oet(t){let e,n=t[0].title+"",r,i,s,o,a,l,c,u,h,f,d,p,m,v;function y(S,T){return S[3]?net:tet}let w=y(t),x=w(t),_=t[3]&&QZ(t);return c=new ui({props:{$$slots:{default:[iet]},$$scope:{ctx:t}}}),c.$on("click",t[5]),m=new ui({props:{type:"danger",$$slots:{default:[set]},$$scope:{ctx:t}}}),m.$on("click",t[6]),{c(){e=oe("span"),r=Ie(n),i=Oe(),s=oe("p"),x.c(),o=Oe(),a=oe("div"),_&&_.c(),l=Oe(),et(c.$$.fragment),u=Oe(),h=oe("span"),f=Oe(),d=oe("input"),p=Oe(),et(m.$$.fragment),H(e,"class","card-title"),H(s,"class","pb-2"),H(h,"class","w-1"),H(d,"type","file"),d.multiple=!0,H(d,"class","hidden"),H(a,"class","flex")},m(S,T){ie(S,e,T),X(e,r),ie(S,i,T),ie(S,s,T),x.m(s,null),ie(S,o,T),ie(S,a,T),_&&_.m(a,null),X(a,l),Ze(c,a,null),X(a,u),X(a,h),X(a,f),X(a,d),t[7](d),X(a,p),Ze(m,a,null),v=!0},p(S,[T]){(!v||T&1)&&n!==(n=S[0].title+"")&&zt(r,n),w===(w=y(S))&&x?x.p(S,T):(x.d(1),x=w(S),x&&(x.c(),x.m(s,null))),S[3]?_?(_.p(S,T),T&8&&ve(_,1)):(_=QZ(S),_.c(),ve(_,1),_.m(a,l)):_&&(Bn(),be(_,1,1,()=>{_=null}),zn());const E={};T&256&&(E.$$scope={dirty:T,ctx:S}),c.$set(E);const k={};T&256&&(k.$$scope={dirty:T,ctx:S}),m.$set(k)},i(S){v||(ve(_),ve(c.$$.fragment,S),ve(m.$$.fragment,S),v=!0)},o(S){be(_),be(c.$$.fragment,S),be(m.$$.fragment,S),v=!1},d(S){S&&ne(e),S&&ne(i),S&&ne(s),x.d(),S&&ne(o),S&&ne(a),_&&_.d(),Je(c),t[7](null),Je(m)}}}function aet(t,e,n){let r,i,s=Ge,o=()=>(s(),s=_r(r,d=>n(3,i=d)),r);t.$$.on_destroy.push(()=>s());let{dataset:a}=e,l;function c(){a.download()}function u(){l==null||l.click()}function h(){a.clear()}Da(async()=>{await Ns(),await Ns(),l.addEventListener("change",d=>{const p=d.target.files,m=[];for(let v=0;v<p.length;v++)m.push(p[v]);a.upload(m)})});function f(d){Ur[d?"unshift":"push"](()=>{l=d,n(1,l)})}return t.$$set=d=>{"dataset"in d&&n(0,a=d.dataset)},t.$$.update=()=>{t.$$.dirty&1&&o(n(2,r=a.$count))},[a,l,r,i,c,u,h,f]}class cet extends Kt{constructor(e){super();Xt(this,e,aet,oet,Gt,{dataset:0})}}function eJ(t){let e,n,r,i={ctx:t,current:null,token:null,hasCatch:!1,pending:det,then:het,catch:uet,value:4,blocks:[,,,]};return HK(n=t[0].connect(),i),{c(){e=Ki(),i.block.c()},m(s,o){ie(s,e,o),i.block.m(s,i.anchor=o),i.mount=()=>e.parentNode,i.anchor=e,r=!0},p(s,o){t=s,i.ctx=t,o&1&&n!==(n=t[0].connect())&&HK(n,i)||z7e(i,t,o)},i(s){r||(ve(i.block),r=!0)},o(s){for(let o=0;o<3;o+=1){const a=i.blocks[o];be(a)}r=!1},d(s){s&&ne(e),i.block.d(s),i.token=null,i=null}}}function uet(t){return{c:Ge,m:Ge,p:Ge,i:Ge,o:Ge,d:Ge}}function het(t){let e,n,r=t[4].email+"",i,s,o,a,l;return a=new ui({props:{$$slots:{default:[fet]},$$scope:{ctx:t}}}),a.$on("click",t[3]),{c(){e=oe("p"),n=Ie("Hello, "),i=Ie(r),s=Oe(),o=oe("div"),et(a.$$.fragment),H(e,"class","pb-2"),H(o,"class","flex")},m(c,u){ie(c,e,u),X(e,n),X(e,i),ie(c,s,u),ie(c,o,u),Ze(a,o,null),l=!0},p(c,u){(!l||u&1)&&r!==(r=c[4].email+"")&&zt(i,r);const h={};u&32&&(h.$$scope={dirty:u,ctx:c}),a.$set(h)},i(c){l||(ve(a.$$.fragment,c),l=!0)},o(c){be(a.$$.fragment,c),l=!1},d(c){c&&ne(e),c&&ne(s),c&&ne(o),Je(a)}}}function fet(t){let e;return{c(){e=Ie("Log out")},m(n,r){ie(n,e,r)},d(n){n&&ne(e)}}}function det(t){let e,n;return e=new TO({}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p:Ge,i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function tJ(t){let e,n,r=t[2].join(", ")+"",i;return{c(){e=oe("div"),n=Ie("This data store contains the following services: "),i=Ie(r)},m(s,o){ie(s,e,o),X(e,n),X(e,i)},p(s,o){o&4&&r!==(r=s[2].join(", ")+"")&&zt(i,r)},d(s){s&&ne(e)}}}function pet(t){let e,n,r,i=t[0].requiresAuth&&eJ(t),s=t[2]&&tJ(t);return{c(){i&&i.c(),e=Oe(),s&&s.c(),n=Ki()},m(o,a){i&&i.m(o,a),ie(o,e,a),s&&s.m(o,a),ie(o,n,a),r=!0},p(o,a){o[0].requiresAuth?i?(i.p(o,a),a&1&&ve(i,1)):(i=eJ(o),i.c(),ve(i,1),i.m(e.parentNode,e)):i&&(Bn(),be(i,1,1,()=>{i=null}),zn()),o[2]?s?s.p(o,a):(s=tJ(o),s.c(),s.m(n.parentNode,n)):s&&(s.d(1),s=null)},i(o){r||(ve(i),r=!0)},o(o){be(i),r=!1},d(o){i&&i.d(o),o&&ne(e),s&&s.d(o),o&&ne(n)}}}function met(t){let e,n;return e=new Rs({props:{title:"data store ("+t[0].location+")",$$slots:{default:[pet]},$$scope:{ctx:t}}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,[i]){const s={};i&1&&(s.title="data store ("+r[0].location+")"),i&37&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function get(t,e,n){let r,i,s=Ge,o=()=>(s(),s=_r(r,c=>n(2,i=c)),r);t.$$.on_destroy.push(()=>s());let{dataStore:a}=e;function l(){a.logout()}return t.$$set=c=>{"dataStore"in c&&n(0,a=c.dataStore)},t.$$.update=()=>{t.$$.dirty&1&&o(n(1,r=a.$services))},[a,r,i,l]}class vet extends Kt{constructor(e){super();Xt(this,e,get,met,Gt,{dataStore:0})}}function yet(t){let e;return{c(){e=Ie("Download Model")},m(n,r){ie(n,e,r)},d(n){n&&ne(e)}}}function bet(t){let e;return{c(){e=Ie("Upload Model")},m(n,r){ie(n,e,r)},d(n){n&&ne(e)}}}function wet(t){let e,n=t[0].title+"",r,i,s,o,a,l,c,u,h,f,d;return o=new ui({props:{$$slots:{default:[yet]},$$scope:{ctx:t}}}),o.$on("click",t[2]),f=new ui({props:{$$slots:{default:[bet]},$$scope:{ctx:t}}}),f.$on("click",t[3]),{c(){e=oe("span"),r=Ie(n),i=Oe(),s=oe("div"),et(o.$$.fragment),a=Oe(),l=oe("span"),c=Oe(),u=oe("input"),h=Oe(),et(f.$$.fragment),H(e,"class","card-title"),H(l,"class","w-1"),H(u,"type","file"),u.multiple=!0,H(u,"class","hidden"),H(s,"class","flex")},m(p,m){ie(p,e,m),X(e,r),ie(p,i,m),ie(p,s,m),Ze(o,s,null),X(s,a),X(s,l),X(s,c),X(s,u),t[4](u),X(s,h),Ze(f,s,null),d=!0},p(p,[m]){(!d||m&1)&&n!==(n=p[0].title+"")&&zt(r,n);const v={};m&32&&(v.$$scope={dirty:m,ctx:p}),o.$set(v);const y={};m&32&&(y.$$scope={dirty:m,ctx:p}),f.$set(y)},i(p){d||(ve(o.$$.fragment,p),ve(f.$$.fragment,p),d=!0)},o(p){be(o.$$.fragment,p),be(f.$$.fragment,p),d=!1},d(p){p&&ne(e),p&&ne(i),p&&ne(s),Je(o),t[4](null),Je(f)}}}function HO(t){return"download"in t}function xet(t,e,n){let{model:r}=e,i;function s(){HO(r)?r.download():Fa(new Error("This model cannot be saved"))}function o(){HO(r)?i==null||i.click():Fa(new Error("This model cannot be uploaded"))}Da(async()=>{await Ns(),await Ns(),i.addEventListener("change",l=>{const c=l.target.files,u=[];for(let h=0;h<c.length;h++)u.push(c[h]);HO(r)&&r.upload(...u)})});function a(l){Ur[l?"unshift":"push"](()=>{i=l,n(1,i)})}return t.$$set=l=>{"model"in l&&n(0,r=l.model)},[r,i,s,o,a]}class _et extends Kt{constructor(e){super();Xt(this,e,xet,wet,Gt,{model:0})}}function Cet(t){let e;return{c(){e=Ie("This batch prediction component is empty")},m(n,r){ie(n,e,r)},p:Ge,d(n){n&&ne(e)}}}function Tet(t){let e,n,r,i=(t[3]?"s":"")+"",s;return{c(){e=Ie(`This batch prediction component contains
    `),n=Ie(t[3]),r=Ie(`
    prediction`),s=Ie(i)},m(o,a){ie(o,e,a),ie(o,n,a),ie(o,r,a),ie(o,s,a)},p(o,a){a&8&&zt(n,o[3]),a&8&&i!==(i=(o[3]?"s":"")+"")&&zt(s,i)},d(o){o&&ne(e),o&&ne(n),o&&ne(r),o&&ne(s)}}}function nJ(t){let e,n,r,i;return e=new ui({props:{$$slots:{default:[Eet]},$$scope:{ctx:t}}}),e.$on("click",t[4]),{c(){et(e.$$.fragment),n=Oe(),r=oe("span"),H(r,"class","w-1")},m(s,o){Ze(e,s,o),ie(s,n,o),ie(s,r,o),i=!0},p(s,o){const a={};o&256&&(a.$$scope={dirty:o,ctx:s}),e.$set(a)},i(s){i||(ve(e.$$.fragment,s),i=!0)},o(s){be(e.$$.fragment,s),i=!1},d(s){Je(e,s),s&&ne(n),s&&ne(r)}}}function Eet(t){let e;return{c(){e=Ie("Download Predictions")},m(n,r){ie(n,e,r)},d(n){n&&ne(e)}}}function ket(t){let e;return{c(){e=Ie("Upload Predictions")},m(n,r){ie(n,e,r)},d(n){n&&ne(e)}}}function Aet(t){let e;return{c(){e=Ie("Clear Predictions")},m(n,r){ie(n,e,r)},d(n){n&&ne(e)}}}function Met(t){let e,n=t[0].title+"",r,i,s,o,a,l,c,u,h,f,d,p,m,v;function y(S,T){return S[3]?Tet:Cet}let w=y(t),x=w(t),_=t[3]&&nJ(t);return c=new ui({props:{$$slots:{default:[ket]},$$scope:{ctx:t}}}),c.$on("click",t[5]),m=new ui({props:{type:"danger",$$slots:{default:[Aet]},$$scope:{ctx:t}}}),m.$on("click",t[6]),{c(){e=oe("span"),r=Ie(n),i=Oe(),s=oe("p"),x.c(),o=Oe(),a=oe("div"),_&&_.c(),l=Oe(),et(c.$$.fragment),u=Oe(),h=oe("span"),f=Oe(),d=oe("input"),p=Oe(),et(m.$$.fragment),H(e,"class","card-title"),H(s,"class","pb-2"),H(h,"class","w-1"),H(d,"type","file"),d.multiple=!0,H(d,"class","hidden"),H(a,"class","flex")},m(S,T){ie(S,e,T),X(e,r),ie(S,i,T),ie(S,s,T),x.m(s,null),ie(S,o,T),ie(S,a,T),_&&_.m(a,null),X(a,l),Ze(c,a,null),X(a,u),X(a,h),X(a,f),X(a,d),t[7](d),X(a,p),Ze(m,a,null),v=!0},p(S,[T]){(!v||T&1)&&n!==(n=S[0].title+"")&&zt(r,n),w===(w=y(S))&&x?x.p(S,T):(x.d(1),x=w(S),x&&(x.c(),x.m(s,null))),S[3]?_?(_.p(S,T),T&8&&ve(_,1)):(_=nJ(S),_.c(),ve(_,1),_.m(a,l)):_&&(Bn(),be(_,1,1,()=>{_=null}),zn());const E={};T&256&&(E.$$scope={dirty:T,ctx:S}),c.$set(E);const k={};T&256&&(k.$$scope={dirty:T,ctx:S}),m.$set(k)},i(S){v||(ve(_),ve(c.$$.fragment,S),ve(m.$$.fragment,S),v=!0)},o(S){be(_),be(c.$$.fragment,S),be(m.$$.fragment,S),v=!1},d(S){S&&ne(e),S&&ne(i),S&&ne(s),x.d(),S&&ne(o),S&&ne(a),_&&_.d(),Je(c),t[7](null),Je(m)}}}function Iet(t,e,n){let r,i,s=Ge,o=()=>(s(),s=_r(r,d=>n(3,i=d)),r);t.$$.on_destroy.push(()=>s());let{prediction:a}=e,l;function c(){a.download()}function u(){l==null||l.click()}function h(){a.clear()}Da(async()=>{await Ns(),await Ns(),l.addEventListener("change",d=>{const p=d.target.files,m=[];for(let v=0;v<p.length;v++)m.push(p[v]);a.upload(m)})});function f(d){Ur[d?"unshift":"push"](()=>{l=d,n(1,l)})}return t.$$set=d=>{"prediction"in d&&n(0,a=d.prediction)},t.$$.update=()=>{t.$$.dirty&1&&o(n(2,r=a.$count))},[a,l,r,i,c,u,h,f]}class Net extends Kt{constructor(e){super();Xt(this,e,Iet,Met,Gt,{prediction:0})}}function rJ(t,e,n){const r=t.slice();return r[1]=e[n],r}function iJ(t,e,n){const r=t.slice();return r[4]=e[n].id,r}function sJ(t,e,n){const r=t.slice();return r[7]=e[n],r}function oJ(t,e,n){const r=t.slice();return r[10]=e[n],r}function aJ(t,e,n){const r=t.slice();return r[13]=e[n],r}function lJ(t,e,n){const r=t.slice();return r[16]=e[n],r}function cJ(t){let e,n,r,i,s,o,a,l,c,u,h,f,d,p,m,v=t[0].xDataStores,y=[];for(let R=0;R<v.length;R+=1)y[R]=uJ(lJ(t,v,R));const w=R=>be(y[R],1,1,()=>{y[R]=null});let x=t[0].xModels,_=[];for(let R=0;R<x.length;R+=1)_[R]=hJ(aJ(t,x,R));const S=R=>be(_[R],1,1,()=>{_[R]=null});let T=t[0].xDatasets,E=[];for(let R=0;R<T.length;R+=1)E[R]=fJ(oJ(t,T,R));const k=R=>be(E[R],1,1,()=>{E[R]=null});let A=t[0].xPredictions,M=[];for(let R=0;R<A.length;R+=1)M[R]=dJ(sJ(t,A,R));const D=R=>be(M[R],1,1,()=>{M[R]=null});let P=t[0].components,N=[];for(let R=0;R<P.length;R+=1)N[R]=mJ(rJ(t,P,R));return{c(){e=oe("div"),n=oe("h2"),n.textContent="Data Stores",r=Oe();for(let R=0;R<y.length;R+=1)y[R].c();i=Oe(),s=oe("h2"),s.textContent="Models",o=Oe();for(let R=0;R<_.length;R+=1)_[R].c();a=Oe(),l=oe("h2"),l.textContent="Datasets",c=Oe();for(let R=0;R<E.length;R+=1)E[R].c();u=Oe(),h=oe("h2"),h.textContent="Predictions",f=Oe();for(let R=0;R<M.length;R+=1)M[R].c();d=Oe(),p=oe("div");for(let R=0;R<N.length;R+=1)N[R].c();H(e,"class","left svelte-inuorr"),H(p,"class","right svelte-inuorr")},m(R,F){ie(R,e,F),X(e,n),X(e,r);for(let O=0;O<y.length;O+=1)y[O].m(e,null);X(e,i),X(e,s),X(e,o);for(let O=0;O<_.length;O+=1)_[O].m(e,null);X(e,a),X(e,l),X(e,c);for(let O=0;O<E.length;O+=1)E[O].m(e,null);X(e,u),X(e,h),X(e,f);for(let O=0;O<M.length;O+=1)M[O].m(e,null);ie(R,d,F),ie(R,p,F);for(let O=0;O<N.length;O+=1)N[O].m(p,null);m=!0},p(R,F){if(F&1){v=R[0].xDataStores;let O;for(O=0;O<v.length;O+=1){const K=lJ(R,v,O);y[O]?(y[O].p(K,F),ve(y[O],1)):(y[O]=uJ(K),y[O].c(),ve(y[O],1),y[O].m(e,i))}for(Bn(),O=v.length;O<y.length;O+=1)w(O);zn()}if(F&1){x=R[0].xModels;let O;for(O=0;O<x.length;O+=1){const K=aJ(R,x,O);_[O]?(_[O].p(K,F),ve(_[O],1)):(_[O]=hJ(K),_[O].c(),ve(_[O],1),_[O].m(e,a))}for(Bn(),O=x.length;O<_.length;O+=1)S(O);zn()}if(F&1){T=R[0].xDatasets;let O;for(O=0;O<T.length;O+=1){const K=oJ(R,T,O);E[O]?(E[O].p(K,F),ve(E[O],1)):(E[O]=fJ(K),E[O].c(),ve(E[O],1),E[O].m(e,u))}for(Bn(),O=T.length;O<E.length;O+=1)k(O);zn()}if(F&1){A=R[0].xPredictions;let O;for(O=0;O<A.length;O+=1){const K=sJ(R,A,O);M[O]?(M[O].p(K,F),ve(M[O],1)):(M[O]=dJ(K),M[O].c(),ve(M[O],1),M[O].m(e,null))}for(Bn(),O=A.length;O<M.length;O+=1)D(O);zn()}if(F&1){P=R[0].components;let O;for(O=0;O<P.length;O+=1){const K=rJ(R,P,O);N[O]?N[O].p(K,F):(N[O]=mJ(K),N[O].c(),N[O].m(p,null))}for(;O<N.length;O+=1)N[O].d(1);N.length=P.length}},i(R){if(!m){for(let F=0;F<v.length;F+=1)ve(y[F]);for(let F=0;F<x.length;F+=1)ve(_[F]);for(let F=0;F<T.length;F+=1)ve(E[F]);for(let F=0;F<A.length;F+=1)ve(M[F]);m=!0}},o(R){y=y.filter(Boolean);for(let F=0;F<y.length;F+=1)be(y[F]);_=_.filter(Boolean);for(let F=0;F<_.length;F+=1)be(_[F]);E=E.filter(Boolean);for(let F=0;F<E.length;F+=1)be(E[F]);M=M.filter(Boolean);for(let F=0;F<M.length;F+=1)be(M[F]);m=!1},d(R){R&&ne(e),Yr(y,R),Yr(_,R),Yr(E,R),Yr(M,R),R&&ne(d),R&&ne(p),Yr(N,R)}}}function uJ(t){let e,n,r;return n=new vet({props:{dataStore:t[16]}}),{c(){e=oe("div"),et(n.$$.fragment),H(e,"class","card")},m(i,s){ie(i,e,s),Ze(n,e,null),r=!0},p(i,s){const o={};s&1&&(o.dataStore=i[16]),n.$set(o)},i(i){r||(ve(n.$$.fragment,i),r=!0)},o(i){be(n.$$.fragment,i),r=!1},d(i){i&&ne(e),Je(n)}}}function hJ(t){let e,n,r;return n=new _et({props:{model:t[13]}}),{c(){e=oe("div"),et(n.$$.fragment),H(e,"class","card")},m(i,s){ie(i,e,s),Ze(n,e,null),r=!0},p(i,s){const o={};s&1&&(o.model=i[13]),n.$set(o)},i(i){r||(ve(n.$$.fragment,i),r=!0)},o(i){be(n.$$.fragment,i),r=!1},d(i){i&&ne(e),Je(n)}}}function fJ(t){let e,n,r;return n=new cet({props:{dataset:t[10]}}),{c(){e=oe("div"),et(n.$$.fragment),H(e,"class","card")},m(i,s){ie(i,e,s),Ze(n,e,null),r=!0},p(i,s){const o={};s&1&&(o.dataset=i[10]),n.$set(o)},i(i){r||(ve(n.$$.fragment,i),r=!0)},o(i){be(n.$$.fragment,i),r=!1},d(i){i&&ne(e),Je(n)}}}function dJ(t){let e,n,r,i;return n=new Net({props:{prediction:t[7]}}),{c(){e=oe("div"),et(n.$$.fragment),r=Oe(),H(e,"class","card")},m(s,o){ie(s,e,o),Ze(n,e,null),X(e,r),i=!0},p(s,o){const a={};o&1&&(a.prediction=s[7]),n.$set(a)},i(s){i||(ve(n.$$.fragment,s),i=!0)},o(s){be(n.$$.fragment,s),i=!1},d(s){s&&ne(e),Je(n)}}}function $et(t){let e,n;return{c(){e=oe("div"),H(e,"id",n=t[1].id),H(e,"class","card")},m(r,i){ie(r,e,i)},p(r,i){i&1&&n!==(n=r[1].id)&&H(e,"id",n)},d(r){r&&ne(e)}}}function Ret(t){let e,n=t[1]+"",r;return{c(){e=oe("h2"),r=Ie(n)},m(i,s){ie(i,e,s),X(e,r)},p(i,s){s&1&&n!==(n=i[1]+"")&&zt(r,n)},d(i){i&&ne(e)}}}function Det(t){let e,n,r=t[1],i=[];for(let s=0;s<r.length;s+=1)i[s]=pJ(iJ(t,r,s));return{c(){e=oe("div");for(let s=0;s<i.length;s+=1)i[s].c();n=Oe(),H(e,"class","flex flex-row flex-wrap items-stretch")},m(s,o){ie(s,e,o);for(let a=0;a<i.length;a+=1)i[a].m(e,null);X(e,n)},p(s,o){if(o&1){r=s[1];let a;for(a=0;a<r.length;a+=1){const l=iJ(s,r,a);i[a]?i[a].p(l,o):(i[a]=pJ(l),i[a].c(),i[a].m(e,n))}for(;a<i.length;a+=1)i[a].d(1);i.length=r.length}},d(s){s&&ne(e),Yr(i,s)}}}function pJ(t){let e,n;return{c(){e=oe("div"),H(e,"id",n=t[4]),H(e,"class","card flex-none xl:flex-1 w-full xl:w-auto")},m(r,i){ie(r,e,i)},p(r,i){i&1&&n!==(n=r[4])&&H(e,"id",n)},d(r){r&&ne(e)}}}function mJ(t){let e,n;function r(o,a){return(e==null||a&1)&&(e=!!Array.isArray(o[1])),e?Det:typeof o[1]=="string"?Ret:$et}let i=r(t,-1),s=i(t);return{c(){s.c(),n=Ki()},m(o,a){s.m(o,a),ie(o,n,a)},p(o,a){i===(i=r(o,a))&&s?s.p(o,a):(s.d(1),s=i(o),s&&(s.c(),s.m(n.parentNode,n)))},d(o){s.d(o),o&&ne(n)}}}function Pet(t){let e,n,r=t[0]&&cJ(t);return{c(){r&&r.c(),e=Ki()},m(i,s){r&&r.m(i,s),ie(i,e,s),n=!0},p(i,[s]){i[0]?r?(r.p(i,s),s&1&&ve(r,1)):(r=cJ(i),r.c(),ve(r,1),r.m(e.parentNode,e)):r&&(Bn(),be(r,1,1,()=>{r=null}),zn())},i(i){n||(ve(r),n=!0)},o(i){be(r),n=!1},d(i){r&&r.d(i),i&&ne(e)}}}function Oet(t,e,n){let{settings:r}=e;return VK(()=>{r.mount()}),t.$$set=i=>{"settings"in i&&n(0,r=i.settings)},[r]}class Fet extends Kt{constructor(e){super();Xt(this,e,Oet,Pet,Gt,{settings:0})}}function gJ(t,e,n){const r=t.slice();return r[8]=e[n][0],r[9]=e[n][1],r[11]=n,r}function vJ(t){let e,n=t[9]+"",r,i,s;return{c(){e=oe("a"),r=Ie(n),i=Oe(),H(e,"href",s=`#${t[8]}`),H(e,"class","ml-2 mr-5 flex items-center hover:text-black border-solid border-0 border-b-2 border-transparent svelte-14pdafl"),dt(e,"active",!t[4]&&t[2]===t[9])},m(o,a){ie(o,e,a),X(e,r),X(e,i)},p(o,a){a&2&&n!==(n=o[9]+"")&&zt(r,n),a&2&&s!==(s=`#${o[8]}`)&&H(e,"href",s),a&22&&dt(e,"active",!o[4]&&o[2]===o[9])},d(o){o&&ne(e)}}}function Let(t){let e,n,r;return{c(){e=Zr("svg"),n=Zr("circle"),r=Zr("path"),H(n,"cx","12"),H(n,"cy","12"),H(n,"r","3"),H(r,"d","M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"),H(e,"xmlns","http://www.w3.org/2000/svg"),H(e,"width","24"),H(e,"height","24"),H(e,"viewBox","0 0 24 24"),H(e,"fill","none"),H(e,"stroke","currentColor"),H(e,"stroke-width","2"),H(e,"stroke-linecap","round"),H(e,"stroke-linejoin","round"),H(e,"class","feather feather-settings")},m(i,s){ie(i,e,s),X(e,n),X(e,r)},d(i){i&&ne(e)}}}function yJ(t){let e,n,r,i;return e=new ui({props:{round:!0,type:"danger",$$slots:{default:[Bet]},$$scope:{ctx:t}}}),e.$on("click",t[5]),{c(){et(e.$$.fragment),n=Oe(),r=oe("span"),H(r,"class","w-1")},m(s,o){Ze(e,s,o),ie(s,n,o),ie(s,r,o),i=!0},p(s,o){const a={};o&4096&&(a.$$scope={dirty:o,ctx:s}),e.$set(a)},i(s){i||(ve(e.$$.fragment,s),i=!0)},o(s){be(e.$$.fragment,s),i=!1},d(s){Je(e,s),s&&ne(n),s&&ne(r)}}}function Bet(t){let e,n,r;return{c(){e=Zr("svg"),n=Zr("path"),r=Zr("line"),H(n,"d","M18.36 6.64a9 9 0 1 1-12.73 0"),H(r,"x1","12"),H(r,"y1","2"),H(r,"x2","12"),H(r,"y2","12"),H(e,"xmlns","http://www.w3.org/2000/svg"),H(e,"width","24"),H(e,"height","24"),H(e,"viewBox","0 0 24 24"),H(e,"fill","none"),H(e,"stroke","currentColor"),H(e,"stroke-width","2"),H(e,"stroke-linecap","round"),H(e,"stroke-linejoin","round"),H(e,"class","feather feather-power")},m(i,s){ie(i,e,s),X(e,n),X(e,r)},d(i){i&&ne(e)}}}function zet(t){let e,n,r,i,s,o,a,l,c,u,h,f,d,p,m=Object.entries(t[1]),v=[];for(let w=0;w<m.length;w+=1)v[w]=vJ(gJ(t,m,w));u=new ui({props:{round:!0,$$slots:{default:[Let]},$$scope:{ctx:t}}}),u.$on("click",t[6]);let y=t[3]&&yJ(t);return{c(){e=oe("header"),n=oe("div"),r=oe("a"),i=oe("span"),s=Ie(t[0]),o=Oe(),a=oe("nav");for(let w=0;w<v.length;w+=1)v[w].c();l=Oe(),c=oe("div"),et(u.$$.fragment),h=Oe(),f=oe("span"),d=Oe(),y&&y.c(),H(i,"class","mx-3 text-lg"),H(r,"href","#/"),H(r,"class","flex p-3 title-font font-medium items-center text-gray-900 mb-4 md:mb-0 border-solid border-0 border-r border-gray-200 svelte-14pdafl"),H(a,"class","flex items-stretch justify-start flex-wrap text-base flex-grow mx-4"),H(f,"class","w-1"),H(c,"class","flex items-center"),H(n,"class","mx-auto flex flex-wrap flex-col md:flex-row items-stretch w-full"),H(e,"class","bg-white text-gray-700 body-font")},m(w,x){ie(w,e,x),X(e,n),X(n,r),X(r,i),X(i,s),X(n,o),X(n,a);for(let _=0;_<v.length;_+=1)v[_].m(a,null);X(n,l),X(n,c),Ze(u,c,null),X(c,h),X(c,f),X(c,d),y&&y.m(c,null),p=!0},p(w,[x]){if((!p||x&1)&&zt(s,w[0]),x&22){m=Object.entries(w[1]);let S;for(S=0;S<m.length;S+=1){const T=gJ(w,m,S);v[S]?v[S].p(T,x):(v[S]=vJ(T),v[S].c(),v[S].m(a,null))}for(;S<v.length;S+=1)v[S].d(1);v.length=m.length}const _={};x&4096&&(_.$$scope={dirty:x,ctx:w}),u.$set(_),w[3]?y?(y.p(w,x),x&8&&ve(y,1)):(y=yJ(w),y.c(),ve(y,1),y.m(c,null)):y&&(Bn(),be(y,1,1,()=>{y=null}),zn())},i(w){p||(ve(u.$$.fragment,w),ve(y),p=!0)},o(w){be(u.$$.fragment,w),be(y),p=!1},d(w){w&&ne(e),Yr(v,w),Je(u),y&&y.d()}}}function Vet(t,e,n){let{title:r}=e,{items:i}=e,{current:s}=e,{closable:o}=e,{showSettings:a=!1}=e;const l=Pa();function c(){a?window.location.href=window.location.href.split("#")[0]+"#"+Object.keys(i)[Object.values(i).indexOf(s)]:window.location.href=window.location.href.split("#")[0]+"#settings"}function u(){setTimeout(()=>{l("quit")},400)}return t.$$set=h=>{"title"in h&&n(0,r=h.title),"items"in h&&n(1,i=h.items),"current"in h&&n(2,s=h.current),"closable"in h&&n(3,o=h.closable),"showSettings"in h&&n(4,a=h.showSettings)},[r,i,s,o,a,u,c]}class Uet extends Kt{constructor(e){super();Xt(this,e,Vet,zet,Gt,{title:0,items:1,current:2,closable:3,showSettings:4,quit:5})}get quit(){return this.$$.ctx[5]}}function Wet(t){let e;return{c(){e=Ie("\xA0")},m(n,r){ie(n,e,r)},p:Ge,d(n){n&&ne(e)}}}function Get(t){let e;function n(s,o){return s[1][0]===Oa.Warning?qet:s[1][0]===Oa.Error?jet:Het}let r=n(t),i=r(t);return{c(){i.c(),e=Ki()},m(s,o){i.m(s,o),ie(s,e,o)},p(s,o){r===(r=n(s))&&i?i.p(s,o):(i.d(1),i=r(s),i&&(i.c(),i.m(e.parentNode,e)))},d(s){i.d(s),s&&ne(e)}}}function Het(t){let e=(t[1][1]||"")+"",n;return{c(){n=Ie(e)},m(r,i){ie(r,n,i)},p(r,i){i&2&&e!==(e=(r[1][1]||"")+"")&&zt(n,e)},d(r){r&&ne(n)}}}function jet(t){let e,n=(t[1][1]||"")+"",r;return{c(){e=Ie(`Err:
        `),r=Ie(n)},m(i,s){ie(i,e,s),ie(i,r,s)},p(i,s){s&2&&n!==(n=(i[1][1]||"")+"")&&zt(r,n)},d(i){i&&ne(e),i&&ne(r)}}}function qet(t){let e,n=(t[1][1]||"")+"",r;return{c(){e=Ie(`Warn:
        `),r=Ie(n)},m(i,s){ie(i,e,s),ie(i,r,s)},p(i,s){s&2&&n!==(n=(i[1][1]||"")+"")&&zt(r,n)},d(i){i&&ne(e),i&&ne(r)}}}function Xet(t){let e,n,r,i,s,o;function a(u,h){return u[1]?Get:Wet}let l=a(t),c=l(t);return{c(){e=oe("footer"),n=oe("p"),c.c(),r=Oe(),i=oe("p"),s=Ie("\xA9 2021 "),o=Ie(t[0]),H(n,"class","console svelte-p8xzgh"),dt(n,"error",t[1]&&t[1][0]===Oa.Error),dt(n,"warning",t[1]&&t[1][0]===Oa.Warning),H(i,"class","text-sm text-gray-500 sm:ml-4 sm:pl-4 sm:border-gray-200"),H(e,"class","bg-white text-gray-600 border-t px-5 py-1 flex items-center justify-between flex-col sm:flex-row")},m(u,h){ie(u,e,h),X(e,n),c.m(n,null),X(e,r),X(e,i),X(i,s),X(i,o)},p(u,[h]){l===(l=a(u))&&c?c.p(u,h):(c.d(1),c=l(u),c&&(c.c(),c.m(n,null))),h&2&&dt(n,"error",u[1]&&u[1][0]===Oa.Error),h&2&&dt(n,"warning",u[1]&&u[1][0]===Oa.Warning),h&1&&zt(o,u[0])},i:Ge,o:Ge,d(u){u&&ne(e),c.d()}}}function Ket(t,e,n){let r,{author:i}=e;const s=tXe();return uO(t,s,o=>n(1,r=o)),t.$$set=o=>{"author"in o&&n(0,i=o.author)},[i,r,s]}class Yet extends Kt{constructor(e){super();Xt(this,e,Ket,Xet,Gt,{author:0})}}function bJ(t){let e,n,r,i,s,o,a,l,c,u,h;r=new Uet({props:{title:t[0],items:t[10].reduce(t[12],{}),current:t[9],showSettings:t[8],closable:t[4]}}),r.$on("quit",t[5]);const f=[Jet,Zet],d=[];function p(m,v){return m[8]?0:m[9]?1:-1}return~(o=p(t))&&(a=d[o]=f[o](t)),c=new Yet({props:{author:t[1]}}),{c(){e=oe("div"),n=oe("div"),et(r.$$.fragment),i=Oe(),s=oe("main"),a&&a.c(),l=Oe(),et(c.$$.fragment),H(s,"class","main-container svelte-t1s91s"),H(n,"class","app-container svelte-t1s91s"),H(e,"class","marcelle fixed h-screen w-screen overflow-scroll top-0 left-0")},m(m,v){ie(m,e,v),X(e,n),Ze(r,n,null),X(n,i),X(n,s),~o&&d[o].m(s,null),X(n,l),Ze(c,n,null),h=!0},p(m,v){t=m;const y={};v&1&&(y.title=t[0]),v&1088&&(y.items=t[10].reduce(t[12],{})),v&512&&(y.current=t[9]),v&256&&(y.showSettings=t[8]),v&16&&(y.closable=t[4]),r.$set(y);let w=o;o=p(t),o===w?~o&&d[o].p(t,v):(a&&(Bn(),be(d[w],1,1,()=>{d[w]=null}),zn()),~o?(a=d[o],a?a.p(t,v):(a=d[o]=f[o](t),a.c()),ve(a,1),a.m(s,null)):a=null);const x={};v&2&&(x.author=t[1]),c.$set(x)},i(m){h||(ve(r.$$.fragment,m),ve(a),ve(c.$$.fragment,m),vu(()=>{u||(u=Hv(n,Ek,{amount:10,duration:t[4]?400:0},!0)),u.run(1)}),h=!0)},o(m){be(r.$$.fragment,m),be(a),be(c.$$.fragment,m),u||(u=Hv(n,Ek,{amount:10,duration:t[4]?400:0},!1)),u.run(0),h=!1},d(m){m&&ne(e),Je(r),~o&&d[o].d(),Je(c),m&&u&&u.end()}}}function Zet(t){let e,n;return e=new eet({props:{dashboard:t[2][t[9]]}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,i){const s={};i&516&&(s.dashboard=r[2][r[9]]),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function Jet(t){let e,n;return e=new Fet({props:{settings:t[3]}}),{c(){et(e.$$.fragment)},m(r,i){Ze(e,r,i),n=!0},p(r,i){const s={};i&8&&(s.settings=r[3]),e.$set(s)},i(r){n||(ve(e.$$.fragment,r),n=!0)},o(r){be(e.$$.fragment,r),n=!1},d(r){Je(e,r)}}}function Qet(t){let e,n,r,i;document.title=e=t[0];let s=t[7]&&bJ(t);return{c(){n=Oe(),s&&s.c(),r=Ki()},m(o,a){ie(o,n,a),s&&s.m(o,a),ie(o,r,a),i=!0},p(o,[a]){(!i||a&1)&&e!==(e=o[0])&&(document.title=e),o[7]?s?(s.p(o,a),a&128&&ve(s,1)):(s=bJ(o),s.c(),ve(s,1),s.m(r.parentNode,r)):s&&(Bn(),be(s,1,1,()=>{s=null}),zn())},i(o){i||(ve(s),i=!0)},o(o){be(s),i=!1},d(o){o&&ne(n),s&&s.d(o),o&&ne(r)}}}function wJ(t){let e=t.replace(/^\s+|\s+$/g,"");e=e.toLowerCase();const n="\xE0\xE1\xE4\xE2\xE8\xE9\xEB\xEA\xEC\xED\xEF\xEE\xF2\xF3\xF6\xF4\xF9\xFA\xFC\xFB\xF1\xE7\xB7/_,:;",r="aaaaeeeeiiiioooouuuunc------";for(let i=0,s=n.length;i<s;i++)e=e.replace(new RegExp(n.charAt(i),"g"),r.charAt(i));return e=e.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-"),e}function ett(t,e,n){let r,i;const s=Pa();let{title:o}=e,{author:a}=e,{dashboards:l={}}=e,{settings:c}=e,{page:u}=e,{closable:h}=e,f=!1;Da(()=>{n(7,f=!0)});function d(){n(7,f=!1),setTimeout(()=>{s("quit")},400)}let p=!1,m=Object.keys(l)[0]||void 0;Da(()=>{try{const y=new XQe;y.route("settings",()=>{n(8,p=!0),m&&l[m].destroy(),u.set("settings")}),i.forEach((w,x)=>{y.route(w,()=>{n(8,p=!1),m!==r[x]&&(m&&l[m].destroy(),n(9,m=r[x]),u.set(w===""?wJ(r[0]):w))})})}catch(y){console.log("Could not enable router",y)}});const v=(y,w,x)=>ni(Bt({},y),{[w]:r[x]});return t.$$set=y=>{"title"in y&&n(0,o=y.title),"author"in y&&n(1,a=y.author),"dashboards"in y&&n(2,l=y.dashboards),"settings"in y&&n(3,c=y.settings),"page"in y&&n(11,u=y.page),"closable"in y&&n(4,h=y.closable)},t.$$.update=()=>{t.$$.dirty&4&&n(6,r=Object.keys(l)),t.$$.dirty&64&&n(10,i=[""].concat(r.slice(1).map(wJ)))},[o,a,l,c,h,d,r,f,p,m,i,u,v]}class ttt extends Kt{constructor(e){super();Xt(this,e,ett,Qet,Gt,{title:0,author:1,dashboards:2,settings:3,page:11,closable:4,quit:5})}get quit(){return this.$$.ctx[5]}}function xJ(t){return typeof t=="string"}function _J(t){return Array.isArray(t)}class ntt{constructor(){this.name="settings",this.components=[],this.xModels=[],this.xDatasets=[],this.xPredictions=[],this.xDataStores=[]}use(...e){return this.components=this.components.concat(e),this}dataStores(...e){return this.xDataStores=e,this}models(...e){return this.xModels=e,this}datasets(...e){return this.xDatasets=e,this}predictions(...e){return this.xPredictions=e,this}mount(){for(const e of this.components)if(_J(e))for(const n of e)n.mount();else xJ(e)||e.mount()}destroy(){for(const e of this.components)if(_J(e))for(const n of e)n.destroy();else xJ(e)||e.destroy()}}class rtt{constructor({title:e="Hello, Marcelle!",author:n="author",closable:r=!1}){this.panels={},this.settings=new ntt,this.$active=new Ue(!1,!0),this.$page=new Ue("",!0),this.title=e,this.author=n,this.closable=r}page(e,n){return Object.keys(this.panels).includes(e)||(this.panels[e]=new GQe(e,n)),this.panels[e]}show(){this.app=new ttt({target:document.body,props:{title:this.title,author:this.author,dashboards:this.panels,settings:this.settings,page:this.$page,closable:this.closable}}),this.$active.set(!0),this.app.$on("quit",()=>{var e;this.$active.set(!1),(e=this.app)===null||e===void 0||e.$destroy();for(const n of Object.values(this.panels))n.destroy();this.app=void 0})}hide(){var e;(e=this.app)===null||e===void 0||e.quit()}}function wtt(t){return new rtt(t)}export{pz as A,Cn as a,mt as b,ii as c,oKe as d,ctt as e,rI as f,vtt as g,MXe as h,Po as i,att as j,ftt as k,mtt as l,se as m,ptt as n,gtt as o,ytt as p,ltt as q,htt as r,Nt as s,de as t,Fa as u,dtt as v,btt as w,utt as x,wtt as y,Tt as z};
